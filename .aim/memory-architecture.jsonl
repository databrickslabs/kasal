{"type":"_aim","source":"mcp-knowledge-graph"}
{"type":"entity","name":"Kasal","entityType":"project","observations":["AI agent workflow orchestration platform","Clean architecture pattern: Frontend -> API -> Services -> Repositories -> Database","FastAPI + React + CrewAI framework","Supports multiple LLM providers (Databricks, OpenAI, Anthropic)","JWT authentication with Databricks OAuth","Current development focus: Stop execution feature","Recent work on knowledge integration","Vector search capabilities added","Active feature branch: feature/stop-execution"]}
{"type":"entity","name":"Backend","entityType":"component","observations":["FastAPI + SQLAlchemy 2.0 + Alembic","Python 3.9+","Clean architecture layers","Async-first operations","Auto-reloads with --reload flag"]}
{"type":"entity","name":"Frontend","entityType":"component","observations":["React 18 + TypeScript + Material-UI + ReactFlow","Hot module replacement (HMR)","Copies docs from src/docs/ to public/docs/","Built assets stored in frontend_static/","Updated with two new Zustand stores for improved state management","Migrated from local useState to global Zustand stores for chat messages","Implemented real-time configuration updates without screen refresh","Fixed duplicate message display issues in chat interface","Added event-driven configuration management for knowledge sources","Enhanced user experience with immediate UI updates on configuration changes"]}
{"type":"entity","name":"CrewAI_Engine","entityType":"ai_framework","observations":["Agent orchestration framework","Deterministic crew IDs for memory persistence","Group isolation for tenant data separation","Databricks Vector Search integration"]}
{"type":"entity","name":"Database","entityType":"persistence","observations":["SQLite for development","PostgreSQL for production","Alembic migrations","SQLAlchemy 2.0 ORM"]}
{"type":"entity","name":"CleanArchitecture","entityType":"pattern","observations":["Separation of concerns across layers","Frontend -> API -> Services -> Repositories -> Database","Service layer contains business logic","Repository pattern for data access","Dependency inversion principle applied"]}
{"type":"entity","name":"AsyncOperations","entityType":"requirement","observations":["All I/O operations must be async","Non-blocking operations required","Python asyncio used throughout","FastAPI async endpoints","Database operations use async SQLAlchemy"]}
{"type":"entity","name":"VectorKnowledgeSystem","entityType":"subsystem","observations":["Advanced knowledge retrieval using vectors","Databricks Vector Search integration","Text embedding for similarity search","Multiple knowledge source types supported","Factory pattern for knowledge component creation"]}
{"type":"entity","name":"EnvironmentConfig","entityType":"configuration","observations":["Environment variable management","Development/staging/production settings","Database connection strings","API keys and secrets","Feature flags and toggles"]}
{"type":"entity","name":"DatabaseConfig","entityType":"configuration","observations":["SQLAlchemy configuration","Connection pooling settings","Migration configuration","Backup and recovery settings","Performance tuning parameters"]}
{"type":"entity","name":"LoggingConfig","entityType":"configuration","observations":["Log level configuration","Output format settings","File rotation policies","External logging service integration","Performance monitoring setup"]}
{"type":"entity","name":"SecurityConfig","entityType":"configuration","observations":["CORS settings","JWT secret keys","OAuth configuration","Rate limiting settings","API security policies"]}
{"type":"entity","name":"DatabricksConfig","entityType":"configuration","observations":["Databricks workspace settings","Authentication tokens","Volume and catalog configurations","Vector search endpoints","Compute cluster settings","Now dispatches databricks-config-updated events on configuration save","Integrated with global KnowledgeConfigZustandStore for real-time updates","Enhanced with event-driven configuration change notifications","Supports immediate UI updates across all components on config changes"]}
{"type":"entity","name":"BuildConfig","entityType":"configuration","observations":["Frontend build configuration","Asset optimization settings","Bundle splitting rules","Environment-specific builds","Deployment configurations"]}
{"type":"entity","name":"AppYaml","entityType":"configuration","observations":["Application deployment manifest","Databricks app configuration","Resource requirements","Environment variables","Service dependencies"]}
{"type":"entity","name":"RequirementsTxt","entityType":"configuration","observations":["Python package dependencies","Version constraints","Development vs production packages","Security and compatibility requirements","Dependency resolution"]}
{"type":"entity","name":"UnitTests","entityType":"test_infrastructure","observations":["pytest-based unit testing","Service layer testing","Repository pattern testing","Mock and fixture management","Coverage reporting and metrics"]}
{"type":"entity","name":"IntegrationTests","entityType":"test_infrastructure","observations":["API endpoint testing","Database integration testing","External service integration","End-to-end workflow testing","Test database setup and teardown"]}
{"type":"entity","name":"FrontendTests","entityType":"test_infrastructure","observations":["Jest and React Testing Library","Component unit testing","User interaction testing","Accessibility testing","Visual regression testing"]}
{"type":"entity","name":"TestFixtures","entityType":"test_infrastructure","observations":["Test data management","Database seeding and cleanup","Mock API responses","Test user accounts","Reusable test scenarios"]}
{"type":"entity","name":"AlembicMigrations","entityType":"database_infrastructure","observations":["Database migration system using Alembic","Located in src/backend/migrations/","Version-controlled schema changes","Migration scripts in migrations/versions/","Configuration in alembic.ini"]}
{"type":"entity","name":"DatabaseSession","entityType":"database_infrastructure","observations":["SQLAlchemy session management","Located in src/backend/src/db/session.py","Database connection handling","Session factory and lifecycle","Connection pooling configuration"]}
{"type":"entity","name":"DatabaseBase","entityType":"database_infrastructure","observations":["Base database configuration","Located in src/backend/src/db/base.py","SQLAlchemy declarative base","Common model patterns","Database initialization"]}
{"type":"entity","name":"AllModels","entityType":"database_infrastructure","observations":["Central model registry","Located in src/backend/src/db/all_models.py","Imports all database models","Model discovery for migrations","Schema generation support"]}
{"type":"entity","name":"FastAPI_Backend","entityType":"subsystem","observations":["RESTful API layer built with FastAPI","Handles HTTP requests and responses","Implements clean architecture patterns","Async/await throughout for non-blocking operations"]}
{"type":"entity","name":"ProcessCrewExecutor","entityType":"service","observations":["Service layer for executing CrewAI crews in isolated processes","Manages subprocess lifecycle and communication","Handles crew execution results and status updates","Integrates with CrewAIEngineService for orchestration"]}
{"type":"entity","name":"Clean_Architecture","entityType":"pattern","observations":["Separation of concerns across layers","FastAPI -> Services -> Repositories -> Database flow","Dependency inversion principle applied","Domain logic isolated from infrastructure concerns"]}
{"type":"entity","name":"LLM_Manager","entityType":"service","observations":["Centralized LLM provider management","Supports multiple providers: Databricks, OpenAI, Anthropic","Configuration-driven model selection","Integration with CrewAI LLM abstraction"]}
{"type":"entity","name":"Databricks_Integration","entityType":"integration","observations":["Primary LLM provider through Databricks","Vector Search for embeddings and similarity","Unity Catalog for data governance","OAuth authentication integration"]}
{"type":"entity","name":"ClaudeCodeHooksSystem","entityType":"automation_system","observations":["Comprehensive workflow enforcement system","Automatic blocking of operations without knowledge graph consultation","PreToolUse, PostToolUse, and Session lifecycle hooks","Compliance validation and monitoring","Auto-update queue for knowledge graph maintenance","Addresses core issue: 'why is claude not using the graph search'","IMPLEMENTED: Active hooks system with knowledge graph enforcement","PreToolUse hooks block file operations without KG consultation","PostToolUse hooks remind to update KG after file changes","SessionStart hooks enforce mandatory project context loading","Configuration in .claude/settings.json with enforcement rules","Enforcement script: .claude/hooks/knowledge-graph-enforcement.py","Logging system for compliance tracking and debugging","Addresses core issue: automatic enforcement of CLAUDE.md workflow"]}
{"type":"entity","name":"ServiceArchitecturePattern","entityType":"pattern","observations":["Frontend API → Router Layer → Service Layer → Repository Layer → Database/Backend API","Service layer contains business logic and orchestration","Repository layer abstracts data access and external API calls","Unit of Work pattern for transaction management","Dependency injection through FastAPI's DI system","All operations are async and non-blocking","Knowledge graph alignment completed - all routers properly delegate to services","Code verification confirmed: AuthRouter→AuthService, AgentsRouter→AgentService, TemplatesRouter→TemplateService, ExecutionsRouter→ExecutionService, CrewsRouter→CrewService","Removed incorrect relations showing routers bypassing service layer","Architecture compliance verified across all API endpoints"]}
{"type":"entity","name":"UnitOfWorkPattern","entityType":"pattern","observations":["Transaction management for complex operations","Ensures atomicity across multiple repository operations","Implemented through SQLAlchemy async sessions","Used in services for multi-step database operations","Rollback capability for failed operations","Located in core/dependencies.py and base services","Implemented through SQLAlchemy AsyncSession in repositories","BaseRepository handles transaction lifecycle: session.flush() → session.commit()","Automatic rollback on exceptions in all repository operations","Each operation commits immediately for data consistency","Session passed from dependencies.py through service to repository","Repository operations: create(), add(), update(), delete() all handle transactions","Error handling with try/catch and session.rollback() on failures"]}
{"type":"entity","name":"DependencyInjectionPattern","entityType":"pattern","observations":["Uses FastAPI's built-in DI system with Annotated types","Factory functions for repositories and services","SessionDep = Annotated[AsyncSession, Depends(get_db)]","GroupContextDep = Annotated[GroupContext, Depends(get_group_context)]","get_repository() and get_service() factory functions","Consistent initialization pattern across all services","get_group_context() extracts GroupContext from HTTP headers","Supports both Databricks Apps and OAuth2-Proxy headers","Fallback to admin@admin.com in DEBUG_MODE for local development","get_repository() factory creates repository instances with model and session","get_service() factory creates service instances with session and repositories","get_log_service() singleton factory for LLMLogService","Error handling with fallback initialization patterns in get_service()"]}
{"type":"entity","name":"RepositoryPattern","entityType":"pattern","observations":["All database access through repositories","BaseRepository class with common CRUD operations","Repository classes extend BaseRepository with model-specific methods","Async database operations using SQLAlchemy 2.0","Repository initialization: repository_class(model_class, session)","Used by services to access data without direct DB coupling"]}
{"type":"entity","name":"BaseRepository","entityType":"base_class","observations":["Core base class for all repositories","Located in src/core/base_repository.py","Provides common CRUD operations","Async database operations using SQLAlchemy","Constructor takes model_class and session parameters","Extended by all repository implementations","Implements Unit of Work pattern through SQLAlchemy sessions","All operations handle transaction lifecycle","Automatic rollback on exceptions","Commit after flush to ensure persistence","Support for both int and UUID primary keys","Generic type support with ModelType bound to Base"]}
{"type":"entity","name":"BaseService","entityType":"base_class","observations":["Core base class for all services","Located in src/core/base_service.py","Business logic orchestration layer","Uses repositories for data access","Async operations throughout","Constructor takes session as primary parameter","Uses repositories for all data access","Session dependency injected from FastAPI","Business logic orchestration without direct database access","Generic typing with ModelType and SchemaType","Standard CRUD operations delegated to repositories"]}
{"type":"entity","name":"ConfigurationContentSeparation","entityType":"pattern","observations":["Configuration stored in local database (SQLite/PostgreSQL)","Actual content stored in external systems (Databricks Vector Search, Unity Catalog)","Database: Memory backend configurations, volume settings, authentication","Vector Search: Embedded memory content, similarity search, agent isolation","Unity Catalog Volumes: Raw file storage, document content","Clear separation between metadata and actual data storage","Vector Search: All memory indexes, embeddings, similarity search data","Vector Search: Agent memory content, knowledge retrieval, vector embeddings","Database (PostgreSQL/SQLite): Runs, executions, logs, audit trails","Database: Configuration settings, user accounts, crew definitions","Database: Authentication tokens, API keys, workspace settings","Database: Process status, execution history, system logs","Clear operational separation: Vector Search for AI memory, Database for application data"]}
{"type":"entity","name":"KnowledgeGraphEnforcementHooks","entityType":"automation_system","observations":["Automated workflow enforcement for CLAUDE.md compliance","Blocks file operations without prior knowledge graph consultation","Mandatory aim_search_nodes() or aim_read_graph() before Read/Write/Edit","PostToolUse reminders to update KG with aim_add_observations()","SessionStart enforcement of context loading","Located in .claude/settings.json and .claude/hooks/","Prevents the 'why search not working' issue through enforcement","Compliance logging in .claude/logs/"]}
{"type":"entity","name":"CleanArchitecturePattern","entityType":"pattern","observations":["Core architecture pattern used throughout Kasal","Separates concerns across API -> Services -> Repositories -> Database layers","Enforced in backend with FastAPI structure","Repository pattern with Unit of Work for transaction management"]}
{"type":"entity","name":"AsyncFirstPrinciple","entityType":"requirement","observations":["CRITICAL: All operations must be async and non-blocking","Enforced in backend services and database operations","Required for proper event loop handling","Prevents blocking in FastAPI server"]}
{"type":"entity","name":"ExecutionIsolation","entityType":"pattern","observations":["Each crew execution has isolated resources","Prevents data leakage between executions","Implemented in DatabricksVectorKnowledgeSource with execution_id","Collection names include execution_id for isolation"]}
{"type":"entity","name":"TenantIsolation","entityType":"pattern","observations":["Multi-tenant architecture with group_id isolation","Ensures complete separation between different user groups","Implemented in memory backends and knowledge sources","Group_id used in crew memory persistence"]}
{"type":"entity","name":"VectorSearchDirectAccess","entityType":"integration","observations":["Direct integration with Databricks Vector Search","Bypasses ChromaDB completely for knowledge sources","Uses document_index from memory backend configuration","Handles embeddings natively within Vector Search","Supports OBO authentication and PAT tokens","Repository pattern for Vector Search operations"]}
{"type":"relation","from":"Kasal","to":"Backend","relationType":"contains"}
{"type":"relation","from":"Kasal","to":"Frontend","relationType":"contains"}
{"type":"relation","from":"Kasal","to":"CrewAI_Engine","relationType":"integrates_with"}
{"type":"relation","from":"Kasal","to":"Database","relationType":"uses"}
{"type":"relation","from":"Backend","to":"Database","relationType":"connects_to"}
{"type":"relation","from":"Backend","to":"CrewAI_Engine","relationType":"orchestrates"}
{"type":"relation","from":"Frontend","to":"Backend","relationType":"communicates_with"}
{"type":"relation","from":"ProcessExecution","to":"ProcessCrewExecutor","relationType":"communicates_with"}
{"type":"relation","from":"AgentConfiguration","to":"CrewAIEngineService","relationType":"configures"}
{"type":"relation","from":"KnowledgeManagement","to":"DatabricksKnowledgeService","relationType":"manages"}
{"type":"relation","from":"TemplateLibrary","to":"TemplateService","relationType":"displays"}
{"type":"relation","from":"ModelConfiguration","to":"CrewAIEngineService","relationType":"configures"}
{"type":"relation","from":"ResultsViewer","to":"ProcessCrewExecutor","relationType":"displays_results_from"}
{"type":"relation","from":"FastAPI_Backend","to":"ProcessCrewExecutor","relationType":"delegates_to"}
{"type":"relation","from":"ProcessCrewExecutor","to":"CrewAIEngineService","relationType":"coordinates_with"}
{"type":"relation","from":"CrewAIEngineService","to":"LLM_Manager","relationType":"depends_on"}
{"type":"relation","from":"LLM_Manager","to":"Databricks_Integration","relationType":"integrates_with"}
{"type":"relation","from":"FastAPI_Backend","to":"Clean_Architecture","relationType":"implements"}
{"type":"relation","from":"CrewAI_Memory","to":"Databricks_Integration","relationType":"stores_in"}
{"type":"relation","from":"CrewAI_Knowledge","to":"Databricks_Integration","relationType":"retrieves_from"}
{"type":"relation","from":"Kasal","to":"ServiceArchitecturePattern","relationType":"implements"}
{"type":"relation","from":"ServiceArchitecturePattern","to":"UnitOfWorkPattern","relationType":"uses"}
{"type":"relation","from":"ServiceArchitecturePattern","to":"DependencyInjectionPattern","relationType":"uses"}
{"type":"relation","from":"ServiceArchitecturePattern","to":"RepositoryPattern","relationType":"uses"}
{"type":"relation","from":"Backend","to":"ServiceArchitecturePattern","relationType":"implements"}
{"type":"relation","from":"FastAPI_Backend","to":"ServiceArchitecturePattern","relationType":"implements"}
{"type":"relation","from":"Clean_Architecture","to":"ServiceArchitecturePattern","relationType":"realized_by"}
{"type":"relation","from":"RepositoryPattern","to":"BaseRepository","relationType":"implemented_by"}
{"type":"relation","from":"BaseService","to":"UnitOfWorkPattern","relationType":"implements"}
{"type":"relation","from":"BaseService","to":"DependencyInjectionPattern","relationType":"uses"}
{"type":"relation","from":"BaseRepository","to":"AsyncOperations","relationType":"implements"}