"use strict";(self.webpackChunkfrontend=self.webpackChunkfrontend||[]).push([[818],{48847:(e,t,n)=>{n.r(t),n.d(t,{default:()=>Br});var a=n(89379),s=n(80045),i=n(9950),o=(n(522),n(16491)),r=n(63464),l=n(28170),d=n(92649),c=n(82053),u=n(25333),h=n(4862),m=n(65429),p=n(70610),x=n(18216),g=n(60788),f=n(19597);const v=()=>(()=>{const{currentTheme:e,isDarkMode:t,toggleTheme:n,changeTheme:a}=(0,f.C)();return{currentTheme:e,isDarkMode:t,toggleTheme:n,changeTheme:a}})();var A=n(9992),y=n(67818);var b=n(2257),j=n(19458),w=n(11758),k=n(67956);const C=(0,j.vt)()((0,w.Zr)((e,t)=>({tabs:[],activeTabId:null,createTab:n=>{const s=(0,k.A)(),i=n||"Canvas ".concat(t().tabs.length+1),o={id:s,name:i,nodes:[],edges:[],isActive:!0,isDirty:!1,createdAt:new Date,lastModified:new Date,chatSessionId:(0,k.A)()};return e(e=>({tabs:[...e.tabs.map(e=>(0,a.A)((0,a.A)({},e),{},{isActive:!1})),o],activeTabId:s})),setTimeout(()=>{window.dispatchEvent(new CustomEvent("clearCanvas",{detail:{tabId:s}}))},0),s},closeTab:t=>{e(e=>{const n=e.tabs.findIndex(e=>e.id===t);if(-1===n)return e;const a=e.tabs.filter(e=>e.id!==t);let s=e.activeTabId;if(e.activeTabId===t)if(a.length>0){var i;s=(null===(i=a[n>0?n-1:0])||void 0===i?void 0:i.id)||null,a.forEach(e=>{e.isActive=e.id===s})}else s=null;return{tabs:a,activeTabId:s}})},setActiveTab:t=>{e(e=>({tabs:e.tabs.map(e=>(0,a.A)((0,a.A)({},e),{},{isActive:e.id===t})),activeTabId:t}))},updateTabName:(t,n)=>{e(e=>({tabs:e.tabs.map(e=>e.id===t?(0,a.A)((0,a.A)({},e),{},{name:n,lastModified:new Date}):e)}))},updateTabNodes:(t,n)=>{e(e=>{const s=e.tabs.find(e=>e.id===t);if(!s)return e;const i=((e,t)=>{if(e.length!==t.length)return!0;const n=new Map(e.map(e=>[e.id,e])),a=new Map(t.map(e=>[e.id,e]));if(n.size!==a.size)return!0;for(const s of t){const e=n.get(s.id);if(!e)return!0;if(e.type!==s.type||Math.abs(e.position.x-s.position.x)>.1||Math.abs(e.position.y-s.position.y)>.1||JSON.stringify(e.data)!==JSON.stringify(s.data))return!0}return!1})(s.nodes,n),o=i&&(!s.savedCrewId||s.isDirty),r=i&&s.executionStatus;return{tabs:e.tabs.map(e=>e.id===t?(0,a.A)((0,a.A)({},e),{},{nodes:n.map(e=>(0,a.A)((0,a.A)({},e),{},{position:(0,a.A)({},e.position),data:(0,a.A)({},e.data)})),isDirty:o,lastModified:new Date,executionStatus:r?void 0:e.executionStatus,lastExecutionTime:r?void 0:e.lastExecutionTime}):e)}})},updateTabEdges:(t,n)=>{e(e=>{const s=e.tabs.find(e=>e.id===t);if(!s)return e;const i=((e,t)=>{if(e.length!==t.length)return!0;const n=new Map(e.map(e=>[e.id,e])),a=new Map(t.map(e=>[e.id,e]));if(n.size!==a.size)return!0;for(const s of t){const e=n.get(s.id);if(!e)return!0;if(e.source!==s.source||e.target!==s.target||e.type!==s.type||JSON.stringify(e.data)!==JSON.stringify(s.data))return!0}return!1})(s.edges,n),o=i&&(!s.savedCrewId||s.isDirty),r=i&&s.executionStatus;return{tabs:e.tabs.map(e=>e.id===t?(0,a.A)((0,a.A)({},e),{},{edges:n.map(e=>(0,a.A)((0,a.A)({},e),{},{data:e.data?(0,a.A)({},e.data):void 0})),isDirty:o,lastModified:new Date,executionStatus:r?void 0:e.executionStatus,lastExecutionTime:r?void 0:e.lastExecutionTime}):e)}})},markTabDirty:t=>{e(e=>({tabs:e.tabs.map(e=>e.id===t?(0,a.A)((0,a.A)({},e),{},{isDirty:!0,lastModified:new Date}):e)}))},markTabClean:t=>{e(e=>({tabs:e.tabs.map(e=>e.id===t?(0,a.A)((0,a.A)({},e),{},{isDirty:!1}):e)}))},duplicateTab:n=>{const s=t().getTab(n);if(!s)return"";const i=(0,k.A)(),o={id:i,name:"".concat(s.name," (Copy)"),nodes:s.nodes.map(e=>(0,a.A)((0,a.A)({},e),{},{id:(0,k.A)(),selected:!1})),edges:s.edges.map(e=>(0,a.A)((0,a.A)({},e),{},{id:(0,k.A)(),selected:!1})),isActive:!0,isDirty:!0,createdAt:new Date,lastModified:new Date,savedCrewId:void 0,savedCrewName:void 0,lastSavedAt:void 0,chatSessionId:(0,k.A)()},r=new Map;return s.nodes.forEach((e,t)=>{r.set(e.id,o.nodes[t].id)}),o.edges=o.edges.map(e=>(0,a.A)((0,a.A)({},e),{},{source:r.get(e.source)||e.source,target:r.get(e.target)||e.target})),e(e=>({tabs:[...e.tabs.map(e=>(0,a.A)((0,a.A)({},e),{},{isActive:!1})),o],activeTabId:i})),i},getActiveTab:()=>{const e=t();return e.tabs.find(t=>t.id===e.activeTabId)||null},getTab:e=>t().tabs.find(t=>t.id===e)||null,clearAllTabs:()=>{e({tabs:[],activeTabId:null})},updateTabCrewInfo:(t,n,s)=>{e(e=>({tabs:e.tabs.map(e=>e.id===t?(0,a.A)((0,a.A)({},e),{},{savedCrewId:n,savedCrewName:s,lastSavedAt:new Date,isDirty:!1,name:s}):e)}))},clearTabCrewInfo:t=>{e(e=>({tabs:e.tabs.map(e=>e.id===t?(0,a.A)((0,a.A)({},e),{},{savedCrewId:void 0,savedCrewName:void 0,lastSavedAt:void 0}):e)}))},isTabSaved:e=>{const n=t().getTab(e);return!!n&&(!n.isDirty&&!!n.savedCrewId)},updateTabExecutionStatus:(t,n)=>{e(e=>({tabs:e.tabs.map(e=>e.id===t?(0,a.A)((0,a.A)({},e),{},{executionStatus:n,lastExecutionTime:new Date}):e)}))},clearTabExecutionStatus:t=>{e(e=>({tabs:e.tabs.map(e=>e.id===t?(0,a.A)((0,a.A)({},e),{},{executionStatus:void 0,lastExecutionTime:void 0}):e)}))}}),{name:"tab-manager-storage",partialize:e=>({tabs:e.tabs.map(e=>{var t,n;return(0,a.A)((0,a.A)({},e),{},{createdAt:e.createdAt.toISOString(),lastModified:e.lastModified.toISOString(),lastSavedAt:null===(t=e.lastSavedAt)||void 0===t?void 0:t.toISOString(),lastExecutionTime:null===(n=e.lastExecutionTime)||void 0===n?void 0:n.toISOString(),executionStatus:"running"===e.executionStatus?void 0:e.executionStatus})}),activeTabId:e.activeTabId}),onRehydrateStorage:()=>e=>{e&&(e.tabs=e.tabs.map(e=>(0,a.A)((0,a.A)({},e),{},{createdAt:new Date(e.createdAt),lastModified:new Date(e.lastModified),lastSavedAt:e.lastSavedAt?new Date(e.lastSavedAt):void 0,lastExecutionTime:e.lastExecutionTime?new Date(e.lastExecutionTime):void 0})))}}));var S=n(77679);const _=e=>{let{nodes:t,edges:n,setNodes:s,setEdges:o}=e;const{activeTabId:r,getActiveTab:l,updateTabNodes:d,updateTabEdges:c,updateTabCrewInfo:u}=C(),h=(0,i.useRef)(!1),m=(0,i.useRef)(!1),p=(0,i.useRef)(null),x=(0,i.useRef)([]),g=(0,i.useRef)([]);(0,i.useEffect)(()=>{m.current||(x.current=t,g.current=n)},[t,n]);const f=(0,i.useCallback)((e,t,n)=>{e&&!h.current&&(d(e,t),c(e,n))},[d,c]);(0,i.useEffect)(()=>{if(r!==p.current){if(h.current)return void(p.current=r);p.current&&!h.current&&f(p.current,x.current,g.current),m.current=!0;const e=l();if(e){const t=e.nodes.map(e=>(0,a.A)((0,a.A)({},e),{},{position:(0,a.A)({},e.position),data:(0,a.A)({},e.data)})),n=e.edges.map(e=>(0,a.A)((0,a.A)({},e),{},{data:e.data?(0,a.A)({},e.data):void 0}));h.current||(s(t),o(n),x.current=t,g.current=n,0===t.length&&0===n.length&&setTimeout(()=>{s([]),o([]),x.current=[],g.current=[]},50),setTimeout(()=>{t.length>0&&window.dispatchEvent(new CustomEvent("fitViewToNodes",{bubbles:!0}))},300),setTimeout(()=>{window.dispatchEvent(new CustomEvent("updateReactFlowInstance",{detail:{nodes:t,edges:n}}))},100)),setTimeout(()=>{m.current=!1},500)}p.current=r}},[r,l,s,o,f]);const v=(0,i.useCallback)(()=>{!r||h.current||m.current||f(r,x.current,g.current)},[r,f]);(0,i.useEffect)(()=>{const e=()=>{r&&f(r,x.current,g.current)};return window.addEventListener("beforeunload",e),()=>{window.removeEventListener("beforeunload",e)}},[r,f]);const A=(0,i.useCallback)(()=>{if(r&&!h.current&&!m.current){const e=l();e&&((e,t)=>{if(e.length!==t.length)return!0;const n=new Map(e.map(e=>[e.id,e]));for(const a of t){const e=n.get(a.id);if(!e)return!0;if(e.type!==a.type||Math.abs(e.position.x-a.position.x)>.1||Math.abs(e.position.y-a.position.y)>.1||JSON.stringify(e.data)!==JSON.stringify(a.data))return!0}return!1})(e.nodes,t)&&d(r,t)}},[t,r,d,l]),y=(0,i.useCallback)(()=>{if(r&&!h.current&&!m.current){const e=l();e&&((e,t)=>{if(e.length!==t.length)return!0;const n=new Map(e.map(e=>[e.id,e]));for(const a of t){const e=n.get(a.id);if(!e)return!0;if(e.source!==a.source||e.target!==a.target||e.type!==a.type||JSON.stringify(e.data)!==JSON.stringify(a.data))return!0}return!1})(e.edges,n)&&c(r,n)}},[n,r,c,l]);return(0,i.useEffect)(()=>{const e=setTimeout(A,300);return()=>clearTimeout(e)},[A]),(0,i.useEffect)(()=>{const e=setTimeout(y,300);return()=>clearTimeout(e)},[y]),(0,i.useEffect)(()=>{const e=e=>{if(e.detail){const{crewId:t,crewName:n,tabId:a}=e.detail,s=a||r;s&&t&&n&&!h.current?u(s,t,n):h.current}};return window.addEventListener("saveCrewComplete",e),()=>{window.removeEventListener("saveCrewComplete",e)}},[r,u]),(0,i.useEffect)(()=>{const e=()=>{h.current=!0},t=()=>{setTimeout(()=>{h.current=!1},200)};return window.addEventListener("crewLoadStarted",e),window.addEventListener("crewLoadCompleted",t),()=>{window.removeEventListener("crewLoadStarted",e),window.removeEventListener("crewLoadCompleted",t)}},[]),(0,i.useEffect)(()=>{const e=e=>{e.detail.tabId===r&&(s([]),o([]))};return window.addEventListener("clearCanvas",e),()=>{window.removeEventListener("clearCanvas",e)}},[r,s,o]),{activeTabId:r,getActiveTab:l,saveCurrentState:v}};var E=n(36873);function I(e){const[t,n]=i.useState(!1),a=i.useRef(0),s=i.useCallback(e=>{e.preventDefault(),n(!0)},[]),o=i.useCallback(n=>{if(!t)return;const s=performance.now();if(s-(a.current||0)<50)return;a.current=s;const i=window.innerWidth-n.clientX-48,o=Math.min(800,.6*window.innerWidth);e(Math.min(Math.max(i,280),o));const r=new CustomEvent("recalculateNodePositions",{detail:{reason:"chat-panel-resizing"}});window.dispatchEvent(r)},[t,e]),r=i.useCallback(()=>{n(!1),setTimeout(()=>{const e=new CustomEvent("recalculateNodePositions",{detail:{reason:"chat-panel-resize"}});window.dispatchEvent(e)},50)},[]);return i.useEffect(()=>{if(t)return document.addEventListener("mousemove",o),document.addEventListener("mouseup",r),document.body.style.cursor="ew-resize",document.body.style.userSelect="none",()=>{document.removeEventListener("mousemove",o),document.removeEventListener("mouseup",r),document.body.style.cursor="",document.body.style.userSelect=""}},[t,o,r]),{handleResizeStart:s}}function T(e,t){const[n,a]=i.useState(!1),s=i.useRef(0),o=i.useCallback(e=>{e.preventDefault(),a(!0)},[]),r=i.useCallback(t=>{if(!n)return;const a=performance.now();if(a-(s.current||0)<50)return;s.current=a;const i=window.innerHeight-t.clientY,o=Math.min(500,.5*window.innerHeight);e(Math.min(Math.max(i,100),o))},[n,e]),l=i.useCallback(()=>{a(!1),t(!0)},[t]);return i.useEffect(()=>{if(n)return document.addEventListener("mousemove",r),document.addEventListener("mouseup",l),document.body.style.cursor="ns-resize",document.body.style.userSelect="none",()=>{document.removeEventListener("mousemove",r),document.removeEventListener("mouseup",l),document.body.style.cursor="",document.body.style.userSelect=""}},[n,r,l]),{handleHistoryResizeStart:o}}var D=n(96319),N=n(59254),P=n(83274),M=n(62145),z=n(80392),O=n(44414);const L=(0,N.Ay)(u.A)(e=>{let{theme:t}=e;return{backgroundColor:"dark"===t.palette.mode?"rgba(255,255,255,0.08)":"rgba(0,0,0,0.04)",borderRadius:"4px",padding:"4px","&:hover":{backgroundColor:"dark"===t.palette.mode?"rgba(255,255,255,0.15)":"rgba(0,0,0,0.08)"}}}),F=(0,N.Ay)(o.A)(e=>{let{theme:t}=e;return{position:"absolute",zIndex:10,display:"flex",alignItems:"center",justifyContent:"center",backgroundColor:"dark"===t.palette.mode?"rgba(0,0,0,0.6)":"rgba(255,255,255,0.8)",borderRadius:"4px",padding:"2px",boxShadow:"0 1px 3px rgba(0,0,0,0.2)"}}),W=e=>{let{isVisible:t,togglePanel:n,tooltip:a}=e;return(0,O.jsx)(F,{sx:{top:"50%",right:t?"auto":0,left:t?"calc(100% - 24px)":"auto",transform:"translateY(-50%)",transition:"left 0.3s ease, right 0.3s ease"},children:(0,O.jsx)(P.A,{title:a,children:(0,O.jsx)(L,{onClick:n,size:"small",children:t?(0,O.jsx)(z.A,{fontSize:"small"}):(0,O.jsx)(M.A,{fontSize:"small"})})})})};var R=n(25277),V=n(8145),B=n(79739),U=n(86835),H=n(53256);const K=e=>{let{open:t,onClose:n,onConfirm:s,nodes:h}=e;const[p,g]=(0,i.useState)([]),[f,v]=(0,i.useState)([]),[A,y]=(0,i.useState)({});(0,i.useEffect)(()=>{if(!t)return;const e=/\{([^}]+)\}/g,n=new Set;h.forEach(t=>{if("agentNode"===t.type||"taskNode"===t.type){const a=t.data;[a.role,a.goal,a.backstory,a.description,a.expected_output,a.label].forEach(t=>{if(t&&"string"===typeof t){let a;for(;null!==(a=e.exec(t));)n.add(a[1])}})}});const a=Array.from(n);v(a),0===p.length&&a.length>0&&g(a.map(e=>({name:e,value:""})))},[t,h,p.length]);const b=(e,t,n)=>{const s=[...p];if(s[e]=(0,a.A)((0,a.A)({},s[e]),{},{[t]:n}),g(s),"value"===t&&n){const t=(0,a.A)({},A);delete t[s[e].name],y(t)}};return(0,O.jsxs)(r.A,{open:t,onClose:n,maxWidth:"md",fullWidth:!0,children:[(0,O.jsx)(d.A,{children:(0,O.jsxs)(o.A,{display:"flex",alignItems:"center",justifyContent:"space-between",children:[(0,O.jsx)(c.A,{variant:"h6",children:"Input Variables"}),(0,O.jsx)(u.A,{onClick:n,size:"small",children:(0,O.jsx)(U.A,{})})]})}),(0,O.jsxs)(l.A,{children:[f.length>0&&(0,O.jsx)(m.A,{severity:"info",sx:{mb:2},children:(0,O.jsxs)(o.A,{display:"flex",alignItems:"center",gap:1,children:[(0,O.jsx)(c.A,{variant:"body2",children:"Detected variables in your workflow:"}),f.map(e=>(0,O.jsx)(R.A,{label:"{".concat(e,"}"),size:"small",color:"primary"},e))]})}),(0,O.jsxs)(o.A,{sx:{mt:2},children:[(0,O.jsx)(c.A,{variant:"subtitle2",gutterBottom:!0,children:"Define values for variables used in your agents and tasks:"}),p.map((e,t)=>(0,O.jsxs)(o.A,{sx:{display:"flex",gap:1,mb:2,alignItems:"flex-start"},children:[(0,O.jsx)(V.A,{label:"Variable Name",value:e.name,onChange:e=>b(t,"name",e.target.value),size:"small",sx:{flex:1},error:!!A[e.name],disabled:f.includes(e.name)}),(0,O.jsx)(V.A,{label:"Value",value:e.value,onChange:e=>b(t,"value",e.target.value),size:"small",sx:{flex:2},error:!!A[e.name],helperText:A[e.name],required:f.includes(e.name)}),!f.includes(e.name)&&(0,O.jsx)(u.A,{onClick:()=>(e=>{const t=p.filter((t,n)=>n!==e);g(t)})(t),size:"small",color:"error",children:(0,O.jsx)(U.A,{})})]},t)),(0,O.jsx)(x.A,{startIcon:(0,O.jsx)(H.A,{}),onClick:()=>{g([...p,{name:"",value:""}])},variant:"outlined",size:"small",sx:{mt:1},children:"Add Custom Variable"})]}),(0,O.jsxs)(m.A,{severity:"info",sx:{mt:3},children:[(0,O.jsx)(c.A,{variant:"body2",children:(0,O.jsx)("strong",{children:"How to use variables:"})}),(0,O.jsxs)(c.A,{variant:"body2",component:"ul",sx:{mt:1,pl:2},children:[(0,O.jsxs)("li",{children:["Use ","{variable_name}"," syntax in agent roles, goals, backstories, and task descriptions"]}),(0,O.jsx)("li",{children:"Variables will be replaced with the values you provide here during execution"}),(0,O.jsxs)("li",{children:["Example: ",'"Analyze {topic} trends in {industry}"'," \u2192 ",'"Analyze AI trends in Healthcare"']})]})]})]}),(0,O.jsxs)(B.A,{children:[(0,O.jsx)(x.A,{onClick:n,children:"Cancel"}),(0,O.jsx)(x.A,{onClick:()=>{const e={};let t=!1;if(f.forEach(n=>{const a=p.find(e=>e.name===n);a&&a.value||(e[n]="This variable is required",t=!0)}),t)return void y(e);const n={};p.forEach(e=>{e.name&&e.value&&(n[e.name]=e.value)}),s(n)},variant:"contained",color:"primary",children:"Execute with Variables"})]})]})};var G=n(85668),J=n(82570),q=n(57988),Y=n(7999),X=n(7626),Z=n(51260),Q=n(83716),$=n(79708),ee=n(48089),te=n(74763),ne=n(2046),ae=n(74616),se=n(46986),ie=n(23165),oe=n(25979),re=n(19647),le=n(70006),de=n(23266),ce=n(60899),ue=n(46639),he=n(16497),me=n(37324),pe=n(18726),xe=n(98424),ge=n(87305),fe=n(39582),ve=n(29478),Ae=n(29246),ye=n(27887);class be{static async generateAgent(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];try{const a=n.map(e=>String(e));return(await ye.Ay.post("/agent-generation/generate",{prompt:e,model:t||"gpt-4o-mini",tools:a})).data}catch(a){return null}}static async generateTask(e,t){try{return(await ye.Ay.post("/task-generation/generate-task",{text:e.trim(),model:t||void 0},{headers:{"Content-Type":"application/json"}})).data}catch(n){return null}}static async generateTemplates(e){try{return(await ye.Ay.post("/template-generation/generate-templates",e,{headers:{"Content-Type":"application/json",Accept:"application/json"},transformResponse:[e=>{const t=JSON.parse(e);if("system_template"in t)return t;return{system_template:t["System Template"]||t.system_template||"",prompt_template:t["Prompt Template"]||t.prompt_template||"",response_template:t["Response Template"]||t.response_template||""}}]})).data}catch(n){var t;if(Ae.A.isAxiosError(n))null!==(t=n.response)&&void 0!==t&&null!==(t=t.data)&&void 0!==t&&t.detail;return null}}}const je="default_memory_backend_config";class we{constructor(){}static getInstance(){return we.instance||(we.instance=new we),we.instance}getDefaultConfig(){const e=localStorage.getItem(je);if(e)try{return JSON.parse(e)}catch(t){return null}return null}setDefaultConfig(e){localStorage.setItem(je,JSON.stringify(e))}clearDefaultConfig(){localStorage.removeItem(je)}hasDefaultConfig(){return null!==localStorage.getItem(je)}}we.instance=void 0;var ke=n(27721),Ce=n(21816),Se=n(77922),_e=n(2235),Ee=n(19223),Ie=n(7762),Te=n(30444),De=n(79606);class Ne{static async getSpaces(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:50;try{const n={page_size:t};e&&(n.page_token=e);return(await ye.uE.get("/api/genie/spaces",{params:n})).data}catch(n){return{spaces:[]}}}static async searchSpaces(e){try{return(await ye.uE.post("/api/genie/spaces/search",e)).data}catch(t){return{spaces:[]}}}static async getSpaceDetails(e){try{return(await ye.uE.get("/api/genie/spaces/".concat(e))).data}catch(t){throw t}}static formatSpaceName(e){return e.description?"".concat(e.name," - ").concat(e.description):e.name}static getDefaultSpaceId(){return"01efdd2cd03211d0ab74f620f0023b77"}}const Pe=["key"],Me=e=>{let{value:t,onChange:n,multiple:r=!1,label:l="Genie Space",placeholder:d="Search for Genie spaces...",disabled:h=!1,required:m=!1,helperText:p,error:x=!1,fullWidth:g=!0,toolId:f}=e;const[v,A]=(0,i.useState)(!1),[y,b]=(0,i.useState)([]),[j,w]=(0,i.useState)(null),[k,C]=(0,i.useState)(""),[S,_]=(0,i.useState)(!1),[E,I]=(0,i.useState)(!0),[T,D]=(0,i.useState)(void 0),[N,M]=(0,i.useState)(""),[z,L]=(0,i.useState)([]),F=(0,i.useRef)(!1),W=(0,i.useRef)(null);(0,i.useEffect)(()=>{const e=localStorage.getItem("pinnedGenieSpaces");if(e)try{L(JSON.parse(e))}catch(t){}},[]);const B=e=>{L(e),localStorage.setItem("pinnedGenieSpaces",JSON.stringify(e))},U=e=>{z.includes(e)?B(z.filter(t=>t!==e)):B([...z,e])};(0,i.useEffect)(()=>{(async()=>{if(t){if(r&&Array.isArray(t)){const e=y.filter(e=>t.includes(e.id));w(e.length>0?e:null)}else if(!r&&"string"===typeof t){let e=y.find(e=>e.id===t);if(!e&&t)try{const n=await Ne.searchSpaces({search_query:t,page_size:10,enabled_only:!1});e=n.spaces.find(e=>e.id===t),e&&b(t=>t.some(t=>t.id===e.id)?t:[...t,e])}catch(x){}w(e||null)}}else w(null)})()},[t,r]);const H=async function(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(!F.current||!n)try{let a;F.current=n,n||_(!0),a=e?await Ne.searchSpaces({search_query:e,page_token:t,page_size:50,enabled_only:!0}):await Ne.getSpaces(t,50),b(n?e=>[...e,...a.spaces]:a.spaces),D(a.next_page_token),I(a.has_more||!1)}catch(x){}finally{_(!1),F.current=!1}},K=e=>{const t=e.currentTarget,n=t.scrollTop;t.scrollHeight-n<=1.5*t.clientHeight&&E&&!F.current&&H(N,T,!0)};(0,i.useEffect)(()=>{t&&0===y.length&&!S&&H(),v&&0===y.length&&!S&&H()},[v,y.length,t]),(0,i.useEffect)(()=>()=>{W.current&&clearTimeout(W.current)},[]);const G=i.useMemo(()=>[...y].sort((e,t)=>{const n=z.includes(e.id),a=z.includes(t.id);return n&&!a?-1:!n&&a?1:0}),[y,z]),J=i.forwardRef((e,t)=>(0,O.jsx)("ul",(0,a.A)((0,a.A)({},e),{},{ref:t,onScroll:K,style:{maxHeight:300,overflow:"auto"}})));return J.displayName="ListboxComponent",(0,O.jsx)(Se.A,{multiple:r,open:v,onOpen:()=>A(!0),onClose:()=>A(!1),value:j,onChange:(e,t)=>{w(t),r&&Array.isArray(t)?n(t.map(e=>e.id)):r||!t||Array.isArray(t)?n(null):n(t.id,t.name)},inputValue:k,onInputChange:(e,t)=>{C(t),v&&(W.current&&clearTimeout(W.current),W.current=setTimeout(()=>{M(t),D(void 0),H(t)},300))},options:G,loading:S,loadingText:"Loading spaces...",noOptionsText:S?"Loading spaces...":k?'No spaces found matching "'.concat(k,'"'):"Start typing to search for spaces",getOptionLabel:e=>e.name,isOptionEqualToValue:(e,t)=>e.id===t.id,renderOption:(e,t)=>{const n=z.includes(t.id);return(0,O.jsxs)(o.A,(0,a.A)((0,a.A)({component:"li"},e),{},{sx:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[(0,O.jsxs)(o.A,{sx:{flex:1},children:[(0,O.jsx)(c.A,{variant:"body2",children:t.name}),t.description&&(0,O.jsx)(c.A,{variant:"caption",color:"text.secondary",children:t.description})]}),(0,O.jsx)(P.A,{title:n?"Unpin space":"Pin space",children:(0,O.jsx)(u.A,{size:"small",onClick:e=>{e.stopPropagation(),U(t.id)},sx:{ml:1},children:n?(0,O.jsx)(Te.A,{fontSize:"small"}):(0,O.jsx)(De.A,{fontSize:"small"})})})]}))},ListboxComponent:J,disabled:h,fullWidth:g,renderInput:e=>(0,O.jsx)(V.A,(0,a.A)((0,a.A)({},e),{},{label:l,placeholder:d,required:m,error:x,helperText:p,InputProps:(0,a.A)((0,a.A)({},e.InputProps),{},{startAdornment:(0,O.jsxs)(O.Fragment,{children:[(0,O.jsx)(ne.A,{position:"start",children:(0,O.jsx)(Ee.A,{})}),e.InputProps.startAdornment]}),endAdornment:(0,O.jsxs)(O.Fragment,{children:[S?(0,O.jsx)(ue.A,{color:"inherit",size:20}):null,!r&&j&&!Array.isArray(j)&&(0,O.jsxs)(o.A,{sx:{display:"flex",alignItems:"center",mr:1},children:[(0,O.jsx)(P.A,{title:z.includes(j.id)?"Unpin space":"Pin space",children:(0,O.jsx)(u.A,{size:"small",onClick:e=>{e.stopPropagation(),U(j.id)},children:z.includes(j.id)?(0,O.jsx)(Te.A,{fontSize:"small",color:"primary"}):(0,O.jsx)(De.A,{fontSize:"small"})})}),(0,O.jsx)(P.A,{title:"Clear selection",children:(0,O.jsx)(u.A,{size:"small",onClick:e=>{e.stopPropagation(),w(null),n(null),C("")},children:(0,O.jsx)(Ie.A,{fontSize:"small"})})})]}),e.InputProps.endAdornment]})})})),renderTags:(e,t)=>e.map((e,n)=>{const i=t({index:n}),{key:o}=i,r=(0,s.A)(i,Pe);return(0,O.jsx)(R.A,(0,a.A)((0,a.A)({label:e.name},r),{},{size:"small"}),o||e.id)}),PaperComponent:e=>(0,O.jsxs)(_e.A,(0,a.A)((0,a.A)({},e),{},{children:[e.children,F.current&&(0,O.jsx)(o.A,{display:"flex",justifyContent:"center",p:1,children:(0,O.jsx)(ue.A,{size:20})})]}))})};var ze=n(2660),Oe=n(67991),Le=n(13062);class Fe{static getInstance(){return Fe.instance||(Fe.instance=new Fe),Fe.instance}async isDatabricksEnabled(){try{var e;const t=ke.O.getInstance(),n=await t.getDatabricksConfig();return null!==(e=null===n||void 0===n?void 0:n.enabled)&&void 0!==e&&e}catch(t){return!1}}async getAPIKeys(){try{return(await ye.Ay.get("/api-keys")).data}catch(t){if(t instanceof Le.pe){var e;const n=(null===(e=t.response)||void 0===e||null===(e=e.data)||void 0===e?void 0:e.detail)||"Failed to load API keys";throw new Error(n)}throw new Error("Failed to connect to the server")}}async getDatabricksSecrets(){try{if(!await this.isDatabricksEnabled())return[];return(await ye.Ay.get("/databricks-secrets")).data}catch(t){if(t instanceof Le.pe){var e;const n=(null===(e=t.response)||void 0===e||null===(e=e.data)||void 0===e?void 0:e.detail)||"Failed to load Databricks secrets";throw new Error(n)}throw new Error("Failed to connect to the server")}}async createAPIKey(e){try{return(await ye.Ay.post("/api-keys",e)).data}catch(n){if(n instanceof Le.pe){var t;const e=(null===(t=n.response)||void 0===t||null===(t=t.data)||void 0===t?void 0:t.detail)||"Failed to create API key";throw new Error(e)}throw new Error("Failed to connect to the server")}}async createDatabricksSecret(e){try{return(await ye.Ay.post("/databricks-secrets",e)).data}catch(n){if(n instanceof Le.pe){var t;const e=(null===(t=n.response)||void 0===t||null===(t=t.data)||void 0===t?void 0:t.detail)||"Failed to create Databricks secret";throw new Error(e)}throw new Error("Failed to connect to the server")}}async updateAPIKey(e,t){try{return(await ye.Ay.put("/api-keys/".concat(e),t)).data}catch(a){if(a instanceof Le.pe){var n;const e=(null===(n=a.response)||void 0===n||null===(n=n.data)||void 0===n?void 0:n.detail)||"Failed to update API key";throw new Error(e)}throw new Error("Failed to connect to the server")}}async updateDatabricksSecret(e,t){try{return(await ye.Ay.put("/databricks-secrets/".concat(e),t)).data}catch(a){if(a instanceof Le.pe){var n;const e=(null===(n=a.response)||void 0===n||null===(n=n.data)||void 0===n?void 0:n.detail)||"Failed to update Databricks secret";throw new Error(e)}throw new Error("Failed to connect to the server")}}async deleteAPIKey(e){try{return(await ye.Ay.delete("/api-keys/".concat(e))).data}catch(n){if(n instanceof Le.pe){var t;const e=(null===(t=n.response)||void 0===t||null===(t=t.data)||void 0===t?void 0:t.detail)||"Failed to delete API key";throw new Error(e)}throw new Error("Failed to connect to the server")}}async deleteDatabricksSecret(e){try{return(await ye.Ay.delete("/databricks-secrets/".concat(e))).data}catch(n){if(n instanceof Le.pe){var t;const e=(null===(t=n.response)||void 0===t||null===(t=t.data)||void 0===t?void 0:t.detail)||"Failed to delete Databricks secret";throw new Error(e)}throw new Error("Failed to connect to the server")}}async setDatabricksToken(e,t){try{if(!e)throw new Error("Databricks workspace URL is required");const n={workspace_url:e,token:t};await ye.Ay.post("/databricks/token",n)}catch(a){if(a instanceof Le.pe){var n;const e=(null===(n=a.response)||void 0===n||null===(n=n.data)||void 0===n?void 0:n.detail)||"Failed to set Databricks token";throw new Error(e)}throw new Error("Failed to connect to the server")}}}Fe.instance=void 0;class We{static async getCrews(){try{return(await ye.uE.get("/crews")).data}catch(e){throw e}}static async getCrew(e){try{return(await ye.uE.get("/crews/".concat(e))).data}catch(t){throw t}}static async getTasks(e){try{const t=(await ye.uE.get("/crews/".concat(e))).data;let n=[];if(t.nodes&&Array.isArray(t.nodes)){t.nodes.filter(e=>"taskNode"===e.type||e.data&&"object"===typeof e.data&&"taskId"in e.data).forEach(t=>{if(t.data&&"object"===typeof t.data){var a,s;const i=String(t.data.taskId||t.data.id||t.id);n.push({id:i,name:String(t.data.label||t.data.name||"Unnamed Task"),description:String(t.data.description||""),expected_output:String(t.data.expected_output||""),agent_id:String(e),tools:Array.isArray(t.data.tools)?t.data.tools:[],context:Array.isArray(t.data.context)?t.data.context:[],markdown:!0===(null===(a=t.data.config)||void 0===a?void 0:a.markdown)||"true"===(null===(s=t.data.config)||void 0===s?void 0:s.markdown)})}})}return t.tasks&&Array.isArray(t.tasks)&&t.tasks.forEach(t=>{if(t.data){var a,s;const i=String(t.id);n.push({id:i,name:String(t.data.name||t.data.label||"Unnamed Task"),description:String(t.data.description||""),expected_output:String(t.data.expected_output||""),agent_id:String(e),tools:Array.isArray(t.data.tools)?t.data.tools:[],context:Array.isArray(t.data.context)?t.data.context:[],markdown:!0===(null===(a=t.data.config)||void 0===a?void 0:a.markdown)||"true"===(null===(s=t.data.config)||void 0===s?void 0:s.markdown)})}}),n=n.filter(e=>!String(e.id).startsWith("agent-")),n}catch(t){return[]}}static async saveCrew(e){try{const t=e=>{if("object"!==typeof e||null===e)return"boolean"===typeof e?String(e):e;if(Array.isArray(e))return e.map(e=>t(e));const n={};for(const[a,s]of Object.entries(e))"knowledge_sources"===a&&Array.isArray(s)?n[a]=s.map(e=>{if(e&&"object"===typeof e){return t(e)}return e}):n[a]="tool_configs"===a&&null!==s&&"object"===typeof s?s:"taskId"!==a&&"agentId"!==a||null===s?"object"===typeof s&&null!==s?t(s):"boolean"===typeof s?String(s):s:String(s);return n},n=e.nodes.filter(e=>"agentNode"===e.type),a=e.nodes.filter(e=>"taskNode"===e.type),s=n.map(e=>{var t;if(null!==(t=e.data)&&void 0!==t&&t.agentId)return String(e.data.agentId);if(e.id){if(e.id.startsWith("agent-")){const t=e.id.split("agent-");if(t.length>1)return t[1]}return e.id}return null}).filter(Boolean),i=a.map(e=>{var t;if(null!==(t=e.data)&&void 0!==t&&t.taskId)return String(e.data.taskId);if(e.id){if(e.id.startsWith("task-")){const t=e.id.split("task-");if(t.length>1)return t[1]}return e.id}return null}).filter(Boolean),o=e.nodes.map(e=>{e.data||(e.data={label:e.id}),e.data.label&&"string"===typeof e.data.label||(e.data.label=e.id),e.data.tools&&Array.isArray(e.data.tools)||(e.data.tools=[]),e.data.context&&Array.isArray(e.data.context)||(e.data.context=[]),void 0===e.data.async_execution?e.data.async_execution="false":e.data.async_execution=String(e.data.async_execution),"agentNode"===e.type&&(e.data.knowledge_sources,e.data.tool_configs),"taskNode"===e.type&&e.data.tool_configs;const n={id:e.id,type:e.type,position:{x:e.position.x,y:e.position.y},data:t(e.data)};if("agentNode"===e.type){e.data.knowledge_sources,e.data.tool_configs}if("taskNode"===e.type&&e.data.tool_configs){}return n}),r=e.edges.map(e=>({id:e.id,source:e.source,target:e.target})),l={name:e.name,agent_ids:s,task_ids:i,nodes:o,edges:r},d=(await ye.uE.post("/crews",l)).data;return{id:d.id.toString(),name:d.name,agent_ids:d.agent_ids,task_ids:d.task_ids,nodes:d.nodes||o,edges:d.edges||r,created_at:d.created_at,updated_at:d.updated_at}}catch(t){if(Ae.A.isAxiosError(t)&&t.response){t.response.data}throw t}}static async updateCrew(e,t){try{const n=e=>{if("object"!==typeof e||null===e)return"boolean"===typeof e?String(e):e;if(Array.isArray(e))return e.map(e=>n(e));const t={};for(const[a,s]of Object.entries(e))"knowledge_sources"===a&&Array.isArray(s)?t[a]=s.map(e=>{if(e&&"object"===typeof e){return n(e)}return e}):t[a]="tool_configs"===a&&null!==s&&"object"===typeof s?s:"taskId"!==a&&"agentId"!==a||null===s?"object"===typeof s&&null!==s?n(s):"boolean"===typeof s?String(s):s:String(s);return t},a=t.nodes.filter(e=>"agentNode"===e.type),s=t.nodes.filter(e=>"taskNode"===e.type),i=a.map(e=>{var t;if(null!==(t=e.data)&&void 0!==t&&t.agentId)return String(e.data.agentId);if(e.id){if(e.id.startsWith("agent-")){const t=e.id.split("agent-");if(t.length>1)return t[1]}return e.id}return null}).filter(Boolean),o=s.map(e=>{var t;if(null!==(t=e.data)&&void 0!==t&&t.taskId)return String(e.data.taskId);if(e.id){if(e.id.startsWith("task-")){const t=e.id.split("task-");if(t.length>1)return t[1]}return e.id}return null}).filter(Boolean),r=t.nodes.map(e=>{e.data||(e.data={label:e.id}),e.data.label&&"string"===typeof e.data.label||(e.data.label=e.id),e.data.tools&&Array.isArray(e.data.tools)||(e.data.tools=[]),e.data.context&&Array.isArray(e.data.context)||(e.data.context=[]),void 0===e.data.async_execution?e.data.async_execution="false":e.data.async_execution=String(e.data.async_execution),"agentNode"===e.type&&(e.data.knowledge_sources,e.data.tool_configs),"taskNode"===e.type&&e.data.tool_configs;const t={id:e.id,type:e.type,position:{x:e.position.x,y:e.position.y},data:n(e.data)};if("agentNode"===e.type){e.data.knowledge_sources,e.data.tool_configs}if("taskNode"===e.type&&e.data.tool_configs){}return t}),l=t.edges.map(e=>({id:e.id,source:e.source,target:e.target})),d={name:t.name,agent_ids:i,task_ids:o,nodes:r,edges:l},c=(await ye.uE.put("/crews/".concat(e),d)).data;return{id:c.id.toString(),name:c.name,agent_ids:c.agent_ids,task_ids:c.task_ids,nodes:c.nodes||r,edges:c.edges||l,created_at:c.created_at,updated_at:c.updated_at}}catch(n){if(Ae.A.isAxiosError(n)&&n.response){n.response.data}throw n}}static async deleteCrew(e){try{return await ye.uE.delete("/crews/".concat(e)),!0}catch(t){return!1}}static async deleteAllCrews(){try{await ye.uE.delete("/crews")}catch(e){throw e}}}class Re{static async getTask(e){try{var t;const n=await ye.uE.get("/tasks/".concat(e));return null!==(t=n.data)&&void 0!==t&&null!==(t=t.tool_configs)&&void 0!==t&&t.GenieTool,n.data}catch(n){return null}}static async findOrCreateTask(e){try{const t=(0,a.A)({},e);t.tools||(t.tools=[]),t.context||(t.context=[]),t.async_execution||(t.async_execution=!1);return(await ye.uE.post("/tasks/find-or-create",t)).data}catch(t){throw t}}static async createTask(e){try{var t,n,s,i,o,r,l,d,c,u,h,m,p,x,g,f,v,A,y;const b=e.assigned_agent;e.tool_configs;const j=(0,a.A)((0,a.A)({},e),{},{name:null===(t=e.name)||void 0===t?void 0:t.trim(),description:null===(n=e.description)||void 0===n?void 0:n.trim(),expected_output:null===(s=e.expected_output)||void 0===s?void 0:s.trim(),tools:e.tools||[],tool_configs:e.tool_configs||{},agent_id:e.agent_id||"",async_execution:void 0!==e.async_execution&&Boolean(e.async_execution),markdown:void 0!==e.markdown?Boolean(e.markdown):Boolean(null===(i=e.config)||void 0===i?void 0:i.markdown),context:e.context||[],config:(0,a.A)((0,a.A)({},e.config),{},{cache_response:Boolean(null===(o=e.config)||void 0===o?void 0:o.cache_response),cache_ttl:Number((null===(r=e.config)||void 0===r?void 0:r.cache_ttl)||3600),retry_on_fail:Boolean(null===(l=e.config)||void 0===l?void 0:l.retry_on_fail),max_retries:Number((null===(d=e.config)||void 0===d?void 0:d.max_retries)||3),timeout:null!==(c=e.config)&&void 0!==c&&c.timeout?Number(e.config.timeout):null,priority:Number((null===(u=e.config)||void 0===u?void 0:u.priority)||1),error_handling:(null===(h=e.config)||void 0===h?void 0:h.error_handling)||"default",output_file:(null===(m=e.config)||void 0===m?void 0:m.output_file)||null,output_json:(null===(p=e.config)||void 0===p?void 0:p.output_json)||null,output_pydantic:(null===(x=e.config)||void 0===x?void 0:x.output_pydantic)||null,callback:(null===(g=e.config)||void 0===g?void 0:g.callback)||null,human_input:Boolean(null===(f=e.config)||void 0===f?void 0:f.human_input),condition:(null===(v=e.config)||void 0===v?void 0:v.condition)||void 0,guardrail:(null===(A=e.config)||void 0===A?void 0:A.guardrail)||void 0,markdown:Boolean(null===(y=e.config)||void 0===y?void 0:y.markdown)})}),w=b?(0,a.A)((0,a.A)({},j),{},{assigned_agent:b}):j,k=(await ye.uE.post("/tasks",w)).data;return k.agent_id&&""!==k.agent_id||!w.agent_id||(k.agent_id=w.agent_id),k}catch(j){var b;throw new Error((null===(b=j.response)||void 0===b||null===(b=b.data)||void 0===b?void 0:b.detail)||"Error creating task")}}static async updateTask(e,t){try{var n,s,i,o,r,l,d,c,u,h,m,p,x,g,f,v,A,y,b;t.tool_configs;const j=(0,a.A)((0,a.A)({},t),{},{name:null===(n=t.name)||void 0===n?void 0:n.trim(),description:null===(s=t.description)||void 0===s?void 0:s.trim(),expected_output:null===(i=t.expected_output)||void 0===i?void 0:i.trim(),tools:t.tools||[],tool_configs:t.tool_configs||{},agent_id:t.agent_id||"",async_execution:void 0!==t.async_execution&&Boolean(t.async_execution),markdown:void 0!==t.markdown?Boolean(t.markdown):Boolean(null===(o=t.config)||void 0===o?void 0:o.markdown),context:t.context||[],config:(0,a.A)((0,a.A)({},t.config),{},{cache_response:Boolean(null===(r=t.config)||void 0===r?void 0:r.cache_response),cache_ttl:Number((null===(l=t.config)||void 0===l?void 0:l.cache_ttl)||3600),retry_on_fail:Boolean(null===(d=t.config)||void 0===d?void 0:d.retry_on_fail),max_retries:Number((null===(c=t.config)||void 0===c?void 0:c.max_retries)||3),timeout:null!==(u=t.config)&&void 0!==u&&u.timeout?Number(t.config.timeout):null,priority:Number((null===(h=t.config)||void 0===h?void 0:h.priority)||1),error_handling:(null===(m=t.config)||void 0===m?void 0:m.error_handling)||"default",output_file:(null===(p=t.config)||void 0===p?void 0:p.output_file)||null,output_json:(null===(x=t.config)||void 0===x?void 0:x.output_json)||null,output_pydantic:(null===(g=t.config)||void 0===g?void 0:g.output_pydantic)||null,callback:(null===(f=t.config)||void 0===f?void 0:f.callback)||null,human_input:Boolean(null===(v=t.config)||void 0===v?void 0:v.human_input),condition:(null===(A=t.config)||void 0===A?void 0:A.condition)||void 0,guardrail:(null===(y=t.config)||void 0===y?void 0:y.guardrail)||void 0,markdown:Boolean(null===(b=t.config)||void 0===b?void 0:b.markdown)})});return(await ye.uE.put("/tasks/".concat(e),j)).data}catch(w){var j;throw new Error((null===(j=w.response)||void 0===j||null===(j=j.data)||void 0===j?void 0:j.detail)||"Error updating task")}}static async updateTaskFull(e,t){try{var n,s;const i=(0,a.A)((0,a.A)({},t),{},{config:(0,a.A)((0,a.A)({},t.config),{},{condition:(null===(n=t.config)||void 0===n?void 0:n.condition)||void 0,guardrail:(null===(s=t.config)||void 0===s?void 0:s.guardrail)||void 0})});return(await ye.uE.put("/tasks/".concat(e,"/full"),i)).data}catch(o){var i;throw new Error((null===(i=o.response)||void 0===i||null===(i=i.data)||void 0===i?void 0:i.detail)||"Error updating task")}}static async deleteTask(e){try{await ye.uE.delete("/tasks/".concat(e))}catch(t){}}static async deleteAllTasks(){try{await ye.uE.delete("/tasks")}catch(e){}}static async listTasks(){try{return(await ye.uE.get("/tasks")).data}catch(t){var e;throw new Error((null===(e=t.response)||void 0===e||null===(e=e.data)||void 0===e?void 0:e.detail)||"Error fetching tasks")}}static async generateTask(e){try{const t={text:e.trim()};return(await ye.uE.post("/generate/generate-task",t,{headers:{"Content-Type":"application/json"}})).data}catch(n){var t;const e=n;throw e.response,new Error((null===(t=e.response)||void 0===t||null===(t=t.data)||void 0===t?void 0:t.detail)||"Error generating task")}}}n(90245);var Ve=n(42004);const Be=(0,j.vt)(e=>({secrets:[],loading:!1,error:null,editDialogOpen:!1,providerToEdit:null,fetchAPIKeys:async()=>{e({loading:!0,error:null});try{const t=Fe.getInstance(),n=await t.getAPIKeys();e({secrets:n,loading:!1})}catch(t){e({loading:!1,error:t instanceof Error?t.message:"An unexpected error occurred"})}},updateSecrets:t=>e(()=>({secrets:t,error:null})),clearError:()=>e(()=>({error:null})),openApiKeyEditor:t=>e(()=>({editDialogOpen:!0,providerToEdit:t})),closeApiKeyEditor:()=>e(()=>({editDialogOpen:!1,providerToEdit:null}))})),Ue=[{value:"sonar",label:"Sonar (Default)"},{value:"sonar-pro",label:"Sonar Pro"},{value:"sonar-deep-research",label:"Sonar Deep Research"},{value:"sonar-reasoning",label:"Sonar Reasoning"},{value:"sonar-reasoning-pro",label:"Sonar Reasoning Pro"},{value:"r1-1776",label:"R1-1776"}],He=[{value:"day",label:"Past Day"},{value:"week",label:"Past Week"},{value:"month",label:"Past Month"},{value:"year",label:"Past Year"}],Ke=[{value:"low",label:"Low"},{value:"medium",label:"Medium"},{value:"high",label:"High"}],Ge={model:"sonar",max_tokens:2e3,temperature:.1,top_p:.9,top_k:0,presence_penalty:0,frequency_penalty:1,search_recency_filter:"month",search_domain_filter:["<any>"],return_images:!1,return_related_questions:!1,web_search_options:{search_context_size:"high"}},Je=e=>{var t,n;let{value:s,onChange:r,label:l="Perplexity Configuration",helperText:d="Configure Perplexity AI search parameters",fullWidth:h=!0,disabled:p=!1}=e;const[x,g]=(0,i.useState)((0,a.A)((0,a.A)({},Ge),s)),{secrets:f,fetchAPIKeys:v}=Be(),[A,y]=(0,i.useState)(!1);(0,i.useEffect)(()=>{v()},[v]),(0,i.useEffect)(()=>{const e=f.find(e=>{var t;return(null===(t=e.name)||void 0===t?void 0:t.toLowerCase().includes("perplexity"))||"PERPLEXITY_API_KEY"===e.name});y(!!e)},[f]),(0,i.useEffect)(()=>{g((0,a.A)((0,a.A)({},Ge),s))},[s]);const b=(e,t)=>{const n=(0,a.A)((0,a.A)({},x),{},{[e]:t});g(n),r(n)};return(0,O.jsxs)(o.A,{sx:{width:h?"100%":"auto"},children:[(0,O.jsx)(c.A,{variant:"subtitle2",gutterBottom:!0,children:l}),(0,O.jsx)(c.A,{variant:"caption",color:"text.secondary",sx:{mb:2,display:"block"},children:d}),A&&(0,O.jsx)(m.A,{severity:"info",sx:{mb:2},children:(0,O.jsxs)(o.A,{sx:{display:"flex",alignItems:"center",gap:1},children:[(0,O.jsx)(c.A,{variant:"body2",children:"\u2705 System API key configured - leave empty to use system default, or enter a custom key to override"}),(0,O.jsx)(P.A,{title:"A Perplexity API key is already configured in the system settings. You can override it here for this specific task/agent, or leave empty to use the system default.",children:(0,O.jsx)(u.A,{size:"small",children:(0,O.jsx)(Oe.A,{fontSize:"small"})})})]})}),(0,O.jsx)(V.A,{fullWidth:!0,label:A?"API Key Override (Optional)":"API Key",value:x.perplexity_api_key||"",onChange:e=>b("perplexity_api_key",e.target.value),disabled:p,type:"password",sx:{mb:2},helperText:A?"Leave empty to use system default, or enter a custom key to override":"Enter your Perplexity API key, or leave empty to use environment variable",placeholder:A?"Override system API key...":"Enter API key..."}),(0,O.jsxs)(oe.A,{fullWidth:!0,sx:{mb:2},disabled:p,children:[(0,O.jsx)(re.A,{children:"Model"}),(0,O.jsx)(le.A,{value:x.model||"sonar",onChange:e=>b("model",e.target.value),label:"Model",children:Ue.map(e=>(0,O.jsx)(de.A,{value:e.value,children:e.label},e.value))})]}),(0,O.jsxs)(ae.A,{sx:{mb:2},children:[(0,O.jsx)(se.A,{expandIcon:(0,O.jsx)(pe.A,{}),children:(0,O.jsx)(c.A,{children:"Search Configuration"})}),(0,O.jsx)(ie.A,{children:(0,O.jsxs)(ce.Ay,{container:!0,spacing:2,children:[(0,O.jsx)(ce.Ay,{item:!0,xs:12,md:6,children:(0,O.jsxs)(oe.A,{fullWidth:!0,disabled:p,children:[(0,O.jsx)(re.A,{children:"Search Recency"}),(0,O.jsx)(le.A,{value:x.search_recency_filter||"month",onChange:e=>b("search_recency_filter",e.target.value),label:"Search Recency",children:He.map(e=>(0,O.jsx)(de.A,{value:e.value,children:e.label},e.value))})]})}),(0,O.jsx)(ce.Ay,{item:!0,xs:12,md:6,children:(0,O.jsxs)(oe.A,{fullWidth:!0,disabled:p,children:[(0,O.jsx)(re.A,{children:"Search Context Size"}),(0,O.jsx)(le.A,{value:(null===(t=x.web_search_options)||void 0===t?void 0:t.search_context_size)||"high",onChange:e=>((e,t)=>{const n=(0,a.A)((0,a.A)({},x.web_search_options),{},{[e]:t}),s=(0,a.A)((0,a.A)({},x),{},{web_search_options:n});g(s),r(s)})("search_context_size",e.target.value),label:"Search Context Size",children:Ke.map(e=>(0,O.jsx)(de.A,{value:e.value,children:e.label},e.value))})]})}),(0,O.jsxs)(ce.Ay,{item:!0,xs:12,children:[(0,O.jsxs)(oe.A,{fullWidth:!0,disabled:p,children:[(0,O.jsx)(re.A,{children:"Domain Filter"}),(0,O.jsxs)(le.A,{multiple:!0,value:x.search_domain_filter||["<any>"],onChange:e=>{const t=e.target.value,n="string"===typeof t?t.split(","):t,a=n.includes("<any>")?["<any>"]:n.filter(e=>"<any>"!==e);b("search_domain_filter",a)},input:(0,O.jsx)(ze.A,{label:"Domain Filter"}),renderValue:e=>(0,O.jsx)(o.A,{sx:{display:"flex",flexWrap:"wrap",gap:.5},children:e.map(e=>(0,O.jsx)(R.A,{label:"<any>"===e?"Any Domain":e,size:"small"},e))}),children:[(0,O.jsx)(de.A,{value:"<any>",children:"Any Domain"}),null===(n=x.search_domain_filter)||void 0===n?void 0:n.filter(e=>"<any>"!==e).map(e=>(0,O.jsx)(de.A,{value:e,children:e},e))]})]}),(0,O.jsx)(V.A,{fullWidth:!0,placeholder:"Add custom domain (press Enter)",onKeyPress:e=>{if("Enter"===e.key){var t;e.preventDefault();const n=e.target,a=n.value.trim();if(a&&(null===(t=x.search_domain_filter)||void 0===t||!t.includes(a))){const e=(x.search_domain_filter||[]).filter(e=>"<any>"!==e);b("search_domain_filter",[...e,a]),n.value=""}}},disabled:p,sx:{mt:1},size:"small",helperText:"Type a domain and press Enter to add it to the filter"})]}),(0,O.jsx)(ce.Ay,{item:!0,xs:12,md:6,children:(0,O.jsx)(he.A,{control:(0,O.jsx)(me.A,{checked:x.return_images||!1,onChange:e=>b("return_images",e.target.checked),disabled:p}),label:"Return Images"})}),(0,O.jsx)(ce.Ay,{item:!0,xs:12,md:6,children:(0,O.jsx)(he.A,{control:(0,O.jsx)(me.A,{checked:x.return_related_questions||!1,onChange:e=>b("return_related_questions",e.target.checked),disabled:p}),label:"Return Related Questions"})})]})})]}),(0,O.jsxs)(ae.A,{sx:{mb:2},children:[(0,O.jsx)(se.A,{expandIcon:(0,O.jsx)(pe.A,{}),children:(0,O.jsx)(c.A,{children:"Advanced Parameters"})}),(0,O.jsx)(ie.A,{children:(0,O.jsxs)(ce.Ay,{container:!0,spacing:2,children:[(0,O.jsx)(ce.Ay,{item:!0,xs:12,md:6,children:(0,O.jsx)(V.A,{fullWidth:!0,label:"Max Tokens",type:"number",value:x.max_tokens||2e3,onChange:e=>b("max_tokens",parseInt(e.target.value)||2e3),disabled:p,inputProps:{min:1,max:4e3},helperText:"Maximum output tokens (1-4000)"})}),(0,O.jsx)(ce.Ay,{item:!0,xs:12,md:6,children:(0,O.jsx)(V.A,{fullWidth:!0,label:"Temperature",type:"number",value:x.temperature||.1,onChange:e=>b("temperature",parseFloat(e.target.value)||.1),disabled:p,inputProps:{min:0,max:1,step:.1},helperText:"Controls randomness (0.0-1.0)"})}),(0,O.jsx)(ce.Ay,{item:!0,xs:12,md:6,children:(0,O.jsx)(V.A,{fullWidth:!0,label:"Top P",type:"number",value:x.top_p||.9,onChange:e=>b("top_p",parseFloat(e.target.value)||.9),disabled:p,inputProps:{min:0,max:1,step:.1},helperText:"Nucleus sampling parameter (0.0-1.0)"})}),(0,O.jsx)(ce.Ay,{item:!0,xs:12,md:6,children:(0,O.jsx)(V.A,{fullWidth:!0,label:"Top K",type:"number",value:x.top_k||0,onChange:e=>b("top_k",parseInt(e.target.value)||0),disabled:p,inputProps:{min:0},helperText:"Top-k sampling parameter (0 = disabled)"})}),(0,O.jsx)(ce.Ay,{item:!0,xs:12,md:6,children:(0,O.jsx)(V.A,{fullWidth:!0,label:"Presence Penalty",type:"number",value:x.presence_penalty||0,onChange:e=>b("presence_penalty",parseFloat(e.target.value)||0),disabled:p,inputProps:{min:-2,max:2,step:.1},helperText:"Penalizes new topics (-2.0 to 2.0)"})}),(0,O.jsx)(ce.Ay,{item:!0,xs:12,md:6,children:(0,O.jsx)(V.A,{fullWidth:!0,label:"Frequency Penalty",type:"number",value:x.frequency_penalty||1,onChange:e=>b("frequency_penalty",parseFloat(e.target.value)||1),disabled:p,inputProps:{min:-2,max:2,step:.1},helperText:"Penalizes repetition (-2.0 to 2.0)"})})]})})]})]})},qe=[{value:"us",label:"United States (us)"},{value:"gb",label:"United Kingdom (gb)"},{value:"ca",label:"Canada (ca)"},{value:"au",label:"Australia (au)"},{value:"de",label:"Germany (de)"},{value:"fr",label:"France (fr)"},{value:"es",label:"Spain (es)"},{value:"it",label:"Italy (it)"},{value:"jp",label:"Japan (jp)"},{value:"cn",label:"China (cn)"},{value:"in",label:"India (in)"},{value:"br",label:"Brazil (br)"},{value:"mx",label:"Mexico (mx)"},{value:"ru",label:"Russia (ru)"},{value:"kr",label:"South Korea (kr)"}],Ye=[{value:"en",label:"English (en)"},{value:"es",label:"Spanish (es)"},{value:"fr",label:"French (fr)"},{value:"de",label:"German (de)"},{value:"it",label:"Italian (it)"},{value:"pt",label:"Portuguese (pt)"},{value:"ru",label:"Russian (ru)"},{value:"ja",label:"Japanese (ja)"},{value:"ko",label:"Korean (ko)"},{value:"zh",label:"Chinese (zh)"},{value:"ar",label:"Arabic (ar)"},{value:"hi",label:"Hindi (hi)"}],Xe=[{value:"search",label:"Search",url:"https://google.serper.dev/search",description:"Regular Google search results with organic results, knowledge graph, and related searches"},{value:"news",label:"News",url:"https://google.serper.dev/news",description:"Google News results with recent articles from various sources"}],Ze={n_results:10,search_url:"https://google.serper.dev/search",endpoint_type:"search",country:"us",locale:"en",location:""},Qe=e=>{let{value:t,onChange:n,label:s="Serper Configuration",helperText:r="Configure Serper.dev search parameters",fullWidth:l=!0,disabled:d=!1}=e;const[h,p]=(0,i.useState)((0,a.A)((0,a.A)({},Ze),t)),{secrets:x,fetchAPIKeys:g}=Be(),[f,v]=(0,i.useState)(!1);(0,i.useEffect)(()=>{g()},[g]),(0,i.useEffect)(()=>{const e=x.find(e=>{var t;return(null===(t=e.name)||void 0===t?void 0:t.toLowerCase().includes("serper"))||"SERPER_API_KEY"===e.name});v(!!e)},[x]),(0,i.useEffect)(()=>{p((0,a.A)((0,a.A)({},Ze),t))},[t]);const A=(e,t)=>{const s=(0,a.A)((0,a.A)({},h),{},{[e]:t});if("endpoint_type"===e){const e=Xe.find(e=>e.value===t);e&&(s.search_url=e.url)}p(s),n(s)};return(0,O.jsxs)(o.A,{sx:{width:l?"100%":"auto"},children:[(0,O.jsx)(c.A,{variant:"subtitle2",gutterBottom:!0,children:s}),(0,O.jsx)(c.A,{variant:"caption",color:"text.secondary",sx:{mb:2,display:"block"},children:r}),f&&(0,O.jsx)(m.A,{severity:"info",sx:{mb:2},children:(0,O.jsxs)(o.A,{sx:{display:"flex",alignItems:"center",gap:1},children:[(0,O.jsx)(c.A,{variant:"body2",children:"\u2705 System API key configured - leave empty to use system default, or enter a custom key to override"}),(0,O.jsx)(P.A,{title:"A Serper API key is already configured in the system settings. You can override it here for this specific task/agent, or leave empty to use the system default.",children:(0,O.jsx)(u.A,{size:"small",children:(0,O.jsx)(Oe.A,{fontSize:"small"})})})]})}),(0,O.jsx)(V.A,{fullWidth:!0,label:f?"API Key Override (Optional)":"API Key",value:h.serper_api_key||"",onChange:e=>A("serper_api_key",e.target.value),disabled:d,type:"password",sx:{mb:2},helperText:f?"Leave empty to use system default, or enter a custom key to override":"Enter your Serper.dev API key, or leave empty to use environment variable",placeholder:f?"Override system API key...":"Enter API key..."}),(0,O.jsxs)(ce.Ay,{container:!0,spacing:2,sx:{mb:2},children:[(0,O.jsx)(ce.Ay,{item:!0,xs:12,md:6,children:(0,O.jsx)(V.A,{fullWidth:!0,label:"Number of Results",type:"number",value:h.n_results||10,onChange:e=>A("n_results",parseInt(e.target.value)||10),disabled:d,inputProps:{min:1,max:100},helperText:"Number of search results to return (1-100)"})}),(0,O.jsx)(ce.Ay,{item:!0,xs:12,md:6,children:(0,O.jsxs)(oe.A,{fullWidth:!0,disabled:d,children:[(0,O.jsx)(re.A,{children:"Search Endpoint"}),(0,O.jsx)(le.A,{value:h.endpoint_type||"search",onChange:e=>A("endpoint_type",e.target.value),label:"Search Endpoint",children:Xe.map(e=>(0,O.jsx)(de.A,{value:e.value,children:(0,O.jsxs)(o.A,{children:[(0,O.jsx)(c.A,{variant:"body2",sx:{fontWeight:"medium"},children:e.label}),(0,O.jsx)(c.A,{variant:"caption",color:"text.secondary",sx:{display:"block",fontSize:"0.7rem"},children:e.description})]})},e.value))})]})})]}),(0,O.jsxs)(c.A,{variant:"caption",color:"text.secondary",sx:{mb:2,display:"block"},children:[(0,O.jsx)("strong",{children:"Current Endpoint:"})," ",h.search_url||"https://google.serper.dev/search"]}),(0,O.jsxs)(ae.A,{sx:{mb:2},children:[(0,O.jsx)(se.A,{expandIcon:(0,O.jsx)(pe.A,{}),children:(0,O.jsx)(c.A,{children:"Geographic & Language Settings"})}),(0,O.jsx)(ie.A,{children:(0,O.jsxs)(ce.Ay,{container:!0,spacing:2,children:[(0,O.jsx)(ce.Ay,{item:!0,xs:12,md:6,children:(0,O.jsxs)(oe.A,{fullWidth:!0,disabled:d,children:[(0,O.jsx)(re.A,{children:"Country"}),(0,O.jsx)(le.A,{value:h.country||"us",onChange:e=>A("country",e.target.value),label:"Country",children:qe.map(e=>(0,O.jsx)(de.A,{value:e.value,children:e.label},e.value))})]})}),(0,O.jsx)(ce.Ay,{item:!0,xs:12,md:6,children:(0,O.jsxs)(oe.A,{fullWidth:!0,disabled:d,children:[(0,O.jsx)(re.A,{children:"Language Locale"}),(0,O.jsx)(le.A,{value:h.locale||"en",onChange:e=>A("locale",e.target.value),label:"Language Locale",children:Ye.map(e=>(0,O.jsx)(de.A,{value:e.value,children:e.label},e.value))})]})}),(0,O.jsx)(ce.Ay,{item:!0,xs:12,children:(0,O.jsx)(V.A,{fullWidth:!0,label:"Specific Location",value:h.location||"",onChange:e=>A("location",e.target.value),disabled:d,placeholder:"e.g., New York, London, Tokyo",helperText:"Optional specific location for geographically-targeted results"})})]})})]}),(0,O.jsx)(m.A,{severity:"info",sx:{mt:2},children:(0,O.jsxs)(c.A,{variant:"body2",children:["\u{1f4a1} ",(0,O.jsx)("strong",{children:"Tip:"})," Serper.dev provides access to multiple Google search types through API. Choose from Search, News, Images, Videos, Places, Shopping, Scholar, Patents, and Autocomplete endpoints. Configure geographic settings for location-specific results."]})})]})};var $e=n(24516),et=n(14302);class tt{static getInstance(){return tt.instance||(tt.instance=new tt),tt.instance}async getMcpServers(){try{return(await ye.uE.get("/mcp/servers")).data}catch(t){var e;throw new Error((null===(e=t.response)||void 0===e||null===(e=e.data)||void 0===e?void 0:e.detail)||"Error fetching MCP servers")}}async getMcpServer(e){try{return(await ye.uE.get("/mcp/servers/".concat(e))).data}catch(a){var t,n;if(404===(null===(t=a.response)||void 0===t?void 0:t.status))return null;throw new Error((null===(n=a.response)||void 0===n||null===(n=n.data)||void 0===n?void 0:n.detail)||"Error fetching MCP server with ID ".concat(e))}}async createMcpServer(e){try{return(await ye.uE.post("/mcp/servers",e)).data}catch(n){var t;throw new Error((null===(t=n.response)||void 0===t||null===(t=t.data)||void 0===t?void 0:t.detail)||"Error creating MCP server")}}async updateMcpServer(e,t){try{return(await ye.uE.put("/mcp/servers/".concat(e),t)).data}catch(a){var n;throw new Error((null===(n=a.response)||void 0===n||null===(n=n.data)||void 0===n?void 0:n.detail)||"Error updating MCP server with ID ".concat(e))}}async deleteMcpServer(e){try{return await ye.uE.delete("/mcp/servers/".concat(e)),!0}catch(n){var t;throw new Error((null===(t=n.response)||void 0===t||null===(t=t.data)||void 0===t?void 0:t.detail)||"Error deleting MCP server with ID ".concat(e))}}async toggleMcpServerEnabled(e){try{return{enabled:(await ye.uE.patch("/mcp/servers/".concat(e,"/toggle-enabled"))).data.enabled}}catch(n){var t;throw new Error((null===(t=n.response)||void 0===t||null===(t=t.data)||void 0===t?void 0:t.detail)||"Error toggling MCP server ".concat(e," enabled state"))}}async toggleMcpServerGlobalEnabled(e){try{return{enabled:(await ye.uE.patch("/mcp/servers/".concat(e,"/toggle-global-enabled"))).data.enabled}}catch(n){var t;throw new Error((null===(t=n.response)||void 0===t||null===(t=t.data)||void 0===t?void 0:t.detail)||"Error toggling MCP server ".concat(e," global enabled state"))}}async testConnection(e){try{return(await ye.uE.post("/mcp/test-connection",e)).data}catch(n){var t;return{success:!1,message:(null===(t=n.response)||void 0===t||null===(t=t.data)||void 0===t?void 0:t.detail)||"Error testing connection"}}}async getGlobalSettings(){try{return(await ye.uE.get("/mcp/settings")).data}catch(t){var e;throw new Error((null===(e=t.response)||void 0===e||null===(e=e.data)||void 0===e?void 0:e.detail)||"Error fetching MCP global settings")}}async updateGlobalSettings(e){try{return(await ye.uE.put("/mcp/settings",e)).data}catch(n){var t;throw new Error((null===(t=n.response)||void 0===t||null===(t=t.data)||void 0===t?void 0:t.detail)||"Error updating MCP global settings")}}}tt.instance=void 0;const nt=e=>{let{value:t,onChange:n,multiple:s=!0,label:r="MCP Servers",placeholder:l="Select MCP servers...",disabled:d=!1,required:u=!1,helperText:h,error:m=!1,fullWidth:p=!0}=e;const[x,g]=(0,i.useState)(!1),[f,v]=(0,i.useState)([]),[A,y]=(0,i.useState)(null),[b,j]=(0,i.useState)(!1),[w,k]=(0,i.useState)(null);(0,i.useEffect)(()=>{x&&0===f.length&&C()},[x,f.length]),(0,i.useEffect)(()=>{if(t)if(f.length>0)if(s){const e=Array.isArray(t)?t:[t],n=f.filter(t=>e.includes(t.name));y(n)}else{const e=f.find(e=>e.name===t);y(e||null)}else y(s?[]:null);else y(s?[]:null)},[t,f,s]);const C=async()=>{try{j(!0),k(null);const e=tt.getInstance(),t=(await e.getMcpServers()).servers.filter(e=>e.enabled);v(t)}catch(m){k("Failed to load MCP servers"),v([])}finally{j(!1)}};return(0,O.jsxs)(o.A,{children:[(0,O.jsx)(Se.A,{multiple:s,open:x,onOpen:()=>g(!0),onClose:()=>g(!1),value:s?A||[]:A||null,onChange:(e,t)=>{if(y(t),t)if(s){const e=(Array.isArray(t)?t:[t]).map(e=>e.name);n(e)}else{const e=Array.isArray(t)?t[0]:t;n((null===e||void 0===e?void 0:e.name)||null)}else n(s?[]:null)},options:f,getOptionLabel:e=>"".concat(e.name," (").concat(e.server_type,")"),renderOption:(e,t)=>(0,O.jsxs)(o.A,(0,a.A)((0,a.A)({component:"li"},e),{},{children:[(0,O.jsx)(et.A,{sx:{mr:2,color:"primary.main"}}),(0,O.jsxs)(o.A,{children:[(0,O.jsx)(c.A,{variant:"body2",fontWeight:"medium",children:t.name}),(0,O.jsxs)(c.A,{variant:"caption",color:"text.secondary",children:[t.server_type," \u2022 ",t.server_url||"No URL"]})]})]})),renderTags:s?(e,t)=>e.map((e,n)=>(0,i.createElement)(R.A,(0,a.A)((0,a.A)({},t({index:n})),{},{key:e.name,label:e.name,size:"small",color:"primary",variant:"outlined"}))):void 0,loading:b,disabled:d,fullWidth:p,isOptionEqualToValue:(e,t)=>e.name===t.name,renderInput:e=>(0,O.jsx)(V.A,(0,a.A)((0,a.A)({},e),{},{label:r,placeholder:A&&(s?A.length>0:A)?"":l,required:u,error:m||!!w,InputProps:(0,a.A)((0,a.A)({},e.InputProps),{},{startAdornment:(0,O.jsx)(ne.A,{position:"start",children:(0,O.jsx)(et.A,{color:"action"})}),endAdornment:(0,O.jsxs)(O.Fragment,{children:[b?(0,O.jsx)(ue.A,{color:"inherit",size:20}):null,e.InputProps.endAdornment]})})})),noOptionsText:w?(0,O.jsx)(o.A,{sx:{p:2,textAlign:"center"},children:(0,O.jsx)(c.A,{color:"error",variant:"body2",children:w})}):b?(0,O.jsxs)(o.A,{sx:{p:2,textAlign:"center"},children:[(0,O.jsx)(ue.A,{size:20}),(0,O.jsx)(c.A,{variant:"body2",sx:{ml:1},children:"Loading MCP servers..."})]}):(0,O.jsxs)(o.A,{sx:{p:2,textAlign:"center"},children:[(0,O.jsx)(c.A,{variant:"body2",color:"text.secondary",children:"No enabled MCP servers found"}),(0,O.jsx)(c.A,{variant:"caption",color:"text.secondary",children:"Configure MCP servers in Settings \u2192 Configuration \u2192 MCP"})]})}),(h||w)&&(0,O.jsx)($e.A,{error:m||!!w,children:w||h})]})};var at=n(249),st=n(26050),it=n(36035),ot=n(58772),rt=n(4983),lt=n(92900),dt=n(73175),ct=n(98818),ut=n(39309),ht=n(55858);const mt=e=>{let{open:t,onClose:n}=e;return(0,O.jsxs)(r.A,{open:t,onClose:n,maxWidth:"md",fullWidth:!0,PaperProps:{sx:{borderRadius:2,minHeight:"80vh"}},children:[(0,O.jsx)(d.A,{children:(0,O.jsxs)(o.A,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[(0,O.jsxs)(o.A,{sx:{display:"flex",alignItems:"center",gap:1},children:[(0,O.jsx)(ct.A,{color:"primary"}),(0,O.jsx)(c.A,{variant:"h6",children:"Agent Best Practices"})]}),(0,O.jsx)(u.A,{onClick:n,size:"small",children:(0,O.jsx)(D.A,{})})]})}),(0,O.jsx)(l.A,{dividers:!0,children:(0,O.jsxs)(o.A,{sx:{py:2},children:[(0,O.jsx)(m.A,{severity:"info",sx:{mb:3},children:"Agents are autonomous units that perform specific tasks. They combine a role, goal, backstory, and tools to accomplish their objectives effectively."}),(0,O.jsxs)(_e.A,{elevation:0,sx:{p:3,mb:3,bgcolor:"background.default"},children:[(0,O.jsxs)(c.A,{variant:"h6",gutterBottom:!0,sx:{display:"flex",alignItems:"center",gap:1},children:[(0,O.jsx)(lt.A,{color:"primary"}),"Core Principles"]}),(0,O.jsxs)(at.A,{children:[(0,O.jsxs)(st.Ay,{children:[(0,O.jsx)(it.A,{children:(0,O.jsx)(rt.A,{color:"success"})}),(0,O.jsx)(ot.A,{primary:"Single Responsibility",secondary:"Each agent should focus on one specific area of expertise. Avoid creating agents that try to do everything."})]}),(0,O.jsxs)(st.Ay,{children:[(0,O.jsx)(it.A,{children:(0,O.jsx)(rt.A,{color:"success"})}),(0,O.jsx)(ot.A,{primary:"Clear Role Definition",secondary:"Define the agent's role precisely. For example: 'Senior Data Analyst' instead of just 'Analyst'."})]}),(0,O.jsxs)(st.Ay,{children:[(0,O.jsx)(it.A,{children:(0,O.jsx)(rt.A,{color:"success"})}),(0,O.jsx)(ot.A,{primary:"Actionable Goals",secondary:"Set specific, measurable goals that the agent can achieve. Avoid vague objectives."})]})]})]}),(0,O.jsxs)(_e.A,{elevation:0,sx:{p:3,mb:3,bgcolor:"background.default"},children:[(0,O.jsxs)(c.A,{variant:"h6",gutterBottom:!0,sx:{display:"flex",alignItems:"center",gap:1},children:[(0,O.jsx)(ht.A,{color:"primary"}),"Writing Effective Agent Descriptions"]}),(0,O.jsxs)(o.A,{sx:{mt:2},children:[(0,O.jsx)(c.A,{variant:"subtitle1",fontWeight:"medium",gutterBottom:!0,children:"Role"}),(0,O.jsx)(c.A,{variant:"body2",color:"text.secondary",paragraph:!0,children:"Define WHO the agent is. Be specific about their expertise level and domain."}),(0,O.jsx)(o.A,{sx:{bgcolor:"grey.100",p:2,borderRadius:1,mb:2},children:(0,O.jsxs)(c.A,{variant:"body2",fontFamily:"monospace",children:["\u2705 Good: ",'"Senior Python Developer specializing in API development"',(0,O.jsx)("br",{}),"\u274c Poor: ",'"Developer"']})})]}),(0,O.jsxs)(o.A,{sx:{mt:2},children:[(0,O.jsx)(c.A,{variant:"subtitle1",fontWeight:"medium",gutterBottom:!0,children:"Goal"}),(0,O.jsx)(c.A,{variant:"body2",color:"text.secondary",paragraph:!0,children:"Define WHAT the agent should achieve. Make it specific and measurable."}),(0,O.jsx)(o.A,{sx:{bgcolor:"grey.100",p:2,borderRadius:1,mb:2},children:(0,O.jsxs)(c.A,{variant:"body2",fontFamily:"monospace",children:["\u2705 Good: ",'"Design and implement RESTful APIs with proper error handling and documentation"',(0,O.jsx)("br",{}),"\u274c Poor: ",'"Write code"']})})]}),(0,O.jsxs)(o.A,{sx:{mt:2},children:[(0,O.jsx)(c.A,{variant:"subtitle1",fontWeight:"medium",gutterBottom:!0,children:"Backstory"}),(0,O.jsx)(c.A,{variant:"body2",color:"text.secondary",paragraph:!0,children:"Provide context that helps the agent understand their approach and constraints."}),(0,O.jsx)(o.A,{sx:{bgcolor:"grey.100",p:2,borderRadius:1,mb:2},children:(0,O.jsxs)(c.A,{variant:"body2",fontFamily:"monospace",children:["\u2705 Good: ",'"You have 10 years of experience building scalable systems. You prioritize clean, maintainable code and always consider security implications."',(0,O.jsx)("br",{}),"\u274c Poor: ",'"You are experienced"']})})]})]}),(0,O.jsxs)(_e.A,{elevation:0,sx:{p:3,mb:3,bgcolor:"background.default"},children:[(0,O.jsxs)(c.A,{variant:"h6",gutterBottom:!0,sx:{display:"flex",alignItems:"center",gap:1},children:[(0,O.jsx)(ut.A,{color:"primary"}),"Tool Selection"]}),(0,O.jsxs)(at.A,{children:[(0,O.jsxs)(st.Ay,{children:[(0,O.jsx)(it.A,{children:(0,O.jsx)(rt.A,{color:"success"})}),(0,O.jsx)(ot.A,{primary:"Minimal Tool Set",secondary:"Only assign tools that are essential for the agent's tasks. Too many tools can confuse the agent."})]}),(0,O.jsxs)(st.Ay,{children:[(0,O.jsx)(it.A,{children:(0,O.jsx)(rt.A,{color:"success"})}),(0,O.jsx)(ot.A,{primary:"Tool Relevance",secondary:"Ensure each tool directly relates to the agent's goal and role."})]}),(0,O.jsxs)(st.Ay,{children:[(0,O.jsx)(it.A,{children:(0,O.jsx)(rt.A,{color:"success"})}),(0,O.jsx)(ot.A,{primary:"Custom Tools",secondary:"Create custom tools for specific needs rather than overloading agents with generic ones."})]})]})]}),(0,O.jsxs)(_e.A,{elevation:0,sx:{p:3,mb:3,bgcolor:"error.50"},children:[(0,O.jsxs)(c.A,{variant:"h6",gutterBottom:!0,sx:{display:"flex",alignItems:"center",gap:1,color:"error.main"},children:[(0,O.jsx)(dt.A,{color:"error"}),"Common Pitfalls to Avoid"]}),(0,O.jsxs)(at.A,{children:[(0,O.jsxs)(st.Ay,{children:[(0,O.jsx)(it.A,{children:(0,O.jsx)(dt.A,{color:"error"})}),(0,O.jsx)(ot.A,{primary:"Overlapping Responsibilities",secondary:"Don't create agents with overlapping roles. This causes confusion and inefficiency."})]}),(0,O.jsxs)(st.Ay,{children:[(0,O.jsx)(it.A,{children:(0,O.jsx)(dt.A,{color:"error"})}),(0,O.jsx)(ot.A,{primary:"Vague Instructions",secondary:"Avoid ambiguous language in roles and goals. Be explicit about expectations."})]}),(0,O.jsxs)(st.Ay,{children:[(0,O.jsx)(it.A,{children:(0,O.jsx)(dt.A,{color:"error"})}),(0,O.jsx)(ot.A,{primary:"Over-complexity",secondary:"Don't make agents too complex. Break down complex roles into multiple specialized agents."})]}),(0,O.jsxs)(st.Ay,{children:[(0,O.jsx)(it.A,{children:(0,O.jsx)(dt.A,{color:"error"})}),(0,O.jsx)(ot.A,{primary:"Ignoring Dependencies",secondary:"Consider how agents will interact. Define clear handoff points and communication patterns."})]})]})]}),(0,O.jsxs)(_e.A,{elevation:0,sx:{p:3,bgcolor:"success.50"},children:[(0,O.jsxs)(c.A,{variant:"h6",gutterBottom:!0,sx:{display:"flex",alignItems:"center",gap:1,color:"success.main"},children:[(0,O.jsx)(rt.A,{color:"success"}),"Quick Checklist"]}),(0,O.jsxs)(at.A,{dense:!0,children:[(0,O.jsxs)(st.Ay,{children:[(0,O.jsx)(it.A,{children:(0,O.jsx)(rt.A,{color:"success",fontSize:"small"})}),(0,O.jsx)(ot.A,{primary:"Is the role specific and clear?"})]}),(0,O.jsxs)(st.Ay,{children:[(0,O.jsx)(it.A,{children:(0,O.jsx)(rt.A,{color:"success",fontSize:"small"})}),(0,O.jsx)(ot.A,{primary:"Is the goal measurable and achievable?"})]}),(0,O.jsxs)(st.Ay,{children:[(0,O.jsx)(it.A,{children:(0,O.jsx)(rt.A,{color:"success",fontSize:"small"})}),(0,O.jsx)(ot.A,{primary:"Does the backstory provide useful context?"})]}),(0,O.jsxs)(st.Ay,{children:[(0,O.jsx)(it.A,{children:(0,O.jsx)(rt.A,{color:"success",fontSize:"small"})}),(0,O.jsx)(ot.A,{primary:"Are all assigned tools necessary?"})]}),(0,O.jsxs)(st.Ay,{children:[(0,O.jsx)(it.A,{children:(0,O.jsx)(rt.A,{color:"success",fontSize:"small"})}),(0,O.jsx)(ot.A,{primary:"Is the agent focused on a single responsibility?"})]}),(0,O.jsxs)(st.Ay,{children:[(0,O.jsx)(it.A,{children:(0,O.jsx)(rt.A,{color:"success",fontSize:"small"})}),(0,O.jsx)(ot.A,{primary:"Have you avoided overlapping with other agents?"})]})]})]})]})}),(0,O.jsx)(B.A,{sx:{px:3,py:2},children:(0,O.jsx)(x.A,{onClick:n,variant:"contained",color:"primary",children:"Close"})})]})},pt={"databricks-llama-4-maverick":{name:"databricks-llama-4-maverick",temperature:.7,context_window:128e3,max_output_tokens:4096,enabled:!0}},xt=e=>{var t,n,s,h;let{initialData:p,onCancel:g,onAgentSaved:f,tools:v,isCreateMode:A}=e;const{updateAgent:y}=(0,Ce.o)(),[b,j]=(0,i.useState)(pt),[w,k]=(0,i.useState)(!0),[C,S]=(0,i.useState)(!1),[_,E]=(0,i.useState)(!1),[I,T]=(0,i.useState)(!1),[N,M]=(0,i.useState)(!1),[z,L]=(0,i.useState)(!1),[F,W]=(0,i.useState)(null),[U,H]=(0,i.useState)({}),[K,G]=(0,i.useState)({}),[J,Y]=(0,i.useState)([]),[X,Z]=(0,i.useState)((null===p||void 0===p?void 0:p.tool_configs)||{}),Q=Object.entries(b).filter(e=>{let[t,n]=e;return"openai"===n.provider||"anthropic"===n.provider}),[$,Ae]=(0,i.useState)(()=>{var e,t,n;const s=null!==p&&void 0!==p&&p.id?void 0:we.getInstance().getDefaultConfig(),i={name:(null===p||void 0===p?void 0:p.name)||"",role:(null===p||void 0===p?void 0:p.role)||"",goal:(null===p||void 0===p?void 0:p.goal)||"",backstory:(null===p||void 0===p?void 0:p.backstory)||"",llm:(null===p||void 0===p?void 0:p.llm)||"databricks-llama-4-maverick",temperature:(null===p||void 0===p?void 0:p.temperature)||void 0,tools:null!==p&&void 0!==p&&p.tools?p.tools.map(e=>String(e)):[],function_calling_llm:(null===p||void 0===p?void 0:p.function_calling_llm)||void 0,max_iter:(null===p||void 0===p?void 0:p.max_iter)||25,max_rpm:(null===p||void 0===p?void 0:p.max_rpm)||1,max_execution_time:(null===p||void 0===p?void 0:p.max_execution_time)||300,memory:null===(e=null===p||void 0===p?void 0:p.memory)||void 0===e||e,verbose:null!==(t=null===p||void 0===p?void 0:p.verbose)&&void 0!==t&&t,allow_delegation:(null===p||void 0===p?void 0:p.allow_delegation)||!1,cache:null===(n=null===p||void 0===p?void 0:p.cache)||void 0===n||n,system_template:(null===p||void 0===p?void 0:p.system_template)||void 0,prompt_template:(null===p||void 0===p?void 0:p.prompt_template)||void 0,response_template:(null===p||void 0===p?void 0:p.response_template)||void 0,allow_code_execution:(null===p||void 0===p?void 0:p.allow_code_execution)||!1,code_execution_mode:(null===p||void 0===p?void 0:p.code_execution_mode)||"safe",max_retry_limit:(null===p||void 0===p?void 0:p.max_retry_limit)||3,use_system_prompt:(null===p||void 0===p?void 0:p.use_system_prompt)||!0,respect_context_window:(null===p||void 0===p?void 0:p.respect_context_window)||!0,embedder_config:(null===p||void 0===p?void 0:p.embedder_config)||{provider:"databricks",config:{model:"databricks-gte-large-en"}},knowledge_sources:(null===p||void 0===p?void 0:p.knowledge_sources)||[],memory_backend_config:(null===p||void 0===p?void 0:p.memory_backend_config)||s||void 0};return null!==p&&void 0!==p&&p.id?(0,a.A)((0,a.A)({},i),{},{id:p.id}):i});(0,i.useEffect)(()=>{if(null!==p&&void 0!==p&&p.tool_configs){Z(p.tool_configs);const e=p.tool_configs.GenieTool;if(e){const t=e.spaceId||e.space_id,n=e.spaceName||e.space_name||t;t&&"string"===typeof t&&W({id:t,name:n})}if(p.tool_configs.PerplexityTool&&H(p.tool_configs.PerplexityTool),p.tool_configs.SerperDevTool&&G(p.tool_configs.SerperDevTool),p.tool_configs.MCP_SERVERS){const e=p.tool_configs.MCP_SERVERS,t=Array.isArray(e.servers)?e.servers:Array.isArray(p.tool_configs.MCP_SERVERS)?p.tool_configs.MCP_SERVERS:[];Y(t)}}},[null===p||void 0===p?void 0:p.tool_configs]),(0,i.useEffect)(()=>{(async()=>{try{k(!0);const e=ve.J.getInstance(),t=await e.getActiveModels();if(Object.keys(t).length>0){j(t);const e=$.llm;if(e&&!t[e]){const e=Object.keys(t)[0];Ae(t=>(0,a.A)((0,a.A)({},t),{},{llm:e}))}}}catch(e){}finally{k(!1)}})()},[]);const[ye,je]=(0,i.useState)(!1),[Se,_e]=(0,i.useState)(!1),Ee=(e,t)=>{Ae(n=>(0,a.A)((0,a.A)({},n),{},{[e]:t}))},Ie=e=>{const t=(Array.isArray(e.target.value)?e.target.value:[e.target.value]).map(e=>String(e)),n=$.tools.some(e=>"36"===String(e)||"DatabricksKnowledgeSearchTool"===String(e)),a=t.some(e=>"36"===String(e)||"DatabricksKnowledgeSearchTool"===String(e));n&&!a&&Ee("knowledge_sources",[]);const s=new Map;t.forEach(e=>{const t=s.get(e)||0;s.set(e,t+1)});Array.from(s.entries()).filter(e=>{let[t,n]=e;return n>1}).map(e=>{let[t]=e;return t}).length;const i=Array.from(new Set(t));Ee("tools",i),null!==p&&void 0!==p&&p.id&&y(p.id,{tools:i})},Te=Boolean($.role&&$.goal&&$.backstory),De=()=>{S(!1)},Ne=()=>{E(!1)},Pe=()=>{T(!1)},ze=()=>{M(!1)},Oe=()=>{L(!1)};return(0,O.jsxs)(O.Fragment,{children:[(0,O.jsxs)(ee.A,{sx:{display:"flex",flexDirection:"column",height:"70vh",position:"relative",overflow:"hidden"},children:[!A&&(0,O.jsxs)(o.A,{sx:{p:3,pb:2},children:[(0,O.jsxs)(o.A,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:3},children:[(0,O.jsx)(c.A,{variant:"h6",children:null!==p&&void 0!==p&&p.id?"Edit Agent":"Create New Agent"}),(0,O.jsx)(x.A,{startIcon:(0,O.jsx)(xe.A,{}),onClick:()=>_e(!0),variant:"outlined",size:"small",sx:{ml:2},children:"Best Practices"})]}),(0,O.jsx)(te.A,{})]}),(0,O.jsx)(o.A,{sx:{flex:"1 1 auto",overflow:"auto",px:3,pb:2,pt:A?3:0,height:A?"calc(90vh - 120px)":"calc(90vh - 170px)"},children:(0,O.jsxs)(o.A,{sx:{display:"flex",flexDirection:"column",gap:2},children:[(0,O.jsx)(V.A,{fullWidth:!0,label:"Name",value:$.name,onChange:e=>Ee("name",e.target.value),required:!0,margin:"normal",sx:{"& .MuiOutlinedInput-root":{"& fieldset":{borderColor:"rgba(0, 0, 0, 0.23)"}},"& .MuiInputLabel-root":{backgroundColor:"white",padding:"0 4px"}}}),(0,O.jsx)(V.A,{fullWidth:!0,label:"Role",value:$.role,onChange:e=>Ee("role",e.target.value),required:!0}),(0,O.jsx)(V.A,{fullWidth:!0,label:"Goal",value:$.goal,onChange:e=>Ee("goal",e.target.value),multiline:!0,rows:2,required:!0,InputProps:{endAdornment:(0,O.jsx)(ne.A,{position:"end",children:(0,O.jsx)(u.A,{edge:"end",onClick:()=>{S(!0)},size:"small",sx:{opacity:.7},title:"Expand goal",children:(0,O.jsx)(ge.A,{fontSize:"small"})})})}}),(0,O.jsx)(V.A,{fullWidth:!0,label:"Backstory",value:$.backstory,onChange:e=>Ee("backstory",e.target.value),multiline:!0,rows:3,required:!0,InputProps:{endAdornment:(0,O.jsx)(ne.A,{position:"end",children:(0,O.jsx)(u.A,{edge:"end",onClick:()=>{E(!0)},size:"small",sx:{opacity:.7},title:"Expand backstory",children:(0,O.jsx)(ge.A,{fontSize:"small"})})})}}),(0,O.jsxs)(ae.A,{children:[(0,O.jsx)(se.A,{expandIcon:(0,O.jsx)(pe.A,{}),children:(0,O.jsx)(c.A,{children:"Templates"})}),(0,O.jsx)(ie.A,{children:(0,O.jsxs)(o.A,{sx:{display:"flex",flexDirection:"column",gap:2},children:[(0,O.jsx)(o.A,{sx:{display:"flex",justifyContent:"flex-end",mb:2},children:(0,O.jsx)(x.A,{variant:"contained",onClick:async()=>{if($.role&&$.goal&&$.backstory){je(!0);try{const e=await be.generateTemplates({role:$.role,goal:$.goal,backstory:$.backstory,model:$.llm});e&&(Ee("system_template",e.system_template),Ee("prompt_template",e.prompt_template),Ee("response_template",e.response_template))}catch(e){}finally{je(!1)}}},disabled:!Te||ye,children:ye?"Generating...":"Generate Templates"})}),(0,O.jsx)(V.A,{fullWidth:!0,label:"System Template",value:$.system_template||"",onChange:e=>Ee("system_template",e.target.value),multiline:!0,rows:4,InputProps:{endAdornment:(0,O.jsx)(ne.A,{position:"end",children:(0,O.jsx)(u.A,{edge:"end",onClick:()=>{T(!0)},size:"small",sx:{opacity:.7},title:"Expand system template",children:(0,O.jsx)(ge.A,{fontSize:"small"})})})}}),(0,O.jsxs)(c.A,{variant:"caption",color:"text.secondary",sx:{mt:.5,mb:1},children:["Defines the agent's core identity and fundamental instructions. Controls how the agent understands its ","{role}",", ","{goal}",", and ","{backstory}",". Use this to establish expertise boundaries, ethical guidelines, and overall behavior patterns."]}),(0,O.jsx)(V.A,{fullWidth:!0,label:"Prompt Template",value:$.prompt_template||"",onChange:e=>Ee("prompt_template",e.target.value),multiline:!0,rows:4,InputProps:{endAdornment:(0,O.jsx)(ne.A,{position:"end",children:(0,O.jsx)(u.A,{edge:"end",onClick:()=>{M(!0)},size:"small",sx:{opacity:.7},title:"Expand prompt template",children:(0,O.jsx)(ge.A,{fontSize:"small"})})})}}),(0,O.jsxs)(c.A,{variant:"caption",color:"text.secondary",sx:{mt:.5,mb:1},children:["Structures how tasks are presented to the agent. Controls the format and flow of task instructions. Include placeholders for dynamic content like ","{input}",", ","{context}",", and task-specific variables to ensure consistent task processing."]}),(0,O.jsx)(V.A,{fullWidth:!0,label:"Response Template",value:$.response_template||"",onChange:e=>Ee("response_template",e.target.value),multiline:!0,rows:4,InputProps:{endAdornment:(0,O.jsx)(ne.A,{position:"end",children:(0,O.jsx)(u.A,{edge:"end",onClick:()=>{L(!0)},size:"small",sx:{opacity:.7},title:"Expand response template",children:(0,O.jsx)(ge.A,{fontSize:"small"})})})}}),(0,O.jsx)(c.A,{variant:"caption",color:"text.secondary",sx:{mt:.5,mb:1},children:"Guides how the agent formats its responses and output structure. Enforces consistency in deliverables by defining sections like THOUGHTS, ACTION, and RESULT. Use this to ensure structured, actionable, and predictable agent outputs."})]})})]}),(0,O.jsxs)(oe.A,{fullWidth:!0,children:[(0,O.jsx)(re.A,{id:"tools-label",children:"Tools"}),(0,O.jsx)(le.A,{labelId:"tools-label",multiple:!0,value:$.tools,onChange:Ie,label:"Tools",renderValue:e=>(0,O.jsx)(o.A,{sx:{display:"flex",flexWrap:"wrap",gap:.5},children:e.map((e,t)=>{const n=v.find(t=>String(t.id)===String(e)),a=n?n.title:"DatabricksKnowledgeSearchTool"===String(e)?"Knowledge Search":String(e);return(0,O.jsx)(R.A,{label:a,size:"small",onDelete:()=>{(e=>{const t=$.tools.filter(t=>String(t)!==String(e));Ie({target:{value:t}})})(e)},onMouseDown:e=>{e.stopPropagation()},deleteIcon:(0,O.jsx)(q.A,{fontSize:"small",sx:{fontSize:"16px !important"}})},"selected-tool-".concat(e,"-").concat(t))})}),children:v.filter(e=>!1!==e.enabled).map(e=>(0,O.jsx)(de.A,{value:String(e.id),children:(0,O.jsxs)(o.A,{sx:{display:"flex",flexDirection:"column"},children:[(0,O.jsx)(c.A,{children:e.title}),(0,O.jsx)(c.A,{variant:"caption",color:"text.secondary",children:e.description})]})},"tool-".concat(e.id)))})]}),$.tools.some(e=>{const t=v.find(t=>String(t.id)===String(e));return"GenieTool"===(null===t||void 0===t?void 0:t.title)})&&(0,O.jsxs)(o.A,{sx:{mt:2},children:[(0,O.jsx)(c.A,{variant:"subtitle2",sx:{mb:1},children:"Genie Space"}),F?(0,O.jsx)(P.A,{title:"Space ID: ".concat(F.id," - Click to open in Databricks"),arrow:!0,children:(0,O.jsx)(R.A,{label:F.name,size:"medium",color:"primary",variant:"outlined",onClick:async e=>{if(e.stopPropagation(),F)try{const e=ke.O.getInstance(),t=await e.getDatabricksConfig();if(t&&t.workspace_url){let e=t.workspace_url.startsWith("https://")?t.workspace_url:"https://".concat(t.workspace_url);e=e.replace(/\/$/,"");const n="".concat(e,"/genie/rooms/").concat(F.id,"/monitoring");window.open(n,"_blank","noopener,noreferrer")}else alert("Databricks workspace URL is not configured. Please configure it in Settings > Configuration > Databricks.")}catch(t){alert("Error opening Genie space. Please check the console for details.")}},onDelete:()=>{W(null),Z(e=>{const t=(0,a.A)({},e);return delete t.GenieTool,t})},deleteIcon:(0,O.jsx)(q.A,{fontSize:"small"}),sx:{cursor:"pointer","&:hover":{backgroundColor:"rgba(25, 118, 210, 0.08)"}}})}):(0,O.jsx)(o.A,{sx:{display:"flex",alignItems:"center",gap:1},children:(0,O.jsx)(Me,{value:"",onChange:(e,t)=>{e&&(W({id:e,name:t||e}),Z(n=>(0,a.A)((0,a.A)({},n),{},{GenieTool:{spaceId:e,spaceName:t||e}})))},label:"",placeholder:"Select a Genie space...",helperText:"",fullWidth:!0})})]}),$.tools.some(e=>{const t=v.find(t=>String(t.id)===String(e));return"PerplexityTool"===(null===t||void 0===t?void 0:t.title)})&&(0,O.jsx)(o.A,{sx:{mt:2},children:(0,O.jsx)(Je,{value:U,onChange:e=>{H(e),Z(t=>(0,a.A)((0,a.A)({},t),{},{PerplexityTool:e}))},label:"Perplexity Configuration",helperText:"Configure Perplexity AI search parameters for this agent",fullWidth:!0})}),$.tools.some(e=>{const t=v.find(t=>String(t.id)===String(e));return"SerperDevTool"===(null===t||void 0===t?void 0:t.title)})&&(0,O.jsx)(o.A,{sx:{mt:2},children:(0,O.jsx)(Qe,{value:K,onChange:e=>{G(e),Z(t=>(0,a.A)((0,a.A)({},t),{},{SerperDevTool:e}))},label:"Serper Configuration",helperText:"Configure Serper.dev search parameters for this agent",fullWidth:!0})}),(0,O.jsxs)(o.A,{sx:{mt:2},children:[J.length>0&&(0,O.jsxs)(o.A,{sx:{mb:2,p:2,backgroundColor:"rgba(25, 118, 210, 0.04)",borderRadius:1,border:"1px solid rgba(25, 118, 210, 0.12)"},children:[(0,O.jsxs)(c.A,{variant:"subtitle2",color:"primary",sx:{mb:1,fontWeight:600,fontSize:"0.875rem"},children:["Selected MCP Servers (",J.length,")"]}),(0,O.jsx)(o.A,{sx:{display:"flex",flexWrap:"wrap",gap:1},children:J.map(e=>(0,O.jsx)(R.A,{label:e,size:"medium",color:"primary",variant:"filled",onDelete:()=>{const t=J.filter(t=>t!==e);Y(t),Z(e=>(0,a.A)((0,a.A)({},e),{},{MCP_SERVERS:t}))},sx:{"& .MuiChip-deleteIcon":{fontSize:"18px","&:hover":{color:"error.main"}},fontWeight:500}},e))})]}),(0,O.jsx)(nt,{value:J,onChange:e=>{const t=Array.isArray(e)?e:e?[e]:[];Y(t),Z(e=>(0,a.A)((0,a.A)({},e),{},{MCP_SERVERS:t}))},label:"MCP Servers",placeholder:"Select MCP servers for this agent...",helperText:"Choose which MCP (Model Context Protocol) servers this agent should have access to",multiple:!0,fullWidth:!0})]}),(0,O.jsxs)(ae.A,{defaultExpanded:((null===(t=$.knowledge_sources)||void 0===t?void 0:t.length)||0)>0,children:[(0,O.jsx)(se.A,{expandIcon:(0,O.jsx)(pe.A,{}),children:(0,O.jsxs)(c.A,{children:["Knowledge Sources (",(null===(n=$.knowledge_sources)||void 0===n?void 0:n.length)||0,")"]})}),(0,O.jsx)(ie.A,{children:(0,O.jsxs)(o.A,{sx:{display:"flex",flexDirection:"column",gap:1},children:[$.knowledge_sources&&$.knowledge_sources.length>0?(0,O.jsx)(O.Fragment,{children:$.knowledge_sources.map((e,t)=>{var n;return(0,O.jsxs)(o.A,{sx:{p:1.5,border:"1px solid",borderColor:"divider",borderRadius:1,backgroundColor:"background.paper"},children:[(0,O.jsxs)(o.A,{sx:{display:"flex",alignItems:"center",gap:1},children:[(0,O.jsx)(R.A,{label:"databricks_volume"===e.type?"Databricks Volume":e.type,size:"small",color:"primary",variant:"outlined"}),(0,O.jsx)(c.A,{variant:"body2",sx:{flex:1},children:(null===(n=e.metadata)||void 0===n?void 0:n.filename)||e.source||"Unknown source"}),(0,O.jsx)(u.A,{size:"small",onClick:()=>{const e=($.knowledge_sources||[]).filter((e,n)=>n!==t);Ee("knowledge_sources",e)},title:"Remove knowledge source",children:(0,O.jsx)(q.A,{fontSize:"small"})})]}),e.metadata&&(0,O.jsx)(o.A,{sx:{mt:1,pl:2},children:(0,O.jsxs)(c.A,{variant:"caption",color:"text.secondary",children:["Uploaded: ",new Date(e.metadata.uploaded_at).toLocaleString()]})})]},t)})}):(0,O.jsx)(o.A,{sx:{py:2,textAlign:"center"},children:(0,O.jsx)(c.A,{variant:"body2",color:"text.secondary",children:"No knowledge sources configured for this agent"})}),(0,O.jsx)(c.A,{variant:"caption",color:"text.secondary",sx:{mt:2,display:"block"},children:"Knowledge sources can be uploaded through the chat panel. Select this agent when uploading files to automatically configure them as knowledge sources. Files are stored in Databricks volumes and enable retrieval-augmented generation (RAG) for improved agent responses."})]})})]}),(0,O.jsxs)(ae.A,{children:[(0,O.jsx)(se.A,{expandIcon:(0,O.jsx)(pe.A,{}),children:(0,O.jsx)(c.A,{children:"LLM Configuration"})}),(0,O.jsx)(ie.A,{children:(0,O.jsxs)(ce.Ay,{container:!0,spacing:2,children:[(0,O.jsx)(ce.Ay,{item:!0,xs:12,children:(0,O.jsxs)(oe.A,{fullWidth:!0,children:[(0,O.jsx)(re.A,{children:"LLM Model"}),(0,O.jsx)(le.A,{value:w?"":$.llm,onChange:e=>Ee("llm",e.target.value),label:"LLM Model",disabled:w,children:w?(0,O.jsx)(de.A,{value:"",disabled:!0,children:(0,O.jsxs)(o.A,{sx:{display:"flex",alignItems:"center"},children:[(0,O.jsx)(ue.A,{size:20,sx:{mr:1}}),"Loading models..."]})},"loading-models"):Object.keys(b).length>0?Object.entries(b).map(e=>{let[t,n]=e;return(0,O.jsxs)(de.A,{value:t,children:[n.name,n.provider&&(0,O.jsxs)(c.A,{variant:"caption",sx:{ml:1,color:"text.secondary"},children:["(",n.provider,")"]})]},"llm-model-".concat(t))}):(0,O.jsxs)(de.A,{value:$.llm,children:[$.llm||"Default Model"," (No models available)"]},"no-models")})]})}),(0,O.jsx)(ce.Ay,{item:!0,xs:12,children:(0,O.jsx)(V.A,{fullWidth:!0,type:"number",label:"Temperature Override (0-100)",value:$.temperature||"",onChange:e=>{const t=e.target.value?parseInt(e.target.value):void 0;(void 0===t||t>=0&&t<=100)&&Ee("temperature",t)},helperText:"Override the default model temperature. 0 = deterministic, 100 = creative. Leave empty to use model default.",InputProps:{inputProps:{min:0,max:100}}})}),(0,O.jsx)(ce.Ay,{item:!0,xs:12,children:(0,O.jsxs)(oe.A,{fullWidth:!0,children:[(0,O.jsx)(re.A,{children:"Function Calling LLM"}),(0,O.jsxs)(le.A,{value:w?"":$.function_calling_llm||"",onChange:e=>Ee("function_calling_llm",e.target.value),label:"Function Calling LLM",disabled:w,children:[(0,O.jsx)(de.A,{value:"",children:(0,O.jsx)("em",{children:"Default"})},"default-function-model"),w?(0,O.jsx)(de.A,{value:"",disabled:!0,children:(0,O.jsxs)(o.A,{sx:{display:"flex",alignItems:"center"},children:[(0,O.jsx)(ue.A,{size:20,sx:{mr:1}}),"Loading models..."]})},"loading-function-models"):Q.length>0?Q.map(e=>{let[t,n]=e;return(0,O.jsxs)(de.A,{value:t,children:[n.name,n.provider&&(0,O.jsxs)(c.A,{variant:"caption",sx:{ml:1,color:"text.secondary"},children:["(",n.provider,")"]})]},"func-model-".concat(t))}):(0,O.jsx)(de.A,{value:$.function_calling_llm||"",disabled:!0,children:"No function calling models available"},"no-function-models")]})]})})]})})]}),(0,O.jsxs)(ae.A,{children:[(0,O.jsx)(se.A,{expandIcon:(0,O.jsx)(pe.A,{}),children:(0,O.jsx)(c.A,{children:"Execution Settings"})}),(0,O.jsx)(ie.A,{children:(0,O.jsxs)(ce.Ay,{container:!0,spacing:2,children:[(0,O.jsx)(ce.Ay,{item:!0,xs:12,md:4,children:(0,O.jsx)(V.A,{fullWidth:!0,type:"number",label:"Max Iterations",value:$.max_iter,onChange:e=>Ee("max_iter",parseInt(e.target.value))})}),(0,O.jsx)(ce.Ay,{item:!0,xs:12,md:4,children:(0,O.jsx)(V.A,{fullWidth:!0,type:"number",label:"Max RPM",value:$.max_rpm||"",onChange:e=>Ee("max_rpm",e.target.value?parseInt(e.target.value):void 0)})}),(0,O.jsx)(ce.Ay,{item:!0,xs:12,md:4,children:(0,O.jsx)(V.A,{fullWidth:!0,type:"number",label:"Max Execution Time (s)",value:$.max_execution_time||"",onChange:e=>Ee("max_execution_time",e.target.value?parseInt(e.target.value):void 0)})}),(0,O.jsx)(ce.Ay,{item:!0,xs:12,md:4,children:(0,O.jsx)(V.A,{fullWidth:!0,type:"number",label:"Max Retry Limit",value:$.max_retry_limit,onChange:e=>Ee("max_retry_limit",parseInt(e.target.value))})})]})})]}),(0,O.jsxs)(ae.A,{children:[(0,O.jsx)(se.A,{expandIcon:(0,O.jsx)(pe.A,{}),children:(0,O.jsx)(c.A,{children:"Behavior Settings"})}),(0,O.jsx)(ie.A,{children:(0,O.jsxs)(ce.Ay,{container:!0,spacing:2,children:[(0,O.jsx)(ce.Ay,{item:!0,xs:12,md:6,children:(0,O.jsx)(he.A,{control:(0,O.jsx)(me.A,{checked:$.memory,onClick:e=>{e.stopPropagation(),e.preventDefault(),Ee("memory",!$.memory)},onChange:e=>{e.stopPropagation()},onMouseDown:e=>{e.stopPropagation()},onTouchStart:e=>{e.stopPropagation()}}),label:"Enable Memory",onClick:e=>{e.stopPropagation()}})}),(0,O.jsx)(ce.Ay,{item:!0,xs:12,md:6,children:(0,O.jsx)(he.A,{control:(0,O.jsx)(me.A,{checked:$.verbose,onClick:e=>{e.stopPropagation(),e.preventDefault(),Ee("verbose",!$.verbose)},onChange:e=>{e.stopPropagation()},onMouseDown:e=>{e.stopPropagation()},onTouchStart:e=>{e.stopPropagation()}}),label:"Verbose Mode",onClick:e=>{e.stopPropagation()}})}),(0,O.jsx)(ce.Ay,{item:!0,xs:12,md:6,children:(0,O.jsx)(he.A,{control:(0,O.jsx)(me.A,{checked:$.allow_delegation,onClick:e=>{e.stopPropagation(),e.preventDefault(),Ee("allow_delegation",!$.allow_delegation)},onChange:e=>{e.stopPropagation()},onMouseDown:e=>{e.stopPropagation()},onTouchStart:e=>{e.stopPropagation()}}),label:"Allow Delegation",onClick:e=>{e.stopPropagation()}})}),(0,O.jsx)(ce.Ay,{item:!0,xs:12,md:6,children:(0,O.jsx)(he.A,{control:(0,O.jsx)(me.A,{checked:$.cache,onClick:e=>{e.stopPropagation(),e.preventDefault(),Ee("cache",!$.cache)},onChange:e=>{e.stopPropagation()},onMouseDown:e=>{e.stopPropagation()},onTouchStart:e=>{e.stopPropagation()}}),label:"Enable Cache",onClick:e=>{e.stopPropagation()}})}),(0,O.jsx)(ce.Ay,{item:!0,xs:12,md:6,children:(0,O.jsx)(he.A,{control:(0,O.jsx)(me.A,{checked:$.use_system_prompt,onClick:e=>{e.stopPropagation(),e.preventDefault(),Ee("use_system_prompt",!$.use_system_prompt)},onChange:e=>{e.stopPropagation()},onMouseDown:e=>{e.stopPropagation()},onTouchStart:e=>{e.stopPropagation()}}),label:"Use System Prompt",onClick:e=>{e.stopPropagation()}})}),(0,O.jsx)(ce.Ay,{item:!0,xs:12,md:6,children:(0,O.jsx)(he.A,{control:(0,O.jsx)(me.A,{checked:$.respect_context_window,onClick:e=>{e.stopPropagation(),e.preventDefault(),Ee("respect_context_window",!$.respect_context_window)},onChange:e=>{e.stopPropagation()},onMouseDown:e=>{e.stopPropagation()},onTouchStart:e=>{e.stopPropagation()}}),label:"Respect Context Window",onClick:e=>{e.stopPropagation()}})})]})})]}),(0,O.jsxs)(ae.A,{children:[(0,O.jsx)(se.A,{expandIcon:(0,O.jsx)(pe.A,{}),children:(0,O.jsx)(c.A,{children:"Memory Configuration"})}),(0,O.jsx)(ie.A,{children:(0,O.jsxs)(ce.Ay,{container:!0,spacing:2,children:[(0,O.jsx)(ce.Ay,{item:!0,xs:12,children:(0,O.jsx)(c.A,{variant:"subtitle2",sx:{mb:1},children:"Memory provides agents with the ability to remember past interactions and context"})}),(0,O.jsx)(ce.Ay,{item:!0,xs:12,md:6,children:(0,O.jsxs)(oe.A,{fullWidth:!0,disabled:!$.memory,children:[(0,O.jsx)(re.A,{children:"Embedding Provider"}),(0,O.jsxs)(le.A,{value:(null===(s=$.embedder_config)||void 0===s?void 0:s.provider)||"databricks",onChange:e=>{const t=$.embedder_config||{},n=e.target.value;let s="text-embedding-3-small";"databricks"===n?s="databricks-gte-large-en":"ollama"===n?s="nomic-embed-text":"google"===n&&(s="text-embedding-004"),Ee("embedder_config",(0,a.A)((0,a.A)({},t),{},{provider:n,config:(0,a.A)((0,a.A)({},t.config||{}),{},{model:s})}))},label:"Embedding Provider",children:[(0,O.jsx)(de.A,{value:"databricks",children:"Databricks (Default)"}),(0,O.jsx)(de.A,{value:"openai",children:"OpenAI"}),(0,O.jsx)(de.A,{value:"ollama",children:"Ollama"}),(0,O.jsx)(de.A,{value:"google",children:"Google AI"}),(0,O.jsx)(de.A,{value:"azure",children:"Azure OpenAI"}),(0,O.jsx)(de.A,{value:"vertex",children:"Vertex AI"}),(0,O.jsx)(de.A,{value:"cohere",children:"Cohere"}),(0,O.jsx)(de.A,{value:"voyage",children:"VoyageAI"}),(0,O.jsx)(de.A,{value:"huggingface",children:"HuggingFace"}),(0,O.jsx)(de.A,{value:"watson",children:"Watson"}),(0,O.jsx)(de.A,{value:"bedrock",children:"Amazon Bedrock"})]})]})}),(0,O.jsx)(ce.Ay,{item:!0,xs:12,md:6,children:(0,O.jsx)(V.A,{fullWidth:!0,label:"Embedding Model",value:(null===(h=$.embedder_config)||void 0===h||null===(h=h.config)||void 0===h?void 0:h.model)||"databricks-gte-large-en",onChange:e=>{const t=$.embedder_config||{provider:"databricks",config:{model:"databricks-gte-large-en"}},n=t.config||{};Ee("embedder_config",(0,a.A)((0,a.A)({},t),{},{config:(0,a.A)((0,a.A)({},n),{},{model:e.target.value})}))},disabled:!$.memory,helperText:"Model to use for text embeddings (e.g., databricks-gte-large-en for Databricks, text-embedding-3-small for OpenAI)"})}),(0,O.jsxs)(ce.Ay,{item:!0,xs:12,children:[(0,O.jsx)(te.A,{sx:{my:2}}),(0,O.jsx)(m.A,{severity:"info",sx:{mt:2},children:(0,O.jsxs)(c.A,{variant:"body2",children:["Memory storage backend is configured globally in the Configuration settings.",$.memory_backend_config&&(0,O.jsxs)(O.Fragment,{children:[(0,O.jsx)("br",{}),"Current backend: ",(0,O.jsx)("strong",{children:"databricks"===$.memory_backend_config.backend_type?"Databricks Vector Search":"Default (ChromaDB + SQLite)"})]})]})})]}),(0,O.jsxs)(ce.Ay,{item:!0,xs:12,children:[(0,O.jsx)(c.A,{variant:"body2",color:"text.secondary",sx:{mt:1},children:"The agent uses three memory types:"}),(0,O.jsxs)("ul",{style:{color:"rgba(0, 0, 0, 0.6)",paddingLeft:"20px",margin:"4px 0"},children:[(0,O.jsx)("li",{children:"Short-Term Memory: Stores recent conversations and context"}),(0,O.jsx)("li",{children:"Long-Term Memory: Preserves insights and learnings between executions"}),(0,O.jsx)("li",{children:"Entity Memory: Tracks information about important entities"})]})]})]})})]})]})}),(0,O.jsxs)(o.A,{sx:{display:"flex",gap:2,justifyContent:"flex-end",p:2,backgroundColor:"white",borderTop:"1px solid rgba(0, 0, 0, 0.12)",position:"static",width:"100%",zIndex:1100},children:[g&&(0,O.jsx)(x.A,{onClick:g,variant:"outlined",children:"Cancel"}),(0,O.jsx)(x.A,{onClick:async()=>{if(!$)return;const e=JSON.parse(JSON.stringify($));let t=(0,a.A)({},X);F&&e.tools.some(e=>{const t=v.find(t=>String(t.id)===String(e));return"GenieTool"===(null===t||void 0===t?void 0:t.title)})?t=(0,a.A)((0,a.A)({},t),{},{GenieTool:{spaceId:F.id,spaceName:F.name}}):F||delete t.GenieTool,U&&Object.keys(U).length>0&&e.tools.some(e=>{const t=v.find(t=>String(t.id)===String(e));return"PerplexityTool"===(null===t||void 0===t?void 0:t.title)})?t=(0,a.A)((0,a.A)({},t),{},{PerplexityTool:U}):e.tools.some(e=>{const t=v.find(t=>String(t.id)===String(e));return"PerplexityTool"===(null===t||void 0===t?void 0:t.title)})||delete t.PerplexityTool,K&&Object.keys(K).length>0&&e.tools.some(e=>{const t=v.find(t=>String(t.id)===String(e));return"SerperDevTool"===(null===t||void 0===t?void 0:t.title)})?t=(0,a.A)((0,a.A)({},t),{},{SerperDevTool:K}):e.tools.some(e=>{const t=v.find(t=>String(t.id)===String(e));return"SerperDevTool"===(null===t||void 0===t?void 0:t.title)})||delete t.SerperDevTool,J&&J.length>0?t=(0,a.A)((0,a.A)({},t),{},{MCP_SERVERS:{servers:J}}):delete t.MCP_SERVERS,Object.keys(t).length>0&&(e.tool_configs=t),e.memory||(delete e.embedder_config,delete e.memory_backend_config),e.knowledge_sources&&e.knowledge_sources.length>0&&(e.knowledge_sources=e.knowledge_sources.map(e=>"text"!==e.type&&"url"!==e.type&&e.source?(0,a.A)((0,a.A)({},e),{},{fileInfo:e.fileInfo||{filename:e.source.split("/").pop()||"",path:e.source,exists:!1,is_uploaded:!0}}):e)),je(!0);try{let t;t=null!==p&&void 0!==p&&p.id?await fe.AgentService.updateAgentFull(p.id,e):await fe.AgentService.createAgent(e),t&&f&&(t.id&&y(t.id,t),f(t))}catch(n){}finally{je(!1)}},variant:"contained",color:"primary",children:"Save"})]})]}),(0,O.jsxs)(r.A,{open:C,onClose:De,fullWidth:!0,maxWidth:"md",children:[(0,O.jsx)(d.A,{children:(0,O.jsxs)(o.A,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:["Agent Goal",(0,O.jsx)(u.A,{onClick:De,children:(0,O.jsx)(D.A,{})})]})}),(0,O.jsx)(l.A,{children:(0,O.jsx)(V.A,{autoFocus:!0,fullWidth:!0,multiline:!0,rows:15,value:$.goal,onChange:e=>Ee("goal",e.target.value),variant:"outlined",sx:{mt:2}})}),(0,O.jsx)(B.A,{children:(0,O.jsx)(x.A,{onClick:De,variant:"contained",children:"Done"})})]}),(0,O.jsxs)(r.A,{open:_,onClose:Ne,fullWidth:!0,maxWidth:"md",children:[(0,O.jsx)(d.A,{children:(0,O.jsxs)(o.A,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:["Agent Backstory",(0,O.jsx)(u.A,{onClick:Ne,children:(0,O.jsx)(D.A,{})})]})}),(0,O.jsx)(l.A,{children:(0,O.jsx)(V.A,{autoFocus:!0,fullWidth:!0,multiline:!0,rows:15,value:$.backstory,onChange:e=>Ee("backstory",e.target.value),variant:"outlined",sx:{mt:2}})}),(0,O.jsx)(B.A,{children:(0,O.jsx)(x.A,{onClick:Ne,variant:"contained",children:"Done"})})]}),(0,O.jsxs)(r.A,{open:I,onClose:Pe,fullWidth:!0,maxWidth:"md",children:[(0,O.jsx)(d.A,{children:(0,O.jsxs)(o.A,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:["System Template",(0,O.jsx)(u.A,{onClick:Pe,children:(0,O.jsx)(D.A,{})})]})}),(0,O.jsx)(l.A,{children:(0,O.jsx)(V.A,{autoFocus:!0,fullWidth:!0,multiline:!0,rows:15,value:$.system_template||"",onChange:e=>Ee("system_template",e.target.value),variant:"outlined",sx:{mt:2}})}),(0,O.jsx)(B.A,{children:(0,O.jsx)(x.A,{onClick:Pe,variant:"contained",children:"Done"})})]}),(0,O.jsxs)(r.A,{open:N,onClose:ze,fullWidth:!0,maxWidth:"md",children:[(0,O.jsx)(d.A,{children:(0,O.jsxs)(o.A,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:["Prompt Template",(0,O.jsx)(u.A,{onClick:ze,children:(0,O.jsx)(D.A,{})})]})}),(0,O.jsx)(l.A,{children:(0,O.jsx)(V.A,{autoFocus:!0,fullWidth:!0,multiline:!0,rows:15,value:$.prompt_template||"",onChange:e=>Ee("prompt_template",e.target.value),variant:"outlined",sx:{mt:2}})}),(0,O.jsx)(B.A,{children:(0,O.jsx)(x.A,{onClick:ze,variant:"contained",children:"Done"})})]}),(0,O.jsxs)(r.A,{open:z,onClose:Oe,fullWidth:!0,maxWidth:"md",children:[(0,O.jsx)(d.A,{children:(0,O.jsxs)(o.A,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:["Response Template",(0,O.jsx)(u.A,{onClick:Oe,children:(0,O.jsx)(D.A,{})})]})}),(0,O.jsx)(l.A,{children:(0,O.jsx)(V.A,{autoFocus:!0,fullWidth:!0,multiline:!0,rows:15,value:$.response_template||"",onChange:e=>Ee("response_template",e.target.value),variant:"outlined",sx:{mt:2}})}),(0,O.jsx)(B.A,{children:(0,O.jsx)(x.A,{onClick:Oe,variant:"contained",children:"Done"})})]}),(0,O.jsx)(mt,{open:Se,onClose:()=>_e(!1)})]})};var gt=n(95849);const ft=()=>{const{getActiveTab:e,markTabDirty:t}=C();return{markCurrentTabDirty:(0,i.useCallback)(()=>{const n=e();n&&(t(n.id),window.dispatchEvent(new CustomEvent("tabMarkedDirty",{detail:{tabId:n.id,tabName:n.name}})))},[e,t]),markTabDirtyById:(0,i.useCallback)(e=>{t(e),window.dispatchEvent(new CustomEvent("tabMarkedDirty",{detail:{tabId:e}}))},[t])}},vt=e=>{var t,n,s,d,h;let{data:m,id:p}=e;const{setNodes:x,setEdges:g,getNodes:f,getEdges:v}=(0,A.VH)(),[y,b]=(0,i.useState)(!1),[j,w]=(0,i.useState)([]),[k,C]=(0,i.useState)(!1),{markCurrentTabDirty:S}=ft(),{getAgent:_,updateAgent:E}=(0,Ce.o)(),[I,T]=(0,i.useState)(null);(0,i.useEffect)(()=>{if(m.agentId){const e=async()=>{const e=await _(m.agentId);T(e)};e()}},[m.agentId,_]),(0,i.useEffect)(()=>{D()},[]);const D=async()=>{try{const e=await gt.m.listTools();w(e.map(e=>(0,a.A)((0,a.A)({},e),{},{id:String(e.id)})))}catch(e){}},N=(0,i.useCallback)(()=>{C(e=>!e)},[p,k]),M=(0,i.useCallback)(()=>{x(e=>e.filter(e=>e.id!==p)),g(e=>e.filter(e=>e.source!==p&&e.target!==p))},[p,x,g]);(0,i.useEffect)(()=>{},[y]);const z=(0,i.useCallback)(()=>{const e=f(),t=v(),n=[...e.filter(e=>"taskNode"===e.type).filter(e=>!t.some(t=>t.target===e.id))].sort((e,t)=>e.position.y-t.position.y);if(n.length>0){const e=n[0],t={id:"".concat(p,"-").concat(e.id),source:p,target:e.id,type:"default"};g(e=>[...e,t])}},[p,f,v,g]),L=(0,i.useCallback)(async e=>{try{var t;E((null===(t=e.id)||void 0===t?void 0:t.toString())||m.agentId,e),T(e),x(t=>t.map(t=>t.id===p?(0,a.A)((0,a.A)({},t),{},{data:(0,a.A)((0,a.A)({},t.data),{},{label:e.name,role:e.role,goal:e.goal,backstory:e.backstory,tools:e.tools,tool_configs:e.tool_configs||{},llm:e.llm,function_calling_llm:e.function_calling_llm,max_iter:e.max_iter,max_rpm:e.max_rpm,max_execution_time:e.max_execution_time,memory:e.memory,verbose:e.verbose,allow_delegation:e.allow_delegation,cache:e.cache,system_template:e.system_template,prompt_template:e.prompt_template,response_template:e.response_template,allow_code_execution:e.allow_code_execution,code_execution_mode:e.code_execution_mode,max_retry_limit:e.max_retry_limit,use_system_prompt:e.use_system_prompt,respect_context_window:e.respect_context_window,embedder_config:e.embedder_config,knowledge_sources:e.knowledge_sources})}):t))}catch(n){}},[p,x,E,m.agentId]);(0,i.useEffect)(()=>{y&&m.knowledge_sources!==(null===I||void 0===I?void 0:I.knowledge_sources)&&T(e=>e?(0,a.A)((0,a.A)({},e),{},{knowledge_sources:m.knowledge_sources||[]}):null)},[m.knowledge_sources,y,null===I||void 0===I?void 0:I.knowledge_sources]);const F=(0,i.useCallback)(e=>{e.preventDefault(),e.stopPropagation();const t=e.target,n=!!t.closest("button"),a=!!t.closest(".action-buttons");n||a||N()},[p,N]),W=null===(t=m.knowledge_sources)||void 0===t?void 0:t.some(e=>{var t;return"databricks_volume"===e.type||"text"!==e.type&&"url"!==e.type&&(null===(t=e.fileInfo)||void 0===t?void 0:t.exists)}),R=(null===(n=m.tools)||void 0===n?void 0:n.includes("DatabricksKnowledgeSearchTool"))||(null===(s=m.tools)||void 0===s?void 0:s.includes("36"));return(0,O.jsxs)(o.A,{sx:(0,a.A)((0,a.A)({},(()=>{const e={width:160,minHeight:140,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"space-between",gap:.1,position:"relative",background:e=>k?"".concat(e.palette.primary.light,"20"):e.palette.background.paper,borderRadius:"12px",boxShadow:e=>k?"0 0 0 2px ".concat(e.palette.primary.main):"0 2px 4px ".concat("light"===e.palette.mode?"rgba(0, 0, 0, 0.1)":"rgba(0, 0, 0, 0.4)"),border:e=>"1px solid ".concat(k?e.palette.primary.main:e.palette.primary.light),transition:"all 0.3s ease",padding:"16px 8px","&:hover":{boxShadow:e=>"0 4px 12px ".concat("light"===e.palette.mode?"rgba(0, 0, 0, 0.2)":"rgba(0, 0, 0, 0.6)"),transform:"translateY(-1px)"},"& .action-buttons":{display:"none",position:"absolute",top:2,right:4,gap:"2px"},"&:hover .action-buttons":{display:"flex"}};return m.isActive?(0,a.A)((0,a.A)({},e),{},{background:e=>"light"===e.palette.mode?"rgba(".concat(e.palette.primary.main,", 0.15)"):e.palette.background.paper,border:e=>"3px solid ".concat(e.palette.primary.main),transform:"scale(1.05)",boxShadow:e=>"0 0 12px ".concat(e.palette.primary.main,"70"),"&::before":{content:'"ACTIVE"',position:"absolute",top:"-10px",left:"50%",transform:"translateX(-50%)",backgroundColor:e=>e.palette.primary.main,color:e=>e.palette.primary.contrastText,padding:"2px 6px",borderRadius:"4px",fontSize:"11px",fontWeight:"bold",zIndex:10}}):m.isCompleted?(0,a.A)((0,a.A)({},e),{},{background:e=>"light"===e.palette.mode?"rgba(".concat(e.palette.success.main,", 0.1)"):e.palette.background.paper,border:e=>"2px solid ".concat(e.palette.success.main),boxShadow:e=>"0 0 8px ".concat(e.palette.success.main,"70"),"&::before":{content:'"COMPLETED"',position:"absolute",top:"-10px",left:"50%",transform:"translateX(-50%)",backgroundColor:e=>e.palette.success.main,color:"#ffffff",padding:"2px 6px",borderRadius:"4px",fontSize:"10px",fontWeight:"bold",zIndex:10}}):e})()),{},{cursor:"move"}),onClick:F,"data-agentid":m.agentId,"data-nodeid":p,"data-nodetype":"agent","data-selected":k?"true":"false",children:[R&&(0,O.jsx)(o.A,{sx:{position:"absolute",top:4,left:4,color:"primary.main",display:"flex"},children:(0,O.jsx)(P.A,{title:"Has Knowledge Search capability for attached documents",disableInteractive:!0,placement:"top",children:(0,O.jsx)($.A,{fontSize:"small"})})}),W&&!R&&(0,O.jsx)(o.A,{sx:{position:"absolute",top:4,left:4,color:"success.main",display:"flex"},children:(0,O.jsx)(P.A,{title:"Has ".concat((null===(d=m.knowledge_sources)||void 0===d?void 0:d.length)||0," knowledge source(s)"),disableInteractive:!0,placement:"top",children:(0,O.jsx)(Q.A,{fontSize:"small"})})}),(0,O.jsx)(A.h7,{type:"source",position:A.yX.Right,style:{background:"#2196f3",width:"7px",height:"7px"},onDoubleClick:z}),(0,O.jsx)(o.A,{sx:{backgroundColor:e=>"".concat(e.palette.primary.main,"20"),borderRadius:"50%",padding:"8px",display:"flex",alignItems:"center",justifyContent:"center",border:e=>"2px solid ".concat(e.palette.primary.main)},children:(0,O.jsx)(J.A,{sx:{color:e=>e.palette.primary.main,fontSize:"1.5rem"}})}),(0,O.jsx)(c.A,{variant:"body2",sx:{fontWeight:500,textAlign:"center",color:e=>e.palette.primary.main,maxWidth:"140px",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:m.role||"Agent"}),(0,O.jsxs)(o.A,{sx:{background:e=>"linear-gradient(135deg, ".concat(e.palette.primary.main,"15, ").concat(e.palette.primary.main,"30)"),borderRadius:"4px",padding:"2px 6px",display:"flex",alignItems:"center",justifyContent:"center",mt:.25,mb:.25,border:e=>"1px solid ".concat(e.palette.primary.main,"20"),boxShadow:e=>"0 1px 2px ".concat(e.palette.primary.main,"10"),transition:"all 0.2s ease",maxWidth:"120px","&:hover":{background:e=>"linear-gradient(135deg, ".concat(e.palette.primary.main,"25, ").concat(e.palette.primary.main,"40)"),boxShadow:e=>"0 2px 4px ".concat(e.palette.primary.main,"15")}},children:[(0,O.jsx)(Z.A,{sx:{fontSize:"0.65rem",mr:.25,color:e=>e.palette.primary.main,opacity:.8}}),(0,O.jsx)(c.A,{variant:"caption",sx:{color:e=>e.palette.primary.main,fontSize:"0.65rem",fontWeight:500,textAlign:"center",maxWidth:"100px",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:m.llm||"databricks-llama-4-maverick"})]}),(0,O.jsxs)(o.A,{sx:{display:"flex",gap:1,mt:1},children:[m.allow_code_execution&&(0,O.jsx)(P.A,{title:"Code Execution Enabled",disableInteractive:!0,placement:"top",children:(0,O.jsx)("div",{children:(0,O.jsx)(X.A,{sx:{fontSize:"1rem",color:"#2196f3"}})})}),m.memory&&(0,O.jsx)(P.A,{title:"Memory: ".concat(null!==(h=m.embedder_config)&&void 0!==h&&h.provider?"".concat(m.embedder_config.provider," embeddings"):"OpenAI embeddings (default)"),disableInteractive:!0,placement:"top",children:(0,O.jsx)("div",{children:(0,O.jsx)(Z.A,{sx:{fontSize:"1rem",color:"#2196f3"}})})})]}),(0,O.jsxs)(o.A,{className:"action-buttons",children:[(0,O.jsx)(P.A,{title:"Edit Agent",disableInteractive:!0,placement:"top",children:(0,O.jsx)(u.A,{size:"small",onClick:async()=>{try{document.activeElement&&document.activeElement.blur();const e=m.agentId||m.id||m.agent_id;if(!e){const e={id:void 0,name:String(m.label||m.name||""),role:String(m.role||""),goal:String(m.goal||""),backstory:String(m.backstory||""),llm:String(m.llm||""),tools:m.tools||[],max_iter:m.max_iter||25,verbose:m.verbose||!1,allow_delegation:m.allow_delegation||!1,cache:m.cache||!0,allow_code_execution:m.allow_code_execution||!1,code_execution_mode:"unsafe"===m.code_execution_mode?"unsafe":"safe",memory:m.memory,tool_configs:m.tool_configs,temperature:"number"===typeof m.temperature?m.temperature:void 0,function_calling_llm:m.function_calling_llm,max_rpm:m.max_rpm,max_execution_time:m.max_execution_time,embedder_config:m.embedder_config,knowledge_sources:m.knowledge_sources};return T(e),void b(!0)}const t=await _(e);if(t)T(t),b(!0)}catch(e){}},sx:{opacity:.4,padding:"4px","&:hover":{opacity:1,backgroundColor:"transparent"}},children:(0,O.jsx)(Y.A,{sx:{fontSize:"1rem",color:"#2196f3"}})})}),(0,O.jsx)(P.A,{title:"Delete Agent",disableInteractive:!0,placement:"top",children:(0,O.jsx)(u.A,{size:"small",onClick:M,sx:{opacity:.4,padding:"4px","&:hover":{opacity:1,backgroundColor:"transparent"}},children:(0,O.jsx)(q.A,{sx:{fontSize:"1rem",color:"#2196f3"}})})})]}),y&&I&&(0,O.jsx)(r.A,{open:y,onClose:()=>b(!1),maxWidth:"md",fullWidth:!0,PaperProps:{sx:{display:"flex",flexDirection:"column",height:"85vh",maxHeight:"85vh"}},children:(0,O.jsx)(l.A,{sx:{p:2,overflow:"hidden",display:"flex",flexDirection:"column",flex:1},children:(0,O.jsx)(xt,{initialData:I,tools:j,onCancel:()=>b(!1),onAgentSaved:e=>{b(!1),e&&(S(),L(e))}})})})]})},At=i.memo(vt);var yt=n(28169),bt=n(1589);const jt=[{value:"DetailedOutputLogger",label:"Detailed Output Logger",description:"Logs detailed task output and execution metrics"},{value:"SchemaValidator",label:"Schema Validator",description:"Validates output against a JSON schema"},{value:"ContentValidator",label:"Content Validator",description:"Validates output content against specified rules"},{value:"TypeValidator",label:"Type Validator",description:"Validates output data types"},{value:"JsonFileStorage",label:"JSON File Storage",description:"Stores output in a JSON file",requiresPath:!0},{value:"DatabaseStorage",label:"Database Storage",description:"Stores output in a database"},{value:"FileSystemStorage",label:"File System Storage",description:"Stores output in the file system",requiresPath:!0},{value:"DatabricksVolumeCallback",label:"Databricks Volume Storage",description:"Stores output in Databricks Volumes",requiresPath:!1},{value:"OutputFormatter",label:"Output Formatter",description:"Formats output according to specified rules"},{value:"DataExtractor",label:"Data Extractor",description:"Extracts specific data from the output"},{value:"OutputEnricher",label:"Output Enricher",description:"Enriches output with additional data"},{value:"OutputSummarizer",label:"Output Summarizer",description:"Creates a summary of the output"}];class wt{constructor(){this.CACHE_TTL=3e5,this.schemasCache=null,this.schemasByTypeCache={},this.clearCaches()}static getInstance(){return wt.instance||(wt.instance=new wt),wt.instance}isCacheValid(e){return!!e&&Date.now()<e.expiry}setCache(e,t){const n=Date.now();return{data:t,timestamp:n,expiry:n+this.CACHE_TTL}}clearCaches(){this.schemasCache=null,this.schemasByTypeCache={}}async getSchemas(){if(this.isCacheValid(this.schemasCache)&&this.schemasCache)return this.schemasCache.data;try{const e=await ye.uE.get("/schemas");if(e.data&&e.data.schemas){let t=e.data.schemas;return t=t.map(e=>{try{if(e.schema_definition&&"string"===typeof e.schema_definition)return(0,a.A)((0,a.A)({},e),{},{schema_definition:JSON.parse(e.schema_definition)})}catch(t){}return e}),this.schemasCache=this.setCache(this.schemasCache,t),t}return[]}catch(e){return[]}}async getSchemasByType(e){const t=this.schemasByTypeCache[e];if(this.isCacheValid(t))return t.data;try{const n=await ye.uE.get("/schemas/by-type/".concat(e));if(n.data&&n.data.schemas){const a=n.data.schemas;return this.schemasByTypeCache[e]=this.setCache(t,a),a}return[]}catch(n){return[]}}async getSchema(e){try{const t=await ye.uE.get("/schemas/".concat(e));if(t.data){let e=t.data;try{e.schema_definition&&"string"===typeof e.schema_definition&&(e=(0,a.A)((0,a.A)({},e),{},{schema_definition:JSON.parse(e.schema_definition)}))}catch(n){}return e}return null}catch(n){if(Ae.A.isAxiosError(n)){var t;if(404===(null===(t=n.response)||void 0===t?void 0:t.status))return null}return null}}async createSchema(e){try{const t=(0,a.A)({},e),n=await ye.uE.post("/schemas",t);return n.data?(this.clearCaches(),n.data):null}catch(s){if(s&&"object"===typeof s&&"response"in s){var t,n;const e=s;if(422===(null===(t=e.response)||void 0===t?void 0:t.status)&&null!==(n=e.response)&&void 0!==n&&n.data){const t=e.response.data;throw new Error("Validation error: ".concat(JSON.stringify(t.detail)))}}throw s}}async updateSchema(e,t){try{const n=(0,a.A)({},t),s=await ye.uE.put("/schemas/".concat(e),n);return s.data?(this.clearCaches(),s.data):null}catch(n){return null}}async deleteSchema(e){try{return await ye.uE.delete("/schemas/".concat(e)),this.clearCaches(),!0}catch(t){return!1}}}wt.instance=void 0;const kt={volume_path:"main.default.task_outputs",file_format:"json",create_date_dirs:!0,max_file_size_mb:50},Ct=e=>{let{config:t,onChange:n}=e;const[s,r]=(0,i.useState)(()=>t||kt);(0,i.useEffect)(()=>{r(t||kt)},[t]);const l=(e,t)=>{const i=(0,a.A)((0,a.A)({},s),{},{[e]:t});r(i),n(i)};return(0,O.jsxs)(o.A,{sx:{mt:2,p:2,border:"1px solid",borderColor:"divider",borderRadius:1},children:[(0,O.jsx)(c.A,{variant:"subtitle2",color:"primary",sx:{mb:2},children:"Databricks Volume Configuration"}),(0,O.jsx)(m.A,{severity:"info",sx:{mb:2},children:"Task outputs will be uploaded to Databricks Volumes. Ensure DATABRICKS_HOST and DATABRICKS_TOKEN environment variables are set, or configure them below."}),(0,O.jsx)(V.A,{fullWidth:!0,label:"Volume Path",value:s.volume_path,onChange:e=>l("volume_path",e.target.value),helperText:"Format: catalog.schema.volume (e.g., catalog.schema.volume)",placeholder:"catalog.schema.volume",sx:{mb:2},required:!0}),(0,O.jsxs)(oe.A,{fullWidth:!0,sx:{mb:2},children:[(0,O.jsx)(re.A,{children:"File Format"}),(0,O.jsxs)(le.A,{value:s.file_format,onChange:e=>{l("file_format",e.target.value)},label:"File Format",children:[(0,O.jsx)(de.A,{value:"json",children:"JSON"}),(0,O.jsx)(de.A,{value:"csv",children:"CSV"}),(0,O.jsx)(de.A,{value:"txt",children:"Text"})]})]}),(0,O.jsx)(he.A,{control:(0,O.jsx)(me.A,{checked:s.create_date_dirs,onChange:e=>l("create_date_dirs",e.target.checked)}),label:"Create Date-based Directories",sx:{mb:2}}),(0,O.jsx)(c.A,{variant:"caption",color:"text.secondary",sx:{display:"block",mt:1},children:"Optional: Override environment variables (leave empty to use defaults)"}),(0,O.jsx)(V.A,{fullWidth:!0,label:"Workspace URL (Optional)",value:s.workspace_url||"",onChange:e=>l("workspace_url",e.target.value?e.target.value:void 0),placeholder:"https://your-workspace.databricks.com",sx:{mb:2,mt:1},InputProps:{startAdornment:(0,O.jsx)(ne.A,{position:"start",children:"https://"})}}),(0,O.jsx)(V.A,{fullWidth:!0,label:"Access Token (Optional)",value:s.token||"",onChange:e=>l("token",e.target.value?e.target.value:void 0),type:"password",placeholder:"Leave empty to use DATABRICKS_TOKEN env var",sx:{mb:1}}),(0,O.jsx)(m.A,{severity:"warning",sx:{mt:2},children:(0,O.jsxs)(c.A,{variant:"caption",children:[(0,O.jsx)("strong",{children:"Note:"})," Files will be organized as: ",s.volume_path,"/",s.create_date_dirs?"YYYY/MM/DD/":"","task_key_timestamp.",s.file_format]})})]})},St=e=>{var t;let{advancedConfig:n,onConfigChange:s,availableTasks:r}=e;const[l,d]=(0,i.useState)(n.callback&&jt.find(e=>e.value===n.callback)||null),[h,m]=(0,i.useState)([]),[p,x]=(0,i.useState)(null);(0,i.useEffect)(()=>{(async()=>{try{const e=wt.getInstance(),t=(await e.getSchemas()).map(e=>({value:e.name,label:e.name}));m(t)}catch(e){}})()},[]);const g=(0,i.useCallback)((e,t)=>{"type"!==e||s("condition",""===t?null:"is_data_missing")},[s]),f=(0,i.useCallback)(e=>{const t=jt.find(t=>t.value===e);if(d(t||null),s("callback",e||null),null!==t&&void 0!==t&&t.requiresPath||s("output_file",null),"DatabricksVolumeCallback"===e){if(!p){const e={volume_path:"main.default.task_outputs",file_format:"json",create_date_dirs:!0,max_file_size_mb:50};x(e),s("callback_config",(0,a.A)({},e))}}else x(null),s("callback_config",null)},[s,p]);(0,i.useEffect)(()=>{if("DatabricksVolumeCallback"===n.callback){if(n.callback_config){const e=n.callback_config,t={volume_path:e.volume_path||"main.default.task_outputs",file_format:e.file_format||"json",create_date_dirs:void 0===e.create_date_dirs||e.create_date_dirs,max_file_size_mb:e.max_file_size_mb||50,workspace_url:e.workspace_url,token:e.token};x(t)}else if(!p){x({volume_path:"main.default.task_outputs",file_format:"json",create_date_dirs:!0,max_file_size_mb:50})}const e=jt.find(e=>"DatabricksVolumeCallback"===e.value);e&&!l&&d(e)}else p&&x(null)},[n.callback,n.callback_config]);const v=(0,i.useCallback)(e=>{if(""===e)s("guardrail",null);else if("company_count"===e){const e={type:"company_count",min_companies:50};s("guardrail",JSON.stringify(e))}else if("data_processing"===e){const e={type:"data_processing"};s("guardrail",JSON.stringify(e))}else if("empty_data_processing"===e){const e={type:"empty_data_processing"};s("guardrail",JSON.stringify(e))}else if("data_processing_count"===e){const e={type:"data_processing_count",minimum_count:0};s("guardrail",JSON.stringify(e))}else if("company_name_not_null"===e){const e={type:"company_name_not_null"};s("guardrail",JSON.stringify(e))}else if("minimum_number"===e){const e={type:"minimum_number",min_value:5,field_name:"total_count"};s("guardrail",JSON.stringify(e))}else s("guardrail",JSON.stringify({type:e}))},[s]),A=(0,i.useCallback)((e,t)=>{try{const a=n.guardrail?JSON.parse(n.guardrail):{type:"company_count"};a[e]=t,s("guardrail",JSON.stringify(a))}catch(a){const n={type:"company_count",[e]:t};s("guardrail",JSON.stringify(n))}},[n.guardrail,s]),y=i.useMemo(()=>{try{return n.guardrail?JSON.parse(n.guardrail):null}catch(e){return null}},[n.guardrail]);return(0,i.useEffect)(()=>{"data_processing"!==(null===y||void 0===y?void 0:y.type)&&"empty_data_processing"!==(null===y||void 0===y?void 0:y.type)&&"company_name_not_null"!==(null===y||void 0===y?void 0:y.type)||n.retry_on_fail||(s("retry_on_fail",!0),s("max_retries",5))},[null===y||void 0===y?void 0:y.type,n.retry_on_fail,s]),(0,O.jsxs)(o.A,{sx:{display:"flex",flexDirection:"column",gap:2},children:[(0,O.jsx)(c.A,{variant:"subtitle2",color:"text.secondary",children:"Execution Settings"}),(0,O.jsx)(he.A,{control:(0,O.jsx)(me.A,{checked:Boolean(n.async_execution),onChange:e=>s("async_execution",e.target.checked)}),label:"Async Execution"}),(0,O.jsx)(he.A,{control:(0,O.jsx)(me.A,{checked:n.human_input,onChange:e=>s("human_input",e.target.checked)}),label:"Require Human Input"}),(0,O.jsx)(V.A,{type:"number",label:"Priority",value:n.priority,onChange:e=>s("priority",parseInt(e.target.value)),fullWidth:!0,inputProps:{min:1,max:10}}),(0,O.jsx)(V.A,{type:"number",label:"Timeout (seconds)",value:n.timeout||"",onChange:e=>s("timeout",e.target.value?parseInt(e.target.value):null),fullWidth:!0,inputProps:{min:0}}),(0,O.jsx)(te.A,{sx:{my:2}}),(0,O.jsx)(c.A,{variant:"subtitle2",color:"text.secondary",children:"Caching & Output"}),(0,O.jsx)(he.A,{control:(0,O.jsx)(me.A,{checked:n.cache_response,onChange:e=>s("cache_response",e.target.checked)}),label:"Cache Response"}),(0,O.jsx)(V.A,{type:"number",label:"Cache TTL (seconds)",value:n.cache_ttl,onChange:e=>s("cache_ttl",parseInt(e.target.value)),fullWidth:!0,disabled:!n.cache_response,inputProps:{min:0}}),(0,O.jsx)(V.A,{label:"Output JSON Schema",value:n.output_json||"",onChange:e=>s("output_json",e.target.value||null),fullWidth:!0,multiline:!0,rows:3,helperText:"JSON schema for task output"}),(0,O.jsx)(V.A,{label:"Output File Path",value:n.output_file||"",onChange:e=>s("output_file",e.target.value||null),fullWidth:!0}),(0,O.jsx)(he.A,{control:(0,O.jsx)(me.A,{checked:n.markdown,onChange:e=>s("markdown",e.target.checked)}),label:"Enable Markdown Output"}),(0,O.jsx)(te.A,{sx:{my:2}}),(0,O.jsx)(c.A,{variant:"subtitle2",color:"text.secondary",children:"Error Handling"}),(0,O.jsx)(he.A,{control:(0,O.jsx)(me.A,{checked:n.retry_on_fail,onChange:e=>s("retry_on_fail",e.target.checked)}),label:"Retry on Failure"}),(0,O.jsx)(V.A,{type:"number",label:"Max Retries",value:n.max_retries,onChange:e=>s("max_retries",parseInt(e.target.value)),fullWidth:!0,disabled:!n.retry_on_fail,inputProps:{min:1,max:10}}),(0,O.jsxs)(oe.A,{fullWidth:!0,children:[(0,O.jsx)(re.A,{children:"Error Handling Strategy"}),(0,O.jsxs)(le.A,{value:n.error_handling,onChange:e=>s("error_handling",e.target.value),label:"Error Handling Strategy",children:[(0,O.jsx)(de.A,{value:"default",children:"Default"}),(0,O.jsx)(de.A,{value:"retry",children:"Retry"}),(0,O.jsx)(de.A,{value:"ignore",children:"Ignore"}),(0,O.jsx)(de.A,{value:"fail",children:"Fail Immediately"})]})]}),(0,O.jsx)(te.A,{sx:{my:2}}),(0,O.jsx)(c.A,{variant:"subtitle2",color:"text.secondary",children:"Advanced Functions"}),(0,O.jsxs)(o.A,{sx:{display:"flex",gap:2,alignItems:"flex-start"},children:[(0,O.jsxs)(oe.A,{fullWidth:!0,children:[(0,O.jsx)(re.A,{children:"Callback"}),(0,O.jsxs)(le.A,{value:n.callback||"",onChange:e=>f(e.target.value),label:"Callback Function",children:[(0,O.jsx)(de.A,{value:"",children:(0,O.jsx)("em",{children:"None"})}),jt.map(e=>(0,O.jsx)(de.A,{value:e.value,children:(0,O.jsxs)(o.A,{sx:{display:"flex",flexDirection:"column"},children:[(0,O.jsx)(c.A,{children:e.label}),(0,O.jsx)(c.A,{variant:"caption",color:"text.secondary",children:e.description})]})},e.value))]})]}),l&&(0,O.jsx)(P.A,{title:l.description,children:(0,O.jsx)(u.A,{size:"small",sx:{mt:1},children:(0,O.jsx)(xe.A,{})})})]}),(null===l||void 0===l?void 0:l.requiresPath)&&(0,O.jsx)(V.A,{label:"Output File Path",value:n.output_file||"",onChange:e=>s("output_file",e.target.value||null),fullWidth:!0,helperText:"Path where the output will be saved"}),"DatabricksVolumeCallback"===(null===l||void 0===l?void 0:l.value)&&(0,O.jsx)(Ct,{config:p,onChange:e=>{x(e),s("callback_config",(0,a.A)({},e))}}),(0,O.jsx)(V.A,{label:"Output Parser",value:n.output_parser||"",onChange:e=>s("output_parser",e.target.value||null),fullWidth:!0,helperText:"Custom parser for task output"}),(0,O.jsxs)(oe.A,{fullWidth:!0,children:[(0,O.jsx)(re.A,{children:"Output Pydantic Model"}),(0,O.jsxs)(le.A,{value:null!==(t=n.output_pydantic)&&void 0!==t?t:"",onChange:e=>{const t=""===e.target.value?null:e.target.value;s("output_pydantic",t)},label:"Output Pydantic Model",children:[(0,O.jsx)(de.A,{value:"",children:(0,O.jsx)("em",{children:"None"})}),h.map(e=>(0,O.jsx)(de.A,{value:e.value,children:e.label},e.value))]})]}),(0,O.jsx)(te.A,{sx:{my:2}}),(0,O.jsx)(c.A,{variant:"subtitle2",color:"text.secondary",children:"Condition Settings"}),(0,O.jsxs)(oe.A,{fullWidth:!0,children:[(0,O.jsx)(re.A,{children:"Condition Type"}),(0,O.jsxs)(le.A,{value:n.condition||"",onChange:e=>g("type",e.target.value),label:"Condition Type",children:[(0,O.jsx)(de.A,{value:"",children:(0,O.jsx)("em",{children:"None"})}),(0,O.jsx)(de.A,{value:"is_data_missing",children:"Data Is Missing"})]})]}),(0,O.jsx)(te.A,{sx:{my:2}}),(0,O.jsx)(c.A,{variant:"subtitle2",color:"text.secondary",children:"Guardrail Settings"}),(0,O.jsxs)(oe.A,{fullWidth:!0,children:[(0,O.jsx)(re.A,{children:"Guardrail Type"}),(0,O.jsxs)(le.A,{value:(null===y||void 0===y?void 0:y.type)||"",onChange:e=>v(e.target.value),label:"Guardrail Type",children:[(0,O.jsx)(de.A,{value:"",children:"None"}),(0,O.jsx)(de.A,{value:"company_count",children:"Company Count"}),(0,O.jsx)(de.A,{value:"data_processing",children:"Data Processing Status"}),(0,O.jsx)(de.A,{value:"empty_data_processing",children:"Empty Data Processing Check"}),(0,O.jsx)(de.A,{value:"data_processing_count",children:"Data Processing Count Check"}),(0,O.jsx)(de.A,{value:"company_name_not_null",children:"Company Name Not Null Check"}),(0,O.jsx)(de.A,{value:"minimum_number",children:"Minimum Number Check"})]})]}),"company_count"===(null===y||void 0===y?void 0:y.type)&&(0,O.jsx)(V.A,{type:"number",label:"Minimum Companies",value:y.min_companies||50,onChange:e=>A("min_companies",parseInt(e.target.value)),fullWidth:!0,inputProps:{min:1}}),"data_processing_count"===(null===y||void 0===y?void 0:y.type)&&(0,O.jsxs)(o.A,{sx:{mt:1},children:[(0,O.jsx)(c.A,{variant:"body2",color:"text.secondary",sx:{mb:1},children:"This guardrail checks if the total number of records in the data_processing table is at least the minimum count. The task will pass validation when the number of records equals or exceeds the minimum count."}),(0,O.jsx)(V.A,{type:"number",label:"Minimum Record Count",value:y.minimum_count||0,onChange:e=>A("minimum_count",parseInt(e.target.value)),fullWidth:!0,inputProps:{min:0}})]}),"data_processing"===(null===y||void 0===y?void 0:y.type)&&(0,O.jsx)(o.A,{sx:{mt:1},children:(0,O.jsx)(c.A,{variant:"body2",color:"text.secondary",sx:{mb:1},children:'This guardrail checks if all data records in the database have been processed. The task will only pass validation when all records have processed=true. Enable "Retry on Failure" to automatically retry the task until all data has been processed.'})}),"empty_data_processing"===(null===y||void 0===y?void 0:y.type)&&(0,O.jsx)(o.A,{sx:{mt:1},children:(0,O.jsx)(c.A,{variant:"body2",color:"text.secondary",sx:{mb:1},children:"This guardrail checks if the data_processing table is empty. The task will only pass validation when the table has NO records (is completely empty). Use this guardrail when you need to ensure that the table is clean before adding new data."})}),"company_name_not_null"===(null===y||void 0===y?void 0:y.type)&&(0,O.jsx)(o.A,{sx:{mt:1},children:(0,O.jsx)(c.A,{variant:"body2",color:"text.secondary",sx:{mb:1},children:'This guardrail checks if any company_name in the data_processing table is null. The task will only pass validation when all records have non-null company_name values. Enable "Retry on Failure" to automatically retry the task until all records have valid company names.'})}),"minimum_number"===(null===y||void 0===y?void 0:y.type)&&(0,O.jsxs)(o.A,{sx:{mt:1},children:[(0,O.jsx)(c.A,{variant:"body2",color:"text.secondary",sx:{mb:1},children:"This guardrail validates that a number in the output exceeds a specified minimum value. Particularly useful for ensuring search results, data counts, or other numerical values meet minimum thresholds."}),(0,O.jsx)(V.A,{type:"number",label:"Minimum Value",value:y.min_value||5,onChange:e=>A("min_value",parseInt(e.target.value)),fullWidth:!0,inputProps:{min:0},sx:{mb:2}}),(0,O.jsx)(V.A,{label:"Field Name",value:y.field_name||"total_count",onChange:e=>A("field_name",e.target.value),fullWidth:!0,helperText:"Name of the field to check (e.g., 'total_count', 'results')"})]})]})},_t=(0,i.memo)(St);_t.displayName="TaskAdvancedConfig";const Et=function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:100;const a=(0,i.useRef)(null),s=(0,i.useRef)(null),o=(0,i.useRef)(e);(0,i.useEffect)(()=>{o.current=e},[e]),(0,i.useEffect)(()=>{const e=t.current;if(!e)return;return s.current=new ResizeObserver(e=>{a.current&&window.clearTimeout(a.current),a.current=window.setTimeout(()=>{o.current(e[0])},n)}),s.current.observe(e),()=>{a.current&&window.clearTimeout(a.current),s.current&&(s.current.disconnect(),s.current=null)}},[t,n])};var It=n(49322),Tt=n(79084);const Dt=e=>{let{open:t,onClose:n}=e;return(0,O.jsxs)(r.A,{open:t,onClose:n,maxWidth:"md",fullWidth:!0,PaperProps:{sx:{borderRadius:2,minHeight:"80vh"}},children:[(0,O.jsx)(d.A,{children:(0,O.jsxs)(o.A,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[(0,O.jsxs)(o.A,{sx:{display:"flex",alignItems:"center",gap:1},children:[(0,O.jsx)(It.A,{color:"primary"}),(0,O.jsx)(c.A,{variant:"h6",children:"Task Best Practices"})]}),(0,O.jsx)(u.A,{onClick:n,size:"small",children:(0,O.jsx)(D.A,{})})]})}),(0,O.jsx)(l.A,{dividers:!0,children:(0,O.jsxs)(o.A,{sx:{py:2},children:[(0,O.jsx)(m.A,{severity:"info",sx:{mb:3},children:"Tasks are specific assignments given to agents. They define what needs to be done, the expected output, and how the task connects to the overall workflow."}),(0,O.jsxs)(_e.A,{elevation:0,sx:{p:3,mb:3,bgcolor:"background.default"},children:[(0,O.jsxs)(c.A,{variant:"h6",gutterBottom:!0,sx:{display:"flex",alignItems:"center",gap:1},children:[(0,O.jsx)(lt.A,{color:"primary"}),"Core Principles"]}),(0,O.jsxs)(at.A,{children:[(0,O.jsxs)(st.Ay,{children:[(0,O.jsx)(it.A,{children:(0,O.jsx)(rt.A,{color:"success"})}),(0,O.jsx)(ot.A,{primary:"Clear and Specific",secondary:"Tasks should have unambiguous instructions with clear deliverables."})]}),(0,O.jsxs)(st.Ay,{children:[(0,O.jsx)(it.A,{children:(0,O.jsx)(rt.A,{color:"success"})}),(0,O.jsx)(ot.A,{primary:"Atomic Operations",secondary:"Break complex operations into smaller, manageable tasks. Each task should do one thing well."})]}),(0,O.jsxs)(st.Ay,{children:[(0,O.jsx)(it.A,{children:(0,O.jsx)(rt.A,{color:"success"})}),(0,O.jsx)(ot.A,{primary:"Measurable Outcomes",secondary:"Define success criteria that can be objectively evaluated."})]})]})]}),(0,O.jsxs)(_e.A,{elevation:0,sx:{p:3,mb:3,bgcolor:"background.default"},children:[(0,O.jsxs)(c.A,{variant:"h6",gutterBottom:!0,sx:{display:"flex",alignItems:"center",gap:1},children:[(0,O.jsx)(ht.A,{color:"primary"}),"Writing Effective Task Descriptions"]}),(0,O.jsxs)(o.A,{sx:{mt:2},children:[(0,O.jsx)(c.A,{variant:"subtitle1",fontWeight:"medium",gutterBottom:!0,children:"Description"}),(0,O.jsx)(c.A,{variant:"body2",color:"text.secondary",paragraph:!0,children:"Provide clear, actionable instructions. Include context, constraints, and specific requirements."}),(0,O.jsx)(o.A,{sx:{bgcolor:"grey.100",p:2,borderRadius:1,mb:2},children:(0,O.jsxs)(c.A,{variant:"body2",fontFamily:"monospace",children:["\u2705 Good: ",'"Analyze the customer feedback data from the last quarter. Identify the top 3 pain points mentioned by users. Create a summary report with specific quotes and frequency data."',(0,O.jsx)("br",{}),(0,O.jsx)("br",{}),"\u274c Poor: ",'"Look at customer feedback"']})})]}),(0,O.jsxs)(o.A,{sx:{mt:2},children:[(0,O.jsx)(c.A,{variant:"subtitle1",fontWeight:"medium",gutterBottom:!0,children:"Expected Output"}),(0,O.jsx)(c.A,{variant:"body2",color:"text.secondary",paragraph:!0,children:"Define exactly what the task should produce. Specify format, structure, and content requirements."}),(0,O.jsx)(o.A,{sx:{bgcolor:"grey.100",p:2,borderRadius:1,mb:2},children:(0,O.jsxs)(c.A,{variant:"body2",fontFamily:"monospace",children:["\u2705 Good: ",'"A JSON object containing: analysis_date, top_issues (array of 3 items with title, description, frequency), recommendations (array), and raw_data_summary"',(0,O.jsx)("br",{}),(0,O.jsx)("br",{}),"\u274c Poor: ",'"A report"']})})]}),(0,O.jsxs)(o.A,{sx:{mt:2},children:[(0,O.jsx)(c.A,{variant:"subtitle1",fontWeight:"medium",gutterBottom:!0,children:"Context Variables"}),(0,O.jsx)(c.A,{variant:"body2",color:"text.secondary",paragraph:!0,children:"Use context variables to pass dynamic information from previous tasks or user input."}),(0,O.jsx)(o.A,{sx:{bgcolor:"grey.100",p:2,borderRadius:1,mb:2},children:(0,O.jsxs)(c.A,{variant:"body2",fontFamily:"monospace",children:["Example: ",'"Analyze the data for {customer_segment} in {region} market"',(0,O.jsx)("br",{}),"This allows the task to be reusable with different parameters."]})})]})]}),(0,O.jsxs)(_e.A,{elevation:0,sx:{p:3,mb:3,bgcolor:"background.default"},children:[(0,O.jsxs)(c.A,{variant:"h6",gutterBottom:!0,sx:{display:"flex",alignItems:"center",gap:1},children:[(0,O.jsx)(Tt.A,{color:"primary"}),"Task Dependencies and Flow"]}),(0,O.jsxs)(at.A,{children:[(0,O.jsxs)(st.Ay,{children:[(0,O.jsx)(it.A,{children:(0,O.jsx)(rt.A,{color:"success"})}),(0,O.jsx)(ot.A,{primary:"Sequential Dependencies",secondary:"Clearly define which tasks must complete before this task can start."})]}),(0,O.jsxs)(st.Ay,{children:[(0,O.jsx)(it.A,{children:(0,O.jsx)(rt.A,{color:"success"})}),(0,O.jsx)(ot.A,{primary:"Input/Output Mapping",secondary:"Ensure outputs from previous tasks match the expected inputs of dependent tasks."})]}),(0,O.jsxs)(st.Ay,{children:[(0,O.jsx)(it.A,{children:(0,O.jsx)(rt.A,{color:"success"})}),(0,O.jsx)(ot.A,{primary:"Error Handling",secondary:"Define what should happen if a task fails or produces unexpected output."})]}),(0,O.jsxs)(st.Ay,{children:[(0,O.jsx)(it.A,{children:(0,O.jsx)(rt.A,{color:"success"})}),(0,O.jsx)(ot.A,{primary:"Parallel Execution",secondary:"Identify tasks that can run simultaneously to optimize workflow performance."})]})]})]}),(0,O.jsxs)(_e.A,{elevation:0,sx:{p:3,mb:3,bgcolor:"background.default"},children:[(0,O.jsxs)(c.A,{variant:"h6",gutterBottom:!0,sx:{display:"flex",alignItems:"center",gap:1},children:[(0,O.jsx)(ht.A,{color:"primary"}),"Output Types and Formats"]}),(0,O.jsxs)(at.A,{children:[(0,O.jsxs)(st.Ay,{children:[(0,O.jsx)(it.A,{children:(0,O.jsx)(rt.A,{color:"info"})}),(0,O.jsx)(ot.A,{primary:"Structured Data (JSON/XML)",secondary:"Best for data that will be processed by other tasks or systems."})]}),(0,O.jsxs)(st.Ay,{children:[(0,O.jsx)(it.A,{children:(0,O.jsx)(rt.A,{color:"info"})}),(0,O.jsx)(ot.A,{primary:"Plain Text",secondary:"Suitable for summaries, reports, or human-readable content."})]}),(0,O.jsxs)(st.Ay,{children:[(0,O.jsx)(it.A,{children:(0,O.jsx)(rt.A,{color:"info"})}),(0,O.jsx)(ot.A,{primary:"Markdown",secondary:"Ideal for formatted documentation or reports with structure."})]}),(0,O.jsxs)(st.Ay,{children:[(0,O.jsx)(it.A,{children:(0,O.jsx)(rt.A,{color:"info"})}),(0,O.jsx)(ot.A,{primary:"Code",secondary:"For generated scripts, configurations, or program files."})]})]})]}),(0,O.jsxs)(_e.A,{elevation:0,sx:{p:3,mb:3,bgcolor:"error.50"},children:[(0,O.jsxs)(c.A,{variant:"h6",gutterBottom:!0,sx:{display:"flex",alignItems:"center",gap:1,color:"error.main"},children:[(0,O.jsx)(dt.A,{color:"error"}),"Common Pitfalls to Avoid"]}),(0,O.jsxs)(at.A,{children:[(0,O.jsxs)(st.Ay,{children:[(0,O.jsx)(it.A,{children:(0,O.jsx)(dt.A,{color:"error"})}),(0,O.jsx)(ot.A,{primary:"Overly Complex Tasks",secondary:"Don't try to accomplish too much in a single task. Break it down into smaller steps."})]}),(0,O.jsxs)(st.Ay,{children:[(0,O.jsx)(it.A,{children:(0,O.jsx)(dt.A,{color:"error"})}),(0,O.jsx)(ot.A,{primary:"Ambiguous Success Criteria",secondary:"Avoid vague outcomes like 'improve the process' without defining what improvement means."})]}),(0,O.jsxs)(st.Ay,{children:[(0,O.jsx)(it.A,{children:(0,O.jsx)(dt.A,{color:"error"})}),(0,O.jsx)(ot.A,{primary:"Missing Context",secondary:"Don't assume the agent knows background information. Provide all necessary context."})]}),(0,O.jsxs)(st.Ay,{children:[(0,O.jsx)(it.A,{children:(0,O.jsx)(dt.A,{color:"error"})}),(0,O.jsx)(ot.A,{primary:"Ignoring Edge Cases",secondary:"Consider what happens with empty inputs, errors, or unexpected data formats."})]}),(0,O.jsxs)(st.Ay,{children:[(0,O.jsx)(it.A,{children:(0,O.jsx)(dt.A,{color:"error"})}),(0,O.jsx)(ot.A,{primary:"Circular Dependencies",secondary:"Ensure tasks don't create dependency loops that prevent execution."})]})]})]}),(0,O.jsxs)(_e.A,{elevation:0,sx:{p:3,mb:3,bgcolor:"info.50"},children:[(0,O.jsxs)(c.A,{variant:"h6",gutterBottom:!0,sx:{display:"flex",alignItems:"center",gap:1,color:"info.main"},children:[(0,O.jsx)(lt.A,{color:"info"}),"Task Template Examples"]}),(0,O.jsxs)(o.A,{sx:{mt:2},children:[(0,O.jsx)(c.A,{variant:"subtitle2",fontWeight:"medium",gutterBottom:!0,children:"Data Analysis Task"}),(0,O.jsx)(o.A,{sx:{bgcolor:"white",p:2,borderRadius:1,mb:2,fontFamily:"monospace"},children:(0,O.jsx)(c.A,{variant:"body2",component:"pre",sx:{whiteSpace:"pre-wrap"},children:'Description: "Analyze sales data for Q4 2024. Calculate total revenue, \ntop 5 products by sales volume, and month-over-month growth rate."\n\nExpected Output: "JSON object with structure:\n{\n  quarter: \'Q4 2024\',\n  total_revenue: number,\n  top_products: [{name, units_sold, revenue}],\n  growth_rate: number,\n  summary: string\n}"'})})]}),(0,O.jsxs)(o.A,{sx:{mt:2},children:[(0,O.jsx)(c.A,{variant:"subtitle2",fontWeight:"medium",gutterBottom:!0,children:"Content Generation Task"}),(0,O.jsx)(o.A,{sx:{bgcolor:"white",p:2,borderRadius:1,mb:2,fontFamily:"monospace"},children:(0,O.jsx)(c.A,{variant:"body2",component:"pre",sx:{whiteSpace:"pre-wrap"},children:'Description: "Create a technical blog post about {topic}. \nInclude an introduction, 3 main sections with examples, \nand a conclusion with key takeaways."\n\nExpected Output: "Markdown formatted article with:\n- Title (H1)\n- Introduction (150-200 words)\n- 3 sections with code examples\n- Conclusion with bullet points\n- Total length: 1500-2000 words"'})})]})]}),(0,O.jsxs)(_e.A,{elevation:0,sx:{p:3,bgcolor:"success.50"},children:[(0,O.jsxs)(c.A,{variant:"h6",gutterBottom:!0,sx:{display:"flex",alignItems:"center",gap:1,color:"success.main"},children:[(0,O.jsx)(rt.A,{color:"success"}),"Quick Checklist"]}),(0,O.jsxs)(at.A,{dense:!0,children:[(0,O.jsxs)(st.Ay,{children:[(0,O.jsx)(it.A,{children:(0,O.jsx)(rt.A,{color:"success",fontSize:"small"})}),(0,O.jsx)(ot.A,{primary:"Is the task description clear and specific?"})]}),(0,O.jsxs)(st.Ay,{children:[(0,O.jsx)(it.A,{children:(0,O.jsx)(rt.A,{color:"success",fontSize:"small"})}),(0,O.jsx)(ot.A,{primary:"Is the expected output well-defined?"})]}),(0,O.jsxs)(st.Ay,{children:[(0,O.jsx)(it.A,{children:(0,O.jsx)(rt.A,{color:"success",fontSize:"small"})}),(0,O.jsx)(ot.A,{primary:"Are all dependencies identified?"})]}),(0,O.jsxs)(st.Ay,{children:[(0,O.jsx)(it.A,{children:(0,O.jsx)(rt.A,{color:"success",fontSize:"small"})}),(0,O.jsx)(ot.A,{primary:"Is the task appropriately sized (not too complex)?"})]}),(0,O.jsxs)(st.Ay,{children:[(0,O.jsx)(it.A,{children:(0,O.jsx)(rt.A,{color:"success",fontSize:"small"})}),(0,O.jsx)(ot.A,{primary:"Have you provided necessary context?"})]}),(0,O.jsxs)(st.Ay,{children:[(0,O.jsx)(it.A,{children:(0,O.jsx)(rt.A,{color:"success",fontSize:"small"})}),(0,O.jsx)(ot.A,{primary:"Is the output format specified?"})]}),(0,O.jsxs)(st.Ay,{children:[(0,O.jsx)(it.A,{children:(0,O.jsx)(rt.A,{color:"success",fontSize:"small"})}),(0,O.jsx)(ot.A,{primary:"Have you considered error scenarios?"})]})]})]})]})}),(0,O.jsx)(B.A,{sx:{px:3,py:2},children:(0,O.jsx)(x.A,{onClick:n,variant:"contained",color:"primary",children:"Close"})})]})},Nt=e=>{var t,n,s,p,g,f,v,A,y,b,j,w,k,C,S,_,E,I,T,N,M,z,L,F,W,U,H,K,G,J,Y,X,Z,Q,$,ce,ue,he;let{initialData:me,onCancel:fe,onTaskSaved:ve,onSubmit:Ae,isEdit:ye,tools:be,hideTitle:je,isCreateMode:we}=e;const[Ce,Se]=(0,i.useState)(!1),[_e,Ee]=(0,i.useState)(!1),[Ie,Te]=(0,i.useState)(!1),De=(0,i.useRef)(null),[Ne,Pe]=(0,i.useState)({id:null!==(t=null===me||void 0===me?void 0:me.id)&&void 0!==t?t:"",name:null!==(n=null===me||void 0===me?void 0:me.name)&&void 0!==n?n:"",description:null!==(s=null===me||void 0===me?void 0:me.description)&&void 0!==s?s:"",expected_output:null!==(p=null===me||void 0===me?void 0:me.expected_output)&&void 0!==p?p:"",tools:null!==(g=null===me||void 0===me?void 0:me.tools)&&void 0!==g?g:[],agent_id:null!==(f=null===me||void 0===me?void 0:me.agent_id)&&void 0!==f?f:null,async_execution:void 0!==(null===me||void 0===me?void 0:me.async_execution)&&Boolean(me.async_execution),context:null!==(v=null===me||void 0===me?void 0:me.context)&&void 0!==v?v:[],markdown:!0===(null===me||void 0===me?void 0:me.markdown)||"true"===String(null===me||void 0===me?void 0:me.markdown),config:null!==me&&void 0!==me&&me.config?{cache_response:null!==(A=me.config.cache_response)&&void 0!==A&&A,cache_ttl:null!==(y=me.config.cache_ttl)&&void 0!==y?y:3600,retry_on_fail:null===(b=me.config.retry_on_fail)||void 0===b||b,max_retries:null!==(j=me.config.max_retries)&&void 0!==j?j:3,timeout:null!==(w=me.config.timeout)&&void 0!==w?w:null,priority:null!==(k=me.config.priority)&&void 0!==k?k:1,error_handling:null!==(C=me.config.error_handling)&&void 0!==C?C:"default",output_file:null!==(S=me.config.output_file)&&void 0!==S?S:null,output_json:null!==(_=me.config.output_json)&&void 0!==_?_:null,output_pydantic:null!==(E=me.config.output_pydantic)&&void 0!==E?E:null,callback:null!==(I=me.config.callback)&&void 0!==I?I:null,callback_config:null!==(T=me.config.callback_config)&&void 0!==T?T:null,human_input:null!==(N=me.config.human_input)&&void 0!==N&&N,condition:me.config.condition,guardrail:null!==(M=me.config.guardrail)&&void 0!==M?M:null,markdown:null!==(z=me.config.markdown)&&void 0!==z&&z}:{cache_response:!1,cache_ttl:3600,retry_on_fail:!0,max_retries:3,timeout:null,priority:1,error_handling:"default",output_file:null,output_json:null,output_pydantic:null,callback:null,callback_config:null,human_input:!1,guardrail:null,markdown:!1}}),[ze,Oe]=(0,i.useState)(null),[Le,Fe]=(0,i.useState)([]),[We,Ve]=(0,i.useState)(null),[Be,Ue]=(0,i.useState)({}),[He,Ke]=(0,i.useState)({}),[Ge,qe]=(0,i.useState)([]),[Ye,Xe]=(0,i.useState)((null===me||void 0===me?void 0:me.tool_configs)||{}),[Ze,$e]=(0,i.useState)(!1);(0,i.useEffect)(()=>{if(null!==me&&void 0!==me&&me.tools&&Pe(e=>(0,a.A)((0,a.A)({},e),{},{tools:me.tools})),null!==me&&void 0!==me&&me.tool_configs){Xe(me.tool_configs);const e=me.tool_configs.GenieTool;if(e){const t=e.spaceId||e.space_id,n=e.spaceName||e.space_name||t;t&&"string"===typeof t&&Ve({id:t,name:n})}if(me.tool_configs.PerplexityTool&&Ue(me.tool_configs.PerplexityTool),me.tool_configs.SerperDevTool&&Ke(me.tool_configs.SerperDevTool),me.tool_configs.MCP_SERVERS){const e=me.tool_configs.MCP_SERVERS,t=Array.isArray(e.servers)?e.servers:Array.isArray(me.tool_configs.MCP_SERVERS)?me.tool_configs.MCP_SERVERS:[];qe(t)}}},[null===me||void 0===me?void 0:me.tools,null===me||void 0===me?void 0:me.tool_configs,be]),(0,i.useEffect)(()=>{(async()=>{try{const e=await Re.listTasks();Fe(e)}catch(ze){Oe("Error loading available tasks")}})()},[]);const et=(e,t)=>{Pe(n=>(0,a.A)((0,a.A)({},n),{},{[e]:t}))},tt=e=>{const t=Array.isArray(e.target.value)?e.target.value:[e.target.value];Pe(e=>(0,a.A)((0,a.A)({},e),{},{tools:t}))},at=async()=>{try{Oe(null);try{var e,t;if(!Ne.name.trim())return void Oe("Task name is required");let n=(0,a.A)({},Ye);We&&Ne.tools.some(e=>{const t=be.find(t=>String(t.id)===String(e)||t.id===Number(e)||t.title===e);return"GenieTool"===(null===t||void 0===t?void 0:t.title)})?n=(0,a.A)((0,a.A)({},n),{},{GenieTool:{spaceId:We.id,spaceName:We.name}}):We||delete n.GenieTool,Be&&Object.keys(Be).length>0&&Ne.tools.some(e=>{const t=be.find(t=>String(t.id)===String(e)||t.id===Number(e)||t.title===e);return"PerplexityTool"===(null===t||void 0===t?void 0:t.title)})?n=(0,a.A)((0,a.A)({},n),{},{PerplexityTool:Be}):Ne.tools.some(e=>{const t=be.find(t=>String(t.id)===String(e)||t.id===Number(e)||t.title===e);return"PerplexityTool"===(null===t||void 0===t?void 0:t.title)})||delete n.PerplexityTool,He&&Object.keys(He).length>0&&Ne.tools.some(e=>{const t=be.find(t=>String(t.id)===String(e)||t.id===Number(e)||t.title===e);return"SerperDevTool"===(null===t||void 0===t?void 0:t.title)})?n=(0,a.A)((0,a.A)({},n),{},{SerperDevTool:He}):Ne.tools.some(e=>{const t=be.find(t=>String(t.id)===String(e)||t.id===Number(e)||t.title===e);return"SerperDevTool"===(null===t||void 0===t?void 0:t.title)})||delete n.SerperDevTool,Ge&&Ge.length>0?n=(0,a.A)((0,a.A)({},n),{},{MCP_SERVERS:{servers:Ge}}):delete n.MCP_SERVERS;const s=(0,a.A)((0,a.A)({},Ne),{},{context:Array.from(Ne.context),tool_configs:Object.keys(n).length>0?n:void 0,markdown:null!==(e=Ne.config.markdown)&&void 0!==e?e:Ne.markdown,config:(0,a.A)((0,a.A)({},Ne.config),{},{condition:"is_data_missing"===Ne.config.condition?"is_data_missing":void 0,callback:Ne.config.callback,callback_config:Ne.config.callback_config,output_pydantic:Ne.config.output_pydantic,markdown:null!==(t=Ne.config.markdown)&&void 0!==t?t:Ne.markdown})});try{let e;e=Ne.id?await Re.updateTask(Ne.id,s):await Re.createTask(s),ve&&ve(e),fe&&fe()}catch(ze){Oe(ze instanceof Error?ze.message:"Error saving task")}}catch(ze){Oe("Error validating task configuration.")}}catch(ze){Oe("An unexpected error occurred.")}};Et(()=>{},De,150);const st=()=>{Ee(!1)},it=()=>{Te(!1)};return(0,O.jsxs)(O.Fragment,{children:[(0,O.jsxs)(ee.A,{sx:{display:"flex",flexDirection:"column",height:"70vh",position:"relative",overflow:"hidden"},children:[!we&&(0,O.jsxs)(o.A,{sx:{p:3,pb:2},children:[(0,O.jsxs)(o.A,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:3},children:[!je&&(0,O.jsx)(c.A,{variant:"h6",children:null!==me&&void 0!==me&&me.id?"Edit Task":"Create New Task"}),(0,O.jsx)(x.A,{startIcon:(0,O.jsx)(xe.A,{}),onClick:()=>$e(!0),variant:"outlined",size:"small",sx:{ml:2},children:"Best Practices"})]}),(0,O.jsx)(te.A,{})]}),(0,O.jsx)(o.A,{sx:{flex:"1 1 auto",overflow:"auto",px:3,pb:2,pt:we?3:0,height:we?"calc(90vh - 120px)":"calc(90vh - 170px)"},children:(0,O.jsxs)(o.A,{component:"form",onSubmit:e=>{e.preventDefault(),at()},sx:{display:"flex",flexDirection:"column",gap:2},children:[(0,O.jsx)(V.A,{fullWidth:!0,label:"Name",value:Ne.name,onChange:e=>et("name",e.target.value),required:!0,margin:"normal",sx:{"& .MuiOutlinedInput-root":{"& fieldset":{borderColor:"rgba(0, 0, 0, 0.23)"}},"& .MuiInputLabel-root":{backgroundColor:"white",padding:"0 4px"}}}),(0,O.jsx)(V.A,{fullWidth:!0,label:"Description",value:Ne.description,onChange:e=>et("description",e.target.value),multiline:!0,rows:3,required:!0,InputProps:{endAdornment:(0,O.jsx)(ne.A,{position:"end",children:(0,O.jsx)(u.A,{edge:"end",onClick:()=>{Ee(!0)},size:"small",sx:{opacity:.7},title:"Expand description",children:(0,O.jsx)(ge.A,{fontSize:"small"})})})}}),(0,O.jsx)(V.A,{fullWidth:!0,label:"Expected Output",value:Ne.expected_output,onChange:e=>et("expected_output",e.target.value),multiline:!0,rows:3,required:!0,InputProps:{endAdornment:(0,O.jsx)(ne.A,{position:"end",children:(0,O.jsx)(u.A,{edge:"end",onClick:()=>{Te(!0)},size:"small",sx:{opacity:.7},title:"Expand expected output",children:(0,O.jsx)(ge.A,{fontSize:"small"})})})}}),(0,O.jsxs)(oe.A,{fullWidth:!0,children:[(0,O.jsx)(re.A,{id:"tools-label",children:"Tools"}),(0,O.jsx)(le.A,{labelId:"tools-label",multiple:!0,value:Ne.tools.map(String),onChange:tt,label:"Tools",renderValue:e=>(0,O.jsx)(o.A,{sx:{display:"flex",flexWrap:"wrap",gap:.5},children:e.map(e=>{const t=be.find(t=>String(t.id)===String(e)||t.id===Number(e)||t.title===e);return(0,O.jsx)(R.A,{label:t?t.title:"Tool ".concat(e),size:"small",onDelete:()=>{const t=Ne.tools.filter(t=>String(t)!==String(e));tt({target:{value:t}})},onMouseDown:e=>{e.stopPropagation()},deleteIcon:(0,O.jsx)(q.A,{fontSize:"small",sx:{fontSize:"16px !important"}})},e)})}),children:be&&be.length>0?be.filter(e=>!1!==e.enabled).map(e=>(0,O.jsx)(de.A,{value:e.id.toString(),children:(0,O.jsxs)(o.A,{sx:{display:"flex",flexDirection:"column"},children:[(0,O.jsx)(c.A,{children:e.title}),(0,O.jsx)(c.A,{variant:"caption",color:"text.secondary",children:e.description})]})},e.id)):(0,O.jsx)(de.A,{disabled:!0,children:(0,O.jsx)(c.A,{variant:"body2",color:"text.secondary",children:"No tools available"})})})]}),Ne.tools.some(e=>{const t=be.find(t=>String(t.id)===String(e)||t.id===Number(e)||t.title===e);return"GenieTool"===(null===t||void 0===t?void 0:t.title)})&&(0,O.jsxs)(o.A,{sx:{mt:2},children:[(0,O.jsx)(c.A,{variant:"subtitle2",sx:{mb:1},children:"Genie Space"}),We?(0,O.jsx)(P.A,{title:"Space ID: ".concat(We.id," - Click to open in Databricks"),arrow:!0,children:(0,O.jsx)(R.A,{label:We.name,size:"medium",color:"primary",variant:"outlined",onClick:async e=>{if(e.stopPropagation(),We)try{const e=ke.O.getInstance(),t=await e.getDatabricksConfig();if(t&&t.workspace_url){let e=t.workspace_url.startsWith("https://")?t.workspace_url:"https://".concat(t.workspace_url);e=e.replace(/\/$/,"");const n="".concat(e,"/genie/rooms/").concat(We.id,"/monitoring");window.open(n,"_blank","noopener,noreferrer")}else alert("Databricks workspace URL is not configured. Please configure it in Settings > Configuration > Databricks.")}catch(ze){alert("Error opening Genie space. Please check the console for details.")}},onDelete:()=>{Ve(null),Xe(e=>{const t=(0,a.A)({},e);return delete t.GenieTool,t})},deleteIcon:(0,O.jsx)(q.A,{fontSize:"small"}),sx:{cursor:"pointer","&:hover":{backgroundColor:"rgba(25, 118, 210, 0.08)"}}})}):(0,O.jsx)(o.A,{sx:{display:"flex",alignItems:"center",gap:1},children:(0,O.jsx)(Me,{value:"",onChange:(e,t)=>{e&&(Ve({id:e,name:t||e}),Xe(n=>(0,a.A)((0,a.A)({},n),{},{GenieTool:{spaceId:e,spaceName:t||e}})))},label:"",placeholder:"Select a Genie space...",helperText:"",fullWidth:!0})})]}),Ne.tools.some(e=>{const t=be.find(t=>String(t.id)===String(e)||t.id===Number(e)||t.title===e);return"PerplexityTool"===(null===t||void 0===t?void 0:t.title)})&&(0,O.jsx)(o.A,{sx:{mt:2},children:(0,O.jsx)(Je,{value:Be,onChange:e=>{Ue(e),Xe(t=>(0,a.A)((0,a.A)({},t),{},{PerplexityTool:e}))},label:"Perplexity Configuration",helperText:"Configure Perplexity AI search parameters for this task",fullWidth:!0})}),Ne.tools.some(e=>{const t=be.find(t=>String(t.id)===String(e)||t.id===Number(e)||t.title===e);return"SerperDevTool"===(null===t||void 0===t?void 0:t.title)})&&(0,O.jsx)(o.A,{sx:{mt:2},children:(0,O.jsx)(Qe,{value:He,onChange:e=>{Ke(e),Xe(t=>(0,a.A)((0,a.A)({},t),{},{SerperDevTool:e}))},label:"Serper Configuration",helperText:"Configure Serper.dev search parameters for this task",fullWidth:!0})}),(0,O.jsxs)(o.A,{sx:{mt:2},children:[Ge.length>0&&(0,O.jsxs)(o.A,{sx:{mb:2,p:2,backgroundColor:"rgba(25, 118, 210, 0.04)",borderRadius:1,border:"1px solid rgba(25, 118, 210, 0.12)"},children:[(0,O.jsxs)(c.A,{variant:"subtitle2",color:"primary",sx:{mb:1,fontWeight:600,fontSize:"0.875rem"},children:["Selected MCP Servers (",Ge.length,")"]}),(0,O.jsx)(o.A,{sx:{display:"flex",flexWrap:"wrap",gap:1},children:Ge.map(e=>(0,O.jsx)(R.A,{label:e,size:"medium",color:"primary",variant:"filled",onDelete:()=>{const t=Ge.filter(t=>t!==e);qe(t),Xe(e=>(0,a.A)((0,a.A)({},e),{},{MCP_SERVERS:t}))},sx:{"& .MuiChip-deleteIcon":{fontSize:"18px","&:hover":{color:"error.main"}},fontWeight:500}},e))})]}),(0,O.jsx)(nt,{value:Ge,onChange:e=>{const t=Array.isArray(e)?e:e?[e]:[];qe(t),Xe(e=>(0,a.A)((0,a.A)({},e),{},{MCP_SERVERS:t}))},label:"MCP Servers",placeholder:"Select MCP servers for this task...",helperText:"Choose which MCP (Model Context Protocol) servers this task should have access to",multiple:!0,fullWidth:!0})]}),(0,O.jsxs)(ae.A,{expanded:Ce,onChange:(e,t)=>{Se(t)},ref:De,TransitionProps:{unmountOnExit:!1,timeout:{enter:300,exit:200}},sx:{"& .MuiAccordionDetails-root":{padding:2}},children:[(0,O.jsx)(se.A,{expandIcon:(0,O.jsx)(pe.A,{}),children:(0,O.jsx)(c.A,{children:"Advanced Configuration"})}),(0,O.jsx)(ie.A,{children:(0,O.jsx)(_t,{advancedConfig:{async_execution:Ne.async_execution,cache_response:(null===(L=Ne.config)||void 0===L?void 0:L.cache_response)||!1,cache_ttl:(null===(F=Ne.config)||void 0===F?void 0:F.cache_ttl)||3600,callback:(null===(W=Ne.config)||void 0===W?void 0:W.callback)||null,callback_config:(null===(U=Ne.config)||void 0===U?void 0:U.callback_config)||null,context:Ne.context||[],dependencies:[],error_handling:(null===(H=Ne.config)||void 0===H?void 0:H.error_handling)||"default",human_input:(null===(K=Ne.config)||void 0===K?void 0:K.human_input)||!1,max_retries:(null===(G=Ne.config)||void 0===G?void 0:G.max_retries)||3,output_file:(null===(J=Ne.config)||void 0===J?void 0:J.output_file)||null,output_json:(null===(Y=Ne.config)||void 0===Y?void 0:Y.output_json)||null,output_parser:null,output_pydantic:(null===(X=Ne.config)||void 0===X?void 0:X.output_pydantic)||null,priority:(null===(Z=Ne.config)||void 0===Z?void 0:Z.priority)||1,retry_on_fail:(null===(Q=Ne.config)||void 0===Q?void 0:Q.retry_on_fail)||!0,timeout:(null===($=Ne.config)||void 0===$?void 0:$.timeout)||null,condition:null===(ce=Ne.config)||void 0===ce?void 0:ce.condition,guardrail:(null===(ue=Ne.config)||void 0===ue?void 0:ue.guardrail)||null,markdown:(null===(he=Ne.config)||void 0===he?void 0:he.markdown)||!1},onConfigChange:(e,t)=>{Pe(n=>{if("async_execution"===e)return(0,a.A)((0,a.A)({},n),{},{async_execution:void 0!==t&&Boolean(t)});const s=(0,a.A)((0,a.A)({},n.config),{},{[e]:"condition"===e?t?"is_data_missing":void 0:t});return(0,a.A)((0,a.A)({},n),{},{config:s})})},availableTasks:Le})})]})]})}),(0,O.jsxs)(o.A,{sx:{display:"flex",gap:2,justifyContent:"flex-end",p:2,backgroundColor:"white",borderTop:"1px solid rgba(0, 0, 0, 0.12)",position:"static",width:"100%",zIndex:1100},children:[(0,O.jsx)(x.A,{onClick:fe,children:"Cancel"}),(0,O.jsx)(x.A,{onClick:()=>{at()},variant:"contained",color:"primary",children:"Save"})]})]}),(0,O.jsx)(h.A,{open:!!ze,autoHideDuration:6e3,onClose:()=>Oe(null),anchorOrigin:{vertical:"top",horizontal:"center"},children:(0,O.jsx)(m.A,{onClose:()=>Oe(null),severity:"error",variant:"filled",sx:{width:"100%"},children:ze})}),(0,O.jsxs)(r.A,{open:_e,onClose:st,fullWidth:!0,maxWidth:"md",children:[(0,O.jsx)(d.A,{children:(0,O.jsxs)(o.A,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:["Task Description",(0,O.jsx)(u.A,{onClick:st,children:(0,O.jsx)(D.A,{})})]})}),(0,O.jsx)(l.A,{children:(0,O.jsx)(V.A,{autoFocus:!0,fullWidth:!0,multiline:!0,rows:15,value:Ne.description,onChange:e=>et("description",e.target.value),variant:"outlined",sx:{mt:2}})}),(0,O.jsx)(B.A,{children:(0,O.jsx)(x.A,{onClick:st,variant:"contained",children:"Done"})})]}),(0,O.jsxs)(r.A,{open:Ie,onClose:it,fullWidth:!0,maxWidth:"md",children:[(0,O.jsx)(d.A,{children:(0,O.jsxs)(o.A,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:["Expected Output",(0,O.jsx)(u.A,{onClick:it,children:(0,O.jsx)(D.A,{})})]})}),(0,O.jsx)(l.A,{children:(0,O.jsx)(V.A,{autoFocus:!0,fullWidth:!0,multiline:!0,rows:15,value:Ne.expected_output,onChange:e=>et("expected_output",e.target.value),variant:"outlined",sx:{mt:2}})}),(0,O.jsx)(B.A,{children:(0,O.jsx)(x.A,{onClick:it,variant:"contained",children:"Done"})})]}),(0,O.jsx)(Dt,{open:Ze,onClose:()=>$e(!1)})]})};var Pt=n(61031);const Mt=e=>{var t;let{data:n,id:s}=e;const{setNodes:h,setEdges:m,getNodes:p,getEdges:x}=(0,A.VH)(),[g,f]=(0,i.useState)(!1),[v,y]=(0,i.useState)([]),[b,j]=(0,i.useState)(!1),[w,k]=(0,i.useState)(!1),[C,S]=(0,i.useState)(!1),{markCurrentTabDirty:_}=ft(),E=(0,Pt.useTaskExecutionStore)(e=>{let t=null;if(n.label){if(t=e.getTaskStatus(n.label),t||(t=e.getTaskStatus(n.label.toLowerCase())),!t){const a=n.label.replace(/_/g," ");t=e.getTaskStatus(a)}if(!t){const a="task_".concat(n.label.replace(/\s+/g,"_").toLowerCase());t=e.getTaskStatus(a)}if(!t){const a=n.label.toLowerCase(),s=a.split(/\s+/).filter(e=>e.length>2),i=Array.from(e.taskStates.keys());for(const n of i){const i=n.toLowerCase();if((i.startsWith(a)||i.startsWith(a.replace(/\s+/g,"_"))||i.startsWith(a.replace(/\s+/g,"-")))&&(t=e.getTaskStatus(n),t))break;if(!t&&s.length>0){if(s.every(e=>i.includes(e))&&(t=e.getTaskStatus(n),t))break}}}}if(!t&&n.taskId&&(t=e.getTaskStatus(n.taskId),!t&&n.taskId.startsWith("task-"))){const a=n.taskId.substring(5);t=e.getTaskStatus(a)}return t});(0,i.useEffect)(()=>{x()},[s,n,x]),(0,i.useEffect)(()=>{if(g){(async()=>{try{const e=await gt.m.listTools();y(e)}catch(e){}})()}},[g]),(0,i.useEffect)(()=>{(async()=>{try{const e=await gt.m.listTools();y(e)}catch(e){}})()},[]);const I=(0,i.useCallback)(()=>{S(e=>!e)},[]),T=(0,i.useCallback)(()=>{j(!1),k(!1),h(e=>e.filter(e=>e.id!==s)),m(e=>e.filter(e=>e.source!==s&&e.target!==s))},[s,h,m]),N=(0,i.useCallback)(()=>{const e=p(),t=x(),n=e.find(e=>e.id===s);if(!n)return;const a=e.filter(e=>"taskNode"===e.type),i=a.find(e=>{const t=e.position.y>n.position.y,s=Math.abs(e.position.x-n.position.x)<100,i=!a.some(t=>{const a=t.position.y>n.position.y,s=Math.abs(t.position.x-n.position.x)<100,i=t.position.y<e.position.y;return t.id!==e.id&&a&&s&&i});return t&&s&&i});if(i){if(!t.some(e=>e.source===s&&e.target===i.id)){const e={id:"".concat(s,"-").concat(i.id),source:s,target:i.id,type:"default",animated:!0};m(t=>[...t,e])}}},[s,p,x,m]);(0,i.useEffect)(()=>{g&&(j(!1),k(!1))},[g]);const M=(0,i.useCallback)(e=>{e.preventDefault(),e.stopPropagation();const t=e.target,n=!!t.closest("button"),a=!!t.closest(".action-buttons");n||a||I()},[I]),z={mr:1.5,color:e=>e.palette.primary.main,fontSize:"2rem",padding:"4px",borderRadius:"50%",backgroundColor:"rgba(25, 118, 210, 0.05)"};return(0,O.jsxs)(O.Fragment,{children:[(0,O.jsx)(A.h7,{type:"target",position:A.yX.Left,style:{background:"#2196f3",width:"7px",height:"7px"}}),(0,O.jsxs)(o.A,{sx:(()=>{const e="running"===(null===E||void 0===E?void 0:E.status),t="completed"===(null===E||void 0===E?void 0:E.status),n="failed"===(null===E||void 0===E?void 0:E.status),a={minWidth:160,minHeight:120,display:"flex",flexDirection:"column",position:"relative",padding:2,background:a=>e?"linear-gradient(135deg, ".concat(a.palette.info.light,"15, ").concat(a.palette.info.main,"10)"):t?"linear-gradient(135deg, ".concat(a.palette.success.light,"15, ").concat(a.palette.success.main,"10)"):n?"linear-gradient(135deg, ".concat(a.palette.error.light,"15, ").concat(a.palette.error.main,"10)"):C?"".concat(a.palette.primary.light,"20"):a.palette.background.paper,borderRadius:"8px",border:"1px solid",borderColor:a=>e?a.palette.info.main:t?a.palette.success.main:n?a.palette.error.main:C?a.palette.primary.main:a.palette.grey[300],boxShadow:e=>C?"0 0 0 2px ".concat(e.palette.primary.main):"0 2px 4px ".concat("light"===e.palette.mode?"rgba(0, 0, 0, 0.05)":"rgba(0, 0, 0, 0.2)"),animation:e?"pulse 2s infinite":"none","@keyframes pulse":{"0%":{boxShadow:"0 0 0 0 rgba(33, 150, 243, 0.4)"},"70%":{boxShadow:"0 0 0 10px rgba(33, 150, 243, 0)"},"100%":{boxShadow:"0 0 0 0 rgba(33, 150, 243, 0)"}},"&:hover":{boxShadow:"0 4px 8px rgba(0, 0, 0, 0.15)","& .action-buttons":{display:"flex"}},"& .action-buttons":{display:"none",position:"absolute",top:4,right:4,zIndex:10,pointerEvents:"all"}};return a})(),onClick:M,"data-taskid":n.taskId,"data-label":n.label,"data-nodeid":s,"data-nodetype":"task","data-selected":C?"true":"false",children:[E&&(0,O.jsx)(o.A,{sx:{position:"absolute",top:8,right:8,display:"flex",alignItems:"center",justifyContent:"center"},children:(()=>{if(!E)return null;switch(E.status){case"running":return(0,O.jsx)(ue.A,{size:14,sx:{color:"info.main"}});case"completed":return(0,O.jsx)(rt.A,{sx:{fontSize:16,color:"success.main"}});case"failed":return(0,O.jsx)(bt.A,{sx:{fontSize:16,color:"error.main"}});default:return null}})()}),(0,O.jsxs)("div",{className:"action-buttons",children:[(0,O.jsx)(P.A,{title:"Edit Task",open:b,onOpen:()=>j(!0),onClose:()=>j(!1),children:(0,O.jsx)(u.A,{size:"small",onClick:()=>{j(!1),k(!1),document.activeElement&&document.activeElement.blur(),f(!0)},onMouseEnter:()=>j(!0),onMouseLeave:()=>j(!1),sx:{mr:.5,backgroundColor:"rgba(255, 255, 255, 0.3)","&:hover":{backgroundColor:"rgba(255, 255, 255, 0.5)"},zIndex:20},children:(0,O.jsx)(Y.A,{fontSize:"small"})})}),(0,O.jsx)(P.A,{title:"Delete Task",open:w,onOpen:()=>k(!0),onClose:()=>k(!1),children:(0,O.jsx)(u.A,{size:"small",onClick:T,onMouseEnter:()=>k(!0),onMouseLeave:()=>k(!1),sx:{backgroundColor:"rgba(255, 255, 255, 0.3)","&:hover":{backgroundColor:"rgba(255, 255, 255, 0.5)"},zIndex:20},children:(0,O.jsx)(q.A,{fontSize:"small"})})})]}),(0,O.jsxs)(o.A,{sx:{display:"flex",alignItems:"center",mb:1},children:[n.icon?(0,O.jsx)(o.A,{component:"span",sx:z,children:n.icon}):(0,O.jsx)(yt.A,{sx:z}),(0,O.jsx)(c.A,{variant:"body2",sx:{fontWeight:500,color:e=>e.palette.primary.main,fontSize:"0.9rem"},children:n.label})]}),(0,O.jsx)(c.A,{variant:"body2",color:"textSecondary",sx:{fontSize:"0.8rem",overflow:"hidden",textOverflow:"ellipsis",display:"-webkit-box",WebkitLineClamp:2,WebkitBoxOrient:"vertical"},children:n.description}),(0,O.jsxs)(c.A,{variant:"caption",color:"textSecondary",sx:{mt:"auto",pt:1,fontSize:"0.7rem",display:"flex",alignItems:"center",justifyContent:"space-between",width:"100%"},children:[(0,O.jsxs)("span",{children:["Tools: ",Array.isArray(n.tools)?n.tools.length:0]}),(null===(t=n.config)||void 0===t?void 0:t.human_input)&&(0,O.jsx)("span",{style:{color:"orange"},children:"Human Input"})]})]}),(0,O.jsx)(A.h7,{type:"source",position:A.yX.Right,style:{background:"#2196f3",width:"7px",height:"7px"},onDoubleClick:N}),(0,O.jsxs)(r.A,{open:g,onClose:()=>f(!1),maxWidth:"md",fullWidth:!0,PaperProps:{sx:{maxHeight:"80vh",position:"relative"}},children:[(0,O.jsxs)(d.A,{children:["Edit Task",(0,O.jsx)(u.A,{"aria-label":"close",onClick:()=>f(!1),sx:{position:"absolute",right:8,top:8},children:(0,O.jsx)(D.A,{})})]}),(0,O.jsx)(l.A,{children:(0,O.jsx)(o.A,{sx:{mt:2},children:(0,O.jsx)(Nt,{initialData:(()=>{var e,t,a,s,i,o,r,l,d,c,u,h,m,p,x,g;return{id:n.taskId,name:n.label,description:n.description||"",expected_output:n.expected_output||"",tools:n.tools||[],tool_configs:n.tool_configs||{},agent_id:"",async_execution:n.async_execution||!1,context:n.context||[],markdown:(null===(e=n.config)||void 0===e?void 0:e.markdown)||!1,config:{cache_response:(null===(t=n.config)||void 0===t?void 0:t.cache_response)||!1,cache_ttl:(null===(a=n.config)||void 0===a?void 0:a.cache_ttl)||3600,retry_on_fail:(null===(s=n.config)||void 0===s?void 0:s.retry_on_fail)||!0,max_retries:(null===(i=n.config)||void 0===i?void 0:i.max_retries)||3,timeout:(null===(o=n.config)||void 0===o?void 0:o.timeout)||null,priority:(null===(r=n.config)||void 0===r?void 0:r.priority)||1,error_handling:(null===(l=n.config)||void 0===l?void 0:l.error_handling)||"default",output_file:(null===(d=n.config)||void 0===d?void 0:d.output_file)||null,output_json:(null===(c=n.config)||void 0===c?void 0:c.output_json)||null,output_pydantic:(null===(u=n.config)||void 0===u?void 0:u.output_pydantic)||null,callback:(null===(h=n.config)||void 0===h?void 0:h.callback)||null,human_input:(null===(m=n.config)||void 0===m?void 0:m.human_input)||!1,condition:null===(p=n.config)||void 0===p?void 0:p.condition,guardrail:(null===(x=n.config)||void 0===x?void 0:x.guardrail)||void 0,markdown:(null===(g=n.config)||void 0===g?void 0:g.markdown)||!1}}})(),onCancel:()=>f(!1),onTaskSaved:e=>{_(),h(t=>t.map(t=>{if(t.id===s){var n,i,o,r,l,d,c;const s=(0,a.A)((0,a.A)({},t.data),{},{label:e.name,description:e.description,expected_output:e.expected_output,tools:e.tools,tool_configs:e.tool_configs||{},async_execution:e.async_execution,context:e.context,markdown:void 0!==e.markdown?e.markdown:(null===(n=e.config)||void 0===n?void 0:n.markdown)||!1,config:(0,a.A)((0,a.A)((0,a.A)({},t.data.config),e.config),{},{output_pydantic:(null===(i=e.config)||void 0===i?void 0:i.output_pydantic)||null,output_json:(null===(o=e.config)||void 0===o?void 0:o.output_json)||null,output_file:(null===(r=e.config)||void 0===r?void 0:r.output_file)||null,callback:(null===(l=e.config)||void 0===l?void 0:l.callback)||null,guardrail:(null===(d=e.config)||void 0===d?void 0:d.guardrail)||void 0,markdown:void 0!==e.markdown?e.markdown:(null===(c=e.config)||void 0===c?void 0:c.markdown)||!1})});return(0,a.A)((0,a.A)({},t),{},{data:s})}return t})),f(!1)},tools:v,hideTitle:!0})})})]})]})},zt=i.memo(Mt);var Ot=n(57528),Lt=n(88283);const Ft=n(51673).v.createChild("FlowService");class Wt{static async getFlows(){try{const e=await ye.uE.get("/flows");return e.data.map(e=>(e.flow_config&&(e.flowConfig=e.flow_config,e.nodes&&Array.isArray(e.nodes)&&(e.nodes=e.nodes.map(t=>t.data?(0,a.A)((0,a.A)({},t),{},{data:(0,a.A)((0,a.A)({},t.data),{},{flowConfig:e.flowConfig})}):t))),e))}catch(e){return[]}}static async getFlow(e){try{if(!e||""===e.trim())return null;let n=e;if(e&&!e.includes("-")&&e.length>=32)try{n=[e.substring(0,8),e.substring(8,12),e.substring(12,16),e.substring(16,20),e.substring(20)].join("-")}catch(t){n=e}const s=(await ye.uE.get("/flows/".concat(n))).data;return s&&"object"===typeof s?(s.flow_config&&(s.flowConfig=s.flow_config,s.nodes&&Array.isArray(s.nodes)&&(s.nodes=s.nodes.map(e=>e.data?(0,a.A)((0,a.A)({},e),{},{data:(0,a.A)((0,a.A)({},e.data),{},{flowConfig:s.flowConfig})}):e))),s):null}catch(n){if(n&&"object"===typeof n&&"response"in n){}return null}}static async saveFlow(e){try{if(Ft.info("Saving new flow with name:",e.name),!e.name)throw new Error("Flow name is required");if(void 0===e.crew_id||null===e.crew_id)throw new Error("Crew ID is required");if(!Array.isArray(e.nodes))throw new Error("Nodes must be an array");if(!Array.isArray(e.edges))throw new Error("Edges must be an array");let r=e.crew_id;("number"===typeof r||/^\d+$/.test(r))&&(Ft.debug("Converting numeric crew_id ".concat(r," to UUID format")),r=(0,k.A)(),Ft.debug("Generated UUID for crew_id: ".concat(r))),Ft.debug("Incoming flow data:",{name:e.name,crew_id:r,nodes:e.nodes.length,edges:e.edges.length,hasFlowConfig:!!e.flowConfig});const l=e.flowConfig?{id:e.flowConfig.id||"flow-".concat(Date.now()),name:e.flowConfig.name||e.name,type:e.flowConfig.type||"default",listeners:(e.flowConfig.listeners||[]).map(e=>(Ft.debug("Processing listener:",e.name),(0,a.A)({id:e.id,name:e.name,crewId:e.crewId,crewName:e.crewName,listenToTaskIds:e.listenToTaskIds||[],listenToTaskNames:e.listenToTaskNames||[],tasks:(e.tasks||[]).map(e=>({id:e.id,name:e.name,agent_id:e.agent_id,description:e.description||"",expected_output:e.expected_output||"",tools:e.tools||[],context:e.context||[],markdown:Boolean(e.markdown||!1)})),state:e.state||{stateType:"unstructured",stateDefinition:"",stateData:{}},conditionType:e.conditionType||"NONE"},"ROUTER"===e.conditionType&&e.routerConfig?{routerConfig:{defaultRoute:e.routerConfig.defaultRoute,routes:e.routerConfig.routes.map(e=>({name:e.name,condition:e.condition,taskIds:e.taskIds}))}}:{}))),actions:(e.flowConfig.actions||[]).map(e=>(Ft.debug("Processing action:",e.id),{id:e.id,crewId:e.crewId,crewName:e.crewName,taskId:e.taskId,taskName:e.taskName})),startingPoints:(e.flowConfig.startingPoints||[]).filter(e=>e.isStartPoint).map(e=>(Ft.debug("Processing starting point:",e.taskName),{crewId:e.crewId,crewName:e.crewName,taskId:e.taskId,taskName:e.taskName,isStartPoint:!0}))}:{id:"flow-".concat(Date.now()),name:e.name,type:"default",listeners:[],actions:[],startingPoints:[]},d=e.nodes.map(e=>{var t;return Ft.debug("Processing node:",e.id),{id:e.id,type:e.type,position:e.position||{x:0,y:0},data:(0,a.A)((0,a.A)({},e.data),{},{label:(null===(t=e.data)||void 0===t?void 0:t.label)||e.id})}}),c=e.edges.map(e=>(Ft.debug("Processing edge:",e.id),{id:e.id,source:e.source,target:e.target,type:e.type||"default"})),u={name:e.name,crew_id:r,nodes:d,edges:c,flow_config:l};Ft.debug("Sending flow data to backend:",{name:u.name,crew_id:u.crew_id,nodesCount:u.nodes.length,edgesCount:u.edges.length});try{const e=await ye.uE.post("/flows",u);Ft.info("Flow created successfully:",e.data.id);const t=e.data;return t.flow_config&&(t.flowConfig=t.flow_config),t}catch(o){if(o&&"object"===typeof o&&"response"in o){var t,n,s,i;const e=o;throw Ft.error("Server validation error details:",{status:null===(t=e.response)||void 0===t?void 0:t.status,statusText:null===(n=e.response)||void 0===n?void 0:n.statusText,data:null===(s=e.response)||void 0===s?void 0:s.data}),new Error("Server validation error: ".concat(JSON.stringify(null===(i=e.response)||void 0===i?void 0:i.data)))}throw o instanceof Error?o:new Error("Unknown error occurred")}}catch(o){throw Ft.error("Error creating flow:",o),o instanceof Error?o:new Error("Failed to save flow")}}static async updateFlow(e,t){try{let s=e;if(e&&!e.includes("-")&&e.length>=32)try{s=[e.substring(0,8),e.substring(8,12),e.substring(12,16),e.substring(16,20),e.substring(20)].join("-")}catch(n){s=e}const i=t.flowConfig?{id:t.flowConfig.id||"flow-".concat(Date.now()),name:t.flowConfig.name||t.name,type:t.flowConfig.type||"default",listeners:(t.flowConfig.listeners||[]).map(e=>(0,a.A)({id:e.id,name:e.name,crewId:e.crewId,crewName:e.crewName,listenToTaskIds:e.listenToTaskIds||[],listenToTaskNames:e.listenToTaskNames||[],tasks:(e.tasks||[]).map(e=>({id:e.id,name:e.name,agent_id:e.agent_id,description:e.description||"",expected_output:e.expected_output||"",tools:e.tools||[],context:e.context||[],markdown:Boolean(e.markdown||!1)})),state:e.state||{stateType:"unstructured",stateDefinition:"",stateData:{}},conditionType:e.conditionType||"NONE"},"ROUTER"===e.conditionType&&e.routerConfig?{routerConfig:{defaultRoute:e.routerConfig.defaultRoute,routes:e.routerConfig.routes.map(e=>({name:e.name,condition:e.condition,taskIds:e.taskIds}))}}:{})),actions:(t.flowConfig.actions||[]).map(e=>({id:e.id,crewId:e.crewId,crewName:e.crewName,taskId:e.taskId,taskName:e.taskName})),startingPoints:(t.flowConfig.startingPoints||[]).filter(e=>e.isStartPoint).map(e=>({crewId:e.crewId,crewName:e.crewName,taskId:e.taskId,taskName:e.taskName,isStartPoint:!0}))}:{},o={name:t.name,flow_config:i},r=(await ye.uE.put("/flows/".concat(s),o)).data;return r.flow_config&&(r.flowConfig=r.flow_config),r}catch(s){if(s instanceof Error)throw new Error("Failed to update flow: ".concat(s.message));throw new Error("Failed to update flow: Unknown error occurred")}}static async deleteFlow(e){try{let t=e;if(e&&!e.includes("-")&&e.length>=32)try{t=[e.substring(0,8),e.substring(8,12),e.substring(12,16),e.substring(16,20),e.substring(20)].join("-")}catch(n){t=e}return await ye.uE.delete("/flows/".concat(t,"?force=true")),window.dispatchEvent(new CustomEvent("refreshFlows")),window.dispatchEvent(new CustomEvent("showNotification",{detail:{message:"Flow deleted successfully.",severity:"success"}})),!0}catch(a){let e="Failed to delete flow.";if(a&&"object"===typeof a&&"response"in a){var t;const n=a;if(null!==(t=n.response)&&void 0!==t&&t.data&&"object"===typeof n.response.data&&null!==n.response.data&&"detail"in n.response.data){e=n.response.data.detail||e}window.dispatchEvent(new CustomEvent("showNotification",{detail:{message:e,severity:"error"}}))}return!1}}static async deleteAllFlows(){try{await ye.uE.delete("/flows")}catch(e){throw e}}}let Rt=function(e){return e[e.SelectCrews=0]="SelectCrews",e[e.DefineStartingPoints=1]="DefineStartingPoints",e[e.ConfigureListeners=2]="ConfigureListeners",e[e.ConfigureState=3]="ConfigureState",e[e.Review=4]="Review",e}({});const Vt={activeStep:Rt.SelectCrews,crews:[],selectedCrewIds:[],listeners:[],tasks:[],actions:[],startingPoints:[],flowName:"New Flow",loading:!1,error:null,currentListenerIndex:-1,selectedListenerTasks:[],selectedListenToTasks:[],selectedActionTasks:{}},Bt=(0,j.vt)((e,t)=>(0,a.A)((0,a.A)({},Vt),{},{setActiveStep:t=>e({activeStep:t}),setCrews:t=>e({crews:t}),setSelectedCrewIds:t=>e({selectedCrewIds:t}),setListeners:t=>e({listeners:t}),setTasks:t=>e({tasks:t}),setActions:t=>e({actions:t}),setStartingPoints:t=>e({startingPoints:t}),setFlowName:t=>e({flowName:t}),setLoading:t=>e({loading:t}),setError:t=>e({error:t}),setCurrentListenerIndex:t=>e({currentListenerIndex:t}),setSelectedListenerTasks:t=>e({selectedListenerTasks:t}),setSelectedListenToTasks:t=>e({selectedListenToTasks:t}),setSelectedActionTasks:t=>e({selectedActionTasks:t}),resetFlowWizard:()=>{e({activeStep:Rt.SelectCrews,crews:[],selectedCrewIds:[],listeners:[],tasks:[],actions:[],startingPoints:[],flowName:"",loading:!1,error:null,currentListenerIndex:-1,selectedListenerTasks:[],selectedListenToTasks:[],selectedActionTasks:{}})},loadCrews:async()=>{try{e({loading:!0,error:null});const n=await We.getCrews();e({crews:n});const a=[];for(const e of n)try{const t=await We.getTasks(e.id);a.push(...t)}catch(t){}e({tasks:a})}catch(t){e({error:"Failed to load crews. Please try again."})}finally{e({loading:!1})}},toggleCrewSelection:n=>{const{selectedCrewIds:a}=t(),s=a.includes(n)?a.filter(e=>e!==n):[...a,n];e({selectedCrewIds:s})},handleNext:()=>{const{activeStep:n,selectedCrewIds:a,startingPoints:s,crews:i,tasks:o}=t();if(n===Rt.SelectCrews){if(0===a.length)return void e({error:"Please select at least one crew"});const t=o.filter(e=>a.includes(e.agent_id)).map(e=>{const t=i.find(t=>t.id===e.agent_id);return{crewId:e.agent_id,taskId:e.id,isStartPoint:!1,taskName:e.name,crewName:(null===t||void 0===t?void 0:t.name)||"Unknown Crew"}});e({startingPoints:t,activeStep:Rt.DefineStartingPoints})}else if(n===Rt.DefineStartingPoints){if(!s.some(e=>e.isStartPoint))return void e({error:"Please select at least one task as a starting point"});e({activeStep:Rt.ConfigureListeners})}else n===Rt.ConfigureListeners?e({activeStep:Rt.ConfigureState}):n===Rt.ConfigureState&&e({activeStep:Rt.Review})},handleBack:()=>{const{activeStep:n}=t();n>0&&e({activeStep:n-1})},handleListenerTaskChange:n=>{const{currentListenerIndex:s,listeners:i}=t();if(s>=0){const o=[...i],r=n.map(e=>t().tasks.find(t=>t.id===e)||{id:e,name:e,agent_id:"",expected_output:"",description:"",context:[]});o[s]=(0,a.A)((0,a.A)({},o[s]),{},{tasks:r}),e({listeners:o,selectedListenerTasks:n})}},handleListenToTaskChange:n=>{const{currentListenerIndex:s,listeners:i}=t();if(s>=0){const o=[...i];o[s]=(0,a.A)((0,a.A)({},o[s]),{},{listenToTaskIds:n,listenToTaskNames:n.map(e=>{const n=t().tasks.find(t=>t.id===e);return(null===n||void 0===n?void 0:n.name)||e})}),e({listeners:o})}},handleStateUpdate:n=>{const{currentListenerIndex:s,listeners:i}=t();if(s>=0){const t=[...i];t[s]=(0,a.A)((0,a.A)({},t[s]),{},{state:n}),e({listeners:t})}},handleActionTaskChange:(t,n)=>{e(e=>({selectedActionTasks:(0,a.A)((0,a.A)({},e.selectedActionTasks),{},{[t]:n})}))},handleDeleteAction:n=>{const a=t().actions.filter(e=>{const a=t().tasks.find(e=>e.id===n);return a&&a.id!==n});e({actions:a})},handleToggleStartingPoint:n=>{const{startingPoints:s}=t(),i=s.map(e=>e.taskId===n?(0,a.A)((0,a.A)({},e),{},{isStartPoint:!e.isStartPoint}):e);e({startingPoints:i})},addListener:()=>{const{listeners:n,crews:a}=t(),s=a[0],i={id:"listener-".concat(Date.now(),"-").concat(n.length),name:"Listener ".concat(n.length+1),crewId:(null===s||void 0===s?void 0:s.id)||"",crewName:(null===s||void 0===s?void 0:s.name)||"Unknown Crew",listenToTaskIds:[],listenToTaskNames:[],tasks:[],waitForAll:!1,state:{stateType:"unstructured",stateDefinition:"",stateData:{}},conditionType:"NONE"};e({listeners:[...n,i],currentListenerIndex:n.length,selectedListenerTasks:[]})},deleteListener:n=>{const{listeners:a,currentListenerIndex:s}=t(),i=a.filter(e=>e.id!==n);e({listeners:i,currentListenerIndex:s>=i.length?i.length-1:s})},updateListenerName:(n,s)=>{const{listeners:i}=t(),o=[...i];o[n]=(0,a.A)((0,a.A)({},o[n]),{},{name:s}),e({listeners:o})},updateListenerConditionType:(n,s)=>{const{listeners:i}=t();if(n>=0&&n<i.length){const t=[...i];t[n]=(0,a.A)((0,a.A)({},t[n]),{},{conditionType:s}),e({listeners:t})}},updateRouterConfig:(n,s,i)=>{const{listeners:o}=t();if(n>=0&&n<o.length){const t=[...o];t[n]=(0,a.A)((0,a.A)({},t[n]),{},{routerConfig:{defaultRoute:s,routes:i}}),e({listeners:t})}}})),Ut=e=>{let{crews:t,selectedCrewIds:n,onCrewSelect:a}=e;return t&&0!==t.length?(0,O.jsxs)(o.A,{sx:{pt:2,pb:2},children:[(0,O.jsx)(c.A,{variant:"body1",gutterBottom:!0,children:"Select crews to add to the canvas:"}),(0,O.jsx)(o.A,{sx:{display:"flex",flexWrap:"wrap",gap:2,mt:2},children:t.map(e=>(0,O.jsxs)(o.A,{onClick:()=>a(e),sx:{border:"2px solid",borderColor:n.includes(e.id)?"primary.main":"grey.300",borderRadius:"8px",padding:2,cursor:"pointer",bgcolor:n.includes(e.id)?"primary.light":"background.paper",transition:"all 0.2s ease",width:"calc(50% - 8px)",boxSizing:"border-box","&:hover":{bgcolor:n.includes(e.id)?"primary.light":"grey.100"}},children:[(0,O.jsx)(c.A,{variant:"subtitle1",children:e.name}),(0,O.jsx)(c.A,{variant:"body2",color:"text.secondary",children:"ID: ".concat(e.id)})]},e.id))})]}):(0,O.jsx)(o.A,{display:"flex",justifyContent:"center",p:3,children:(0,O.jsx)(ue.A,{})})};var Ht=n(93038);const Kt=e=>{let{tasks:t,startingPoints:n,onToggleStartingPoint:a}=e;const s=n.filter(e=>{const n=t.find(t=>t.id===e.taskId);return n&&!n.id.startsWith("agent-")});return 0===s.length?(0,O.jsx)(c.A,{variant:"body2",color:"text.secondary",sx:{p:2},children:"No valid tasks found for the selected crews. Please go back and select different crews."}):(0,O.jsxs)(o.A,{sx:{pt:2,pb:2},children:[(0,O.jsx)(c.A,{variant:"body1",gutterBottom:!0,children:"Select tasks for your flow:"}),(0,O.jsxs)(o.A,{sx:{mt:2},children:[(0,O.jsx)(c.A,{variant:"caption",color:"text.secondary",sx:{mb:1,display:"block"},children:"At least one task must be selected as a starting point. Starting points are specific tasks that will trigger the workflow execution."}),(0,O.jsxs)(_e.A,{variant:"outlined",sx:{mb:2,p:2},children:[(0,O.jsx)(c.A,{variant:"subtitle2",color:"primary",gutterBottom:!0,children:"Only tasks (with numeric IDs) can be starting points, not agents"}),(0,O.jsx)(at.A,{dense:!0,children:s.map(e=>{const n=t.find(t=>t.id===e.taskId);return n?(0,O.jsx)(st.Ay,{secondaryAction:(0,O.jsx)(Ht.A,{edge:"end",checked:e.isStartPoint,onChange:()=>a(e.taskId),inputProps:{"aria-labelledby":"task-".concat(e.taskId)}}),children:(0,O.jsx)(ot.A,{id:"task-".concat(e.taskId),primary:"".concat(e.crewName,":").concat(n.name),secondary:"ID: ".concat(n.id," (Task)")})},e.taskId):null})})]})]})]})};var Gt=n(49540),Jt=n(58567),qt=n(85815),Yt=n(45180),Xt=n(50704),Zt=n(25713),Qt=n(99532);const $t=e=>{var t,n,a,s;let{tasks:r,listeners:l,selectedCrewIds:d,crews:h,onListenerTaskChange:m,onListenToTaskChange:p,onAddListener:g,onDeleteListener:f,onUpdateListenerName:v,onUpdateConditionType:A,onUpdateRouterConfig:y}=e;const[b,j]=(0,i.useState)(-1),[w,k]=(0,i.useState)([]),[C,S]=(0,i.useState)(""),_=r.filter(e=>e.agent_id&&d.includes(e.agent_id));return(0,O.jsxs)(o.A,{sx:{pt:2,pb:2},children:[(0,O.jsx)(c.A,{variant:"body1",gutterBottom:!0,children:"Configure listeners for your flow:"}),(0,O.jsx)(c.A,{variant:"caption",color:"text.secondary",sx:{mb:2,display:"block"},children:"Listeners respond to task outputs in the flow. Each listener can execute one or more tasks when triggered."}),(0,O.jsx)(x.A,{variant:"outlined",color:"primary",onClick:g,sx:{mb:3},children:"Add New Listener"}),0===l.length?(0,O.jsx)(c.A,{variant:"body2",sx:{my:2},children:"No listeners configured. Click the button above to add a listener."}):(0,O.jsxs)(ce.Ay,{container:!0,spacing:2,sx:{mt:1,mb:2},children:[(0,O.jsxs)(ce.Ay,{item:!0,xs:12,sm:4,children:[(0,O.jsx)(c.A,{variant:"subtitle2",gutterBottom:!0,children:"Listeners"}),(0,O.jsx)(_e.A,{variant:"outlined",sx:{p:2,height:"300px",overflow:"auto"},children:l.map((e,t)=>(0,O.jsxs)(o.A,{onClick:()=>j(t),sx:{p:1.5,mb:1,borderRadius:1,cursor:"pointer",bgcolor:b===t?"primary.light":"grey.100","&:hover":{bgcolor:b===t?"primary.light":"grey.200"},position:"relative"},children:[(0,O.jsxs)(c.A,{variant:"body2",fontWeight:b===t?"bold":"normal",children:[e.name," ","NONE"!==e.conditionType?"(".concat(e.conditionType,")"):""]}),(0,O.jsxs)(c.A,{variant:"caption",color:"text.secondary",display:"block",children:["Listening to: ",e.listenToTaskNames.join(", ")||"Not set"]}),(0,O.jsxs)(c.A,{variant:"caption",color:"text.secondary",children:[e.tasks.length," task(s) to execute"]}),(0,O.jsx)(u.A,{size:"small",onClick:t=>{t.stopPropagation(),f(e.id)},sx:{position:"absolute",right:8,top:8,opacity:b===t?1:0,"&:hover":{opacity:1}},children:(0,O.jsx)(q.A,{fontSize:"small"})})]},e.id))})]}),b>=0&&(0,O.jsxs)(ce.Ay,{item:!0,xs:12,sm:8,children:[(0,O.jsxs)(c.A,{variant:"subtitle2",gutterBottom:!0,children:["Configure Listener: ",null===(t=l[b])||void 0===t?void 0:t.name]}),(0,O.jsxs)(_e.A,{variant:"outlined",sx:{p:2},children:[(0,O.jsx)(V.A,{fullWidth:!0,label:"Listener Name",value:(null===(n=l[b])||void 0===n?void 0:n.name)||"",onChange:e=>v(b,e.target.value),sx:{mb:2}}),(0,O.jsxs)(oe.A,{component:"fieldset",sx:{mb:2},children:[(0,O.jsx)(Gt.A,{component:"legend",children:"Connection Type"}),(0,O.jsxs)(Jt.A,{row:!0,value:(null===(a=l[b])||void 0===a?void 0:a.conditionType)||"NONE",onChange:e=>(e=>{if(b>=0&&A&&(A(b,e),"ROUTER"===e)){const e=l[b];e.routerConfig?(k(e.routerConfig.routes),S(e.routerConfig.defaultRoute)):(k([{name:"Default",condition:"",taskIds:[]}]),S("Default"),y&&y(b,"Default",[{name:"Default",condition:"",taskIds:[]}]))}})(e.target.value),children:[(0,O.jsx)(he.A,{value:"NONE",control:(0,O.jsx)(qt.A,{}),label:"Default"}),(0,O.jsx)(he.A,{value:"AND",control:(0,O.jsx)(qt.A,{}),label:"AND"}),(0,O.jsx)(he.A,{value:"OR",control:(0,O.jsx)(qt.A,{}),label:"OR"}),(0,O.jsx)(he.A,{value:"ROUTER",control:(0,O.jsx)(qt.A,{}),label:"ROUTER"})]}),(0,O.jsxs)(c.A,{variant:"caption",color:"text.secondary",children:[(0,O.jsx)("strong",{children:"Default:"})," Executes after all specified tasks complete.",(0,O.jsx)("strong",{children:" AND:"})," Requires ALL tasks to complete before triggering.",(0,O.jsx)("strong",{children:" OR:"})," Triggers when ANY of the tasks completes.",(0,O.jsx)("strong",{children:" ROUTER:"})," Routes execution based on conditions."]})]}),"ROUTER"!==(null===(s=l[b])||void 0===s?void 0:s.conditionType)?(0,O.jsxs)(O.Fragment,{children:[(0,O.jsxs)(oe.A,{fullWidth:!0,sx:{mt:2},children:[(0,O.jsx)(re.A,{id:"listen-to-task-label",children:"Listen To Tasks"}),(0,O.jsx)(le.A,{labelId:"listen-to-task-label",multiple:!0,value:l[b].listenToTaskIds,onChange:e=>p(e.target.value),label:"Listen To Tasks",renderValue:e=>(0,O.jsx)(o.A,{sx:{display:"flex",flexWrap:"wrap",gap:.5},children:e.map(e=>{const t=_.find(t=>String(t.id)===e),n=null!==t&&void 0!==t&&t.agent_id?h.find(e=>e.id===t.agent_id):void 0;return(0,O.jsx)(R.A,{label:"".concat((null===n||void 0===n?void 0:n.name)||"Unknown",":").concat((null===t||void 0===t?void 0:t.name)||e)},e)})}),children:_.map(e=>{const t=String(e.id),n=e.agent_id?h.find(t=>t.id===e.agent_id):void 0;return(0,O.jsxs)(de.A,{value:t,children:[(0,O.jsx)(Ht.A,{checked:l[b].listenToTaskIds.includes(t)}),(0,O.jsx)(ot.A,{primary:e.name,secondary:"".concat((null===n||void 0===n?void 0:n.name)||"Unknown Crew"," (Task ID: ").concat(e.id,")")})]},t)})})]}),(0,O.jsxs)(oe.A,{fullWidth:!0,sx:{mt:3},children:[(0,O.jsx)(re.A,{id:"listener-task-label",children:"Tasks to Execute"}),(0,O.jsx)(le.A,{labelId:"listener-task-label",multiple:!0,value:l[b].tasks.map(e=>String(e.id)),onChange:e=>m(e.target.value),label:"Tasks to Execute",renderValue:e=>(0,O.jsx)(o.A,{sx:{display:"flex",flexWrap:"wrap",gap:.5},children:e.map(e=>{const t=_.find(t=>String(t.id)===e),n=null!==t&&void 0!==t&&t.agent_id?h.find(e=>e.id===t.agent_id):void 0;return(0,O.jsx)(R.A,{label:"".concat((null===n||void 0===n?void 0:n.name)||"Unknown",":").concat((null===t||void 0===t?void 0:t.name)||e)},e)})}),children:_.map(e=>{const t=String(e.id),n=e.agent_id?h.find(t=>t.id===e.agent_id):void 0;return(0,O.jsxs)(de.A,{value:t,children:[(0,O.jsx)(Ht.A,{checked:l[b].tasks.map(e=>String(e.id)).includes(t)}),(0,O.jsx)(ot.A,{primary:e.name,secondary:"".concat((null===n||void 0===n?void 0:n.name)||"Unknown Crew"," (Task ID: ").concat(e.id,")")})]},t)})})]})]}):(0,O.jsxs)(o.A,{sx:{mt:3},children:[(0,O.jsx)(te.A,{sx:{mb:2}}),(0,O.jsx)(c.A,{variant:"subtitle2",gutterBottom:!0,children:"Router Configuration"}),(0,O.jsxs)(oe.A,{fullWidth:!0,sx:{mb:2},children:[(0,O.jsx)(re.A,{id:"listen-to-router-task-label",children:"Listen To Task"}),(0,O.jsx)(le.A,{labelId:"listen-to-router-task-label",value:l[b].listenToTaskIds.length>0?l[b].listenToTaskIds[0]:"",onChange:e=>p([e.target.value]),label:"Listen To Task",children:_.map(e=>{const t=String(e.id),n=e.agent_id?h.find(t=>t.id===e.agent_id):void 0;return(0,O.jsx)(de.A,{value:t,children:(0,O.jsx)(ot.A,{primary:e.name,secondary:"".concat((null===n||void 0===n?void 0:n.name)||"Unknown Crew"," (Task ID: ").concat(e.id,")")})},t)})}),(0,O.jsx)(c.A,{variant:"caption",color:"text.secondary",sx:{mt:1},children:"For a router, you should select exactly one task to listen to."})]}),(0,O.jsxs)(oe.A,{fullWidth:!0,sx:{mb:2},children:[(0,O.jsx)(re.A,{id:"default-route-label",children:"Default Route"}),(0,O.jsx)(le.A,{labelId:"default-route-label",value:C,onChange:e=>{return t=e.target.value,S(t),void(b>=0&&y&&y(b,t,w));var t},label:"Default Route",children:w.map((e,t)=>(0,O.jsx)(de.A,{value:e.name,children:e.name},t))}),(0,O.jsx)(c.A,{variant:"caption",color:"text.secondary",sx:{mt:1},children:"The default route will be taken if no condition matches."})]}),(0,O.jsx)(o.A,{sx:{display:"flex",justifyContent:"flex-end",mb:2},children:(0,O.jsx)(x.A,{startIcon:(0,O.jsx)(Qt.A,{}),onClick:()=>{const e=[...w,{name:"Route ".concat(w.length+1),condition:"",taskIds:[]}];k(e),b>=0&&y&&y(b,C,e)},variant:"outlined",children:"Add Route"})}),w.map((e,t)=>(0,O.jsxs)(ee.A,{variant:"outlined",sx:{mb:2},children:[(0,O.jsx)(Yt.A,{title:(0,O.jsx)(V.A,{fullWidth:!0,label:"Route Name",value:e.name,onChange:e=>((e,t)=>{const n=[...w];n[e].name=t,k(n),w[e].name===C&&S(t),b>=0&&y&&y(b,C===w[e].name?t:C,n)})(t,e.target.value),size:"small"}),action:(0,O.jsx)(u.A,{onClick:()=>(e=>{const t=w.filter((t,n)=>n!==e);k(t),w[e].name===C&&t.length>0?(S(t[0].name),b>=0&&y&&y(b,t[0].name,t)):b>=0&&y&&y(b,C,t)})(t),disabled:w.length<=1,children:(0,O.jsx)(q.A,{})})}),(0,O.jsxs)(Xt.A,{children:[(0,O.jsx)(V.A,{fullWidth:!0,label:"Condition",value:e.condition,onChange:e=>((e,t)=>{const n=[...w];n[e].condition=t,k(n),b>=0&&y&&y(b,C,n)})(t,e.target.value),placeholder:"e.g., state.success_flag === true",helperText:"JavaScript condition that evaluates to true/false",sx:{mb:2}}),(0,O.jsxs)(oe.A,{fullWidth:!0,children:[(0,O.jsx)(re.A,{id:"route-tasks-".concat(t,"-label"),children:"Tasks to Execute"}),(0,O.jsx)(le.A,{labelId:"route-tasks-".concat(t,"-label"),multiple:!0,value:e.taskIds,onChange:e=>((e,t)=>{const n=[...w];n[e].taskIds=t,k(n),b>=0&&y&&y(b,C,n)})(t,e.target.value),label:"Tasks to Execute",renderValue:e=>(0,O.jsx)(o.A,{sx:{display:"flex",flexWrap:"wrap",gap:.5},children:e.map(e=>{const t=_.find(t=>String(t.id)===e),n=null!==t&&void 0!==t&&t.agent_id?h.find(e=>e.id===t.agent_id):void 0;return(0,O.jsx)(R.A,{label:"".concat((null===n||void 0===n?void 0:n.name)||"Unknown",":").concat((null===t||void 0===t?void 0:t.name)||e)},e)})}),children:_.map(t=>{const n=String(t.id),a=t.agent_id?h.find(e=>e.id===t.agent_id):void 0;return(0,O.jsxs)(de.A,{value:n,children:[(0,O.jsx)(Ht.A,{checked:e.taskIds.includes(n)}),(0,O.jsx)(ot.A,{primary:t.name,secondary:"".concat((null===a||void 0===a?void 0:a.name)||"Unknown Crew"," (Task ID: ").concat(t.id,")")})]},n)})})]})]}),(0,O.jsx)(Zt.A,{children:e.name===C&&(0,O.jsx)(c.A,{variant:"caption",color:"primary",sx:{ml:1},children:"Default Route"})})]},t))]})]})]})]})]})},en=e=>{let{initialData:t,onCancel:n,onSubmit:a}=e;const[s,r]=(0,i.useState)((null===t||void 0===t?void 0:t.stateType)||"unstructured"),[l,d]=(0,i.useState)((null===t||void 0===t?void 0:t.stateDefinition)||""),[u,h]=(0,i.useState)(null!==t&&void 0!==t&&t.stateData?JSON.stringify(t.stateData,null,2):"{}"),m=e=>{try{return JSON.parse(e)}catch(t){return null}};return(0,O.jsxs)(o.A,{component:"form",onSubmit:e=>{e.preventDefault(),a&&a({stateType:s,stateDefinition:l,stateData:m(u)||{}})},sx:{mt:2},children:[(0,O.jsx)(c.A,{variant:"h6",gutterBottom:!0,children:"Edge State Configuration"}),(0,O.jsx)(c.A,{variant:"body2",sx:{mb:3},children:"Configure how state is managed and passed along this edge."}),(0,O.jsxs)(oe.A,{fullWidth:!0,sx:{mb:3},children:[(0,O.jsx)(re.A,{id:"state-type-label",children:"State Type"}),(0,O.jsxs)(le.A,{labelId:"state-type-label",value:s,onChange:e=>{return t=e.target.value,r(t),void(a&&a({stateType:t,stateDefinition:l,stateData:m(u)||{}}));var t},label:"State Type",children:[(0,O.jsx)(de.A,{value:"unstructured",children:(0,O.jsxs)(o.A,{children:[(0,O.jsx)(c.A,{variant:"body2",children:"Unstructured"}),(0,O.jsx)(c.A,{variant:"caption",color:"text.secondary",children:"Free-form state handling with no schema validation"})]})}),(0,O.jsx)(de.A,{value:"structured",children:(0,O.jsxs)(o.A,{children:[(0,O.jsx)(c.A,{variant:"body2",children:"Structured"}),(0,O.jsx)(c.A,{variant:"caption",color:"text.secondary",children:"Schema-based state handling with validation"})]})})]})]}),"structured"===s&&(0,O.jsxs)(o.A,{sx:{mb:3},children:[(0,O.jsx)(c.A,{variant:"subtitle2",sx:{mb:1},children:"State Definition"}),(0,O.jsx)(V.A,{fullWidth:!0,multiline:!0,rows:5,value:l,onChange:e=>{return t=e.target.value,d(t),void(a&&a({stateType:s,stateDefinition:t,stateData:m(u)||{}}));var t},placeholder:"class ExampleState(BaseModel): counter: int = 0 message: str = ''",sx:{"& .MuiInputBase-input":{fontFamily:"monospace"}}})]}),(0,O.jsxs)(o.A,{sx:{mb:3},children:[(0,O.jsx)(c.A,{variant:"subtitle2",sx:{mb:1},children:"Initial State Data"}),(0,O.jsx)(V.A,{fullWidth:!0,multiline:!0,rows:5,value:u,onChange:e=>{return t=e.target.value,h(t),void(a&&a({stateType:s,stateDefinition:l,stateData:m(t)||{}}));var t},error:!m(u),helperText:m(u)?"Valid JSON":"Invalid JSON",placeholder:'{\n  "key": "value"\n}',sx:{"& .MuiInputBase-input":{fontFamily:"monospace"}}})]}),(0,O.jsxs)(ce.Ay,{container:!0,spacing:2,justifyContent:"flex-end",children:[(0,O.jsx)(ce.Ay,{item:!0,children:(0,O.jsx)(x.A,{onClick:n,variant:"outlined",children:"Cancel"})}),(0,O.jsx)(ce.Ay,{item:!0,children:(0,O.jsx)(x.A,{type:"submit",variant:"contained",color:"primary",children:"Save"})})]})]})},tn=e=>{var t,n,a;let{listeners:s,onStateUpdate:r}=e;const[l,d]=(0,i.useState)(-1);return 0===s.length?(0,O.jsx)(c.A,{children:"No listeners configured. Go back to add listeners."}):(0,O.jsxs)(o.A,{sx:{pt:2,pb:2},children:[(0,O.jsx)(c.A,{variant:"body1",gutterBottom:!0,children:"Configure state handling for listeners:"}),(0,O.jsx)(c.A,{variant:"caption",color:"text.secondary",sx:{mb:2,display:"block"},children:"Define how each listener will process the output from the task it's listening to."}),(0,O.jsxs)(ce.Ay,{container:!0,spacing:2,children:[(0,O.jsxs)(ce.Ay,{item:!0,xs:12,sm:4,children:[(0,O.jsx)(c.A,{variant:"subtitle2",gutterBottom:!0,children:"Listeners"}),(0,O.jsx)(_e.A,{variant:"outlined",sx:{p:2,height:"400px",overflow:"auto"},children:s.map((e,t)=>(0,O.jsxs)(o.A,{onClick:()=>d(t),sx:{p:1.5,mb:1,borderRadius:1,cursor:"pointer",bgcolor:l===t?"primary.light":"grey.100","&:hover":{bgcolor:l===t?"primary.light":"grey.200"}},children:[(0,O.jsx)(c.A,{variant:"body2",fontWeight:l===t?"bold":"normal",children:e.name}),(0,O.jsxs)(c.A,{variant:"caption",color:"text.secondary",display:"block",children:["Listening to: ",e.listenToTaskNames.join(", ")||"Not set"]}),(0,O.jsxs)(c.A,{variant:"caption",color:"text.secondary",children:["State: ",e.state.stateType]})]},e.id))})]}),l>=0&&(0,O.jsxs)(ce.Ay,{item:!0,xs:12,sm:8,children:[(0,O.jsxs)(c.A,{variant:"subtitle2",gutterBottom:!0,children:["Configure State for Listener: ",null===(t=s[l])||void 0===t?void 0:t.name]}),(0,O.jsxs)(c.A,{variant:"caption",color:"text.secondary",sx:{mb:2,display:"block"},children:["Listening to: ",(null===(n=s[l])||void 0===n?void 0:n.listenToTaskNames.join(", "))||"Not set"]}),(0,O.jsx)(_e.A,{variant:"outlined",sx:{p:2,height:"400px",overflow:"auto"},children:(0,O.jsx)(en,{initialData:null===(a=s[l])||void 0===a?void 0:a.state,onSubmit:r})})]})]})]})},nn=e=>{let{flowName:t,setFlowName:n,listeners:a,actions:s,startingPoints:i}=e;return(0,O.jsxs)(o.A,{sx:{pt:2,pb:2},children:[(0,O.jsx)(c.A,{variant:"h6",gutterBottom:!0,children:"Review Your Flow Configuration"}),(0,O.jsx)(V.A,{fullWidth:!0,label:"Flow Name",value:t,onChange:e=>n(e.target.value),required:!0,error:!t.trim(),helperText:t.trim()?"":"Flow name is required",sx:{mb:3}}),(0,O.jsxs)(_e.A,{variant:"outlined",sx:{p:2,mb:3},children:[(0,O.jsx)(c.A,{variant:"subtitle1",gutterBottom:!0,children:"Starting Point Tasks"}),0===i.filter(e=>e.isStartPoint).length?(0,O.jsx)(c.A,{variant:"body2",color:"error",children:"No starting point tasks defined. Please go back and select at least one task."}):(0,O.jsxs)(o.A,{children:[(0,O.jsx)(c.A,{variant:"caption",color:"text.secondary",sx:{mb:1,display:"block"},children:"The following tasks will trigger the flow execution:"}),i.filter(e=>e.isStartPoint).map(e=>(0,O.jsx)(o.A,{sx:{mb:1},children:(0,O.jsxs)(c.A,{variant:"body2",children:[e.crewName,":",e.taskName]})},e.taskId))]})]}),(0,O.jsxs)(_e.A,{variant:"outlined",sx:{p:2,mb:3},children:[(0,O.jsx)(c.A,{variant:"subtitle1",gutterBottom:!0,children:"Listeners"}),a.map(e=>(0,O.jsxs)(o.A,{sx:{mb:2},children:[(0,O.jsx)(c.A,{variant:"body2",fontWeight:"bold",children:e.name}),(0,O.jsxs)(c.A,{variant:"body2",children:["Listening to: ",e.listenToTaskNames.length>0?e.listenToTaskNames.join(", "):"Not set"]}),(0,O.jsxs)(c.A,{variant:"body2",children:["State Type: ",e.state.stateType]}),(0,O.jsxs)(c.A,{variant:"body2",children:["Tasks to Execute: ",e.tasks.map(e=>e.name).join(", ")]}),(0,O.jsx)(te.A,{sx:{my:1}})]},e.id))]}),s.length>0&&(0,O.jsxs)(_e.A,{variant:"outlined",sx:{p:2,mb:3},children:[(0,O.jsx)(c.A,{variant:"subtitle1",gutterBottom:!0,children:"Actions"}),(0,O.jsx)(o.A,{sx:{display:"flex",flexWrap:"wrap",gap:1},children:s.map(e=>(0,O.jsx)(R.A,{label:"".concat(e.crewName,":").concat(e.taskName),variant:"outlined"},e.id))})]})]})},an=e=>{let{open:t,onClose:n,onAddCrews:a}=e;const{activeStep:s,crews:u,selectedCrewIds:h,listeners:m,tasks:p,actions:g,startingPoints:f,loadCrews:v,toggleCrewSelection:A,handleNext:y,handleBack:b,handleListenerTaskChange:j,handleListenToTaskChange:w,handleStateUpdate:k,handleToggleStartingPoint:C,addListener:S,deleteListener:_,updateListenerName:E,updateListenerConditionType:I,updateRouterConfig:T,resetFlowWizard:D}=Bt(),[N,P]=(0,i.useState)("");(0,i.useEffect)(()=>{t&&v()},[t,v]);const M=(0,i.useCallback)(()=>{D(),P(""),n()},[D,n]),z=(0,i.useCallback)(e=>{A(e.id)},[A]),L=(0,i.useCallback)(()=>{const e={id:"flow-".concat(Date.now()),name:N,listeners:m,actions:g,startingPoints:f.filter(e=>e.isStartPoint)},t=u.filter(e=>h.includes(e.id)),n={};t.forEach((e,t)=>{const a=t%3,s=Math.floor(t/3);n[e.id.toString()]={x:150+300*a,y:150+200*s}}),a(t,n,e,!0),M()},[N,m,g,f,a,M,u,h]);return(0,O.jsxs)(r.A,{open:t,onClose:M,maxWidth:"md",fullWidth:!0,children:[(0,O.jsx)(d.A,{children:"Add Flow"}),(0,O.jsx)(l.A,{children:(0,O.jsxs)(o.A,{sx:{mt:2},children:[(0,O.jsxs)(c.A,{variant:"subtitle1",gutterBottom:!0,children:["Step ",s+1," of ",Object.keys(Rt).length/2]}),(()=>{switch(s){case Rt.SelectCrews:return(0,O.jsx)(Ut,{crews:u,selectedCrewIds:h,onCrewSelect:z});case Rt.DefineStartingPoints:return(0,O.jsx)(Kt,{tasks:p,startingPoints:f,onToggleStartingPoint:C});case Rt.ConfigureListeners:return(0,O.jsx)($t,{tasks:p,listeners:m,selectedCrewIds:h,crews:u,onListenerTaskChange:j,onListenToTaskChange:w,onAddListener:S,onDeleteListener:_,onUpdateListenerName:E,onUpdateConditionType:I,onUpdateRouterConfig:T});case Rt.ConfigureState:return(0,O.jsx)(tn,{listeners:m,onStateUpdate:k});case Rt.Review:return(0,O.jsx)(nn,{flowName:N,setFlowName:P,listeners:m,actions:g,startingPoints:f});default:return null}})()]})}),(0,O.jsxs)(B.A,{children:[(0,O.jsx)(x.A,{onClick:M,children:"Cancel"}),(0,O.jsx)(x.A,{onClick:b,disabled:0===s,children:"Back"}),s===Rt.Review?(0,O.jsx)(x.A,{onClick:L,variant:"contained",color:"primary",children:"Save"}):(0,O.jsx)(x.A,{onClick:y,variant:"contained",color:"primary",children:"Next"})]})]})},sn=e=>{let{data:t,selected:n,id:s,isConnectable:r}=e;const{crewName:l}=t,[d,h]=(0,i.useState)(!1),{deleteElements:m}=(0,A.VH)(),p=(e=>{const t=["#4caf50","#2196f3","#ff9800","#e91e63","#9c27b0","#00bcd4","#ff5722","#607d8b"];let n=0;for(let a=0;a<e.length;a++)n=e.charCodeAt(a)+((n<<5)-n);return t[Math.abs(n)%t.length]})(l),x={width:8,height:8,background:"#555",border:"2px solid #fff",cursor:"crosshair"};return(0,O.jsxs)(O.Fragment,{children:[(0,O.jsx)(A.h7,{type:"source",position:A.yX.Top,id:"top",isConnectable:r,style:(0,a.A)((0,a.A)({},x),{},{top:-4})}),(0,O.jsx)(A.h7,{type:"target",position:A.yX.Top,id:"top-target",isConnectable:r,style:(0,a.A)((0,a.A)({},x),{},{top:-4})}),(0,O.jsx)(A.h7,{type:"source",position:A.yX.Right,id:"right",isConnectable:r,style:(0,a.A)((0,a.A)({},x),{},{right:-4})}),(0,O.jsx)(A.h7,{type:"target",position:A.yX.Right,id:"right-target",isConnectable:r,style:(0,a.A)((0,a.A)({},x),{},{right:-4})}),(0,O.jsx)(A.h7,{type:"source",position:A.yX.Bottom,id:"bottom",isConnectable:r,style:(0,a.A)((0,a.A)({},x),{},{bottom:-4})}),(0,O.jsx)(A.h7,{type:"target",position:A.yX.Bottom,id:"bottom-target",isConnectable:r,style:(0,a.A)((0,a.A)({},x),{},{bottom:-4})}),(0,O.jsx)(A.h7,{type:"source",position:A.yX.Left,id:"left",isConnectable:r,style:(0,a.A)((0,a.A)({},x),{},{left:-4})}),(0,O.jsx)(A.h7,{type:"target",position:A.yX.Left,id:"left-target",isConnectable:r,style:(0,a.A)((0,a.A)({},x),{},{left:-4})}),(0,O.jsxs)(o.A,{sx:{width:140,height:80,display:"flex",justifyContent:"center",alignItems:"center",borderRadius:"8px",border:n?"2px solid #1976d2":"1px solid #e0e0e0",bgcolor:p,color:"white",boxShadow:n?3:1,position:"relative",transition:"all 0.2s ease",overflow:"visible",fontWeight:"bold",cursor:"pointer","&:hover":{boxShadow:4}},onMouseEnter:()=>h(!0),onMouseLeave:()=>h(!1),children:[(0,O.jsx)(c.A,{variant:"subtitle1",textAlign:"center",fontWeight:"bold",sx:{color:"white",textShadow:"1px 1px 2px rgba(0,0,0,0.4)",wordBreak:"break-word",padding:"0 5px"},children:t.label||"Unnamed Crew"}),(d||n)&&(0,O.jsx)(o.A,{sx:{position:"absolute",top:-6,right:-6,display:"flex",gap:.5},children:(0,O.jsx)(u.A,{size:"small",onClick:e=>{e.stopPropagation(),m({nodes:[{id:s}]})},sx:{backgroundColor:"rgba(255, 255, 255, 0.9)","&:hover":{backgroundColor:"#ffebee"},boxShadow:"0 0 4px rgba(0,0,0,0.2)",width:24,height:24},children:(0,O.jsx)(q.A,{fontSize:"small",color:"error"})})})]})]})},on=e=>{let{sourceX:t,sourceY:n,targetX:s,targetY:i,sourcePosition:r,targetPosition:l,style:d={},markerEnd:c,data:u}=e;const[h,m,p]=(0,A.oN)({sourceX:t,sourceY:n,sourcePosition:r,targetX:s,targetY:i,targetPosition:l,borderRadius:16});return(0,O.jsxs)("g",{children:[(0,O.jsx)(A.tE,{path:h,markerEnd:c,style:(0,a.A)((0,a.A)({},d),{},{strokeWidth:2,stroke:"#2196f3",filter:"drop-shadow(0 1px 2px rgba(33, 150, 243, 0.3))",zIndex:0})}),(null===u||void 0===u?void 0:u.label)&&(0,O.jsx)("foreignObject",{width:250,height:60,x:m-125,y:p-30,requiredExtensions:"http://www.w3.org/1999/xhtml",children:(0,O.jsx)(o.A,{sx:{display:"flex",justifyContent:"center",alignItems:"center",width:"100%",height:"100%",fontSize:"12px",padding:"6px 12px",borderRadius:"8px",backgroundColor:"rgba(255, 255, 255, 0.95)",border:"1px solid rgba(33, 150, 243, 0.3)",boxShadow:"0 2px 4px rgba(0,0,0,0.1)",textAlign:"center",position:"relative",zIndex:5,fontWeight:"bold",wordBreak:"break-word",overflow:"hidden",color:"#1976d2",transition:"all 0.2s ease","&:hover":{backgroundColor:"rgba(255, 255, 255, 1)",boxShadow:"0 4px 8px rgba(0,0,0,0.15)",transform:"translateY(-1px)"}},children:u.label})})]})};var rn;const ln=(0,Lt.i7)(rn||(rn=(0,Ot.A)(["\n  from {\n    stroke-dashoffset: 24;\n  }\n  to {\n    stroke-dashoffset: 0;\n  }\n"]))),dn=e=>{let{sourceX:t,sourceY:n,targetX:s,targetY:o,sourcePosition:d,targetPosition:c,style:u={},markerEnd:h,source:m,target:p,id:x,data:g,animated:f=!1}=e;const[v,y]=(0,i.useState)(!1),[b,j]=(0,i.useState)(!1),[w,k,C]=(0,A.oN)({sourceX:t,sourceY:n,sourcePosition:d,targetX:s,targetY:o,targetPosition:c,borderRadius:16,offset:12}),S=(null===m||void 0===m?void 0:m.includes("flow"))&&(null===p||void 0===p?void 0:p.includes("flow"));let _;if(S)_=null!==g&&void 0!==g&&g.stateType?"".concat(g.stateType," state"):"state";else{_=(null===m||void 0===m?void 0:m.includes("task"))&&(null===p||void 0===p?void 0:p.includes("task"))?"dependency":"assigned"}const E=k+50,I=C,T=k+75,D=C,N=Math.min(t,s)-8,P=Math.max(t,s)+8,M=Math.min(n,o)-10,z=P-N,L=Math.max(n,o)+10-M,F=(0,a.A)((0,a.A)({},u),{},{zIndex:0,strokeWidth:2,stroke:S?"#9c27b0":"#2196f3",strokeDasharray:S?"5":"12",animation:f?"".concat(ln," 0.5s linear infinite"):"none",filter:"drop-shadow(0 1px 2px rgba(33, 150, 243, 0.3))",pointerEvents:"none"}),W=(0,i.useCallback)(()=>{v||y(!0)},[v]),R=(0,i.useCallback)(e=>{const t=e.target.getBoundingClientRect(),n=e.clientX,a=e.clientY;(n<t.left||n>t.right||a<t.top||a>t.bottom)&&y(!1)},[]),V=(0,i.useCallback)(e=>{e.stopPropagation();const t=new CustomEvent("edge:delete",{detail:{id:x}});window.dispatchEvent(t)},[x]),B=(0,i.useCallback)(e=>{e.stopPropagation(),j(!0)},[]),U=(0,i.useCallback)(e=>{const t=new CustomEvent("edge:update",{detail:{id:x,data:e}});window.dispatchEvent(t),j(!1)},[x]);return(0,O.jsxs)(O.Fragment,{children:[(0,O.jsxs)("g",{children:[(0,O.jsx)("rect",{x:N,y:M,width:z,height:L,fill:"transparent",onMouseEnter:W,onMouseLeave:R,style:{pointerEvents:"all"}}),(0,O.jsx)(A.tE,{path:w,markerEnd:h,style:F}),v&&(0,O.jsxs)("g",{style:{pointerEvents:"none"},children:[(0,O.jsx)(A.R5,{x:k,y:C,label:_,labelStyle:{fill:S?"#9c27b0":"#2196f3",fontSize:"12px",fontWeight:600},labelBgStyle:{fill:"white",fillOpacity:.8},labelBgPadding:[2,4],labelBgBorderRadius:4}),(0,O.jsxs)("g",{transform:"translate(".concat(E,", ").concat(I,")"),onClick:V,style:{cursor:"pointer",pointerEvents:"all"},children:[(0,O.jsx)("rect",{x:"-8",y:"-8",width:"16",height:"16",fill:"white",fillOpacity:"0.9",rx:"2",pointerEvents:"all"}),(0,O.jsx)("line",{x1:"-4",y1:"-4",x2:"4",y2:"4",stroke:"#666",strokeWidth:"1.5",opacity:"0.8",pointerEvents:"none"}),(0,O.jsx)("line",{x1:"4",y1:"-4",x2:"-4",y2:"4",stroke:"#666",strokeWidth:"1.5",opacity:"0.8",pointerEvents:"none"})]}),S&&(0,O.jsxs)("g",{transform:"translate(".concat(T,", ").concat(D,")"),onClick:B,style:{cursor:"pointer",pointerEvents:"all"},children:[(0,O.jsx)("rect",{x:"-8",y:"-8",width:"16",height:"16",fill:"white",fillOpacity:"0.9",rx:"2",pointerEvents:"all"}),(0,O.jsx)("circle",{cx:"0",cy:"0",r:"4",fill:"none",stroke:"#666",strokeWidth:"1.5",opacity:"0.8",pointerEvents:"none"}),(0,O.jsx)("line",{x1:"0",y1:"-3",x2:"0",y2:"-6",stroke:"#666",strokeWidth:"1.5",opacity:"0.8",pointerEvents:"none"}),(0,O.jsx)("line",{x1:"0",y1:"3",x2:"0",y2:"6",stroke:"#666",strokeWidth:"1.5",opacity:"0.8",pointerEvents:"none"}),(0,O.jsx)("line",{x1:"-3",y1:"0",x2:"-6",y2:"0",stroke:"#666",strokeWidth:"1.5",opacity:"0.8",pointerEvents:"none"}),(0,O.jsx)("line",{x1:"3",y1:"0",x2:"6",y2:"0",stroke:"#666",strokeWidth:"1.5",opacity:"0.8",pointerEvents:"none"})]})]})]}),S&&(0,O.jsx)(r.A,{open:b,onClose:()=>j(!1),maxWidth:"md",children:(0,O.jsx)(l.A,{children:(0,O.jsx)(en,{initialData:g,onCancel:()=>j(!1),onSubmit:U})})})]})},cn={agentNode:At,taskNode:zt,crewNode:sn},un={default:dn,crewEdge:on};var hn=n(91570);const mn=e=>({id:e.id,title:e.title,description:e.description,icon:e.icon,category:e.category,enabled:e.enabled}),pn={jobId:null,isRunning:!1,selectedModel:"",planningEnabled:!1,schemaDetectionEnabled:!0,tools:[],selectedTools:[]},xn=(0,j.vt)(e=>(0,a.A)((0,a.A)({},pn),{},{setJobId:t=>e(()=>({jobId:t})),setIsRunning:t=>e(()=>({isRunning:t})),setSelectedModel:t=>e(()=>({selectedModel:t})),setPlanningEnabled:t=>e(()=>({planningEnabled:t})),setSchemaDetectionEnabled:t=>e(()=>({schemaDetectionEnabled:t})),setTools:t=>e(()=>({tools:t.map(mn)})),setSelectedTools:t=>e(()=>({selectedTools:t})),resetJobManagement:()=>e(()=>(0,a.A)({},pn))})),gn={showError:!1,errorMessage:""},fn=(0,j.vt)(e=>(0,a.A)((0,a.A)({},gn),{},{setShowError:t=>e(()=>({showError:t})),setErrorMessage:t=>e(()=>({errorMessage:t})),showErrorMessage:t=>e(()=>({errorMessage:t,showError:!0})),clearError:()=>e(()=>({showError:!1,errorMessage:""})),resetError:()=>e(()=>(0,a.A)({},gn))})),vn=e=>{let{nodes:t,onNodesChange:n,reactFlowInstanceRef:s,setSuccessMessage:o,setShowSuccess:r}=e;const l=fn();return{handleTaskGenerated:(0,i.useCallback)(async e=>{if(e)try{var i,d;const l=await Re.createTask(e),c=Date.now(),u=l.id||c,h=t,m=h.filter(e=>"agentNode"===e.type),p=m.length>0?Math.max(...m.map(e=>e.position.x)):0,x=h.filter(e=>"taskNode"===e.type),g=((e,t)=>{const n=t.filter(e=>"taskNode"===e.type);if(n.length>0)return{x:n[0].position.x,y:Math.max(...n.map(e=>e.position.y))+80+100};return e})({x:Math.max(p+300,400),y:100},x),f={id:"task-".concat(u),type:"taskNode",position:g,width:280,height:140,data:{label:e.name,taskId:u,description:e.description||e.name,expected_output:e.expected_output||"",human_input:(null===(i=e.config)||void 0===i?void 0:i.human_input)||!1,tools:e.tools||[],config:{markdown:(null===(d=e.config)||void 0===d?void 0:d.markdown)||!1},task:(0,a.A)((0,a.A)({},e),{},{description:e.description||e.name})}};n([{type:"add",item:f}]),setTimeout(()=>{var e;null===(e=s.current)||void 0===e||e.fitView({duration:800,padding:.2})},100),o('Task "'.concat(e.name,'" generated successfully and added to canvas')),r(!0)}catch(c){l.showErrorMessage("Failed to create task")}},[t,n,s,o,r,l])}};var An=n(14857),yn=n(97497),bn=n(28810),jn=n(59086),wn=n(63364),kn=n(37921),Cn=n(13413),Sn=n(24350),_n=n(23240),En=n(5127),In=n(91311),Tn=n(33742),Dn=n(78960),Nn=n(22906),Pn=n(79741);const Mn={"databricks-llama-4-maverick":{name:"databricks-llama-4-maverick",temperature:.7,context_window:128e3,max_output_tokens:4096,enabled:!0}},zn=e=>{var t;let{onClearCanvas:n,onGenerateConnections:a,onZoomIn:s,onZoomOut:r,onFitView:l,onToggleInteractivity:d,isGeneratingConnections:h,planningEnabled:m,setPlanningEnabled:p,reasoningEnabled:x,setReasoningEnabled:f,schemaDetectionEnabled:v,setSchemaDetectionEnabled:A,processType:y="sequential",setProcessType:j,setIsConfigurationDialogOpen:w,onOpenLogsDialog:k,showRunHistory:C,executionHistoryHeight:S=200,onOpenTutorial:_}=e;const E=(0,An.A)(),[I,T]=(0,i.useState)(null),[D,N]=(0,i.useState)(Mn),[M,z]=(0,i.useState)(!0),[L,F]=(0,i.useState)(""),[W,R]=(0,i.useState)(""),[V,B]=(0,i.useState)(""),{setPlanningLLM:U,setReasoningLLM:H,setProcessType:K,setManagerLLM:G,processType:J,managerLLM:q}=(0,b.E)(),{shortcuts:Y}=(0,Nn._)(),{userRole:X}=(0,Pn.o)(),Z="operator"===X,{hasSeenTutorial:Q}=(0,g.Y)();(0,i.useEffect)(()=>{(async()=>{z(!0);try{const e=ve.J.getInstance(),t=await e.getEnabledModels();if(N(t),t&&Object.keys(t).length>0&&!L){const e=Object.keys(t)[0];F(e),U(e)}if(t&&Object.keys(t).length>0&&!W){const e=Object.keys(t)[0];R(e),H(e)}if(t&&Object.keys(t).length>0)if(q&&t[q])B(q);else if(!V){const e=Object.keys(t)[0];B(e),G(e)}}catch(e){}finally{z(!1)}})()},[L,U,W,H,V,G,q]);const $=(0,i.useCallback)(e=>{const t=e.target.value;F(t),U(t)},[U]),ee=(0,i.useCallback)(e=>{const t=e.target.value;R(t),H(t)},[H]),ne=(0,i.useCallback)(e=>{const t=e.target.value;B(t),G(t)},[G]),ae=(0,i.useCallback)(e=>{const t=e.target.value;K(t),j&&j(t)},[j,K]),se=(0,i.useMemo)(()=>{const e=new Set(["undo","redo","selectAll","copy","paste","toggleFullscreen","openAgentDialog","openTaskDialog","openCrewPlanningDialog"]),t={Canvas:[],Creation:[],Execution:[],Management:[]};return Y.forEach(n=>{const a=n.action;e.has(a)||(a.includes("zoom")||a.includes("fit")||a.includes("clear")||a.includes("delete")?t.Canvas.push(n):a.includes("open")||a.includes("generate")?t.Creation.push(n):a.includes("execute")?t.Execution.push(n):t.Management.push(n))}),t},[Y]),ie=[{id:"configuration",icon:(0,O.jsx)(jn.A,{}),tooltip:"Configuration",content:null,dataTour:"configuration-button"},{id:"help",icon:(0,O.jsx)(wn.A,{}),tooltip:"Start Tutorial / Help",content:null,dataTour:"help-button"},...Z?[]:[{id:"runtime-features",icon:(0,O.jsx)(kn.A,{}),tooltip:"Runtime Features",dataTour:"runtime-features",content:(0,O.jsxs)(o.A,{sx:{maxHeight:C?"calc(100vh - 48px - ".concat(S,"px - 20px)"):"calc(100vh - 48px - 20px)",overflowY:"auto",p:1},children:[(0,O.jsxs)(o.A,{sx:{mb:2},children:[(0,O.jsxs)(o.A,{sx:{display:"flex",alignItems:"center",mb:1},children:[(0,O.jsx)(c.A,{variant:"subtitle2",sx:{color:E.palette.primary.main,fontWeight:600,textTransform:"uppercase",letterSpacing:"0.5px",fontSize:"0.7rem"},children:"Process Type"}),(0,O.jsx)(P.A,{title:"Determines how agents collaborate. Sequential: agents work one after another in a fixed order. Hierarchical: a manager agent dynamically delegates tasks to specialized agents. Use Hierarchical for complex workflows requiring adaptive task distribution and parallel execution.",placement:"right",children:(0,O.jsx)(Cn.A,{sx:{ml:.5,fontSize:14,color:E.palette.primary.main,cursor:"help"}})})]}),(0,O.jsx)(te.A,{sx:{mb:1}}),(0,O.jsxs)(o.A,{sx:{display:"flex",flexDirection:"column",gap:1,py:.5,px:.5,borderRadius:1},children:[(0,O.jsxs)(oe.A,{size:"small",fullWidth:!0,children:[(0,O.jsx)(re.A,{sx:{fontSize:"0.75rem"},children:"Execution Process"}),(0,O.jsxs)(le.A,{value:J,onChange:ae,label:"Execution Process",sx:{fontSize:"0.75rem"},children:[(0,O.jsx)(de.A,{value:"sequential",sx:{fontSize:"0.75rem"},children:"Sequential - Linear task execution"}),(0,O.jsx)(de.A,{value:"hierarchical",sx:{fontSize:"0.75rem"},children:"Hierarchical - Manager-based delegation"})]})]}),"hierarchical"===(J||y)&&(0,O.jsxs)(oe.A,{size:"small",fullWidth:!0,sx:{mt:1},children:[(0,O.jsx)(re.A,{sx:{fontSize:"0.75rem"},children:"Manager LLM"}),(0,O.jsx)(le.A,{value:V,onChange:ne,label:"Manager LLM",disabled:M,sx:{fontSize:"0.75rem"},renderValue:e=>{const t=D[e];return t?t.name:e},children:M?(0,O.jsx)(de.A,{value:"",children:(0,O.jsx)(ue.A,{size:16})}):0===Object.keys(D).length?(0,O.jsx)(de.A,{value:"",children:"No models available"}):Object.entries(D).map(e=>{let[t,n]=e;return(0,O.jsx)(de.A,{value:t,sx:{fontSize:"0.75rem"},children:(0,O.jsx)("span",{children:n.name})},t)})})]}),"hierarchical"===(J||y)&&(0,O.jsx)(c.A,{variant:"caption",sx:{color:"text.secondary",fontSize:"0.65rem",mt:.5},children:"Manager coordinates task delegation to agents"})]})]}),(0,O.jsxs)(o.A,{sx:{mb:2},children:[(0,O.jsxs)(o.A,{sx:{display:"flex",alignItems:"center",mb:1},children:[(0,O.jsx)(c.A,{variant:"subtitle2",sx:{color:E.palette.primary.main,fontWeight:600,textTransform:"uppercase",letterSpacing:"0.5px",fontSize:"0.7rem"},children:"Planning"}),(0,O.jsx)(P.A,{title:"Crew-level strategic planning before task execution. ENABLE for: complex multi-step workflows, task dependencies requiring orchestration, projects needing autonomous task decomposition. DISABLE for: simple well-defined tasks, speed-critical operations, deterministic workflows with fixed sequences. Adds 5-10min overhead but improves task coordination.",placement:"right",children:(0,O.jsx)(Cn.A,{sx:{ml:.5,fontSize:14,color:E.palette.primary.main,cursor:"help"}})})]}),(0,O.jsx)(te.A,{sx:{mb:1}}),(0,O.jsxs)(o.A,{sx:{display:"flex",flexDirection:"column",gap:1,py:.5,px:.5,borderRadius:1},children:[(0,O.jsxs)(o.A,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[(0,O.jsx)(c.A,{variant:"caption",sx:{color:"text.primary",fontSize:"0.75rem"},children:"Crew Level Planning"}),(0,O.jsx)(me.A,{checked:m,onChange:e=>p(e.target.checked),size:"small"})]}),m&&(0,O.jsxs)(oe.A,{size:"small",fullWidth:!0,sx:{mt:1},children:[(0,O.jsx)(re.A,{sx:{fontSize:"0.75rem"},children:"Planning LLM"}),(0,O.jsx)(le.A,{value:L,onChange:$,label:"Planning LLM",disabled:M,sx:{fontSize:"0.75rem"},renderValue:e=>{const t=D[e];return t?t.name:e},children:M?(0,O.jsx)(de.A,{value:"",children:(0,O.jsx)(ue.A,{size:16})}):0===Object.keys(D).length?(0,O.jsx)(de.A,{value:"",children:"No models available"}):Object.entries(D).map(e=>{let[t,n]=e;return(0,O.jsx)(de.A,{value:t,sx:{fontSize:"0.75rem"},children:(0,O.jsx)("span",{children:n.name})},t)})})]})]})]}),(0,O.jsxs)(o.A,{sx:{mb:2},children:[(0,O.jsxs)(o.A,{sx:{display:"flex",alignItems:"center",mb:1},children:[(0,O.jsx)(c.A,{variant:"subtitle2",sx:{color:E.palette.primary.main,fontWeight:600,textTransform:"uppercase",letterSpacing:"0.5px",fontSize:"0.7rem"},children:"Reasoning"}),(0,O.jsx)(P.A,{title:"Agent-level reflection and planning before each task. ENABLE for: complex tasks needing breakdown, problems requiring methodical analysis, identifying challenges upfront, quality over speed. DISABLE for: simple straightforward tasks, time-critical operations, well-defined procedures, repetitive tasks. Each reasoning iteration adds overhead and potential error risk. Max attempts limits refinement cycles.",placement:"right",children:(0,O.jsx)(Cn.A,{sx:{ml:.5,fontSize:14,color:E.palette.primary.main,cursor:"help"}})})]}),(0,O.jsx)(te.A,{sx:{mb:1}}),(0,O.jsxs)(o.A,{sx:{display:"flex",flexDirection:"column",gap:1,py:.5,px:.5,borderRadius:1},children:[(0,O.jsxs)(o.A,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[(0,O.jsx)(c.A,{variant:"caption",sx:{color:"text.primary",fontSize:"0.75rem"},children:"Agent Level Reasoning"}),(0,O.jsx)(me.A,{checked:x,onChange:e=>f(e.target.checked),size:"small"})]}),x&&(0,O.jsxs)(oe.A,{size:"small",fullWidth:!0,sx:{mt:1},children:[(0,O.jsx)(re.A,{sx:{fontSize:"0.75rem"},children:"Reasoning LLM"}),(0,O.jsx)(le.A,{value:W,onChange:ee,label:"Reasoning LLM",disabled:M,sx:{fontSize:"0.75rem"},renderValue:e=>{const t=D[e];return t?t.name:e},children:M?(0,O.jsx)(de.A,{value:"",children:(0,O.jsx)(ue.A,{size:16})}):0===Object.keys(D).length?(0,O.jsx)(de.A,{value:"",children:"No models available"}):Object.entries(D).map(e=>{let[t,n]=e;return(0,O.jsx)(de.A,{value:t,sx:{fontSize:"0.75rem"},children:(0,O.jsx)("span",{children:n.name})},t)})})]})]})]}),(0,O.jsxs)(o.A,{sx:{mb:2},children:[(0,O.jsx)(c.A,{variant:"subtitle2",sx:{color:E.palette.primary.main,mb:1,fontWeight:600,textTransform:"uppercase",letterSpacing:"0.5px",fontSize:"0.7rem"},children:"Schema Detection"}),(0,O.jsx)(te.A,{sx:{mb:1}}),(0,O.jsx)(o.A,{sx:{display:"flex",flexDirection:"column",gap:1,py:.5,px:.5,borderRadius:1},children:(0,O.jsxs)(o.A,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[(0,O.jsx)(c.A,{variant:"caption",sx:{color:"text.primary",fontSize:"0.75rem"},children:"Auto Schema Detection"}),(0,O.jsx)(me.A,{checked:v,onChange:e=>A(e.target.checked),size:"small"})]})})]})]})}],{id:"shortcuts",icon:(0,O.jsx)(Sn.A,{}),tooltip:"Keyboard Shortcuts",content:(0,O.jsx)(o.A,{sx:{maxHeight:C?"calc(100vh - 48px - ".concat(S,"px - 20px)"):"calc(100vh - 48px - 20px)",overflowY:"auto",p:1},children:Object.entries(se).map(e=>{let[t,n]=e;return 0===n.length?null:(0,O.jsxs)(o.A,{sx:{mb:2},children:[(0,O.jsx)(c.A,{variant:"subtitle2",sx:{color:E.palette.primary.main,mb:1,fontWeight:600,textTransform:"uppercase",letterSpacing:"0.5px",fontSize:"0.7rem"},children:t}),(0,O.jsx)(te.A,{sx:{mb:1}}),n.map((e,t)=>(0,O.jsxs)(o.A,{sx:{display:"flex",flexDirection:"column",gap:.5,mb:1,py:.5,px:.5,borderRadius:1,"&:hover":{backgroundColor:"action.hover"}},children:[(0,O.jsx)(c.A,{variant:"caption",sx:{color:"text.primary",fontSize:"0.65rem",lineHeight:1.2},children:e.description}),(0,O.jsx)(o.A,{sx:{display:"flex",gap:.25,flexWrap:"wrap"},children:e.keys.map((e,t)=>(0,O.jsx)(c.A,{variant:"caption",component:"span",sx:{fontFamily:"monospace",backgroundColor:(0,yn.X4)(E.palette.primary.main,.1),color:E.palette.primary.main,px:.4,py:.2,borderRadius:.5,fontWeight:500,border:"1px solid ".concat((0,yn.X4)(E.palette.primary.main,.2)),fontSize:"0.6rem",minWidth:"1rem",textAlign:"center",display:"inline-block"},children:"Control"===e?"Ctrl":" "===e?"Space":e},"".concat(e,"-").concat(t)))})]},"".concat(e.action,"-").concat(t)))]},t)})})}];return(0,O.jsxs)(o.A,{"data-tour":"left-sidebar",sx:{position:"absolute",top:"48px",left:0,height:C?"calc(100% - 48px - ".concat(S,"px)"):"calc(100% - 48px)",zIndex:10,display:"flex",flexDirection:"row"},onMouseLeave:()=>T(null),children:[(0,O.jsx)(_e.A,{elevation:0,sx:{width:48,height:"100%",bgcolor:"background.paper",borderRadius:0,borderRight:"1px solid",borderColor:"divider",display:"flex",flexDirection:"column",alignItems:"center",py:1},children:ie.map(e=>(0,O.jsxs)(i.Fragment,{children:[(0,O.jsx)(P.A,{title:"help"!==e.id||Q?e.tooltip:"\u{1f3af} Click to start your personalized tutorial!",placement:"right",arrow:"help"===e.id&&!Q,children:(0,O.jsx)(bn.A,{badgeContent:"help"!==e.id||Q?null:"!",color:"primary",variant:"dot",invisible:"help"!==e.id||Q,sx:{"& .MuiBadge-dot":{animation:"pulse 2s infinite","@keyframes pulse":{"0%":{transform:"scale(1)"},"50%":{transform:"scale(1.2)"},"100%":{transform:"scale(1)"}}}},children:(0,O.jsx)(u.A,{"data-tour":e.dataTour,onMouseEnter:()=>{"configuration"!==e.id&&"help"!==e.id&&T(e.id)},onClick:()=>{var t;"configuration"!==(t=e.id)?"help"!==t?T(I===t?null:t):_&&_():w&&w(!0)},sx:{width:40,height:40,mb:1,color:"help"===e.id?Q?E.palette.info.main:E.palette.primary.main:"text.secondary",animation:"help"!==e.id||Q?"none":"pulse 2s infinite","@keyframes pulse":{"0%":{boxShadow:"0 0 0 0 rgba(25, 118, 210, 0.4)"},"70%":{boxShadow:"0 0 0 8px rgba(25, 118, 210, 0)"},"100%":{boxShadow:"0 0 0 0 rgba(25, 118, 210, 0)"}},backgroundColor:I===e.id?"action.selected":"transparent",borderLeft:I===e.id?"2px solid ".concat(E.palette.primary.main):"2px solid transparent",borderRadius:0,transition:"all 0.2s ease-in-out","&:hover":{backgroundColor:"action.hover",color:"help"===e.id?E.palette.info.dark:"text.primary",transform:"help"===e.id?"scale(1.1)":"none"}},children:e.icon})})}),"help"===e.id&&(0,O.jsx)(o.A,{sx:{width:"80%",height:"1px",backgroundColor:"divider",mb:1,alignSelf:"center"}}),"runtime-features"===e.id&&(0,O.jsxs)(O.Fragment,{children:[(0,O.jsx)(o.A,{sx:{width:"80%",height:"1px",backgroundColor:"divider",mb:1,alignSelf:"center"}}),(0,O.jsx)(P.A,{title:"Clear Canvas",placement:"right",children:(0,O.jsx)(u.A,{onClick:n,sx:{width:40,height:40,mb:1,color:"text.secondary",borderRadius:0,transition:"all 0.2s ease-in-out","&:hover":{backgroundColor:"action.hover",color:"text.primary"}},children:(0,O.jsx)(_n.A,{fontSize:"small"})})}),(0,O.jsx)(P.A,{title:"Fit View",placement:"right",children:(0,O.jsx)(u.A,{onClick:l,sx:{width:40,height:40,mb:1,color:"text.secondary",borderRadius:0,transition:"all 0.2s ease-in-out","&:hover":{backgroundColor:"action.hover",color:"text.primary"}},children:(0,O.jsx)(En.A,{fontSize:"small"})})}),(0,O.jsx)(P.A,{title:"Zoom In",placement:"right",children:(0,O.jsx)(u.A,{onClick:s,sx:{width:40,height:40,mb:1,color:"text.secondary",borderRadius:0,transition:"all 0.2s ease-in-out","&:hover":{backgroundColor:"action.hover",color:"text.primary"}},children:(0,O.jsx)(In.A,{fontSize:"small"})})}),(0,O.jsx)(P.A,{title:"Zoom Out",placement:"right",children:(0,O.jsx)(u.A,{onClick:r,sx:{width:40,height:40,mb:1,color:"text.secondary",borderRadius:0,transition:"all 0.2s ease-in-out","&:hover":{backgroundColor:"action.hover",color:"text.primary"}},children:(0,O.jsx)(Tn.A,{fontSize:"small"})})}),(0,O.jsx)(P.A,{title:"Generate Connections",placement:"right",children:(0,O.jsx)(u.A,{onClick:a,disabled:h,sx:{width:40,height:40,mb:1,color:"text.secondary",borderRadius:0,transition:"all 0.2s ease-in-out","&:hover":{backgroundColor:"action.hover",color:"text.primary"}},children:(0,O.jsx)(Dn.A,{fontSize:"small"})})})]})]},e.id))}),I&&(0,O.jsx)(_e.A,{elevation:0,sx:{width:280,height:"100%",bgcolor:"background.paper",borderRadius:0,borderRight:"1px solid",borderColor:"divider",overflow:"hidden",transition:"all 0.2s ease-in-out"},children:null===(t=ie.find(e=>e.id===I))||void 0===t?void 0:t.content})]})};var On=n(80097),Ln=n(20227),Fn=n(12717),Wn=n(72934),Rn=n(39837),Vn=n(38517),Bn=n(33463),Un=n(92974);const Hn=e=>{let{onOpenLogsDialog:t,onToggleChat:n,isChatOpen:a,setIsAgentDialogOpen:s,setIsTaskDialogOpen:r,setIsFlowDialogOpen:l,setIsCrewDialogOpen:d,onSaveCrewClick:c,showRunHistory:h=!1,executionHistoryHeight:m=200,onOpenSchedulesDialog:p,onToggleExecutionHistory:x}=e;const[g,f]=(0,i.useState)(!0),[v,A]=(0,i.useState)(!1),{crewAIFlowEnabled:y}=(0,S.d)(),{userRole:b}=(0,Pn.o)(),j="operator"===b;(0,i.useEffect)(()=>{if(g){const e=setTimeout(()=>f(!1),1500);return()=>clearTimeout(e)}},[g]),(0,i.useEffect)(()=>{a||v||n()},[a,v,n]),(0,i.useEffect)(()=>{a||A(!1)},[a]);const w=[...j?[]:[{id:"add-agent",icon:(0,O.jsx)(Ln.A,{}),tooltip:"Add Agent",onClick:()=>s(!0),disabled:!1},{id:"add-task",icon:(0,O.jsx)(Fn.A,{}),tooltip:"Add Task",onClick:()=>r(!0),disabled:!1},{id:"separator2",isSeparator:!0},{id:"save-crew",icon:(0,O.jsx)(Wn.A,{}),tooltip:"Save Crew",onClick:c,disabled:!1}],{id:"open-catalog",icon:(0,O.jsx)(Rn.A,{}),tooltip:"Open Catalog",onClick:()=>null===d||void 0===d?void 0:d(!0),disabled:!1},...y?[{id:"separator3",isSeparator:!0},{id:"add-flow",icon:(0,O.jsx)(Dn.A,{}),tooltip:"Add Flow",onClick:()=>l(!0),disabled:!1}]:[],{id:"separator4",isSeparator:!0},{id:"view-logs",icon:(0,O.jsx)(Vn.A,{}),tooltip:"View Assistant Logs",onClick:t,disabled:!1},{id:"toggle-execution-history",icon:(0,O.jsx)(Bn.A,{}),tooltip:h?"Hide Execution History":"Show Execution History",onClick:x,disabled:!x,isActive:h},{id:"schedules",icon:(0,O.jsx)(Un.A,{}),tooltip:"Schedules",onClick:p,disabled:!p}];return(0,O.jsxs)(O.Fragment,{children:[(0,O.jsx)(On.A,{styles:"\n        @keyframes ai-bounce {\n          0% { transform: scale(1) translateY(0); }\n          20% { transform: scale(1.2) translateY(-8px); }\n          40% { transform: scale(0.95) translateY(0); }\n          60% { transform: scale(1.1) translateY(-4px); }\n          80% { transform: scale(0.98) translateY(0); }\n          100% { transform: scale(1) translateY(0); }\n        }\n      "}),(0,O.jsx)(o.A,{sx:{position:"absolute",top:"48px",right:0,height:h?"calc(100% - 48px - ".concat(m,"px)"):"calc(100% - 48px)",zIndex:5,display:"flex",flexDirection:"row"},children:(0,O.jsx)(_e.A,{"data-tour":"right-sidebar",elevation:0,sx:{position:"fixed",top:48,right:0,width:48,height:h?"calc(100% - 48px - ".concat(m,"px)"):"calc(100% - 48px)",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"flex-start",py:1,borderLeft:1,borderColor:"divider",backgroundColor:"background.paper",zIndex:5,borderRadius:0},children:w.map(e=>(0,O.jsx)(i.Fragment,{children:e.isSeparator?(0,O.jsx)(te.A,{sx:{width:"80%",my:.5}}):(0,O.jsx)(P.A,{title:e.tooltip,placement:"left",children:(0,O.jsx)(u.A,{onClick:()=>{e.onClick&&!e.disabled&&e.onClick()},disabled:e.disabled,sx:{width:40,height:40,mb:1,color:e.isActive?"primary.main":"text.secondary",backgroundColor:e.isActive?"primary.light":"transparent",borderRight:"2px solid transparent",borderRadius:"50%",display:"flex",alignItems:"center",justifyContent:"center",transition:"all 0.2s cubic-bezier(.4,2,.6,1)",opacity:e.disabled?.6:1,cursor:e.disabled?"not-allowed":"pointer","&:hover":e.disabled?{}:{backgroundColor:e.isActive?"primary.dark":"action.hover",color:e.isActive?"primary.contrastText":"text.primary"},animation:"none"},children:e.icon})})},e.id))})})]})},Kn={openai:"OPENAI_API_KEY","open-ai":"OPENAI_API_KEY","open ai":"OPENAI_API_KEY",anthropic:"ANTHROPIC_API_KEY",qwen:"QWEN_API_KEY",deepseek:"DEEPSEEK_API_KEY",grok:"GROK_API_KEY",databricks:"DATABRICKS_API_KEY",gemini:"GEMINI_API_KEY"};async function Gn(e){const t=e.toLowerCase();if("ollama"===t)return!0;if("databricks"===t)try{const e=ke.O.getInstance(),t=await e.getDatabricksConfig();if(t&&t.enabled)return!0}catch(n){}return!1}async function Jn(e,t){const n=e.toLowerCase();if(await Gn(n))return!0;const a=Kn[n]||"";if(!a)return!1;return t.some(e=>{const t=e.name.toUpperCase()===a.toUpperCase(),n=e.value&&""!==e.value.trim();return t&&n})}const qn=e=>{let{open:t,onClose:n,onAgentGenerated:s,selectedModel:u,tools:h=[],selectedTools:p=[],onToolsChange:g=()=>{}}=e;const[f,v]=(0,i.useState)(""),[A,y]=(0,i.useState)(!1),[b,j]=(0,i.useState)(null),[w,k]=(0,i.useState)("databricks-llama-4-maverick"),[C,S]=(0,i.useState)({}),[_,E]=(0,i.useState)(!1),[I,T]=(0,i.useState)([]),[D,N]=(0,i.useState)(!1),[P,M]=(0,i.useState)(""),{secrets:z,fetchAPIKeys:L}=Be();(0,i.useEffect)(()=>{h.length>0&&T(h)},[h]),(0,i.useEffect)(()=>{const e=e=>{if(e.detail&&Array.isArray(e.detail.tools)){const t=e.detail.tools.filter(e=>!1!==e.enabled);JSON.stringify(t)!==JSON.stringify(I)&&T(t)}};return window.addEventListener("toolStateChanged",e),()=>{window.removeEventListener("toolStateChanged",e)}},[I]),(0,i.useEffect)(()=>{if(t){v(""),j(null);(async()=>{E(!0);try{const e=ve.J.getInstance(),t=await e.getActiveModels();if(S(t),!u&&Object.keys(t).length>0){const e=Object.keys(t)[0];k(e)}else k(u||"databricks-llama-4-maverick")}catch(b){const t=ve.J.getInstance().getActiveModelsSync();if(S(t),!u&&Object.keys(t).length>0){const e=Object.keys(t)[0];k(e)}else k(u||"databricks-llama-4-maverick")}finally{E(!1)}})();const e=async()=>{try{const e=gt.m,t=await e.listTools(),n=t.map(e=>(0,a.A)((0,a.A)({},e),{},{id:e.id.toString(),enabled:void 0===e.enabled||e.enabled})).filter(e=>!1!==e.enabled);T(n)}catch(b){}};0===I.length&&e()}},[t,u,I.length]);const F=async()=>{if(f.trim()){y(!0),j(null),N(!1),M("");try{await L();const t=Be.getState().secrets;if(w){var e;const n=C[w],a=(null===n||void 0===n||null===(e=n.provider)||void 0===e?void 0:e.toLowerCase())||"openai";if(!await Gn(a)){if(!await Jn(a,t))return N(!0),M(a),j("".concat(a.toUpperCase()," API key is required. Please configure it in the API Keys section.")),void y(!1)}}const a=await be.generateAgent(f,w,p);a?(s(a),n()):j("Failed to generate agent")}catch(t){if(t&&"object"===typeof t&&"response"in t&&t.response&&"object"===typeof t.response&&"data"in t.response){const e=t.response.data;if(e&&"object"===typeof e&&"detail"in e&&"string"===typeof e.detail){const t=e.detail.match(/No API key found for provider: (\w+)/i);if(t&&t[1]){const e=t[1].toLowerCase();N(!0),M(e),j("".concat(e.toUpperCase()," API key is required. Please configure it in the API Keys section."))}else j(e.detail)}else j(t instanceof Error?t.message:"Failed to generate agent")}else j(t instanceof Error?t.message:"Failed to generate agent")}finally{y(!1)}}else j("Please enter a prompt")};return(0,O.jsxs)(r.A,{open:t,onClose:n,maxWidth:"md",fullWidth:!0,children:[(0,O.jsx)(d.A,{children:"Generate Agent with AI"}),(0,O.jsx)(l.A,{children:(0,O.jsxs)(o.A,{sx:{mt:2,display:"flex",flexDirection:"column",gap:2},children:[b&&(0,O.jsx)(m.A,{severity:"error",sx:{mb:2},action:D&&(0,O.jsx)(x.A,{color:"inherit",size:"small",onClick:()=>{Be.getState().openApiKeyEditor(P);const e=new CustomEvent("openConfigAPIKeys");window.dispatchEvent(e),n()},children:"Configure API Keys"}),children:b}),(0,O.jsxs)(oe.A,{fullWidth:!0,children:[(0,O.jsx)(re.A,{children:"Model"}),(0,O.jsx)(le.A,{value:w,onChange:e=>{k(e.target.value)},label:"Model",disabled:A||_,children:_?(0,O.jsx)(de.A,{disabled:!0,children:"Loading models..."}):Object.entries(C).filter(e=>{let[t,n]=e;return!1!==n.enabled}).map(e=>{let[t,n]=e;return(0,O.jsxs)(de.A,{value:t,sx:{display:"flex",justifyContent:"space-between",gap:1},children:[(0,O.jsx)("span",{children:t}),(0,O.jsx)("span",{style:{fontSize:"0.8em"},children:n.provider?"(".concat(n.provider,")"):""})]},t)})})]}),(0,O.jsx)(V.A,{fullWidth:!0,label:"Describe the agent you want to create",multiline:!0,rows:4,value:f,onChange:e=>v(e.target.value),onKeyPress:e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),F())},placeholder:"Example: Create a research assistant agent specialized in analyzing scientific papers and summarizing key findings",disabled:A,autoFocus:!0}),I.length>0&&(0,O.jsxs)(o.A,{sx:{mt:2},children:[(0,O.jsx)(c.A,{variant:"subtitle1",gutterBottom:!0,children:"Available Tools"}),(0,O.jsx)(o.A,{sx:{display:"flex",flexWrap:"wrap",gap:1},children:I.filter(e=>!1!==e.enabled).map(e=>{const t=(e=>"string"===typeof e.id?e.id:"number"===typeof e.id?e.id.toString():"")(e);return(0,O.jsx)(R.A,{label:e.title||"Unnamed Tool",onClick:()=>(e=>{p.includes(e)?g(p.filter(t=>t!==e)):g([...p,e])})(t),color:p.includes(t)?"primary":"default",sx:{m:.5}},t)})}),0===I.filter(e=>!1!==e.enabled).length&&(0,O.jsx)(c.A,{color:"text.secondary",sx:{mt:1},children:"No enabled tools available. Please enable tools in the Tools section."})]})]})}),(0,O.jsxs)(B.A,{children:[(0,O.jsx)(x.A,{onClick:n,disabled:A,children:"Cancel"}),(0,O.jsx)(x.A,{onClick:F,variant:"contained",disabled:A||!f.trim()||_,startIcon:A?(0,O.jsx)(ue.A,{size:20}):null,children:A?"Generating...":"Generate"})]})]})},Yn=e=>{let{open:t,onClose:n,onTaskGenerated:s,selectedModel:c}=e;const[u,h]=(0,i.useState)(""),[p,g]=(0,i.useState)(!1),[f,v]=(0,i.useState)(null),[A,y]=(0,i.useState)("databricks-llama-4-maverick"),[b,j]=(0,i.useState)({}),[w,k]=(0,i.useState)(!1),[C,S]=(0,i.useState)(!1),[_,E]=(0,i.useState)(""),{secrets:I,fetchAPIKeys:T}=Be();(0,i.useEffect)(()=>{if(t){h(""),v(null),S(!1),E("");(async()=>{k(!0);try{const e=ve.J.getInstance(),t=await e.getActiveModels();if(j(t),!c&&Object.keys(t).length>0){const e=Object.keys(t)[0];y(e)}else y(c||"databricks-llama-4-maverick")}catch(f){const t=ve.J.getInstance().getActiveModelsSync();if(j(t),!c&&Object.keys(t).length>0){const e=Object.keys(t)[0];y(e)}else y(c||"databricks-llama-4-maverick")}finally{k(!1)}})()}},[t,c]);const D=async()=>{if(u.trim()){g(!0),v(null),S(!1),E("");try{await T();const t=Be.getState().secrets;if(A){var e;const n=b[A],a=(null===n||void 0===n||null===(e=n.provider)||void 0===e?void 0:e.toLowerCase())||"openai";if(!await Gn(a)){if(!await Jn(a,t))return S(!0),E(a),v("".concat(a.toUpperCase()," API key is required. Please configure it in the API Keys section.")),void g(!1)}}const i=await be.generateTask(u,A);if(i){const e=(0,a.A)((0,a.A)({},i),{},{id:"",agent_id:null,async_execution:!1,context:[],config:{cache_response:!1,cache_ttl:3600,retry_on_fail:!0,max_retries:3,timeout:null,priority:1,error_handling:"default",output_file:null,output_json:null,output_pydantic:null,callback:null,human_input:!1,guardrail:null,markdown:!1},tools:i.tools||[]});s(e),n(),h("")}else v("Failed to generate task")}catch(t){if(t&&"object"===typeof t&&"response"in t&&t.response&&"object"===typeof t.response&&"data"in t.response){const e=t.response.data;if(e&&"object"===typeof e&&"detail"in e&&"string"===typeof e.detail){const t=e.detail.match(/No API key found for provider: (\w+)/i);if(t&&t[1]){const e=t[1].toLowerCase();S(!0),E(e),v("".concat(e.toUpperCase()," API key is required. Please configure it in the API Keys section."))}else v(e.detail)}else v(t instanceof Error?t.message:"Failed to generate task")}else v(t instanceof Error?t.message:"Failed to generate task")}finally{g(!1)}}else v("Please enter a prompt")};return(0,O.jsxs)(r.A,{open:t,onClose:n,maxWidth:"md",fullWidth:!0,children:[(0,O.jsx)(d.A,{children:"Generate Task with AI"}),(0,O.jsx)(l.A,{children:(0,O.jsxs)(o.A,{sx:{mt:2,display:"flex",flexDirection:"column",gap:2},children:[f&&(0,O.jsx)(m.A,{severity:"error",sx:{mb:2},action:C&&(0,O.jsx)(x.A,{color:"inherit",size:"small",onClick:()=>{Be.getState().openApiKeyEditor(_);const e=new CustomEvent("openConfigAPIKeys");window.dispatchEvent(e),n()},children:"Configure API Keys"}),children:f}),(0,O.jsxs)(oe.A,{fullWidth:!0,children:[(0,O.jsx)(re.A,{children:"Model"}),(0,O.jsx)(le.A,{value:A,onChange:e=>{y(e.target.value)},label:"Model",disabled:p||w,children:w?(0,O.jsx)(de.A,{disabled:!0,children:"Loading models..."}):Object.entries(b).filter(e=>{let[t,n]=e;return!1!==n.enabled}).map(e=>{let[t,n]=e;return(0,O.jsxs)(de.A,{value:t,sx:{display:"flex",justifyContent:"space-between",gap:1},children:[(0,O.jsx)("span",{children:t}),(0,O.jsx)("span",{style:{fontSize:"0.8em"},children:n.provider?"(".concat(n.provider,")"):""})]},t)})})]}),(0,O.jsx)(V.A,{fullWidth:!0,label:"Describe the task you want to create",multiline:!0,rows:4,value:u,onChange:e=>h(e.target.value),onKeyPress:e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),D())},placeholder:"Example: Create a task that analyzes a dataset and generates a summary report",disabled:p,autoFocus:!0})]})}),(0,O.jsxs)(B.A,{children:[(0,O.jsx)(x.A,{onClick:n,disabled:p,children:"Cancel"}),(0,O.jsx)(x.A,{onClick:D,variant:"contained",disabled:p||!u.trim()||w,startIcon:p?(0,O.jsx)(ue.A,{size:20}):null,children:p?"Generating...":"Generate"})]})]})};var Xn=n(78135);const Zn=(0,j.vt)(e=>({models:Xn.J,currentEditModel:null,editDialogOpen:!1,isNewModel:!1,loading:!0,saving:!1,modelsChanged:!1,searchTerm:"",databricksEnabled:!1,error:null,refreshKey:0,activeTab:0,setModels:t=>e({models:t}),setCurrentEditModel:t=>e({currentEditModel:t}),setEditDialogOpen:t=>e({editDialogOpen:t}),setIsNewModel:t=>e({isNewModel:t}),setLoading:t=>e({loading:t}),setSaving:t=>e({saving:t}),setModelsChanged:t=>e({modelsChanged:t}),setSearchTerm:t=>e({searchTerm:t}),setDatabricksEnabled:t=>e({databricksEnabled:t}),setError:t=>e({error:t}),incrementRefreshKey:()=>e(e=>({refreshKey:e.refreshKey+1})),setActiveTab:t=>e({activeTab:t}),resetModelConfig:()=>e({models:Xn.J,currentEditModel:null,editDialogOpen:!1,isNewModel:!1,loading:!0,saving:!1,modelsChanged:!1,searchTerm:"",databricksEnabled:!1,error:null,refreshKey:0,activeTab:0})}));class Qn{static async createCrew(e){try{const t=await ye.uE.post("/crew/create-crew",{prompt:e.prompt,model:e.model,tools:e.tools||[]});return{agents:t.data.agents,tasks:t.data.tasks}}catch(t){throw t}}}const $n=e=>{let{open:t,onClose:n,onGenerateCrew:s,selectedModel:u,tools:h,selectedTools:p,onToolsChange:g}=e;const[f,v]=(0,i.useState)(""),[A,y]=(0,i.useState)(!1),[j,w]=(0,i.useState)(h),[k,C]=(0,i.useState)(""),[S,_]=(0,i.useState)({}),[E,I]=(0,i.useState)(!1),T=(0,i.useRef)(null),D=(0,i.useRef)(null),N=(0,i.useRef)(!1),P=(0,i.useRef)(u||""),[M,z]=(0,i.useState)(null),[L,F]=(0,i.useState)(!1),[W,U]=(0,i.useState)(""),[H,K]=(0,i.useState)(!1),G=Zn(),{models:J,loading:q}=G,{setSelectedModel:Y}=(0,b.E)(),{secrets:X,fetchAPIKeys:Z}=Be(),Q=(0,i.useMemo)(()=>(0,a.A)((0,a.A)({},J),S),[S,J]);(0,i.useEffect)(()=>{if(t){I(!0);ve.J.getInstance().getActiveModels().then(e=>{if(_(e),I(!1),!k&&!P.current&&Object.keys(e).length>0){const t=Object.keys(e)[0];C(t),P.current=t,Y(t)}}).catch(e=>{I(!1)})}},[t,Y,k]),(0,i.useEffect)(()=>{if(Q&&Object.keys(Q).length>0&&(!P.current||""===P.current)){const e=Object.keys(Q)[0];P.current=e}},[Q]),(0,i.useEffect)(()=>{h&&h.length>0&&w(h)},[h]),(0,i.useEffect)(()=>{if(!t)return void(N.current=!1);if(N.current)return;(async()=>{if(N.current=!0,v(""),P.current||Object.keys(Q).length>0&&(P.current=Object.keys(Q)[0],Y(P.current)),!j||0===j.length)try{const e=gt.m,t=(await e.listTools()).map(e=>(0,a.A)((0,a.A)({},e),{},{id:e.id.toString(),enabled:void 0===e.enabled||e.enabled,category:e.category}));w(t)}catch(e){}})()},[t,Q,j,Y]);const $=async()=>{if(f.trim()&&P.current){y(!0),z(null),F(!1),U(""),Y(P.current);try{var e;await Z();const t=Q[P.current],a=(null===t||void 0===t||null===(e=t.provider)||void 0===e?void 0:e.toLowerCase())||"openai",i=await(async e=>{try{var t;if(!Q||!Q[e])return!1;const n=(null===(t=Q[e].provider)||void 0===t?void 0:t.toLowerCase())||"openai",a=Be.getState().secrets;return!!await Gn(n)||await Jn(n,a)}catch(n){return!1}})(P.current);if(!i)return F(!0),U(a),z("".concat(a.toUpperCase()," API key is required. Please configure it in the API Keys section.")),void y(!1);const o=await Qn.createCrew({prompt:f,model:P.current,tools:p});if(o.tasks&&o.tasks.length>0&&o.agents&&o.agents.length>0){const e=o.agents[0].id;o.tasks.forEach(t=>{!t.agent_id&&e&&(t.agent_id=e,t.assigned_agent=e),t.context&&Array.isArray(t.context)||(t.context=[])})}if(o.tasks&&o.tasks.length>1){let e=0,t=0;o.tasks.forEach(n=>{n.context&&n.context.length>0?e++:t++})}s(o,H),n()}catch(t){if(t&&"object"===typeof t&&"response"in t&&t.response&&"object"===typeof t.response&&"data"in t.response){const e=t.response.data;if(e&&"object"===typeof e&&"detail"in e&&"string"===typeof e.detail){const t=e.detail.match(/No API key found for provider: (\w+)/i);if(t&&t[1]){const e=t[1].toLowerCase();F(!0),U(e),z("".concat(e.toUpperCase()," API key is required. Please configure it in the API Keys section."))}else z(e.detail)}else z("Failed to generate crew. Please try again later.")}else z("Failed to generate crew. Please try again later.")}finally{y(!1)}}};return(0,i.useEffect)(()=>{(()=>{if(Q&&Object.keys(Q).length>0&&!k){const e=Object.entries(Q).filter(e=>{let[t,n]=e;return!0===(null===n||void 0===n?void 0:n.enabled)});if(e.length>0){const[t]=e[0];C(t),P.current=t,Y(t)}else{const e=Object.keys(Q)[0];C(e),P.current=e,Y(e)}}})()},[Q,k,Y]),(0,O.jsx)(r.A,{open:t,onClose:n,maxWidth:"md",fullWidth:!0,TransitionProps:{onEntered:()=>{setTimeout(()=>{T.current&&T.current.focus()},150)}},children:(0,O.jsxs)("form",{onSubmit:e=>{e.preventDefault(),!f||A||E||$()},children:[(0,O.jsx)(d.A,{children:"Generate Crew from Description"}),(0,O.jsxs)(l.A,{children:[M&&(0,O.jsx)(m.A,{severity:"error",sx:{mb:2,mt:1},action:L&&(0,O.jsx)(x.A,{color:"inherit",size:"small",onClick:()=>{Be.getState().openApiKeyEditor(W);const e=new CustomEvent("openConfigAPIKeys");window.dispatchEvent(e),n()},children:"Configure API Keys"}),children:M}),(0,O.jsxs)(oe.A,{fullWidth:!0,margin:"normal",children:[(0,O.jsx)(re.A,{id:"model-label",children:"Model"}),(0,O.jsx)(le.A,{labelId:"model-label",value:k||P.current||"",onChange:e=>{const t=e.target.value;C(t),P.current=t,Y(t)},label:"Model",disabled:A||E,MenuProps:{PaperProps:{style:{maxHeight:300,width:"auto"}}},sx:{minHeight:56,"& .MuiSelect-select":{display:"flex",alignItems:"center"}},children:E?(0,O.jsxs)(de.A,{disabled:!0,value:"",children:[(0,O.jsx)(ue.A,{size:20})," Loading models..."]}):0===Object.keys(Q).length?(0,O.jsx)(de.A,{disabled:!0,value:"",children:"No models available"}):Object.entries(Q).filter(e=>{let[t,n]=e;return!0===(null===n||void 0===n?void 0:n.enabled)}).map(e=>{let[t,n]=e;return(0,O.jsxs)(de.A,{value:t,sx:{minHeight:"40px"},children:[(null===n||void 0===n?void 0:n.name)||t," ",null!==n&&void 0!==n&&n.provider?"(".concat(n.provider,")"):""]},t)})})]}),(0,O.jsx)(V.A,{inputRef:T,label:"Describe your crew",multiline:!0,rows:6,value:f,onChange:e=>v(e.target.value),onKeyDown:e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),!f.trim()||A||E||$())},fullWidth:!0,margin:"normal",placeholder:"Example: I need a crew to help me analyze market research data and create a report with visualizations",disabled:A,autoFocus:!0}),(0,O.jsxs)(o.A,{sx:{mt:2},children:[(0,O.jsx)(c.A,{variant:"subtitle1",gutterBottom:!0,children:"Available Tools"}),(0,O.jsxs)(o.A,{sx:{display:"flex",flexWrap:"wrap",gap:1},children:[j&&j.filter(e=>!1!==e.enabled).map(e=>{const t=(e=>"string"===typeof e.id?e.id:"number"===typeof e.id?e.id.toString():"")(e);return(0,O.jsx)(R.A,{label:e.title||"Unnamed Tool",onClick:()=>(e=>{if(p.includes(e)){const t=p.filter(t=>t!==e);g(t)}else{const t=[...p,e];g(t)}})(t),color:p.includes(t)?"primary":"default",sx:{m:.5}},t)}),(!j||0===j.length)&&(0,O.jsx)(ue.A,{size:20,sx:{m:2}})]}),j&&j.length>0&&0===j.filter(e=>!1!==e.enabled).length&&(0,O.jsx)(c.A,{color:"text.secondary",sx:{mt:1},children:"No enabled tools available. Please enable tools in the Tools section."})]}),(0,O.jsx)(o.A,{sx:{mt:3},children:(0,O.jsx)(he.A,{control:(0,O.jsx)(Ht.A,{checked:H,onChange:e=>K(e.target.checked),disabled:A}),label:"Execute crew after generation"})})]}),(0,O.jsxs)(B.A,{children:[(0,O.jsx)(x.A,{onClick:n,disabled:A,children:"Cancel"}),(0,O.jsx)(x.A,{ref:D,onClick:$,color:"primary",disabled:!f.trim()||A||E,children:A?(0,O.jsx)(ue.A,{size:24}):"Generate"})]})]})})};var ea=n(11966),ta=n(84142),na=n(29635),aa=n(3148),sa=n(11361),ia=n(41328);const oa=e=>e.map(e=>e.position&&"number"===typeof e.position.x&&isFinite(e.position.x)&&"number"===typeof e.position.y&&isFinite(e.position.y)?Math.abs(e.position.x)>1e4||Math.abs(e.position.y)>1e4?(0,a.A)((0,a.A)({},e),{},{position:{x:100+300*Math.random(),y:100+200*Math.random()}}):e:(0,a.A)((0,a.A)({},e),{},{position:{x:100+300*Math.random(),y:100+200*Math.random()}})),ra=["children","value","index"];function la(e){const{children:t,value:n,index:i}=e,r=(0,s.A)(e,ra);return(0,O.jsx)("div",(0,a.A)((0,a.A)({role:"tabpanel",hidden:n!==i,id:"flow-tabpanel-".concat(i),"aria-labelledby":"flow-tab-".concat(i)},r),{},{style:{padding:"16px 0",height:"calc(100% - 48px)",overflow:"auto"},children:n===i&&(0,O.jsx)(o.A,{sx:{height:"100%"},children:t})}))}const da=e=>{var t,n,s,p,g,f;let{open:v,onClose:A,flowId:y,onSave:b}=e;const[j,w]=(0,i.useState)(0),[C,S]=(0,i.useState)(null),[_,E]=(0,i.useState)(""),[I,T]=(0,i.useState)(!1),[N,P]=(0,i.useState)(!1),[M,z]=(0,i.useState)(null),[L,F]=(0,i.useState)(!1),[W,U]=(0,i.useState)([]),[H,K]=(0,i.useState)([]),[G,J]=(0,i.useState)([]),[Y,X]=(0,i.useState)(-1),[Z,Q]=(0,i.useState)([]),[$,ee]=(0,i.useState)([]),[ae,se]=(0,i.useState)([]),[ie,ce]=(0,i.useState)("");(0,i.useEffect)(()=>{v&&y?pe(y):me()},[v,y]),(0,i.useEffect)(()=>{$.length&&v&&y&&(async()=>{if(!$.length)return;const e=[];for(const t of $)try{const n=await We.getCrew(String(t.id));n&&n.tasks&&Array.isArray(n.tasks)&&n.tasks.forEach(n=>{const a=n;e.some(e=>e.id===String(a.id))||e.push({id:String(a.id),name:a.name||"Task ".concat(a.id),agent_id:String(t.id)})})}catch(M){}Q(t=>{const n=new Map(t.map(e=>[e.id,e]));return e.forEach(e=>{n.has(e.id)||n.set(e.id,e)}),Array.from(n.values())}),K(t=>{const n=new Map(t.map(e=>[e.taskId,e])),a=[];return e.forEach(e=>{if(!n.has(e.id)){const t=$.find(t=>String(t.id)===e.agent_id);t&&a.push({crewId:String(t.id),taskId:e.id,taskName:e.name,crewName:t.name,isStartPoint:!1})}}),[...t,...a]})})()},[$,v,y]),(0,i.useEffect)(()=>{v&&y&&(async()=>{if($.length)try{const n=await We.getCrews(),a=new Map($.map(e=>[e.id,e])),s=[];for(const i of Array.from(a.keys()))try{var e;const t=n.find(e=>String(e.id)===String(i));(null===t||void 0===t?void 0:t.name)||(null===(e=a.get(i))||void 0===e?void 0:e.name)||"Crew ".concat(i),(await We.getTasks(String(i))).forEach(e=>{s.some(t=>t.id===String(e.id))||s.push({id:String(e.id),name:e.name,agent_id:String(i)})})}catch(t){}Q(e=>{const t=new Map(e.map(e=>[e.id,e]));return s.forEach(e=>{t.has(e.id)||t.set(e.id,e)}),Array.from(t.values())}),K(e=>{const t=new Map(e.map(e=>[e.taskId,e])),i=[];return s.forEach(e=>{var s;if(t.has(e.id))return;const o=Number(e.agent_id),r=a.get(o)||{id:o,name:(null===(s=n.find(e=>String(e.id)===String(o)))||void 0===s?void 0:s.name)||"Crew ".concat(o)};i.push({crewId:String(r.id),taskId:e.id,taskName:e.name,crewName:r.name,isStartPoint:!1})}),[...e,...i]})}catch(M){}})()},[$,v,y]);const he=(0,i.useCallback)(async()=>{try{const t=await We.getCrews(),n=[];for(const a of t)try{(await We.getTasks(String(a.id))).forEach(e=>{n.some(t=>t.id===String(e.id))||n.push({id:String(e.id),name:e.name,agent_id:String(a.id)})})}catch(e){}return Q(e=>{const t=new Map(e.map(e=>[e.id,e]));return n.forEach(e=>{t.has(e.id)||t.set(e.id,e)}),Array.from(t.values())}),K(e=>{const t=new Map(e.map(e=>[e.taskId,e])),a=[],s=$.map(e=>String(e.id));return n.forEach(e=>{if(t.has(e.id))return;const n=String(e.agent_id);if(s.includes(n)){const t=$.find(e=>String(e.id)===n);t&&a.push({crewId:String(t.id),taskId:e.id,taskName:e.name,crewName:t.name,isStartPoint:!1})}}),[...e,...a]}),!0}catch(M){return!1}},[$]);(0,i.useEffect)(()=>{y&&$.length>0&&v&&he().then(e=>{})},[y,$.length,v,he]);const me=()=>{S(null),E(""),z(null),U([]),K([]),J([]),X(-1),w(0)},pe=async e=>{T(!0),z(null);try{const t=e.toString(),n=await Wt.getFlow(t);if(!n)throw new Error("Failed to load flow data");S(n),E(n.name||"");const s=[];if(n.flowConfig||n.flow_config){const e=n.flowConfig||n.flow_config;if(null!==e&&void 0!==e&&e.listeners&&Array.isArray(e.listeners)){const t=e.listeners.map(e=>{const t=e.listenToTaskIds||(e.listenTo&&Array.isArray(e.listenTo)?e.listenTo:"string"===typeof e.listenTo?[e.listenTo]:[]),n=e.listenToTaskNames||[];return e.crewId&&!s.some(t=>String(t.id)===String(e.crewId))&&s.push({id:"string"===typeof e.crewId?parseInt(e.crewId,10)||0:e.crewId,name:e.crewName||"Crew ".concat(e.crewId)}),(0,a.A)((0,a.A)({},e),{},{listenToTaskIds:t,listenToTaskNames:n})});U(t)}else U([]);null!==e&&void 0!==e&&e.startingPoints&&Array.isArray(e.startingPoints)?(e.startingPoints.forEach(e=>{e.crewId&&!s.some(t=>String(t.id)===String(e.crewId))&&s.push({id:"string"===typeof e.crewId?parseInt(e.crewId,10)||0:e.crewId,name:e.crewName||"Crew ".concat(e.crewId)})}),K(e.startingPoints)):K([]),null!==e&&void 0!==e&&e.actions&&Array.isArray(e.actions)?(e.actions.forEach(e=>{e.crewId&&!s.some(t=>String(t.id)===String(e.crewId))&&s.push({id:"string"===typeof e.crewId?parseInt(e.crewId,10)||0:e.crewId,name:e.crewName||"Crew ".concat(e.crewId)})}),J(e.actions)):J([])}else U([]),K([]),J([]);ee(s),s.length}catch(M){z(M instanceof Error?M.message:"An error occurred while loading the flow")}finally{T(!1)}};return(0,i.useEffect)(()=>{},[j,Z.length,H,$.length]),(0,O.jsxs)(O.Fragment,{children:[(0,O.jsxs)(r.A,{open:v,onClose:A,maxWidth:"md",fullWidth:!0,PaperProps:{sx:{height:"80vh"}},children:[(0,O.jsxs)(d.A,{sx:{borderBottom:"1px solid",borderColor:"divider"},children:["Edit Flow",(0,O.jsx)(u.A,{"aria-label":"close",onClick:A,sx:{position:"absolute",right:8,top:8},children:(0,O.jsx)(D.A,{})})]}),(0,O.jsx)(o.A,{sx:{borderBottom:1,borderColor:"divider",px:2},children:(0,O.jsxs)(ea.A,{value:j,onChange:(e,t)=>{w(t)},"aria-label":"flow edit tabs",children:[(0,O.jsx)(ta.A,{label:"Basic Info",id:"flow-tab-0","aria-controls":"flow-tabpanel-0"}),(0,O.jsx)(ta.A,{label:"Crews",id:"flow-tab-1","aria-controls":"flow-tabpanel-1"}),(0,O.jsx)(ta.A,{label:"Listeners",id:"flow-tab-2","aria-controls":"flow-tabpanel-2"}),(0,O.jsx)(ta.A,{label:"Starting Points",id:"flow-tab-3","aria-controls":"flow-tabpanel-3"})]})}),(0,O.jsx)(l.A,{sx:{p:2,display:"flex",flexDirection:"column",height:"calc(100% - 120px)"},children:I?(0,O.jsx)(o.A,{sx:{display:"flex",justifyContent:"center",alignItems:"center",height:"100%"},children:(0,O.jsx)(ue.A,{})}):M?(0,O.jsx)(m.A,{severity:"error",sx:{mt:2},children:M}):C?(0,O.jsxs)(O.Fragment,{children:[(0,O.jsx)(la,{value:j,index:0,children:(0,O.jsxs)(_e.A,{variant:"outlined",sx:{p:3,border:"1px solid",borderColor:"primary.light",borderRadius:1},children:[(0,O.jsx)(c.A,{variant:"h6",gutterBottom:!0,color:"primary",children:"Basic Information"}),(0,O.jsx)(V.A,{label:"Flow Name",fullWidth:!0,value:_,onChange:e=>E(e.target.value),margin:"normal",variant:"outlined",required:!0,error:!_.trim(),helperText:!_.trim()&&"Flow name is required"}),(0,O.jsxs)(c.A,{variant:"body2",color:"text.secondary",sx:{mt:2},children:["ID: ",C.id]}),(0,O.jsxs)(c.A,{variant:"body2",color:"text.secondary",children:["Created: ",new Date(C.created_at).toLocaleString()]}),(0,O.jsxs)(c.A,{variant:"body2",color:"text.secondary",children:["Last Updated: ",new Date(C.updated_at).toLocaleString()]})]})}),(0,O.jsxs)(la,{value:j,index:1,children:[(0,O.jsx)(c.A,{variant:"body2",color:"text.secondary",paragraph:!0,children:"Manage the crews included in this flow. You can add or remove crews to modify which components are available in the flow."}),(0,O.jsxs)(o.A,{sx:{display:"flex",height:"calc(100% - 50px)"},children:[(0,O.jsxs)(_e.A,{variant:"outlined",sx:{width:"50%",p:2,mr:2,height:"100%",overflow:"auto"},children:[(0,O.jsx)(c.A,{variant:"subtitle2",gutterBottom:!0,fontWeight:"medium",children:"Current Crews in Flow"}),0===$.length?(0,O.jsx)(c.A,{variant:"body2",sx:{my:2,textAlign:"center",color:"text.secondary"},children:"No crews in this flow. Add crews from the list on the right."}):(0,O.jsx)(at.A,{sx:{p:0},children:$.map(e=>(0,O.jsxs)(_e.A,{elevation:0,sx:{p:2,mb:1,border:"1px solid",borderColor:"divider",borderRadius:1,display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,O.jsx)(c.A,{variant:"body1",children:e.name}),(0,O.jsx)(u.A,{size:"small",color:"error",onClick:()=>{ee(t=>t.filter(t=>t.id!==e.id))},children:(0,O.jsx)(q.A,{fontSize:"small"})})]},e.id))})]}),(0,O.jsxs)(_e.A,{variant:"outlined",sx:{width:"50%",p:2,height:"100%",overflow:"auto"},children:[(0,O.jsx)(c.A,{variant:"subtitle2",gutterBottom:!0,fontWeight:"medium",children:"Available Crews"}),(0,O.jsx)(V.A,{placeholder:"Search crews...",size:"small",fullWidth:!0,sx:{mb:2},value:ie,onChange:e=>ce(e.target.value),InputProps:{startAdornment:(0,O.jsx)(ne.A,{position:"start",children:(0,O.jsx)(Ee.A,{fontSize:"small"})})}}),(0,O.jsxs)(at.A,{sx:{p:0},children:[ae.filter(e=>e.name.toLowerCase().includes(ie.toLowerCase())&&!$.some(t=>t.id===e.id)).map(e=>(0,O.jsxs)(_e.A,{elevation:0,sx:{p:2,mb:1,border:"1px solid",borderColor:"divider",borderRadius:1,display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,O.jsx)(c.A,{variant:"body1",children:e.name}),(0,O.jsx)(u.A,{size:"small",color:"primary",onClick:()=>{ee(t=>[...t,e])},children:(0,O.jsx)(Qt.A,{fontSize:"small"})})]},e.id)),0===ae.filter(e=>e.name.toLowerCase().includes(ie.toLowerCase())&&!$.some(t=>t.id===e.id)).length&&(0,O.jsx)(c.A,{variant:"body2",sx:{textAlign:"center",color:"text.secondary",p:2},children:"No matching crews found"})]})]})]})]}),(0,O.jsxs)(la,{value:j,index:2,children:[(0,O.jsx)(c.A,{variant:"body2",color:"text.secondary",paragraph:!0,children:"Configure listeners for your flow. Listeners respond to task outputs and can trigger actions in the flow. Each listener needs to know which tasks to listen to (Listen To Tasks) and which tasks to execute when triggered (Tasks To Execute)."}),(0,O.jsxs)(o.A,{sx:{display:"flex",mb:2,gap:1},children:[(0,O.jsx)(x.A,{startIcon:(0,O.jsx)(Qt.A,{}),variant:"outlined",onClick:()=>{const e={id:"listener-".concat((0,k.A)()),name:"Listener ".concat(W.length+1),crewId:$.length>0?String($[0].id):"",crewName:$.length>0?$[0].name:"Unknown Crew",conditionType:"NONE",tasks:[],state:{stateType:"unstructured",stateDefinition:"",stateData:{}},listenToTaskIds:[]};U(t=>[...t,e]),X(W.length)},children:"Add Listener"}),(0,O.jsx)(x.A,{variant:"outlined",size:"small",onClick:()=>{alert("Debug info logged to console.\nListeners: ".concat(W.length,"\nActions: ").concat(G.length,"\nStarting Points: ").concat(H.filter(e=>e.isStartPoint).length))},children:"Debug Flow"})]}),0===W.length?(0,O.jsx)(c.A,{variant:"body2",sx:{my:2,textAlign:"center"},children:"No listeners configured. Click the button above to add a listener."}):(0,O.jsxs)(o.A,{sx:{display:"flex",height:"calc(100% - 80px)"},children:[(0,O.jsxs)(_e.A,{variant:"outlined",sx:{width:"30%",p:2,mr:2,height:"100%",overflow:"auto"},children:[(0,O.jsx)(c.A,{variant:"subtitle2",gutterBottom:!0,fontWeight:"medium",children:"Listeners"}),W.map((e,t)=>(0,O.jsxs)(o.A,{onClick:()=>X(t),sx:{p:1.5,mb:1,borderRadius:1,cursor:"pointer",bgcolor:Y===t?"primary.light":"grey.100",color:Y===t?"primary.contrastText":"text.primary","&:hover":{bgcolor:Y===t?"primary.light":"grey.200"},position:"relative"},children:[(0,O.jsx)(c.A,{variant:"body2",fontWeight:Y===t?"bold":"normal",children:e.crewName}),(0,O.jsxs)(c.A,{variant:"caption",color:Y===t?"primary.contrastText":"text.secondary",display:"block",children:["Listen To: ",e.listenToTaskIds&&e.listenToTaskIds.length>0?e.listenToTaskIds.map(e=>{const t=Z.find(t=>String(t.id)===e),n=$.find(e=>String(e.id)===String(null===t||void 0===t?void 0:t.agent_id)),a=(null===t||void 0===t?void 0:t.name)||"Task ".concat(e),s=(null===n||void 0===n?void 0:n.name)||(null!==t&&void 0!==t&&t.agent_id?"Crew ".concat(null===t||void 0===t?void 0:t.agent_id):"System");return"".concat(s,":").concat(a)}).join(", "):"Not set"]}),(0,O.jsxs)(c.A,{variant:"caption",color:Y===t?"primary.contrastText":"text.secondary",display:"block",children:["Tasks: ",e.tasks.length>0?e.tasks.map(e=>{const t=Z.find(t=>t.id===e.id),n=$.find(n=>String(n.id)===String(e.agent_id||(null===t||void 0===t?void 0:t.agent_id))),a=e.name||(null===t||void 0===t?void 0:t.name)||"Task ".concat(e.id),s=(null===n||void 0===n?void 0:n.name)||(e.agent_id?"Crew ".concat(e.agent_id):"");return s?"".concat(s,":").concat(a):a}).join(", "):"None"]}),(0,O.jsx)(c.A,{variant:"caption",color:Y===t?"primary.contrastText":"text.secondary",display:"block",children:e.conditionType||"No Condition"}),(0,O.jsx)(u.A,{size:"small",sx:{position:"absolute",top:4,right:4,color:Y===t?"primary.contrastText":"error.main"},onClick:t=>{var n;t.stopPropagation(),n=e.id,U(e=>e.filter(e=>e.id!==n)),J(e=>e.filter(e=>!e.id.includes(n))),Y>=W.length-1&&X(Math.max(0,W.length-2))},children:(0,O.jsx)(q.A,{fontSize:"small"})})]},e.id))]}),Y>=0&&Y<W.length?(0,O.jsxs)(_e.A,{variant:"outlined",sx:{width:"70%",p:2,height:"100%",overflow:"auto"},children:[(0,O.jsx)(c.A,{variant:"subtitle2",gutterBottom:!0,fontWeight:"medium",children:"Configure Listener"}),(0,O.jsxs)(oe.A,{fullWidth:!0,margin:"normal",children:[(0,O.jsx)(re.A,{id:"listen-to-task-label",children:"Listen To Tasks"}),(0,O.jsx)(le.A,{labelId:"listen-to-task-label",multiple:!0,value:(null===(t=W[Y])||void 0===t?void 0:t.listenToTaskIds)||[],onChange:e=>{if(Y<0)return;const t=e.target.value;U(e=>{const n=[...e];return n[Y]=(0,a.A)((0,a.A)({},n[Y]),{},{listenToTaskIds:t}),n})},label:"Listen To Tasks",renderValue:e=>(0,O.jsx)(o.A,{sx:{display:"flex",flexWrap:"wrap",gap:.5},children:e.map(e=>{const t=Z.find(t=>t.id===e),n=$.find(e=>e.id.toString()===(null===t||void 0===t?void 0:t.agent_id));return(0,O.jsx)(R.A,{label:"".concat((null===n||void 0===n?void 0:n.name)||(null!==t&&void 0!==t&&t.agent_id?"Crew ".concat(null===t||void 0===t?void 0:t.agent_id):"System"),":").concat((null===t||void 0===t?void 0:t.name)||"Task ".concat(e))},e)})}),children:Z.filter(e=>!String(e.id).startsWith("agent-")).map(e=>{var t;const n=$.find(t=>String(t.id)===e.agent_id);return(0,O.jsxs)(de.A,{value:e.id,children:[(0,O.jsx)(Ht.A,{checked:((null===(t=W[Y])||void 0===t?void 0:t.listenToTaskIds)||[]).includes(e.id)}),(0,O.jsx)(ot.A,{primary:"".concat((null===n||void 0===n?void 0:n.name)||(null!==e&&void 0!==e&&e.agent_id?"Crew ".concat(null===e||void 0===e?void 0:e.agent_id):"System"),":").concat(e.name),secondary:"ID: ".concat(e.id," (Task)")})]},e.id)})})]}),(0,O.jsxs)(oe.A,{fullWidth:!0,margin:"normal",children:[(0,O.jsx)(re.A,{id:"condition-type-label",children:"Condition Type"}),(0,O.jsxs)(le.A,{labelId:"condition-type-label",value:(null===(n=W[Y])||void 0===n?void 0:n.conditionType)||"NONE",onChange:e=>{if(Y<0)return;const t=e.target.value;U(e=>{const n=[...e];return n[Y]=(0,a.A)((0,a.A)({},n[Y]),{},{conditionType:t}),n})},label:"Condition Type",children:[(0,O.jsx)(de.A,{value:"NONE",children:(0,O.jsx)(ot.A,{primary:"NONE",secondary:"No condition, always trigger when task completes"})}),(0,O.jsx)(de.A,{value:"AND",children:(0,O.jsx)(ot.A,{primary:"AND",secondary:"Trigger when ALL listened tasks complete"})}),(0,O.jsx)(de.A,{value:"OR",children:(0,O.jsx)(ot.A,{primary:"OR",secondary:"Trigger when ANY listened task completes"})}),(0,O.jsx)(de.A,{value:"ROUTER",children:(0,O.jsx)(ot.A,{primary:"ROUTER",secondary:"Route based on task output conditions"})})]})]}),(0,O.jsxs)(oe.A,{fullWidth:!0,margin:"normal",children:[(0,O.jsx)(re.A,{id:"listener-tasks-label",children:"Tasks To Execute"}),(0,O.jsx)(le.A,{labelId:"listener-tasks-label",multiple:!0,value:(null===(s=W[Y])||void 0===s?void 0:s.tasks.map(e=>e.id))||[],onChange:e=>{const t=e.target.value;U(e=>{const n=[...e];if(Y>=0&&Y<n.length){const e=t.map(e=>{const t=Z.find(t=>t.id===e);return{id:e,name:(null===t||void 0===t?void 0:t.name)||"Task ".concat(e),agent_id:(null===t||void 0===t?void 0:t.agent_id)||"",description:"",expected_output:"",context:(null===t||void 0===t?void 0:t.context)||[]}});n[Y]=(0,a.A)((0,a.A)({},n[Y]),{},{tasks:e})}return n});const n=[],s=new Map;W.forEach(e=>{s.set(e.id,e)}),W.forEach((e,a)=>{(a===Y?t.map(e=>{const t=Z.find(t=>t.id===e);return{id:e,name:(null===t||void 0===t?void 0:t.name)||"Task ".concat(e),agent_id:(null===t||void 0===t?void 0:t.agent_id)||"",description:"",expected_output:"",context:(null===t||void 0===t?void 0:t.context)||[]}}):e.tasks).forEach(t=>{let a=e.crewId,s=e.crewName;if(t.agent_id){const e=$.find(e=>String(e.id)===t.agent_id);e&&(a=String(e.id),s=e.name)}const i="action-".concat(e.id,"-").concat(t.id);n.push({id:i,crewId:a,crewName:s,taskId:t.id,taskName:t.name||"Task ".concat(t.id)})})}),J(n)},label:"Tasks To Execute",renderValue:e=>(0,O.jsx)(o.A,{sx:{display:"flex",flexWrap:"wrap",gap:.5},children:e.map(e=>{const t=Z.find(t=>t.id===e),n=$.find(e=>e.id.toString()===(null===t||void 0===t?void 0:t.agent_id));return(0,O.jsx)(R.A,{label:"".concat((null===n||void 0===n?void 0:n.name)||(null!==t&&void 0!==t&&t.agent_id?"Crew ".concat(null===t||void 0===t?void 0:t.agent_id):"System"),":").concat((null===t||void 0===t?void 0:t.name)||"Task ".concat(e))},e)})}),children:Z.filter(e=>!String(e.id).startsWith("agent-")).map(e=>{var t;const n=$.find(t=>String(t.id)===e.agent_id);return(0,O.jsxs)(de.A,{value:e.id,children:[(0,O.jsx)(Ht.A,{checked:((null===(t=W[Y])||void 0===t?void 0:t.tasks.map(e=>e.id))||[]).includes(e.id)}),(0,O.jsx)(ot.A,{primary:"".concat((null===n||void 0===n?void 0:n.name)||(null!==e&&void 0!==e&&e.agent_id?"Crew ".concat(null===e||void 0===e?void 0:e.agent_id):"System"),":").concat(e.name),secondary:"ID: ".concat(e.id," (Task)")})]},e.id)})})]}),(0,O.jsx)(te.A,{sx:{my:3}}),(0,O.jsx)(c.A,{variant:"subtitle2",gutterBottom:!0,children:"State Configuration"}),(0,O.jsxs)(oe.A,{fullWidth:!0,margin:"normal",children:[(0,O.jsx)(re.A,{id:"state-type-label",children:"State Type"}),(0,O.jsxs)(le.A,{labelId:"state-type-label",value:(null===(p=W[Y])||void 0===p||null===(p=p.state)||void 0===p?void 0:p.stateType)||"unstructured",onChange:e=>{if(Y<0)return;const t=e.target.value;U(e=>{const n=[...e];return n[Y]=(0,a.A)((0,a.A)({},n[Y]),{},{state:(0,a.A)((0,a.A)({},n[Y].state),{},{stateType:t})}),n})},label:"State Type",children:[(0,O.jsx)(de.A,{value:"unstructured",children:(0,O.jsx)(ot.A,{primary:"Unstructured",secondary:"Free-form text state"})}),(0,O.jsx)(de.A,{value:"structured",children:(0,O.jsx)(ot.A,{primary:"Structured",secondary:"JSON-formatted state"})})]})]}),(0,O.jsx)(V.A,{label:"State Definition",fullWidth:!0,multiline:!0,rows:4,margin:"normal",value:(null===(g=W[Y])||void 0===g||null===(g=g.state)||void 0===g?void 0:g.stateDefinition)||"",onChange:e=>{if(Y<0)return;const t=e.target.value;U(e=>{const n=[...e];return n[Y]=(0,a.A)((0,a.A)({},n[Y]),{},{state:(0,a.A)((0,a.A)({},n[Y].state),{},{stateDefinition:t})}),n})},placeholder:"structured"===(null===(f=W[Y])||void 0===f||null===(f=f.state)||void 0===f?void 0:f.stateType)?'{"key": "value"}':"Enter state description here...",InputProps:{sx:{fontFamily:"monospace"}}})]}):(0,O.jsx)(_e.A,{variant:"outlined",sx:{width:"70%",p:2,height:"100%",display:"flex",alignItems:"center",justifyContent:"center"},children:(0,O.jsx)(c.A,{color:"text.secondary",children:"Select a listener from the list or add a new one"})})]})]}),(0,O.jsxs)(la,{value:j,index:3,children:[(0,O.jsx)(c.A,{variant:"body2",color:"text.secondary",paragraph:!0,children:"Configure starting points for your flow. Starting points are specific tasks that will trigger the workflow execution."}),(0,O.jsx)(x.A,{variant:"outlined",size:"small",sx:{mb:2},onClick:async()=>{await he()},children:"Refresh Tasks"}),0===H.length?(0,O.jsx)(c.A,{variant:"body1",align:"center",sx:{my:4},children:"No tasks available to set as starting points"}):(0,O.jsxs)(_e.A,{variant:"outlined",sx:{p:2},children:[(0,O.jsxs)(o.A,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2},children:[(0,O.jsx)(c.A,{variant:"subtitle2",color:"primary",children:"Select tasks to serve as starting points"}),(0,O.jsx)(o.A,{children:(0,O.jsxs)(c.A,{variant:"caption",sx:{ml:1},children:[H.length," total tasks across ",Array.from(new Set(H.map(e=>e.crewName))).length," crews"]})})]}),(0,O.jsx)(V.A,{placeholder:"Search tasks...",size:"small",fullWidth:!0,sx:{mb:2},InputProps:{startAdornment:(0,O.jsx)(ne.A,{position:"start",children:(0,O.jsx)(Ee.A,{fontSize:"small"})})},onChange:e=>{const t=e.target.value.toLowerCase();document.querySelectorAll("[data-task-item]").forEach(e=>{var n,a;const s=e,i=(null===(n=s.getAttribute("data-task-name"))||void 0===n?void 0:n.toLowerCase())||"",o=(null===(a=s.getAttribute("data-crew-name"))||void 0===a?void 0:a.toLowerCase())||"";i.includes(t)||o.includes(t)?s.style.display="":s.style.display="none"})}}),(0,O.jsxs)(o.A,{sx:{display:"flex",mb:2},children:[(0,O.jsxs)(c.A,{variant:"caption",color:"text.secondary",sx:{mr:2},children:["Total: ",H.length," tasks"]}),(0,O.jsxs)(c.A,{variant:"caption",color:"success.main",sx:{mr:2},children:["Selected: ",H.filter(e=>e.isStartPoint).length," tasks"]})]}),(0,O.jsx)(at.A,{children:Array.from(new Set(H.map(e=>e.crewName))).sort((e,t)=>e.localeCompare(t)).map(e=>{const t=H.filter(t=>t.crewName===e).sort((e,t)=>e.taskName.localeCompare(t.taskName));return(0,O.jsxs)(o.A,{sx:{mb:2},children:[(0,O.jsxs)(c.A,{variant:"subtitle2",sx:{bgcolor:"primary.light",color:"primary.contrastText",px:2,py:1,borderRadius:"4px 4px 0 0"},children:[e," (",t.length," tasks)"]}),(0,O.jsx)(_e.A,{variant:"outlined",sx:{borderRadius:"0 0 4px 4px",mt:"-1px"},children:t.map(e=>(0,O.jsx)(st.Ay,{sx:{borderBottom:"1px solid",borderColor:"divider",py:1},"data-task-item":"true","data-task-name":e.taskName,"data-crew-name":e.crewName,secondaryAction:(0,O.jsx)(Ht.A,{edge:"end",checked:!!e.isStartPoint,onChange:()=>{return t=e.taskId,void K(e=>e.map(e=>e.taskId===t?(0,a.A)((0,a.A)({},e),{},{isStartPoint:!e.isStartPoint}):e));var t},inputProps:{"aria-labelledby":"task-".concat(e.taskId)}}),children:(0,O.jsx)(ot.A,{id:"task-".concat(e.taskId),primary:(0,O.jsxs)(o.A,{sx:{display:"flex",alignItems:"center"},children:[(0,O.jsx)(ia.A,{fontSize:"small",sx:{mr:1,color:e.isStartPoint?"success.main":"text.disabled"}}),(0,O.jsx)(c.A,{variant:"body1",sx:{fontWeight:e.isStartPoint?500:400},children:e.taskName})]}),secondary:"ID: ".concat(e.taskId)})},e.taskId))})]},e)})})]})]})]}):(0,O.jsx)(c.A,{sx:{textAlign:"center",py:4},children:"No flow selected"})}),(0,O.jsx)(B.A,{sx:{p:2,borderTop:"1px solid",borderColor:"divider"},children:(0,O.jsxs)(o.A,{sx:{display:"flex",justifyContent:"space-between",width:"100%",alignItems:"center"},children:[(0,O.jsx)(o.A,{children:M&&(0,O.jsx)(c.A,{color:"error",variant:"body2",children:M})}),(0,O.jsxs)(o.A,{sx:{display:"flex",gap:1},children:[(0,O.jsx)(x.A,{onClick:A,color:"inherit",disabled:N,children:"Cancel"}),(0,O.jsx)(x.A,{onClick:async()=>{try{var e;P(!0),z(null);const t={id:(null===C||void 0===C||null===(e=C.flowConfig)||void 0===e?void 0:e.id)||"flow-".concat(Date.now()),name:_,type:"default",listeners:W.map(e=>(0,a.A)({id:e.id,name:e.name||"Listener ".concat(e.id),crewId:e.crewId,crewName:e.crewName,tasks:e.tasks||[],listenToTaskIds:e.listenToTaskIds||[],listenToTaskNames:e.listenToTaskNames||[],conditionType:e.conditionType||"NONE",state:e.state},"ROUTER"===e.conditionType&&e.routerConfig?{routerConfig:e.routerConfig}:{})),actions:G,startingPoints:H.filter(e=>e.isStartPoint)},n=null!==C&&void 0!==C&&C.nodes?oa(C.nodes):[],s={name:_,crew_id:(null===C||void 0===C?void 0:C.crew_id)||"",nodes:n,edges:(null===C||void 0===C?void 0:C.edges)||[],flowConfig:t};let i;if(y){const e=y.toString();i=await Wt.updateFlow(e,s)}else i=await Wt.saveFlow(s);F(!0),b(),setTimeout(()=>{A()},1e3)}catch(M){z(M instanceof Error?M.message:"An unknown error occurred while saving the flow.")}finally{P(!1)}},variant:"contained",color:"primary",disabled:N||!C||!_.trim(),children:N?(0,O.jsx)(ue.A,{size:24}):"Save"})]})]})})]}),(0,O.jsx)(h.A,{open:L,autoHideDuration:6e3,onClose:()=>F(!1),children:(0,O.jsx)(m.A,{onClose:()=>F(!1),severity:"success",sx:{width:"100%"},children:"Flow updated successfully!"})})]})};var ca=n(18844),ua=n(12406),ha=n(84707);const ma=["children","value","index"];function pa(e){const{children:t,value:n,index:i}=e,r=(0,s.A)(e,ma);return(0,O.jsx)("div",(0,a.A)((0,a.A)({role:"tabpanel",hidden:n!==i,id:"dialog-tabpanel-".concat(i),"aria-labelledby":"dialog-tab-".concat(i)},r),{},{children:n===i&&(0,O.jsx)(o.A,{sx:{pt:2},children:t})}))}const xa=e=>{let{open:t,onClose:n,onCrewSelect:s,onFlowSelect:h,onAgentSelect:p,onTaskSelect:g,initialTab:f=0,showOnlyTab:v}=e;const[A,y]=(0,i.useState)(f);(0,i.useEffect)(()=>{y(void 0!==v?v:f)},[v,f]);const[b,j]=(0,i.useState)([]),[w,k]=(0,i.useState)([]),[C,_]=(0,i.useState)([]),[E,I]=(0,i.useState)([]),[T,N]=(0,i.useState)([]),[M,z]=(0,i.useState)([]),[L,F]=(0,i.useState)(!1),[W,R]=(0,i.useState)(null),[U,H]=(0,i.useState)(null),K=(0,i.useRef)(null),[G,X]=(0,i.useState)("");(0,i.useEffect)(()=>{t||X("")},[t]);const[Z,$]=(0,i.useState)(!1),[ae,se]=(0,i.useState)(null),[ie,oe]=(0,i.useState)(0),re=(0,i.useRef)(null),le=(0,i.useRef)(null),de=(0,i.useRef)(null),he=(0,i.useRef)(null),{crewAIFlowEnabled:me}=(0,S.d)(),pe=(0,i.useRef)(null),xe=(0,i.useRef)(null),ge=(0,i.useRef)(null),ve=(0,i.useRef)(null),Ae=(0,i.useRef)(null);(0,i.useEffect)(()=>{t&&(0===A?ye():1===A?je():2===A?we():3===A&&me&&be())},[t,A,me]),(0,i.useEffect)(()=>{t||(N([]),z([]))},[t]),(0,i.useEffect)(()=>{me||3!==A||y(0)},[me,A]);const ye=async()=>{F(!0);try{const e=await We.getCrews();j(e),R(null)}catch(W){R("Failed to load crews")}finally{F(!1)}},be=async()=>{F(!0);try{const e=await Wt.getFlows();k(e),R(null)}catch(W){R("Failed to load flows")}finally{F(!1)}},je=async()=>{F(!0);try{const e=await fe.AgentService.listAgents();_(e),R(null)}catch(W){R("Failed to load agents")}finally{F(!1)}},we=async()=>{F(!0);try{const e=await Re.listTasks();I(e),R(null)}catch(W){R("Failed to load tasks")}finally{F(!1)}},ke=async e=>{F(!0),window.dispatchEvent(new CustomEvent("crewLoadStarted"));try{const C=await We.getCrew(e);if(!C)throw new Error("Crew not found");const S={};for(const e of C.nodes||[])if("agentNode"===e.type)try{var t,i,o,r;const n=e.data,a={name:n.name||n.label||"",role:n.role||"",goal:n.goal||"",backstory:n.backstory||"",llm:n.llm||"databricks-llama-4-maverick",tools:n.tools||[],function_calling_llm:n.function_calling_llm,max_iter:n.max_iter||25,max_rpm:n.max_rpm,max_execution_time:n.max_execution_time||300,memory:null===(t=n.memory)||void 0===t||t,verbose:n.verbose||!1,allow_delegation:n.allow_delegation||!1,cache:null===(i=n.cache)||void 0===i||i,system_template:n.system_template,prompt_template:n.prompt_template,response_template:n.response_template,allow_code_execution:n.allow_code_execution||!1,code_execution_mode:n.code_execution_mode||"safe",max_retry_limit:n.max_retry_limit||3,use_system_prompt:null===(o=n.use_system_prompt)||void 0===o||o,respect_context_window:null===(r=n.respect_context_window)||void 0===r||r,embedder_config:n.embedder_config,knowledge_sources:n.knowledge_sources||[]},s=await fe.AgentService.createAgent(a);if(!s||!s.id)throw new Error("Failed to create agent: ".concat(a.name));S[e.id]=s.id.toString()}catch(k){throw new Error("Failed to create agent: ".concat(k.message))}for(const e of C.nodes||[])if("taskNode"===e.type)try{var l,d,c,u,h,m,p,x,g,f,v,A,y,b,j,w;const t=e.data,n=t.agent_id&&S[t.agent_id]?parseInt(S[t.agent_id]):0,a={name:String(t.label||""),description:String(t.description||""),expected_output:String(t.expected_output||""),tools:(t.tools||[]).map(e=>String(e)),agent_id:n?String(n):null,async_execution:Boolean(t.async_execution),context:(t.context||[]).map(e=>String(e)),config:{cache_response:Boolean(null===(l=t.config)||void 0===l?void 0:l.cache_response),cache_ttl:Number((null===(d=t.config)||void 0===d?void 0:d.cache_ttl)||3600),retry_on_fail:Boolean(null===(c=t.config)||void 0===c?void 0:c.retry_on_fail),max_retries:Number((null===(u=t.config)||void 0===u?void 0:u.max_retries)||3),timeout:null!==(h=t.config)&&void 0!==h&&h.timeout?Number(t.config.timeout):null,priority:Number((null===(m=t.config)||void 0===m?void 0:m.priority)||1),error_handling:(null===(p=t.config)||void 0===p?void 0:p.error_handling)||"default",output_file:(null===(x=t.config)||void 0===x?void 0:x.output_file)||null,output_json:(null===(g=t.config)||void 0===g?void 0:g.output_json)||null,output_pydantic:(null===(f=t.config)||void 0===f?void 0:f.output_pydantic)||null,callback:(null===(v=t.config)||void 0===v?void 0:v.callback)||null,human_input:Boolean(null===(A=t.config)||void 0===A?void 0:A.human_input),condition:"is_data_missing"===(null===(y=t.config)||void 0===y?void 0:y.condition)?"is_data_missing":void 0,guardrail:(null===(b=t.config)||void 0===b?void 0:b.guardrail)||null,markdown:!0===(null===(j=t.config)||void 0===j?void 0:j.markdown)||"true"===(null===(w=t.config)||void 0===w?void 0:w.markdown)||!0===t.markdown||"true"===t.markdown}},s=await Re.createTask(a);if(!s||!s.id)throw new Error("Failed to create task: ".concat(a.name));S[e.id]=s.id.toString()}catch(k){throw new Error("Failed to create task: ".concat(k.message))}const _=(C.nodes||[]).map(e=>{const t="agentNode"===e.type?"agent-".concat(S[e.id]||e.id):"task-".concat(S[e.id]||e.id);return(0,a.A)((0,a.A)({},e),{},{id:t,type:e.type,data:(0,a.A)((0,a.A)({},e.data),{},{id:S[e.id]||e.data.id,agent_id:e.data.agent_id&&S[e.data.agent_id]||e.data.agent_id,agentId:"agentNode"===e.type&&S[e.id]||e.data.agentId,taskId:"taskNode"===e.type&&S[e.id]||e.data.taskId,type:"agentNode"===e.type?"agent":"task"})})}),E=(C.edges||[]).map(e=>{var t,n;const s=null===C||void 0===C||null===(t=C.nodes)||void 0===t?void 0:t.find(t=>t.id===e.source),i=null===C||void 0===C||null===(n=C.nodes)||void 0===n?void 0:n.find(t=>t.id===e.target);return(0,a.A)((0,a.A)({},e),{},{source:"agentNode"===(null===s||void 0===s?void 0:s.type)?"agent-".concat(S[e.source]||e.source):"task-".concat(S[e.source]||e.source),target:"agentNode"===(null===i||void 0===i?void 0:i.type)?"agent-".concat(S[e.target]||e.target):"task-".concat(S[e.target]||e.target)})});s(_,E,C.name,C.id.toString()),n(),setTimeout(()=>{if("undefined"!==typeof window){const e=new CustomEvent("fitViewToNodes",{bubbles:!0});window.dispatchEvent(e)}},100)}catch(k){R(k.message||"Failed to load crew")}finally{F(!1)}},Ce=async e=>{try{F(!0),R(null);const t=await Wt.getFlow(e);if(!t)throw new Error("Failed to load flow data from server");if(!Array.isArray(t.nodes)||!Array.isArray(t.edges))throw new Error("Invalid flow data structure");let a=t.flowConfig;if(!a&&t.nodes.some(e=>{var t;return null===(t=e.data)||void 0===t?void 0:t.listener})){const e=t.nodes.filter(e=>{var t;return null===(t=e.data)||void 0===t?void 0:t.listener}).map(e=>({id:"listener-".concat(e.id),name:e.data.label||"Listener ".concat(e.id),crewId:String(e.data.crewRef||""),crewName:e.data.crewName||e.data.label||"Unknown",tasks:e.data.listener.tasks||[],listenToTaskIds:e.data.listener.listenToTaskIds||[],listenToTaskNames:e.data.listener.listenToTaskNames||[],conditionType:e.data.listener.conditionType||"NONE",state:e.data.listener.state||{stateType:"unstructured",stateDefinition:"",stateData:{}}}));a={id:"flow-".concat(Date.now()),name:t.name,listeners:e,actions:[],startingPoints:[]}}a&&(a={id:a.id||"flow-".concat(Date.now()),name:a.name||t.name,listeners:a.listeners||[],actions:a.actions||[],startingPoints:a.startingPoints||[]}),h(t.nodes,t.edges,a),n(),setTimeout(()=>{if("undefined"!==typeof window){const e=new CustomEvent("fitViewToNodes",{bubbles:!0});window.dispatchEvent(e)}},100)}catch(t){R(t.message||"Failed to load flow")}finally{F(!1)}},Se=(e,t,n,a)=>{let s;switch(n){case"crew":s=b;break;case"flow":s=w;break;case"agent":s=C;break;case"task":s=E;break;default:s=[]}if("Enter"===e.key||" "===e.key)e.preventDefault(),"crew"===n?ke(t):Ce(t.toString());else if("ArrowRight"===e.key){e.preventDefault();const t=(a+1)%s.length,i=document.querySelector('[data-card-index="'.concat(n,"-").concat(t,'"]'));i&&i.focus()}else if("ArrowLeft"===e.key){e.preventDefault();const t=(a-1+s.length)%s.length,i=document.querySelector('[data-card-index="'.concat(n,"-").concat(t,'"]'));i&&i.focus()}else if("ArrowDown"===e.key||"ArrowUp"===e.key){e.preventDefault();const t=window.innerWidth;let i=1;t>=960?i=3:t>=600&&(i=2);const o=Math.floor(a/i),r=a%i;let l;if("ArrowDown"===e.key){l=(o+1)*i+r,l>=s.length&&(l=r)}else{const e=o-1;if(e<0){l=Math.floor((s.length-1)/i)*i+r,l>=s.length&&(l=s.length-1)}else l=e*i+r}if(l>=0&&l<s.length){const e=document.querySelector('[data-card-index="'.concat(n,"-").concat(l,'"]'));e&&e.focus()}}};return(0,O.jsxs)(O.Fragment,{children:[(0,O.jsxs)(r.A,{open:t,onClose:n,maxWidth:"md",fullWidth:!0,TransitionProps:{onEntered:()=>{setTimeout(()=>{K.current&&K.current.focus()},150)}},PaperProps:{component:"div",role:"dialog",tabIndex:-1},children:[(0,O.jsxs)(d.A,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,O.jsx)(o.A,{children:0===v?"Load Existing Plans":1===v?"Load Existing Agents":2===v?"Load Existing Tasks":3===v?"Load Existing Flows":"Open Catalog"}),(0,O.jsx)(u.A,{onClick:n,children:(0,O.jsx)(D.A,{})})]}),(0,O.jsxs)(l.A,{onKeyDown:e=>{document.activeElement instanceof HTMLInputElement||document.activeElement instanceof HTMLTextAreaElement||("/"===e.key&&K.current&&(e.preventDefault(),K.current.focus()),"f"===e.key&&(e.preventDefault(),0===A&&re.current?re.current.focus():1===A&&de.current?de.current.focus():2===A&&he.current?he.current.focus():3===A&&le.current&&le.current.focus()))},"data-tour":"catalog-dialog",children:[W&&(0,O.jsx)(m.A,{severity:"error",sx:{mb:2},children:W}),U&&(0,O.jsx)(m.A,{severity:"success",sx:{mb:2},children:U}),(0,O.jsxs)(o.A,{sx:{width:"100%"},children:[void 0===v?(0,O.jsx)(o.A,{sx:{borderBottom:1,borderColor:"divider"},children:(0,O.jsxs)(ea.A,{value:A,onChange:(e,t)=>{(3!==t||me)&&void 0===v&&(y(t),X(""))},"aria-label":"catalog tabs",children:[(0,O.jsx)(ta.A,{icon:(0,O.jsx)(J.A,{}),iconPosition:"start",label:"Plans (New Tab)",id:"plan-tab-0","aria-controls":"tabpanel-0",sx:{textTransform:"none"}}),(0,O.jsx)(ta.A,{icon:(0,O.jsx)(ca.A,{}),iconPosition:"start",label:"Agents",id:"agent-tab-1","aria-controls":"tabpanel-1",sx:{textTransform:"none"}}),(0,O.jsx)(ta.A,{icon:(0,O.jsx)(ua.A,{}),iconPosition:"start",label:"Tasks",id:"task-tab-2","aria-controls":"tabpanel-2",sx:{textTransform:"none"}}),me&&(0,O.jsx)(ta.A,{icon:(0,O.jsx)(aa.A,{}),iconPosition:"start",label:"Flows",id:"flow-tab-3","aria-controls":"tabpanel-3",sx:{textTransform:"none"}})]})}):null,(0,O.jsxs)(o.A,{sx:{py:1,display:"flex",justifyContent:"space-between"},children:[(0,O.jsx)(o.A,{sx:{flex:1},children:(0,O.jsx)(V.A,{placeholder:"Search...",size:"small",fullWidth:!0,value:G,onChange:e=>X(e.target.value),inputRef:K,autoComplete:"off",onKeyDown:e=>{"Tab"!==e.key||e.shiftKey?"Escape"===e.key&&X(""):(e.preventDefault(),0===A&&re.current?re.current.focus():1===A&&de.current?de.current.focus():2===A&&he.current?he.current.focus():3===A&&le.current&&le.current.focus())},InputProps:{startAdornment:(0,O.jsx)(ne.A,{position:"start",children:(0,O.jsx)(Ee.A,{fontSize:"small"})})}})}),void 0===v&&(0,O.jsx)(o.A,{sx:{ml:2,display:"flex",gap:1},children:0===A?(0,O.jsxs)(O.Fragment,{children:[(0,O.jsx)(x.A,{startIcon:(0,O.jsx)(sa.A,{}),variant:"outlined",size:"small",onClick:()=>{pe.current&&pe.current.click()},children:"Import"}),(0,O.jsx)(x.A,{startIcon:(0,O.jsx)(na.A,{}),variant:"outlined",size:"small",onClick:async()=>{try{F(!0),R(null);const e={crews:await We.getCrews(),exportDate:(new Date).toISOString()},t=new Blob([JSON.stringify(e,null,2)],{type:"application/json"}),n=URL.createObjectURL(t),a=document.createElement("a");a.href=n,a.download="all_crews_export_".concat((new Date).toISOString().slice(0,10),".json"),document.body.appendChild(a),a.click(),document.body.removeChild(a),URL.revokeObjectURL(n)}catch(W){R("Failed to export all crews")}finally{F(!1)}},disabled:0===b.length,children:"Export Plans"}),(0,O.jsx)(x.A,{startIcon:(0,O.jsx)(Q.A,{}),variant:"outlined",size:"small",onClick:()=>{ge.current&&ge.current.click()},children:"Import Everything"}),(0,O.jsx)(x.A,{startIcon:(0,O.jsx)(na.A,{}),variant:"outlined",size:"small",onClick:async()=>{try{F(!0),R(null);const e=await We.getCrews(),t=await Wt.getFlows(),n=await fe.AgentService.listAgents(),a={crews:e,flows:t,agents:n,tasks:await Re.listTasks(),exportDate:(new Date).toISOString()},s=new Blob([JSON.stringify(a,null,2)],{type:"application/json"}),i=URL.createObjectURL(s),o=document.createElement("a");o.href=i,o.download="complete_export_".concat((new Date).toISOString().slice(0,10),".json"),document.body.appendChild(o),o.click(),document.body.removeChild(o),URL.revokeObjectURL(i)}catch(W){R("Failed to export all data")}finally{F(!1)}},disabled:0===b.length&&0===w.length,children:"Export Everything"})]}):3===A?(0,O.jsxs)(O.Fragment,{children:[(0,O.jsx)(x.A,{startIcon:(0,O.jsx)(sa.A,{}),variant:"outlined",size:"small",onClick:()=>{xe.current&&xe.current.click()},children:"Import"}),(0,O.jsx)(x.A,{startIcon:(0,O.jsx)(na.A,{}),variant:"outlined",size:"small",onClick:async()=>{try{F(!0),R(null);const e={flows:await Wt.getFlows(),exportDate:(new Date).toISOString()},t=new Blob([JSON.stringify(e,null,2)],{type:"application/json"}),n=URL.createObjectURL(t),a=document.createElement("a");a.href=n,a.download="all_flows_export_".concat((new Date).toISOString().slice(0,10),".json"),document.body.appendChild(a),a.click(),document.body.removeChild(a),URL.revokeObjectURL(n)}catch(W){R("Failed to export all flows")}finally{F(!1)}},disabled:0===w.length,children:"Export Flows"})]}):null})]}),(void 0===v||0===v)&&(0,O.jsxs)(pa,{value:A,index:0,children:[void 0===v&&(0,O.jsx)(m.A,{severity:"info",sx:{mb:2},children:"Loading a plan will open it in a new tab"}),L?(0,O.jsx)(o.A,{sx:{display:"flex",justifyContent:"center",p:4},children:(0,O.jsx)(ue.A,{})}):0===b.length?(0,O.jsx)(m.A,{severity:"info",children:"No plans found. Create a plan by adding agents and tasks, then click Save Plan."}):(0,O.jsx)(ce.Ay,{container:!0,spacing:2,children:b.filter(e=>!(!me&&(e=>{var t;return(null===(t=e.nodes)||void 0===t?void 0:t.some(e=>"flowNode"===e.type))||!1})(e))&&(!G||e.name.toLowerCase().includes(G.toLowerCase()))).map((e,t)=>(0,O.jsx)(ce.Ay,{item:!0,xs:12,sm:6,md:4,children:(0,O.jsx)(ee.A,{sx:{height:"100%",cursor:"pointer","&:hover":{boxShadow:3,bgcolor:"action.hover"},"&:focus":{outline:"2px solid",outlineColor:"primary.main",boxShadow:6,bgcolor:"action.hover"},opacity:1,filter:"none",transition:"all 0.2s"},onClick:()=>ke(e.id),onKeyDown:n=>Se(n,e.id,"crew",t),tabIndex:0,ref:0===t?re:void 0,"data-card-index":"crew-".concat(t),children:(0,O.jsxs)(Xt.A,{children:[(0,O.jsxs)(o.A,{sx:{display:"flex",justifyContent:"space-between",alignItems:"flex-start"},children:[(0,O.jsx)(c.A,{variant:"h6",component:"h2",gutterBottom:!0,noWrap:!0,children:e.name}),(0,O.jsxs)(o.A,{children:[(0,O.jsx)(P.A,{title:"Export Plan",children:(0,O.jsx)(u.A,{size:"small",onClick:t=>(async(e,t)=>{e.stopPropagation();try{const e=JSON.stringify(t,null,2),n=new Blob([e],{type:"application/json"}),a=URL.createObjectURL(n),s=document.createElement("a");s.href=a,s.download="crew_".concat(t.name.replace(/\s+/g,"_").toLowerCase(),".json"),document.body.appendChild(s),s.click(),document.body.removeChild(s),URL.revokeObjectURL(a)}catch(W){R("Failed to export crew")}})(t,e),children:(0,O.jsx)(na.A,{fontSize:"small"})})}),(0,O.jsx)(P.A,{title:"Delete Plan",children:(0,O.jsx)(u.A,{size:"small",onClick:t=>(async(e,t)=>{e.stopPropagation();try{await We.deleteCrew(t),ye()}catch(W){R("Failed to delete crew")}})(t,e.id),children:(0,O.jsx)(q.A,{fontSize:"small"})})})]})]}),(0,O.jsx)(c.A,{variant:"body2",color:"text.secondary",sx:{mb:1},children:"No description"}),(0,O.jsxs)(c.A,{variant:"caption",color:"text.secondary",display:"block",children:["Created: ",new Date(e.created_at).toLocaleString()]}),(0,O.jsxs)(c.A,{variant:"caption",color:"text.secondary",display:"block",children:["Agents: ",(t=>{const n=(null===(t=e.nodes)||void 0===t?void 0:t.filter(e=>"agent"===e.type||"agentNode"===e.type||e.data&&("agent"===e.data.type||e.data.agentId||e.data.agentRef)||"string"===typeof e.id&&(e.id.startsWith("agent-")||e.id.startsWith("agent:"))).length)||0,a=e.agents&&Array.isArray(e.agents)?e.agents.length:0,s=e.agent_ids&&Array.isArray(e.agent_ids)?e.agent_ids.length:0;return Math.max(n,a,s)})()," / Tasks: ",(t=>{const n=(null===(t=e.nodes)||void 0===t?void 0:t.filter(e=>"task"===e.type||"taskNode"===e.type||e.data&&("task"===e.data.type||e.data.taskId||e.data.taskRef)||"string"===typeof e.id&&(e.id.includes("task")||e.id.includes("Task"))).length)||0,a=e.tasks&&Array.isArray(e.tasks)?e.tasks.length:0,s=e.task_ids&&Array.isArray(e.task_ids)?e.task_ids.length:0;return Math.max(n,a,s)})()]})]})})},e.id))})]}),(void 0===v||1===v)&&(0,O.jsxs)(pa,{value:A,index:1,children:[void 0===v&&(0,O.jsx)(m.A,{severity:"info",sx:{mb:2},children:"Loading agents will add them to the current tab"}),(0,O.jsxs)(o.A,{sx:{mb:2,display:"flex",gap:1,flexWrap:"wrap"},children:[(0,O.jsx)(x.A,{variant:"outlined",onClick:()=>{T.length===C.length?N([]):N([...C])},children:T.length===C.length?"Deselect All":"Select All"}),(0,O.jsxs)(x.A,{variant:"contained",onClick:()=>{p&&(p(T),N([]),n())},disabled:0===T.length,children:["Place Agents (",T.length,")"]}),(0,O.jsx)(x.A,{variant:"outlined",color:"error",onClick:async()=>{if(window.confirm("Are you sure you want to delete ALL agents? This action cannot be undone."))try{F(!0),R(null);for(const e of C)e.id&&await fe.AgentService.deleteAgent(e.id);_([]),N([]),await je()}catch(e){R("Failed to delete all agents"),await je()}finally{F(!1)}},disabled:0===C.length||L,startIcon:(0,O.jsx)(q.A,{}),children:"Delete All"}),(0,O.jsx)(x.A,{variant:"outlined",onClick:()=>{ve.current&&ve.current.click()},startIcon:(0,O.jsx)(Q.A,{}),children:"Import"}),(0,O.jsx)(x.A,{variant:"outlined",onClick:async()=>{try{F(!0),R(null);const e={agents:await fe.AgentService.listAgents(),exportedAt:(new Date).toISOString(),version:"1.0"},t=new Blob([JSON.stringify(e,null,2)],{type:"application/json"}),n=URL.createObjectURL(t),a=document.createElement("a");a.href=n,a.download="agents_export_".concat((new Date).toISOString().split("T")[0],".json"),document.body.appendChild(a),a.click(),document.body.removeChild(a),URL.revokeObjectURL(n)}catch(W){R("Failed to export agents")}finally{F(!1)}},disabled:0===C.length||L,startIcon:(0,O.jsx)(na.A,{}),children:"Export Agents"})]}),(0,O.jsx)(te.A,{sx:{my:2}}),L?(0,O.jsx)(o.A,{sx:{display:"flex",justifyContent:"center",p:4},children:(0,O.jsx)(ue.A,{})}):0===C.length?(0,O.jsx)(m.A,{severity:"info",children:"No agents found. Create agents to use in your crews."}):(0,O.jsx)(at.A,{sx:{maxHeight:"50vh",overflow:"auto"},children:C.filter(e=>!G||(e.name.toLowerCase().includes(G.toLowerCase())||e.role.toLowerCase().includes(G.toLowerCase()))).map(e=>(0,O.jsxs)(ha.A,{onClick:()=>(e=>{N(t=>t.some(t=>t.id===e.id)?t.filter(t=>t.id!==e.id):[...t,e])})(e),selected:T.some(t=>t.id===e.id),children:[(0,O.jsx)(it.A,{children:(0,O.jsx)(ca.A,{})}),(0,O.jsx)(ot.A,{primary:e.name,secondary:"".concat(e.role," - LLM: ").concat(e.llm)}),(0,O.jsx)(P.A,{title:"Delete Agent",children:(0,O.jsx)(u.A,{onClick:t=>(async(e,t)=>{e.stopPropagation();try{F(!0),await fe.AgentService.deleteAgent(t)&&(await je(),N(e=>e.filter(e=>e.id!==t)))}catch(W){R("Failed to delete agent")}finally{F(!1)}})(t,e.id||""),disabled:L,children:(0,O.jsx)(q.A,{})})})]},e.id))})]}),(void 0===v||2===v)&&(0,O.jsxs)(pa,{value:A,index:2,children:[void 0===v&&(0,O.jsx)(m.A,{severity:"info",sx:{mb:2},children:"Loading tasks will add them to the current tab"}),(0,O.jsxs)(o.A,{sx:{mb:2,display:"flex",gap:1,flexWrap:"wrap"},children:[(0,O.jsx)(x.A,{variant:"outlined",onClick:()=>{M.length===E.length?z([]):z([...E])},children:M.length===E.length?"Deselect All":"Select All"}),(0,O.jsxs)(x.A,{variant:"contained",onClick:()=>{g&&(g(M),z([]),n())},disabled:0===M.length,children:["Place Tasks (",M.length,")"]}),(0,O.jsx)(x.A,{variant:"outlined",color:"error",onClick:async()=>{if(window.confirm("Are you sure you want to delete ALL tasks? This action cannot be undone."))try{F(!0),R(null);for(const e of E)e.id&&await Re.deleteTask(e.id);I([]),z([]),await we()}catch(e){R("Failed to delete all tasks"),await we()}finally{F(!1)}},disabled:0===E.length||L,startIcon:(0,O.jsx)(q.A,{}),children:"Delete All"}),(0,O.jsx)(x.A,{variant:"outlined",onClick:()=>{Ae.current&&Ae.current.click()},startIcon:(0,O.jsx)(Q.A,{}),children:"Import"}),(0,O.jsx)(x.A,{variant:"outlined",onClick:async()=>{try{F(!0),R(null);const e={tasks:await Re.listTasks(),exportedAt:(new Date).toISOString(),version:"1.0"},t=new Blob([JSON.stringify(e,null,2)],{type:"application/json"}),n=URL.createObjectURL(t),a=document.createElement("a");a.href=n,a.download="tasks_export_".concat((new Date).toISOString().split("T")[0],".json"),document.body.appendChild(a),a.click(),document.body.removeChild(a),URL.revokeObjectURL(n)}catch(W){R("Failed to export tasks")}finally{F(!1)}},disabled:0===E.length||L,startIcon:(0,O.jsx)(na.A,{}),children:"Export Tasks"})]}),(0,O.jsx)(te.A,{sx:{my:2}}),L?(0,O.jsx)(o.A,{sx:{display:"flex",justifyContent:"center",p:4},children:(0,O.jsx)(ue.A,{})}):0===E.length?(0,O.jsx)(m.A,{severity:"info",children:"No tasks found. Create tasks to use in your crews."}):(0,O.jsx)(at.A,{sx:{maxHeight:"50vh",overflow:"auto"},children:E.filter(e=>!G||(e.name.toLowerCase().includes(G.toLowerCase())||e.description.toLowerCase().includes(G.toLowerCase()))).map(e=>(0,O.jsxs)(ha.A,{onClick:()=>(e=>{z(t=>t.some(t=>t.id===e.id)?t.filter(t=>t.id!==e.id):[...t,e])})(e),selected:M.some(t=>t.id===e.id),children:[(0,O.jsx)(it.A,{children:(0,O.jsx)(ua.A,{})}),(0,O.jsx)(ot.A,{primary:e.name,secondary:e.description}),(0,O.jsx)(P.A,{title:"Delete Task",children:(0,O.jsx)(u.A,{onClick:t=>(async(e,t)=>{e.stopPropagation();try{F(!0),await Re.deleteTask(t),await we(),z(e=>e.filter(e=>e.id!==t))}catch(W){R("Failed to delete task")}finally{F(!1)}})(t,e.id),disabled:L,children:(0,O.jsx)(q.A,{})})})]},e.id))})]}),me&&(void 0===v||3===v)&&(0,O.jsx)(pa,{value:A,index:3,children:L?(0,O.jsx)(o.A,{sx:{display:"flex",justifyContent:"center",p:4},children:(0,O.jsx)(ue.A,{})}):0===w.length?(0,O.jsx)(m.A,{severity:"info",children:"No flows found. Create a flow by adding flow components, then save it."}):(0,O.jsx)(ce.Ay,{container:!0,spacing:2,children:w.filter(e=>""===G||e.name.toLowerCase().includes(G.toLowerCase())).map((e,t)=>{var n,a;return(0,O.jsx)(ce.Ay,{item:!0,xs:12,sm:6,md:4,children:(0,O.jsx)(ee.A,{sx:{height:"100%",cursor:"pointer","&:hover":{boxShadow:3,bgcolor:"action.hover"},"&:focus":{outline:"2px solid",outlineColor:"primary.main",boxShadow:6,bgcolor:"action.hover"},opacity:1,filter:"none",transition:"all 0.2s"},onClick:()=>Ce(e.id.toString()),onKeyDown:n=>Se(n,e.id,"flow",t),tabIndex:0,ref:0===t?le:void 0,"data-card-index":"flow-".concat(t),children:(0,O.jsxs)(Xt.A,{children:[(0,O.jsxs)(o.A,{sx:{display:"flex",justifyContent:"space-between",alignItems:"flex-start"},children:[(0,O.jsx)(c.A,{variant:"h6",component:"h2",gutterBottom:!0,noWrap:!0,children:e.name}),(0,O.jsxs)(o.A,{children:[(0,O.jsx)(P.A,{title:"Edit Flow",children:(0,O.jsx)(u.A,{size:"small",onClick:t=>(async(e,t)=>{e.stopPropagation();try{se(t),$(!0)}catch(W){R("Failed to edit flow")}})(t,e.id.toString()),children:(0,O.jsx)(Y.A,{fontSize:"small"})})}),(0,O.jsx)(P.A,{title:"Export Flow",children:(0,O.jsx)(u.A,{size:"small",onClick:t=>(async(e,t)=>{e.stopPropagation();try{const e=JSON.stringify(t,null,2),n=new Blob([e],{type:"application/json"}),a=URL.createObjectURL(n),s=document.createElement("a");s.href=a,s.download="flow_".concat(t.name.replace(/\s+/g,"_").toLowerCase(),".json"),document.body.appendChild(s),s.click(),document.body.removeChild(s),URL.revokeObjectURL(a)}catch(W){R("Failed to export flow")}})(t,e),children:(0,O.jsx)(na.A,{fontSize:"small"})})}),(0,O.jsx)(P.A,{title:"Delete Flow",children:(0,O.jsx)(u.A,{size:"small",onClick:t=>(async(e,t)=>{e.stopPropagation();try{F(!0),await Wt.deleteFlow(t),be()}catch(W){R("Failed to delete flow")}finally{F(!1)}})(t,e.id.toString()),children:(0,O.jsx)(q.A,{fontSize:"small"})})})]})]}),(0,O.jsx)(c.A,{variant:"body2",color:"text.secondary",sx:{mb:1},children:"No description"}),(0,O.jsx)(c.A,{variant:"subtitle2",color:"text.primary",sx:{mt:1},children:"Crews:"}),(0,O.jsxs)(o.A,{sx:{mt:1,maxHeight:"80px",overflowY:"auto",border:"1px solid",borderColor:"divider",borderRadius:1,p:1,bgcolor:"background.default","&::-webkit-scrollbar":{width:"8px"},"&::-webkit-scrollbar-track":{backgroundColor:"background.paper"},"&::-webkit-scrollbar-thumb":{backgroundColor:"primary.light",borderRadius:"4px"}},children:[e.nodes&&Array.isArray(e.nodes)&&e.nodes.filter(e=>{var t;return"crewNode"===e.type||(null===(t=e.data)||void 0===t?void 0:t.crewName)}).map((t,n)=>{var a,s;const i=(null===(a=t.data)||void 0===a?void 0:a.crewName)||(null===(s=t.data)||void 0===s?void 0:s.label)||"Crew ".concat(n+1);return(0,O.jsxs)(c.A,{variant:"body2",sx:{py:.5,borderBottom:n<e.nodes.filter(e=>{var t;return"crewNode"===e.type||(null===(t=e.data)||void 0===t?void 0:t.crewName)}).length-1?"1px solid":"none",borderColor:"divider"},children:["\u2022 ",i]},t.id)}),(!e.nodes||!Array.isArray(e.nodes)||!e.nodes.some(e=>{var t;return"crewNode"===e.type||(null===(t=e.data)||void 0===t?void 0:t.crewName)}))&&(0,O.jsx)(c.A,{variant:"body2",color:"text.secondary",children:"No crews found"})]}),(0,O.jsxs)(c.A,{variant:"caption",color:"text.secondary",display:"block",sx:{mt:1},children:["Created: ",new Date(e.created_at).toLocaleString()]}),(0,O.jsxs)(c.A,{variant:"caption",color:"text.secondary",display:"block",children:["Components: ",(null===(n=e.nodes)||void 0===n?void 0:n.length)||0," / Connections: ",(null===(a=e.edges)||void 0===a?void 0:a.length)||0]})]})})},e.id)})})})]})]}),(0,O.jsx)(B.A,{children:(0,O.jsx)(x.A,{onClick:n,color:"primary",children:"Cancel"})})]}),ae&&(0,O.jsx)(da,{open:Z,onClose:()=>{$(!1),se(null)},flowId:ae,onSave:()=>{be()}}),(0,O.jsx)("input",{type:"file",ref:pe,style:{display:"none"},accept:".json",onChange:async e=>{if(e.target.files&&0!==e.target.files.length)try{F(!0),R(null),H(null);const t=e.target.files[0],n=await t.text(),a=JSON.parse(n);if(!a.name)throw new Error("Invalid crew data: missing name");await We.saveCrew({name:a.name,nodes:a.nodes||[],edges:a.edges||[],agent_ids:a.agent_ids||[],task_ids:a.task_ids||[]}),await ye(),H("Crew imported successfully"),e.target.value=""}catch(t){R("Failed to import crew: ".concat(t.message))}finally{F(!1)}}}),(0,O.jsx)("input",{type:"file",ref:xe,style:{display:"none"},accept:".json",onChange:async e=>{if(e.target.files&&0!==e.target.files.length)try{F(!0),R(null),H(null);const t=e.target.files[0],n=await t.text(),a=JSON.parse(n);if(!a.name)throw new Error("Invalid flow data: missing name");await Wt.saveFlow({name:a.name,crew_id:a.crew_id||0,nodes:a.nodes||[],edges:a.edges||[],flowConfig:a.flowConfig||a.flow_config}),await be(),H("Flow imported successfully"),e.target.value=""}catch(t){R("Failed to import flow: ".concat(t.message))}finally{F(!1)}}}),(0,O.jsx)("input",{type:"file",ref:ge,style:{display:"none"},accept:".json",onChange:async e=>{if(e.target.files&&0!==e.target.files.length)try{F(!0),R(null),H(null);const t=e.target.files[0],n=await t.text(),a=JSON.parse(n);if(!a.crews&&!a.flows&&!a.agents&&!a.tasks)throw new Error("Invalid import data: no valid data found");let s=0,i=0,o=0,r=0;if(Array.isArray(a.agents))for(const e of a.agents)e.name&&e.role&&(await fe.AgentService.createAgent({name:e.name,role:e.role,backstory:e.backstory||"",goal:e.goal||"",verbose:e.verbose||!1,allow_delegation:e.allow_delegation||!1,tools:e.tools||[],max_iter:e.max_iter||15,max_rpm:e.max_rpm||null,llm:e.llm||"",cache:void 0===e.cache||e.cache,allow_code_execution:e.allow_code_execution||!1,code_execution_mode:e.code_execution_mode||"safe"}),o++);if(Array.isArray(a.tasks))for(const e of a.tasks)e.description&&(await Re.createTask({name:e.name||e.description.slice(0,50),description:e.description,expected_output:e.expected_output||"",tools:e.tools||[],agent_id:e.agent_id||null,async_execution:e.async_execution||!1,context:e.context||null,config:e.config||{}}),r++);if(Array.isArray(a.crews))for(const e of a.crews)e.name&&(await We.saveCrew({name:e.name,nodes:e.nodes||[],edges:e.edges||[],agent_ids:e.agent_ids||[],task_ids:e.task_ids||[]}),s++);if(Array.isArray(a.flows))for(const e of a.flows)e.name&&(await Wt.saveFlow({name:e.name,crew_id:e.crew_id||0,nodes:e.nodes||[],edges:e.edges||[],flowConfig:e.flowConfig||e.flow_config}),i++);o>0&&await je(),r>0&&await we(),s>0&&await ye(),i>0&&await be();const l=[];o>0&&l.push("".concat(o," agents")),r>0&&l.push("".concat(r," tasks")),s>0&&l.push("".concat(s," crews")),i>0&&l.push("".concat(i," flows")),H("Import successful: ".concat(l.join(", ")," imported.")),e.target.value=""}catch(t){R("Failed to import: ".concat(t.message))}finally{F(!1)}}}),(0,O.jsx)("input",{type:"file",ref:ve,style:{display:"none"},accept:".json",onChange:async e=>{if(e.target.files&&0!==e.target.files.length)try{F(!0),R(null),H(null);const t=e.target.files[0],n=await t.text(),a=JSON.parse(n),s=a.agents||(a.name?[a]:[]);if(!Array.isArray(s)||0===s.length)throw new Error("Invalid agent data: no agents found in file");let i=0;for(const e of s)e.name&&e.role&&(await fe.AgentService.createAgent({name:e.name,role:e.role,backstory:e.backstory||"",goal:e.goal||"",verbose:e.verbose||!1,allow_delegation:e.allow_delegation||!1,tools:e.tools||[],max_iter:e.max_iter||15,max_rpm:e.max_rpm||null,llm:e.llm||"",cache:void 0===e.cache||e.cache,allow_code_execution:e.allow_code_execution||!1,code_execution_mode:e.code_execution_mode||"safe"}),i++);await je(),H("Successfully imported ".concat(i," agent(s)")),e.target.value=""}catch(t){R("Failed to import agents: ".concat(t.message))}finally{F(!1)}}}),(0,O.jsx)("input",{type:"file",ref:Ae,style:{display:"none"},accept:".json",onChange:async e=>{if(e.target.files&&0!==e.target.files.length)try{F(!0),R(null),H(null);const t=e.target.files[0],n=await t.text(),a=JSON.parse(n),s=a.tasks||(a.description?[a]:[]);if(!Array.isArray(s)||0===s.length)throw new Error("Invalid task data: no tasks found in file");let i=0;for(const e of s)e.description&&(await Re.createTask({name:e.name||e.description.slice(0,50),description:e.description,expected_output:e.expected_output||"",tools:e.tools||[],agent_id:e.agent_id||null,async_execution:e.async_execution||!1,context:e.context||null,config:e.config||{}}),i++);await we(),H("Successfully imported ".concat(i," task(s)")),e.target.value=""}catch(t){R("Failed to import tasks: ".concat(t.message))}finally{F(!1)}}})]})},ga={"databricks-llama-4-maverick":{name:"databricks-llama-4-maverick",temperature:.7,context_window:128e3,max_output_tokens:4096,enabled:!0}},fa=e=>{let{open:t,onClose:n,onSelectLLM:a,isUpdating:s=!1}=e;const[h,m]=(0,i.useState)(""),[p,g]=(0,i.useState)(ga),[f,v]=(0,i.useState)(!1),A=(0,i.useRef)(null);(0,i.useEffect)(()=>{if(t){(async()=>{v(!0);try{const e=ve.J.getInstance(),t=await e.getActiveModels();Object.keys(t).length>0&&g(t)}catch(e){try{const e=ve.J.getInstance().getActiveModelsSync();Object.keys(e).length>0&&g(e)}catch(t){}}finally{v(!1),setTimeout(()=>{A.current&&A.current.focus()},100)}})()}else m("")},[t]);const y=()=>f||0===Object.keys(p).length?"":h&&p[h]?h:"",b=()=>{m(""),n()},j=(0,i.useCallback)(()=>{h&&p[h]&&(a(h),m(""),n())},[h,a,p,n]),w=Object.keys(p);return(0,O.jsxs)(r.A,{open:t,onClose:b,maxWidth:"sm",fullWidth:!0,onKeyDown:e=>{"Enter"!==e.key||!h||s||f||(e.preventDefault(),j())},children:[(0,O.jsxs)(d.A,{children:[(0,O.jsx)(c.A,{variant:"h6",component:"div",children:"Select LLM"}),(0,O.jsx)(u.A,{"aria-label":"close",onClick:b,sx:{position:"absolute",right:8,top:8},children:(0,O.jsx)(D.A,{})})]}),(0,O.jsx)(te.A,{}),(0,O.jsx)(l.A,{children:(0,O.jsx)(o.A,{sx:{mt:2},children:f?(0,O.jsx)(o.A,{display:"flex",justifyContent:"center",alignItems:"center",py:4,children:(0,O.jsx)(ue.A,{})}):(0,O.jsxs)(oe.A,{fullWidth:!0,children:[(0,O.jsx)(re.A,{children:"Select Model"}),(0,O.jsx)(le.A,{value:y(),onChange:e=>{m(e.target.value)},label:"Select Model",inputRef:A,children:0===Object.keys(p).length?(0,O.jsx)(de.A,{value:"",children:"No models available"}):w.map(e=>(0,O.jsx)(de.A,{value:e,children:(0,O.jsxs)(o.A,{display:"flex",justifyContent:"space-between",width:"100%",children:[(0,O.jsx)(c.A,{children:p[e].name}),(0,O.jsx)(c.A,{variant:"caption",color:"text.secondary",children:p[e].provider})]})},e))})]})})}),(0,O.jsxs)(B.A,{children:[(0,O.jsx)(x.A,{onClick:b,children:"Cancel"}),(0,O.jsx)(x.A,{onClick:j,color:"primary",disabled:!y()||s||f,children:s?(0,O.jsx)(ue.A,{size:24}):"Select"})]})]})},va=[{value:"1",label:"1 RPM"},{value:"3",label:"3 RPM"},{value:"10",label:"10 RPM"},{value:"20",label:"20 RPM"},{value:"30",label:"30 RPM"},{value:"40",label:"40 RPM"},{value:"50",label:"50 RPM"},{value:"60",label:"60 RPM (1 request per second)"},{value:"120",label:"120 RPM (2 requests per second)"},{value:"300",label:"300 RPM (5 requests per second)"},{value:"600",label:"600 RPM (10 requests per second)"},{value:"1200",label:"1200 RPM (20 requests per second)"}],Aa=e=>{let{open:t,onClose:n,onSelectMaxRPM:a,isUpdating:s=!1}=e;const[h,m]=(0,i.useState)(""),p=(0,i.useCallback)(()=>{m(""),n()},[n]),g=(0,i.useCallback)(()=>{h&&(a(h),p())},[h,a,p]);return(0,O.jsxs)(r.A,{open:t,onClose:p,maxWidth:"sm",fullWidth:!0,onKeyDown:e=>{"Enter"===e.key&&h&&!s&&(e.preventDefault(),g())},PaperComponent:_e.A,children:[(0,O.jsxs)(d.A,{children:["Set Max RPM for All Agents",(0,O.jsx)(u.A,{"aria-label":"close",onClick:p,sx:{position:"absolute",right:8,top:8},children:(0,O.jsx)(D.A,{})})]}),(0,O.jsxs)(l.A,{sx:{pb:1},children:[(0,O.jsx)(c.A,{variant:"body2",sx:{mb:2},children:"Select a Max RPM (Requests Per Minute) value to apply to all agents on the canvas. Press Enter to apply."}),(0,O.jsx)(te.A,{sx:{my:2}}),(0,O.jsxs)(oe.A,{fullWidth:!0,sx:{my:2},children:[(0,O.jsx)(re.A,{id:"max-rpm-select-label",children:"Max RPM"}),(0,O.jsx)(le.A,{labelId:"max-rpm-select-label",id:"max-rpm-select",value:h,onChange:e=>{m(e.target.value)},label:"Max RPM",autoFocus:!0,children:va.map(e=>(0,O.jsx)(de.A,{value:e.value,children:(0,O.jsxs)(o.A,{children:[(0,O.jsx)(c.A,{variant:"body1",children:e.label}),(0,O.jsx)(c.A,{variant:"caption",color:"textSecondary",children:"Maximum requests per minute limit"})]})},e.value))})]})]}),(0,O.jsxs)(B.A,{sx:{px:3,py:2},children:[(0,O.jsx)(x.A,{onClick:p,children:"Cancel"}),(0,O.jsxs)(o.A,{sx:{position:"relative"},children:[(0,O.jsx)(x.A,{variant:"contained",onClick:g,disabled:!h||s,children:"Apply to All Agents"}),s&&(0,O.jsx)(ue.A,{size:24,sx:{position:"absolute",top:"50%",left:"50%",marginTop:"-12px",marginLeft:"-12px"}})]})]})]})},ya=e=>{let{open:t,onClose:n,onSelectTools:a,isUpdating:s=!1,selectedNodes:h=[]}=e;const[m,p]=(0,i.useState)([]),[g,f]=(0,i.useState)([]),[v,A]=(0,i.useState)(!1),[y,b]=(0,i.useState)(""),[j,w]=(0,i.useState)(-1),[k,C]=(0,i.useState)("all"),[S,_]=(0,i.useState)([]),[E,I]=(0,i.useState)([]),[T,N]=(0,i.useState)([]),P=(0,i.useRef)(null),M=(0,i.useRef)(null),z=(0,i.useMemo)(()=>({agents:h.filter(e=>"agentNode"===e.type).map(e=>({id:e.id,label:e.data.label,type:"agent"})),tasks:h.filter(e=>"taskNode"===e.type).map(e=>({id:e.id,label:e.data.label,type:"task"}))}),[h]),L=m.filter(e=>!1!==e.enabled).filter(e=>e.title.toLowerCase().includes(y.toLowerCase())||e.description.toLowerCase().includes(y.toLowerCase()));(0,i.useEffect)(()=>{t&&(F(),W(),b(""),w(-1),C("all"),_([]),setTimeout(()=>{var e;return null===(e=P.current)||void 0===e?void 0:e.focus()},100))},[t]);const F=async()=>{A(!0);try{const e=await gt.m.listTools();p(e)}catch(e){}finally{A(!1)}},W=async()=>{try{const[e,t]=await Promise.all([fe.AgentService.listAgents(),Re.listTasks()]);I(e.map(e=>{var t;return{id:(null===(t=e.id)||void 0===t?void 0:t.toString())||"",label:e.name,type:"agent"}})),N(t.map(e=>{var t;return{id:(null===(t=e.id)||void 0===t?void 0:t.toString())||"",label:e.name,type:"task"}}))}catch(e){}},R=e=>{const t=String(e.id);f(e=>e.includes(t)?e.filter(e=>e!==t):[...e,t])},U=(0,i.useCallback)(()=>{f([]),n()},[n]),H=e=>{_(t=>t.some(t=>t.id===e.id)?t.filter(t=>t.id!==e.id):[...t,e])},K=(0,i.useCallback)(()=>{if(g.length>0){let e;e="all"===k?[...E.map(e=>e.id),...T.map(e=>e.id)]:"all_agents"===k?E.map(e=>e.id):"all_tasks"===k?T.map(e=>e.id):S.map(e=>e.id),a(g,e),U()}},[g,a,U,k,S,E,T]);return(0,O.jsxs)(r.A,{open:t,onClose:U,maxWidth:"sm",fullWidth:!0,PaperComponent:_e.A,children:[(0,O.jsx)(d.A,{sx:{pb:1},children:(0,O.jsxs)(o.A,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,O.jsx)(c.A,{variant:"h6",children:"Select Tools"}),(0,O.jsx)(u.A,{onClick:U,size:"small",children:(0,O.jsx)(D.A,{})})]})}),(0,O.jsxs)(l.A,{sx:{pb:1},children:[(0,O.jsx)(oe.A,{fullWidth:!0,sx:{mb:2},children:(0,O.jsxs)(le.A,{value:Array.isArray(k)?k[0]:k,onChange:e=>{const t=e.target.value;if("all"===t)C("all"),_([]);else if("all_agents"===t)C("all_agents"),_(z.agents);else if("all_tasks"===t)C("all_tasks"),_(z.tasks);else if("selected"===t)C("selected"),_([]);else if(t.startsWith("agent_")){const e=t.replace("agent_",""),n=z.agents.find(t=>t.id===e);n&&(C([e]),_([n]))}else if(t.startsWith("task_")){const e=t.replace("task_",""),n=z.tasks.find(t=>t.id===e);n&&(C([e]),_([n]))}},size:"small",displayEmpty:!0,sx:{"& .MuiSelect-select":{display:"flex",alignItems:"center"}},children:[(0,O.jsx)(de.A,{value:"all",children:"All Agents & Tasks"}),(0,O.jsxs)(de.A,{value:"all_agents",disabled:0===z.agents.length,children:["All Agents (",z.agents.length,")"]}),(0,O.jsxs)(de.A,{value:"all_tasks",disabled:0===z.tasks.length,children:["All Tasks (",z.tasks.length,")"]}),(0,O.jsxs)(de.A,{value:"selected",disabled:0===h.length,children:["Selected (",h.length," ",1===h.length?"Node":"Nodes",")"]}),z.agents.length>0&&(0,O.jsx)(de.A,{value:"individual_agents",disabled:!0,children:(0,O.jsx)(c.A,{variant:"caption",color:"text.secondary",children:"Individual Agents:"})}),z.agents.map(e=>(0,O.jsx)(de.A,{value:"agent_".concat(e.id),sx:{pl:3},children:e.label},"agent_".concat(e.id))),z.tasks.length>0&&(0,O.jsx)(de.A,{value:"individual_tasks",disabled:!0,children:(0,O.jsx)(c.A,{variant:"caption",color:"text.secondary",children:"Individual Tasks:"})}),z.tasks.map(e=>(0,O.jsx)(de.A,{value:"task_".concat(e.id),sx:{pl:3},children:e.label},"task_".concat(e.id)))]})}),"selected"===k&&(0,O.jsxs)(o.A,{sx:{mb:2,maxHeight:"150px",overflow:"auto"},children:[(0,O.jsx)(c.A,{variant:"subtitle2",sx:{mb:1},children:"Select Nodes:"}),z.agents.length>0&&(0,O.jsxs)(o.A,{sx:{mb:1},children:[(0,O.jsx)(c.A,{variant:"caption",color:"text.secondary",children:"Agents:"}),z.agents.map(e=>(0,O.jsxs)(o.A,{onClick:()=>H(e),sx:{display:"flex",alignItems:"center",p:1,cursor:"pointer",borderRadius:1,bgcolor:S.some(t=>t.id===e.id)?"action.selected":"transparent","&:hover":{bgcolor:"action.hover"}},children:[(0,O.jsx)(Ht.A,{size:"small",checked:S.some(t=>t.id===e.id),onChange:()=>H(e)}),(0,O.jsx)(c.A,{variant:"body2",children:e.label})]},e.id))]}),z.tasks.length>0&&(0,O.jsxs)(o.A,{children:[(0,O.jsx)(c.A,{variant:"caption",color:"text.secondary",children:"Tasks:"}),z.tasks.map(e=>(0,O.jsxs)(o.A,{onClick:()=>H(e),sx:{display:"flex",alignItems:"center",p:1,cursor:"pointer",borderRadius:1,bgcolor:S.some(t=>t.id===e.id)?"action.selected":"transparent","&:hover":{bgcolor:"action.hover"}},children:[(0,O.jsx)(Ht.A,{size:"small",checked:S.some(t=>t.id===e.id),onChange:()=>H(e)}),(0,O.jsx)(c.A,{variant:"body2",children:e.label})]},e.id))]})]}),(0,O.jsx)(V.A,{inputRef:P,fullWidth:!0,placeholder:"Search tools... (\u2191\u2193 to navigate, Space/Enter to select)",value:y,onChange:e=>{b(e.target.value),w(0)},onKeyDown:e=>{const t=L.length;switch(e.key){case"ArrowDown":e.preventDefault(),w(e=>(e+1)%t);break;case"ArrowUp":e.preventDefault(),w(e=>(e-1+t)%t);break;case" ":case"Enter":e.preventDefault(),j>=0&&j<t&&R(L[j])}},margin:"normal",variant:"outlined",size:"small",InputProps:{startAdornment:(0,O.jsx)(ne.A,{position:"start",children:(0,O.jsx)(Ee.A,{})})},sx:{mb:2}}),v?(0,O.jsx)(o.A,{sx:{display:"flex",justifyContent:"center",p:3},children:(0,O.jsx)(ue.A,{size:24})}):(0,O.jsx)(oe.A,{component:"fieldset",fullWidth:!0,children:(0,O.jsx)(at.A,{ref:M,dense:!0,sx:{maxHeight:"300px",overflow:"auto","& .Mui-selected":{backgroundColor:e=>"rgba(".concat(e.palette.primary.main,", 0.1)")}},children:L.map((e,t)=>(0,O.jsx)(st.Ay,{disablePadding:!0,dense:!0,children:(0,O.jsxs)(ha.A,{selected:t===j,onClick:()=>R(e),sx:{borderRadius:1,mb:.5,"&.Mui-selected":{bgcolor:e=>"rgba(".concat(e.palette.primary.main,", 0.1)")}},children:[(0,O.jsx)(it.A,{children:(0,O.jsx)(Ht.A,{edge:"start",checked:g.includes(String(e.id)),tabIndex:-1,disableRipple:!0})}),(0,O.jsx)(ot.A,{primary:e.title,secondary:e.description,primaryTypographyProps:{variant:"body2",fontWeight:g.includes(String(e.id))?"bold":"normal"},secondaryTypographyProps:{variant:"caption",color:"textSecondary"}})]})},e.id))})})]}),(0,O.jsxs)(B.A,{sx:{px:3,py:2},children:[(0,O.jsx)(x.A,{onClick:U,children:"Cancel"}),(0,O.jsxs)(o.A,{sx:{position:"relative"},children:[(0,O.jsx)(x.A,{variant:"contained",onClick:K,disabled:0===g.length||s,children:"Apply Tools"}),s&&(0,O.jsx)(ue.A,{size:24,sx:{position:"absolute",top:"50%",left:"50%",marginTop:"-12px",marginLeft:"-12px"}})]})]})]})};var ba=n(68926),ja=n(61188);const wa=["api_key"],ka={id:"",name:"Default MCP Server",enabled:!1,global_enabled:!1,server_url:"",api_key:"",server_type:"streamable",auth_type:"api_key",timeout_seconds:30,max_retries:3,rate_limit:60,command:"",args:[],additional_config:{}},Ca={servers:[],global_enabled:!1},Sa=e=>{var t,n;let{open:h,onClose:p,server:g,onSave:f,isNew:v=!1}=e;const{t:A}=(0,y.Bd)(),[b,j]=(0,i.useState)(g),[w,k]=(0,i.useState)(""),[C,S]=(0,i.useState)(!1),[_,E]=(0,i.useState)({tested:!1,success:!1,message:""});if((0,i.useEffect)(()=>{(j(g),g)&&k(g.api_key||"");E({tested:!1,success:!1,message:""})},[g,v]),!b)return null;const I=e=>t=>{const n=t.target.value;j(t=>t?(0,a.A)((0,a.A)({},t),{},{[e]:n}):null)},T=e=>t=>{const n=t.target.value;j(t=>t?(0,a.A)((0,a.A)({},t),{},{[e]:n}):null)},N=e=>(t,n)=>{j(t=>t?(0,a.A)((0,a.A)({},t),{},{[e]:n}):null)};return(0,O.jsxs)(r.A,{open:h,onClose:p,fullWidth:!0,maxWidth:"md",PaperProps:{sx:{borderRadius:2,boxShadow:"0 8px 32px rgba(0,0,0,0.12)"}},children:[(0,O.jsxs)(d.A,{sx:{borderBottom:"1px solid",borderColor:"divider",p:3,display:"flex",alignItems:"center",justifyContent:"space-between"},children:[(0,O.jsxs)(o.A,{sx:{display:"flex",alignItems:"center"},children:[(0,O.jsx)(ba.A,{sx:{mr:1.5,color:"primary.main",fontSize:"1.5rem"}}),(0,O.jsx)(c.A,{variant:"h5",children:v?A("configuration.mcp.addServer",{defaultValue:"Add MCP Server"}):A("configuration.mcp.editServer",{defaultValue:"Edit MCP Server"})})]}),(0,O.jsx)(u.A,{onClick:p,children:(0,O.jsx)(D.A,{})})]}),(0,O.jsxs)(l.A,{sx:{p:3},children:[(0,O.jsxs)(ce.Ay,{container:!0,spacing:3,sx:{mt:.5},children:[(0,O.jsx)(ce.Ay,{item:!0,xs:12,children:(0,O.jsx)(V.A,{label:A("configuration.mcp.serverName",{defaultValue:"Server Name"}),value:b.name,onChange:I("name"),fullWidth:!0,required:!0,sx:{"& .MuiOutlinedInput-root":{borderRadius:1.5}}})}),(0,O.jsx)(ce.Ay,{item:!0,xs:12,md:9,children:(0,O.jsx)(V.A,{label:A("configuration.mcp.serverUrl",{defaultValue:"Server URL"}),value:b.server_url,onChange:I("server_url"),fullWidth:!0,required:!0,helperText:A("configuration.mcp.serverUrlHelp",{defaultValue:"Full URL of the MCP server endpoint"}),sx:{"& .MuiOutlinedInput-root":{borderRadius:1.5}}})}),(0,O.jsx)(ce.Ay,{item:!0,xs:12,md:3,children:(0,O.jsxs)(oe.A,{fullWidth:!0,children:[(0,O.jsx)(re.A,{id:"server-type-label",children:"Server Type"}),(0,O.jsx)(le.A,{labelId:"server-type-label",value:b.server_type||"streamable",label:"Server Type",onChange:T("server_type"),children:(0,O.jsx)(de.A,{value:"streamable",children:"Streamable HTTP"})})]})}),"streamable"===b.server_type&&(0,O.jsx)(ce.Ay,{item:!0,xs:12,md:6,children:(0,O.jsxs)(oe.A,{fullWidth:!0,children:[(0,O.jsx)(re.A,{id:"auth-type-label",children:"Authentication Type"}),(0,O.jsxs)(le.A,{labelId:"auth-type-label",value:b.auth_type||"api_key",label:"Authentication Type",onChange:T("auth_type"),children:[(0,O.jsx)(de.A,{value:"api_key",children:"API Key"}),(0,O.jsx)(de.A,{value:"databricks_obo",children:"Databricks OBO"})]})]})}),"streamable"===b.server_type&&"databricks_obo"!==b.auth_type&&(0,O.jsx)(ce.Ay,{item:!0,xs:12,md:"databricks_obo"===b.auth_type?12:6,children:(0,O.jsx)(V.A,{label:A("configuration.mcp.apiKey",{defaultValue:"API Key"}),value:b.api_key,onChange:I("api_key"),fullWidth:!0,type:"password",required:!0,helperText:A("configuration.mcp.apiKeyHelp",{defaultValue:"Authentication key for the MCP server"}),sx:{"& .MuiOutlinedInput-root":{borderRadius:1.5}}})}),"streamable"===b.server_type&&(0,O.jsx)(ce.Ay,{item:!0,xs:12,children:(0,O.jsx)(V.A,{label:A("configuration.mcp.sessionId",{defaultValue:"Session ID (Optional)"}),value:b.session_id||"",onChange:I("session_id"),fullWidth:!0,helperText:A("configuration.mcp.sessionIdHelp",{defaultValue:"Optional session ID for maintaining state across requests. Leave empty for stateless connections."}),sx:{"& .MuiOutlinedInput-root":{borderRadius:1.5}}})}),(0,O.jsx)(ce.Ay,{item:!0,xs:12,children:(0,O.jsx)(c.A,{variant:"subtitle2",gutterBottom:!0,children:A("configuration.mcp.advanced",{defaultValue:"Advanced Settings"})})}),(0,O.jsxs)(ce.Ay,{item:!0,xs:12,md:6,children:[(0,O.jsxs)(o.A,{sx:{display:"flex",alignItems:"center",mb:1},children:[(0,O.jsx)(c.A,{variant:"body2",children:A("configuration.mcp.timeout",{defaultValue:"Timeout (seconds)"})}),(0,O.jsx)(P.A,{title:A("configuration.mcp.timeoutHelp",{defaultValue:"Maximum time to wait for server response"}),children:(0,O.jsx)(Oe.A,{fontSize:"small",sx:{ml:1,color:"text.secondary",fontSize:"0.9rem"}})})]}),(0,O.jsx)(ja.Ay,{value:b.timeout_seconds,onChange:N("timeout_seconds"),min:5,max:120,step:5,marks:[{value:5,label:"5s"},{value:30,label:"30s"},{value:60,label:"60s"},{value:120,label:"120s"}],valueLabelDisplay:"auto"})]}),(0,O.jsxs)(ce.Ay,{item:!0,xs:12,md:6,children:[(0,O.jsxs)(o.A,{sx:{display:"flex",alignItems:"center",mb:1},children:[(0,O.jsx)(c.A,{variant:"body2",children:A("configuration.mcp.maxRetries",{defaultValue:"Max Retries"})}),(0,O.jsx)(P.A,{title:A("configuration.mcp.maxRetriesHelp",{defaultValue:"Number of retry attempts on failure"}),children:(0,O.jsx)(Oe.A,{fontSize:"small",sx:{ml:1,color:"text.secondary",fontSize:"0.9rem"}})})]}),(0,O.jsx)(ja.Ay,{value:b.max_retries,onChange:N("max_retries"),min:0,max:10,step:1,marks:[{value:0,label:"0"},{value:3,label:"3"},{value:5,label:"5"},{value:10,label:"10"}],valueLabelDisplay:"auto"})]}),(0,O.jsxs)(ce.Ay,{item:!0,xs:12,md:6,children:[(0,O.jsxs)(o.A,{sx:{display:"flex",alignItems:"center",mb:1},children:[(0,O.jsx)(c.A,{variant:"body2",children:A("configuration.mcp.rateLimit",{defaultValue:"Rate Limit (RPM)"})}),(0,O.jsx)(P.A,{title:A("configuration.mcp.rateLimitHelp",{defaultValue:"Maximum requests per minute to the MCP server"}),children:(0,O.jsx)(Oe.A,{fontSize:"small",sx:{ml:1,color:"text.secondary",fontSize:"0.9rem"}})})]}),(0,O.jsx)(ja.Ay,{value:b.rate_limit,onChange:N("rate_limit"),min:10,max:600,step:10,marks:[{value:10,label:"10"},{value:60,label:"60"},{value:300,label:"300"},{value:600,label:"600"}],valueLabelDisplay:"auto"})]})]}),_.tested&&(0,O.jsx)(o.A,{sx:{mt:2},children:(0,O.jsx)(m.A,{severity:_.success?"success":"error",icon:_.success?(0,O.jsx)(rt.A,{}):(0,O.jsx)(bt.A,{}),children:_.message})})]}),(0,O.jsxs)(B.A,{sx:{p:3,pt:1,display:"flex",justifyContent:"space-between"},children:[(0,O.jsx)(x.A,{onClick:async()=>{if(b){S(!0),E({tested:!1,success:!1,message:""});try{const e=tt.getInstance(),t=await e.testConnection(b);E({tested:!0,success:t.success,message:t.message})}catch(e){E({tested:!0,success:!1,message:e instanceof Error?e.message:"Connection test failed"})}finally{S(!1)}}},disabled:C||!(null!==(t=b.server_url)&&void 0!==t&&t.trim())||"streamable"===b.server_type&&"databricks_obo"!==b.auth_type&&!(null!==(n=b.api_key)&&void 0!==n&&n.trim()),startIcon:C?(0,O.jsx)(ue.A,{size:16}):(0,O.jsx)(ba.A,{}),children:C?A("configuration.mcp.testingConnection",{defaultValue:"Testing..."}):A("configuration.mcp.testConnection",{defaultValue:"Test Connection"})}),(0,O.jsxs)(o.A,{children:[(0,O.jsx)(x.A,{onClick:p,color:"inherit",sx:{mr:1},children:A("common.cancel",{defaultValue:"Cancel"})}),(0,O.jsx)(x.A,{onClick:()=>{if(b){const e=(0,a.A)({},b);if(!v&&b.api_key===w){const{api_key:t}=e,n=(0,s.A)(e,wa);Object.assign(e,n)}f(e),p()}},variant:"contained",color:"primary",children:A("common.save",{defaultValue:"Save"})})]})]})]})},_a=()=>{const{t:e}=(0,y.Bd)(),[t,n]=(0,i.useState)(Ca),[s,r]=(0,i.useState)(!1),[l,d]=(0,i.useState)(null),[p,g]=(0,i.useState)(!1),[f,v]=(0,i.useState)({message:"",open:!1,severity:"success"}),[A,b]=(0,i.useState)(!1),j=async()=>{b(!0);try{const t=tt.getInstance(),s=await t.getMcpServers();n(e=>(0,a.A)((0,a.A)({},e),{},{servers:s.servers||[]}));try{const e=await t.getGlobalSettings();n(t=>(0,a.A)((0,a.A)({},t),{},{global_enabled:e.global_enabled}))}catch(e){}}catch(e){v({open:!0,message:e instanceof Error?e.message:"Failed to load MCP servers",severity:"error"})}finally{b(!1)}};(0,i.useEffect)(()=>{j()},[]);const w=e=>async t=>{try{const t=tt.getInstance();await t.toggleMcpServerGlobalEnabled(e),await j(),v({open:!0,message:"MCP server global setting updated successfully",severity:"success"})}catch(n){v({open:!0,message:n instanceof Error?n.message:"Failed to toggle server global setting",severity:"error"})}};return(0,O.jsxs)(o.A,{children:[(0,O.jsxs)(o.A,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",mb:3},children:[(0,O.jsxs)(o.A,{sx:{display:"flex",alignItems:"center"},children:[(0,O.jsx)(ba.A,{sx:{mr:1.5,color:"primary.main",fontSize:"1.4rem"}}),(0,O.jsx)(c.A,{variant:"h6",children:e("configuration.mcp.title",{defaultValue:"MCP Server Configuration"})}),A&&(0,O.jsx)(ue.A,{size:20,sx:{ml:2}})]}),(0,O.jsx)(he.A,{control:(0,O.jsx)(me.A,{checked:t.global_enabled,onChange:async e=>{const t=e.target.checked;n(e=>(0,a.A)((0,a.A)({},e),{},{global_enabled:t}));try{const e=tt.getInstance();await e.updateGlobalSettings({global_enabled:t})}catch(s){n(e=>(0,a.A)((0,a.A)({},e),{},{global_enabled:!t})),v({open:!0,message:s instanceof Error?s.message:"Failed to update global MCP settings",severity:"error"})}},color:"primary"}),label:e("configuration.mcp.globalEnable",{defaultValue:"Enable MCP Servers"})})]}),t.global_enabled&&(0,O.jsx)(m.A,{severity:"info",sx:{mb:3},children:(0,O.jsxs)(c.A,{variant:"body2",children:[(0,O.jsx)("strong",{children:"Three-Tier MCP Configuration:"}),(0,O.jsx)("br",{}),"\u2022 ",(0,O.jsx)("strong",{children:"Global servers"})," (marked with GLOBAL chip) are available to all agents and tasks",(0,O.jsx)("br",{}),"\u2022 ",(0,O.jsx)("strong",{children:"Agent-level servers"})," can be selected in Agent Forms for specific agents",(0,O.jsx)("br",{}),"\u2022 ",(0,O.jsx)("strong",{children:"Task-level servers"})," can be selected in Task Forms for specific tasks (highest priority)"]})}),(0,O.jsxs)(_e.A,{variant:"outlined",sx:{p:3,mb:3,bgcolor:"background.paper",borderRadius:2},children:[(0,O.jsxs)(o.A,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2},children:[(0,O.jsx)(c.A,{variant:"subtitle1",fontWeight:"medium",children:e("configuration.mcp.servers",{defaultValue:"MCP Servers"})}),(0,O.jsx)(x.A,{variant:"contained",size:"small",startIcon:(0,O.jsx)(Qt.A,{}),onClick:()=>{d((0,a.A)((0,a.A)({},ka),{},{id:(new Date).getTime().toString(),enabled:!0,auth_type:"api_key"})),g(!0),r(!0)},children:e("configuration.mcp.addServer",{defaultValue:"Add Server"})})]}),(0,O.jsx)(o.A,{sx:{mt:2},children:0===t.servers.length?(0,O.jsx)(c.A,{variant:"body2",color:"text.secondary",align:"center",sx:{py:3},children:e("configuration.mcp.noServers",{defaultValue:"No MCP servers configured yet."})}):(0,O.jsx)(o.A,{sx:{display:"flex",flexDirection:"column",gap:2},children:t.servers.slice().sort((e,t)=>e.name.localeCompare(t.name)).map(n=>{return(0,O.jsx)(_e.A,{variant:"outlined",sx:{p:2,borderRadius:1.5,transition:"all 0.2s","&:hover":{boxShadow:"0 4px 12px rgba(0,0,0,0.08)",borderColor:"primary.main"}},children:(0,O.jsxs)(o.A,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,O.jsxs)(o.A,{sx:{display:"flex",flexDirection:"column"},children:[(0,O.jsxs)(o.A,{sx:{display:"flex",alignItems:"center",mb:.5},children:[(0,O.jsx)(c.A,{variant:"subtitle1",fontWeight:"medium",children:n.name}),(0,O.jsx)(R.A,{label:"STREAMABLE",size:"small",color:"secondary",variant:"outlined",sx:{ml:1.5,fontSize:"0.7rem",height:20}}),n.global_enabled&&(0,O.jsx)(R.A,{label:"GLOBAL",size:"small",color:"primary",sx:{ml:1,fontSize:"0.7rem",height:20}})]}),(0,O.jsx)(c.A,{variant:"body2",color:"text.secondary",children:n.server_url})]}),(0,O.jsxs)(o.A,{sx:{display:"flex",alignItems:"center",gap:1},children:[(0,O.jsxs)(o.A,{sx:{display:"flex",flexDirection:"column",alignItems:"flex-end",mr:1},children:[(0,O.jsx)(he.A,{control:(0,O.jsx)(me.A,{size:"small",checked:n.enabled,onChange:(a=n.id,async e=>{try{const e=tt.getInstance();await e.toggleMcpServerEnabled(a),await j()}catch(t){v({open:!0,message:t instanceof Error?t.message:"Failed to toggle server state",severity:"error"})}}),disabled:!t.global_enabled}),label:(0,O.jsx)(c.A,{variant:"caption",sx:{fontSize:"0.75rem"},children:n.enabled?e("common.enabled",{defaultValue:"Enabled"}):e("common.disabled",{defaultValue:"Disabled"})})}),(0,O.jsx)(he.A,{control:(0,O.jsx)(me.A,{size:"small",checked:n.global_enabled||!1,onChange:w(n.id),disabled:!t.global_enabled||!n.enabled,color:"primary"}),label:(0,O.jsx)(c.A,{variant:"caption",sx:{fontSize:"0.75rem"},children:n.global_enabled?e("configuration.mcp.globalEnabled",{defaultValue:"Global"}):e("configuration.mcp.globalDisabled",{defaultValue:"Not Global"})})})]}),(0,O.jsxs)(o.A,{sx:{display:"flex",flexDirection:"column"},children:[(0,O.jsx)(u.A,{size:"small",onClick:()=>(async e=>{try{const t=tt.getInstance(),n=await t.getMcpServer(e.id);n&&(d(n),g(!1),r(!0))}catch(t){v({open:!0,message:t instanceof Error?t.message:"Failed to load server details",severity:"error"})}})(n),children:(0,O.jsx)(Y.A,{fontSize:"small"})}),(0,O.jsx)(u.A,{size:"small",onClick:()=>(async e=>{try{const t=tt.getInstance();await t.deleteMcpServer(e),await j(),v({open:!0,message:"MCP Server deleted successfully",severity:"success"})}catch(t){v({open:!0,message:t instanceof Error?t.message:"Failed to delete MCP server",severity:"error"})}})(n.id),children:(0,O.jsx)(q.A,{fontSize:"small"})})]})]})]})},n.id);var a})})})]}),(0,O.jsx)(Sa,{open:s,onClose:()=>r(!1),server:l,onSave:async e=>{try{const t=tt.getInstance();p?await t.createMcpServer(e):await t.updateMcpServer(e.id,e),await j(),v({open:!0,message:"MCP Server ".concat(p?"created":"updated"," successfully"),severity:"success"}),r(!1)}catch(t){v({open:!0,message:t instanceof Error?t.message:"Failed to save MCP server",severity:"error"})}},isNew:p}),(0,O.jsx)(h.A,{open:f.open,autoHideDuration:6e3,onClose:()=>v(e=>(0,a.A)((0,a.A)({},e),{},{open:!1})),anchorOrigin:{vertical:"bottom",horizontal:"right"},children:(0,O.jsx)(m.A,{severity:f.severity,onClose:()=>v(e=>(0,a.A)((0,a.A)({},e),{},{open:!1})),children:f.message})})]})},Ea=e=>{let{open:t,onClose:n}=e;return(0,O.jsxs)(r.A,{open:t,onClose:n,fullWidth:!0,maxWidth:"lg",PaperProps:{sx:{borderRadius:2,boxShadow:"0 8px 32px rgba(0,0,0,0.12)"}},children:[(0,O.jsxs)(d.A,{sx:{borderBottom:"1px solid",borderColor:"divider",p:3,display:"flex",alignItems:"center",justifyContent:"space-between"},children:[(0,O.jsxs)(o.A,{sx:{display:"flex",alignItems:"center"},children:[(0,O.jsx)(ba.A,{sx:{mr:1.5,color:"primary.main",fontSize:"1.5rem"}}),(0,O.jsx)(c.A,{variant:"h5",children:"MCP Configuration"})]}),(0,O.jsx)(u.A,{onClick:n,"aria-label":"close",children:(0,O.jsx)(D.A,{})})]}),(0,O.jsx)(l.A,{sx:{p:3},children:(0,O.jsx)(_a,{})}),(0,O.jsx)(B.A,{sx:{p:2,borderTop:"1px solid",borderColor:"divider"},children:(0,O.jsx)(x.A,{onClick:n,color:"primary",children:"Close"})})]})},Ia=cn,Ta=un,Da=e=>{let{nodes:t,edges:n,onNodesChange:s,onEdgesChange:r,onConnect:l,onSelectionChange:d,onPaneContextMenu:c,onInit:u,planningEnabled:p,setPlanningEnabled:g,reasoningEnabled:f,setReasoningEnabled:y,schemaDetectionEnabled:j,setSchemaDetectionEnabled:w,selectedModel:k,setSelectedModel:C,onOpenLogsDialog:S,onToggleChat:_,isChatOpen:I,setIsAgentDialogOpen:T,setIsTaskDialogOpen:D,setIsFlowDialogOpen:N,showRunHistory:P,executionHistoryHeight:M=200,onOpenTutorial:z,onOpenConfiguration:L}=e;const[F,W]=(0,i.useState)(!0),R=(0,i.useRef)(null),V=(0,i.useRef)(null),{isDarkMode:B}=v();(0,i.useEffect)(()=>{const e="reactflow-stacking-order-fix",t=document.getElementById(e);t&&t.remove();const n=document.createElement("style");return n.id=e,n.textContent="\n      /* Ensure proper edge rendering without z-index conflicts */\n      .react-flow__edge-path {\n        pointer-events: stroke;\n      }\n      .react-flow__edge {\n        pointer-events: all;\n      }\n    ",document.head.appendChild(n),()=>{const t=document.getElementById(e);t&&t.remove()}},[]);const U=fn(),H=(0,E.a)(),K=(0,i.useCallback)(async()=>{try{ge([])}catch(e){}},[]),[J,q]=(0,i.useState)(!1),[Y,X]=(0,i.useState)(""),[Z,Q]=(0,i.useState)(!1),[$,ee]=(0,i.useState)(!1),[te,ne]=(0,i.useState)(!1),[ae,se]=(0,i.useState)(!1),[ie,oe]=(0,i.useState)(!1),[re,le]=(0,i.useState)(!1),[de,ce]=(0,i.useState)(!1),[ue,he]=(0,i.useState)(!1),[me,pe]=(0,i.useState)(!1),[xe,ge]=(0,i.useState)([]),[ve,Ae]=(0,i.useState)([]),{selectedTools:ye,setSelectedTools:be,selectedTools:je,setSelectedTools:we}=xn(),{selectedModel:ke,processType:Ce,setProcessType:Se}=(0,b.E)(),{handleExecuteCrew:_e,isExecuting:Ee}=(()=>{const e=fn(),t=(0,E.a)(),{isExecuting:n,setJobId:s,setIsExecuting:o,executeCrew:r}=(0,b.E)();return{handleExecuteCrew:(0,i.useCallback)(async(n,i)=>{try{"function"===typeof o&&o(!0);const e=n.map(e=>(0,a.A)({},e)),l=i.map(e=>(0,a.A)({},e)),d=await r(e,l);return d&&d.job_id?("function"===typeof s&&s(d.job_id),t.startPolling(),d):void 0}catch(l){return void e.showErrorMessage("Failed to execute crew workflow")}finally{"function"===typeof o&&o(!1)}},[o,r,s,t,e]),isExecuting:n}})(),{handleEdgesChange:Ie,handleNodesChange:Te,handleClear:De}=(e=>{let{nodes:t,edges:n=[],onNodesChange:a,onEdgesChange:s}=e;return{handleEdgesChange:(0,i.useCallback)(e=>{const t=e.filter((t,n)=>"add"!==t.type||!e.slice(0,n).some(e=>{var n,a;return"add"===e.type&&(null===(n=e.item)||void 0===n?void 0:n.id)===(null===(a=t.item)||void 0===a?void 0:a.id)}));s(t)},[s]),handleNodesChange:(0,i.useCallback)(e=>{a(e)},[a]),handleClear:(0,i.useCallback)(()=>{n.length>0&&s(n.map(e=>({type:"remove",id:e.id}))),t.length>0&&a(t.map(e=>({type:"remove",id:e.id}))),setTimeout(()=>{s([]),a([])},0)},[t,n,a,s])}})({nodes:t,edges:n,onNodesChange:s,onEdgesChange:r}),{handleAgentGenerated:Ne,handleUpdateAllAgentsLLM:Pe,handleUpdateAllAgentsMaxRPM:Me}=(e=>{let{nodes:t,onNodesChange:n,reactFlowInstanceRef:s,setSuccessMessage:o,setShowSuccess:r,fetchAgents:l}=e;const d=fn(),c=(0,i.useCallback)(async e=>{try{const a=await fe.AgentService.createAgent(e);if(!a)throw new Error("Failed to create agent in backend");await new Promise(e=>setTimeout(e,100));const i=t,d={x:100,y:100};if(i.length>0){const e=Math.max(...i.map(e=>e.position.y+(e.height||80)));d.y=e+100,d.x=Math.min(Math.max(d.x,50),500),d.y=Math.min(Math.max(d.y,50),800)}const c={id:"agent-".concat(a.id),type:"agentNode",position:d,width:180,height:180,data:{label:a.name,role:a.role,goal:a.goal,backstory:a.backstory,tools:a.tools||[],llm:a.llm,agentId:a.id,isActive:!1,isCompleted:!1},selected:!0};n([{type:"add",item:c}]),setTimeout(()=>{var e;null===(e=s.current)||void 0===e||e.fitView({duration:800,padding:.2})},100),o('Agent "'.concat(a.name,'" generated successfully and added to canvas')),r(!0),l&&await l()}catch(a){d.setErrorMessage("Failed to create agent: ".concat(a instanceof Error?a.message:"Unknown error"))}},[t,n,s,o,r,l,d]),u=(0,i.useCallback)(async e=>{if(s.current)try{const t=s.current.getNodes().filter(e=>"agentNode"===e.type);if(0===t.length)return d.setErrorMessage("No agent nodes found on the canvas"),void d.setShowError(!0);const i=t.map(async t=>{var n;const s=null===(n=t.data)||void 0===n?void 0:n.agentId;if(s)try{const t=await fe.AgentService.getAgent(s);if(!t)return null;const n=(0,a.A)((0,a.A)({},t),{},{llm:e});return await fe.AgentService.updateAgentFull(s,n)}catch(i){return null}}),l=(await Promise.all(i)).filter(Boolean).length;if(s.current){const t=s.current.getNodes().map(t=>"agentNode"===t.type?(0,a.A)((0,a.A)({},t),{},{data:(0,a.A)((0,a.A)({},t.data),{},{llm:e})}):t);s.current.setNodes(t),n(t.map(e=>({type:"reset",item:e})))}o("Updated ".concat(l," out of ").concat(t.length," agents to use ").concat(e)),r(!0)}catch(t){d.setErrorMessage("Failed to update agents: ".concat(t instanceof Error?t.message:"Unknown error"))}},[s,o,r,d,n]),h=(0,i.useCallback)(async e=>{if(s.current)try{const t=s.current.getNodes().filter(e=>"agentNode"===e.type);if(0===t.length)return d.setErrorMessage("No agent nodes found on the canvas"),void d.setShowError(!0);const i=t.map(async t=>{var n;const s=null===(n=t.data)||void 0===n?void 0:n.agentId;if(s)try{const t=await fe.AgentService.getAgent(s);if(!t)return null;const n=(0,a.A)((0,a.A)({},t),{},{max_rpm:e});return await fe.AgentService.updateAgentFull(s,n)}catch(i){return null}}),l=(await Promise.all(i)).filter(Boolean).length;if(s.current){const t=s.current.getNodes().map(t=>"agentNode"===t.type?(0,a.A)((0,a.A)({},t),{},{data:(0,a.A)((0,a.A)({},t.data),{},{max_rpm:e})}):t);s.current.setNodes(t),n(t.map(e=>({type:"reset",item:e})))}o("Updated ".concat(l," out of ").concat(t.length," agents to use ").concat(e," RPM")),r(!0)}catch(t){d.setErrorMessage("Failed to update agents: ".concat(t instanceof Error?t.message:"Unknown error"))}},[s,o,r,d,n]);return{handleAgentGenerated:c,handleUpdateAllAgentsLLM:u,handleUpdateAllAgentsMaxRPM:h}})({nodes:t,onNodesChange:s,reactFlowInstanceRef:V,setSuccessMessage:X,setShowSuccess:q,fetchAgents:K}),{handleTaskGenerated:ze}=vn({nodes:t,onNodesChange:s,reactFlowInstanceRef:V,setSuccessMessage:X,setShowSuccess:q}),{handleCrewSelect:Oe,handleFlowSelect:Le}=(e=>{let{onNodesChange:t,onEdgesChange:n,setSuccessMessage:a,setShowSuccess:s}=e;return{handleCrewSelect:(0,i.useCallback)((e,i)=>{t(e.map(e=>({type:"add",item:e}))),n(i.map(e=>({type:"add",item:e}))),a("Crew loaded successfully"),s(!0)},[t,n,a,s]),handleFlowSelect:(0,i.useCallback)((e,i,o)=>{t(e.map(e=>({type:"add",item:e}))),n(i.map(e=>({type:"add",item:e}))),a("Flow loaded successfully"),s(!0)},[t,n,a,s])}})({onNodesChange:s,onEdgesChange:r,setSuccessMessage:X,setShowSuccess:q}),{handleChangeToolsForAllAgents:Fe}=(e=>{let{reactFlowInstanceRef:t,setSuccessMessage:n,setShowSuccess:s}=e;const o=fn(),r=(0,i.useCallback)(async e=>{if(t.current)try{const i=t.current.getNodes().filter(e=>"agentNode"===e.type);if(0===i.length)return o.setErrorMessage("No agent nodes found on the canvas"),void o.setShowError(!0);const r=i.map(async t=>{var n;const s=null===(n=t.data)||void 0===n?void 0:n.agentId;if(s)try{const t=await fe.AgentService.getAgent(s);if(!t)return null;const n=(0,a.A)((0,a.A)({},t),{},{tools:e});return await fe.AgentService.updateAgentFull(s,n)}catch(i){return null}}),l=(await Promise.all(r)).filter(Boolean).length;if(t.current){const n=t.current.getNodes().map(t=>"agentNode"===t.type?(0,a.A)((0,a.A)({},t),{},{data:(0,a.A)((0,a.A)({},t.data),{},{tools:e})}):t);t.current.setNodes(n)}n("Updated ".concat(l," out of ").concat(i.length," agents with ").concat(e.length," tools")),s(!0)}catch(i){o.setErrorMessage("Failed to update agents: ".concat(i instanceof Error?i.message:"Unknown error"))}},[t,o,n,s]);return{handleChangeToolsForAllAgents:r}})({reactFlowInstanceRef:V,setSuccessMessage:X,setShowSuccess:q}),{handleChangeLLM:We,handleChangeMaxRPM:Re,handleChangeTools:Ve,handleExecuteCrewButtonClick:Be}=(e=>{let{nodes:t,edges:n,setIsLLMSelectionDialogOpen:s,setIsMaxRPMSelectionDialogOpen:o,setIsToolDialogOpen:r,handleExecuteCrew:l,setSuccessMessage:d,setShowSuccess:c}=e;const u=fn();return{handleChangeLLM:(0,i.useCallback)(()=>{if(0===t.filter(e=>"agentNode"===e.type).length){const e="This operation requires at least one agent node. Currently have 0 agents.";return void u.setErrorMessage(e)}s(!0)},[t,u,s]),handleChangeMaxRPM:(0,i.useCallback)(()=>{if(0===t.filter(e=>"agentNode"===e.type).length){const e="This operation requires at least one agent node. Currently have 0 agents.";return void u.setErrorMessage(e)}o(!0)},[t,u,o]),handleChangeTools:(0,i.useCallback)(()=>{if(0===t.filter(e=>"agentNode"===e.type).length){const e="This operation requires at least one agent node. Currently have 0 agents.";return void u.setErrorMessage(e)}r(!0)},[t,u,r]),handleExecuteCrewButtonClick:(0,i.useCallback)(async()=>{try{const e=t.map(e=>(0,a.A)({},e)),s=n.map(e=>(0,a.A)({},e)),i=await l(e,s);null!==i&&void 0!==i&&i.job_id&&(d(i.job_id),c(!0),setTimeout(()=>{c(!1)},3e3))}catch(e){u.showErrorMessage("Failed to execute crew workflow")}},[l,u,t,n,d,c])}})({nodes:t,edges:n,setIsLLMSelectionDialogOpen:oe,setIsMaxRPMSelectionDialogOpen:le,setIsToolDialogOpen:ce,handleExecuteCrew:_e,setSuccessMessage:X,setShowSuccess:q}),{isGeneratingConnections:Ue,handleGenerateConnections:He}=(e=>{let{reactFlowInstanceRef:t,onConnect:n,setSuccessMessage:a,setShowSuccess:s}=e;const[o,r]=(0,i.useState)(!1);return{isGeneratingConnections:o,handleGenerateConnections:(0,i.useCallback)(async()=>{if(!t.current)return!1;r(!0);try{const e=t.current.getNodes();if(t.current.getEdges().length>0)return a("Cannot generate connections: existing edges found on canvas. Please clear existing connections first."),s(!0),!1;const i=e.filter(e=>"agentNode"===e.type),o=e.filter(e=>"taskNode"===e.type);if(0===i.length||0===o.length)return a("Cannot generate connections: need both agent and task nodes on canvas"),s(!0),!1;let r=0;for(const t of i)for(const e of o){const a={source:t.id,target:e.id,sourceHandle:null,targetHandle:null};n(a),r++}return r>0?(a("Successfully generated ".concat(r," connections")),s(!0),!0):(a("No new connections were generated"),s(!0),!1)}catch(e){return a("Failed to generate connections"),s(!0),!1}finally{r(!1)}},[t,n,a,s])}})({reactFlowInstanceRef:V,onConnect:l,setSuccessMessage:X,setShowSuccess:q}),Ke=(0,i.useCallback)(async()=>(await He(),Promise.resolve()),[He]);(0,i.useEffect)(()=>{(t.length>0||n.length>0)&&0===t.length&&0===n.length&&(s(t.map(e=>({type:"add",item:e}))),r(n.map(e=>({type:"add",item:e}))))},[t,n,s,r]),(0,i.useEffect)(()=>{const e=console.error;return console.error=function(t){if("string"!==typeof t||!(t.includes("ResizeObserver loop")||t.includes("ResizeObserver Loop")||t.includes("ResizeObserver")||t.includes("undelivered notifications"))){for(var n=arguments.length,a=new Array(n>1?n-1:0),s=1;s<n;s++)a[s-1]=arguments[s];e(t,...a)}},()=>{console.error=e}},[]),(0,i.useEffect)(()=>{const e=e=>{e.message&&(e.message.includes("react-flow")||e.message.includes("ReactFlow")||e.message.includes("Uncaught")&&e.message.includes("rendering"))&&U.setErrorMessage(e.message)};return window.addEventListener("error",e),()=>{window.removeEventListener("error",e)}},[U]),(0,i.useLayoutEffect)(()=>{W(!0);const e=setTimeout(()=>{W(!1)},50);return()=>clearTimeout(e)},[]),(0,i.useEffect)(()=>{U.showError&&U.clearError()},[U]);const Ge=i.useMemo(()=>t.filter(e=>{var t;if(!e||"object"!==typeof e)return!1;const n=(null===(t=e.type)||void 0===t?void 0:t.toLowerCase())||"";return"agentnode"===n||"tasknode"===n}).map(e=>{var t,n;const s="agentNode"===e.type?170:270,i="agentNode"===e.type?170:135;var o,r,l,d;return e.style&&(e.style.width||e.style.height)?(0,a.A)((0,a.A)({},e),{},{width:"number"===typeof e.width?e.width:"number"===typeof(null===(t=e.style)||void 0===t?void 0:t.width)?e.style.width:s,height:"number"===typeof e.height?e.height:"number"===typeof(null===(n=e.style)||void 0===n?void 0:n.height)?e.style.height:i}):(0,a.A)((0,a.A)({},e),{},{width:"number"===typeof(null===(o=e.style)||void 0===o?void 0:o.width)?e.style.width:s,height:"number"===typeof(null===(r=e.style)||void 0===r?void 0:r.height)?e.style.height:i,style:(0,a.A)((0,a.A)({},e.style),{},{width:(null===(l=e.style)||void 0===l?void 0:l.width)||s,height:(null===(d=e.style)||void 0===d?void 0:d.height)||i})})}),[t]),Je=(0,i.useCallback)(e=>{V.current=e;try{const t=function(){let n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3;try{if(e&&n<=a){setTimeout(()=>{window.requestAnimationFrame(()=>{try{e.fitView({padding:.2,includeHiddenNodes:!1,duration:800})}catch(s){n<a&&t(n+1,a)}})},100*n)}}catch(s){}};t(),u&&u(e)}catch(t){}},[u]),qe=i.useMemo(()=>{try{const e=new Set(t.map(e=>e.id)),s=new Map;n.forEach(t=>{if(t&&"object"===typeof t&&t.source&&t.target&&e.has(t.source)&&e.has(t.target)){const e="".concat(t.source,"-").concat(t.target,"-").concat(t.sourceHandle||"default","-").concat(t.targetHandle||"default");s.has(e)||s.set(e,t)}});const i=Array.from(s.values());return i.map(e=>(0,a.A)((0,a.A)({},e),{},{type:e.type||"default",animated:H.hasRunningJobs}))}catch(e){return[]}},[n,t,H.hasRunningJobs]),Ye=(0,i.useCallback)((e,t)=>{s(e.map(e=>({type:"remove",id:e.id})));const a=(0,A.AX)(e,n),i=new Set([...t.map(e=>e.id),...a.map(e=>e.id)]);r(Array.from(i).map(e=>({type:"remove",id:e})))},[s,r,n]);(0,hn.h)({flowInstance:V.current,onDeleteSelected:Ye,onClearCanvas:De,onZoomIn:()=>{var e;return null===(e=V.current)||void 0===e?void 0:e.zoomIn()},onZoomOut:()=>{var e;return null===(e=V.current)||void 0===e?void 0:e.zoomOut()},onFitView:()=>{var e;return null===(e=V.current)||void 0===e?void 0:e.fitView({padding:.2})},onExecuteFlow:()=>{if(t.length>0||n.length>0){const e=t.map(e=>(0,a.A)({},e)),s=n.map(e=>(0,a.A)({},e));return _e(e,s)}},onGenerateConnections:Ke,onOpenSaveCrew:()=>{const e=new CustomEvent("openSaveCrewDialog");window.dispatchEvent(e)},onOpenCrewFlowDialog:()=>se(!0),onChangeLLMForAllAgents:We,onChangeMaxRPMForAllAgents:Re,onChangeToolsForAllAgents:Ve,onOpenLLMDialog:()=>oe(!0),onOpenToolDialog:()=>ce(!0),onOpenMaxRPMDialog:()=>le(!0),onOpenMCPConfigDialog:()=>he(!0),disabled:!1,useWorkflowStore:!0,instanceId:"crew-canvas",priority:10}),(0,i.useEffect)(()=>{const e=new MutationObserver(()=>{document.querySelector(".MuiDialog-root")});return e.observe(document.body,{childList:!0,subtree:!0}),()=>e.disconnect()},[]),(0,i.useEffect)(()=>{Xe()},[]);const Xe=async()=>{pe(!0);try{const e=(await gt.m.listTools()).map(e=>({id:e.id.toString(),title:e.title,description:e.description,icon:e.icon||"",enabled:e.enabled}));Ae(e)}catch(e){}finally{pe(!1)}};(0,i.useEffect)(()=>{const e=()=>{window.dispatchEvent(new Event("fitViewToNodesInternal"))},t=()=>{Q(!0)},n=()=>{ee(!0)},a=e=>{const{id:t}=e.detail;r([{type:"remove",id:t}])};return window.addEventListener("fitViewToNodes",e),window.addEventListener("openAgentGenerationDialog",t),window.addEventListener("openTaskGenerationDialog",n),window.addEventListener("edge:delete",a),()=>{window.removeEventListener("fitViewToNodes",e),window.removeEventListener("openAgentGenerationDialog",t),window.removeEventListener("openTaskGenerationDialog",n),window.removeEventListener("edge:delete",a)}},[t,s,r,U]);const Ze=(0,i.useCallback)(async e=>{const t=parseInt(e,10);isNaN(t)||await Me(t)},[Me]);return(0,O.jsxs)(o.A,{ref:R,sx:{width:"100%",height:"100%",display:"flex",flexDirection:"column",position:"relative",backgroundColor:B?"#1a1a1a":"#f5f5f5"},children:[U.showError?(0,O.jsxs)(o.A,{sx:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",backgroundColor:"rgba(255, 255, 255, 0.9)",padding:2,borderRadius:1,maxWidth:"80%",textAlign:"center",zIndex:1e3,border:"1px solid #f44336",color:"#f44336"},children:[(0,O.jsxs)("div",{children:["Error in ReactFlow component: ",U.errorMessage]}),(0,O.jsx)(x.A,{onClick:()=>U.clearError(),children:"Dismiss"})]}):null,F?(0,O.jsx)(o.A,{sx:{display:"flex",justifyContent:"center",alignItems:"center",height:"100%",color:B?"#fff":"#333"},children:"Loading..."}):(0,O.jsxs)(A.Gc,{"data-tour":"canvas-area",nodes:Ge,edges:qe,onNodesChange:Te,onEdgesChange:Ie,edgeUpdaterRadius:10,reconnectRadius:10,onConnect:l,onSelectionChange:d,onPaneContextMenu:c,onInit:Je,nodeTypes:Ia,edgeTypes:Ta,connectionMode:A.WZ.Loose,attributionPosition:"bottom-left",minZoom:.1,maxZoom:4,defaultViewport:{x:0,y:0,zoom:1},proOptions:{hideAttribution:!0},style:{background:B?"#1a1a1a":"#f8f8f8"},nodesDraggable:!0,nodesConnectable:!0,elementsSelectable:!0,edgesFocusable:!1,selectNodesOnDrag:!0,selectionOnDrag:!0,panOnDrag:[1,2],translateExtent:[[-2e3,-2e3],[3e3,3e3]],nodeExtent:[[-2e3,-2e3],[3e3,3e3]],snapToGrid:!1,snapGrid:[15,15],multiSelectionKeyCode:"Shift",selectionKeyCode:"Shift",deleteKeyCode:"Delete",elevateEdgesOnSelect:!1,elevateNodesOnSelect:!0,children:[(0,O.jsx)(G.V,{color:B?"#333":"#aaa",gap:16,size:1,variant:G._.Dots}),(0,O.jsx)(zn,{onClearCanvas:De,onGenerateConnections:Ke,onZoomIn:()=>{var e;return null===(e=V.current)||void 0===e?void 0:e.zoomIn()},onZoomOut:()=>{var e;return null===(e=V.current)||void 0===e?void 0:e.zoomOut()},onFitView:()=>{var e;return null===(e=V.current)||void 0===e?void 0:e.fitView()},onToggleInteractivity:()=>{if(V.current){const e=V.current.getNodes().map(e=>(0,a.A)((0,a.A)({},e),{},{selectable:!e.selectable}));V.current.setNodes(e)}},isGeneratingConnections:Ue,planningEnabled:p,setPlanningEnabled:g,reasoningEnabled:f,setReasoningEnabled:y,schemaDetectionEnabled:j,setSchemaDetectionEnabled:w,processType:Ce,setProcessType:Se,showRunHistory:P,setIsConfigurationDialogOpen:L,onOpenTutorial:z}),(0,O.jsx)(Hn,{onOpenLogsDialog:S,onToggleChat:_,isChatOpen:I,setIsAgentDialogOpen:T,setIsTaskDialogOpen:D,setIsFlowDialogOpen:N,showRunHistory:P,executionHistoryHeight:M})]},"crew-canvas"),(0,O.jsx)(h.A,{open:J,autoHideDuration:4e3,onClose:()=>q(!1),anchorOrigin:{vertical:"bottom",horizontal:"left"},children:(0,O.jsx)(m.A,{onClose:()=>q(!1),severity:"success",sx:{width:"100%"},children:Y})}),(0,O.jsx)(qn,{open:Z,onClose:()=>Q(!1),onAgentGenerated:Ne,tools:ve,selectedTools:ye,onToolsChange:be}),(0,O.jsx)(Yn,{open:$,onClose:()=>ee(!1),onTaskGenerated:ze}),(0,O.jsx)($n,{open:te,onClose:()=>ne(!1),onGenerateCrew:(e,t)=>{const n=[],a=[];e.agents.forEach((e,t)=>{const a="agent-".concat(e.id);n.push({id:a,type:"agentNode",position:{x:80,y:100+150*t},data:{label:e.name,agentId:e.id,role:e.role||"",goal:e.goal||"",backstory:e.backstory||"",llm:e.llm||ke,tools:e.tools||[],agent:e}})}),e.tasks.forEach((e,t)=>{const a="task-".concat(e.id);n.push({id:a,type:"taskNode",position:{x:360,y:100+150*t},data:{label:e.name,taskId:e.id,description:e.description||e.name,expected_output:e.expected_output||"",human_input:e.human_input||!1,tools:e.tools||[],async_execution:void 0!==e.async_execution&&Boolean(e.async_execution),context:e.context||[],config:{markdown:e.markdown||!1},task:e}})}),e.tasks.forEach(e=>{const t="task-".concat(e.id);if(e.agent_id){const n="agent-".concat(e.agent_id);a.push({id:"edge-".concat(e.id),source:n,target:t,type:"default"})}}),s(n.map(e=>({type:"add",item:e}))),r(a.map(e=>({type:"add",item:e}))),t&&Be()},selectedModel:k,tools:ve.map(e=>(0,a.A)((0,a.A)({},e),{},{icon:e.icon||""})),selectedTools:ye,onToolsChange:be}),(0,O.jsx)(xa,{open:ae,onClose:()=>se(!1),onCrewSelect:Oe,onFlowSelect:Le}),(0,O.jsx)(fa,{open:ie,onClose:()=>oe(!1),onSelectLLM:Pe}),(0,O.jsx)(Aa,{open:re,onClose:()=>le(!1),onSelectMaxRPM:Ze}),(0,O.jsx)(ya,{open:de,onClose:()=>ce(!1),onSelectTools:Fe}),(0,O.jsx)(Ea,{open:ue,onClose:()=>he(!1)})]})},Na=(0,i.memo)(Da);var Pa=n(37630),Ma=n(71722),za=n(35867),Oa=n(77106),La=n(79724),Fa=n(26350);const Wa=e=>{let{onClearCanvas:t,onZoomIn:n,onZoomOut:s,onFitView:o,onToggleInteractivity:r,isHorizontal:l=!0,isLeftToRight:d=!0,children:c}=e;const[u,h]=(0,i.useState)(null),m=(0,An.A)(),p={width:"24px",height:"24px",padding:"4px",fontSize:"12px",opacity:.8,backgroundColor:m.palette.background.paper,border:"1px solid ".concat(m.palette.divider),cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",transition:"all 0.2s ease-in-out"},x=e=>(0,a.A)((0,a.A)({},p),{},{backgroundColor:u===e?m.palette.action.hover:m.palette.background.paper,border:"1px solid ".concat(m.palette.divider),color:m.palette.text.primary});return(0,O.jsxs)(Pa.H,{style:{position:"absolute",top:0,left:0,zIndex:10,pointerEvents:"all",padding:"4px",backgroundColor:"dark"===m.palette.mode?"rgba(0, 0, 0, 0.8)":"rgba(255, 255, 255, 0.9)",borderRadius:"4px",boxShadow:m.shadows[1],width:"fit-content",height:"fit-content",display:"flex",flexDirection:"column",gap:"4px"},children:[n&&(0,O.jsx)(Pa.a,{onClick:n,title:"Zoom In",style:x("zoomIn"),onMouseEnter:()=>h("zoomIn"),onMouseLeave:()=>h(null),children:(0,O.jsx)(za.A,{sx:{fontSize:16,color:m.palette.text.primary}})}),s&&(0,O.jsx)(Pa.a,{onClick:s,title:"Zoom Out",style:x("zoomOut"),onMouseEnter:()=>h("zoomOut"),onMouseLeave:()=>h(null),children:(0,O.jsx)(Oa.A,{sx:{fontSize:16,color:m.palette.text.primary}})}),o&&(0,O.jsx)(Pa.a,{onClick:o,title:"Fit View",style:x("fitView"),onMouseEnter:()=>h("fitView"),onMouseLeave:()=>h(null),children:(0,O.jsx)(La.A,{sx:{fontSize:16,color:m.palette.text.primary}})}),r&&(0,O.jsx)(Pa.a,{onClick:r,title:"Toggle Interactivity",style:x("interactivity"),onMouseEnter:()=>h("interactivity"),onMouseLeave:()=>h(null),children:(0,O.jsx)(Fa.A,{sx:{fontSize:16,color:m.palette.text.primary}})}),(0,O.jsx)(Pa.a,{onClick:t,title:"Clear Canvas",style:x("clear"),onMouseEnter:()=>h("clear"),onMouseLeave:()=>h(null),children:(0,O.jsx)(Ma.A,{sx:{fontSize:16,color:m.palette.text.primary}})}),c]})},Ra=e=>(0,O.jsx)(Wa,(0,a.A)({},e)),Va={crewNode:sn},Ba={default:dn,crewEdge:on};if("undefined"!==typeof window){const e=e=>{e.message&&(e.message.includes("ResizeObserver loop")||e.message.includes("ResizeObserver Loop"))&&(e.stopImmediatePropagation(),e.preventDefault())};window.addEventListener("error",e),window.addEventListener("unhandledrejection",e=>{e.reason&&e.reason.message&&(e.reason.message.includes("ResizeObserver loop")||e.reason.message.includes("ResizeObserver Loop"))&&e.preventDefault()})}const Ua=e=>{let{nodes:t,edges:n,onNodesChange:s,onEdgesChange:r,onConnect:l,onSelectionChange:d,onPaneContextMenu:c,onInit:u}=e;const{isDarkMode:p}=v(),[x,g]=(0,i.useState)(!1),f=(0,i.useRef)(null),y=(0,i.useRef)(null),[b,j]=(0,i.useState)(!0),[w,k]=(0,i.useState)(!1),[C,S]=(0,i.useState)(!1),[_,E]=(0,i.useState)(!1),[I,T]=(0,i.useState)(""),D=(0,i.useCallback)(e=>{T(e),E(!0),setTimeout(()=>{E(!1)},3e3)},[]),N=(0,i.useCallback)(()=>{const e=t.filter(e=>"crewNode"===e.type).map(e=>e.id);if(e.length>0){const t=e.map(e=>({id:e,type:"remove"}));s(t)}const a=n.filter(t=>e.includes(t.source)||e.includes(t.target)).map(e=>({id:e.id,type:"remove"}));a.length>0&&r(a),D("Canvas cleared: removed ".concat(e.length," nodes and ").concat(a.length," edges"))},[t,n,s,r,D]),P=(0,i.useCallback)((e,t)=>{if(e.length>0){const t=e.map(e=>({id:e.id,type:"remove"}));s(t)}const a=e.length>0?(0,A.AX)(e,n):[],i=new Set([...t.map(e=>e.id),...a.map(e=>e.id)]);if(i.size>0){const e=Array.from(i).map(e=>({id:e,type:"remove"}));r(e)}(e.length>0||i.size>0)&&D("Deleted ".concat(e.length," nodes and ").concat(i.size," edges"))},[s,r,D,n]),{shortcuts:M}=(0,hn.h)({flowInstance:f.current,onDeleteSelected:P,onClearCanvas:N,onFitView:()=>{f.current&&(f.current.fitView({padding:.2}),D("Fit view to all nodes"))},onOpenFlowDialog:()=>{const e=new CustomEvent("openFlowDialog");window.dispatchEvent(e),D("Opening Flow selection dialog (press lf)")},disabled:b||C,instanceId:"flow-canvas",priority:5}),z=i.useMemo(()=>{try{return t.filter(e=>{var t,n;if(!e||"object"!==typeof e)return!1;const a=(null===(t=e.data)||void 0===t||null===(t=t.label)||void 0===t?void 0:t.toLowerCase())||"",s=(null===(n=e.type)||void 0===n?void 0:n.toLowerCase())||"";return a.includes("flow")||s.includes("flow")||"crewnode"===s||e.data&&e.data.flowConfig})}catch(e){return[]}},[t]),L=(0,i.useRef)(z.length),F=(0,i.useRef)(!1);(0,i.useEffect)(()=>{const e=L.current,t=z.length;if(!b&&f.current&&t>0){if(!F.current||Math.abs(t-e)>0){F.current||(F.current=!0),L.current=t;const e=setTimeout(()=>{f.current&&window.requestAnimationFrame(()=>{var e;null===(e=f.current)||void 0===e||e.fitView({padding:.2,includeHiddenNodes:!1,duration:800})})},300);return()=>clearTimeout(e)}}},[z.length,b]);const W=i.useMemo(()=>z.map(e=>{var t,n;return e.style&&(e.style.width||e.style.height)?e:(0,a.A)((0,a.A)({},e),{},{style:(0,a.A)((0,a.A)({},e.style),{},{width:(null===(t=e.style)||void 0===t?void 0:t.width)||180,height:(null===(n=e.style)||void 0===n?void 0:n.height)||80})})}),[z]);(0,i.useLayoutEffect)(()=>{j(!0);const e=setTimeout(()=>{w||k(!0)},0),t=setTimeout(()=>{j(!1)},100);return()=>{clearTimeout(e),clearTimeout(t)}},[w,z.length]),(0,i.useEffect)(()=>{C&&S(!1)},[t,n,C]);const R=(0,i.useCallback)(e=>{f.current=e,setTimeout(()=>{if(e)try{if(z.length>0){const t=new Map,n=[];z.forEach(e=>{const n="".concat(Math.round(e.position.x),",").concat(Math.round(e.position.y));t.has(n)||t.set(n,[]),t.get(n).push(e)});let s=!1;if(t.forEach((e,t)=>{e.length>1?(s=!0,e.forEach((t,s)=>{if(0===s)n.push(t);else{const i=Math.ceil(Math.sqrt(e.length)),o=300*(s%i),r=200*Math.floor(s/i);n.push((0,a.A)((0,a.A)({},t),{},{position:{x:t.position.x+o,y:t.position.y+r}}))}})):n.push(e[0])}),n.length>0&&s){e.setNodes(n);const t=e.getEdges();if(t.filter(e=>!e.type||"default"===e.type).length>0){const n=t.map(e=>e.type&&"default"!==e.type?e:(0,a.A)((0,a.A)({},e),{},{type:"crewEdge",animated:!0}));e.setEdges(n)}new Map(n.map(e=>[e.id,e]));const s=new Set(t.map(e=>"".concat(e.source,"-").concat(e.target))),i=[];n.forEach(e=>{var t;if(null!==(t=e.data)&&void 0!==t&&null!==(t=t.flowConfig)&&void 0!==t&&t.listeners){e.data.flowConfig.listeners.forEach(e=>{if(e.crewId){const t=n.filter(t=>{var n;return(null===(n=t.data)||void 0===n?void 0:n.crewId)===e.crewId});e.listenToTaskIds&&e.listenToTaskIds.length>0&&e.listenToTaskIds.forEach(a=>{let o=null;if(a.includes(":")&&([o]=a.split(":")),o){const a=n.filter(e=>{var t,n;return(null===(t=e.data)||void 0===t?void 0:t.crewId)===Number(o)||(null===(n=e.data)||void 0===n?void 0:n.crewId)===o});t.forEach(t=>{a.forEach(n=>{const a="".concat(t.id,"-").concat(n.id);if(!s.has(a)&&t.id!==n.id){const o=e.tasks&&Array.isArray(e.tasks)?e.tasks.map(e=>e.name).join(", "):"Task",r=t.position.x,l=t.position.y,d=n.position.x,c=n.position.y;let u,h;d>r+200?(u="right",h="left-target"):d<r-200?(u="left",h="right-target"):c>l+100?(u="bottom",h="top-target"):(u="top",h="bottom-target"),i.push({id:"edge-".concat(t.id,"-").concat(n.id,"-").concat(Date.now()),source:t.id,target:n.id,sourceHandle:u,targetHandle:h,type:"crewEdge",animated:!0,data:{label:o}}),s.add(a)}})})}})}})}}),i.length>0&&e.setEdges([...t,...i])}e.fitView({padding:.2,includeHiddenNodes:!1})}}catch(t){}},200),u&&u(e)},[u,z]),V=i.useMemo(()=>{try{const e=new Set(z.map(e=>e.id));return n.filter(t=>t&&"object"===typeof t&&t.source&&t.target&&e.has(t.source)&&e.has(t.target))}catch(e){return[]}},[n,z]),B=(0,i.useCallback)(e=>{const t=new Set(z.map(e=>e.id)),n=e.filter(e=>{switch(e.type){case"position":case"dimensions":case"remove":case"select":return t.has(e.id);case"add":return e.item&&t.has(e.item.id);default:return!0}});n.length>0&&s(n)},[z,s]);return(0,i.useEffect)(()=>{const e=e=>{e.detail&&e.detail.message&&D(e.detail.message)};return window.addEventListener("showNotification",e),()=>{window.removeEventListener("showNotification",e)}},[D]),(0,O.jsxs)(o.A,{ref:y,sx:{width:"100%",height:"100%",display:"flex",flexDirection:"column",position:"relative",backgroundColor:p?"#1a1a1a":"#f5f5f5"},children:[b?(0,O.jsx)(o.A,{sx:{display:"flex",justifyContent:"center",alignItems:"center",height:"100%",color:"text.secondary",fontSize:"0.875rem"},children:C?"Error rendering canvas":"Loading flow canvas..."}):(0,O.jsxs)(A.Gc,{nodes:W,edges:V,onNodesChange:B,onEdgesChange:r,onConnect:l,onInit:R,nodeTypes:Va,edgeTypes:Ba,onSelectionChange:d,onPaneContextMenu:c,proOptions:{hideAttribution:!0},connectionMode:A.WZ.Loose,snapToGrid:!0,minZoom:.1,maxZoom:4,style:{background:p?"#1a1a1a":"#f5f5f5"},children:[(0,O.jsx)(G.V,{color:p?"#333":"#aaa",gap:16,size:1,variant:G._.Dots}),x&&(0,O.jsx)(Ra,{onClearCanvas:N})]}),(0,O.jsx)(o.A,{sx:{position:"absolute",bottom:10,left:10,fontSize:"0.75rem",color:"text.secondary",opacity:.7,pointerEvents:"none"},children:'Tip: Press "del" to delete selected items, dd to clear canvas'}),(0,O.jsx)(h.A,{open:_,autoHideDuration:3e3,onClose:()=>E(!1),anchorOrigin:{vertical:"bottom",horizontal:"right"},children:(0,O.jsx)(m.A,{severity:"info",sx:{width:"100%"},children:I})})]})},Ha=(0,i.memo)(Ua),Ka=e=>{let{areFlowsVisible:t,showRunHistory:n,panelPosition:a,isDraggingPanel:s,isDarkMode:i,nodes:r,edges:l,onNodesChange:d,onEdgesChange:c,onConnect:u,onSelectionChange:h,onPaneContextMenu:m,onCrewFlowInit:p,onFlowFlowInit:x,onPanelDragStart:g,planningEnabled:f,setPlanningEnabled:v,reasoningEnabled:A,setReasoningEnabled:y,schemaDetectionEnabled:b,setSchemaDetectionEnabled:j,selectedModel:w,setSelectedModel:k,onOpenLogsDialog:C,onToggleChat:_,isChatOpen:E,setIsAgentDialogOpen:I,setIsTaskDialogOpen:T,setIsFlowDialogOpen:D,onOpenTutorial:N,onOpenConfiguration:P}=e;const{crewAIFlowEnabled:M}=(0,S.d)();return t&&M?(0,O.jsxs)(o.A,{sx:{height:"100%",position:"relative",mt:0,mb:0,borderBottom:"1px solid",borderColor:i?"rgba(255,255,255,0.1)":"rgba(0,0,0,0.1)",display:"grid",gridTemplateColumns:"".concat(a,"% ").concat(100-a,"%"),overflow:"hidden",width:"100%",maxWidth:"100%",transition:s?"none":"grid-template-columns 0.3s ease-in-out"},children:[(0,O.jsx)(o.A,{sx:{position:"relative",width:"100%",height:"100%",borderRight:"1px solid ".concat(i?"rgba(255,255,255,0.1)":"rgba(0,0,0,0.1)")},"data-crew-container":!0,children:(0,O.jsx)(Na,{nodes:r,edges:l,onNodesChange:d,onEdgesChange:c,onConnect:u,onSelectionChange:h,onPaneContextMenu:m,onInit:p,planningEnabled:f,setPlanningEnabled:v,reasoningEnabled:A,setReasoningEnabled:y,schemaDetectionEnabled:b,setSchemaDetectionEnabled:j,selectedModel:w,setSelectedModel:k,onOpenLogsDialog:C,onToggleChat:_,isChatOpen:E,setIsAgentDialogOpen:I,setIsTaskDialogOpen:T,setIsFlowDialogOpen:D,showRunHistory:n,onOpenTutorial:N,onOpenConfiguration:P})}),(0,O.jsx)(o.A,{sx:{position:"absolute",top:0,left:"".concat(a,"%"),width:"8px",height:"100%",transform:"translateX(-50%)",cursor:"col-resize",zIndex:100,background:i?"rgba(255,255,255,0.05)":"rgba(0,0,0,0.05)","&::after":{content:'""',position:"absolute",top:0,left:"50%",width:"2px",height:"100%",transform:"translateX(-50%)",backgroundColor:i?"rgba(255,255,255,0.2)":"rgba(0,0,0,0.15)"},"&:hover":{background:i?"rgba(255,255,255,0.1)":"rgba(0,0,0,0.08)","&::after":{backgroundColor:i?"rgba(255,255,255,0.4)":"rgba(0,0,0,0.3)"}},"&:active":{background:i?"rgba(255,255,255,0.15)":"rgba(0,0,0,0.12)","&::after":{backgroundColor:i?"rgba(255,255,255,0.5)":"rgba(0,0,0,0.4)"}}},onMouseDown:g}),(0,O.jsx)(o.A,{sx:{position:"relative",width:"100%",height:"100%"},children:(0,O.jsx)(Ha,{nodes:r,edges:l,onNodesChange:d,onEdgesChange:c,onConnect:u,onSelectionChange:h,onPaneContextMenu:m,onInit:x})})]}):(0,O.jsx)(o.A,{sx:{height:"100%",position:"relative",mt:0,mb:0,borderBottom:"1px solid",borderColor:i?"rgba(255,255,255,0.1)":"rgba(0,0,0,0.1)",display:"block",overflow:"hidden",width:"100%",maxWidth:"100%"},children:(0,O.jsx)(o.A,{sx:{width:"100%",height:"100%",position:"relative"},"data-crew-container":!0,children:(0,O.jsx)(Na,{nodes:r,edges:l,onNodesChange:d,onEdgesChange:c,onConnect:u,onSelectionChange:h,onPaneContextMenu:m,onInit:p,planningEnabled:f,setPlanningEnabled:v,reasoningEnabled:A,setReasoningEnabled:y,schemaDetectionEnabled:b,setSchemaDetectionEnabled:j,selectedModel:w,setSelectedModel:k,onOpenLogsDialog:C,onToggleChat:_,isChatOpen:E,setIsAgentDialogOpen:I,setIsTaskDialogOpen:T,setIsFlowDialogOpen:D,showRunHistory:n,onOpenTutorial:N,onOpenConfiguration:P})})})};var Ga=n(99699),Ja=n(3124),qa=n(55379),Ya=n(66592),Xa=n(27898),Za=n(40379),Qa=n(49939),$a=n(16724),es=n(31902),ts=n(95699),ns=n(41413),as=n(73998),ss=n(16983),is=n(18617),os=n(35887),rs=n(21690);const ls=()=>{const[e,t]=(0,i.useState)(null),[n,a]=(0,i.useState)([]),[s,r]=(0,i.useState)(!1),[l,d]=(0,i.useState)(null),[h,m]=(0,i.useState)(!1),x=(0,E.a)(e=>e.clearRunHistory),{currentUser:g,isLoadingUser:f,fetchCurrentUser:v}=(0,rs.k)(e=>({currentUser:e.currentUser,isLoadingUser:e.isLoading,fetchCurrentUser:e.fetchCurrentUser})),A=Boolean(e),y=(0,i.useCallback)(async()=>{if(null!==g&&void 0!==g&&g.email){r(!0);try{const t=Ve.B.getInstance();let n=[];try{n=await t.getMyGroups()}catch(e){n=[]}const s=g.email,i=s.split("@")[1]||"",o=s.split("@")[0]||"",r="user_".concat(o,"_").concat(i.replace(/\./g,"_"));let c=n;const u={id:r,name:"My Workspace",status:"active",auto_created:!0,created_at:(new Date).toISOString(),updated_at:(new Date).toISOString(),user_count:1,user_role:void 0};c=[u,...c.filter(e=>e.id!==r)],a(c);const h=localStorage.getItem("selectedGroupId");if(c.length>0){const e=h&&c.find(e=>e.id===h)||u;l&&l.id===e.id||(d(e),localStorage.setItem("selectedGroupId",e.id))}}catch(e){os.Ay.error("Failed to load groups")}finally{r(!1)}}},[g]);(0,i.useEffect)(()=>{g||v()},[]),(0,i.useEffect)(()=>{null!==g&&void 0!==g&&g.email&&y()},[null===g||void 0===g?void 0:g.email,y]);const b=()=>{t(null)},j=e=>{switch(e){case"ADMIN":return"error";case"EDITOR":return"success";default:return"default"}},w=(0,i.useMemo)(()=>l?l.id.startsWith("user_")?(0,O.jsx)(as.A,{fontSize:"small",sx:{color:"primary.main"}}):(0,O.jsx)(ss.A,{fontSize:"small",sx:{color:"text.secondary"}}):null,[null===l||void 0===l?void 0:l.id,null===l||void 0===l?void 0:l.name,null===g||void 0===g?void 0:g.email]);return s||h||f?(0,O.jsx)(o.A,{sx:{display:"flex",alignItems:"center",p:.5},children:(0,O.jsx)(ue.A,{size:24})}):l?(0,O.jsxs)(O.Fragment,{children:[(0,O.jsx)(P.A,{title:l.id.startsWith("user_")?"My Workspace (".concat(null===g||void 0===g?void 0:g.email,")"):"".concat(l.name," - Shared Workspace"),enterDelay:500,leaveDelay:200,disableInteractive:!0,placement:"bottom",children:(0,O.jsx)(u.A,{id:"group-selector-button","aria-controls":A?"group-menu":void 0,"aria-haspopup":"true","aria-expanded":A?"true":void 0,onClick:e=>{t(e.currentTarget)},size:"small",sx:{p:.5,transition:"background-color 0.2s","&:hover":{backgroundColor:"action.hover"}},children:w})}),(0,O.jsxs)(p.A,{id:"group-menu",anchorEl:e,open:A,onClose:b,disableScrollLock:!0,keepMounted:!1,TransitionProps:{timeout:350},anchorOrigin:{vertical:"bottom",horizontal:"right"},transformOrigin:{vertical:"top",horizontal:"right"},slotProps:{paper:{elevation:2,sx:{minWidth:280,maxHeight:400,mt:.5,overflow:"auto",filter:"drop-shadow(0px 2px 8px rgba(0,0,0,0.08))"}}},MenuListProps:{"aria-labelledby":"group-selector-button",sx:{py:0}},children:[(0,O.jsx)(o.A,{sx:{px:2,py:1,borderBottom:1,borderColor:"divider"},children:(0,O.jsx)(c.A,{variant:"subtitle2",color:"text.secondary",children:"Switch Workspace"})}),n.length>0&&(0,O.jsx)(te.A,{}),n.map(e=>{const t=e.id.startsWith("user_"),n=(null===l||void 0===l?void 0:l.id)===e.id;return(0,O.jsxs)(de.A,{onClick:()=>(async e=>{try{if((null===l||void 0===l?void 0:l.id)===e.id)return void b();m(!0),x(),localStorage.setItem("selectedGroupId",e.id),e.id.startsWith("user_")&&localStorage.setItem("userEmail",e.name),d(e),b();const t=e.id.startsWith("user_")?"My Workspace":"".concat(e.name," workspace");os.Ay.success("Switched to ".concat(t)),setTimeout(()=>{window.location.reload()},300)}catch(t){os.Ay.error("Failed to switch group")}})(e),selected:n,sx:{minHeight:48,px:2,py:1,"&.Mui-selected":{backgroundColor:"action.selected","&:hover":{backgroundColor:"action.selected"}}},children:[(0,O.jsx)(it.A,{sx:{minWidth:36},children:t?(0,O.jsx)(as.A,{fontSize:"small",sx:{color:n?"primary.main":"text.secondary"}}):(0,O.jsx)(is.A,{fontSize:"small",sx:{color:n?"primary.main":"text.secondary"}})}),(0,O.jsx)(ot.A,{primary:(0,O.jsxs)(o.A,{sx:{display:"flex",alignItems:"center",gap:1},children:[(0,O.jsx)(c.A,{variant:"body2",sx:{fontWeight:n?600:400},children:t?"My Workspace":e.name}),n&&(0,O.jsx)(R.A,{label:"Active",size:"small",color:"primary",sx:{height:20}})]}),secondary:(0,O.jsx)(c.A,{variant:"caption",color:"text.secondary",children:t?"Personal - ".concat(null===g||void 0===g?void 0:g.email):"Shared workspace"}),sx:{my:0}}),e.user_role&&!t&&(0,O.jsx)(R.A,{label:e.user_role,size:"small",color:j(e.user_role),sx:{ml:1}})]},e.id)}),0===n.length&&(0,O.jsx)(de.A,{disabled:!0,children:(0,O.jsx)(c.A,{variant:"body2",color:"text.secondary",children:"No groups available"})})]})]}):(0,O.jsx)(o.A,{sx:{display:"flex",alignItems:"center",p:.5},children:(0,O.jsx)(ns.A,{sx:{width:24,height:24,fontSize:"0.75rem",bgcolor:"grey.400"},children:"?"})})},ds=e=>{let{onRunTab:t,isRunning:n=!1,runningTabId:s=null,onLoadCrew:h,onLoadAgents:m,onLoadTasks:g,disabled:f=!1}=e;const{isDarkMode:A}=v(),{tabs:y,activeTabId:b,createTab:j,closeTab:w,setActiveTab:k,updateTabName:S,duplicateTab:_,clearAllTabs:E,clearTabExecutionStatus:I}=C(),[T,D]=(0,i.useState)(null),[N,M]=(0,i.useState)({anchorEl:null}),[z,L]=(0,i.useState)({open:!1,tabId:"",currentName:""}),[F,W]=(0,i.useState)({open:!1,tabId:"",tabName:""}),[K,G]=(0,i.useState)(!1),J=()=>{M({anchorEl:null})},q=e=>{if("save"===e){const e=y.find(e=>e.id===F.tabId);if(e&&e.savedCrewId)if("loaded"===e.savedCrewId){var t,n;const a=e.nodes.find(e=>{var t;return"agentNode"===e.type&&(null===(t=e.data)||void 0===t?void 0:t.agentId)});null!==a&&void 0!==a&&null!==(t=a.data)&&void 0!==t&&t.agentId;const s=e.nodes.find(e=>{var t;return"taskNode"===e.type&&(null===(t=e.data)||void 0===t?void 0:t.taskId)});if(null!==s&&void 0!==s&&null!==(n=s.data)&&void 0!==n&&n.taskId,e.name&&(a||s)){const t=new CustomEvent("updateExistingCrewByName",{detail:{tabId:F.tabId,crewName:e.name}});window.dispatchEvent(t);const n=()=>{w(F.tabId),window.removeEventListener("updateCrewComplete",n)};window.addEventListener("updateCrewComplete",n)}else{const e=new CustomEvent("openSaveCrewDialog");window.dispatchEvent(e);const t=()=>{w(F.tabId),window.removeEventListener("saveCrewComplete",t)};window.addEventListener("saveCrewComplete",t)}}else{const t=new CustomEvent("updateExistingCrew",{detail:{tabId:F.tabId,crewId:e.savedCrewId}});window.dispatchEvent(t);const n=()=>{w(F.tabId),window.removeEventListener("updateCrewComplete",n)};window.addEventListener("updateCrewComplete",n)}else{const e=new CustomEvent("openSaveCrewDialog");window.dispatchEvent(e);const t=()=>{w(F.tabId),window.removeEventListener("saveCrewComplete",t)};window.addEventListener("saveCrewComplete",t)}}else"discard"===e&&w(F.tabId);W({open:!1,tabId:"",tabName:""})},Y=()=>{D(null)},X=()=>{z.currentName.trim()&&S(z.tabId,z.currentName.trim()),L({open:!1,tabId:"",currentName:""})};return i.useEffect(()=>{0===y.length&&j("Main Canvas")},[y.length,j]),i.useEffect(()=>{const e=[];return y.forEach(t=>{if(t.executionStatus&&"running"!==t.executionStatus&&t.lastExecutionTime){const n=3e5-(Date.now()-new Date(t.lastExecutionTime).getTime());if(n>0){const a=setTimeout(()=>{I(t.id)},n);e.push(a)}else I(t.id)}}),()=>{e.forEach(e=>clearTimeout(e))}},[y,I]),(0,O.jsxs)(O.Fragment,{children:[(0,O.jsxs)(o.A,{sx:{borderBottom:1,borderColor:"divider",backgroundColor:A?"#1a1a1a":"#ffffff",display:"flex",alignItems:"center",minHeight:"48px",height:"48px",paddingLeft:1,paddingRight:1,position:"relative",zIndex:1001,overflow:"hidden"},children:[(0,O.jsxs)(o.A,{sx:{display:"flex",alignItems:"center",flex:1},children:[(0,O.jsx)(ea.A,{value:b||!1,onChange:(e,t)=>{f||k(t)},variant:"scrollable",scrollButtons:"auto",sx:{minWidth:0,opacity:f?.6:1,pointerEvents:f?"none":"auto","& .MuiTab-root":{minHeight:"40px",textTransform:"none",fontSize:"0.875rem",fontWeight:500,padding:"8px 12px",minWidth:"auto",maxWidth:"200px",cursor:f?"not-allowed":"pointer","&.Mui-selected":{color:A?"#90caf9":"#1976d2"}},"& .MuiTabs-indicator":{backgroundColor:A?"#90caf9":"#1976d2"}},children:y.map(e=>(0,O.jsx)(ta.A,{value:e.id,onContextMenu:t=>{return n=t,a=e.id,void(f||(n.preventDefault(),D({mouseX:n.clientX-2,mouseY:n.clientY-4,tabId:a})));var n,a},label:(0,O.jsxs)(o.A,{sx:{display:"flex",alignItems:"center",gap:1,maxWidth:"180px"},children:[(0,O.jsx)(c.A,{variant:"body2",sx:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",flex:1},children:e.name}),(0,O.jsxs)(o.A,{sx:{display:"flex",alignItems:"center",gap:.5},children:[e.isDirty&&(0,O.jsx)(P.A,{title:"Unsaved changes",children:(0,O.jsx)(o.A,{sx:{width:6,height:6,borderRadius:"50%",backgroundColor:A?"#ff9800":"#f57c00"}})}),e.savedCrewId&&!e.isDirty&&(0,O.jsx)(P.A,{title:"Saved as: ".concat(e.savedCrewName),children:(0,O.jsx)(Wn.A,{sx:{fontSize:12,color:"success.main"}})}),s===e.id&&n||"running"===e.executionStatus?(0,O.jsx)(R.A,{size:"small",label:"Running",color:"success",sx:{height:16,fontSize:"0.6rem","& .MuiChip-label":{px:.5}}}):null,"completed"===e.executionStatus&&(0,O.jsx)(P.A,{title:e.lastExecutionTime?"Completed at ".concat(new Date(e.lastExecutionTime).toLocaleTimeString()):"Completed",children:(0,O.jsx)(R.A,{size:"small",label:"Completed",color:"success",variant:"outlined",sx:{height:16,fontSize:"0.6rem","& .MuiChip-label":{px:.5}}})}),"failed"===e.executionStatus&&(0,O.jsx)(P.A,{title:e.lastExecutionTime?"Failed at ".concat(new Date(e.lastExecutionTime).toLocaleTimeString()):"Failed",children:(0,O.jsx)(R.A,{size:"small",label:"Failed",color:"error",variant:"outlined",sx:{height:16,fontSize:"0.6rem","& .MuiChip-label":{px:.5}}})}),y.length>1&&(0,O.jsx)(u.A,{size:"small",onClick:t=>((e,t)=>{if(f)return;t.stopPropagation();const n=y.find(t=>t.id===e);n&&n.isDirty?W({open:!0,tabId:e,tabName:n.name}):w(e)})(e.id,t),sx:{width:16,height:16,padding:0,"&:hover":{backgroundColor:A?"rgba(255,255,255,0.1)":"rgba(0,0,0,0.1)"}},children:(0,O.jsx)(U.A,{sx:{fontSize:12}})})]})]})},e.id))}),(0,O.jsx)(P.A,{title:f?"Tab operations disabled during processing":"New Tab Options",children:(0,O.jsx)("span",{children:(0,O.jsx)(u.A,{onClick:e=>{M({anchorEl:e.currentTarget})},disabled:f,size:"small",sx:{marginLeft:1,padding:"6px",color:A?"rgba(255,255,255,0.7)":"rgba(0,0,0,0.6)","&:hover":{backgroundColor:A?"rgba(255,255,255,0.1)":"rgba(0,0,0,0.1)",color:A?"rgba(255,255,255,0.9)":"rgba(0,0,0,0.8)"},"&.Mui-disabled":{color:A?"rgba(255,255,255,0.3)":"rgba(0,0,0,0.3)"}},children:(0,O.jsxs)(o.A,{sx:{display:"flex",alignItems:"center",gap:.5},children:[(0,O.jsx)(H.A,{sx:{fontSize:18}}),(0,O.jsx)(Ga.A,{sx:{fontSize:14}})]})})})})]}),(0,O.jsx)(o.A,{sx:{display:"flex",alignItems:"center",pl:.25,pr:.75,flexShrink:0,width:"auto",transition:"none"},children:(0,O.jsx)(ls,{})})]}),(0,O.jsxs)(p.A,{open:Boolean(N.anchorEl),onClose:J,anchorEl:N.anchorEl,anchorOrigin:{vertical:"bottom",horizontal:"center"},transformOrigin:{vertical:"top",horizontal:"center"},children:[(0,O.jsxs)(de.A,{onClick:()=>{f||(j(),J())},children:[(0,O.jsx)(it.A,{children:(0,O.jsx)(Ja.A,{sx:{fontSize:18}})}),(0,O.jsx)(ot.A,{primary:"New Empty Canvas",secondary:"Start with a blank canvas"})]}),(0,O.jsxs)(de.A,{onClick:()=>{h&&h(),J()},children:[(0,O.jsx)(it.A,{children:(0,O.jsx)(qa.A,{sx:{fontSize:18}})}),(0,O.jsx)(ot.A,{primary:"Load Existing Plans",secondary:"Opens in a new tab"})]}),(0,O.jsxs)(de.A,{onClick:()=>{m&&m(),J()},children:[(0,O.jsx)(it.A,{children:(0,O.jsx)(Ya.A,{sx:{fontSize:18}})}),(0,O.jsx)(ot.A,{primary:"Load Existing Agents",secondary:"Adds to current tab"})]}),(0,O.jsxs)(de.A,{onClick:()=>{g&&g(),J()},children:[(0,O.jsx)(it.A,{children:(0,O.jsx)(Xa.A,{sx:{fontSize:18}})}),(0,O.jsx)(ot.A,{primary:"Load Existing Tasks",secondary:"Adds to current tab"})]})]}),(0,O.jsxs)(p.A,{open:null!==T,onClose:Y,anchorReference:"anchorPosition",anchorPosition:null!==T?{top:T.mouseY,left:T.mouseX}:void 0,children:[(0,O.jsxs)(de.A,{onClick:()=>(e=>{const t=y.find(t=>t.id===e);t&&L({open:!0,tabId:e,currentName:t.name}),Y()})((null===T||void 0===T?void 0:T.tabId)||""),children:[(0,O.jsx)(Za.A,{sx:{mr:1,fontSize:18}}),"Rename"]}),(0,O.jsxs)(de.A,{onClick:()=>{return e=(null===T||void 0===T?void 0:T.tabId)||"",_(e),void Y();var e},children:[(0,O.jsx)(Qa.A,{sx:{mr:1,fontSize:18}}),"Duplicate"]}),(0,O.jsxs)(de.A,{onClick:()=>{return e=(null===T||void 0===T?void 0:T.tabId)||"",k(e),setTimeout(()=>{const e=new CustomEvent("openSaveCrewDialog");window.dispatchEvent(e)},100),void Y();var e},children:[(0,O.jsx)(Wn.A,{sx:{mr:1,fontSize:18}}),"Save Crew"]}),(0,O.jsxs)(de.A,{onClick:()=>{return e=(null===T||void 0===T?void 0:T.tabId)||"",t&&t(e),void Y();var e},disabled:n,children:[(0,O.jsx)($a.A,{sx:{mr:1,fontSize:18}}),"Run This Tab"]}),(()=>{const e=y.find(e=>e.id===(null===T||void 0===T?void 0:T.tabId));return null!==e&&void 0!==e&&e.executionStatus&&"running"!==e.executionStatus?(0,O.jsxs)(de.A,{onClick:()=>{I((null===T||void 0===T?void 0:T.tabId)||""),Y()},children:[(0,O.jsx)(U.A,{sx:{mr:1,fontSize:18}}),"Clear Execution Status"]}):null})(),y.length>1&&(0,O.jsxs)(de.A,{onClick:()=>{const e=y.find(e=>e.id===(null===T||void 0===T?void 0:T.tabId));e&&e.isDirty?W({open:!0,tabId:(null===T||void 0===T?void 0:T.tabId)||"",tabName:e.name}):w((null===T||void 0===T?void 0:T.tabId)||""),Y()},children:[(0,O.jsx)(U.A,{sx:{mr:1,fontSize:18}}),"Close Tab"]}),y.length>0&&(0,O.jsxs)(O.Fragment,{children:[(0,O.jsx)(te.A,{}),(0,O.jsxs)(de.A,{onClick:()=>{y.some(e=>e.isDirty)?G(!0):(E(),j()),Y()},children:[(0,O.jsx)(es.A,{sx:{mr:1,fontSize:18}}),"Close All Tabs"]})]})]}),(0,O.jsxs)(r.A,{open:z.open,onClose:()=>L({open:!1,tabId:"",currentName:""}),maxWidth:"sm",fullWidth:!0,children:[(0,O.jsx)(d.A,{children:"Rename Tab"}),(0,O.jsx)(l.A,{children:(0,O.jsx)(V.A,{autoFocus:!0,margin:"dense",label:"Tab Name",fullWidth:!0,variant:"outlined",value:z.currentName,onChange:e=>L(t=>(0,a.A)((0,a.A)({},t),{},{currentName:e.target.value})),onKeyPress:e=>{"Enter"===e.key&&X()}})}),(0,O.jsxs)(B.A,{children:[(0,O.jsx)(x.A,{onClick:()=>L({open:!1,tabId:"",currentName:""}),children:"Cancel"}),(0,O.jsx)(x.A,{onClick:X,variant:"contained",children:"Rename"})]})]}),(0,O.jsxs)(r.A,{open:F.open,onClose:()=>W({open:!1,tabId:"",tabName:""}),maxWidth:"sm",fullWidth:!0,children:[(0,O.jsxs)(d.A,{sx:{display:"flex",alignItems:"center",gap:1},children:[(0,O.jsx)(ts.A,{color:"warning"}),"Unsaved Changes"]}),(0,O.jsx)(l.A,{children:(0,O.jsxs)(c.A,{children:['The tab "',F.tabName,'" has unsaved changes. Do you want to save your changes before closing?']})}),(0,O.jsxs)(B.A,{children:[(0,O.jsx)(x.A,{onClick:()=>q("cancel"),color:"inherit",children:"Cancel"}),(0,O.jsx)(x.A,{onClick:()=>q("discard"),color:"error",children:"Discard Changes"}),(0,O.jsx)(x.A,{onClick:()=>q("save"),variant:"contained",color:"primary",children:"Save & Close"})]})]}),(0,O.jsxs)(r.A,{open:K,onClose:()=>G(!1),maxWidth:"sm",fullWidth:!0,children:[(0,O.jsx)(d.A,{children:(0,O.jsxs)(o.A,{sx:{display:"flex",alignItems:"center",gap:1},children:[(0,O.jsx)(ts.A,{color:"warning"}),"Close All Tabs"]})}),(0,O.jsxs)(l.A,{children:[(0,O.jsx)(c.A,{children:"Some tabs have unsaved changes. Do you want to save all changes before closing?"}),y.filter(e=>e.isDirty).length>0&&(0,O.jsxs)(o.A,{sx:{mt:2},children:[(0,O.jsx)(c.A,{variant:"body2",color:"text.secondary",children:"Tabs with unsaved changes:"}),(0,O.jsx)(o.A,{sx:{mt:1},children:y.filter(e=>e.isDirty).map(e=>(0,O.jsx)(R.A,{label:e.name,size:"small",sx:{mr:1,mb:1}},e.id))})]})]}),(0,O.jsxs)(B.A,{children:[(0,O.jsx)(x.A,{onClick:()=>G(!1),color:"inherit",children:"Cancel"}),(0,O.jsx)(x.A,{onClick:()=>{E(),j(),G(!1)},color:"error",children:"Discard All Changes"}),(0,O.jsx)(x.A,{onClick:()=>{G(!1)},variant:"contained",color:"primary",children:"Save All & Close"})]})]})]})};var cs=n(87960),us=n(68476),hs=n(29044),ms=n(90037),ps=n(44564),xs=n(52853),gs=n(4804),fs=n(63589);const vs=new class{async dispatch(e){try{return(await ye.uE.post("/dispatcher/dispatch",e)).data}catch(t){throw t}}async detectIntent(e){try{return(await ye.uE.post("/dispatcher/detect-intent",e)).data}catch(t){throw t}}},As=(0,j.vt)()((0,w.eh)((e,t)=>({messagesBySession:{},currentSessionId:null,setCurrentSession:t=>{e({currentSessionId:t})},addMessage:(t,n)=>{e(e=>{const s=e.messagesBySession[t]||[];if(s.some(e=>e.id===n.id))return e;const i=[...s,n];return{messagesBySession:(0,a.A)((0,a.A)({},e.messagesBySession),{},{[t]:i})}})},addMessages:(t,n)=>{e(e=>{const s=e.messagesBySession[t]||[],i=new Set(s.map(e=>e.id)),o=n.filter(e=>!i.has(e.id));if(0===o.length)return e;const r=[...s,...o];return{messagesBySession:(0,a.A)((0,a.A)({},e.messagesBySession),{},{[t]:r})}})},setMessages:(t,n)=>{e(e=>({messagesBySession:(0,a.A)((0,a.A)({},e.messagesBySession),{},{[t]:n})}))},removeMessage:(t,n)=>{e(e=>{const s=(e.messagesBySession[t]||[]).filter(e=>e.id!==n);return{messagesBySession:(0,a.A)((0,a.A)({},e.messagesBySession),{},{[t]:s})}})},clearSession:t=>{e(e=>{const n=(0,a.A)({},e.messagesBySession);return delete n[t],{messagesBySession:n,currentSessionId:e.currentSessionId===t?null:e.currentSessionId}})},clearAllSessions:()=>{e({messagesBySession:{},currentSessionId:null})},getMessages:e=>t().messagesBySession[e]||[],getDeduplicatedMessages:e=>(e=>{const t=new Set,n=new Map;return e.filter(e=>{if(t.has(e.id))return!1;const a="".concat(e.type,":").concat(e.content,":").concat(e.timestamp.getTime()),s="".concat(e.type,"-").concat(e.content.substring(0,100)),i=Array.from(n.entries());for(const[t,n]of i){const a=Math.abs(e.timestamp.getTime()-n.timestamp.getTime());if(t.includes(s)&&a<1e3&&n.type===e.type)return!1}return t.add(e.id),n.set(a,e),!0})})(t().messagesBySession[e]||[])})));class ys{static async validateConfig(e){try{return(await ye.uE.post("/memory-backend/validate",e)).data}catch(n){var t;return{valid:!1,errors:[n instanceof Le.pe?null===(t=n.response)||void 0===t||null===(t=t.data)||void 0===t?void 0:t.detail:"Failed to validate configuration"]}}}static async testDatabricksConnection(e){try{return(await ye.uE.post("/memory-backend/databricks/test-connection",e)).data}catch(n){var t;const e=n instanceof Le.pe?null===(t=n.response)||void 0===t||null===(t=t.data)||void 0===t?void 0:t.detail:n instanceof Error?n.message:"Failed to test connection";return{success:!1,message:e||"Failed to test connection",details:{error:e}}}}static async getAvailableDatabricksIndexes(e,t){try{return(await ye.uE.post("/memory-backend/databricks/indexes",(0,a.A)({endpoint_name:e},t))).data}catch(s){var n;const e=s instanceof Le.pe?null===(n=s.response)||void 0===n||null===(n=n.data)||void 0===n?void 0:n.detail:"Failed to fetch indexes";throw new Error(e||"Failed to fetch indexes")}}static async saveConfig(e){try{return(await ye.uE.post("/memory-backend/config",e)).data}catch(n){var t;return{success:!1,message:(n instanceof Le.pe?null===(t=n.response)||void 0===t||null===(t=t.data)||void 0===t?void 0:t.detail:"Failed to save configuration")||"Failed to save configuration"}}}static async getConfig(){try{const e=(await ye.uE.get("/memory-backend/configs")).data;if(!e||0===e.length)return null;const t=e.find(e=>e.is_default&&e.is_active);return t||null}catch(e){return null}}static async getMemoryStats(e){try{return(await ye.uE.get("/memory-backend/stats/".concat(e))).data}catch(t){return{}}}static async clearMemory(e,t){try{return(await ye.uE.post("/memory-backend/clear/".concat(e),{memory_types:t})).data}catch(a){var n;return{success:!1,message:(a instanceof Le.pe?null===(n=a.response)||void 0===n||null===(n=n.data)||void 0===n?void 0:n.detail:"Failed to clear memory")||"Failed to clear memory"}}}static async createDatabricksIndex(e,t,n,a,s){let i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"id";try{return(await ye.uE.post("/memory-backend/databricks/create-index",{config:e,index_type:t,catalog:n,schema:a,table_name:s,primary_key:i})).data}catch(r){var o;const e=r instanceof Le.pe?null===(o=r.response)||void 0===o||null===(o=o.data)||void 0===o?void 0:o.detail:"Failed to create index";return{success:!1,message:e||"Failed to create index",details:{error:e}}}}static async oneClickDatabricksSetup(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"ml",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"agents";try{return(await ye.uE.post("/memory-backend/databricks/one-click-setup",{workspace_url:e,catalog:t,schema:n})).data}catch(s){var a;const e=s instanceof Le.pe?null===(a=s.response)||void 0===a||null===(a=a.data)||void 0===a?void 0:a.detail:"Failed to complete setup";return{success:!1,message:e||"Failed to complete setup",error:e}}}}let bs=function(e){return e.DEFAULT="default",e.DATABRICKS="databricks",e}({});const js={backend_type:bs.DEFAULT,enable_short_term:!0,enable_long_term:!0,enable_entity:!0,enable_relationship_retrieval:!1},ws={endpoint_name:"",short_term_index:"",embedding_dimension:768,auth_type:"default"},ks=e=>{if(!e||"object"!==typeof e||null===e)return!1;const t=e;if(!Object.values(bs).includes(t.backend_type))return!1;if(t.backend_type===bs.DATABRICKS){const e=t.databricks_config;if(!e)return!1;if(!e.endpoint_name||!e.short_term_index)return!1}return!0},Cs=(0,j.vt)()((0,w.eh)((e,t)=>({isMemoryBackendConfigured:!1,isKnowledgeSourceEnabled:!1,isLoading:!1,lastChecked:0,hasCheckedOnce:!1,lastNotFoundTime:0,setMemoryBackendConfigured:t=>{e({isMemoryBackendConfigured:t})},setKnowledgeSourceEnabled:t=>{e({isKnowledgeSourceEnabled:t})},checkConfiguration:async()=>{const n=Date.now(),a=t();if(!(a.hasCheckedOnce&&a.lastNotFoundTime>0&&n-a.lastNotFoundTime<3e5)&&(!(n-a.lastChecked<1e3)||a.isLoading)){e({isLoading:!0,lastChecked:n});try{var s,i;const t=await ys.getConfig(),a=!((null===t||void 0===t?void 0:t.backend_type)!==bs.DATABRICKS||null===(s=t.databricks_config)||void 0===s||!s.endpoint_name||null===(i=t.databricks_config)||void 0===i||!i.short_term_index),o=await ke.O.getConfiguration(),r=!(null===o||void 0===o||!o.knowledge_volume_enabled||null===o||void 0===o||!o.knowledge_volume_path);e(t||o?{isMemoryBackendConfigured:a,isKnowledgeSourceEnabled:r,isLoading:!1,hasCheckedOnce:!0,lastNotFoundTime:0}:{isMemoryBackendConfigured:!1,isKnowledgeSourceEnabled:!1,isLoading:!1,hasCheckedOnce:!0,lastNotFoundTime:n})}catch(o){e({isMemoryBackendConfigured:!1,isKnowledgeSourceEnabled:!1,isLoading:!1,hasCheckedOnce:!0,lastNotFoundTime:n})}}},refreshConfiguration:async()=>{e({lastChecked:0,lastNotFoundTime:0}),await t().checkConfiguration()}})));let Ss=null;Cs.subscribe(e=>e.isMemoryBackendConfigured,()=>{Ss||(Cs.getState().checkConfiguration(),Ss=setInterval(()=>{Cs.getState().checkConfiguration()},3e4))}),"undefined"!==typeof window&&(window.addEventListener("databricks-config-updated",()=>{Cs.getState().refreshConfiguration()}),window.addEventListener("memory-backend-updated",()=>{Cs.getState().refreshConfiguration()}),window.addEventListener("focus",()=>{Cs.getState().checkConfiguration()}));class _s{static async saveMessage(e){return(await ye.uE.post("/chat-history/messages",e)).data}static async getSessionMessages(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:50;return(await ye.uE.get("/chat-history/sessions/".concat(e,"/messages"),{params:{page:t,per_page:n}})).data}static async getUserSessions(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:20;return(await ye.uE.get("/chat-history/users/sessions",{params:{page:e,per_page:t}})).data}static async getGroupSessions(){let e=arguments.length>2?arguments[2]:void 0;const t={page:arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,per_page:arguments.length>1&&void 0!==arguments[1]?arguments[1]:20};e&&(t.user_id=e);return(await ye.uE.get("/chat-history/sessions",{params:t})).data}static async deleteSession(e){await ye.uE.delete("/chat-history/sessions/".concat(e))}static async createNewSession(){return(await ye.uE.post("/chat-history/sessions/new")).data}static generateSessionId(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){const t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)})}}var Es=n(9030);class Is{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{margin:20,minNodeSpacing:50};this.uiState=void 0,this.margin=void 0,this.minNodeSpacing=void 0,this.margin=e.margin,this.minNodeSpacing=e.minNodeSpacing,this.uiState=(0,a.A)({screenWidth:"undefined"!==typeof window?window.innerWidth:1200,screenHeight:"undefined"!==typeof window?window.innerHeight:800,tabBarHeight:48,leftSidebarVisible:!0,leftSidebarExpanded:!1,leftSidebarBaseWidth:48,leftSidebarExpandedWidth:280,rightSidebarVisible:!0,rightSidebarWidth:48,chatPanelVisible:!0,chatPanelCollapsed:!1,chatPanelWidth:450,chatPanelCollapsedWidth:60,executionHistoryVisible:!1,executionHistoryHeight:60,panelPosition:50,areFlowsVisible:!0},e.defaultUIState)}updateUIState(e){this.uiState=(0,a.A)((0,a.A)({},this.uiState),e)}updateScreenDimensions(e,t){this.uiState.screenWidth=e,this.uiState.screenHeight=t}getAvailableCanvasArea(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"full",t=0;const n=this.uiState.tabBarHeight;let a=this.uiState.screenWidth,s=this.uiState.screenHeight-this.uiState.tabBarHeight;if(this.uiState.leftSidebarVisible){const e=this.uiState.leftSidebarExpanded?this.uiState.leftSidebarExpandedWidth:this.uiState.leftSidebarBaseWidth;t+=e,a-=e}if(this.uiState.rightSidebarVisible&&(a-=this.uiState.rightSidebarWidth),this.uiState.chatPanelVisible){a-=this.uiState.chatPanelCollapsed?this.uiState.chatPanelCollapsedWidth:this.uiState.chatPanelWidth}if(this.uiState.executionHistoryVisible&&(s-=this.uiState.executionHistoryHeight),"crew"===e&&this.uiState.areFlowsVisible)a*=this.uiState.panelPosition/100;else if("flow"===e&&this.uiState.areFlowsVisible){t+=a*(this.uiState.panelPosition/100),a*=(100-this.uiState.panelPosition)/100}return{x:t+this.margin,y:n+this.margin,width:Math.max(200,a-2*this.margin),height:Math.max(150,s-2*this.margin)}}getAgentNodePosition(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"crew";const n=this.getAvailableCanvasArea(t),a=e.filter(e=>"agentNode"===e.type),s=Is.NODE_DIMENSIONS.agentNode,i=n.width<600,o=i?Math.max(20,this.minNodeSpacing/2):this.minNodeSpacing;return 0===a.length?{x:n.x+o,y:n.y+o}:i?this.findSmartAgentPosition(a,n,o):this.findOptimalPosition(a,s,n,"vertical")}getTaskNodePosition(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"crew";const n=this.getAvailableCanvasArea(t),a=e.filter(e=>"taskNode"===e.type),s=e.filter(e=>"agentNode"===e.type),i=n.width<600,o=i?Math.max(20,this.minNodeSpacing/2):this.minNodeSpacing;return 0===a.length?s.length>0?this.getFirstTaskPosition(s,n,o,i):{x:n.x+o,y:n.y+o}:this.findVerticalTaskPosition(a,n,o)}getFlowNodePosition(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"flow";const n=this.getAvailableCanvasArea(t),a=e.filter(e=>"flowNode"===e.type),s=Is.NODE_DIMENSIONS.flowNode;return 0===a.length?{x:n.x+(n.width-s.width)/2,y:n.y+50}:this.findOptimalPosition(a,s,n,"horizontal")}getCrewLayoutPositions(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"crew";const a=this.getAvailableCanvasArea(n),s=Is.NODE_DIMENSIONS.agentNode,i=Is.NODE_DIMENSIONS.taskNode,o=[],r=[],l=a.width<600,d=l?Math.max(20,this.minNodeSpacing/2):this.minNodeSpacing;if(l)return this.getCompactCrewLayout(e,t,a,d);const c=Math.max(1,Math.floor(a.height/(s.height+d))),u=t>0?1:0,h=Math.ceil(e/c)*(s.width+d),m=h+u*(i.width+d),p=a.x;for(let b=0;b<e;b++){const e=b%c,t=p+Math.floor(b/c)*(s.width+d),n=a.y+e*(s.height+d);o.push({x:t,y:n})}const x=p+h;for(let b=0;b<t;b++){const e=x,t=a.y+b*(i.height+d);r.push({x:e,y:t})}const g=[...o,...r];if(0===g.length)return{agentPositions:[],taskPositions:[],layoutBounds:{x:a.x,y:a.y,width:0,height:0},shouldAutoFit:!1};const f=Math.min(...g.map(e=>e.x)),v=Math.max(...g.map(e=>e.x),...o.map(e=>e.x+s.width),...r.map(e=>e.x+i.width)),A=Math.min(...g.map(e=>e.y)),y={x:f,y:A,width:v-f,height:Math.max(...g.map(e=>e.y),...o.map(e=>e.y+s.height),...r.map(e=>e.y+i.height))-A};return{agentPositions:o,taskPositions:r,layoutBounds:y,shouldAutoFit:m>a.width||y.height>a.height}}getCompactCrewLayout(e,t,n,a){const s=Is.NODE_DIMENSIONS.agentNode,i=Is.NODE_DIMENSIONS.taskNode,o=[],r=[],l=(e>0?1:0)+(t>0?1:0),d=n.width-a*(l+1),c=l>0?d/l:n.width,u=Math.max(140,Math.min(200,c));if(e>0){const t=n.x+a;for(let i=0;i<e;i++){const e=n.y+i*(s.height+a);o.push({x:t,y:e})}}if(t>0){const s=e>0?n.x+a+u+a:n.x+a;for(let e=0;e<t;e++){const t=n.y+e*(i.height+a);r.push({x:s,y:t})}}const h=[...o,...r];if(0===h.length)return{agentPositions:[],taskPositions:[],layoutBounds:{x:n.x,y:n.y,width:0,height:0},shouldAutoFit:!1};const m=Math.min(...h.map(e=>e.x)),p=Math.max(...h.map(e=>e.x+u)),x=Math.min(...h.map(e=>e.y)),g={x:m,y:x,width:p-m,height:Math.max(...o.map(e=>e.y+s.height),...r.map(e=>e.y+i.height))-x};return{agentPositions:o,taskPositions:r,layoutBounds:g,shouldAutoFit:g.width>n.width||g.height>n.height}}findSmartAgentPosition(e,t,n){const a=Is.NODE_DIMENSIONS.agentNode,s=e.reduce((e,t)=>t.position.y>e.position.y?t:e),i=s.position.y+a.height+n;if(i+a.height<=t.y+t.height)return{x:s.position.x,y:i};return{x:e.reduce((e,t)=>t.position.x>e.position.x?t:e).position.x+a.width+n,y:t.y+n}}getFirstTaskPosition(e,t,n,a){const s=Is.NODE_DIMENSIONS.agentNode;if(a){return{x:e.reduce((e,t)=>t.position.x>e.position.x?t:e).position.x+s.width+n,y:t.y+n}}const i=e.reduce((e,t)=>t.position.x>e.position.x?t:e);return{x:i.position.x+s.width+n,y:i.position.y}}findVerticalTaskPosition(e,t,n){const a=Is.NODE_DIMENSIONS.taskNode,s=e.reduce((e,t)=>t.position.y>e.position.y?t:e),i=e[0].position.x,o=s.position.y+a.height+n;return a.height,t.y,t.height,{x:i,y:o}}findOptimalPosition(e,t,n){let a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"vertical";if("vertical"===a){const a=e.reduce((e,t)=>t.position.y>e.position.y?t:e),s=a.position.y+t.height+this.minNodeSpacing;if(s+t.height>n.y+n.height){const i=e.reduce((e,t)=>t.position.x>e.position.x?t:e).position.x+t.width+this.minNodeSpacing;return i+t.width<=n.x+n.width?{x:i,y:n.y}:{x:a.position.x,y:s}}return{x:a.position.x,y:s}}if("horizontal"===a){const a=e.reduce((e,t)=>t.position.x>e.position.x?t:e),s=a.position.x+t.width+this.minNodeSpacing;if(s+t.width>n.x+n.width){const a=e.reduce((e,t)=>t.position.y>e.position.y?t:e);return{x:n.x,y:a.position.y+t.height+this.minNodeSpacing}}return{x:s,y:a.position.y}}return{x:n.x,y:n.y}}wouldOverlap(e,t,n){const a=e.x,s=e.x+t.width,i=e.y,o=e.y+t.height;return n.some(e=>{const t=Is.NODE_DIMENSIONS[e.type||"default"]||Is.NODE_DIMENSIONS.default,n=e.position.x,r=e.position.x+t.width,l=e.position.y,d=e.position.y+t.height;return!(s+this.minNodeSpacing<n||a>r+this.minNodeSpacing||o+this.minNodeSpacing<l||i>d+this.minNodeSpacing)})}static getNodeDimensions(e){return Is.NODE_DIMENSIONS[e]||Is.NODE_DIMENSIONS.default}reorganizeNodes(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"full";const n=this.getAvailableCanvasArea(t),s=e.filter(e=>"agentNode"===e.type),i=e.filter(e=>"taskNode"===e.type),o=e.filter(e=>"flowNode"===e.type),r=[...e.filter(e=>!["agentNode","taskNode","flowNode"].includes(e.type||""))],l=Is.NODE_DIMENSIONS.agentNode;s.forEach((e,t)=>{r.push((0,a.A)((0,a.A)({},e),{},{position:{x:n.x,y:n.y+t*(l.height+this.minNodeSpacing)}}))});const d=Is.NODE_DIMENSIONS.taskNode,c=n.x+l.width+this.minNodeSpacing;i.forEach((e,t)=>{r.push((0,a.A)((0,a.A)({},e),{},{position:{x:c,y:n.y+t*(d.height+this.minNodeSpacing)}}))});const u=Is.NODE_DIMENSIONS.flowNode;return o.forEach((e,t)=>{r.push((0,a.A)((0,a.A)({},e),{},{position:{x:n.x+t*(u.width+this.minNodeSpacing),y:n.y+50}}))}),r}scalePositionsToFit(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"full";if(0===e.length)return e;const a=this.getAvailableCanvasArea(n),s=Math.min(...e.map(e=>e.x)),i=Math.max(...e.map(e=>e.x+t.width)),o=Math.min(...e.map(e=>e.y)),r=Math.max(...e.map(e=>e.y+t.height)),l=i-s,d=r-o,c=l>a.width?a.width/l:1,u=d>a.height?a.height/d:1,h=Math.min(c,u,1);return h>=1?e:e.map(e=>({x:a.x+(e.x-s)*h,y:a.y+(e.y-o)*h}))}getAutoFitZoom(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"full";const n=this.getAvailableCanvasArea(t),a=n.width<600,s=a?20:50,i=Math.max(100,n.width-2*s),o=Math.max(100,n.height-2*s),r=e.width>0?i/e.width:1,l=e.height>0?o/e.height:1,d=a?.3:.5,c=Math.min(r,l);return Math.max(d,Math.min(1,c))}getLayoutDebugInfo(){const e={full:this.getAvailableCanvasArea("full"),crew:this.getAvailableCanvasArea("crew"),flow:this.getAvailableCanvasArea("flow")},t=[];e.crew.width<400?t.push("\u274c CRITICAL: Canvas is extremely narrow. Collapse chat panel immediately!"):e.crew.width<600&&t.push("\u26a0\ufe0f Canvas width is narrow - collapse chat panel or reduce window elements"),e.crew.height<300?t.push("\u274c CRITICAL: Canvas height is too small. Reduce execution history height!"):e.crew.height<400&&t.push("\u26a0\ufe0f Canvas height is limited - consider reducing execution history height"),this.uiState.chatPanelVisible&&!this.uiState.chatPanelCollapsed&&this.uiState.chatPanelWidth>350&&t.push("\u{1f4a1} TIP: Reduce chat panel width or collapse it temporarily for better node visibility"),this.uiState.executionHistoryVisible&&this.uiState.executionHistoryHeight>200&&t.push("\u{1f4a1} TIP: Reduce execution history height to give more space for nodes");const n=(this.uiState.leftSidebarBaseWidth+this.uiState.rightSidebarWidth+(this.uiState.chatPanelVisible?this.uiState.chatPanelWidth:0))/this.uiState.screenWidth*100;return n>60&&t.push("\u{1f527} ACTION: UI elements take ".concat(Math.round(n),"% of screen width. Consider larger screen or hide panels.")),{uiState:this.uiState,availableAreas:e,recommendations:t}}}Is.NODE_DIMENSIONS={agentNode:{width:200,height:150},taskNode:{width:220,height:180},flowNode:{width:180,height:120},crewNode:{width:240,height:200},default:{width:200,height:150}};const Ts=e=>{try{const t=localStorage.getItem("ui-layout-storage")||"{}",n=JSON.parse(t),s=(0,a.A)((0,a.A)({},n),e);localStorage.setItem("ui-layout-storage",JSON.stringify(s))}catch(t){}},Ds=(()=>{try{const e=localStorage.getItem("ui-layout-storage");if(e)return JSON.parse(e)}catch(e){}return{}})(),Ns=(0,j.vt)((e,t)=>({screenWidth:"undefined"!==typeof window?window.innerWidth:1200,screenHeight:"undefined"!==typeof window?window.innerHeight:800,tabBarHeight:48,leftSidebarVisible:!0,leftSidebarExpanded:!1,leftSidebarBaseWidth:48,leftSidebarExpandedWidth:280,rightSidebarVisible:!0,rightSidebarWidth:48,chatPanelVisible:void 0===Ds.chatPanelVisible||Ds.chatPanelVisible,chatPanelCollapsed:void 0!==Ds.chatPanelCollapsed&&Ds.chatPanelCollapsed,chatPanelWidth:Ds.chatPanelWidth||450,chatPanelCollapsedWidth:60,executionHistoryVisible:void 0!==Ds.executionHistoryVisible&&Ds.executionHistoryVisible,executionHistoryHeight:Ds.executionHistoryHeight||60,panelPosition:Ds.panelPosition||50,areFlowsVisible:void 0===Ds.areFlowsVisible||Ds.areFlowsVisible,updateScreenDimensions:(t,n)=>e({screenWidth:t,screenHeight:n}),setChatPanelWidth:t=>{e({chatPanelWidth:t}),Ts({chatPanelWidth:t})},setChatPanelCollapsed:t=>{e({chatPanelCollapsed:t}),Ts({chatPanelCollapsed:t})},setChatPanelVisible:t=>{e({chatPanelVisible:t}),Ts({chatPanelVisible:t})},setExecutionHistoryHeight:t=>{e({executionHistoryHeight:t}),Ts({executionHistoryHeight:t})},setExecutionHistoryVisible:t=>{e({executionHistoryVisible:t}),Ts({executionHistoryVisible:t})},setLeftSidebarExpanded:t=>e({leftSidebarExpanded:t}),setPanelPosition:t=>{e({panelPosition:t}),Ts({panelPosition:t})},setAreFlowsVisible:t=>{e({areFlowsVisible:t}),Ts({areFlowsVisible:t})},getUILayoutState:()=>{const e=t();return{screenWidth:e.screenWidth,screenHeight:e.screenHeight,tabBarHeight:e.tabBarHeight,leftSidebarVisible:e.leftSidebarVisible,leftSidebarExpanded:e.leftSidebarExpanded,leftSidebarBaseWidth:e.leftSidebarBaseWidth,leftSidebarExpandedWidth:e.leftSidebarExpandedWidth,rightSidebarVisible:e.rightSidebarVisible,rightSidebarWidth:e.rightSidebarWidth,chatPanelVisible:e.chatPanelVisible,chatPanelCollapsed:e.chatPanelCollapsed,chatPanelWidth:e.chatPanelWidth,chatPanelCollapsedWidth:e.chatPanelCollapsedWidth,executionHistoryVisible:e.executionHistoryVisible,executionHistoryHeight:e.executionHistoryHeight,panelPosition:e.panelPosition,areFlowsVisible:e.areFlowsVisible}}})),Ps=e=>{const t=e.some(e=>"agentNode"===e.type),n=e.some(e=>"taskNode"===e.type);return t&&n},Ms=Ae.A.create({baseURL:ye.$W.apiUrl,headers:{"Content-Type":"application/json"},timeout:3e4});Ms.interceptors.request.use(e=>{const t=localStorage.getItem("token");t&&(e.headers.Authorization="Bearer ".concat(t));localStorage.getItem("mockUserEmail");return e},e=>Promise.reject(e)),Ms.interceptors.response.use(e=>e,e=>(e.response||e.request,Promise.reject(e)));const zs=e=>{if(!e.response)return!0;const t=e.response.status;return t>=500||408===t||429===t},Os=e=>1e3*Math.pow(2,e-1)+1e3*Math.random();async function Ls(e,t){let n;for(let s=1;s<=3;s++)try{return await e()}catch(a){if(n=a,3===s||!zs(a))throw a;const e=Os(s);await new Promise(t=>setTimeout(t,e))}throw n}class Fs{static async saveMessage(e){return Ls(async()=>(await Ms.post("/chat-history/messages",e)).data)}static async getSessionMessages(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:50;return Ls(async()=>(await Ms.get("/chat-history/sessions/".concat(e,"/messages"),{params:{page:t,per_page:n}})).data)}static async getUserSessions(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:20;return Ls(async()=>(await Ms.get("/chat-history/users/sessions",{params:{page:e,per_page:t}})).data)}static async getGroupSessions(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:20,n=arguments.length>2?arguments[2]:void 0;return Ls(async()=>{const a={page:e,per_page:t};n&&(a.user_id=n);return(await Ms.get("/chat-history/sessions",{params:a})).data})}static async deleteSession(e){return Ls(async()=>{await Ms.delete("/chat-history/sessions/".concat(e))})}static async createNewSession(){return Ls(async()=>(await Ms.post("/chat-history/sessions/new")).data)}static generateSessionId(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){const t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)})}}const Ws=["jobId","agentName","taskName","isIntermediate"],Rs=e=>{if(!e)return"";const t=String.fromCharCode(27),n=String.fromCharCode(7);return e.replace(new RegExp("".concat(t,"\\[[0-9;]*[ABCDEFGHJKLMSTfminsulh]"),"g"),"").replace(new RegExp("".concat(t,"\\][^").concat(n,"]*").concat(n),"g"),"").replace(new RegExp("".concat(t,"[NOPGKabcdfghinqrstuABCDHIJMOPRTl]"),"g"),"").replace(new RegExp("".concat(t,"[\\[\\]\\?\\(\\)#;0-9]*[0-9A-Za-z]"),"g"),"").replace(new RegExp(t,"g"),"")},Vs=/(https?:\/\/[^\s]+)/g;var Bs=n(75737);var Us=n(57191),Hs=n(38614),Ks=n(8808),Gs=n(36080),Js=n(35987),qs=n(52180);const Ys=["children","className"],Xs=e=>e.split(Vs).map((e,t)=>e.match(Vs)?(0,O.jsxs)(Gs.A,{href:e,target:"_blank",rel:"noopener noreferrer",sx:{display:"inline-flex",alignItems:"center",gap:.5,color:"primary.main",textDecoration:"none","&:hover":{textDecoration:"underline"}},children:[e,(0,O.jsx)(Ks.A,{sx:{fontSize:16}})]},t):e),Zs=e=>{let{content:t}=e;return n=t,[/^#+ /m,/\*\*.+\*\*/,/_.+_/,/\[.+\]\(.+\)/,/^\s*[-*+]\s/m,/^\s*\d+\.\s/m,/```[\s\S]*```/,/^\s*>/m].some(e=>e.test(n))?(0,O.jsx)(Js.oz,{remarkPlugins:[qs.A],components:{a:e=>{let{href:t,children:n}=e;return(0,O.jsxs)(Gs.A,{href:t,target:"_blank",rel:"noopener noreferrer",sx:{display:"inline-flex",alignItems:"center",gap:.5,color:"primary.main",textDecoration:"none","&:hover":{textDecoration:"underline"}},children:[n,(0,O.jsx)(Ks.A,{sx:{fontSize:16}})]})},code:e=>{let{children:t,className:n}=e,i=(0,s.A)(e,Ys);return!n||!n.includes("language-")?(0,O.jsx)("code",(0,a.A)((0,a.A)({style:{backgroundColor:"rgba(0, 0, 0, 0.08)",padding:"2px 4px",borderRadius:4,fontFamily:"monospace",fontSize:"0.9em"}},i),{},{children:t})):(0,O.jsx)("pre",{style:{backgroundColor:"rgba(0, 0, 0, 0.05)",padding:12,borderRadius:8,overflow:"auto",fontFamily:"monospace",fontSize:"0.875em",margin:"8px 0",maxWidth:"100%",maxHeight:"400px"},children:(0,O.jsx)("code",(0,a.A)((0,a.A)({className:n},i),{},{children:t}))})}},children:t}):(0,O.jsx)(O.Fragment,{children:Xs(t)});var n},Qs=e=>{let{message:t,onOpenLogs:n}=e;t.type;return(0,O.jsx)(Us.A,{in:!0,timeout:300,children:(0,O.jsxs)(st.Ay,{alignItems:"flex-start",sx:{flexDirection:"row",gap:1,py:1.5,width:"100%",maxWidth:"100%",overflow:"hidden",minWidth:0,"& > *":{minWidth:0}},children:[(0,O.jsx)(Hs.A,{sx:{minWidth:"auto"},children:(0,O.jsx)(ns.A,{sx:{bgcolor:"user"===t.type?"primary.main":"execution"===t.type||"trace"===t.type?"warning.main":"result"===t.type?"success.main":"secondary.main",width:32,height:32},children:"user"===t.type?(0,O.jsx)(J.A,{sx:{fontSize:20}}):("execution"===t.type||"trace"===t.type||t.type,(0,O.jsx)(ps.A,{sx:{fontSize:20}}))})}),(0,O.jsx)(ot.A,{sx:{flex:1,maxWidth:"calc(100% - 40px)",mx:0,overflow:"hidden"},primary:(0,O.jsxs)(hs.A,{direction:"column",spacing:1,children:[t.intent&&"assistant"===t.type&&(0,O.jsxs)(hs.A,{direction:"row",spacing:1,alignItems:"center",children:[(0,O.jsx)(R.A,{icon:(e=>{switch(e){case"generate_agent":return(0,O.jsx)(ps.A,{});case"generate_task":return(0,O.jsx)(ua.A,{});case"generate_crew":return(0,O.jsx)(ca.A,{});case"configure_crew":return(0,O.jsx)(ht.A,{});default:return(0,O.jsx)(aa.A,{})}})(t.intent),label:t.intent.replace(/_/g," ").replace(/\b\w/g,e=>e.toUpperCase()),size:"small",color:(e=>{switch(e){case"generate_agent":return"primary";case"generate_task":return"secondary";case"generate_crew":return"success";default:return"default"}})(t.intent),variant:"outlined"}),void 0!==t.confidence&&(0,O.jsxs)(c.A,{variant:"caption",color:"text.secondary",children:[Math.round(100*t.confidence),"% confidence"]})]}),("execution"===t.type||"trace"===t.type)&&(0,O.jsxs)(hs.A,{direction:"row",spacing:1,alignItems:"center",children:[(0,O.jsxs)(c.A,{variant:"caption",color:"text.secondary",children:["execution"===t.type?"Execution":"Trace"," Output"]}),t.eventSource&&(0,O.jsx)(R.A,{label:t.eventSource,size:"small",variant:"outlined",color:"primary"}),t.eventContext&&(0,O.jsx)(R.A,{label:t.eventContext,size:"small",variant:"outlined",color:"secondary"}),t.jobId&&n&&(0,O.jsx)(P.A,{title:"View execution logs",children:(0,O.jsx)(u.A,{size:"small",onClick:()=>t.jobId&&n(t.jobId),sx:{ml:1},children:(0,O.jsx)(Ks.A,{fontSize:"small"})})})]}),(0,O.jsx)(o.A,{sx:{color:"user"===t.type?"primary.main":(t.type,"text.primary"),wordBreak:"break-word",whiteSpace:"pre-wrap",maxWidth:"100%",overflow:"visible",fontWeight:"result"===t.type?500:"normal"},children:(()=>{const e=Rs(t.content);if("result"===t.type)try{const t=JSON.parse(e);if(t.value&&"string"===typeof t.value){const e=t.value.split("\n").map(e=>e.trim()),n=[];for(let t=0;t<e.length;t++){const a=e[t],s=e[t+1]||"";if(""===a)continue;const i=a.match(/^[-*\u2022]\s/)||a.match(/^\d+\.\s/),o=s.match(/^[-*\u2022]\s/)||s.match(/^\d+\.\s/),r=a.match(/^#+\s/);n.push(a),r&&t<e.length-1||i&&!o&&""!==s?n.push(""):i||r||""===s||o||n.push("")}const a=n.join("\n").trim();return(0,O.jsx)(o.A,{sx:{backgroundColor:"rgba(0, 0, 0, 0.05)",p:2,borderRadius:1,border:"1px solid rgba(0, 0, 0, 0.1)",maxWidth:"100%",width:"100%",boxSizing:"border-box",color:"text.primary","& h1, & h2, & h3":{marginTop:"0.75em",marginBottom:"0.5em",fontSize:"1.1em",fontWeight:600},"& h4, & h5, & h6":{marginTop:"0.5em",marginBottom:"0.25em",fontSize:"1em",fontWeight:600},"& p":{margin:"0.4em 0",lineHeight:1.4},"& ul, & ol":{margin:"0.4em 0",paddingLeft:"1.5em"},"& li":{margin:"0.2em 0",lineHeight:1.4},"& li p":{margin:0,display:"inline"},"& > *:first-of-type":{marginTop:0},"& > *:last-child":{marginBottom:0},"& p:empty":{display:"none"},lineHeight:1.5},children:(0,O.jsx)(Zs,{content:a})})}return(0,O.jsx)(o.A,{component:"pre",sx:{fontFamily:"monospace",fontSize:"0.875rem",overflow:"auto",maxHeight:"600px",backgroundColor:"rgba(0, 0, 0, 0.05)",p:2,borderRadius:1,border:"1px solid rgba(0, 0, 0, 0.1)",m:0,maxWidth:"100%",width:"100%",boxSizing:"border-box",minWidth:0,overflowX:"auto",overflowY:"auto","& code":{display:"block",whiteSpace:"pre",wordBreak:"normal",overflowWrap:"normal"}},children:(0,O.jsx)("code",{children:JSON.stringify(t,null,2)})})}catch(n){const t=e.split("\n").map(e=>e.trim()),a=[];for(let e=0;e<t.length;e++){const n=t[e],s=t[e+1]||"";if(""===n)continue;const i=n.match(/^[-*\u2022]\s/)||n.match(/^\d+\.\s/),o=s.match(/^[-*\u2022]\s/)||s.match(/^\d+\.\s/),r=n.match(/^#+\s/);a.push(n),r&&e<t.length-1||i&&!o&&""!==s?a.push(""):i||r||""===s||o||a.push("")}const s=a.join("\n").trim();return(0,O.jsx)(o.A,{sx:{backgroundColor:"rgba(0, 0, 0, 0.05)",p:2,borderRadius:1,border:"1px solid rgba(0, 0, 0, 0.1)",maxWidth:"100%",width:"100%",boxSizing:"border-box",color:"text.primary","& h1, & h2, & h3, & h4, & h5, & h6":{marginTop:"1em",marginBottom:"0.5em"},"& p":{margin:0,lineHeight:1.4},"& p + p":{marginTop:"0.75em"},"& ul, & ol":{margin:"0.5em 0",paddingLeft:"1.5em"},"& li":{margin:"0.25em 0",lineHeight:1.4,"& p":{margin:0,display:"inline"}},"& > *:first-of-type":{marginTop:0},"& > *:last-child":{marginBottom:0},"& p:empty, & br":{display:"none"},lineHeight:1.5},children:(0,O.jsx)(Zs,{content:s})})}if("trace"===t.type){let t=e;const a=e.match(/^```(?:json)?\s*\n([\s\S]*?)\n```$/);a&&(t=a[1].trim());try{const e=JSON.parse(t);return(0,O.jsx)(o.A,{component:"pre",sx:{fontFamily:"monospace",fontSize:"0.875rem",overflow:"auto",maxHeight:"400px",backgroundColor:"rgba(0, 0, 0, 0.05)",p:1,borderRadius:1,m:0,maxWidth:"100%",width:"100%",boxSizing:"border-box",minWidth:0,overflowX:"auto",overflowY:"auto","& code":{display:"block",whiteSpace:"pre",wordBreak:"normal",overflowWrap:"normal",minWidth:"max-content"}},children:(0,O.jsx)("code",{children:JSON.stringify(e,null,2)})})}catch(n){}}if("assistant"===t.type&&t.result){const e=t.result;if("generate_agent"===t.intent&&e.agent){const t=e.agent;return(0,O.jsxs)(o.A,{children:[(0,O.jsx)(c.A,{variant:"body1",sx:{mb:1},children:"I've created an agent for you:"}),(0,O.jsxs)(o.A,{sx:{bgcolor:"background.paper",p:2,borderRadius:1},children:[(0,O.jsx)(c.A,{variant:"h6",sx:{mb:1},children:t.name}),(0,O.jsxs)(c.A,{variant:"body2",color:"text.secondary",children:["Role: ",t.role]})]})]})}if("generate_task"===t.intent&&e.task){const t=e.task;return(0,O.jsxs)(o.A,{children:[(0,O.jsx)(c.A,{variant:"body1",sx:{mb:1},children:"I've created a task for you:"}),(0,O.jsxs)(o.A,{sx:{bgcolor:"background.paper",p:2,borderRadius:1},children:[(0,O.jsx)(c.A,{variant:"h6",sx:{mb:1},children:t.name}),(0,O.jsx)(c.A,{variant:"body2",color:"text.secondary",children:t.description})]})]})}if("generate_crew"===t.intent&&e.crew){const t=e.crew;return(0,O.jsxs)(o.A,{children:[(0,O.jsx)(c.A,{variant:"body1",sx:{mb:1},children:"I've created a complete plan for you:"}),(0,O.jsxs)(o.A,{sx:{bgcolor:"background.paper",p:2,borderRadius:1},children:[t.agents&&t.agents.length>0&&(0,O.jsxs)(o.A,{sx:{mb:2},children:[(0,O.jsx)(c.A,{variant:"subtitle1",sx:{fontWeight:"bold",mb:1},children:"Agents:"}),t.agents.map((e,t)=>(0,O.jsxs)(c.A,{variant:"body2",sx:{ml:2},children:["\u2022 ",e.name]},t))]}),t.tasks&&t.tasks.length>0&&(0,O.jsxs)(o.A,{children:[(0,O.jsx)(c.A,{variant:"subtitle1",sx:{fontWeight:"bold",mb:1},children:"Tasks:"}),t.tasks.map((e,t)=>(0,O.jsxs)(c.A,{variant:"body2",sx:{ml:2},children:["\u2022 ",e.name]},t))]})]})]})}}return(0,O.jsx)(Zs,{content:e})})()}),(0,O.jsx)(c.A,{variant:"caption",color:"text.secondary",sx:{ml:1},children:t.timestamp.toLocaleTimeString()})]})})]})})},$s=e=>{let{messages:t,onOpenLogs:n}=e;if(0===t.length)return null;const a=t[0],s=a.jobId;return(0,O.jsx)(Us.A,{in:!0,timeout:300,children:(0,O.jsxs)(st.Ay,{alignItems:"flex-start",sx:{flexDirection:"row",gap:1,py:1.5,width:"100%",maxWidth:"100%",overflow:"hidden",minWidth:0,"& > *":{minWidth:0}},children:[(0,O.jsx)(Hs.A,{sx:{minWidth:"auto"},children:(0,O.jsx)(ns.A,{sx:{bgcolor:"warning.main",width:32,height:32},children:(0,O.jsx)(ps.A,{sx:{fontSize:20}})})}),(0,O.jsx)(o.A,{sx:{flex:1,minWidth:0},children:(0,O.jsxs)(hs.A,{direction:"column",spacing:1,children:[(0,O.jsxs)(hs.A,{direction:"row",spacing:1,alignItems:"center",children:[(0,O.jsx)(c.A,{variant:"caption",color:"text.secondary",children:"Trace Output"}),a.eventSource&&(0,O.jsx)(R.A,{label:a.eventSource,size:"small",variant:"outlined",color:"primary"}),a.eventContext&&(0,O.jsx)(R.A,{label:a.eventContext,size:"small",variant:"outlined",color:"secondary"}),s&&n&&(0,O.jsx)(P.A,{title:"View execution logs",children:(0,O.jsx)(u.A,{size:"small",onClick:()=>n(s),sx:{ml:1},children:(0,O.jsx)(Ks.A,{fontSize:"small"})})})]}),(0,O.jsx)(o.A,{sx:{color:"text.primary",wordBreak:"break-word",whiteSpace:"pre-wrap",maxWidth:"100%",overflow:"visible",fontFamily:"monospace",fontSize:"0.875rem"},children:t.map((e,n)=>{const a=Rs(e.content),s=a.match(/^```(?:json)?\s*\n([\s\S]*?)\n```$/);let i=a;s&&(i=s[1].trim());const r=[e.eventType||e.eventSource||"trace",e.eventContext,e.timestamp.toLocaleString("en-GB",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:!1})].filter(Boolean).join("\n");let l;try{const e=JSON.parse(i);l=e.suggestions||e.quality||e.entities?(0,O.jsx)(o.A,{component:"pre",sx:{overflow:"auto",maxHeight:"400px",backgroundColor:"rgba(0, 0, 0, 0.05)",p:1,borderRadius:1,border:"1px solid rgba(0, 0, 0, 0.1)",mt:.5,maxWidth:"100%",width:"100%",boxSizing:"border-box",minWidth:0,overflowX:"auto",overflowY:"auto",color:"rgba(0, 0, 0, 0.4)"},children:(0,O.jsx)("code",{children:JSON.stringify(e,null,2)})}):(0,O.jsx)(o.A,{sx:{whiteSpace:"pre-wrap",color:"rgba(0, 0, 0, 0.4)"},children:JSON.stringify(e,null,2)})}catch(d){l=(0,O.jsx)(o.A,{sx:{whiteSpace:"pre-wrap",color:"rgba(0, 0, 0, 0.4)"},children:a})}return(0,O.jsxs)(o.A,{sx:{mb:n<t.length-1?3:0},children:[(0,O.jsx)(o.A,{sx:{color:"rgba(0, 0, 0, 0.4)",fontSize:"0.813rem",mb:.5},children:r}),l]},e.id)})})]})})]})})};var ei=n(66699),ti=n(71378),ni=n(34200),ai=n(42647),si=n(14155),ii=n(98650),oi=n(11227),ri=n(99905),li=n(20760);const di=["id","created_at"],ci=["id","created_at"],ui=e=>{let{executionId:t,groupId:h,onFilesUploaded:p,onAgentsUpdated:g,disabled:f=!1,compact:v=!1,availableAgents:A}=e;const[y,b]=(0,i.useState)([]),[j,w]=(0,i.useState)(!1),[k,C]=(0,i.useState)(!1),[S,_]=(0,i.useState)(null),[E,I]=(0,i.useState)(null),[T,D]=(0,i.useState)(0),[N,M]=(0,i.useState)([]),[z,L]=(0,i.useState)(""),[F,W]=(0,i.useState)(!1),[V,U]=(0,i.useState)(new Set),[H,K]=(0,i.useState)(A||[]),[G,J]=(0,i.useState)([]),[q,Y]=(0,i.useState)(!1),X=(0,i.useRef)(null);i.useEffect(()=>{if(A)K(A),Y(!1);else if(k&&0===H.length){Y(!0);const e=async()=>{try{const{AgentService:e}=await Promise.resolve().then(n.bind(n,39582)),t=await e.listAgents();K(t)}catch(e){}finally{Y(!1)}};e()}},[k,A]),i.useEffect(()=>{(async()=>{try{const e=ke.O.getInstance(),t=await e.getDatabricksConfig();_(t),t&&!t.knowledge_volume_enabled&&I("Knowledge volume is not enabled in Databricks configuration")}catch(e){I("Failed to load Databricks configuration")}})()},[]);const Z=async(e,n)=>{if(!S||!S.knowledge_volume_enabled)return void I("Knowledge volume is not configured");w(!0),I(null);const s={volume_path:S.knowledge_volume_path||"main.default.knowledge",workspace_url:S.workspace_url,token:void 0,file_format:"auto",chunk_size:S.knowledge_chunk_size||1e3,chunk_overlap:S.knowledge_chunk_overlap||200,create_date_dirs:!0,max_file_size_mb:50};for(let o=0;o<e.length;o++){const r=e[o],l=n[o];try{const e=new FormData;e.append("file",r),e.append("volume_config",JSON.stringify(s)),e.append("agent_ids",JSON.stringify(G));const n=await ye.uE.post("/databricks/knowledge/upload/".concat(t),e,{headers:{"Content-Type":"multipart/form-data"},onUploadProgress:e=>{const t=e.total?Math.round(100*e.loaded/e.total):0;b(e=>e.map(e=>e.id===l.id?(0,a.A)((0,a.A)({},e),{},{progress:t}):e))}});G.length>0&&n.data.path&&await $(n.data.path,r.name),b(e=>e.map(e=>e.id===l.id?(0,a.A)((0,a.A)({},e),{},{status:"success",path:n.data.path,progress:100}):e))}catch(i){b(e=>e.map(e=>e.id===l.id?(0,a.A)((0,a.A)({},e),{},{status:"error",error:i instanceof Error?i.message:"Upload failed"}):e))}}w(!1),p&&p(y)},{updateAgent:Q}=(0,Ce.o)(),$=async(e,t)=>{try{const{AgentService:e}=await Promise.resolve().then(n.bind(n,39582)),t=[];for(const n of G){const i=H.find(e=>(e.id||"agent-".concat(e.name))===n);if(i){const n="DatabricksKnowledgeSearchTool",o=i.tools||[];let r=i;r=o.includes(n)?i:(0,a.A)((0,a.A)({},i),{},{tools:[...o,n]}),t.push(r);const l=r,{id:d,created_at:c}=l,u=(0,s.A)(l,di);if(i.id){const n=await e.updateAgentFull(i.id,u);n&&(t[t.length-1]=n,n.id&&Q(n.id,n))}else{const e=H.findIndex(e=>e.name===i.name);-1!==e&&(H[e]=r)}}}g&&t.length>0&&g(t)}catch(i){}},ee=()=>{C(!1)},te=async e=>{const t="DatabricksKnowledgeSearchTool",i=e.tools||[];if(i.includes(t)){const r=i.filter(e=>e!==t),l=(0,a.A)((0,a.A)({},e),{},{tools:r});try{if(e.id){const{AgentService:t}=await Promise.resolve().then(n.bind(n,39582)),a=l,{id:i,created_at:o}=a,r=(0,s.A)(a,ci),d=await t.updateAgentFull(e.id,r);d&&(d.id&&Q(d.id,d),g&&g([d]))}else{const t=H.findIndex(t=>t.name===e.name);-1!==t&&(H[t]=l,g&&g([l]))}}catch(o){}}},ne=e=>{if(0===e)return"0 Bytes";const t=Math.floor(Math.log(e)/Math.log(1024));return Math.round(e/Math.pow(1024,t)*100)/100+" "+["Bytes","KB","MB","GB"][t]},ae=async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";W(!0),I(null);try{const t=e||(null===S||void 0===S?void 0:S.knowledge_volume_path)||"main.default.knowledge",n=(await ye.uE.get("/databricks/knowledge/browse/".concat(encodeURIComponent(t)))).data.filter(e=>{const t=e.name&&""!==e.name.trim()&&"."!==e.name&&".."!==e.name,n=void 0!==e.path&&null!==e.path,a=t&&n;return a});M(n),L(t)}catch(t){I("Failed to browse Databricks Volume: ".concat(t instanceof Error?t.message:String(t))),M([])}finally{W(!1)}};i.useEffect(()=>{1===T&&k&&null!==S&&void 0!==S&&S.knowledge_volume_enabled&&(!z||z===(S.knowledge_volume_path||"main.default.knowledge")&&0===N.length)&&ae()},[T,k,S]);const{isMemoryBackendConfigured:se,isKnowledgeSourceEnabled:ie,refreshConfiguration:oe}=Cs(),re=se&&ie;return i.useEffect(()=>{},[se,ie,re]),i.useEffect(()=>{oe()},[oe]),(0,O.jsxs)(O.Fragment,{children:[(0,O.jsx)(P.A,{title:re?"Upload knowledge files for RAG":se?"Knowledge volume is not enabled in Databricks configuration":"Knowledge sources require Databricks Vector Search memory backend configuration",children:(0,O.jsx)("span",{children:(0,O.jsx)(u.A,{onClick:()=>{C(!0)},disabled:f||!re,color:"primary",size:v?"small":"medium",sx:v?{padding:"4px",color:"text.secondary","&:hover":{backgroundColor:"action.hover",color:"primary.main"}}:{},children:(0,O.jsx)(ni.A,{sx:v?{fontSize:18}:{}})})})}),(0,O.jsxs)(r.A,{open:k,onClose:ee,maxWidth:"sm",fullWidth:!0,children:[(0,O.jsx)(d.A,{children:(0,O.jsxs)(o.A,{sx:{display:"flex",alignItems:"center",gap:1},children:[(0,O.jsx)(ai.A,{}),(0,O.jsx)(c.A,{variant:"h6",children:"Upload Knowledge Files"})]})}),(0,O.jsxs)(l.A,{children:[E&&(0,O.jsx)(m.A,{severity:"error",sx:{mb:2},children:E}),!re&&(0,O.jsx)(m.A,{severity:"warning",sx:{mb:2},children:se?"Knowledge volume is not enabled. Please configure it in the Databricks settings.":"Knowledge sources require Databricks Vector Search memory backend configuration. Please configure memory backend in Settings."}),re&&(0,O.jsxs)(O.Fragment,{children:[(0,O.jsxs)(_e.A,{elevation:0,sx:{p:3,mb:3,bgcolor:"grey.50",borderRadius:2,border:"1px solid",borderColor:"grey.200"},children:[(0,O.jsx)(c.A,{variant:"h6",sx:{mb:1,fontWeight:600,color:"text.primary"},children:"Select Agents"}),(0,O.jsx)(c.A,{variant:"body2",sx:{mb:3,color:"text.secondary",lineHeight:1.5},children:"Choose which agents will have access to these knowledge files"}),q?(0,O.jsx)(o.A,{sx:{display:"flex",justifyContent:"center",py:3},children:(0,O.jsx)(ue.A,{size:28})}):H.length>0?(0,O.jsx)(o.A,{sx:{display:"flex",flexWrap:"wrap",gap:1.5},children:H.map(e=>{var t;const n=e.id||"agent-".concat(e.name),s=G.includes(n),i=null===(t=e.tools)||void 0===t?void 0:t.includes("DatabricksKnowledgeSearchTool");return(0,O.jsx)(R.A,{label:(0,O.jsxs)("span",{children:[e.name,i&&(0,O.jsx)("span",{style:{marginLeft:"4px",fontSize:"0.9em"},children:"\u{1f4da}"})]}),onClick:()=>(async e=>{const t=H.find(t=>(t.id||"agent-".concat(t.name))===e);J(n=>n.includes(e)?(t&&te(t),n.filter(t=>t!==e)):[...n,e])})(n),color:s?"primary":"default",variant:s?"filled":"outlined",clickable:!0,title:"".concat(e.name,i?" - Has Knowledge Search capability":" - Click to add Knowledge Search capability"),sx:(0,a.A)({py:1,px:.5,fontSize:"0.875rem",fontWeight:500,transition:"all 0.2s ease","&:hover":{transform:"translateY(-1px)",boxShadow:1}},s&&{boxShadow:2})},n)})}):(0,O.jsx)(m.A,{severity:"info",sx:{mt:1},children:"No agents available. Add agents to the canvas first."})]}),G.length>0&&(0,O.jsx)(Us.A,{in:G.length>0,timeout:300,children:(0,O.jsxs)(_e.A,{elevation:0,sx:{p:3,borderRadius:2,border:"1px solid",borderColor:"grey.200"},children:[(0,O.jsx)(c.A,{variant:"h6",sx:{mb:2,fontWeight:600,color:"text.primary"},children:"Upload Knowledge Files"}),(0,O.jsxs)(ea.A,{value:T,onChange:(e,t)=>D(t),sx:{mb:3,"& .MuiTab-root":{fontWeight:500,textTransform:"none",fontSize:"0.9rem"}},children:[(0,O.jsx)(ta.A,{label:"Upload Files",icon:(0,O.jsx)(ai.A,{}),iconPosition:"start"}),(0,O.jsx)(ta.A,{label:"Browse Volume",icon:(0,O.jsx)(si.A,{}),iconPosition:"start"})]}),0===T&&(0,O.jsxs)(O.Fragment,{children:[(0,O.jsx)("input",{ref:X,type:"file",multiple:!0,onChange:e=>{const t=e.target.files;if(!t||0===t.length)return;const n=Array.from(t).map(e=>({id:"".concat(Date.now(),"-").concat(Math.random()),filename:e.name,path:"",size:e.size,status:"uploading",progress:0}));b(e=>[...e,...n]),Z(Array.from(t),n),X.current&&(X.current.value="")},style:{display:"none"},accept:".pdf,.txt,.json,.csv,.doc,.docx,.md"}),(0,O.jsx)(x.A,{variant:"contained",startIcon:(0,O.jsx)(ai.A,{}),onClick:()=>{var e;return null===(e=X.current)||void 0===e?void 0:e.click()},disabled:j,fullWidth:!0,sx:{mb:3,py:2,borderRadius:2,textTransform:"none",fontSize:"1rem",fontWeight:500,boxShadow:"none","&:hover":{boxShadow:2,transform:"translateY(-1px)"},transition:"all 0.2s ease"},children:"Choose Files to Upload"}),y.length>0&&(0,O.jsx)(_e.A,{variant:"outlined",sx:{borderRadius:2,overflow:"hidden",border:"1px solid",borderColor:"grey.200"},children:(0,O.jsx)(at.A,{disablePadding:!0,children:y.map(e=>(0,O.jsxs)(st.Ay,{sx:{borderBottom:"1px solid",borderColor:"grey.100","&:last-child":{borderBottom:"none"}},children:[(0,O.jsx)(ot.A,{primary:(0,O.jsxs)(o.A,{sx:{display:"flex",alignItems:"center",gap:1.5},children:[(0,O.jsx)(ii.A,{fontSize:"small",color:"primary"}),(0,O.jsx)(c.A,{variant:"body2",fontWeight:500,children:e.filename}),(0,O.jsx)(R.A,{label:ne(e.size),size:"small",variant:"outlined",sx:{fontSize:"0.75rem"}})]}),secondary:"uploading"===e.status?(0,O.jsx)(ei.A,{variant:"determinate",value:e.progress,sx:{mt:1}}):"success"===e.status?(0,O.jsxs)(o.A,{sx:{display:"flex",alignItems:"center",gap:.5,mt:.5},children:[(0,O.jsx)(oi.A,{color:"success",fontSize:"small"}),(0,O.jsx)(c.A,{variant:"caption",color:"success.main",children:"Uploaded successfully"})]}):"error"===e.status?(0,O.jsxs)(o.A,{sx:{display:"flex",alignItems:"center",gap:.5,mt:.5},children:[(0,O.jsx)(ri.A,{color:"error",fontSize:"small"}),(0,O.jsx)(c.A,{variant:"caption",color:"error",children:e.error||"Upload failed"})]}):null}),(0,O.jsx)(ti.A,{children:(0,O.jsx)(u.A,{edge:"end","aria-label":"delete",onClick:()=>(async e=>{b(t=>{const n=t.filter(t=>t.id!==e);return 0===n.length&&G.forEach(async e=>{const t=H.find(t=>(t.id||"agent-".concat(t.name))===e);if(t){const e=(t.tools||[]).filter(e=>"36"!==String(e)&&"DatabricksKnowledgeSearchTool"!==String(e));if(t.id){const s=(0,a.A)((0,a.A)({},t),{},{tools:e});try{const e=await fe.AgentService.updateAgentFull(t.id,s);e&&e.id&&Q(e.id,e)}catch(n){}}}}),n})})(e.id),disabled:"uploading"===e.status,size:"small",children:(0,O.jsx)(li.A,{})})})]},e.id))})})]}),1===T&&(0,O.jsxs)(O.Fragment,{children:[(0,O.jsxs)(o.A,{sx:{mb:2,p:2,bgcolor:"grey.50",borderRadius:1,border:"1px solid",borderColor:"grey.200"},children:[(0,O.jsxs)(c.A,{variant:"body2",color:"text.secondary",sx:{mb:1},children:["Browsing: ",z||"Default volume"]}),(0,O.jsxs)(c.A,{variant:"caption",color:"text.secondary",sx:{mb:1,display:"block"},children:["Config volume path: ",(null===S||void 0===S?void 0:S.knowledge_volume_path)||"Not set"]}),(0,O.jsx)(x.A,{variant:"text",size:"small",onClick:()=>{M([]),ae()},disabled:F,sx:{textTransform:"none",fontSize:"0.8rem"},children:F?"Loading...":"Refresh"})]}),F?(0,O.jsx)(o.A,{sx:{display:"flex",justifyContent:"center",p:4},children:(0,O.jsx)(ue.A,{})}):N.length>0?(0,O.jsx)(at.A,{children:N.filter(e=>e.name&&""!==e.name.trim()).map(e=>(0,O.jsx)(st.Ay,{disablePadding:!0,sx:{mb:1},children:(0,O.jsxs)(ha.A,{onClick:()=>{var t;e.is_directory?(t=e.path,ae(t)):(e=>{const t=new Set(V);t.has(e)?t.delete(e):t.add(e),U(t)})(e.path)},selected:!e.is_directory&&V.has(e.path),sx:{borderRadius:1,"&:hover":{bgcolor:"action.hover"}},children:[(0,O.jsx)(it.A,{children:e.is_directory?(0,O.jsx)(si.A,{color:"primary"}):(0,O.jsx)(ii.A,{})}),(0,O.jsx)(ot.A,{primary:e.name,secondary:e.is_directory?void 0:"".concat(ne(e.size||0))}),!e.is_directory&&(0,O.jsx)(R.A,{label:V.has(e.path)?"Selected":"Select",size:"small",color:V.has(e.path)?"primary":"default",variant:V.has(e.path)?"filled":"outlined"})]})},e.path))}):(0,O.jsxs)(o.A,{sx:{textAlign:"center",py:4},children:[(0,O.jsxs)(m.A,{severity:"info",sx:{mb:2},children:["No files or folders found in this location.",(0,O.jsx)("br",{}),(0,O.jsxs)(c.A,{variant:"caption",sx:{mt:1,display:"block"},children:["Current path: ",z||"Not set"]})]}),(0,O.jsx)(x.A,{variant:"outlined",onClick:()=>ae(),disabled:F,sx:{textTransform:"none",borderRadius:2},children:F?"Loading...":"Refresh"})]}),V.size>0&&(0,O.jsxs)(x.A,{variant:"contained",onClick:async()=>{if(0===V.size)return;w(!0),I(null);const e=Array.from(V),n=[];for(const i of e){const e=i.split("/").pop()||"unknown",o={id:"".concat(Date.now(),"-").concat(Math.random()),filename:e,path:i,size:0,status:"uploading",source:"volume"};n.push(o);try{const n=new FormData;n.append("file_path",i),n.append("selected_agents",JSON.stringify(G));const s=await ye.uE.post("/databricks/knowledge/select-from-volume/".concat(t),n);b(e=>e.map(e=>e.id===o.id?(0,a.A)((0,a.A)({},e),{},{status:"success",path:s.data.path}):e)),G.length>0&&s.data.path&&await $(s.data.path,e)}catch(s){b(e=>e.map(e=>e.id===o.id?(0,a.A)((0,a.A)({},e),{},{status:"error",error:s instanceof Error?s.message:"Selection failed"}):e))}}b(e=>[...e,...n]),w(!1),U(new Set),p&&p(n)},disabled:j,fullWidth:!0,sx:{py:1.5,borderRadius:2,textTransform:"none",fontWeight:500,transition:"all 0.2s ease","&:hover":{transform:"translateY(-1px)",boxShadow:2}},children:["Use Selected Files (",V.size,")"]})]})]})})]})]}),(0,O.jsx)(B.A,{children:(0,O.jsx)(x.A,{onClick:ee,disabled:j,children:"Close"})})]})]})},hi=e=>{let{onNodesGenerated:t,onLoadingStateChange:n,selectedModel:r="databricks-llama-4-maverick",selectedTools:l=[],isVisible:d=!0,setSelectedModel:h,nodes:m=[],edges:x=[],onExecuteCrew:f,onToggleCollapse:v,chatSessionId:A,onOpenLogs:y}=e;const[j,w]=(0,i.useState)(""),[C,S]=(0,i.useState)(!1),[_,E]=(0,i.useState)(!1),[I,T]=(0,i.useState)({}),[N,z]=(0,i.useState)(!1),[L,F]=(0,i.useState)(null),[W,R]=(0,i.useState)(!1),[B,U]=(0,i.useState)([]),[H,K]=(0,i.useState)({}),[G,J]=(0,i.useState)(0),[Y,X]=(0,i.useState)("crew"),{isMemoryBackendConfigured:Z,isKnowledgeSourceEnabled:Q,checkConfiguration:$}=Cs(),ee=(0,i.useRef)(null),ne=(0,i.useRef)(null),{setNodes:ae,setEdges:se}=(0,g.Y)(),{setInputMode:ie,inputMode:oe,setInputVariables:re,executeCrew:le,executeFlow:ce}=(0,b.E)(),he=Ns(e=>e.getUILayoutState()),me=(0,i.useRef)(new Is({margin:20,minNodeSpacing:50,defaultUIState:{chatPanelVisible:d,chatPanelCollapsed:!1,chatPanelWidth:450}})),{setMessages:pe,getDeduplicatedMessages:xe,setCurrentSession:ge}=As(),{sessionId:Ae,setSessionId:ye,chatSessions:be,setChatSessions:je,isLoadingSessions:we,currentSessionName:ke,setCurrentSessionName:Ce,saveMessageToBackend:Se,loadChatSessions:Ee,loadSessionMessages:Ie,startNewChat:Te}=(e=>{const[t,n]=(0,i.useState)(e||(0,k.A)()),{setMessages:o,addMessage:r}=As(),[l,d]=(0,i.useState)([]),[c,u]=(0,i.useState)(!1),[h,m]=(0,i.useState)("New Chat"),[p,x]=(0,i.useState)(!1),g=(0,i.useRef)(0);(0,i.useEffect)(()=>{(()=>{if(e)n(e);else{const e=Fs.generateSessionId();n(e)}})()},[e]);const f=e=>{const t={id:e.id,type:e.message_type,content:e.content,timestamp:new Date(e.timestamp),intent:e.intent,confidence:e.confidence?parseFloat(e.confidence):void 0,result:e.generation_result};if(("execution"===e.message_type||"trace"===e.message_type)&&e.generation_result){const n=e.generation_result;if(t.jobId=n.jobId,t.eventSource=n.agentName,t.eventContext=n.taskName,t.isIntermediate=n.isIntermediate,void 0!==n.jobId||void 0!==n.agentName||void 0!==n.taskName||void 0!==n.isIntermediate){const{jobId:e,agentName:a,taskName:i,isIntermediate:o}=n,r=(0,s.A)(n,Ws);t.result=Object.keys(r).length>0?r:void 0}}return t};(0,i.useEffect)(()=>{(async()=>{if(t)try{o(t,[]);try{const e=await Fs.getSessionMessages(t);if(e.messages&&e.messages.length>0){const n=e.messages.map(f);o(t,n)}}catch(e){}}catch(n){}})()},[t,o]);const v=(0,i.useCallback)(async e=>{if(t&&!p)try{let n=e.result;"execution"!==e.type&&"trace"!==e.type||(n=(0,a.A)((0,a.A)({},e.result||{}),{},{jobId:e.jobId,agentName:e.eventSource,taskName:e.eventContext,isIntermediate:e.isIntermediate}));const s={session_id:t,message_type:e.type,content:e.content,intent:e.intent,confidence:e.confidence,generation_result:n};await Fs.saveMessage(s),g.current=0,p&&x(!1)}catch(n){if(g.current+=1,g.current>=3&&!p){x(!0);const e={id:"error-".concat(Date.now()),type:"assistant",content:"\u26a0\ufe0f Chat history is temporarily disabled due to service issues. Your messages will not be saved.",timestamp:new Date};r(t,e)}}},[t,p,3,r]);return{sessionId:t,setSessionId:n,chatSessions:l,setChatSessions:d,isLoadingSessions:c,currentSessionName:h,setCurrentSessionName:m,saveMessageToBackend:v,loadChatSessions:async()=>{u(!0);try{const e=await Fs.getGroupSessions();d(e.sessions||[])}catch(e){const n={id:"error-".concat(Date.now()),type:"assistant",content:"\u274c Failed to load chat history. Please try again.",timestamp:new Date};r(t,n)}finally{u(!1)}},loadSessionMessages:async e=>{u(!0);try{var t;const a=await Fs.getSessionMessages(e),s=JSON.parse(localStorage.getItem("chatSessionJobNames")||"{}")[e];m(s||"New Chat");const i=a.messages.map(f);o(e,i),n(e),m("Session from ".concat(new Date((null===(t=a.messages[0])||void 0===t?void 0:t.timestamp)||Date.now()).toLocaleDateString()))}catch(a){const t={id:"error-".concat(Date.now()),type:"assistant",content:"\u274c Failed to load session messages. Please try again.",timestamp:new Date};r(e,t)}finally{u(!1)}},startNewChat:()=>{const e=Fs.generateSessionId();n(e),o(e,[]),m("New Chat")}}})(A),De=xe(Ae);(0,i.useEffect)(()=>{Ae&&ge(Ae)},[Ae,ge]);const Ne=e=>{if("function"===typeof e){const t=e(xe(Ae));pe(Ae,t)}else pe(Ae,e)},{executingJobId:Pe,setExecutingJobId:Me,lastExecutionJobId:ze,setLastExecutionJobId:Oe,executionStartTime:Le}=((e,t)=>{const[n,s]=(0,i.useState)(null),[o,r]=(0,i.useState)(null),[l,d]=(0,i.useState)(new Set),[c,u]=(0,i.useState)(null),{setTaskState:h,clearTaskStates:m}=(0,Pt.useTaskExecutionStore)(),{addMessage:p}=As(),x=(0,i.useCallback)(async n=>{try{const s=await Es.A.getTraces(n);s&&Array.isArray(s)&&s.filter(e=>{const t="".concat(e.id,"-").concat(e.created_at);return!l.has(t)}).forEach(s=>{var i,o;if(s.event_type){const e="task_started"===s.event_type||"task_completed"===s.event_type||"task_failed"===s.event_type||"task_status"===s.event_type;if(s.event_type,e&&s.event_context){let e=s.event_context;if("starting_task"===e||"completing_task"===e){if(s.trace_metadata&&"object"===typeof s.trace_metadata){const t=s.trace_metadata;t.task_name&&(e=String(t.task_name))}}else if(e.includes("task:")){var r;e=(null===(r=e.split("task:")[1])||void 0===r?void 0:r.trim())||e}let t=!1;if(!e||"task_completion"===e||"starting_task"===e||"completing_task"===e||e.length<5)if("object"===typeof s.output&&null!==s.output&&"extra_data"in s.output){const n=s.output.extra_data;null!==n&&void 0!==n&&n.task_name?e=String(n.task_name):t=!0}else t=!0;if(!t){const t=[];if(t.push(e),s.trace_metadata&&"object"===typeof s.trace_metadata){const e=s.trace_metadata;e.task_id&&"string"===typeof e.task_id&&t.push(e.task_id),e.frontend_task_id&&"string"===typeof e.frontend_task_id&&t.push(e.frontend_task_id)}const n=e.split(/\s+/).filter(e=>e.length>0);for(let e=1;e<=Math.min(5,n.length);e++){const a=n.slice(0,e).join(" ");t.push(a),t.push(a.toLowerCase())}if(n.length>5)for(let e=1;e<=3;e++){const a=n.slice(-e).join(" ");t.push(a),t.push(a.toLowerCase())}const i=n.filter(e=>{const t=e.toLowerCase();return["research","analyze","compare","recommend","create","update","delete","fetch","process","validate","generate","build","test","deploy","configure","setup","install","check"].includes(t)});if(i.length>0){const e=n.indexOf(i[0]);if(t.push(i[0]),t.push(i[0].toLowerCase()),e<n.length-1){const a=n.slice(e,Math.min(e+3,n.length)).join(" ");t.push(a),t.push(a.toLowerCase())}}const o="task_".concat(e.replace(/\s+/g,"_").toLowerCase());t.push(o);const r=e.toLowerCase();r!==e&&t.push(r);const l=e.replace(/_/g," ");l!==e&&t.push(l);const d=Array.from(new Set(t));let c="running";if("task_completed"===s.event_type)c="completed";else if("task_failed"===s.event_type)c="failed";else if("task_started"===s.event_type)c="running";else if("agent_execution"===s.event_type)if(c="running","object"===typeof s.output&&null!==s.output){let e="";e="content"in s.output?String(s.output.content):"agent_execution"in s.output?String(s.output.agent_execution):"raw"in s.output?String(s.output.raw):JSON.stringify(s.output),(e.includes("Final Answer:")||e.includes("## Final Answer"))&&(c="completed")}else"string"===typeof s.output&&(s.output.includes("Final Answer:")||s.output.includes("## Final Answer"))&&(c="completed");d.forEach(t=>{const n=Pt.useTaskExecutionStore.getState().getTaskStatus(t);n&&n.status===c||h(t,(0,a.A)((0,a.A)((0,a.A)((0,a.A)({status:c,task_name:e},"running"===c&&{started_at:s.created_at}),"completed"===c&&{completed_at:s.created_at}),"failed"===c&&{failed_at:s.created_at}),n&&(0,a.A)((0,a.A)({},n.started_at&&{started_at:n.started_at}),n.completed_at&&"running"!==c&&{completed_at:n.completed_at})))})}}if("object"===typeof s.output&&null!==s.output&&"extra_data"in s.output){const e=s.output.extra_data;if(null!==e&&void 0!==e&&e.task_name){const t=String(e.task_name),n=e.task_id?String(e.task_id):"task_".concat(t.replace(/\s+/g,"_").toLowerCase()),i=[n,t];e.frontend_task_id&&"string"===typeof e.frontend_task_id&&i.push(String(e.frontend_task_id));const o=t.toLowerCase();o!==t&&i.push(o);const r=t.replace(/_/g," ");r!==t&&i.push(r),n.startsWith("task-")||n.startsWith("task_")||i.push("task-".concat(n));let l="running";"task_completed"===s.event_type||"completed"===(null===e||void 0===e?void 0:e.status)?l="completed":"task_failed"===s.event_type||"failed"===(null===e||void 0===e?void 0:e.status)?l="failed":"task_started"!==s.event_type&&"running"!==(null===e||void 0===e?void 0:e.status)||(l="running"),i.forEach(e=>{const n=Pt.useTaskExecutionStore.getState().getTaskStatus(e);n&&n.status===l||h(e,(0,a.A)((0,a.A)((0,a.A)((0,a.A)({status:l,task_name:t},"running"===l&&{started_at:s.created_at}),"completed"===l&&{completed_at:s.created_at}),"failed"===l&&{failed_at:s.created_at}),n&&(0,a.A)((0,a.A)({},n.started_at&&{started_at:n.started_at}),n.completed_at&&"running"!==l&&{completed_at:n.completed_at})))})}}}let l="";if("string"===typeof s.output?l=Rs(s.output):null!==(i=s.output)&&void 0!==i&&i.agent_execution&&"string"===typeof s.output.agent_execution?l=Rs(s.output.agent_execution):null!==(o=s.output)&&void 0!==o&&o.content&&"string"===typeof s.output.content?l=Rs(s.output.content):s.output&&(l=JSON.stringify(s.output,null,2)),!l.trim())return;const c="".concat(s.id,"-").concat(s.created_at),u={id:"trace-".concat(c),type:"trace",content:l,timestamp:new Date(s.created_at||Date.now()),isIntermediate:!0,eventSource:s.event_source,eventContext:s.event_context,eventType:s.event_type,jobId:n};p(e,u),t(u),d(e=>{const t=new Set(e);return t.add(c),t})})}catch(s){Error}},[l,t,p,e,h]);return(0,i.useEffect)(()=>{const a=t=>{const{jobId:n,jobName:a}=t.detail;s(n),r(n),d(new Set),u(new Date);const i=JSON.parse(localStorage.getItem("chatSessionJobNames")||"{}");i[e]=a,localStorage.setItem("chatSessionJobNames",JSON.stringify(i))},i=a=>{const{jobId:i}=a.detail;(n||i===o)&&(setTimeout(()=>{Bs.Pp.getRuns(100).then(n=>{var a;const s=n.runs.find(e=>e.job_id===i);if(null!==s&&void 0!==s&&null!==(a=s.result)&&void 0!==a&&a.output){let n=s.result.output;try{const e=JSON.parse(s.result.output);n=JSON.stringify(e,null,2)}catch(o){n=s.result.output}const a={id:"exec-result-".concat(Date.now()),type:"result",content:n,timestamp:new Date,jobId:i};p(e,a),t(a)}else if(null!==s&&void 0!==s&&s.result){let n="string"===typeof s.result?s.result:JSON.stringify(s.result,null,2);if("string"===typeof s.result)try{const e=JSON.parse(s.result);n=JSON.stringify(e,null,2)}catch(o){}const a={id:"exec-result-".concat(Date.now()),type:"result",content:n,timestamp:new Date,jobId:i};p(e,a),t(a)}}).catch(e=>{})},2e3),s(null),u(null),d(new Set),window.dispatchEvent(new CustomEvent("forceClearExecution")))},c=a=>{const{jobId:i,error:r}=a.detail;if(n||i===o){const n={id:"exec-failed-".concat(Date.now()),type:"execution",content:"\u274c Execution failed: ".concat(r),timestamp:new Date,jobId:i};p(e,n),t(n),s(null),u(null),d(new Set),window.dispatchEvent(new CustomEvent("forceClearExecution"))}},h=a=>{const{jobId:s,trace:i}=a.detail;if(s===n&&i){const n="".concat(i.id,"-").concat(i.created_at);if(l.has(n))return;const a={id:"trace-".concat(n),type:"trace",content:"string"===typeof i.output?i.output:JSON.stringify(i.output,null,2),timestamp:new Date(i.created_at||Date.now()),isIntermediate:!0,eventSource:i.event_source,eventContext:i.event_context,eventType:i.event_type,jobId:s};p(e,a),t(a),d(e=>{const t=new Set(e);return t.add(n),t})}},m=t=>{const{message:n}=t.detail;s(null);const a={id:"exec-error-".concat(Date.now()),type:"execution",content:"\u274c ".concat(n),timestamp:new Date};p(e,a)},x=()=>{s(null),u(null),d(new Set)},g=a=>{const{jobId:i,partialResults:r}=a.detail;if(n===i||i===o){const n={id:"exec-stopped-".concat(Date.now()),type:"execution",content:"\u23f9\ufe0f Execution stopped by user".concat(r?" (partial results saved)":""),timestamp:new Date,jobId:i};p(e,n),t(n),s(null),u(null),d(new Set),window.dispatchEvent(new CustomEvent("forceClearExecution"))}};return window.addEventListener("jobCreated",a),window.addEventListener("jobCompleted",i),window.addEventListener("jobFailed",c),window.addEventListener("jobStopped",g),window.addEventListener("traceUpdate",h),window.addEventListener("executionError",m),window.addEventListener("forceClearExecution",x),()=>{window.removeEventListener("jobCreated",a),window.removeEventListener("jobCompleted",i),window.removeEventListener("jobFailed",c),window.removeEventListener("jobStopped",g),window.removeEventListener("traceUpdate",h),window.removeEventListener("executionError",m),window.removeEventListener("forceClearExecution",x)}},[n,o,l,c,t,e,p,m]),(0,i.useEffect)(()=>{let e=null;if(n){const t=setTimeout(()=>x(n),2e3);return e=setInterval(()=>x(n),2e3),()=>{clearTimeout(t),e&&clearInterval(e)}}return()=>{e&&clearInterval(e)}},[n,x]),{executingJobId:n,setExecutingJobId:s,lastExecutionJobId:o,setLastExecutionJobId:r,executionStartTime:c}})(Ae,Se),Fe=e=>{const t=/\{([^}]+)\}/g,n=new Set;return e.forEach(e=>{if("agentNode"===e.type||"taskNode"===e.type){const a=e.data;[a.role,a.goal,a.backstory,a.description,a.expected_output,a.label].forEach(e=>{if(e&&"string"===typeof e){let a;for(t.lastIndex=0;null!==(a=t.exec(e));)n.add(a[1])}})}}),Array.from(n)};i.useEffect(()=>{me.current.updateUIState((0,a.A)((0,a.A)({},he),{},{chatPanelVisible:d}))},[d,he]),i.useEffect(()=>{const e=()=>{"undefined"!==typeof window&&me.current.updateScreenDimensions(window.innerWidth,window.innerHeight)};if("undefined"!==typeof window)return window.addEventListener("resize",e),window.debugCanvasLayout=()=>me.current.getLayoutDebugInfo(),()=>{window.removeEventListener("resize",e),delete window.debugCanvasLayout}},[]),(0,i.useEffect)(()=>{(()=>{var e;null===(e=ee.current)||void 0===e||e.scrollIntoView({behavior:"smooth"})})()},[De]),(0,i.useEffect)(()=>{n&&n(C)},[C,n]),(0,i.useEffect)(()=>{const e=[];return[0,100,300,500,1e3].forEach(t=>{const n=setTimeout(()=>{var e;null===(e=ne.current)||void 0===e||e.focus()},t);e.push(n)}),()=>{e.forEach(clearTimeout)}},[]),(0,i.useEffect)(()=>{if(!C){const e=setTimeout(()=>{var e;null===(e=ne.current)||void 0===e||e.focus()},100);return()=>clearTimeout(e)}},[C]),(0,i.useEffect)(()=>{if(d){const e=setTimeout(()=>{var e;null===(e=ne.current)||void 0===e||e.focus()},100);return()=>clearTimeout(e)}},[d]),(0,i.useEffect)(()=>{(async()=>{z(!0);try{const e=ve.J.getInstance(),t=await e.getEnabledModels();T(t)}catch(e){T({"databricks-llama-4-maverick":{name:"databricks-llama-4-maverick",temperature:.7,context_window:128e3,max_output_tokens:4096,enabled:!0}})}finally{z(!1)}})()},[]),(0,i.useEffect)(()=>{$()},[$]);const We=((e,t,n,s,i,o)=>async r=>{try{var l,d,c,u,h,m,p,x,g,f,v,A,y,b,j,w,k,C,S,_,E,I,T,D;const t={name:r.name,role:r.role,goal:r.goal,backstory:r.backstory,llm:(null===(l=r.advanced_config)||void 0===l?void 0:l.llm)||n,tools:r.tools||[],max_iter:(null===(d=r.advanced_config)||void 0===d?void 0:d.max_iter)||25,max_rpm:(null===(c=r.advanced_config)||void 0===c?void 0:c.max_rpm)||3,max_execution_time:(null===(u=r.advanced_config)||void 0===u?void 0:u.max_execution_time)||void 0,verbose:(null===(h=r.advanced_config)||void 0===h?void 0:h.verbose)||!1,allow_delegation:(null===(m=r.advanced_config)||void 0===m?void 0:m.allow_delegation)||!1,cache:null===(p=null===(x=r.advanced_config)||void 0===x?void 0:x.cache)||void 0===p||p,system_template:(null===(g=r.advanced_config)||void 0===g?void 0:g.system_template)||void 0,prompt_template:(null===(f=r.advanced_config)||void 0===f?void 0:f.prompt_template)||void 0,response_template:(null===(v=r.advanced_config)||void 0===v?void 0:v.response_template)||void 0,allow_code_execution:(null===(A=r.advanced_config)||void 0===A?void 0:A.allow_code_execution)||!1,code_execution_mode:(null===(y=r.advanced_config)||void 0===y?void 0:y.code_execution_mode)||"safe",max_retry_limit:(null===(b=r.advanced_config)||void 0===b?void 0:b.max_retry_limit)||2,use_system_prompt:null===(j=null===(w=r.advanced_config)||void 0===w?void 0:w.use_system_prompt)||void 0===j||j,respect_context_window:null===(k=null===(C=r.advanced_config)||void 0===C?void 0:C.respect_context_window)||void 0===k||k,memory:null===(S=null===(_=r.advanced_config)||void 0===_?void 0:_.memory)||void 0===S||S,embedder_config:null!==(E=r.advanced_config)&&void 0!==E&&E.embedder_config?{provider:r.advanced_config.embedder_config.provider||"databricks",config:(0,a.A)({model:(null===(I=r.advanced_config.embedder_config.config)||void 0===I?void 0:I.model)||"databricks-gte-large-en"},r.advanced_config.embedder_config.config||{})}:void 0,knowledge_sources:(null===(T=r.advanced_config)||void 0===T?void 0:T.knowledge_sources)||[],function_calling_llm:(null===(D=r.advanced_config)||void 0===D?void 0:D.function_calling_llm)||void 0},N=await fe.AgentService.createAgent(t);if(!N)throw new Error("Failed to save agent");e(e=>{const t=(null===i||void 0===i?void 0:i.current.getAgentNodePosition(e,"crew"))||{x:100,y:100},n={id:"agent-".concat(N.id),type:"agentNode",position:t,data:{label:N.name,agentId:N.id,role:N.role,goal:N.goal,backstory:N.backstory,llm:N.llm,tools:N.tools||[],agent:N}},a=[...e,n];return setTimeout(()=>{window.dispatchEvent(new Event("fitViewToNodesInternal"))},100),s&&s([n],[]),a}),[100,300,500,800,1200].forEach(e=>{setTimeout(()=>{var e;null===o||void 0===o||null===(e=o.current)||void 0===e||e.focus()},e)})}catch(M){let a="";if(M instanceof Error)a=": ".concat(M.message);else if("object"===typeof M&&null!==M){var N,P;const e=M;null!==(N=e.response)&&void 0!==N&&null!==(N=N.data)&&void 0!==N&&N.detail?a=": ".concat(e.response.data.detail):null!==(P=e.response)&&void 0!==P&&null!==(P=P.data)&&void 0!==P&&P.message&&(a=": ".concat(e.response.data.message))}const l={id:"error-".concat(Date.now()),type:"assistant",content:'\u274c Failed to save agent "'.concat(r.name,'"').concat(a,". The agent will be created locally but won't be persisted."),timestamp:new Date};t(e=>[...e,l]),[100,300,500,800].forEach(e=>{setTimeout(()=>{var e;null===o||void 0===o||null===(e=o.current)||void 0===e||e.focus()},e)}),e(e=>{var t;const a=(null===i||void 0===i?void 0:i.current.getAgentNodePosition(e,"crew"))||{x:100,y:100},o={id:"agent-".concat(Date.now()),type:"agentNode",position:a,data:{label:r.name,role:r.role,goal:r.goal,backstory:r.backstory,llm:(null===(t=r.advanced_config)||void 0===t?void 0:t.llm)||n,tools:r.tools||[],agent:r}},l=[...e,o];return setTimeout(()=>{window.dispatchEvent(new Event("fitViewToNodesInternal"))},100),s&&s([o],[]),l})}})(ae,Ne,r,t,me,ne),Ve=((e,t,n,a,s,i)=>async o=>{try{var r,l,d,c,u,h,m,p;const{nodes:n,edges:x}=g.Y.getState(),f=n.filter(e=>"agentNode"===e.type);let v="";if(f.length>0){const e=f.filter(e=>!x.some(t=>{var a;return t.source===e.id&&"taskNode"===(null===(a=n.find(e=>e.id===t.target))||void 0===a?void 0:a.type)}));if(e.length>0){const t=e[0].data;v=t.agentId||""}else if(f.length>0){const e=f[0].data;v=e.agentId||""}}const A=(o.tools||[]).map(e=>"string"===typeof e?e:e&&"object"===typeof e&&"name"in e?e.name:"").filter(Boolean),y={name:o.name,description:o.description,expected_output:o.expected_output,tools:A,agent_id:v,async_execution:Boolean(null===(r=o.advanced_config)||void 0===r?void 0:r.async_execution)||!1,markdown:Boolean(null===(l=o.advanced_config)||void 0===l?void 0:l.markdown)||!1,context:[],config:{cache_response:!1,cache_ttl:3600,retry_on_fail:!0,max_retries:3,timeout:null,priority:1,error_handling:"default",output_file:(null===(d=o.advanced_config)||void 0===d?void 0:d.output_file)||null,output_json:null!==(c=o.advanced_config)&&void 0!==c&&c.output_json?"string"===typeof o.advanced_config.output_json?o.advanced_config.output_json:JSON.stringify(o.advanced_config.output_json):null,output_pydantic:(null===(u=o.advanced_config)||void 0===u?void 0:u.output_pydantic)||null,callback:(null===(h=o.advanced_config)||void 0===h?void 0:h.callback)||null,human_input:Boolean(null===(m=o.advanced_config)||void 0===m?void 0:m.human_input)||!1,markdown:Boolean(null===(p=o.advanced_config)||void 0===p?void 0:p.markdown)||!1}},b=await Re.createTask(y);if(!b)throw new Error("Failed to save task");e(e=>{var t;const n=(null===s||void 0===s?void 0:s.current.getTaskNodePosition(e,"crew"))||{x:400,y:100},i={id:"task-".concat(b.id),type:"taskNode",position:n,data:{label:b.name,taskId:b.id,description:b.description,expected_output:b.expected_output,tools:b.tools||[],human_input:(null===(t=b.config)||void 0===t?void 0:t.human_input)||!1,async_execution:b.async_execution||!1,task:b}},o=[...e,i];return setTimeout(()=>{window.dispatchEvent(new Event("fitViewToNodesInternal"))},100),a&&a([i],[]),o}),v&&t(e=>{const t="agent-".concat(v),n="task-".concat(b.id);return[...e,{id:"edge-".concat(t,"-").concat(n),source:t,target:n,type:"default",animated:!0}]}),[100,300,500,800,1200].forEach(e=>{setTimeout(()=>{var e;null===i||void 0===i||null===(e=i.current)||void 0===e||e.focus()},e)})}catch(v){let t="";if(v instanceof Error)t=": ".concat(v.message);else if("object"===typeof v&&null!==v){var x,f;const e=v;null!==(x=e.response)&&void 0!==x&&null!==(x=x.data)&&void 0!==x&&x.detail?t=": ".concat(e.response.data.detail):null!==(f=e.response)&&void 0!==f&&null!==(f=f.data)&&void 0!==f&&f.message&&(t=": ".concat(e.response.data.message))}const r={id:"error-".concat(Date.now()),type:"assistant",content:'\u274c Failed to save task "'.concat(o.name,'"').concat(t,". The task will be created locally but won't be persisted."),timestamp:new Date};n(e=>[...e,r]),[100,300,500,800].forEach(e=>{setTimeout(()=>{var e;null===i||void 0===i||null===(e=i.current)||void 0===e||e.focus()},e)}),e(e=>{var t,n;const i=(null===s||void 0===s?void 0:s.current.getTaskNodePosition(e,"crew"))||{x:400,y:100},r={id:"task-".concat(Date.now()),type:"taskNode",position:i,data:{label:o.name,description:o.description,expected_output:o.expected_output,tools:o.tools||[],human_input:(null===(t=o.advanced_config)||void 0===t?void 0:t.human_input)||!1,async_execution:(null===(n=o.advanced_config)||void 0===n?void 0:n.async_execution)||!1,task:o}},l=[...e,r];return setTimeout(()=>{window.dispatchEvent(new Event("fitViewToNodesInternal"))},100),a&&a([r],[]),l})}})(ae,se,Ne,t,me,ne),Be=((e,t,n,a,s,i,o,r)=>l=>{var d,c;const u=[],h=[],m=new Map;n(null),a(null);const p=(null===(d=l.agents)||void 0===d?void 0:d.length)||0,x=(null===(c=l.tasks)||void 0===c?void 0:c.length)||0,g=(null===o||void 0===o?void 0:o.current.getCrewLayoutPositions(p,x,"crew"))||{agentPositions:[],taskPositions:[],layoutBounds:null,shouldAutoFit:!1},{agentPositions:f,taskPositions:v,layoutBounds:A,shouldAutoFit:y}=g;l.agents&&l.agents.forEach((e,t)=>{var n;const a="agent-".concat(e.id||Date.now()+t);m.set((null===(n=e.id)||void 0===n?void 0:n.toString())||e.name,a),u.push({id:a,type:"agentNode",position:f[t]||{x:100,y:100+150*t},data:{label:e.name,agentId:e.id,role:e.role,goal:e.goal,backstory:e.backstory,llm:e.llm||s,tools:e.tools||[],agent:e}})}),l.tasks&&l.tasks.forEach((e,t)=>{var n;const a="task-".concat(e.id||Date.now()+t);if(u.push({id:a,type:"taskNode",position:v[t]||{x:400,y:100+150*t},data:{label:e.name,taskId:e.id,description:e.description,expected_output:e.expected_output,tools:e.tools||[],human_input:(null===(n=e.config)||void 0===n?void 0:n.human_input)||!1,async_execution:e.async_execution||!1,context:e.context||[],task:e}}),e.agent_id){const t=m.get(e.agent_id.toString());t&&h.push({id:"edge-".concat(t,"-").concat(a),source:t,target:a,type:"default",animated:!0})}e.context&&Array.isArray(e.context)&&e.context.forEach(e=>{const t="task-".concat(e);u.some(e=>e.id===t)&&h.push({id:"edge-".concat(t,"-").concat(a),source:t,target:a,type:"default",animated:!0,style:{stroke:"#ff9800"}})})}),e(e=>[...e,...u]),t(e=>[...e,...h]),i&&i(u,h),y?setTimeout(()=>{window.dispatchEvent(new CustomEvent("autoFitCrewNodes",{detail:{layoutBounds:A,zoom:null===o||void 0===o?void 0:o.current.getAutoFitZoom(A,"crew")}}))},400):setTimeout(()=>{window.dispatchEvent(new Event("fitViewToNodesInternal"))},100),[300,500,800,1200].forEach(e=>{setTimeout(()=>{var e;null===r||void 0===r||null===(e=r.current)||void 0===e||e.focus()},e)})})(ae,se,Oe,Me,r,t,me,ne),Ue=async()=>{if(!j.trim()||C)return;if(W&&B.length>0&&G<B.length){const e=B[G],t=j.trim(),n={id:"msg-".concat(Date.now()),type:"user",content:j,timestamp:new Date};Ne(e=>[...e,n]),w(""),Se(n);const s=(0,a.A)((0,a.A)({},H),{},{[e]:t});if(K(s),G+1<B.length){J(G+1);const e=B[G+1],t={id:"msg-".concat(Date.now()+1),type:"assistant",content:"Please provide a value for **{".concat(e,"}**:"),timestamp:new Date};Ne(e=>[...e,t]),Se(t)}else{R(!1),re(s);const e={id:"msg-".concat(Date.now()+1),type:"assistant",content:"\u2705 All variables collected! Executing ".concat(Y," with:\n").concat(Object.entries(s).map(e=>{let[t,n]=e;return"- **{".concat(t,"}**: ").concat(n)}).join("\n")),timestamp:new Date};Ne(t=>[...t,e]),Se(e);const t={id:"exec-pending-".concat(Date.now()),type:"execution",content:"\u23f3 Preparing to execute ".concat(Y,"..."),timestamp:new Date};Ne(e=>[...e,t]),"crew"===Y?await le(m,x):await ce(m,x),U([]),K({}),J(0)}return}const e=De[De.length-1];if("assistant"===(null===e||void 0===e?void 0:e.type)&&(null===e||void 0===e?void 0:e.content.includes("Would you like to execute this crew now?"))){const e=j.trim().toLowerCase(),t={id:"msg-".concat(Date.now()),type:"user",content:j,timestamp:new Date};if(Ne(e=>[...e,t]),w(""),Se(t),"yes"===e||"y"===e||"yeah"===e||"sure"===e||"ok"===e||"okay"===e){if(Ps(m)){const e=Fe(m);if(e.length>0&&"chat"===oe){R(!0),U(e),K({}),J(0),X("crew");const t={id:"msg-".concat(Date.now()+1),type:"assistant",content:"I need to collect values for ".concat(e.length," variable").concat(e.length>1?"s":""," in your workflow.\n\nPlease provide a value for **{").concat(e[0],"}**:"),timestamp:new Date};Ne(e=>[...e,t]),Se(t)}else if(f){const e={id:"exec-pending-".concat(Date.now()),type:"execution",content:"\u23f3 Preparing to execute crew...",timestamp:new Date};Ne(t=>[...t,e]),f()}}}else{const e={id:"msg-".concat(Date.now()+1),type:"assistant",content:'No problem! The crew is ready whenever you want to execute it. Just type "execute crew" or "ec" when you\'re ready.',timestamp:new Date};Ne(t=>[...t,e]),Se(e)}return}const t=j.trim().toLowerCase();if("input mode dialog"===t||"input dialog"===t){const e={id:"msg-".concat(Date.now()),type:"user",content:j,timestamp:new Date};Ne(t=>[...t,e]),w(""),Se(e),ie("dialog");const t={id:"msg-".concat(Date.now()+1),type:"assistant",content:"\u2705 Input mode changed to Dialog. When executing workflows with variables, a popup dialog will appear to collect all values at once.",timestamp:new Date};return Ne(e=>[...e,t]),void Se(t)}if("input mode chat"===t||"input chat"===t){const e={id:"msg-".concat(Date.now()),type:"user",content:j,timestamp:new Date};Ne(t=>[...t,e]),w(""),Se(e),ie("chat");const t={id:"msg-".concat(Date.now()+1),type:"assistant",content:"\u2705 Input mode changed to Chat. When executing workflows with variables, I will guide you through providing values one by one in the chat.",timestamp:new Date};return Ne(e=>[...e,t]),void Se(t)}if((e=>{const t=e.trim().toLowerCase();return"execute crew"===t||"ec"===t||"run"===t||"execute"===t||t.startsWith("ec ")||t.startsWith("execute crew ")})(j)){const e={id:"msg-".concat(Date.now()),type:"user",content:j,timestamp:new Date};Ne(t=>[...t,e]),w(""),Se(e);const t=(e=>{const t=e.trim().toLowerCase();return t.startsWith("ec ")?e.trim().substring(3).trim():t.startsWith("execute crew ")?e.trim().substring(13).trim():null})(j);if(t){S(!0);try{const e=await Es.A.getTraces(t);if(e&&e.length>0){const n={id:"msg-".concat(Date.now()+1),type:"assistant",content:"Showing ".concat(e.length," execution traces for job ").concat(t,":"),timestamp:new Date};Ne(e=>[...e,n]),e.forEach((e,n)=>{var a,s;let i="";if("string"===typeof e.output?i=e.output:null!==(a=e.output)&&void 0!==a&&a.agent_execution&&"string"===typeof e.output.agent_execution?i=e.output.agent_execution:null!==(s=e.output)&&void 0!==s&&s.content&&"string"===typeof e.output.content?i=e.output.content:e.output&&(i=JSON.stringify(e.output,null,2)),!i.trim())return;const o={id:"trace-display-".concat(e.id,"-").concat(n),type:"trace",content:i,timestamp:new Date(e.created_at||Date.now()),isIntermediate:!1,eventSource:e.event_source,eventContext:e.event_context,eventType:e.event_type,jobId:t||void 0};Ne(e=>[...e,o]),Se(o)})}else{const e={id:"msg-".concat(Date.now()+1),type:"assistant",content:"No execution traces found for job ".concat(t,"."),timestamp:new Date};Ne(t=>[...t,e])}}catch(s){const e={id:"msg-".concat(Date.now()+1),type:"assistant",content:"Failed to fetch execution traces. Please try again.",timestamp:new Date};Ne(t=>[...t,e])}finally{S(!1)}return}if(Ps(m)){const e=Fe(m);if(e.length>0&&"chat"===oe){R(!0),U(e),K({}),J(0),X("crew");const t={id:"msg-".concat(Date.now()+1),type:"assistant",content:"I need to collect values for ".concat(e.length," variable").concat(e.length>1?"s":""," in your workflow.\n\nPlease provide a value for **{").concat(e[0],"}**:"),timestamp:new Date};Ne(e=>[...e,t]),Se(t)}else if(f){const e={id:"exec-pending-".concat(Date.now()),type:"execution",content:"\u23f3 Preparing to execute crew...",timestamp:new Date};Ne(t=>[...t,e]),f()}return}const n={id:"msg-".concat(Date.now()+1),type:"assistant",content:"No crew found. Please create a crew first using natural language.",timestamp:new Date};return void Ne(e=>[...e,n])}const n={id:"msg-".concat(Date.now()),type:"user",content:j,timestamp:new Date};Ne(e=>[...e,n]),w(""),S(!0),Se(n);try{const e=await vs.dispatch({message:n.content,model:r,tools:l}),t={id:"msg-".concat(Date.now()+1),type:"assistant",content:He(e),timestamp:new Date,intent:e.dispatcher.intent,confidence:e.dispatcher.confidence,result:e.generation_result};if(Ne(e=>[...e,t]),Se(t),e.generation_result)switch(e.dispatcher.intent){case"generate_agent":await We(e.generation_result);break;case"generate_task":await Ve(e.generation_result);break;case"generate_crew":case"generate_plan":Be(e.generation_result);break;case"configure_crew":((e,t)=>{const{config_type:n,actions:a}=e;null!==a&&void 0!==a&&a.open_llm_dialog&&setTimeout(()=>{const e=new CustomEvent("openLLMDialog");window.dispatchEvent(e)},100),null!==a&&void 0!==a&&a.open_maxr_dialog&&setTimeout(()=>{const e=new CustomEvent("openMaxRPMDialog");window.dispatchEvent(e)},200),null!==a&&void 0!==a&&a.open_tools_dialog&&setTimeout(()=>{const e=new CustomEvent("openToolDialog");window.dispatchEvent(e)},300),setTimeout(()=>{var e;null===t||void 0===t||null===(e=t.current)||void 0===e||e.focus()},500)})(e.generation_result,ne)}}catch(s){const e={id:"msg-".concat(Date.now()+1),type:"assistant",content:"\u274c Failed to process your request. Please try again or rephrase your message.",timestamp:new Date};Ne(t=>[...t,e]),Se(e)}finally{S(!1);[0,50,100,200,300,500,800,1200].forEach(e=>{setTimeout(()=>{var e;null===(e=ne.current)||void 0===e||e.focus()},e)})}},He=e=>{const{dispatcher:t,generation_result:n}=e;if("unknown"===t.intent)return"I'm not sure what you want to create. Please specify if you want to create an agent, a task, or a complete crew.";if(!n)return"I understood your request but couldn't generate the result. Please try again.";switch(t.intent){case"generate_agent":{const e=n;return"I've created an agent: **".concat(e.name,"** (").concat(e.role,")\n- Goal: ").concat(e.goal,"\n- Backstory: ").concat(e.backstory)}case"generate_task":{const e=n;return"I've created a task: **".concat(e.name,"**\n- Description: ").concat(e.description,"\n- Expected Output: ").concat(e.expected_output)}case"generate_crew":{const e=n;let t="I've created a crew with:\n";if(e.agents&&e.agents.length>0){var a;t+="\n**Agents & Tasks:**\n",e.agents.forEach((n,a)=>{var s;t+="".concat(a+1,". **").concat(n.name,"** (").concat(n.role,") - ").concat(n.goal,"\n");const i=(null===(s=e.tasks)||void 0===s?void 0:s.filter(e=>{var t,a;return e.agent_id===n.id||(null===(t=e.agent_id)||void 0===t?void 0:t.toString())===(null===(a=n.id)||void 0===a?void 0:a.toString())}))||[];i.length>0&&i.forEach(e=>{t+="   \u2192 ".concat(e.name,": ").concat(e.description,"\n")})});const n=(null===(a=e.tasks)||void 0===a?void 0:a.filter(e=>!e.agent_id))||[];n.length>0&&(t+="\n**Unassigned Tasks:**\n",n.forEach((e,n)=>{t+="".concat(n+1,". **").concat(e.name,"** - ").concat(e.description,"\n")}))}return t+="\nTo execute plan type either **execute crew** or **ec**",t}case"generate_plan":{const e=n;let t="I've created a plan with:\n";if(e.agents&&e.agents.length>0){var s;t+="\n**Agents & Tasks:**\n",e.agents.forEach((n,a)=>{var s;t+="".concat(a+1,". **").concat(n.name,"** (").concat(n.role,") - ").concat(n.goal,"\n");const i=(null===(s=e.tasks)||void 0===s?void 0:s.filter(e=>{var t,a;return e.agent_id===n.id||(null===(t=e.agent_id)||void 0===t?void 0:t.toString())===(null===(a=n.id)||void 0===a?void 0:a.toString())}))||[];i.length>0&&i.forEach(e=>{t+="   \u2192 ".concat(e.name,": ").concat(e.description,"\n")})});const n=(null===(s=e.tasks)||void 0===s?void 0:s.filter(e=>!e.agent_id))||[];n.length>0&&(t+="\n**Unassigned Tasks:**\n",n.forEach((e,n)=>{t+="".concat(n+1,". **").concat(e.name,"** - ").concat(e.description,"\n")}))}return t+="\nTo execute plan type either **execute crew** or **ec**",t}default:return"Your request has been processed successfully."}};return(0,O.jsxs)(o.A,{sx:{height:"100%",display:"flex",flexDirection:"column",position:"relative",overflow:"hidden",maxWidth:"100%",width:"100%"},children:[(0,O.jsxs)(o.A,{sx:{p:1,borderBottom:1,borderColor:"divider",display:"flex",alignItems:"center",justifyContent:"space-between",backgroundColor:e=>"dark"===e.palette.mode?"grey.900":"grey.50",flexShrink:0},children:[(0,O.jsxs)(o.A,{sx:{display:"flex",flexDirection:"column"},children:[(0,O.jsxs)(c.A,{variant:"subtitle2",sx:{display:"flex",alignItems:"center",gap:1,fontWeight:600},children:[(0,O.jsx)(ps.A,{fontSize:"small"}),"Kasal"]}),"New Chat"!==ke&&(0,O.jsx)(c.A,{variant:"caption",sx:{color:"text.secondary",ml:3},children:ke})]}),(0,O.jsxs)(hs.A,{direction:"row",spacing:1,children:[(0,O.jsx)(P.A,{title:"New Chat",children:(0,O.jsx)(u.A,{size:"small",onClick:Te,children:(0,O.jsx)(Qt.A,{fontSize:"small"})})}),(0,O.jsx)(P.A,{title:"Chat History",children:(0,O.jsx)(u.A,{size:"small",onClick:()=>{E(!0),Ee()},children:(0,O.jsx)(xs.A,{fontSize:"small"})})}),(0,O.jsx)(P.A,{title:"Collapse Chat",children:(0,O.jsx)(u.A,{size:"small",onClick:v,children:(0,O.jsx)(M.A,{fontSize:"small"})})})]})]}),(0,O.jsxs)(o.A,{sx:{position:"absolute",top:0,right:_?0:"-450px",width:450,height:"100%",backgroundColor:e=>e.palette.background.paper,boxShadow:e=>_?e.shadows[8]:"none",transition:"right 0.3s ease-in-out",zIndex:10,display:"flex",flexDirection:"column"},children:[(0,O.jsxs)(o.A,{sx:{p:1.5,borderBottom:1,borderColor:"divider",backgroundColor:e=>"dark"===e.palette.mode?"grey.900":"grey.50",display:"flex",alignItems:"center",justifyContent:"space-between"},children:[(0,O.jsx)(c.A,{variant:"subtitle2",sx:{fontWeight:600},children:"Chat History"}),(0,O.jsxs)(hs.A,{direction:"row",spacing:.5,children:[(0,O.jsx)(P.A,{title:"Refresh",children:(0,O.jsx)(u.A,{size:"small",onClick:Ee,disabled:we,children:we?(0,O.jsx)(ue.A,{size:20}):(0,O.jsx)(gs.A,{})})}),(0,O.jsx)(P.A,{title:"Close",children:(0,O.jsx)(u.A,{size:"small",onClick:()=>E(!1),children:(0,O.jsx)(D.A,{fontSize:"small"})})})]})]}),(0,O.jsx)(o.A,{sx:{flex:1,overflow:"auto",p:2},children:0===be.length?(0,O.jsx)(c.A,{variant:"body2",color:"text.secondary",sx:{textAlign:"center",mt:4},children:"No previous chat sessions found"}):(0,O.jsx)(at.A,{sx:{p:0},children:be.map(e=>(0,O.jsxs)(ha.A,{onClick:()=>Ie(e.session_id),selected:e.session_id===Ae,sx:{borderRadius:1,mb:1,border:1,borderColor:"divider"},children:[(0,O.jsx)(ot.A,{primary:JSON.parse(localStorage.getItem("chatSessionJobNames")||"{}")[e.session_id]||"Session ".concat(new Date(e.latest_timestamp).toLocaleDateString()),secondary:"".concat(new Date(e.latest_timestamp).toLocaleTimeString()," \u2022 ").concat(e.message_count||0," messages")}),(0,O.jsx)(P.A,{title:"Delete Session",children:(0,O.jsx)(u.A,{edge:"end",size:"small",onClick:async t=>{t.stopPropagation();try{await _s.deleteSession(e.session_id);const t=JSON.parse(localStorage.getItem("chatSessionJobNames")||"{}");delete t[e.session_id],localStorage.setItem("chatSessionJobNames",JSON.stringify(t)),Ee()}catch(n){const e={id:"error-".concat(Date.now()),type:"assistant",content:"\u274c Failed to delete session. Please try again.",timestamp:new Date};Ne(t=>[...t,e])}},children:(0,O.jsx)(q.A,{fontSize:"small"})})})]},e.session_id))})})]}),_&&(0,O.jsx)(o.A,{onClick:()=>E(!1),sx:{position:"absolute",top:0,left:-1e3,right:450,bottom:0,zIndex:9}}),(0,O.jsxs)(o.A,{sx:{flex:1,overflow:"auto",px:1,py:2,width:"100%",maxWidth:"100%",position:"relative",minWidth:0,display:"flex",flexDirection:"column"},children:[0===De.length?(0,O.jsxs)(o.A,{sx:{textAlign:"center",mt:4},children:[(0,O.jsx)(c.A,{variant:"body2",color:"text.secondary",paragraph:!0,children:"Try saying something like:"}),(0,O.jsxs)(at.A,{dense:!0,children:[(0,O.jsx)(st.Ay,{children:(0,O.jsx)(ot.A,{primary:"Create an agent that can analyze financial data",secondary:"Creates a single agent"})}),(0,O.jsx)(st.Ay,{children:(0,O.jsx)(ot.A,{primary:"I need a task to summarize documents",secondary:"Creates a single task"})}),(0,O.jsx)(st.Ay,{children:(0,O.jsx)(ot.A,{primary:"Build a research team with a researcher and writer",secondary:"Complete a plan"})})]})]}):(0,O.jsx)(at.A,{sx:{width:"100%",maxWidth:"100%",pt:0,pb:0},children:(()=>{const e=De.filter(e=>"execution"!==e.type||!e.content.includes("\u{1f680} Started execution:")&&!e.content.includes("\u2705 Execution completed successfully")),t=[];let n=[];return e.forEach((e,a)=>{"trace"===e.type?n.push(e):(n.length>0&&(t.push([...n]),n=[]),t.push(e))}),n.length>0&&t.push(n),t.map((e,n)=>{if(Array.isArray(e)){const a="trace-group-".concat(e[0].id,"-").concat(e[e.length-1].id,"-").concat(n);return(0,O.jsxs)(i.Fragment,{children:[(0,O.jsx)($s,{messages:e,onOpenLogs:y}),n<t.length-1&&(0,O.jsx)(te.A,{component:"li",sx:{ml:0}})]},a)}return(0,O.jsxs)(i.Fragment,{children:[(0,O.jsx)(Qs,{message:e,onOpenLogs:y}),n<t.length-1&&(0,O.jsx)(te.A,{component:"li",sx:{ml:0}})]},e.id)})})()}),(0,O.jsx)("div",{ref:ee})]}),(0,O.jsx)(_e.A,{elevation:3,sx:{p:2,borderTop:1,borderColor:"divider",borderRadius:0,flexShrink:0},children:(0,O.jsxs)(o.A,{sx:{position:"relative"},children:[(0,O.jsx)(V.A,{ref:ne,fullWidth:!0,variant:"outlined",placeholder:Pe?"Execution in progress...":Ps(m)?"Type 'execute crew' or 'ec'...":"Describe what you want to create...",value:j,onChange:e=>w(e.target.value),onKeyDown:e=>{(e=>{e.stopPropagation(),"Enter"!==e.key||e.shiftKey||(e.preventDefault(),Ue())})(e),e.stopPropagation()},disabled:C||!!Pe,multiline:!0,maxRows:6,size:"small",sx:{"& .MuiOutlinedInput-root":{paddingRight:"120px",borderColor:Ps(m)?"primary.main":void 0,borderRadius:1,"&:hover":{borderColor:Ps(m)?"primary.main":void 0}}},InputProps:{endAdornment:(0,O.jsxs)(o.A,{sx:{position:"absolute",right:35,bottom:8,display:"flex",alignItems:"center",gap:.25},children:[(0,O.jsx)(o.A,{sx:{display:"flex",alignItems:"center"},children:(0,O.jsx)(ui,{executionId:Ae||"default",groupId:localStorage.getItem("groupId")||"default",disabled:C||!!Pe||!Z||!Q,onFilesUploaded:e=>{},onAgentsUpdated:e=>{const t=m.map(t=>{if("agentNode"===t.type){const n=e.find(e=>e.id===t.data.agentId||e.id===t.data.id||e.id&&"agent-".concat(e.id)===t.id||"agent-".concat(e.name)===t.id);if(n)return(0,a.A)((0,a.A)({},t),{},{data:(0,a.A)((0,a.A)((0,a.A)({},t.data),n),{},{agentId:n.id,tools:n.tools,knowledge_sources:n.knowledge_sources})})}return t});ae(t)},availableAgents:m.filter(e=>"agentNode"===e.type).map(e=>(0,a.A)((0,a.A)({},e.data),{},{id:e.data.agentId||e.data.id})),compact:!0})}),h&&(0,O.jsxs)(o.A,{onClick:e=>F(e.currentTarget),sx:{display:"flex",alignItems:"center",gap:.25,cursor:"pointer",padding:"2px 6px",borderRadius:.5,fontSize:"0.75rem",color:"text.secondary",transition:"all 0.2s",backgroundColor:"rgba(255, 255, 255, 0.8)",maxWidth:"110px","&:hover":{backgroundColor:"action.hover",color:"text.primary"}},children:[(0,O.jsx)(c.A,{variant:"caption",sx:{fontSize:"0.75rem",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",maxWidth:"90px"},children:(e=>{const t=(null===(e=I[r])||void 0===e?void 0:e.name)||r;return t.includes("databricks-gpt-oss-120b")?"GPT OSS 120B":t.includes("databricks-gpt-oss-20b")?"GPT OSS 20B":t.includes("databricks-llama-4-maverick")?"Llama 4":t.includes("databricks-meta-llama-3-1-405b-instruct")||t.includes("databricks-meta-llama-3-3-70b-instruct")?"Llama 3":t.includes("databricks-llama-70b")?"Llama 3 70B":t.includes("databricks-llama-405b")?"Llama 3 405B":t.includes("gpt-4")?"GPT-4":t.includes("gpt-3.5")?"GPT-3.5":t.includes("claude")?"Claude":t.length>15?t.substring(0,15)+"...":t})()}),(0,O.jsx)(fs.A,{sx:{fontSize:14}})]}),(0,O.jsx)(p.A,{anchorEl:L,open:Boolean(L),onClose:()=>F(null),anchorOrigin:{vertical:"top",horizontal:"right"},transformOrigin:{vertical:"bottom",horizontal:"right"},slotProps:{paper:{sx:{mt:-1,minWidth:250,maxHeight:400}}},children:N?(0,O.jsxs)(de.A,{disabled:!0,children:[(0,O.jsx)(ue.A,{size:16,sx:{mr:1}}),"Loading models..."]}):0===Object.keys(I).length?(0,O.jsx)(de.A,{disabled:!0,children:"No models available"}):Object.entries(I).map(e=>{let[t,n]=e;return(0,O.jsx)(de.A,{onClick:()=>{h&&h(t),F(null)},selected:t===r,sx:{fontSize:"0.813rem",py:.75,"&.Mui-selected":{backgroundColor:"action.selected"}},children:(0,O.jsxs)(o.A,{sx:{width:"100%"},children:[(0,O.jsx)(c.A,{variant:"body2",sx:{fontSize:"0.813rem"},children:n.name}),n.provider&&(0,O.jsx)(c.A,{variant:"caption",sx:{fontSize:"0.688rem",color:"text.secondary",display:"block"},children:n.provider})]})},t)})})]})}}),(0,O.jsx)(u.A,{color:"primary",onClick:Ue,disabled:!j.trim()||C||!!Pe,sx:{position:"absolute",right:8,bottom:8,padding:"6px",backgroundColor:"primary.main",color:"primary.contrastText",borderRadius:"50%",width:28,height:28,"&:hover":{backgroundColor:"primary.dark"},"&.Mui-disabled":{backgroundColor:"action.disabledBackground",color:"action.disabled"}},children:C||Pe?(0,O.jsx)(ue.A,{size:16,sx:{color:"inherit"}}):(0,O.jsx)(ms.A,{sx:{fontSize:16}})})]})})]})},mi=hi,pi=e=>{let{onNodesGenerated:t,onLoadingStateChange:n,isVisible:a=!0,nodes:s=[],edges:i=[],onExecuteCrew:r,isCollapsed:l=!1,onToggleCollapse:d,chatSessionId:c,onOpenLogs:h}=e;const{selectedModel:m,setSelectedModel:p}=(0,b.E)(),{selectedTools:x}=xn();return l?(0,O.jsx)(_e.A,{"data-tour":"chat-toggle",sx:{width:60,height:"100%",display:"flex",flexDirection:"column",alignItems:"center",borderLeft:1,borderColor:"divider",borderRadius:0,boxShadow:"none",backgroundColor:"background.paper",overflow:"hidden",contain:"layout size"},children:(0,O.jsxs)(o.A,{sx:{p:1.5,borderBottom:1,borderColor:"divider",backgroundColor:e=>"dark"===e.palette.mode?"grey.900":"grey.50",width:"100%",display:"flex",flexDirection:"column",alignItems:"center",gap:1},children:[(0,O.jsx)(cs.A,{sx:{fontSize:"1.5rem",color:"primary.main"}}),(0,O.jsx)(P.A,{title:"Expand Kasal Chat",placement:"left",children:(0,O.jsx)(u.A,{size:"small",onClick:d,sx:{backgroundColor:"primary.main",color:"primary.contrastText","&:hover":{backgroundColor:"primary.dark"}},children:(0,O.jsx)(us.A,{fontSize:"small"})})})]})}):(0,O.jsx)(_e.A,{"data-tour":"chat-panel",sx:{height:"100%",width:"100%",display:"flex",flexDirection:"column",borderLeft:1,borderColor:"divider",borderRadius:0,boxShadow:"none",transition:"all 0.3s ease-in-out",overflow:"hidden",position:"relative",minWidth:0,isolation:"isolate",contain:"layout size"},children:(0,O.jsx)(o.A,{sx:{flex:1,overflow:"hidden",display:"flex",flexDirection:"column",position:"relative",width:"100%",minWidth:0,"& > *":{minWidth:0,maxWidth:"100%"}},children:(0,O.jsx)(mi,{onNodesGenerated:t,onLoadingStateChange:n,selectedModel:m,selectedTools:x,isVisible:a,setSelectedModel:p,nodes:s,edges:i,onExecuteCrew:r,onToggleCollapse:d,chatSessionId:c,onOpenLogs:h})})})};function xi(e){const{nodes:t,crewFlowInstanceRef:n,flowFlowInstanceRef:a}=e,s=i.useCallback(()=>{if(!n.current||0===t.length)return;const e=new Is,a=Ns.getState().getUILayoutState();e.updateUIState(a);const s=e.getAvailableCanvasArea("crew");let i=1/0,o=1/0,r=-1/0,l=-1/0;if(t.forEach(e=>{e.position&&(i=Math.min(i,e.position.x),o=Math.min(o,e.position.y),r=Math.max(r,e.position.x+(e.width||200)),l=Math.max(l,e.position.y+(e.height||150)))}),i===1/0||o===1/0)return;const d=r-i,c=l-o,u=(s.width-40)/d,h=(s.height-40)/c,m=1.5*Math.min(u,h,2.5),p=s.x+(s.width-d*m)/2-i*m+250,x=s.y+(s.height-c*m)/2-o*m;n.current.setViewport({x:p,y:x,zoom:m},{duration:800})},[t,n]),o=i.useCallback(()=>{if(s(),a.current)try{setTimeout(()=>{var e;null===(e=a.current)||void 0===e||e.fitView({padding:.2,includeHiddenNodes:!1,duration:800})},100)}catch(e){}},[s,a]);return{handleUIAwareFitView:s,handleFitViewToNodesInternal:o}}function gi(e){const{nodes:t,setNodes:n,crewFlowInstanceRef:a,flowFlowInstanceRef:s,handleUIAwareFitView:o,handleFitViewToNodesInternal:r}=e,l=i.useCallback(e=>{const{layoutBounds:t}=e.detail||{};if(t&&a.current)try{const e=new Is,n=Ns.getState().getUILayoutState();e.updateUIState(n);const s=e.getAvailableCanvasArea("crew"),i=20,o=(s.width-2*i)/t.width,r=(s.height-2*i)/t.height,l=1.5*Math.min(o,r,2.2),d=240,c=s.x+(s.width-t.width*l)/2-t.x*l+d,u=s.y+(s.height-t.height*l)/2-t.y*l;a.current.setViewport({x:c,y:u,zoom:l}),setTimeout(()=>{var e;null===(e=a.current)||void 0===e||e.fitView({padding:.1,includeHiddenNodes:!1,duration:1e3,maxZoom:l})},100)}catch(n){r()}},[a,r]),d=i.useCallback(e=>{var a;if(0===t.length)return;const s=null===e||void 0===e||null===(a=e.detail)||void 0===a?void 0:a.reason;if("chat-panel-resize"!==s&&"execution-history-resize"!==s)return;const i=new Is({margin:20,minNodeSpacing:50}),r=Ns.getState().getUILayoutState();i.updateUIState(r);const l=i.reorganizeNodes(t,"crew");n(l),setTimeout(()=>{o()},100)},[t,n,o]);return i.useEffect(()=>{const e=()=>r(),t=e=>l(e),n=e=>d(e);return window.addEventListener("fitViewToNodesInternal",e),window.addEventListener("autoFitCrewNodes",t),window.addEventListener("recalculateNodePositions",n),()=>{window.removeEventListener("fitViewToNodesInternal",e),window.removeEventListener("autoFitCrewNodes",t),window.removeEventListener("recalculateNodePositions",n)}},[r,l,d]),i.useEffect(()=>{let e=!1;const n=()=>{!e&&a.current&&t.length>0&&(e=!0,o())},s=()=>{setTimeout(n,200)};if(window.addEventListener("crewFlowInitialized",s),t.length>0&&a.current){const e=setTimeout(n,500);return()=>{clearTimeout(e),window.removeEventListener("crewFlowInitialized",s)}}return()=>{window.removeEventListener("crewFlowInitialized",s)}},[t.length,o,a]),{handleAutoFitCrewNodes:l,handleRecalculateNodePositions:d}}const fi=e=>{let{open:t,onClose:n,onAgentSelect:s,agents:h,onShowAgentForm:m,fetchAgents:p,showErrorMessage:g,openInCreateMode:f=!1}=e;const[v,A]=(0,i.useState)(!1),[y,b]=(0,i.useState)(f),[j,w]=(0,i.useState)([]),[k,C]=(0,i.useState)([]),[S,_]=(0,i.useState)(!1),[E,I]=(0,i.useState)(!1),T=(0,i.useCallback)(async()=>{try{const e=await gt.m.listTools();C(e.map(e=>(0,a.A)((0,a.A)({},e),{},{id:String(e.id)})))}catch(e){}},[]);(0,i.useEffect)(()=>{t&&!E&&(Promise.all([p(),T()]),I(!0),f&&b(!0))},[t,E,p,T,f]),(0,i.useEffect)(()=>{t||(I(!1),w([]),b(!1))},[t]);const N=async e=>{b(!1),await p(),f&&e&&(s([e]),n())};return f?(0,O.jsxs)(O.Fragment,{children:[(0,O.jsxs)(r.A,{open:t,onClose:n,maxWidth:"md",fullWidth:!0,children:[(0,O.jsxs)(d.A,{children:[(0,O.jsxs)(o.A,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",pr:5},children:[(0,O.jsx)(c.A,{variant:"h6",children:"Create Agent"}),(0,O.jsx)(x.A,{startIcon:(0,O.jsx)(xe.A,{}),onClick:()=>_(!0),variant:"outlined",size:"small",sx:{ml:2},children:"Best Practices"})]}),(0,O.jsx)(u.A,{"aria-label":"close",onClick:n,sx:{position:"absolute",right:8,top:8},children:(0,O.jsx)(D.A,{})})]}),(0,O.jsx)(l.A,{children:(0,O.jsx)(xt,{tools:k,onCancel:n,onAgentSaved:N,isCreateMode:!0})})]}),(0,O.jsx)(mt,{open:S,onClose:()=>_(!1)})]}):(0,O.jsxs)(O.Fragment,{children:[(0,O.jsxs)(r.A,{open:t,onClose:n,maxWidth:"sm",fullWidth:!0,children:[(0,O.jsxs)(d.A,{children:[(0,O.jsx)(o.A,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",pr:5},children:(0,O.jsxs)(o.A,{sx:{display:"flex",alignItems:"center",gap:1},children:["Manage Agents",(0,O.jsx)(P.A,{title:"Learn about agent best practices",children:(0,O.jsx)(u.A,{size:"small",onClick:()=>window.open("https://docs.crewai.com/core-concepts/Agents/","_blank"),sx:{ml:1},children:(0,O.jsx)(xe.A,{fontSize:"small"})})})]})}),(0,O.jsx)(u.A,{"aria-label":"close",onClick:n,sx:{position:"absolute",right:8,top:8},children:(0,O.jsx)(D.A,{})})]}),(0,O.jsxs)(l.A,{sx:{pb:1},children:[(0,O.jsxs)(o.A,{sx:{mb:2,display:"flex",gap:1},children:[(0,O.jsx)(x.A,{variant:"contained",startIcon:(0,O.jsx)(Qt.A,{}),onClick:()=>{b(!0)},children:"Create Agent"}),(0,O.jsx)(x.A,{variant:"outlined",onClick:()=>{j.length===h.length?w([]):w([...h])},children:j.length===h.length?"Deselect All":"Select All"}),(0,O.jsx)(x.A,{variant:"outlined",color:"error",startIcon:(0,O.jsx)(q.A,{}),onClick:async()=>{try{await fe.AgentService.deleteAllAgents(),w([]),await p()}catch(n){if(n&&"object"===typeof n&&"response"in n){var e;const a=n;if(409===(null===(e=a.response)||void 0===e?void 0:e.status))g(a.response.data.detail||"Cannot delete agents due to dependencies.","warning");else{var t;const e=(null===(t=a.response)||void 0===t||null===(t=t.data)||void 0===t?void 0:t.detail)||"An unknown error occurred";g("Error deleting agents: ".concat(e),"error")}}else g("An unknown error occurred while deleting agents.","error")}},children:"Delete All"})]}),(0,O.jsx)(te.A,{sx:{my:2}}),(0,O.jsx)(at.A,{sx:{maxHeight:"50vh",overflow:"auto"},children:h.map(e=>(0,O.jsxs)(ha.A,{onClick:()=>(e=>{w(t=>t.some(t=>t.id===e.id)?t.filter(t=>t.id!==e.id):[...t,e])})(e),selected:j.some(t=>t.id===e.id),children:[(0,O.jsx)(it.A,{children:(0,O.jsx)(J.A,{})}),(0,O.jsx)(ot.A,{primary:e.name,secondary:e.role}),(0,O.jsx)(P.A,{title:"Delete Agent",children:(0,O.jsx)(u.A,{onClick:t=>{t.stopPropagation(),(async e=>{if(e.id)try{A(!0),await fe.AgentService.deleteAgent(e.id)&&await p()}catch(t){}finally{A(!1)}})(e)},size:"small",color:"error",disabled:v,children:(0,O.jsx)(q.A,{fontSize:"small"})})})]},e.id))})]}),(0,O.jsx)(B.A,{sx:{px:3,py:2},children:(0,O.jsxs)(x.A,{variant:"contained",onClick:()=>{s(j),w([]),n()},disabled:0===j.length,children:["Place Selected (",j.length,")"]})})]}),y&&(0,O.jsx)(r.A,{open:y,onClose:()=>b(!1),maxWidth:"md",fullWidth:!0,children:(0,O.jsx)(l.A,{children:(0,O.jsx)(xt,{tools:k,onCancel:()=>b(!1),onAgentSaved:N})})})]})},vi=e=>{let{open:t,onClose:n,onTaskSelect:s,tasks:h,onShowTaskForm:m,fetchTasks:p,openInCreateMode:g=!1}=e;const[f,v]=(0,i.useState)(void 0),[A,y]=(0,i.useState)(g),[b,j]=(0,i.useState)([]),[w,k]=(0,i.useState)([]),[C,S]=(0,i.useState)(!1),[_,E]=(0,i.useState)(!1);(0,i.useEffect)(()=>{let e=!0;return(async()=>{try{if(t){const[t,n]=await Promise.all([p(),gt.m.listTools()]);e&&(k(n),g&&y(!0))}}catch(n){}})(),()=>{e=!1,t||y(!1)}},[t,p,g]);return g?(0,O.jsxs)(O.Fragment,{children:[(0,O.jsxs)(r.A,{open:t,onClose:n,maxWidth:"md",fullWidth:!0,children:[(0,O.jsxs)(d.A,{children:[(0,O.jsxs)(o.A,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",pr:5},children:[(0,O.jsx)(c.A,{variant:"h6",children:"Create Task"}),(0,O.jsx)(x.A,{startIcon:(0,O.jsx)(xe.A,{}),onClick:()=>E(!0),variant:"outlined",size:"small",sx:{ml:2},children:"Best Practices"})]}),(0,O.jsx)(u.A,{"aria-label":"close",onClick:n,sx:{position:"absolute",right:8,top:8},children:(0,O.jsx)(D.A,{})})]}),(0,O.jsx)(l.A,{children:(0,O.jsx)(Nt,{tools:w,onCancel:n,isCreateMode:!0,hideTitle:!0,onTaskSaved:async e=>{await p(),e&&(s([e]),n())}})})]}),(0,O.jsx)(Dt,{open:_,onClose:()=>E(!1)})]}):(0,O.jsxs)(O.Fragment,{children:[(0,O.jsxs)(r.A,{open:t,onClose:n,maxWidth:"md",fullWidth:!0,children:[(0,O.jsxs)(d.A,{children:["Manage Tasks",(0,O.jsx)(u.A,{"aria-label":"close",onClick:n,sx:{position:"absolute",right:8,top:8},children:(0,O.jsx)(D.A,{})})]}),(0,O.jsxs)(l.A,{children:[(0,O.jsxs)(o.A,{sx:{mb:2,display:"flex",gap:1},children:[(0,O.jsx)(x.A,{variant:"contained",startIcon:(0,O.jsx)(Qt.A,{}),onClick:()=>{v(void 0),j([]),y(!0)},children:"Create Task"}),(0,O.jsx)(x.A,{variant:"outlined",onClick:()=>{b.length===h.length?j([]):j([...h])},children:b.length===h.length?"Deselect All":"Select All"}),(0,O.jsx)(x.A,{variant:"outlined",color:"error",startIcon:(0,O.jsx)(q.A,{}),onClick:async()=>{try{await Re.deleteAllTasks(),j([]),await p()}catch(e){}},children:"Delete All"})]}),(0,O.jsx)(te.A,{sx:{my:2}}),(0,O.jsx)(at.A,{sx:{maxHeight:"50vh",overflow:"auto"},children:[...h].reverse().map(e=>(0,O.jsxs)(ha.A,{onClick:()=>(e=>{const t=b.some(t=>t.id===e.id)?b.filter(t=>t.id!==e.id):[...b,e];j(t)})(e),selected:b.some(t=>t.id===e.id),children:[(0,O.jsx)(it.A,{children:(0,O.jsx)(ua.A,{})}),(0,O.jsx)(ot.A,{primary:e.name||e.description,secondary:e.description}),(0,O.jsx)(P.A,{title:"Delete Task",children:(0,O.jsx)(u.A,{onClick:t=>{t.stopPropagation(),(async e=>{if(e.id)try{S(!0),await Re.deleteTask(e.id),await p()}catch(t){}finally{S(!1)}})(e)},size:"small",color:"error",disabled:C,children:(0,O.jsx)(q.A,{fontSize:"small"})})})]},e.id))})]}),(0,O.jsx)(B.A,{sx:{px:3,py:2},children:(0,O.jsxs)(x.A,{variant:"contained",onClick:()=>{const e=b.map(e=>(0,a.A)((0,a.A)({},e),{},{id:e.id,name:e.name,description:e.description,expected_output:e.expected_output,tools:e.tools,agent_id:e.agent_id,async_execution:e.async_execution,context:e.context,config:e.config}));s(e),n()},disabled:0===b.length,children:["Place Selected (",b.length,")"]})})]}),A&&(0,O.jsxs)(r.A,{open:A,onClose:()=>{y(!1),v(void 0)},maxWidth:"md",fullWidth:!0,PaperProps:{sx:{position:"relative"}},children:[(0,O.jsxs)(d.A,{children:[f?"Edit Task":"Create New Task",(0,O.jsx)(u.A,{"aria-label":"close",onClick:()=>{y(!1),v(void 0)},sx:{position:"absolute",right:8,top:8},children:(0,O.jsx)(D.A,{})})]}),(0,O.jsx)(l.A,{children:(0,O.jsx)(Nt,{initialData:f,onCancel:()=>{y(!1),v(void 0)},onTaskSaved:async e=>{await p(),b.some(t=>t.id===e.id)?j(t=>t.map(t=>t.id===e.id?e:t)):j(t=>[...t,e]),y(!1),v(void 0)},tools:w,hideTitle:!0},f?"edit":"create")})]})]})};var Ai=n(96557),yi=n(40038),bi=n(39919),ji=n(36060);const wi=e=>{let{open:t,onClose:n,schedule:a}=e;return a?(0,O.jsxs)(r.A,{open:t,onClose:n,maxWidth:"md",fullWidth:!0,children:[(0,O.jsxs)(d.A,{children:["Configuration for ",a.name]}),(0,O.jsx)(l.A,{children:(0,O.jsxs)(o.A,{sx:{mt:2},children:[(0,O.jsx)(c.A,{variant:"subtitle1",gutterBottom:!0,children:"Agents YAML"}),(0,O.jsx)(o.A,{sx:{whiteSpace:"pre-wrap",fontFamily:"monospace",bgcolor:"grey.100",p:2,borderRadius:1,maxHeight:"300px",overflow:"auto",mb:3},children:JSON.stringify(a.agents_yaml,null,2)}),(0,O.jsx)(c.A,{variant:"subtitle1",gutterBottom:!0,children:"Tasks YAML"}),(0,O.jsx)(o.A,{sx:{whiteSpace:"pre-wrap",fontFamily:"monospace",bgcolor:"grey.100",p:2,borderRadius:1,maxHeight:"300px",overflow:"auto",mb:3},children:JSON.stringify(a.tasks_yaml,null,2)}),a.inputs&&Object.keys(a.inputs).length>0&&(0,O.jsxs)(O.Fragment,{children:[(0,O.jsx)(c.A,{variant:"subtitle1",gutterBottom:!0,children:"Inputs"}),(0,O.jsx)(o.A,{sx:{whiteSpace:"pre-wrap",fontFamily:"monospace",bgcolor:"grey.100",p:2,borderRadius:1,maxHeight:"300px",overflow:"auto"},children:JSON.stringify(a.inputs,null,2)})]})]})}),(0,O.jsx)(B.A,{children:(0,O.jsx)(x.A,{onClick:n,children:"Close"})})]}):null},ki=e=>{let{open:t,onClose:n,nodes:s,edges:p,planningEnabled:g,selectedModel:f}=e;const[v,A]=(0,i.useState)([]),[y,b]=(0,i.useState)(""),[j,w]=(0,i.useState)(""),[k,C]=(0,i.useState)(!1),[S,_]=(0,i.useState)("visual"),[E,I]=(0,i.useState)("create"),[T,N]=(0,i.useState)(null),[M,z]=(0,i.useState)("list"),[L,F]=(0,i.useState)("daily"),[W,U]=(0,i.useState)({hour:"0",minute:"0"}),[H,K]=(0,i.useState)([]),[G,J]=(0,i.useState)([]),[X,Z]=(0,i.useState)([]),[Q,$]=(0,i.useState)(null),[ee,te]=(0,i.useState)(!1),[ne,ae]=(0,i.useState)({}),[se,ie]=(0,i.useState)(null),ue=(0,i.useCallback)(()=>{b(""),w(""),F("daily"),U({hour:"0",minute:"0"}),K([]),J([]),Z([]),_("visual"),I("create"),N(null),ae({}),z("list")},[]),pe=(0,i.useCallback)(async()=>{try{const e=await ji.l.listSchedules();A(e)}catch(se){os.oR.error("Failed to load schedules")}},[]);(0,i.useEffect)(()=>{t&&(pe(),T||ue())},[t,T,pe,ue]);const xe=e=>{I("edit"),N(e.id),b(e.name),w(e.cron_expression),ae(e.inputs||{}),(e=>{const t=e.split(" "),[n,a,s,i,o]=t;U({minute:"*"===n?"0":n,hour:"*"===a?"0":a}),"*"===a?F("hourly"):"*"===s&&"*"===i&&"*"===o?F("daily"):"*"===s&&"*"===i&&"*"!==o?(F("weekly"),K(o.split(","))):"*"!==s&&"*"===i?(F("monthly"),Z(s.split(","))):"*"!==i&&(F("yearly"),J(i.split(",")))})(e.cron_expression),z("edit")},ge=(0,i.useCallback)(()=>{const{hour:e,minute:t}=W;let n="";const a=H.length>0?H.join(","):"*",s=X.length>0?X.join(","):"*",i=G.length>0?G.join(","):"*";switch(L){case"hourly":n="".concat(t," * * * *");break;case"daily":n="".concat(t," ").concat(e," * * *");break;case"weekly":n="".concat(t," ").concat(e," * * ").concat(a);break;case"monthly":n="".concat(t," ").concat(e," ").concat(s," * *");break;case"yearly":n="".concat(t," ").concat(e," * ").concat(i," *");break;default:n="0 0 * * *"}w(n)},[L,W,H,G,X]);(0,i.useEffect)(()=>{"visual"===S&&ge()},[S,ge]);const fe=()=>{ie(null)};return(0,O.jsxs)(O.Fragment,{children:[(0,O.jsxs)(r.A,{open:t,onClose:n,maxWidth:"md",fullWidth:!0,children:[(0,O.jsxs)(d.A,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",pb:1.5,borderBottom:"1px solid",borderColor:"divider"},children:[(0,O.jsx)(c.A,{variant:"h6",children:"Schedules"}),(0,O.jsx)(u.A,{onClick:n,size:"small",sx:{color:"text.secondary","&:hover":{color:"text.primary"}},children:(0,O.jsx)(D.A,{})})]}),(0,O.jsx)(l.A,{children:"list"===M?(0,O.jsxs)(o.A,{children:[(0,O.jsx)(o.A,{sx:{mb:3,mt:2},children:(0,O.jsxs)(c.A,{variant:"subtitle1",sx:{fontWeight:600},children:["Active Schedules (",v.length,")"]})}),0===v.length?(0,O.jsxs)(o.A,{sx:{textAlign:"center",py:8,px:2,backgroundColor:"background.default",borderRadius:2,border:"1px dashed",borderColor:"divider"},children:[(0,O.jsx)(c.A,{variant:"h6",color:"text.secondary",gutterBottom:!0,children:"No schedules found"}),(0,O.jsx)(c.A,{variant:"body2",color:"text.secondary",children:"Schedule jobs from the Execution History table"})]}):(0,O.jsx)(at.A,{sx:{p:0},children:v.map(e=>(0,O.jsxs)(st.Ay,{sx:{mb:1.5,p:2,borderRadius:2,border:"1px solid",borderColor:"divider",backgroundColor:"background.paper","&:hover":{backgroundColor:"action.hover",borderColor:"primary.light"},transition:"all 0.2s ease"},children:[(0,O.jsx)(ot.A,{primary:(0,O.jsxs)(o.A,{sx:{display:"flex",alignItems:"center",gap:1},children:[(0,O.jsx)(c.A,{variant:"h6",sx:{fontWeight:500,fontSize:"1.1rem"},children:e.name}),(0,O.jsx)(R.A,{label:e.is_active?"Active":"Inactive",size:"small",color:e.is_active?"success":"default",sx:{height:22}})]}),secondary:(0,O.jsxs)(o.A,{sx:{mt:.5},children:[(0,O.jsx)(c.A,{component:"span",variant:"body2",color:"text.secondary",sx:{fontFamily:"monospace"},children:e.cron_expression}),e.next_run_at&&(0,O.jsxs)(c.A,{component:"span",variant:"body2",color:"text.secondary",sx:{ml:2},children:["\u2022 Next run: ",new Date(e.next_run_at+"Z").toLocaleString()]})]})}),(0,O.jsx)(ti.A,{children:(0,O.jsxs)(o.A,{sx:{display:"flex",alignItems:"center",gap:.5},children:[(0,O.jsx)(P.A,{title:"View Configuration",children:(0,O.jsx)(u.A,{size:"small",onClick:()=>(e=>{$(e),te(!0)})(e),children:(0,O.jsx)(Oe.A,{fontSize:"small"})})}),(0,O.jsx)(P.A,{title:"Toggle Schedule",children:(0,O.jsx)(me.A,{size:"small",checked:e.is_active,onChange:()=>(async e=>{try{await ji.l.toggleSchedule(e),pe()}catch(se){os.oR.error("Failed to toggle schedule")}})(e.id),sx:{"& .MuiSwitch-switchBase":{padding:"6px"},"& .MuiSwitch-thumb":{width:18,height:18}}})}),(0,O.jsx)(P.A,{title:"Edit Schedule",children:(0,O.jsx)(u.A,{size:"small",onClick:()=>xe(e),color:"primary",children:(0,O.jsx)(Y.A,{fontSize:"small"})})}),(0,O.jsx)(P.A,{title:"Delete Schedule",children:(0,O.jsx)(u.A,{size:"small",onClick:()=>(async e=>{try{await ji.l.deleteSchedule(e),os.oR.success("Schedule deleted successfully"),pe()}catch(se){os.oR.error("Failed to delete schedule")}})(e.id),color:"error",children:(0,O.jsx)(q.A,{fontSize:"small"})})})]})})]},e.id))})]}):(0,O.jsxs)(o.A,{children:[(0,O.jsxs)(o.A,{sx:{display:"flex",alignItems:"center",mb:3,mt:2},children:[(0,O.jsx)(u.A,{onClick:ue,size:"small",sx:{mr:1},children:(0,O.jsx)(D.A,{})}),(0,O.jsx)(c.A,{variant:"h6",children:"Edit Schedule"})]}),(0,O.jsx)(o.A,{sx:{mt:2,mb:2,p:2,bgcolor:"info.light",borderRadius:1},children:(0,O.jsx)(c.A,{variant:"body2",color:"info.dark",children:"Note: Only the schedule name and timing can be edited. To modify the workflow configuration, create a new schedule from the Execution History."})}),(0,O.jsx)(V.A,{fullWidth:!0,label:"Schedule Name",value:y,onChange:e=>b(e.target.value),margin:"normal",autoFocus:!0}),(0,O.jsxs)(o.A,{sx:{mb:2,mt:2},children:[(0,O.jsxs)(yi.A,{value:S,exclusive:!0,onChange:(e,t)=>t&&_(t),sx:{mb:2},children:[(0,O.jsx)(bi.A,{value:"visual",children:"Simple Schedule"}),(0,O.jsx)(bi.A,{value:"manual",children:"Advanced (Cron)"})]}),"manual"===S?(0,O.jsx)(V.A,{fullWidth:!0,label:"Cron Expression",value:j,onChange:e=>w(e.target.value),helperText:"Example: '0 0 * * *' for daily at midnight"}):(()=>{const e=Array.from({length:24},(e,t)=>t.toString()),t=Array.from({length:60},(e,t)=>t.toString()),n=Array.from({length:31},(e,t)=>(t+1).toString());return(0,O.jsxs)(o.A,{sx:{mt:2},children:[(0,O.jsxs)(oe.A,{fullWidth:!0,sx:{mb:2},children:[(0,O.jsx)(re.A,{children:"Frequency"}),(0,O.jsxs)(le.A,{value:L,onChange:e=>F(e.target.value),label:"Frequency",children:[(0,O.jsx)(de.A,{value:"hourly",children:"Hourly"}),(0,O.jsx)(de.A,{value:"daily",children:"Daily"}),(0,O.jsx)(de.A,{value:"weekly",children:"Weekly"}),(0,O.jsx)(de.A,{value:"monthly",children:"Monthly"}),(0,O.jsx)(de.A,{value:"yearly",children:"Yearly"})]})]}),(0,O.jsxs)(ce.Ay,{container:!0,spacing:2,sx:{mb:2},children:[(0,O.jsx)(ce.Ay,{item:!0,xs:6,children:(0,O.jsxs)(oe.A,{fullWidth:!0,children:[(0,O.jsx)(re.A,{children:"Hour"}),(0,O.jsx)(le.A,{value:W.hour,onChange:e=>U(t=>(0,a.A)((0,a.A)({},t),{},{hour:e.target.value})),label:"Hour",disabled:"hourly"===L,children:e.map(e=>(0,O.jsx)(de.A,{value:e,children:e.padStart(2,"0")},e))})]})}),(0,O.jsx)(ce.Ay,{item:!0,xs:6,children:(0,O.jsxs)(oe.A,{fullWidth:!0,children:[(0,O.jsx)(re.A,{children:"Minute"}),(0,O.jsx)(le.A,{value:W.minute,onChange:e=>U(t=>(0,a.A)((0,a.A)({},t),{},{minute:e.target.value})),label:"Minute",children:t.map(e=>(0,O.jsx)(de.A,{value:e,children:e.padStart(2,"0")},e))})]})})]}),"weekly"===L&&(0,O.jsxs)(oe.A,{component:"fieldset",fullWidth:!0,sx:{mb:2},children:[(0,O.jsx)(c.A,{variant:"subtitle2",gutterBottom:!0,children:"Select Days"}),(0,O.jsx)(Ai.A,{row:!0,children:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"].map((e,t)=>(0,O.jsx)(he.A,{control:(0,O.jsx)(Ht.A,{checked:H.includes(t.toString()),onChange:e=>{e.target.checked?K([...H,t.toString()]):K(H.filter(e=>e!==t.toString()))}}),label:e},e))})]}),"monthly"===L&&(0,O.jsxs)(oe.A,{component:"fieldset",fullWidth:!0,sx:{mb:2},children:[(0,O.jsx)(c.A,{variant:"subtitle2",gutterBottom:!0,children:"Select Days of Month"}),(0,O.jsx)(Ai.A,{row:!0,children:n.map(e=>(0,O.jsx)(he.A,{control:(0,O.jsx)(Ht.A,{checked:X.includes(e),onChange:t=>{t.target.checked?Z([...X,e]):Z(X.filter(t=>t!==e))}}),label:e,sx:{width:"70px"}},e))})]}),"yearly"===L&&(0,O.jsxs)(oe.A,{component:"fieldset",fullWidth:!0,sx:{mb:2},children:[(0,O.jsx)(c.A,{variant:"subtitle2",gutterBottom:!0,children:"Select Months"}),(0,O.jsx)(Ai.A,{row:!0,children:["January","February","March","April","May","June","July","August","September","October","November","December"].map((e,t)=>(0,O.jsx)(he.A,{control:(0,O.jsx)(Ht.A,{checked:G.includes((t+1).toString()),onChange:e=>{e.target.checked?J([...G,(t+1).toString()]):J(G.filter(e=>e!==(t+1).toString()))}}),label:e},e))})]})]})})()]}),"visual"===S&&(0,O.jsx)(o.A,{sx:{mt:2,p:2,bgcolor:"grey.50",borderRadius:1},children:(0,O.jsxs)(c.A,{variant:"body2",color:"text.secondary",children:[(0,O.jsx)("strong",{children:"Generated Cron Expression:"})," ",j]})}),(0,O.jsxs)(o.A,{sx:{mt:3,display:"flex",gap:2},children:[(0,O.jsx)(x.A,{variant:"contained",onClick:async()=>{if(y&&j)try{if(C(!0),"edit"===E&&T){const e=v.find(e=>e.id===T);if(!e)return void os.oR.error("Schedule not found");const t={name:y,cron_expression:j,agents_yaml:e.agents_yaml,tasks_yaml:e.tasks_yaml,inputs:e.inputs,is_active:e.is_active,planning:e.planning,model:e.model};await ji.l.updateSchedule(T,t)}ue(),pe()}catch(se){ie("Failed to save schedule")}finally{C(!1)}else ie("Please fill in all required fields")},disabled:k||!y||!j,children:"Update Schedule"}),(0,O.jsx)(x.A,{variant:"outlined",onClick:ue,children:"Cancel"})]})]})}),(0,O.jsx)(B.A,{children:(0,O.jsx)(x.A,{onClick:n,children:"Close"})})]}),(0,O.jsx)(wi,{open:ee,onClose:()=>{te(!1),$(null)},schedule:Q}),(0,O.jsx)(h.A,{open:!!se,autoHideDuration:6e3,onClose:fe,anchorOrigin:{vertical:"top",horizontal:"center"},children:(0,O.jsx)(m.A,{onClose:fe,severity:"error",variant:"filled",sx:{width:"100%",whiteSpace:"pre-line"},children:se})})]})};var Ci=n(69893);const Si=e=>{let{executionHistoryHeight:t=200,onExecutionCountChange:n}=e;const a=(0,i.useRef)(null);return(0,O.jsx)(_e.A,{sx:{height:"100%",display:"flex",flexDirection:"column"},children:(0,O.jsx)(o.A,{sx:{flex:1,overflow:"hidden"},children:(0,O.jsx)(Ci.default,{ref:a,executionHistoryHeight:t,onExecutionCountChange:n})})})};var _i=n(52028),Ei=n(6163);const Ii="finished",Ti="skipped",Di=e=>({options:{primaryColor:"#1976d2",textColor:e?"#fff":"#333",backgroundColor:e?"#1e1e1e":"#fff",overlayColor:"rgba(0, 0, 0, 0.5)",spotlightShadow:"0 0 15px rgba(25, 118, 210, 0.5)",beaconSize:36,arrowColor:e?"#1e1e1e":"#fff",zIndex:1e4},tooltip:{borderRadius:8,fontSize:14},tooltipContainer:{textAlign:"left"},tooltipTitle:{fontSize:18,marginBottom:8,fontWeight:"bold"},tooltipContent:{fontSize:14,lineHeight:1.6},buttonNext:{backgroundColor:"#1976d2",borderRadius:4,color:"#fff",fontSize:14,padding:"8px 16px"},buttonBack:{color:e?"#90caf9":"#1976d2",fontSize:14,marginRight:8},buttonSkip:{color:e?"#999":"#666",fontSize:13},beacon:{animation:"pulse 2s infinite"},spotlight:{borderRadius:8}}),Ni=e=>{let{isOpen:t,onClose:n}=e;const a="dark"===(0,An.A)().palette.mode,{userRole:s}=(0,Pn.o)(),{setHasSeenTutorial:h}=(0,g.Y)(),[m,p]=(0,i.useState)(!1),[f,v]=(0,i.useState)(null),[A,y]=(0,i.useState)(!1),[b,j]=(0,i.useState)(!1),w=[{id:"editor",title:"Content Creator Tutorial",icon:(0,O.jsx)(Za.A,{}),color:"#2196f3",description:"Build AI content workflows + jumpstart with Catalog",features:["Create agents & tasks","Build workflows","Browse catalog templates","Execute & save templates"]}],k=e=>{v(e),y(!1),j(!1),setTimeout(()=>{p(!0)},300)},C=(0,i.useMemo)(()=>[{target:'[data-tour="workflow-designer"]',content:"Welcome Editor! This tutorial will teach you how to create AI agents and tasks, then execute them. You have two ways to build workflows: using the chat panel (AI-assisted) or the right sidebar (manual control).",placement:"center",disableBeacon:!0},{target:'[data-tour="chat-toggle"]',content:'Chat Panel - The Easy Way: This is your AI assistant for creating workflows. Use these commands:\n\u2022 "create agent: [name]" - Creates an AI agent\n\u2022 "create task: [description]" - Creates a task\n\u2022 "create plan" - Generates a complete workflow\n\u2022 "execute crew" or "ec" - Runs your workflow',placement:"left"},{target:'[data-tour="chat-panel"]',content:"Important Rule: Every agent MUST have at least one task assigned to it, otherwise the execution will fail. Think of it as: agents are workers, tasks are their assignments. No assignments = no work!",placement:"left"},{target:'[data-tour="right-sidebar"]',content:"Right Sidebar - Manual Control: If you prefer full control, use the right sidebar to:\n\u2022 Add agents manually\n\u2022 Add tasks manually\n\u2022 Configure each component in detail\n\u2022 Set up connections precisely",placement:"left"},{target:'[data-tour="canvas-area"]',content:"Canvas Area: This is where your workflow appears. Add agents via the Chat panel (AI-assisted) or manually in the Right Sidebar. You can also import existing Plans, Agents, and Tasks from the Catalog. Drag to connect agents to tasks and double-click items to edit.",placement:"center"},{target:'[data-nodetype="agent"]',content:"Agents: These are your AI workers. Each agent needs:\n\u2022 A role (what they are)\n\u2022 A goal (what they achieve)\n\u2022 Tools (what they can use)\n\u2022 At least ONE task (critical!)",placement:"auto"},{target:'[data-nodetype="task"]',content:"Tasks: These define the work. Each task needs:\n\u2022 A clear description\n\u2022 Expected output\n\u2022 An assigned agent\nRemember: Unassigned tasks will cause execution to fail!",placement:"auto"},{target:'[data-tour="execute-button"]',content:'Execute Button: Once all agents have tasks, click here OR type "execute crew" in chat. The execution will fail if any agent lacks a task!',placement:"bottom"},{target:'[data-tour="open-workflow"]',content:"Catalog: Click here to browse and import existing Plans, Agents, and Tasks you can customize.",placement:"bottom"},{target:'[data-tour="catalog-dialog"]',content:"Catalog Browser: Search and filter, then import Plans, Agents, or Tasks. Imported items will appear on the canvas, ready to connect and run.",placement:"center"},{target:'[data-tour="canvas-area"]',content:"Imported Template: The selected template appears here. Tweak agents and tasks, then run.",placement:"center"},{target:'[data-tour="save-button"]',content:"Save Workflow: Once your workflow runs successfully, save it as a template for reuse. Give it a clear name and description.",placement:"bottom"}],[]),S=(0,i.useMemo)(()=>C,[C]);(0,i.useEffect)(()=>{t?A?j(!0):setTimeout(()=>{p(!0)},500):(j(!1),p(!1))},[t,s,S.length,A]);return t?(0,O.jsxs)(O.Fragment,{children:[(0,O.jsxs)(r.A,{open:b,onClose:()=>{j(!1),n()},maxWidth:"md",fullWidth:!0,PaperProps:{sx:{borderRadius:3,background:a?"linear-gradient(135deg, #1e1e1e 0%, #2d2d2d 100%)":"linear-gradient(135deg, #ffffff 0%, #f5f5f5 100%)"}},children:[(0,O.jsxs)(d.A,{sx:{display:"flex",alignItems:"center",gap:2,borderBottom:1,borderColor:"divider",pb:2},children:[(0,O.jsx)(ns.A,{sx:{bgcolor:"primary.main",width:48,height:48},children:(0,O.jsx)(Ei.A,{})}),(0,O.jsxs)(o.A,{flex:1,children:[(0,O.jsx)(c.A,{variant:"h5",fontWeight:"bold",children:"Choose Your Learning Path"}),(0,O.jsx)(c.A,{variant:"body2",color:"text.secondary",children:"Select the tutorial that matches your role and learning goals"})]}),(0,O.jsx)(u.A,{onClick:()=>{j(!1),n()},sx:{alignSelf:"flex-start"},children:(0,O.jsx)(U.A,{})})]}),(0,O.jsxs)(l.A,{sx:{p:3},children:[(0,O.jsx)(hs.A,{spacing:3,children:w.map(e=>(0,O.jsx)(Us.A,{in:!0,timeout:500,children:(0,O.jsx)(ee.A,{sx:{cursor:"pointer",transition:"all 0.3s ease",border:2,borderColor:f===e.id?e.color:"transparent","&:hover":{transform:"translateY(-4px)",boxShadow:6,borderColor:e.color}},onClick:()=>k(e.id),children:(0,O.jsx)(Xt.A,{sx:{p:3},children:(0,O.jsxs)(hs.A,{direction:"row",spacing:3,alignItems:"center",children:[(0,O.jsx)(ns.A,{sx:{bgcolor:"".concat(e.color,"20"),color:e.color,width:64,height:64},children:e.icon}),(0,O.jsxs)(o.A,{flex:1,children:[(0,O.jsxs)(hs.A,{direction:"row",alignItems:"center",gap:2,mb:1,children:[(0,O.jsx)(c.A,{variant:"h6",fontWeight:"bold",children:e.title}),s===e.id&&(0,O.jsx)(R.A,{label:"Your Role",size:"small",color:"primary",variant:"filled"})]}),(0,O.jsx)(c.A,{variant:"body2",color:"text.secondary",mb:2,children:e.description}),(0,O.jsx)(hs.A,{direction:"row",flexWrap:"wrap",gap:1,children:e.features.map((t,n)=>(0,O.jsx)(R.A,{label:t,size:"small",variant:"outlined",sx:{borderColor:"".concat(e.color,"40"),color:e.color,fontSize:"0.75rem"}},n))})]}),(0,O.jsx)(x.A,{variant:"contained",size:"large",sx:{bgcolor:e.color,minWidth:120,"&:hover":{bgcolor:e.color,filter:"brightness(0.9)"}},onClick:t=>{t.stopPropagation(),k(e.id)},children:"Start"})]})})})},e.id))}),(0,O.jsx)(o.A,{mt:3,p:2,bgcolor:"action.hover",borderRadius:2,children:(0,O.jsxs)(c.A,{variant:"body2",color:"text.secondary",align:"center",children:[(0,O.jsx)("strong",{children:"Tip:"})," You can restart the tutorial anytime by clicking the help button in the sidebar"]})})]})]}),!b&&(0,O.jsx)(_i.Ay,{steps:S,run:m,continuous:!0,showProgress:!0,showSkipButton:!0,styles:Di(a),callback:e=>{const{status:t,action:a}=e;t!==Ii&&t!==Ti||(p(!1),h(!0),v(null),y(!0),n()),"prev"===a&&0===e.index&&f&&(y(!0),v(null))},disableCloseOnEsc:!1,disableOverlayClose:!1,hideCloseButton:!1})]}):null};var Pi=n(1320),Mi=n(15769),zi=n(69780),Oi=n(9213),Li=n(21671),Fi=n(34075),Wi=n(88688),Ri=n(62462);const Vi=function(){const{secrets:e,loading:t,error:n,updateSecrets:s}=(()=>{const{secrets:e,loading:t,error:n,fetchAPIKeys:a,updateSecrets:s}=Be();return(0,i.useEffect)(()=>{a()},[a]),{secrets:e,loading:t,error:n,updateSecrets:e=>{s(e)}}})(),{editDialogOpen:p,providerToEdit:g,closeApiKeyEditor:f}=Be(),[v,A]=(0,i.useState)(!1),[y,b]=(0,i.useState)(null),[j,w]=(0,i.useState)({open:!1,message:"",severity:"success"}),[k,C]=(0,i.useState)(!1),[S,_]=(0,i.useState)({name:"",value:"",description:""}),[E,I]=(0,i.useState)(0),T=["OPENAI_API_KEY","DATABRICKS_API_KEY","ANTHROPIC_API_KEY","QWEN_API_KEY","DEEPSEEK_API_KEY","GROK_API_KEY","GEMINI_API_KEY"],D=(0,i.useMemo)(()=>({openai:"OPENAI_API_KEY",anthropic:"ANTHROPIC_API_KEY",databricks:"DATABRICKS_API_KEY",qwen:"QWEN_API_KEY",deepseek:"DEEPSEEK_API_KEY",grok:"GROK_API_KEY",gemini:"GEMINI_API_KEY"}),[]);(0,i.useEffect)(()=>{if(p&&g&&!t&&e.length>0){const t=D[g.toLowerCase()];if(t){const n=e.find(e=>e.name===t);n&&(b(n),A(!0),I(0),f())}}},[p,g,e,t,f,D]);const N=(0,i.useCallback)(function(e){w({open:!0,message:e,severity:arguments.length>1&&void 0!==arguments[1]?arguments[1]:"success"})},[]),M=(0,i.useCallback)(async()=>{try{const e=Fe.getInstance(),t=await e.getAPIKeys();s(t)}catch(n){N(n instanceof Error?n.message:"Error fetching API keys","error")}},[N,s]),z=e.filter(e=>!T.includes(e.name));if(t)return(0,O.jsx)(o.A,{sx:{display:"flex",justifyContent:"center",p:3},children:(0,O.jsx)(ue.A,{})});if(n)return(0,O.jsx)(ee.A,{sx:{mt:8},children:(0,O.jsxs)(Xt.A,{children:[(0,O.jsxs)(o.A,{sx:{display:"flex",alignItems:"center",mb:3},children:[(0,O.jsx)(Wi.A,{sx:{mr:1,color:"error.main"}}),(0,O.jsx)(c.A,{variant:"h5",children:"API Keys & Secrets"})]}),(0,O.jsx)(m.A,{severity:"error",sx:{mb:2},children:n})]})});const L=e=>{if(e.id<0)return _({name:e.name,value:"",description:e.description||""}),void C(!0);const t=(0,a.A)((0,a.A)({},e),{},{value:"",maskedValue:"Set"===e.value?"\u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022 (hidden for security)":"Not configured"});b(t),A(!0)},F=e=>{const t="Set"===e,n="Not set"===e||!e||""===e.trim();return t?(0,O.jsxs)(o.A,{sx:{display:"flex",alignItems:"center",gap:1},children:[(0,O.jsx)(rt.A,{sx:{color:"success.main",fontSize:20}}),(0,O.jsxs)(o.A,{sx:{display:"flex",alignItems:"center",gap:.5},children:[(0,O.jsx)(Ri.A,{sx:{color:"text.secondary",fontSize:16}}),(0,O.jsx)(c.A,{variant:"body2",sx:{color:"text.secondary",fontStyle:"italic"},children:"Hidden"})]})]}):n?(0,O.jsxs)(o.A,{sx:{display:"flex",alignItems:"center",gap:1},children:[(0,O.jsx)(bt.A,{sx:{color:"warning.main",fontSize:20}}),(0,O.jsx)(c.A,{variant:"body2",sx:{color:"text.secondary"},children:"Not configured"})]}):(0,O.jsxs)(o.A,{sx:{display:"flex",alignItems:"center",gap:1},children:[(0,O.jsx)(rt.A,{sx:{color:"success.main",fontSize:20}}),(0,O.jsx)(c.A,{variant:"body2",sx:{color:"text.secondary"},children:"Configured"})]})},W=e=>(0,O.jsx)(Pi.A,{component:_e.A,sx:{mt:2},children:(0,O.jsxs)(Mi.A,{children:[(0,O.jsx)(zi.A,{children:(0,O.jsxs)(Oi.A,{children:[(0,O.jsx)(Li.A,{children:"Key Name"}),(0,O.jsx)(Li.A,{children:"Value"}),(0,O.jsx)(Li.A,{children:"Description"}),(0,O.jsx)(Li.A,{children:"Actions"})]})}),(0,O.jsx)(Fi.A,{children:0===e.length?(0,O.jsx)(Oi.A,{children:(0,O.jsx)(Li.A,{colSpan:4,align:"center",children:"No API keys found"})}):e.map(e=>(0,O.jsxs)(Oi.A,{children:[(0,O.jsx)(Li.A,{children:e.name}),(0,O.jsx)(Li.A,{children:F(e.value)}),(0,O.jsx)(Li.A,{children:e.description}),(0,O.jsx)(Li.A,{children:(0,O.jsxs)(o.A,{sx:{display:"flex",gap:1},children:[(0,O.jsx)(P.A,{title:"Edit",children:(0,O.jsx)(u.A,{onClick:()=>L(e),children:(0,O.jsx)(Y.A,{})})}),e.id>=0&&(0,O.jsx)(P.A,{title:"Delete",children:(0,O.jsx)(u.A,{onClick:()=>(async e=>{if(window.confirm('Are you sure you want to delete the key "'.concat(e,'"?')))try{const t=Fe.getInstance(),n=await t.deleteAPIKey(e);await M(),N(n.message)}catch(n){N(n instanceof Error?n.message:"Error deleting API key","error")}})(e.name),color:"error",children:(0,O.jsx)(q.A,{})})})]})})]},e.id))})]})});return(0,O.jsx)(ee.A,{sx:{mt:8},children:(0,O.jsxs)(Xt.A,{children:[(0,O.jsxs)(o.A,{sx:{display:"flex",alignItems:"center",mb:3},children:[(0,O.jsx)(Wi.A,{sx:{mr:1}}),(0,O.jsx)(c.A,{variant:"h5",children:"API Keys & Secrets"})]}),(0,O.jsxs)(ea.A,{value:E,onChange:(e,t)=>{I(t)},sx:{mb:2},children:[(0,O.jsx)(ta.A,{label:"Model API Keys"}),(0,O.jsx)(ta.A,{label:"Local Keystore"})]}),0===E&&(0,O.jsxs)(O.Fragment,{children:[(0,O.jsxs)(o.A,{sx:{display:"flex",alignItems:"center",mb:2},children:[(0,O.jsx)(Wi.A,{sx:{mr:1}}),(0,O.jsx)(c.A,{variant:"subtitle1",children:"Model API Keys"})]}),(0,O.jsx)(Pi.A,{component:_e.A,children:(0,O.jsxs)(Mi.A,{children:[(0,O.jsx)(zi.A,{children:(0,O.jsxs)(Oi.A,{children:[(0,O.jsx)(Li.A,{children:"Key Name"}),(0,O.jsx)(Li.A,{children:"Value"}),(0,O.jsx)(Li.A,{children:"Description"}),(0,O.jsx)(Li.A,{children:"Actions"})]})}),(0,O.jsx)(Fi.A,{children:T.map(t=>{const n=e.find(e=>e.name===t);return(0,O.jsxs)(Oi.A,{children:[(0,O.jsx)(Li.A,{children:t}),(0,O.jsx)(Li.A,{children:n?F(n.value):(0,O.jsxs)(o.A,{sx:{display:"flex",alignItems:"center",gap:1},children:[(0,O.jsx)(bt.A,{sx:{color:"warning.main",fontSize:20}}),(0,O.jsx)(c.A,{variant:"body2",sx:{color:"text.secondary"},children:"Not configured"})]})}),(0,O.jsx)(Li.A,{children:(null===n||void 0===n?void 0:n.description)||""}),(0,O.jsx)(Li.A,{children:(0,O.jsx)(P.A,{title:n?"Edit":"Set Key",children:(0,O.jsx)(u.A,{onClick:()=>{n?L(n):(_({name:t,value:"",description:"API Key for ".concat(t)}),C(!0))},children:(0,O.jsx)(Y.A,{})})})})]},t)})})]})})]}),1===E&&(0,O.jsxs)(O.Fragment,{children:[(0,O.jsx)(o.A,{sx:{display:"flex",justifyContent:"flex-end",mb:2},children:(0,O.jsx)(x.A,{variant:"contained",startIcon:(0,O.jsx)(Qt.A,{}),onClick:()=>{_({name:"",value:"",description:""}),C(!0)},children:"Add New Key"})}),(()=>{const e=z.map(e=>e.name),t=["SERPER_API_KEY","PERPLEXITY_API_KEY"].filter(t=>!e.includes(t)).map((e,t)=>({id:-1e3-t,name:e,value:"Not set",description:"API Key for ".concat(e.replace(/_/g," ").toLowerCase()),created_at:"",updated_at:""})),n=[...z,...t];return W(n)})()]}),(0,O.jsxs)(r.A,{open:k,onClose:()=>C(!1),maxWidth:"sm",fullWidth:!0,children:[(0,O.jsx)(d.A,{children:T.includes(S.name)?"Set Model API Key":"Create New API Key"}),(0,O.jsx)(l.A,{children:(0,O.jsxs)(o.A,{sx:{mt:2,display:"flex",flexDirection:"column",gap:2},children:[(0,O.jsx)(V.A,{label:"Name",value:S.name,onChange:e=>_((0,a.A)((0,a.A)({},S),{},{name:e.target.value})),disabled:T.includes(S.name),fullWidth:!0}),(0,O.jsx)(V.A,{label:"Value",value:S.value,onChange:e=>_((0,a.A)((0,a.A)({},S),{},{value:e.target.value})),fullWidth:!0}),(0,O.jsx)(V.A,{label:"Description",value:S.description,onChange:e=>_((0,a.A)((0,a.A)({},S),{},{description:e.target.value})),fullWidth:!0,multiline:!0,rows:2})]})}),(0,O.jsxs)(B.A,{children:[(0,O.jsx)(x.A,{onClick:()=>C(!1),children:"Cancel"}),(0,O.jsx)(x.A,{onClick:async()=>{try{if(!S.name||!S.value)return void N("Name and value are required","error");const e=Fe.getInstance(),t=await e.createAPIKey({name:S.name.trim(),value:S.value,description:S.description||""});C(!1),_({name:"",value:"",description:""}),await M(),N(t.message)}catch(n){N(n instanceof Error?n.message:"Error creating API key","error")}},variant:"contained",children:T.includes(S.name)?"Set Key":"Create"})]})]}),(0,O.jsxs)(r.A,{open:v,onClose:()=>A(!1),children:[(0,O.jsx)(d.A,{children:"Edit API Key"}),(0,O.jsx)(l.A,{children:(0,O.jsxs)(o.A,{sx:{pt:2,display:"flex",flexDirection:"column",gap:2},children:[(0,O.jsx)(V.A,{label:"Name",value:(null===y||void 0===y?void 0:y.name)||"",disabled:!0,fullWidth:!0}),(0,O.jsx)(V.A,{label:"Value",placeholder:null!==y&&void 0!==y&&y.maskedValue?"Current: ".concat(null===y||void 0===y?void 0:y.maskedValue):"Enter new value",value:(null===y||void 0===y?void 0:y.value)||"",onChange:e=>{y&&b((0,a.A)((0,a.A)({},y),{},{value:e.target.value}))},fullWidth:!0,required:!0,helperText:"Current value is masked for security. Enter a new value to update."}),(0,O.jsx)(V.A,{label:"Description",value:(null===y||void 0===y?void 0:y.description)||"",onChange:e=>{y&&b((0,a.A)((0,a.A)({},y),{},{description:e.target.value}))},fullWidth:!0})]})}),(0,O.jsxs)(B.A,{children:[(0,O.jsx)(x.A,{onClick:()=>A(!1),children:"Cancel"}),(0,O.jsx)(x.A,{onClick:async()=>{try{const e=Fe.getInstance();if(y){if(!y.value)return void N("Value is required","error");const t={value:y.value,description:y.description||""},n=await e.updateAPIKey(y.name,t);await M(),N(n.message)}A(!1)}catch(n){N(n instanceof Error?n.message:"Error updating key/secret","error")}},variant:"contained",children:"Save"})]})]}),(0,O.jsx)(h.A,{open:j.open,autoHideDuration:6e3,onClose:()=>w(e=>(0,a.A)((0,a.A)({},e),{},{open:!1})),anchorOrigin:{vertical:"bottom",horizontal:"center"},children:(0,O.jsx)(m.A,{onClose:()=>w(e=>(0,a.A)((0,a.A)({},e),{},{open:!1})),severity:j.severity,sx:{width:"100%"},children:j.message})})]})})};var Bi=n(33738),Ui=n(91434),Hi=n(47644);const Ki=new class{constructor(){this.apiUrl=void 0,this.apiUrl=ye.$W.apiUrl}async getLLMLogs(e){const{page:t,per_page:n,endpoint:s}=e;return(await ye.Ay.get("/llm-logs",{params:(0,a.A)({page:t,per_page:n},"all"!==s&&{endpoint:s})})).data}},Gi=e=>{let{log:t}=e;const[n,a]=(0,i.useState)(!1),{t:s}=(0,y.Bd)();return(0,O.jsxs)(O.Fragment,{children:[(0,O.jsxs)(Oi.A,{sx:{"& > *":{borderBottom:"unset"}},children:[(0,O.jsx)(Li.A,{padding:"checkbox",children:(0,O.jsx)(u.A,{"aria-label":"expand row",size:"small",onClick:()=>a(!n),children:n?(0,O.jsx)(Hi.A,{}):(0,O.jsx)(fs.A,{})})}),(0,O.jsx)(Li.A,{children:(d=t.created_at,new Date(d).toLocaleString())}),(0,O.jsx)(Li.A,{children:t.endpoint}),(0,O.jsx)(Li.A,{children:t.model}),(0,O.jsx)(Li.A,{align:"right",children:(l=t.tokens_used,l?l.toLocaleString():"N/A")}),(0,O.jsx)(Li.A,{align:"right",children:(r=t.duration_ms,"".concat((r/1e3).toFixed(2),"s"))}),(0,O.jsx)(Li.A,{children:(0,O.jsx)(R.A,{label:t.status,color:"success"===t.status?"success":"error",size:"small",variant:"outlined"})})]}),(0,O.jsx)(Oi.A,{children:(0,O.jsx)(Li.A,{style:{paddingBottom:0,paddingTop:0},colSpan:7,children:(0,O.jsx)(Bi.A,{in:n,timeout:"auto",unmountOnExit:!0,children:(0,O.jsxs)(o.A,{sx:{margin:2},children:[(0,O.jsx)(c.A,{variant:"h6",gutterBottom:!0,component:"div",color:"primary",children:s("logs.details.title")}),(0,O.jsx)(c.A,{variant:"subtitle2",gutterBottom:!0,children:s("logs.details.prompt")}),(0,O.jsx)(_e.A,{sx:{p:2,mb:2,bgcolor:"#f5f5f5",maxHeight:"200px",overflow:"auto"},children:(0,O.jsx)("pre",{style:{margin:0,whiteSpace:"pre-wrap",fontSize:"0.875rem"},children:t.prompt})}),(0,O.jsx)(c.A,{variant:"subtitle2",gutterBottom:!0,children:s("logs.details.response")}),(0,O.jsx)(_e.A,{sx:{p:2,mb:2,bgcolor:"#f5f5f5",maxHeight:"400px",overflow:"auto"},children:(0,O.jsx)("pre",{style:{margin:0,whiteSpace:"pre-wrap",fontSize:"0.875rem"},children:t.response})}),t.extra_data&&(0,O.jsxs)(O.Fragment,{children:[(0,O.jsx)(c.A,{variant:"subtitle2",gutterBottom:!0,children:s("logs.details.additionalData")}),(0,O.jsx)(_e.A,{sx:{p:2,bgcolor:"#f5f5f5",maxHeight:"200px",overflow:"auto"},children:(0,O.jsx)("pre",{style:{margin:0,whiteSpace:"pre-wrap",fontSize:"0.875rem"},children:JSON.stringify(t.extra_data,null,2)})})]}),t.error_message&&(0,O.jsxs)(O.Fragment,{children:[(0,O.jsx)(c.A,{variant:"subtitle2",gutterBottom:!0,color:"error",children:s("logs.details.error")}),(0,O.jsx)(_e.A,{sx:{p:2,bgcolor:"#fff3f3",maxHeight:"200px",overflow:"auto"},children:(0,O.jsx)("pre",{style:{margin:0,whiteSpace:"pre-wrap",color:"#d32f2f",fontSize:"0.875rem"},children:t.error_message})})]})]})})})})]});var r,l,d},Ji=()=>{const[e,t]=(0,i.useState)([]),[n,a]=(0,i.useState)(!0),[s,r]=(0,i.useState)(0),[l,d]=(0,i.useState)(10),[u,h]=(0,i.useState)("all"),{t:m}=(0,y.Bd)(),p=(0,i.useCallback)(async()=>{try{a(!0);const e=await Ki.getLLMLogs({page:s,per_page:l,endpoint:"all"!==u?u:void 0});t(e)}catch(e){}finally{a(!1)}},[s,l,u]);(0,i.useEffect)(()=>{p();const e=setInterval(p,3e4);return()=>clearInterval(e)},[p]);return n?(0,O.jsx)(o.A,{sx:{display:"flex",justifyContent:"center",p:3},children:(0,O.jsx)(ue.A,{})}):(0,O.jsx)(ee.A,{sx:{mt:8},children:(0,O.jsxs)(Xt.A,{children:[(0,O.jsxs)(o.A,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:3},children:[(0,O.jsx)(c.A,{variant:"h5",children:m("logs.title")}),(0,O.jsxs)(oe.A,{sx:{minWidth:200},children:[(0,O.jsx)(re.A,{children:m("logs.filterByEndpoint")}),(0,O.jsxs)(le.A,{value:u,onChange:e=>{h(e.target.value),r(0)},label:m("logs.filterByEndpoint"),children:[(0,O.jsx)(de.A,{value:"all",children:m("logs.allEndpoints")}),(0,O.jsx)(de.A,{value:"generate-crew",children:"Generate Crew"}),(0,O.jsx)(de.A,{value:"generate-task",children:"Generate Task"}),(0,O.jsx)(de.A,{value:"generate-agent",children:"Generate Agent"})]})]})]}),(0,O.jsx)(Pi.A,{component:_e.A,sx:{maxHeight:"calc(100vh - 250px)",overflow:"auto"},children:(0,O.jsxs)(Mi.A,{stickyHeader:!0,children:[(0,O.jsx)(zi.A,{children:(0,O.jsxs)(Oi.A,{children:[(0,O.jsx)(Li.A,{padding:"checkbox"}),(0,O.jsx)(Li.A,{children:m("logs.columns.timestamp")}),(0,O.jsx)(Li.A,{children:m("logs.columns.endpoint")}),(0,O.jsx)(Li.A,{children:m("logs.columns.model")}),(0,O.jsx)(Li.A,{align:"right",children:m("logs.columns.tokens")}),(0,O.jsx)(Li.A,{align:"right",children:m("logs.columns.duration")}),(0,O.jsx)(Li.A,{children:m("logs.columns.status")})]})}),(0,O.jsx)(Fi.A,{children:0===e.length?(0,O.jsx)(Oi.A,{children:(0,O.jsx)(Li.A,{colSpan:7,align:"center",children:m("logs.noLogs")})}):e.map(e=>(0,O.jsx)(Gi,{log:e},e.id))})]})}),(0,O.jsx)(Ui.A,{component:"div",count:-1,rowsPerPage:l,page:s,onPageChange:(e,t)=>{r(t)},onRowsPerPageChange:e=>{d(parseInt(e.target.value,10)),r(0)},rowsPerPageOptions:[10,25,50,100],labelDisplayedRows:e=>{let{from:t,to:n}=e;return"".concat(t,"-").concat(n)}})]})})};var qi=n(43833),Yi=n(24397),Xi=n(31285),Zi=n(41232),Qi=n(3683),$i=n(17923),eo=n(37524),to=n(4145),no=n(43841),ao=n(6493),so=n(90158),io=n(92098),oo=n(39497),ro=n(87949);var lo=n(72814);const co=["temperature"],uo=["key"],ho=e=>{let{open:t,onClose:n,model:h,onSave:m,isNew:p=!1}=e;const{t:g}=(0,y.Bd)(),[f,v]=i.useState(h),[A,b]=i.useState({});if((0,i.useEffect)(()=>{v(p&&!h?{key:"",name:"",provider:"",temperature:.7,context_window:4096,max_output_tokens:1024,extended_thinking:!1,enabled:!0}:h),b({})},[h,p]),!f)return null;const j=e=>t=>{let n=t.target.value;"temperature"===e&&""!==n?(n=parseFloat(n),isNaN(n)||n<0||n>2?b(e=>(0,a.A)((0,a.A)({},e),{},{temperature:"Must be between 0 and 2"})):b(e=>{const{temperature:t}=e;return(0,s.A)(e,co)})):"context_window"!==e&&"max_output_tokens"!==e||""===n?"key"!==e&&"name"!==e||b(n?t=>{const n=(0,a.A)({},t);return delete n[e],n}:t=>(0,a.A)((0,a.A)({},t),{},{[e]:"This field is required"})):(n=parseInt(n,10),isNaN(n)||n<=0?b(t=>(0,a.A)((0,a.A)({},t),{},{[e]:"Must be a positive number"})):b(t=>{const n=(0,a.A)({},t);return delete n[e],n})),v(t=>t?(0,a.A)((0,a.A)({},t),{},{[e]:n}):null)};return(0,O.jsxs)(r.A,{open:t,onClose:n,maxWidth:"md",fullWidth:!0,PaperProps:{sx:{overflowY:"visible",borderRadius:2,boxShadow:"0 8px 32px rgba(0,0,0,0.12)"}},children:[(0,O.jsxs)(d.A,{sx:{borderBottom:"1px solid",borderColor:"divider",p:3},children:[(0,O.jsxs)(o.A,{sx:{display:"flex",alignItems:"center"},children:[(0,O.jsx)(ct.A,{sx:{mr:1.5,color:"primary.main",fontSize:"1.5rem"}}),p?(0,O.jsx)(c.A,{variant:"h5",children:g("configuration.models.add",{defaultValue:"Add New Model"})}):(0,O.jsx)(c.A,{variant:"h5",children:g("configuration.models.edit",{defaultValue:"Edit Model"})})]}),(0,O.jsx)(u.A,{onClick:n,sx:{position:"absolute",right:16,top:16,color:"text.secondary","&:hover":{bgcolor:"action.hover",color:"primary.main"}},children:(0,O.jsx)(D.A,{})})]}),(0,O.jsx)(l.A,{sx:{p:3},children:(0,O.jsxs)(hs.A,{spacing:3,sx:{mt:1},children:[(0,O.jsx)(V.A,{label:g("configuration.models.key",{defaultValue:"Model Key"}),value:f.key||"",onChange:j("key"),fullWidth:!0,required:!0,disabled:!p,error:!!A.key,size:"medium",sx:{"& .MuiOutlinedInput-root":{borderRadius:1.5}},helperText:A.key||g("configuration.models.keyHelp",{defaultValue:"Unique identifier for this model"})}),(0,O.jsx)(V.A,{label:g("configuration.models.name",{defaultValue:"Model Name"}),value:f.name||"",onChange:j("name"),fullWidth:!0,required:!0,error:!!A.name,size:"medium",sx:{"& .MuiOutlinedInput-root":{borderRadius:1.5}},helperText:A.name||g("configuration.models.nameHelp",{defaultValue:'Full name of the model (e.g., "gpt-4-turbo-preview")'})}),(0,O.jsxs)(oe.A,{fullWidth:!0,size:"medium",sx:{"& .MuiOutlinedInput-root":{borderRadius:1.5}},children:[(0,O.jsx)(re.A,{children:g("configuration.models.provider",{defaultValue:"Provider"})}),(0,O.jsxs)(le.A,{value:f.provider||"",onChange:(w="provider",e=>{const t=e.target.value;v(e=>e?(0,a.A)((0,a.A)({},e),{},{[w]:t}):null)}),label:g("configuration.models.provider",{defaultValue:"Provider"}),children:[(0,O.jsx)(de.A,{value:"",children:(0,O.jsx)("em",{children:g("common.none",{defaultValue:"None"})})}),(0,O.jsx)(de.A,{value:"openai",children:"OpenAI"}),(0,O.jsx)(de.A,{value:"anthropic",children:"Anthropic"}),(0,O.jsx)(de.A,{value:"gemini",children:"Gemini"}),(0,O.jsx)(de.A,{value:"mistral",children:"Mistral"}),(0,O.jsx)(de.A,{value:"ollama",children:"Ollama"}),(0,O.jsx)(de.A,{value:"cohere",children:"Cohere"}),(0,O.jsx)(de.A,{value:"databricks",children:"Databricks"}),(0,O.jsx)(de.A,{value:"local",children:"Local"})]})]}),(0,O.jsx)(te.A,{sx:{my:1.5}}),(0,O.jsx)(c.A,{variant:"subtitle1",color:"text.primary",fontWeight:"medium",sx:{pt:1.5},children:g("configuration.models.parameters",{defaultValue:"Model Parameters"})}),(0,O.jsx)(V.A,{label:g("configuration.models.temperature",{defaultValue:"Temperature"}),value:void 0===f.temperature?"":f.temperature,onChange:j("temperature"),type:"number",fullWidth:!0,inputProps:{step:.1,min:0,max:2},error:!!A.temperature,size:"medium",sx:{"& .MuiOutlinedInput-root":{borderRadius:1.5}},helperText:A.temperature||g("configuration.models.temperatureHelp",{defaultValue:"Controls randomness (0.0 to 2.0)"})}),(0,O.jsx)(V.A,{label:g("configuration.models.contextWindow",{defaultValue:"Context Window"}),value:void 0===f.context_window?"":f.context_window,onChange:j("context_window"),type:"number",fullWidth:!0,inputProps:{min:1},error:!!A.context_window,size:"medium",sx:{"& .MuiOutlinedInput-root":{borderRadius:1.5}},helperText:A.context_window||g("configuration.models.contextWindowHelp",{defaultValue:"Maximum token context length"})}),(0,O.jsx)(V.A,{label:g("configuration.models.maxOutputTokens",{defaultValue:"Max Output Tokens"}),value:void 0===f.max_output_tokens?"":f.max_output_tokens,onChange:j("max_output_tokens"),type:"number",fullWidth:!0,inputProps:{min:1},error:!!A.max_output_tokens,size:"medium",sx:{"& .MuiOutlinedInput-root":{borderRadius:1.5}},helperText:A.max_output_tokens||g("configuration.models.maxOutputTokensHelp",{defaultValue:"Maximum tokens to generate"})}),(0,O.jsx)(he.A,{sx:{mt:1},control:(0,O.jsx)(me.A,{checked:!!f.extended_thinking,onChange:(e=>t=>{v(n=>n?(0,a.A)((0,a.A)({},n),{},{[e]:t.target.checked}):null)})("extended_thinking"),color:"primary"}),label:g("configuration.models.extendedThinking",{defaultValue:"Extended Thinking"})})]})}),(0,O.jsxs)(B.A,{sx:{px:3,py:2.5,borderTop:"1px solid",borderColor:"divider"},children:[(0,O.jsx)(x.A,{onClick:n,children:g("common.cancel",{defaultValue:"Cancel"})}),(0,O.jsx)(x.A,{onClick:()=>{const e={};if(f.key||(e.key="Key is required"),f.name||(e.name="Name is required"),Object.keys(e).length>0||Object.keys(A).length>0)return void b((0,a.A)((0,a.A)({},A),e));const{key:t}=f,i=(0,s.A)(f,uo);m(t,i),n()},variant:"contained",startIcon:(0,O.jsx)(io.A,{}),disabled:Object.keys(A).length>0,sx:{px:3},children:g("common.save",{defaultValue:"Save"})})]})]});var w},mo=e=>{let{open:t,modelKey:n,onClose:a,onConfirm:s}=e;const{t:i}=(0,y.Bd)();return(0,O.jsxs)(r.A,{open:t,onClose:a,"aria-labelledby":"alert-dialog-title","aria-describedby":"alert-dialog-description",children:[(0,O.jsx)(d.A,{id:"alert-dialog-title",children:i("configuration.models.confirmDeleteTitle",{defaultValue:"Delete Model?"})}),(0,O.jsx)(l.A,{children:(0,O.jsx)(ao.A,{id:"alert-dialog-description",children:i("configuration.models.confirmDeleteMessage",{defaultValue:"Are you sure you want to delete the model {{modelKey}}? This action cannot be undone.",modelKey:n})})}),(0,O.jsxs)(B.A,{children:[(0,O.jsx)(x.A,{onClick:a,color:"primary",children:i("common.cancel",{defaultValue:"Cancel"})}),(0,O.jsx)(x.A,{onClick:s,color:"error",variant:"contained",autoFocus:!0,children:i("common.delete",{defaultValue:"Delete"})})]})]})},po=()=>{const{t:e}=(0,y.Bd)(),{models:t,currentEditModel:n,editDialogOpen:s,isNewModel:r,loading:l,saving:d,searchTerm:h,error:p,setModels:g,setCurrentEditModel:f,setEditDialogOpen:v,setIsNewModel:A,setLoading:b,setSaving:j,setSearchTerm:w,setError:k}=(()=>{const{models:e,currentEditModel:t,editDialogOpen:n,isNewModel:a,loading:s,saving:o,modelsChanged:r,searchTerm:l,databricksEnabled:d,error:c,refreshKey:u,activeTab:h,setModels:m,setCurrentEditModel:p,setEditDialogOpen:x,setIsNewModel:g,setLoading:f,setSaving:v,setModelsChanged:A,setSearchTerm:y,setDatabricksEnabled:b,setError:j,incrementRefreshKey:w,setActiveTab:k,resetModelConfig:C}=Zn(),S=(0,i.useCallback)(e=>{m(e)},[m]),_=(0,i.useCallback)(e=>{p(e)},[p]),E=(0,i.useCallback)(e=>{x(e)},[x]),I=(0,i.useCallback)(e=>{g(e)},[g]),T=(0,i.useCallback)(e=>{f(e)},[f]),D=(0,i.useCallback)(e=>{v(e)},[v]),N=(0,i.useCallback)(e=>{A(e)},[A]),P=(0,i.useCallback)(e=>{y(e)},[y]),M=(0,i.useCallback)(e=>{b(e)},[b]),z=(0,i.useCallback)(e=>{j(e)},[j]);return{models:e,currentEditModel:t,editDialogOpen:n,isNewModel:a,loading:s,saving:o,modelsChanged:r,searchTerm:l,databricksEnabled:d,error:c,refreshKey:u,activeTab:h,setModels:S,setCurrentEditModel:_,setEditDialogOpen:E,setIsNewModel:I,setLoading:T,setSaving:D,setModelsChanged:N,setSearchTerm:P,setDatabricksEnabled:M,setError:z,incrementRefreshKey:(0,i.useCallback)(()=>{w()},[w]),setActiveTab:(0,i.useCallback)(e=>{k(e)},[k]),resetModelConfig:(0,i.useCallback)(()=>{C()},[C])}})(),{enqueueSnackbar:C}=(0,lo.dh)(),[S,_]=i.useState(null);(0,i.useEffect)(()=>{(async()=>{try{b(!0);const e=ve.J.getInstance(),t=await e.getModels(!0);g(t)}catch(e){k(e instanceof Error?e.message:"Failed to fetch models")}finally{b(!1)}})()},[b,g,k]);const E=Object.entries(t).filter(e=>{let[t,n]=e;return t.toLowerCase().includes(h.toLowerCase())||n.name.toLowerCase().includes(h.toLowerCase())}).sort((e,t)=>e[1].name.localeCompare(t[1].name));return l?(0,O.jsx)(o.A,{sx:{display:"flex",justifyContent:"center",alignItems:"center",height:"100%"},children:(0,O.jsx)(ue.A,{})}):(0,O.jsxs)(o.A,{sx:{p:3},children:[(0,O.jsxs)(hs.A,{spacing:3,children:[(0,O.jsxs)(o.A,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,O.jsx)(c.A,{variant:"h4",component:"h1",children:e("configuration.models.title",{defaultValue:"Model Configuration"})}),(0,O.jsx)(x.A,{variant:"contained",startIcon:(0,O.jsx)(Qt.A,{}),onClick:()=>{A(!0),f(null),v(!0)},disabled:d,children:e("configuration.models.add",{defaultValue:"Add Model"})})]}),p&&(0,O.jsx)(m.A,{severity:"error",onClose:()=>k(null),children:p}),(0,O.jsx)(_e.A,{sx:{p:2},children:(0,O.jsx)(V.A,{fullWidth:!0,variant:"outlined",placeholder:e("configuration.models.search",{defaultValue:"Search models..."}),value:h,onChange:e=>w(e.target.value),InputProps:{startAdornment:(0,O.jsx)(ne.A,{position:"start",children:(0,O.jsx)(Ee.A,{})})}})}),(0,O.jsx)(o.A,{sx:{display:"flex",justifyContent:"flex-end",mt:2},children:(0,O.jsxs)(so.A,{variant:"outlined",size:"small",children:[(0,O.jsx)(x.A,{startIcon:(0,O.jsx)(oo.A,{}),onClick:async()=>{try{j(!0);const t=ve.J.getInstance(),n=await t.enableAllModels();g(n),k(null),C(e("configuration.models.allModelsEnabled",{defaultValue:"All models have been enabled"}),{variant:"success"})}catch(t){k(t instanceof Error?t.message:"Failed to enable all models"),C(e("configuration.models.enableAllFailed",{defaultValue:"Failed to enable all models"}),{variant:"error"})}finally{j(!1)}},disabled:d,color:"success",children:e("configuration.models.enableAll")}),(0,O.jsx)(x.A,{startIcon:(0,O.jsx)(ro.A,{}),onClick:async()=>{try{j(!0);const t=ve.J.getInstance(),n=await t.disableAllModels();g(n),k(null),C(e("configuration.models.allModelsDisabled",{defaultValue:"All models have been disabled"}),{variant:"success"})}catch(t){k(t instanceof Error?t.message:"Failed to disable all models"),C(e("configuration.models.disableAllFailed",{defaultValue:"Failed to disable all models"}),{variant:"error"})}finally{j(!1)}},disabled:d,color:"error",children:e("configuration.models.disableAll")})]})}),(0,O.jsx)(Pi.A,{component:_e.A,children:(0,O.jsxs)(Mi.A,{children:[(0,O.jsx)(zi.A,{children:(0,O.jsxs)(Oi.A,{children:[(0,O.jsx)(Li.A,{children:e("configuration.models.key",{defaultValue:"Key"})}),(0,O.jsx)(Li.A,{children:e("configuration.models.name",{defaultValue:"Name"})}),(0,O.jsx)(Li.A,{children:e("configuration.models.provider",{defaultValue:"Provider"})}),(0,O.jsx)(Li.A,{children:e("configuration.models.status",{defaultValue:"Status"})}),(0,O.jsx)(Li.A,{children:e("configuration.models.actions",{defaultValue:"Actions"})})]})}),(0,O.jsx)(Fi.A,{children:E.map(t=>{let[n,s]=t;return(0,O.jsxs)(Oi.A,{children:[(0,O.jsx)(Li.A,{children:n}),(0,O.jsx)(Li.A,{children:s.name}),(0,O.jsx)(Li.A,{children:s.provider}),(0,O.jsx)(Li.A,{children:(0,O.jsx)(he.A,{control:(0,O.jsx)(me.A,{checked:s.enabled,onChange:t=>(async(t,n)=>{try{j(!0);const a=ve.J.getInstance();await a.enableModel(t,n);const s=await a.getModels(!0);g(s),C(n?e("configuration.models.modelEnabled",{defaultValue:"Model enabled successfully"}):e("configuration.models.modelDisabled",{defaultValue:"Model disabled successfully"}),{variant:"success"})}catch(a){k(a instanceof Error?a.message:"Failed to update model status"),C(e("configuration.models.toggleFailed",{defaultValue:"Failed to toggle model status"}),{variant:"error"})}finally{j(!1)}})(n,t.target.checked),disabled:d}),label:s.enabled?e("configuration.models.enabled",{defaultValue:"Enabled"}):e("configuration.models.disabled",{defaultValue:"Disabled"})})}),(0,O.jsx)(Li.A,{children:(0,O.jsxs)(hs.A,{direction:"row",spacing:1,children:[(0,O.jsx)(P.A,{title:e("common.edit",{defaultValue:"Edit"}),children:(0,O.jsx)(u.A,{onClick:()=>(e=>{A(!1),f(e),v(!0)})((0,a.A)((0,a.A)({},s),{},{key:n})),disabled:d,children:(0,O.jsx)(Y.A,{})})}),(0,O.jsx)(P.A,{title:e("common.delete",{defaultValue:"Delete"}),children:(0,O.jsx)(u.A,{onClick:()=>(e=>{_(e)})(n),disabled:d,children:(0,O.jsx)(D.A,{})})})]})})]},n)})})]})})]}),(0,O.jsx)(ho,{open:s,onClose:()=>{v(!1),f(null)},model:n,onSave:async(e,t)=>{try{j(!0);const n=ve.J.getInstance();r?await n.createModel(e,t):await n.saveModels({[e]:t});const a=await n.getModels(!0);g(a),f(null),v(!1)}catch(n){k(n instanceof Error?n.message:"Failed to save model")}finally{j(!1)}},isNew:r}),(0,O.jsx)(mo,{open:null!==S,modelKey:S||"",onClose:()=>{_(null)},onConfirm:()=>{(async t=>{try{j(!0);const n=ve.J.getInstance(),a=await n.deleteModel(t);g(a),C(e("configuration.models.modelDeleted",{defaultValue:"Model deleted successfully"}),{variant:"success"}),setTimeout(()=>{n.getModels(!0).then(e=>{g(e)}).catch(e=>{})},2e3)}catch(n){k(n instanceof Error?n.message:"Failed to delete model"),C(e("configuration.models.deleteFailed",{defaultValue:"Failed to delete model"}),{variant:"error"})}finally{j(!1)}})(S||""),_(null)}})]})},xo=po;const go=function(){var e,t,n,s;const[p,g]=(0,i.useState)([]),[f,v]=(0,i.useState)(!0),[A,y]=(0,i.useState)(null),[b,j]=(0,i.useState)(!1),[w,k]=(0,i.useState)(!1),[C,S]=(0,i.useState)(!1),[_,E]=(0,i.useState)(null),[I,T]=(0,i.useState)({open:!1,message:"",severity:"success"}),[D,N]=(0,i.useState)(0),[M,z]=(0,i.useState)([]),[L,F]=(0,i.useState)({name:"",description:"",schema_type:"",schema_definition:{}}),[W,U]=(0,i.useState)({}),H=(0,i.useCallback)(function(e){T({open:!0,message:e,severity:arguments.length>1&&void 0!==arguments[1]?arguments[1]:"success"})},[]),K=(0,i.useCallback)(async()=>{v(!0);try{const e=wt.getInstance(),t=await e.getSchemas();g(t);const n=Array.from(new Set(t.map(e=>e.schema_type)));z(n),y(null)}catch(A){y(A instanceof Error?A.message:"Error fetching schemas"),H("Failed to load schemas","error")}finally{v(!1)}},[H]);(0,i.useEffect)(()=>{K()},[K]);const G=()=>{T((0,a.A)((0,a.A)({},I),{},{open:!1}))},J=e=>e?Object.keys(e):[],Z=e=>{try{if(void 0===e||null===e)return"{}";if("string"===typeof e)try{if(e.startsWith('"')&&e.endsWith('"'))try{const t=JSON.parse(e);if("string"===typeof t){const e=JSON.parse(t);return JSON.stringify(e,null,2)}}catch(t){}const n=JSON.parse(e);return JSON.stringify(n,null,2)}catch(t){return e}return JSON.stringify(e,null,2)}catch(A){return"string"===typeof e?e:JSON.stringify(e||{},null,2)}},Q=e=>{try{const t=e.trim();if(!t)return{};let n=t;const a=(n.match(/{/g)||[]).length,s=(n.match(/}/g)||[]).length;return a>s&&(n+="}".repeat(a-s)),n=n.replace(/([{,]\s*)([a-zA-Z0-9_]+)(\s*:)/g,'$1"$2"$3'),n=n.replace(/,\s*([}\]])/g,"$1"),JSON.parse(n)}catch(A){return}},$=()=>{if(0===D)return p;const e=M[D-1];return p.filter(t=>t.schema_type===e)},te=(e,t)=>{if(!e)return null;if("schema_definition"===t){const t=e.schema_definition;if(!t)return{};if("string"===typeof t)try{return JSON.parse(t)}catch(A){return t}return t}const n=e[t];if(!n)return null;if("string"===typeof n&&"name"!==t&&"description"!==t&&"schema_type"!==t)try{return JSON.parse(n)}catch(a){return n}return n},ne=(e,t)=>{try{const n=Q(t);void 0!==n?(U(t=>(0,a.A)((0,a.A)({},t),{},{[e]:""})),E(t=>t?(0,a.A)((0,a.A)({},t),{},{[e]:n}):null)):(U(t=>(0,a.A)((0,a.A)({},t),{},{[e]:"Invalid JSON format"})),E(n=>n?(0,a.A)((0,a.A)({},n),{},{[e]:t}):null))}catch(A){U(n=>(0,a.A)((0,a.A)({},n),{},{[e]:A instanceof Error?A.message:"Invalid JSON"}))}},ae=(e,t)=>{try{const n={[e]:t};F(e=>(0,a.A)((0,a.A)({},e),n));const s=Q(t);void 0!==s?(U(t=>(0,a.A)((0,a.A)({},t),{},{[e]:""})),F(t=>(0,a.A)((0,a.A)({},t),{},{[e]:s}))):U(t=>(0,a.A)((0,a.A)({},t),{},{[e]:"Invalid JSON format"}))}catch(A){U(n=>(0,a.A)((0,a.A)({},n),{},{[e]:A instanceof Error?A.message:"Invalid JSON"}))}};return f&&0===p.length?(0,O.jsx)(o.A,{sx:{display:"flex",justifyContent:"center",p:3},children:(0,O.jsx)(ue.A,{})}):(0,O.jsxs)(ee.A,{sx:{mt:2},children:[(0,O.jsxs)(Xt.A,{children:[(0,O.jsxs)(o.A,{sx:{display:"flex",alignItems:"center",mb:3,justifyContent:"space-between"},children:[(0,O.jsxs)(o.A,{sx:{display:"flex",alignItems:"center"},children:[(0,O.jsx)(X.A,{sx:{mr:1}}),(0,O.jsx)(c.A,{variant:"h5",children:"Object Management"}),(0,O.jsx)(P.A,{title:(0,O.jsxs)(o.A,{sx:{p:1},children:[(0,O.jsx)(c.A,{variant:"body2",children:"Object Management allows you to create, edit, and manage Pydantic schemas used throughout the system."}),(0,O.jsx)(c.A,{variant:"body2",sx:{mt:1},children:"Pydantic schemas define the structure and validation rules for data objects, ensuring consistent data formats for inputs and outputs across the application."}),(0,O.jsx)(c.A,{variant:"body2",sx:{mt:1},children:"These schemas are used for standardizing outputs from AI operations, validating API requests/responses, and enforcing type safety in your data workflows."})]}),arrow:!0,children:(0,O.jsx)(u.A,{size:"small",color:"primary",sx:{ml:1},children:(0,O.jsx)(Oe.A,{fontSize:"small"})})})]}),(0,O.jsx)(x.A,{variant:"contained",color:"primary",startIcon:(0,O.jsx)(Qt.A,{}),onClick:()=>{k(!0)},children:"Add Schema"})]}),A&&(0,O.jsx)(m.A,{severity:"error",sx:{mb:2},children:A}),(0,O.jsx)(o.A,{sx:{borderBottom:1,borderColor:"divider",mb:2},children:(0,O.jsxs)(ea.A,{value:D,onChange:(e,t)=>{N(t)},variant:"scrollable",scrollButtons:"auto",children:[(0,O.jsx)(ta.A,{label:"All Schemas"}),M.map((e,t)=>(0,O.jsx)(ta.A,{label:e},e))]})}),(0,O.jsx)(Pi.A,{component:_e.A,children:(0,O.jsxs)(Mi.A,{children:[(0,O.jsx)(zi.A,{children:(0,O.jsxs)(Oi.A,{children:[(0,O.jsx)(Li.A,{children:"Name"}),(0,O.jsx)(Li.A,{children:"Type"}),(0,O.jsx)(Li.A,{children:"Description"}),(0,O.jsx)(Li.A,{children:"Keywords"}),(0,O.jsx)(Li.A,{children:"Last Updated"}),(0,O.jsx)(Li.A,{children:"Actions"})]})}),(0,O.jsx)(Fi.A,{children:0===$().length?(0,O.jsx)(Oi.A,{children:(0,O.jsx)(Li.A,{colSpan:6,align:"center",children:"No schemas found"})}):$().map(e=>{var t;return(0,O.jsxs)(Oi.A,{children:[(0,O.jsx)(Li.A,{children:e.name}),(0,O.jsx)(Li.A,{children:e.schema_type}),(0,O.jsx)(Li.A,{children:e.description}),(0,O.jsx)(Li.A,{children:(0,O.jsx)(o.A,{sx:{display:"flex",flexWrap:"wrap",gap:.5},children:null===(t=e.keywords)||void 0===t?void 0:t.map((e,t)=>(0,O.jsx)(R.A,{label:e,size:"small"},t))})}),(0,O.jsx)(Li.A,{children:new Date(e.updated_at).toLocaleString()}),(0,O.jsx)(Li.A,{children:(0,O.jsxs)(o.A,{sx:{display:"flex"},children:[(0,O.jsx)(P.A,{title:"View & Edit Schema",children:(0,O.jsx)(u.A,{size:"small",onClick:()=>(e=>{E(e),S(!0)})(e),color:"primary",children:(0,O.jsx)(X.A,{fontSize:"small"})})}),(0,O.jsx)(P.A,{title:"Delete",children:(0,O.jsx)(u.A,{size:"small",onClick:()=>(async e=>{if(window.confirm('Are you sure you want to delete the schema "'.concat(e,'"?')))try{const t=wt.getInstance();await t.deleteSchema(e)?(await K(),H('Schema "'.concat(e,'" deleted successfully'))):H('Failed to delete schema "'.concat(e,'"'),"error")}catch(A){H(A instanceof Error?A.message:"Error deleting schema","error")}})(e.name),color:"error",children:(0,O.jsx)(q.A,{fontSize:"small"})})})]})})]},e.id)})})]})})]}),(0,O.jsxs)(r.A,{open:C,onClose:()=>S(!1),maxWidth:"md",fullWidth:!0,children:[(0,O.jsxs)(d.A,{children:["Schema: ",null===_||void 0===_?void 0:_.name]}),(0,O.jsx)(l.A,{children:(0,O.jsxs)(o.A,{sx:{mt:2},children:[(0,O.jsx)(c.A,{variant:"subtitle1",children:"Schema JSON:"}),_&&(0,O.jsx)(_e.A,{variant:"outlined",sx:{p:2,maxHeight:"400px",overflow:"auto",fontFamily:"monospace",whiteSpace:"pre-wrap",backgroundColor:"#f5f5f5"},children:"CustomToolOutput"===_.name&&_.schema_definition&&"string"===typeof _.schema_definition?_.schema_definition:Z(te(_,"schema_definition"))}),te(_,"field_descriptions")&&J(te(_,"field_descriptions")).length>0&&(0,O.jsxs)(o.A,{sx:{mt:2},children:[(0,O.jsx)(c.A,{variant:"subtitle1",children:"Field Descriptions:"}),(0,O.jsx)(_e.A,{variant:"outlined",sx:{p:2,maxHeight:"200px",overflow:"auto",fontFamily:"monospace",whiteSpace:"pre-wrap",backgroundColor:"#f5f5f5"},children:Z(te(_,"field_descriptions")||{})})]}),te(_,"example_data")&&J(te(_,"example_data")).length>0&&(0,O.jsxs)(o.A,{sx:{mt:2},children:[(0,O.jsx)(c.A,{variant:"subtitle1",children:"Example Data:"}),(0,O.jsx)(_e.A,{variant:"outlined",sx:{p:2,maxHeight:"200px",overflow:"auto",fontFamily:"monospace",whiteSpace:"pre-wrap",backgroundColor:"#f5f5f5"},children:Z(te(_,"example_data")||{})})]})]})}),(0,O.jsxs)(B.A,{children:[(0,O.jsx)(x.A,{onClick:()=>S(!1),children:"Close"}),(0,O.jsx)(x.A,{onClick:()=>{S(!1),E(_),j(!0)},variant:"contained",color:"primary",startIcon:(0,O.jsx)(Y.A,{}),children:"Edit"})]})]}),(0,O.jsxs)(r.A,{open:b,onClose:()=>j(!1),maxWidth:"md",fullWidth:!0,children:[(0,O.jsx)(d.A,{children:"Edit Schema"}),(0,O.jsxs)(l.A,{children:[(0,O.jsx)(V.A,{label:"Name",value:(null===_||void 0===_?void 0:_.name)||"",onChange:e=>E(t=>t?(0,a.A)((0,a.A)({},t),{},{name:e.target.value}):null),fullWidth:!0,margin:"normal",disabled:!0}),(0,O.jsx)(V.A,{label:"Description",value:(null===_||void 0===_?void 0:_.description)||"",onChange:e=>E(t=>t?(0,a.A)((0,a.A)({},t),{},{description:e.target.value}):null),fullWidth:!0,margin:"normal"}),(0,O.jsx)(V.A,{label:"Schema Type",value:(null===_||void 0===_?void 0:_.schema_type)||"",onChange:e=>E(t=>t?(0,a.A)((0,a.A)({},t),{},{schema_type:e.target.value}):null),fullWidth:!0,margin:"normal"}),(0,O.jsxs)(o.A,{sx:{mt:2,mb:2},children:[(0,O.jsx)(c.A,{variant:"subtitle1",gutterBottom:!0,children:"Schema JSON:"}),(0,O.jsx)(V.A,{value:"string"===typeof(null===_||void 0===_?void 0:_.schema_definition)?_.schema_definition:Z(null===_||void 0===_?void 0:_.schema_definition),onChange:e=>ne("schema_definition",e.target.value),fullWidth:!0,multiline:!0,rows:10,variant:"outlined",error:!!W.schema_definition,helperText:W.schema_definition||"",InputProps:{style:{fontFamily:"monospace"}}})]}),(0,O.jsxs)(o.A,{sx:{mt:2,mb:2},children:[(0,O.jsx)(c.A,{variant:"subtitle1",gutterBottom:!0,children:"Field Descriptions:"}),(0,O.jsx)(V.A,{value:"string"===typeof(null===_||void 0===_?void 0:_.field_descriptions)?_.field_descriptions:Z(te(_,"field_descriptions")||{}),onChange:e=>ne("field_descriptions",e.target.value),fullWidth:!0,multiline:!0,rows:6,variant:"outlined",error:!!W.field_descriptions,helperText:W.field_descriptions||"",InputProps:{style:{fontFamily:"monospace"}}})]}),(0,O.jsxs)(o.A,{sx:{mt:2,mb:2},children:[(0,O.jsx)(c.A,{variant:"subtitle1",gutterBottom:!0,children:"Example Data:"}),(0,O.jsx)(V.A,{value:"string"===typeof(null===_||void 0===_?void 0:_.example_data)?_.example_data:Z(te(_,"example_data")||{}),onChange:e=>ne("example_data",e.target.value),fullWidth:!0,multiline:!0,rows:10,variant:"outlined",error:!!W.example_data,helperText:W.example_data||"",InputProps:{style:{fontFamily:"monospace"}}})]}),(0,O.jsx)(V.A,{label:"Keywords (comma separated)",value:(null===_||void 0===_||null===(e=_.keywords)||void 0===e?void 0:e.join(", "))||"",onChange:e=>{const t=e.target.value.split(",").map(e=>e.trim()).filter(e=>e);E(e=>e?(0,a.A)((0,a.A)({},e),{},{keywords:t}):null)},fullWidth:!0,margin:"normal"}),(0,O.jsx)(V.A,{label:"Tools (comma separated)",value:(null===_||void 0===_||null===(t=_.tools)||void 0===t?void 0:t.join(", "))||"",onChange:e=>{const t=e.target.value.split(",").map(e=>e.trim()).filter(e=>e);E(e=>e?(0,a.A)((0,a.A)({},e),{},{tools:t}):null)},fullWidth:!0,margin:"normal"})]}),(0,O.jsxs)(B.A,{children:[(0,O.jsx)(x.A,{onClick:()=>j(!1),children:"Cancel"}),(0,O.jsx)(x.A,{onClick:async()=>{if(!_)return;U({});let e="";e="string"===typeof _.schema_definition?_.schema_definition:Z(_.schema_definition);const t=Q(e);if(!t)return void U(e=>(0,a.A)((0,a.A)({},e),{},{schema_definition:"Invalid JSON format"}));let n,s;if(_.field_descriptions){let e="";if(e="string"===typeof _.field_descriptions?_.field_descriptions:Z(_.field_descriptions),n=Q(e),!n)return void U(e=>(0,a.A)((0,a.A)({},e),{},{field_descriptions:"Invalid JSON format"}))}if(_.example_data){let e="";if(e="string"===typeof _.example_data?_.example_data:Z(_.example_data),s=Q(e),!s)return void U(e=>(0,a.A)((0,a.A)({},e),{},{example_data:"Invalid JSON format"}))}try{const e={name:_.name,description:_.description,schema_type:_.schema_type,schema_definition:t,field_descriptions:n,example_data:s,keywords:_.keywords||[],tools:_.tools||[]},a=wt.getInstance();await a.updateSchema(_.name,e)?(j(!1),await K(),H('Schema "'.concat(_.name,'" updated successfully'))):H('Failed to update schema "'.concat(_.name,'"'),"error")}catch(A){H(A instanceof Error?A.message:"An unknown error occurred","error")}},variant:"contained",color:"primary",children:"Save"})]})]}),(0,O.jsxs)(r.A,{open:w,onClose:()=>k(!1),maxWidth:"md",fullWidth:!0,children:[(0,O.jsx)(d.A,{children:"Create New Schema"}),(0,O.jsxs)(l.A,{children:[(0,O.jsx)(V.A,{label:"Name",value:L.name,onChange:e=>F(t=>(0,a.A)((0,a.A)({},t),{},{name:e.target.value})),fullWidth:!0,margin:"normal",required:!0}),(0,O.jsx)(V.A,{label:"Description",value:L.description,onChange:e=>F(t=>(0,a.A)((0,a.A)({},t),{},{description:e.target.value})),fullWidth:!0,margin:"normal"}),(0,O.jsx)(V.A,{label:"Schema Type",value:L.schema_type,onChange:e=>F(t=>(0,a.A)((0,a.A)({},t),{},{schema_type:e.target.value})),fullWidth:!0,margin:"normal",required:!0}),(0,O.jsxs)(o.A,{sx:{mt:2,mb:2},children:[(0,O.jsx)(c.A,{variant:"subtitle1",gutterBottom:!0,children:"Schema JSON:"}),(0,O.jsx)(V.A,{value:"string"===typeof L.schema_definition?L.schema_definition:Z(L.schema_definition||{}),onChange:e=>ae("schema_definition",e.target.value),fullWidth:!0,multiline:!0,rows:12,variant:"outlined",required:!0,error:!!W.schema_definition,helperText:W.schema_definition||"",InputProps:{style:{fontFamily:"monospace"}}})]}),(0,O.jsxs)(o.A,{sx:{mt:2,mb:2},children:[(0,O.jsx)(c.A,{variant:"subtitle1",gutterBottom:!0,children:"Field Descriptions (Optional):"}),(0,O.jsx)(V.A,{value:"string"===typeof L.field_descriptions?L.field_descriptions:Z(L.field_descriptions||{}),onChange:e=>ae("field_descriptions",e.target.value),fullWidth:!0,multiline:!0,rows:6,variant:"outlined",error:!!W.field_descriptions,helperText:W.field_descriptions||"",InputProps:{style:{fontFamily:"monospace"}}})]}),(0,O.jsxs)(o.A,{sx:{mt:2,mb:2},children:[(0,O.jsx)(c.A,{variant:"subtitle1",gutterBottom:!0,children:"Example Data (Optional):"}),(0,O.jsx)(V.A,{value:"string"===typeof L.example_data?L.example_data:Z(L.example_data||{}),onChange:e=>ae("example_data",e.target.value),fullWidth:!0,multiline:!0,rows:10,variant:"outlined",error:!!W.example_data,helperText:W.example_data||"",InputProps:{style:{fontFamily:"monospace"}}})]}),(0,O.jsx)(V.A,{label:"Keywords (comma separated)",value:(null===(n=L.keywords)||void 0===n?void 0:n.join(", "))||"",onChange:e=>{const t=e.target.value.split(",").map(e=>e.trim()).filter(e=>e);F(e=>(0,a.A)((0,a.A)({},e),{},{keywords:t}))},fullWidth:!0,margin:"normal"}),(0,O.jsx)(V.A,{label:"Tools (comma separated)",value:(null===(s=L.tools)||void 0===s?void 0:s.join(", "))||"",onChange:e=>{const t=e.target.value.split(",").map(e=>e.trim()).filter(e=>e);F(e=>(0,a.A)((0,a.A)({},e),{},{tools:t}))},fullWidth:!0,margin:"normal"})]}),(0,O.jsxs)(B.A,{children:[(0,O.jsx)(x.A,{onClick:()=>k(!1),children:"Cancel"}),(0,O.jsx)(x.A,{onClick:async()=>{if(U({}),!L.name||!L.schema_type||!L.description)return void H("Name, description, and schema type are required","error");let e,t,n;if("string"===typeof L.schema_definition){const t=Q(L.schema_definition);if(!t)return void U(e=>(0,a.A)((0,a.A)({},e),{},{schema_definition:"Invalid JSON format"}));e=t}else e=L.schema_definition||{};if(0!==Object.keys(e).length){if(L.field_descriptions)if("string"===typeof L.field_descriptions){const e=Q(L.field_descriptions);if(!e)return void U(e=>(0,a.A)((0,a.A)({},e),{},{field_descriptions:"Invalid JSON format"}));t=e}else t=L.field_descriptions;if(L.example_data)if("string"===typeof L.example_data){const e=Q(L.example_data);if(!e)return void U(e=>(0,a.A)((0,a.A)({},e),{},{example_data:"Invalid JSON format"}));n=e}else n=L.example_data;try{const a={name:L.name,description:L.description,schema_type:L.schema_type,schema_definition:e||{},field_descriptions:t||{},example_data:n||void 0,keywords:Array.isArray(L.keywords)?L.keywords:[],tools:Array.isArray(L.tools)?L.tools:[]};a.schema_definition&&"string"!==typeof a.schema_definition&&0!==Object.keys(a.schema_definition).length||(a.schema_definition={type:"object",properties:{},required:[]});const s=wt.getInstance(),i=await s.createSchema(a);i?(k(!1),F({name:"",description:"",schema_type:"",schema_definition:{}}),await K(),H('Schema "'.concat(i.name,'" created successfully'))):H("Failed to create schema","error")}catch(A){let t="Error creating schema";if(A instanceof Error)if(A.message.includes("Validation error:"))try{const n=A.message.indexOf("{");if(n>=0){const a=A.message.substring(n),s=JSON.parse(a);t=Array.isArray(s)?s.map(e=>e.loc&&e.msg?"Field '".concat(e.loc.join("."),"': ").concat(e.msg):e.msg||String(e)).join(", "):"object"===typeof s?Object.entries(s).map(e=>{let[t,n]=e;return"".concat(t,": ").concat(n)}).join(", "):JSON.stringify(s)}else t=A.message}catch(s){t=A.message}else t=A.message;else"string"===typeof A&&(t=A);H("Failed to create schema: ".concat(t),"error")}}else U(e=>(0,a.A)((0,a.A)({},e),{},{schema_definition:"Schema cannot be empty"}))},variant:"contained",color:"primary",children:"Create"})]})]}),(0,O.jsx)(h.A,{open:I.open,autoHideDuration:6e3,onClose:G,children:(0,O.jsx)(m.A,{onClose:G,severity:I.severity,children:I.message})})]})};var fo=n(20810),vo=n(50971);class Ao{constructor(){this.baseUrl="/templates"}static getInstance(){return Ao.instance||(Ao.instance=new Ao),Ao.instance}async getAllPrompts(){try{return(await ye.Ay.get(this.baseUrl)).data}catch(e){throw e}}async getPromptById(e){try{return(await ye.Ay.get("".concat(this.baseUrl,"/").concat(e))).data}catch(t){throw t}}async getPromptByName(e){try{return(await ye.Ay.get("".concat(this.baseUrl,"/by-name/").concat(e))).data}catch(t){throw t}}async updatePrompt(e,t){try{return(await ye.Ay.put("".concat(this.baseUrl,"/").concat(e),t)).data}catch(n){throw n}}async resetPromptTemplates(){try{return(await ye.Ay.post("".concat(this.baseUrl,"/reset"))).data}catch(e){throw e}}}Ao.instance=void 0;const yo=()=>{const{t:e}=(0,y.Bd)(),[t,n]=(0,i.useState)([]),[s,p]=(0,i.useState)(!0),[g,f]=(0,i.useState)(!1),[v,A]=(0,i.useState)(null),[b,j]=(0,i.useState)(""),[w,k]=(0,i.useState)(!1),[C,S]=(0,i.useState)({open:!1,message:"",severity:"success"});(0,i.useEffect)(()=>{_()},[]);const _=async()=>{p(!0);try{const e=Ao.getInstance(),t=await e.getAllPrompts();n(t)}catch(e){S({open:!0,message:"Failed to load prompt instructions",severity:"error"})}finally{p(!1)}},E=()=>{f(!1),A(null),j("")},I=()=>{S((0,a.A)((0,a.A)({},C),{},{open:!1}))};return s?(0,O.jsx)(o.A,{display:"flex",justifyContent:"center",alignItems:"center",height:"300px",children:(0,O.jsx)(ue.A,{})}):(0,O.jsxs)(o.A,{children:[(0,O.jsx)(c.A,{variant:"h6",gutterBottom:!0,children:e("configuration.prompts.title",{defaultValue:"Prompt Instructions"})}),(0,O.jsx)(c.A,{variant:"body2",color:"textSecondary",paragraph:!0,children:e("configuration.prompts.description",{defaultValue:"Edit the system prompt instructions used by Kasal agents."})}),(0,O.jsx)(o.A,{display:"flex",justifyContent:"flex-end",mb:2,children:(0,O.jsx)(x.A,{startIcon:(0,O.jsx)(vo.A,{}),variant:"outlined",color:"primary",onClick:()=>k(!0),children:e("configuration.prompts.resetToDefault",{defaultValue:"Reset to Default"})})}),(0,O.jsx)(_e.A,{elevation:2,sx:{mt:2},children:(0,O.jsxs)(at.A,{children:[t.map(e=>(0,O.jsxs)(i.Fragment,{children:[(0,O.jsx)(st.Ay,{secondaryAction:(0,O.jsx)(u.A,{edge:"end",onClick:()=>(e=>{A(e),j(e.template),f(!0)})(e),children:(0,O.jsx)(Y.A,{})}),children:(0,O.jsx)(ot.A,{primary:e.name,secondary:e.description||"No description"})}),(0,O.jsx)(te.A,{})]},e.id)),0===t.length&&(0,O.jsx)(st.Ay,{children:(0,O.jsx)(ot.A,{primary:"No prompt instructions found"})})]})}),(0,O.jsxs)(r.A,{open:g,onClose:E,fullWidth:!0,maxWidth:"md",children:[(0,O.jsx)(d.A,{children:e("configuration.prompts.editTitle",{defaultValue:"Edit Prompt Template"})}),(0,O.jsx)(l.A,{children:v&&(0,O.jsxs)(O.Fragment,{children:[(0,O.jsxs)(o.A,{sx:{mb:2,mt:1},children:[(0,O.jsx)(c.A,{variant:"subtitle1",fontWeight:"bold",children:v.name}),v.description&&(0,O.jsx)(c.A,{variant:"body2",color:"textSecondary",children:v.description})]}),(0,O.jsx)(V.A,{label:e("configuration.prompts.template",{defaultValue:"Template"}),multiline:!0,rows:15,fullWidth:!0,value:b,onChange:e=>j(e.target.value),variant:"outlined"})]})}),(0,O.jsxs)(B.A,{children:[(0,O.jsx)(x.A,{onClick:E,children:e("common.cancel",{defaultValue:"Cancel"})}),(0,O.jsx)(x.A,{onClick:async()=>{if(v)try{const e=Ao.getInstance();await e.updatePrompt(v.id,(0,a.A)((0,a.A)({},v),{},{template:b})),n(t.map(e=>e.id===v.id?(0,a.A)((0,a.A)({},e),{},{template:b,updated_at:(new Date).toISOString()}):e)),S({open:!0,message:"Prompt template updated successfully",severity:"success"}),E()}catch(e){S({open:!0,message:"Failed to update prompt template",severity:"error"})}},variant:"contained",color:"primary",children:e("common.save",{defaultValue:"Save"})})]})]}),(0,O.jsx)(h.A,{open:C.open,autoHideDuration:6e3,onClose:I,anchorOrigin:{vertical:"bottom",horizontal:"center"},children:(0,O.jsx)(m.A,{onClose:I,severity:C.severity,variant:"filled",children:C.message})}),(0,O.jsxs)(r.A,{open:w,onClose:()=>k(!1),children:[(0,O.jsx)(d.A,{children:e("configuration.prompts.resetConfirmTitle",{defaultValue:"Reset Prompt Instructions"})}),(0,O.jsx)(l.A,{children:(0,O.jsx)(c.A,{children:e("configuration.prompts.resetConfirmMessage",{defaultValue:"Are you sure you want to reset all prompt instructions to their default values? This action cannot be undone."})})}),(0,O.jsxs)(B.A,{children:[(0,O.jsx)(x.A,{onClick:()=>k(!1),children:e("common.cancel",{defaultValue:"Cancel"})}),(0,O.jsx)(x.A,{onClick:async()=>{k(!1),p(!0);try{const e=Ao.getInstance(),t=await e.resetPromptTemplates();S({open:!0,message:"Successfully reset ".concat(t.reset_count," prompt instructions to default values"),severity:"success"}),await _()}catch(e){S({open:!0,message:"Failed to reset prompt instructions",severity:"error"}),p(!1)}},variant:"contained",color:"primary",autoFocus:!0,children:e("configuration.prompts.confirmReset",{defaultValue:"Reset"})})]})]})]})};var bo=n(93153);const jo=e=>{let{onSaved:t}=e;const{t:n}=(0,y.Bd)(),[s,r]=(0,i.useState)({workspace_url:"",warehouse_id:"",catalog:"",schema:"",enabled:!1,apps_enabled:!1,volume_enabled:!1,volume_path:"main.default.task_outputs",volume_file_format:"json",volume_create_date_dirs:!0,knowledge_volume_enabled:!1,knowledge_volume_path:"main.default.knowledge",knowledge_chunk_size:1e3,knowledge_chunk_overlap:200}),[l,d]=(0,i.useState)(!1),[u,p]=(0,i.useState)(null),[g,f]=(0,i.useState)({open:!1,message:"",severity:"success"}),[v,A]=(0,i.useState)(null),[b,j]=(0,i.useState)(!1),[w,k]=(0,i.useState)(!1),[C,S]=(0,i.useState)(null);(0,i.useEffect)(()=>{(async()=>{try{const a=ke.O.getInstance(),s=await a.getDatabricksConfig();if(s){if(r(s),s.enabled){const e=await a.checkPersonalTokenRequired();p(e)}const i=36;try{const n=(await gt.m.listTools()).find(e=>e.id===i);if(n){var e,t;const a=await ys.getConfig(),o=a&&ks(a)&&a.backend_type===bs.DATABRICKS&&(null===(e=a.databricks_config)||void 0===e?void 0:e.endpoint_name)&&(null===(t=a.databricks_config)||void 0===t?void 0:t.short_term_index),r=s.enabled&&s.knowledge_volume_enabled&&o;n.enabled!==r&&await gt.m.toggleToolEnabled(i)}}catch(n){}}}catch(a){}})(),(async()=>{try{const n=await ys.getConfig();if(n&&ks(n)){var e,t;const a=n.backend_type===bs.DATABRICKS&&(null===(e=n.databricks_config)||void 0===e?void 0:e.endpoint_name)&&(null===(t=n.databricks_config)||void 0===t?void 0:t.short_term_index);k(!!a),S(n.backend_type)}else k(!1),S(null)}catch(n){k(!1),S(null)}})()},[]);const _=e=>t=>{r(n=>(0,a.A)((0,a.A)({},n),{},{[e]:t.target.value}))},E=()=>{f((0,a.A)((0,a.A)({},g),{},{open:!1}))};return(0,O.jsxs)(o.A,{children:[(0,O.jsxs)(o.A,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",mb:2},children:[(0,O.jsx)(c.A,{variant:"subtitle1",fontWeight:"medium",children:n("configuration.databricks.title")}),(0,O.jsx)(he.A,{control:(0,O.jsx)(me.A,{checked:s.enabled,onChange:async e=>{const t=e.target.checked;if(r(e=>(0,a.A)((0,a.A)({},e),{},{enabled:t})),t)try{const e=ke.O.getInstance(),t=await e.checkPersonalTokenRequired();p(t)}catch(n){}else p(null)},color:"primary"}),label:s.enabled?n("common.enabled"):n("common.disabled")})]}),u&&u.personal_token_required&&(0,O.jsx)(m.A,{severity:"warning",sx:{mb:2},children:u.message}),(0,O.jsxs)(hs.A,{spacing:2,sx:{mb:3},children:[(0,O.jsxs)(o.A,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",mb:1},children:[(0,O.jsx)(c.A,{variant:"subtitle2",color:"text.secondary",children:n("configuration.databricks.apps.title",{defaultValue:"Databricks Apps Integration"})}),(0,O.jsx)(he.A,{control:(0,O.jsx)(me.A,{checked:s.apps_enabled,onChange:e=>{r(t=>(0,a.A)((0,a.A)({},t),{},{apps_enabled:e.target.checked}))},color:"primary",disabled:!s.enabled}),label:s.apps_enabled?n("common.enabled"):n("common.disabled")})]}),(0,O.jsx)(V.A,{label:n("configuration.databricks.workspaceUrl"),value:s.workspace_url,onChange:_("workspace_url"),fullWidth:!0,disabled:l||!s.enabled||s.apps_enabled,size:"small",helperText:s.apps_enabled?n("configuration.databricks.workspaceUrl.disabled",{defaultValue:"Not required when using Databricks Apps"}):""}),(0,O.jsx)(V.A,{label:n("configuration.databricks.warehouseId"),value:s.warehouse_id,onChange:_("warehouse_id"),fullWidth:!0,disabled:l||!s.enabled||s.apps_enabled,size:"small"}),(0,O.jsx)(V.A,{label:n("configuration.databricks.catalog"),value:s.catalog,onChange:_("catalog"),fullWidth:!0,disabled:l||!s.enabled||s.apps_enabled,size:"small"}),(0,O.jsx)(V.A,{label:n("configuration.databricks.schema"),value:s.schema,onChange:_("schema"),fullWidth:!0,disabled:l||!s.enabled||s.apps_enabled,size:"small"})]}),(0,O.jsx)(te.A,{sx:{my:3}}),(0,O.jsxs)(o.A,{sx:{mb:3},children:[(0,O.jsxs)(o.A,{sx:{display:"flex",alignItems:"center",mb:2},children:[(0,O.jsx)(et.A,{sx:{mr:1,color:"primary.main"}}),(0,O.jsx)(c.A,{variant:"subtitle1",fontWeight:"medium",children:n("configuration.databricks.volume.title",{defaultValue:"Volume Uploads Configuration"})})]}),(0,O.jsx)(m.A,{severity:"info",sx:{mb:2},children:n("configuration.databricks.volume.description",{defaultValue:"Configure Databricks Volume settings for task outputs. When enabled, all task outputs will be automatically uploaded to the specified volume path. Tasks can override these settings individually."})}),(0,O.jsxs)(hs.A,{spacing:2,children:[(0,O.jsx)(he.A,{control:(0,O.jsx)(me.A,{checked:s.volume_enabled||!1,onChange:e=>r(t=>(0,a.A)((0,a.A)({},t),{},{volume_enabled:e.target.checked})),color:"primary",disabled:!s.enabled}),label:(0,O.jsxs)(o.A,{children:[(0,O.jsx)(c.A,{variant:"body1",children:n("configuration.databricks.volume.enable",{defaultValue:"Enable Volume Uploads for All Tasks"})}),(0,O.jsx)(c.A,{variant:"caption",color:"text.secondary",children:n("configuration.databricks.volume.enableDescription",{defaultValue:"Automatically upload task outputs to Databricks Volumes"})})]})}),(0,O.jsx)(V.A,{label:n("configuration.databricks.volume.path",{defaultValue:"Volume Path"}),value:s.volume_path||"main.default.task_outputs",onChange:e=>r(t=>(0,a.A)((0,a.A)({},t),{},{volume_path:e.target.value})),fullWidth:!0,disabled:l||!s.enabled||!s.volume_enabled,size:"small",helperText:n("configuration.databricks.volume.pathHelp",{defaultValue:"Format: catalog.schema.volume (e.g., main.default.task_outputs)"}),placeholder:"catalog.schema.volume"}),(0,O.jsxs)(oe.A,{fullWidth:!0,size:"small",disabled:l||!s.enabled||!s.volume_enabled,children:[(0,O.jsx)(re.A,{children:n("configuration.databricks.volume.format",{defaultValue:"Default File Format"})}),(0,O.jsxs)(le.A,{value:s.volume_file_format||"json",onChange:e=>r(t=>(0,a.A)((0,a.A)({},t),{},{volume_file_format:e.target.value})),label:n("configuration.databricks.volume.format",{defaultValue:"Default File Format"}),children:[(0,O.jsx)(de.A,{value:"json",children:"JSON"}),(0,O.jsx)(de.A,{value:"csv",children:"CSV"}),(0,O.jsx)(de.A,{value:"txt",children:"Text"})]})]}),(0,O.jsx)(he.A,{control:(0,O.jsx)(me.A,{checked:!1!==s.volume_create_date_dirs,onChange:e=>r(t=>(0,a.A)((0,a.A)({},t),{},{volume_create_date_dirs:e.target.checked})),color:"primary",disabled:!s.enabled||!s.volume_enabled}),label:(0,O.jsxs)(o.A,{children:[(0,O.jsx)(c.A,{variant:"body1",children:n("configuration.databricks.volume.dateDirs",{defaultValue:"Create Date-based Directories"})}),(0,O.jsx)(c.A,{variant:"caption",color:"text.secondary",children:n("configuration.databricks.volume.dateDirsDescription",{defaultValue:"Organize outputs in YYYY/MM/DD folder structure"})})]})}),s.volume_enabled&&s.enabled&&(0,O.jsxs)(m.A,{severity:"info",children:[(0,O.jsx)(c.A,{variant:"body2",sx:{mb:1},children:(0,O.jsx)("strong",{children:n("configuration.databricks.volume.example",{defaultValue:"Example output path:"})})}),(0,O.jsxs)(c.A,{variant:"body2",component:"code",sx:{display:"block",p:1,bgcolor:"grey.100",borderRadius:1,fontFamily:"monospace",fontSize:"0.875rem"},children:["/Volumes/",(s.volume_path||"main.default.task_outputs").replace(/\./g,"/"),"/[execution_name]",s.volume_create_date_dirs&&"/YYYY/MM/DD","/task_output.",s.volume_file_format||"json"]}),(0,O.jsx)(c.A,{variant:"caption",color:"text.secondary",sx:{mt:1,display:"block"},children:n("configuration.databricks.volume.executionNote",{defaultValue:"Note: [execution_name] will be replaced with the actual execution or run name"})})]})]})]}),(0,O.jsx)(te.A,{sx:{my:3}}),(0,O.jsxs)(o.A,{sx:{mb:3},children:[(0,O.jsxs)(o.A,{sx:{display:"flex",alignItems:"center",mb:2},children:[(0,O.jsx)(et.A,{sx:{mr:1,color:"secondary.main"}}),(0,O.jsx)(c.A,{variant:"subtitle1",fontWeight:"medium",children:n("configuration.databricks.knowledge.title",{defaultValue:"Knowledge Source Volume Configuration"})})]}),(0,O.jsx)(m.A,{severity:"info",sx:{mb:2},children:n("configuration.databricks.knowledge.description",{defaultValue:"Configure Databricks Volume settings for knowledge sources (RAG). When enabled, uploaded knowledge files will be stored in the specified volume and made available to AI agents during execution."})}),(0,O.jsxs)(hs.A,{spacing:2,children:[(0,O.jsx)(P.A,{title:w?"":"Knowledge sources require Databricks Vector Search memory backend configuration. ".concat(C===bs.DEFAULT?"ChromaDB backend does not support knowledge sources.":"Vector Search backend is not properly configured."),placement:"right",arrow:!0,children:(0,O.jsx)(he.A,{control:(0,O.jsx)(me.A,{checked:s.knowledge_volume_enabled||!1,onChange:e=>r(t=>(0,a.A)((0,a.A)({},t),{},{knowledge_volume_enabled:e.target.checked})),color:"secondary",disabled:!s.enabled||!w}),label:(0,O.jsxs)(o.A,{children:[(0,O.jsx)(c.A,{variant:"body1",color:w?"inherit":"text.disabled",children:n("configuration.databricks.knowledge.enable",{defaultValue:"Enable Knowledge Source Volume"})}),(0,O.jsx)(c.A,{variant:"caption",color:w?"text.secondary":"text.disabled",children:n("configuration.databricks.knowledge.enableDescription",{defaultValue:"Store and retrieve knowledge files from Databricks Volumes for RAG"})}),!w&&(0,O.jsx)(c.A,{variant:"caption",color:"warning.main",sx:{display:"block",mt:.5},children:"\u26a0\ufe0f Requires memory backend configuration (Vector Search or default ChromaDB)"})]})})}),(0,O.jsx)(V.A,{label:n("configuration.databricks.knowledge.path",{defaultValue:"Knowledge Volume Path"}),value:s.knowledge_volume_path||"main.default.knowledge",onChange:e=>r(t=>(0,a.A)((0,a.A)({},t),{},{knowledge_volume_path:e.target.value})),fullWidth:!0,disabled:l||!s.enabled||!s.knowledge_volume_enabled||!w,size:"small",helperText:n("configuration.databricks.knowledge.pathHelp",{defaultValue:"Format: catalog.schema.volume (e.g., main.default.knowledge)"}),placeholder:"catalog.schema.volume"}),(0,O.jsx)(V.A,{label:n("configuration.databricks.knowledge.chunkSize",{defaultValue:"Chunk Size"}),value:s.knowledge_chunk_size||1e3,onChange:e=>r(t=>(0,a.A)((0,a.A)({},t),{},{knowledge_chunk_size:parseInt(e.target.value)||1e3})),fullWidth:!0,disabled:l||!s.enabled||!s.knowledge_volume_enabled||!w,size:"small",type:"number",helperText:n("configuration.databricks.knowledge.chunkSizeHelp",{defaultValue:"Size of text chunks for knowledge processing (default: 1000 characters)"})}),(0,O.jsx)(V.A,{label:n("configuration.databricks.knowledge.chunkOverlap",{defaultValue:"Chunk Overlap"}),value:s.knowledge_chunk_overlap||200,onChange:e=>r(t=>(0,a.A)((0,a.A)({},t),{},{knowledge_chunk_overlap:parseInt(e.target.value)||200})),fullWidth:!0,disabled:l||!s.enabled||!s.knowledge_volume_enabled||!w,size:"small",type:"number",helperText:n("configuration.databricks.knowledge.chunkOverlapHelp",{defaultValue:"Overlap between chunks to maintain context (default: 200 characters)"})}),s.knowledge_volume_enabled&&s.enabled&&(0,O.jsxs)(_e.A,{elevation:0,sx:{p:2,bgcolor:"grey.50"},children:[(0,O.jsx)(c.A,{variant:"body2",sx:{mb:1},children:(0,O.jsx)("strong",{children:n("configuration.databricks.knowledge.structure",{defaultValue:"Knowledge files will be organized as:"})})}),(0,O.jsxs)(c.A,{variant:"body2",component:"code",sx:{display:"block",p:1,bgcolor:"white",border:"1px solid",borderColor:"grey.300",borderRadius:1,fontFamily:"monospace",fontSize:"0.875rem"},children:["/Volumes/",(s.knowledge_volume_path||"main.default.knowledge").replace(/\./g,"/"),"/[group_id]/[execution_id]/[files]"]}),(0,O.jsx)(c.A,{variant:"caption",color:"text.secondary",sx:{mt:1,display:"block"},children:n("configuration.databricks.knowledge.structureNote",{defaultValue:"Files are organized by group and execution ID for proper isolation and access control"})})]})]})]}),(0,O.jsxs)(o.A,{sx:{display:"flex",justifyContent:"space-between",mt:2,mb:2},children:[(0,O.jsx)(x.A,{variant:"outlined",startIcon:b?(0,O.jsx)(ue.A,{size:18}):null,onClick:async()=>{j(!0);try{const e=ke.O.getInstance(),t=await e.checkDatabricksConnection();A(t)}catch(e){f({open:!0,message:e instanceof Error?e.message:"Failed to check Databricks connection",severity:"error"})}finally{j(!1)}},disabled:b||!s.enabled,size:"medium",children:b?n("common.checking"):n("configuration.databricks.checkConnection",{defaultValue:"Check Connection"})}),(0,O.jsx)(x.A,{variant:"contained",startIcon:l?(0,O.jsx)(ue.A,{size:18}):(0,O.jsx)(io.A,{fontSize:"small"}),onClick:async()=>{if(s.enabled&&!s.apps_enabled){var e,a,i;const t={"Warehouse ID":null===(e=s.warehouse_id)||void 0===e?void 0:e.trim(),Catalog:null===(a=s.catalog)||void 0===a?void 0:a.trim(),Schema:null===(i=s.schema)||void 0===i?void 0:i.trim()},n=Object.entries(t).filter(e=>{let[t,n]=e;return!n}).map(e=>{let[t]=e;return t});if(n.length>0)return void f({open:!0,message:"Please fill in all required fields: ".concat(n.join(", ")),severity:"error"})}d(!0);try{const e=ke.O.getInstance(),a=await e.setDatabricksConfig(s);r(a);const i=36;try{const e=(await gt.m.listTools()).find(e=>e.id===i);if(e){const t=a.enabled&&a.knowledge_volume_enabled&&w;e.enabled!==t&&await gt.m.toggleToolEnabled(i)}}catch(o){}const{refreshConfiguration:l}=Cs.getState();if(l(),window.dispatchEvent(new CustomEvent("databricks-config-updated",{detail:{config:a}})),a.enabled){const t=await e.checkPersonalTokenRequired();p(t)}else p(null);f({open:!0,message:n("configuration.databricks.saved",{defaultValue:"Databricks configuration saved successfully"}),severity:"success"}),t&&t()}catch(l){f({open:!0,message:l instanceof Error?l.message:"Failed to save Databricks configuration",severity:"error"})}finally{d(!1)}},disabled:l,size:"medium",children:n(l?"common.loading":"common.save")})]}),v&&(0,O.jsx)(m.A,{severity:v.connected?"success":"error",sx:{mb:2},icon:v.connected?(0,O.jsx)(bo.A,{}):void 0,children:v.message}),(0,O.jsx)(h.A,{open:g.open,autoHideDuration:6e3,onClose:E,anchorOrigin:{vertical:"bottom",horizontal:"center"},children:(0,O.jsx)(m.A,{onClose:E,severity:g.severity,sx:{width:"100%"},children:g.message})})]})};var wo=n(23647);class ko{static async getEngineConfigs(){const e=await fetch("".concat(this.baseUrl),{method:"GET",headers:{"Content-Type":"application/json"}});if(!e.ok)throw new Error("Failed to fetch engine configurations: ".concat(e.statusText));return e.json()}static async getEnabledEngineConfigs(){const e=await fetch("".concat(this.baseUrl,"/enabled"),{method:"GET",headers:{"Content-Type":"application/json"}});if(!e.ok)throw new Error("Failed to fetch enabled engine configurations: ".concat(e.statusText));return e.json()}static async getEngineConfig(e){const t=await fetch("".concat(this.baseUrl,"/engine/").concat(e),{method:"GET",headers:{"Content-Type":"application/json"}});if(!t.ok)throw new Error("Failed to fetch engine configuration: ".concat(t.statusText));return t.json()}static async getEngineConfigByKey(e,t){const n=await fetch("".concat(this.baseUrl,"/engine/").concat(e,"/config/").concat(t),{method:"GET",headers:{"Content-Type":"application/json"}});if(!n.ok)throw new Error("Failed to fetch engine configuration: ".concat(n.statusText));return n.json()}static async getCrewAIFlowEnabled(){const e=await fetch("".concat(this.baseUrl,"/crewai/flow-enabled"),{method:"GET",headers:{"Content-Type":"application/json"}});if(!e.ok)throw new Error("Failed to fetch CrewAI flow status: ".concat(e.statusText));return e.json()}static async setCrewAIFlowEnabled(e){const t=await fetch("".concat(this.baseUrl,"/crewai/flow-enabled"),{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({flow_enabled:e})});if(!t.ok)throw new Error("Failed to update CrewAI flow status: ".concat(t.statusText));return t.json()}static async toggleEngineEnabled(e,t){const n=await fetch("".concat(this.baseUrl,"/engine/").concat(e,"/toggle"),{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({enabled:t})});if(!n.ok)throw new Error("Failed to toggle engine configuration: ".concat(n.statusText));return n.json()}static async updateConfigValue(e,t,n){const a=await fetch("".concat(this.baseUrl,"/engine/").concat(e,"/config/").concat(t,"/value"),{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({config_value:n})});if(!a.ok)throw new Error("Failed to update config value: ".concat(a.statusText));return a.json()}}ko.baseUrl="".concat(ye.$W.apiUrl,"/engine-config");const Co=()=>{const{crewAIFlowEnabled:e,setCrewAIFlowEnabled:t}=(0,S.d)(),{inputMode:n,setInputMode:a}=(0,b.E)(),[s,r]=(0,i.useState)(!1),[l,d]=(0,i.useState)(null),[u,h]=(0,i.useState)(!1);(0,i.useEffect)(()=>{(async()=>{try{r(!0);const e=await ko.getCrewAIFlowEnabled();t(e.flow_enabled)}catch(e){d("Failed to load configuration from server")}finally{r(!1)}})()},[t]);return s?(0,O.jsxs)(o.A,{sx:{display:"flex",justifyContent:"center",alignItems:"center",minHeight:200},children:[(0,O.jsx)(ue.A,{}),(0,O.jsx)(c.A,{variant:"body2",sx:{ml:2},children:"Loading engine configuration..."})]}):(0,O.jsxs)(o.A,{children:[(0,O.jsxs)(o.A,{sx:{display:"flex",alignItems:"center",mb:3},children:[(0,O.jsx)(eo.A,{sx:{mr:1,color:"primary.main",fontSize:"1.2rem"}}),(0,O.jsx)(c.A,{variant:"h6",fontWeight:"medium",children:"Engines Configuration"})]}),l&&(0,O.jsx)(m.A,{severity:"error",sx:{mb:3},children:l}),(0,O.jsx)(m.A,{severity:"info",sx:{mb:3},children:"Configure execution engines and their features. Disabling features will hide related UI components."}),(0,O.jsxs)(_e.A,{sx:{p:2,mb:2},elevation:1,children:[(0,O.jsxs)(o.A,{sx:{display:"flex",alignItems:"center",mb:2},children:[(0,O.jsx)(ps.A,{sx:{mr:1,color:"primary.main",fontSize:"1.1rem"}}),(0,O.jsx)(c.A,{variant:"subtitle1",fontWeight:"medium",children:"CrewAI Engine"})]}),(0,O.jsx)(te.A,{sx:{mb:2}}),(0,O.jsxs)(hs.A,{spacing:2,children:[(0,O.jsx)(o.A,{children:(0,O.jsx)(he.A,{control:(0,O.jsxs)(o.A,{sx:{display:"flex",alignItems:"center"},children:[(0,O.jsx)(me.A,{checked:e,onChange:async e=>{const n=e.target.checked;try{h(!0),d(null),await ko.setCrewAIFlowEnabled(n),t(n)}catch(a){d("Failed to save configuration to server"),e.target.checked=!n}finally{h(!1)}},color:"primary",disabled:u}),u&&(0,O.jsx)(ue.A,{size:16,sx:{ml:1}})]}),label:(0,O.jsxs)(o.A,{children:[(0,O.jsx)(c.A,{variant:"body2",fontWeight:"medium",children:"Enable Flow Feature"}),(0,O.jsx)(c.A,{variant:"caption",color:"text.secondary",children:"Toggle flow execution capabilities, flow panels, and flow-related UI components"})]})})}),!e&&(0,O.jsxs)(m.A,{severity:"warning",sx:{mt:1},children:["Flow feature is disabled. The following UI components will be hidden:",(0,O.jsxs)("ul",{style:{margin:"8px 0 0 16px",paddingLeft:"16px"},children:[(0,O.jsx)("li",{children:"Execute Flow button"}),(0,O.jsx)("li",{children:"Flow Panel"}),(0,O.jsx)("li",{children:"Add Flow button"})]})]})]})]}),(0,O.jsx)(_e.A,{elevation:1,sx:{p:3,mt:3},children:(0,O.jsxs)(hs.A,{spacing:2,children:[(0,O.jsxs)(o.A,{sx:{display:"flex",alignItems:"center",mb:2},children:[(0,O.jsx)(ps.A,{sx:{mr:1,color:"primary.main",fontSize:"1.2rem"}}),(0,O.jsx)(c.A,{variant:"subtitle1",fontWeight:"medium",children:"Input Variables Collection"})]}),(0,O.jsxs)(oe.A,{component:"fieldset",children:[(0,O.jsx)(Gt.A,{component:"legend",children:(0,O.jsx)(c.A,{variant:"body2",color:"text.secondary",sx:{mb:1},children:"Choose how to collect input variables when executing workflows with variables"})}),(0,O.jsxs)(Jt.A,{value:n,onChange:e=>a(e.target.value),children:[(0,O.jsx)(he.A,{value:"dialog",control:(0,O.jsx)(qt.A,{color:"primary"}),label:(0,O.jsxs)(o.A,{sx:{display:"flex",alignItems:"center"},children:[(0,O.jsx)(wo.A,{sx:{mr:1,fontSize:"1rem"}}),(0,O.jsxs)(o.A,{children:[(0,O.jsx)(c.A,{variant:"body2",fontWeight:"medium",children:"Dialog Mode"}),(0,O.jsx)(c.A,{variant:"caption",color:"text.secondary",children:"Show a popup dialog to collect all variable values before execution"})]})]})}),(0,O.jsx)(he.A,{value:"chat",control:(0,O.jsx)(qt.A,{color:"primary"}),label:(0,O.jsxs)(o.A,{sx:{display:"flex",alignItems:"center"},children:[(0,O.jsx)(xs.A,{sx:{mr:1,fontSize:"1rem"}}),(0,O.jsxs)(o.A,{children:[(0,O.jsx)(c.A,{variant:"body2",fontWeight:"medium",children:"Chat Mode"}),(0,O.jsx)(c.A,{variant:"caption",color:"text.secondary",children:"Collect variable values through conversational prompts in the chat (Coming Soon)"})]})]})})]})]}),(0,O.jsx)(m.A,{severity:"info",sx:{mt:2},children:"dialog"===n?"When variables are detected in your workflow, a dialog will appear to collect all values at once.":"When variables are detected, the chat will guide you through providing values one by one."})]})})]})},So=(0,j.vt)((e,t)=>({config:js,isLoading:!1,error:null,connectionTestResult:null,isTestingConnection:!1,availableIndexes:[],isLoadingIndexes:!1,validationErrors:[],visualizationOpen:!1,visualizationIndex:null,setConfig:t=>e({config:t,error:null}),updateConfig:t=>e(e=>({config:(0,a.A)((0,a.A)({},e.config),t),error:null})),updateDatabricksConfig:t=>e(e=>({config:(0,a.A)((0,a.A)({},e.config),{},{databricks_config:(0,a.A)((0,a.A)({},e.config.databricks_config||ws),t)}),error:null})),validateConfig:async()=>{const{config:n}=t();e({isLoading:!0,error:null,validationErrors:[]});try{const t=await ys.validateConfig(n);return e({validationErrors:t.errors||[],isLoading:!1}),t.valid}catch(a){const t=(a instanceof Error?a.message:String(a))||"Failed to validate configuration";return e({error:t,validationErrors:[t],isLoading:!1}),!1}},testDatabricksConnection:async()=>{const{config:n}=t();if(n.backend_type!==bs.DATABRICKS||!n.databricks_config){const t={success:!1,message:"Databricks configuration not set"};return e({connectionTestResult:t}),t}e({isTestingConnection:!0,connectionTestResult:null,error:null});try{const t=await ys.testDatabricksConnection(n.databricks_config);return e({connectionTestResult:t,isTestingConnection:!1}),t}catch(a){const t={success:!1,message:(a instanceof Error?a.message:String(a))||"Connection test failed"};return e({connectionTestResult:t,isTestingConnection:!1,error:t.message}),t}},loadAvailableIndexes:async()=>{var n;const{config:a}=t();if(a.backend_type===bs.DATABRICKS&&null!==(n=a.databricks_config)&&void 0!==n&&n.endpoint_name){e({isLoadingIndexes:!0,error:null});try{const t=await ys.getAvailableDatabricksIndexes(a.databricks_config.endpoint_name,a.databricks_config);e({availableIndexes:t.indexes,isLoadingIndexes:!1})}catch(s){e({error:(s instanceof Error?s.message:String(s))||"Failed to load indexes",availableIndexes:[],isLoadingIndexes:!1})}}},saveConfig:async()=>{const{config:n,validateConfig:a}=t();if(!await a())return!1;e({isLoading:!0,error:null});try{const t=await ys.saveConfig(n);return e({isLoading:!1}),t.success}catch(s){return e({error:(s instanceof Error?s.message:String(s))||"Failed to save configuration",isLoading:!1}),!1}},loadConfig:async()=>{e({isLoading:!0,error:null});try{const t=await ys.getConfig();e(t?{config:t,isLoading:!1}:{isLoading:!1})}catch(t){e({error:(t instanceof Error?t.message:String(t))||"Failed to load configuration",isLoading:!1})}},openVisualization:(t,n)=>e({visualizationOpen:!0,visualizationIndex:{name:t,type:n}}),closeVisualization:()=>e({visualizationOpen:!1,visualizationIndex:null}),resetConfig:()=>e({config:js,error:null,connectionTestResult:null,validationErrors:[],availableIndexes:[],visualizationOpen:!1,visualizationIndex:null}),clearError:()=>e({error:null}),setError:t=>e({error:t})}));var _o=n(21584),Eo=n(61713),Io=n(52325),To=n(95050),Do=n(35834);const No=class{static async performOneClickSetup(e){return(await ye.uE.post("/memory-backend/databricks/one-click-setup",e)).data}static async deleteAllConfigurations(){const e=await ye.uE.get("/memory-backend/configs");for(const t of e.data||[])await ye.uE.delete("/memory-backend/configs/".concat(t.id))}static async cleanupDisabledConfigurations(){try{await ye.uE.delete("/memory-backend/configs/disabled/cleanup")}catch(e){}}static async switchToDisabledMode(){return await ye.uE.post("/memory-backend/configs/switch-to-disabled")}static async updateBackendConfiguration(e,t){return(await ye.uE.put("/memory-backend/configs/".concat(e),t)).data}static async verifyResources(e,t){return(await ye.uE.get("/memory-backend/databricks/verify-resources",{params:{workspace_url:e,backend_id:t}})).data}static async deleteIndex(e){return(await ye.uE.delete("/memory-backend/databricks/index",{data:e})).data}static async getIndexInfo(e,t,n){return(await ye.uE.get("/memory-backend/databricks/index-info",{params:{workspace_url:e,index_name:t,endpoint_name:n}})).data}static async emptyIndex(e){return(await ye.uE.post("/memory-backend/databricks/empty-index",e)).data}static async reseedDocumentation(e){return(await ye.uE.post("/memory-backend/databricks/reseed-documentation",{workspace_url:e})).data}static async deleteEndpoint(e){return(await ye.uE.delete("/memory-backend/databricks/endpoint",{data:e})).data}static async saveManualConfiguration(e,t){return t?await ye.uE.put("/memory-backend/configs/".concat(t),e):await ye.uE.post("/memory-backend/configs",e)}},Po=[{name:"Databricks BGE Large (English)",value:"databricks-bge-large-en",dimension:1024,description:"High quality embeddings optimized for English text"},{name:"Databricks GTE Large (English)",value:"databricks-gte-large-en",dimension:768,description:"General purpose embeddings for English text"},{name:"OpenAI text-embedding-3-small",value:"text-embedding-3-small",dimension:1536,description:"Cost-effective OpenAI embeddings"}],Mo={short_term:{brief:"Recent agent interactions",detailed:"The short-term memory index stores recent conversations and interactions between agents during task execution. It captures immediate context, task progress, decisions made, and intermediate results. This memory is typically retained for the duration of a crew's execution and helps agents maintain context awareness, avoid repeating actions, and build upon previous exchanges. It's essential for coherent multi-agent collaboration within a single session."},long_term:{brief:"Persistent knowledge across sessions",detailed:"The long-term memory index preserves important information, learned patterns, and key insights across multiple crew executions. It stores successful strategies, common solutions, domain knowledge, and historical outcomes that agents can reference in future tasks. This persistent memory enables agents to improve over time, apply lessons learned, and maintain institutional knowledge. It's crucial for building intelligent systems that evolve and adapt based on accumulated experience."},entity:{brief:"Information about entities and relationships",detailed:"The entity memory index maintains a knowledge graph of entities, their attributes, and relationships discovered during agent operations. It stores information about people, organizations, systems, concepts, and their interconnections. This structured memory helps agents understand context, make informed decisions based on entity relationships, and maintain consistency when referring to specific entities across different tasks. It's vital for complex scenarios involving multiple stakeholders or domain-specific entities."},document:{brief:"Uploaded documents and embeddings",detailed:"The document index stores embeddings of uploaded documents, files, and reference materials that agents can search and retrieve during task execution. It includes technical documentation, policies, guidelines, knowledge bases, and any other textual content provided to the system. This semantic search capability allows agents to find relevant information quickly, answer questions based on documented knowledge, and ground their responses in authoritative sources. It's essential for RAG (Retrieval Augmented Generation) workflows."}},zo=(e,t)=>{const n=e.match(/\?o=(\d+)/),a=n?n[1]:"",s=e.replace(/\?o=\d+/,""),i=s.endsWith("/")?s.slice(0,-1):s;return"".concat(i,"/compute/vector-search/").concat(t).concat(a?"?o=".concat(a):"")},Oo=(e,t)=>{const n=e.match(/\?o=(\d+)/),a=n?n[1]:"",s=e.replace(/\?o=\d+/,""),i=s.endsWith("/")?s.slice(0,-1):s,o=t.split(".");if(o.length>=3){const e=o[0],t=o[1],n=o.slice(2).join(".");return"".concat(i,"/explore/data/").concat(e,"/").concat(t,"/").concat(n).concat(a?"?o=".concat(a):"")}return"".concat(i,"/explore/data").concat(a?"?o=".concat(a):"")},Lo=e=>{const t=e.split(".");return t.length>=3&&t.every(e=>e.length>0)},Fo=(e,t)=>!(null===e||void 0===e||!e.indexes)&&("memory"===t?!!(e.indexes.short_term||e.indexes.long_term||e.indexes.entity):!!e.indexes.document),Wo=e=>{let{open:t,onClose:n,setupResult:a,workspaceUrl:s,savedConfigWorkspaceUrl:i}=e;const u=e=>{const t=(e=>"created"===e||"already_exists"===e?"success":"error")(e);return"success"===t?(0,O.jsx)(oi.A,{color:"success"}):(0,O.jsx)(ri.A,{color:"error"})},h=()=>s||i||"";return(0,O.jsxs)(r.A,{open:t,onClose:n,maxWidth:"sm",fullWidth:!0,children:[(0,O.jsx)(d.A,{children:null!==a&&void 0!==a&&a.success?"Setup Complete!":"Setup Failed"}),(0,O.jsx)(l.A,{children:a&&(0,O.jsxs)(o.A,{children:[(0,O.jsx)(m.A,{severity:a.success?"success":"error",sx:{mb:2},children:a.message}),a.warning&&(0,O.jsx)(m.A,{severity:"warning",sx:{mb:2},children:a.warning}),a.info&&(0,O.jsx)(m.A,{severity:"info",sx:{mb:2},children:a.info}),a.endpoints&&(0,O.jsxs)(o.A,{sx:{mb:3},children:[(0,O.jsx)(c.A,{variant:"subtitle2",sx:{mb:1},children:"Endpoints Created:"}),(0,O.jsxs)(at.A,{dense:!0,children:[a.endpoints.memory&&(0,O.jsxs)(st.Ay,{children:[(0,O.jsx)(it.A,{children:u(a.endpoints.memory.status)}),(0,O.jsx)(ot.A,{primary:(0,O.jsx)(Gs.A,{href:zo(h(),a.endpoints.memory.name),target:"_blank",rel:"noopener noreferrer",children:a.endpoints.memory.name}),secondary:"Memory Endpoint (Direct Access)"})]}),a.endpoints.document&&(0,O.jsxs)(st.Ay,{children:[(0,O.jsx)(it.A,{children:u(a.endpoints.document.status)}),(0,O.jsx)(ot.A,{primary:(0,O.jsx)(Gs.A,{href:zo(h(),a.endpoints.document.name),target:"_blank",rel:"noopener noreferrer",children:a.endpoints.document.name}),secondary:"Document Endpoint (Direct Access)"})]})]})]}),a.indexes&&(0,O.jsxs)(o.A,{children:[(0,O.jsx)(c.A,{variant:"subtitle2",sx:{mb:1},children:"Indexes Created:"}),(0,O.jsxs)(at.A,{dense:!0,children:[a.indexes.short_term&&(0,O.jsxs)(st.Ay,{children:[(0,O.jsx)(it.A,{children:u(a.indexes.short_term.status)}),(0,O.jsx)(ot.A,{primary:(0,O.jsx)(Gs.A,{href:Oo(h(),a.indexes.short_term.name),target:"_blank",rel:"noopener noreferrer",children:a.indexes.short_term.name}),secondary:"Short-term Memory Index"})]}),a.indexes.long_term&&(0,O.jsxs)(st.Ay,{children:[(0,O.jsx)(it.A,{children:u(a.indexes.long_term.status)}),(0,O.jsx)(ot.A,{primary:(0,O.jsx)(Gs.A,{href:Oo(h(),a.indexes.long_term.name),target:"_blank",rel:"noopener noreferrer",children:a.indexes.long_term.name}),secondary:"Long-term Memory Index"})]}),a.indexes.entity&&(0,O.jsxs)(st.Ay,{children:[(0,O.jsx)(it.A,{children:u(a.indexes.entity.status)}),(0,O.jsx)(ot.A,{primary:(0,O.jsx)(Gs.A,{href:Oo(h(),a.indexes.entity.name),target:"_blank",rel:"noopener noreferrer",children:a.indexes.entity.name}),secondary:"Entity Memory Index"})]}),a.indexes.document&&(0,O.jsxs)(st.Ay,{children:[(0,O.jsx)(it.A,{children:u(a.indexes.document.status)}),(0,O.jsx)(ot.A,{primary:(0,O.jsx)(Gs.A,{href:Oo(h(),a.indexes.document.name),target:"_blank",rel:"noopener noreferrer",children:a.indexes.document.name}),secondary:"Document Embeddings Index"})]})]})]})]})}),(0,O.jsx)(B.A,{children:(0,O.jsx)(x.A,{onClick:n,children:"Close"})})]})};var Ro=n(89299),Vo=n(58629),Bo=n(29240),Uo=n(46321);const Ho=e=>{let{title:t,subtitle:n,savedConfig:a,endpointName:s,endpointType:i,indexes:r,indexInfoMap:l,endpointStatuses:d,isSettingUp:h,onRefresh:m,onEmpty:p,onDelete:x,onVisualize:g,onViewDocuments:f,showEndpointLink:v=!0}=e;const A=e=>{const t=l[e];return t?t.loading?(0,O.jsx)(ue.A,{size:16}):(0,O.jsx)(c.A,{variant:"body2",sx:{fontSize:"0.875rem",color:"DELETED"===t.index_type?"error.main":"inherit"},children:"DELETED"===t.index_type?"NOT FOUND":t.index_type||"UNKNOWN"}):"UNKNOWN"},y=e=>{const t=l[e];return!t||t.loading?(0,O.jsx)(ue.A,{size:16}):t.doc_count||0},b=e=>{const t=l[e],n=d[i];return h||!1===(null===n||void 0===n?void 0:n.can_delete_indexes)||"DELETED"===(null===t||void 0===t?void 0:t.index_type)};return(0,O.jsxs)(o.A,{sx:{mb:4,backgroundColor:"transparent"},children:[(0,O.jsxs)(o.A,{sx:{display:"flex",alignItems:"center",mb:2},children:[(0,O.jsx)(c.A,{variant:"subtitle1",sx:{fontWeight:"medium"},children:t}),n&&(0,O.jsx)(P.A,{title:n,placement:"top",arrow:!0,children:(0,O.jsx)(u.A,{size:"small",sx:{ml:1,p:.5},children:(0,O.jsx)(Ro.A,{fontSize:"small",sx:{fontSize:18}})})})]}),v&&s&&(0,O.jsxs)(c.A,{variant:"body2",color:"text.secondary",sx:{mb:2},children:["Endpoint:",(0,O.jsx)(Gs.A,{href:zo(a.workspace_url||"",s),target:"_blank",rel:"noopener noreferrer",sx:{ml:1},children:s})]}),(0,O.jsx)(Pi.A,{component:_e.A,variant:"outlined",sx:{backgroundColor:"#fff"},children:(0,O.jsxs)(Mi.A,{size:"small",sx:{minWidth:650,backgroundColor:"#fff"},children:[(0,O.jsx)(zi.A,{sx:{backgroundColor:"#f5f5f5"},children:(0,O.jsxs)(Oi.A,{children:[(0,O.jsx)(Li.A,{sx:{width:"25%"},children:"Name"}),(0,O.jsx)(Li.A,{align:"center",sx:{width:"10%"},children:"Type"}),(0,O.jsx)(Li.A,{align:"center",sx:{width:"10%"},children:"Documents"}),(0,O.jsx)(Li.A,{sx:{width:"35%"},children:"Description"}),(0,O.jsx)(Li.A,{align:"center",sx:{width:"20%"},children:"Actions"})]})}),(0,O.jsx)(Fi.A,{children:r.map(e=>{let{type:t,name:n}=e;if(!n)return null;const s=Mo[t]||{brief:"",detailed:""};return(0,O.jsxs)(Oi.A,{sx:{backgroundColor:"#fff","&:hover":{backgroundColor:"#fafafa"}},children:[(0,O.jsx)(Li.A,{children:(0,O.jsx)(Gs.A,{href:Oo(a.workspace_url||"",n),target:"_blank",rel:"noopener noreferrer",sx:{fontSize:"0.875rem"},children:n.split(".").pop()})}),(0,O.jsx)(Li.A,{align:"center",children:A(n)}),(0,O.jsx)(Li.A,{align:"center",children:y(n)}),(0,O.jsx)(Li.A,{children:(0,O.jsxs)(o.A,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[(0,O.jsx)(c.A,{variant:"body2",sx:{fontSize:"0.875rem",flex:1},children:s.brief}),(0,O.jsx)(P.A,{title:s.detailed,placement:"top",arrow:!0,sx:{maxWidth:400},children:(0,O.jsx)(u.A,{size:"small",sx:{p:.5,ml:1},children:(0,O.jsx)(Ro.A,{fontSize:"small",sx:{fontSize:16}})})})]})}),(0,O.jsx)(Li.A,{align:"center",children:(0,O.jsxs)(o.A,{sx:{display:"flex",alignItems:"center",justifyContent:"center",gap:.5},children:[f?(0,O.jsx)(P.A,{title:"View Documents",children:(0,O.jsx)(u.A,{size:"small",onClick:()=>f(t,n),disabled:h,children:(0,O.jsx)(Vo.A,{fontSize:"small"})})}):(0,O.jsx)(o.A,{sx:{width:32}}),"entity"===t&&g?(0,O.jsx)(P.A,{title:"Visualize Entity Graph",children:(0,O.jsx)(u.A,{size:"small",onClick:()=>g(t,n),disabled:h,children:(0,O.jsx)(Dn.A,{fontSize:"small"})})}):"document"===t&&m?(0,O.jsx)(P.A,{title:"Re-seed Documentation",children:(0,O.jsx)(u.A,{size:"small",onClick:m,disabled:h,children:(0,O.jsx)(Bo.A,{fontSize:"small"})})}):(0,O.jsx)(o.A,{sx:{width:32}}),(0,O.jsx)(P.A,{title:"Reset Index (Delete & Recreate)",children:(0,O.jsx)(u.A,{size:"small",onClick:()=>p(t),disabled:h,children:(0,O.jsx)(Uo.A,{fontSize:"small"})})}),(0,O.jsx)(P.A,{title:"Delete Index",children:(0,O.jsx)(u.A,{size:"small",onClick:()=>x(t),disabled:b(n),children:(0,O.jsx)(li.A,{fontSize:"small"})})})]})})]},t)})})]})})]})};var Ko=n(49885);const Go=e=>{var t;let{savedConfig:n,isEditingConfig:a,isSettingUp:s,onStartEdit:i,onSaveEdit:r,onCancelEdit:l,onRefresh:d,children:u}=e;return(0,O.jsxs)(o.A,{sx:{mt:2,p:2,bgcolor:"#ffffff",borderRadius:2,border:"1px solid",borderColor:"#e0e0e0"},children:[(0,O.jsxs)(o.A,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",mb:1},children:[(0,O.jsxs)(o.A,{sx:{display:"flex",alignItems:"center"},children:[(0,O.jsx)(oi.A,{sx:{mr:.5,color:"success.main",fontSize:18}}),(0,O.jsx)(c.A,{variant:"subtitle2",color:"success.main",children:"Active Configuration"})]}),(0,O.jsxs)(o.A,{sx:{display:"flex",gap:.5},children:[!a&&(0,O.jsxs)(O.Fragment,{children:[(0,O.jsx)(x.A,{size:"small",startIcon:(0,O.jsx)(Za.A,{}),onClick:i,disabled:s,sx:{minWidth:"auto",py:.5},children:"Edit"}),(0,O.jsx)(x.A,{size:"small",startIcon:(0,O.jsx)(Bo.A,{}),onClick:d,disabled:s,sx:{minWidth:"auto",py:.5},children:"Refresh"})]}),a&&(0,O.jsxs)(O.Fragment,{children:[(0,O.jsx)(x.A,{size:"small",startIcon:(0,O.jsx)(Wn.A,{}),onClick:r,disabled:s,sx:{minWidth:"auto",py:.5},color:"primary",children:"Save"}),(0,O.jsx)(x.A,{size:"small",startIcon:(0,O.jsx)(Ko.A,{}),onClick:l,disabled:s,sx:{minWidth:"auto",py:.5},children:"Cancel"})]})]})]}),(0,O.jsxs)(o.A,{sx:{display:"flex",gap:1,mb:1,flexWrap:"wrap"},children:[(0,O.jsx)(R.A,{size:"small",label:"Workspace: ".concat(null===(t=n.workspace_url)||void 0===t?void 0:t.replace("https://","").split("?")[0])}),(0,O.jsx)(R.A,{size:"small",label:"Catalog: ".concat(n.catalog)}),(0,O.jsx)(R.A,{size:"small",label:"Schema: ".concat(n.schema)})]}),a&&(0,O.jsx)(m.A,{severity:"info",sx:{mb:1},children:"Enter the names of your existing Databricks Vector Search endpoints and indexes. Leave empty to remove."}),u]})},Jo=e=>{let{manualConfig:t,isSettingUp:n,error:s,onConfigChange:i,onSave:r}=e;const l=e=>n=>{i((0,a.A)((0,a.A)({},t),{},{[e]:n.target.value}))},d=e=>""!==e&&!Lo(e);return(0,O.jsxs)(o.A,{children:[(0,O.jsxs)(m.A,{severity:"info",sx:{mb:3},children:[(0,O.jsx)(c.A,{variant:"body2",sx:{mb:1},children:"Enter your existing Databricks Vector Search configuration. This will connect to your existing endpoints and indexes."}),(0,O.jsxs)(c.A,{variant:"body2",children:[(0,O.jsx)("strong",{children:"Format for indexes:"})," catalog.schema.index_name (e.g., ml.agents.short_term_memory)"]})]}),s&&(0,O.jsx)(m.A,{severity:"error",sx:{mb:2},children:s}),(0,O.jsxs)(o.A,{sx:{display:"flex",flexDirection:"column",gap:2},children:[(0,O.jsx)(V.A,{fullWidth:!0,label:"Databricks Workspace URL",value:t.workspace_url,onChange:l("workspace_url"),placeholder:"https://your-workspace.databricks.com",required:!0,disabled:n}),(0,O.jsx)(c.A,{variant:"subtitle2",sx:{mt:2},children:"Vector Search Endpoints"}),(0,O.jsx)(V.A,{fullWidth:!0,label:"Memory Endpoint Name",value:t.endpoint_name,onChange:l("endpoint_name"),placeholder:"kasal_memory_endpoint",required:!0,disabled:n}),(0,O.jsx)(V.A,{fullWidth:!0,label:"Document Endpoint Name",value:t.document_endpoint_name,onChange:l("document_endpoint_name"),placeholder:"kasal_docs_endpoint",required:!0,disabled:n}),(0,O.jsxs)(oe.A,{fullWidth:!0,children:[(0,O.jsx)(re.A,{children:"Embedding Model"}),(0,O.jsx)(le.A,{value:t.embedding_model,onChange:e=>l("embedding_model")(e),label:"Embedding Model",disabled:n,children:Po.map(e=>(0,O.jsxs)(de.A,{value:e.value,children:[e.name," (",e.dimension," dimensions)"]},e.value))})]}),(0,O.jsx)(c.A,{variant:"subtitle2",sx:{mt:2},children:"Memory Indexes (catalog.schema.index_name)"}),(0,O.jsx)(V.A,{fullWidth:!0,label:"Short-term Memory Index",value:t.short_term_index,onChange:l("short_term_index"),placeholder:"ml.agents.short_term_memory",required:!0,error:d(t.short_term_index),helperText:d(t.short_term_index)?"Invalid format. Use: catalog.schema.index_name":"",disabled:n}),(0,O.jsx)(V.A,{fullWidth:!0,label:"Long-term Memory Index",value:t.long_term_index,onChange:l("long_term_index"),placeholder:"ml.agents.long_term_memory",required:!0,error:d(t.long_term_index),helperText:d(t.long_term_index)?"Invalid format. Use: catalog.schema.index_name":"",disabled:n}),(0,O.jsx)(V.A,{fullWidth:!0,label:"Entity Memory Index",value:t.entity_index,onChange:l("entity_index"),placeholder:"ml.agents.entity_memory",required:!0,error:d(t.entity_index),helperText:d(t.entity_index)?"Invalid format. Use: catalog.schema.index_name":"",disabled:n}),(0,O.jsx)(V.A,{fullWidth:!0,label:"Document Embeddings Index",value:t.document_index,onChange:l("document_index"),placeholder:"ml.agents.document_embeddings",required:!0,error:d(t.document_index),helperText:d(t.document_index)?"Invalid format. Use: catalog.schema.index_name":"",disabled:n}),(0,O.jsx)(x.A,{variant:"contained",color:"primary",startIcon:n?(0,O.jsx)(ue.A,{size:20}):(0,O.jsx)(Wn.A,{}),onClick:r,disabled:n||!t.workspace_url||!t.endpoint_name||!t.document_endpoint_name||!t.short_term_index||!t.long_term_index||!t.entity_index||!t.document_index||d(t.short_term_index)||d(t.long_term_index)||d(t.entity_index)||d(t.document_index),sx:{mt:3},fullWidth:!0,children:n?"Saving Configuration...":"Save Configuration"})]})]})},qo=e=>{let{detectedWorkspaceUrl:t,catalog:n,schema:a,embeddingModel:s,isSettingUp:i,error:r,onCatalogChange:l,onSchemaChange:d,onEmbeddingModelChange:u,onSetup:h}=e;return(0,O.jsxs)(o.A,{children:[(0,O.jsxs)(m.A,{severity:"info",sx:{mb:3},children:[(0,O.jsx)(c.A,{variant:"body2",sx:{mb:1},children:(0,O.jsx)("strong",{children:"One-click setup will automatically:"})}),(0,O.jsxs)(c.A,{variant:"body2",component:"ul",sx:{m:0,pl:2},children:[(0,O.jsx)("li",{children:"Create two Vector Search endpoints (one for memory, one for documents)"}),(0,O.jsx)("li",{children:"Create four indexes (short-term, long-term, entity memory, and documents)"}),(0,O.jsx)("li",{children:"Configure optimal settings for agent memory persistence"}),(0,O.jsx)("li",{children:"Enable Databricks as the default memory backend"})]})]}),t&&(0,O.jsxs)(m.A,{severity:"success",sx:{mb:2},children:["Workspace detected: ",t]}),!t&&(0,O.jsx)(m.A,{severity:"warning",sx:{mb:2},children:"No Databricks workspace detected. Please set DATABRICKS_HOST environment variable."}),r&&(0,O.jsx)(m.A,{severity:"error",sx:{mb:2},children:r}),(0,O.jsxs)(o.A,{sx:{display:"flex",flexDirection:"column",gap:2},children:[(0,O.jsxs)(ce.Ay,{container:!0,spacing:2,children:[(0,O.jsx)(ce.Ay,{item:!0,xs:6,children:(0,O.jsx)(V.A,{fullWidth:!0,label:"Catalog",value:n,onChange:e=>l(e.target.value),placeholder:"ml",required:!0,disabled:i,helperText:"Unity Catalog name for indexes"})}),(0,O.jsx)(ce.Ay,{item:!0,xs:6,children:(0,O.jsx)(V.A,{fullWidth:!0,label:"Schema",value:a,onChange:e=>d(e.target.value),placeholder:"agents",required:!0,disabled:i,helperText:"Schema name for indexes"})})]}),(0,O.jsxs)(oe.A,{fullWidth:!0,children:[(0,O.jsx)(re.A,{children:"Embedding Model"}),(0,O.jsx)(le.A,{value:s,onChange:e=>u(e.target.value),label:"Embedding Model",disabled:i,children:Po.map(e=>(0,O.jsxs)(de.A,{value:e.value,children:[e.name," (",e.dimension," dimensions)"]},e.value))}),(0,O.jsx)(c.A,{variant:"caption",color:"text.secondary",sx:{mt:1},children:"Choose the embedding model for document and memory vectorization"})]}),(0,O.jsx)(m.A,{severity:"warning",sx:{mt:2},children:(0,O.jsxs)(c.A,{variant:"body2",children:[(0,O.jsx)("strong",{children:"Important:"})," This will create resources in your Databricks workspace. Ensure you have the necessary permissions to create endpoints and indexes."]})}),(0,O.jsx)(x.A,{variant:"contained",color:"primary",size:"large",startIcon:i?(0,O.jsx)(ue.A,{size:20}):(0,O.jsx)(Eo.A,{}),onClick:h,disabled:!t||!n||!a||i,fullWidth:!0,sx:{mt:3,py:1.5},children:i?"Setting up Databricks Vector Search...":"Setup Databricks Vector Search"})]})]})},Yo=e=>{var t,n,a,s,i,r;let{editedConfig:l,onEditChange:d}=e;return(0,O.jsxs)(o.A,{children:[(0,O.jsxs)(o.A,{sx:{mb:1.5},children:[(0,O.jsx)(c.A,{variant:"caption",color:"text.secondary",sx:{display:"block",mb:.5},children:"Endpoints:"}),(0,O.jsxs)(o.A,{sx:{display:"flex",gap:.5,flexWrap:"wrap",alignItems:"center"},children:[(0,O.jsx)(V.A,{size:"small",label:"Memory Endpoint",value:(null===l||void 0===l||null===(t=l.endpoints)||void 0===t||null===(t=t.memory)||void 0===t?void 0:t.name)||"",onChange:e=>d("endpoints.memory.name",e.target.value||void 0),placeholder:"kasal_memory_endpoint",sx:{width:250}}),(0,O.jsx)(V.A,{size:"small",label:"Document Endpoint",value:(null===l||void 0===l||null===(n=l.endpoints)||void 0===n||null===(n=n.document)||void 0===n?void 0:n.name)||"",onChange:e=>d("endpoints.document.name",e.target.value||void 0),placeholder:"kasal_docs_endpoint",sx:{width:250}})]})]}),(0,O.jsxs)(o.A,{children:[(0,O.jsx)(c.A,{variant:"caption",color:"text.secondary",sx:{display:"block",mb:.5},children:"Indexes:"}),(0,O.jsxs)(ce.Ay,{container:!0,spacing:1,children:[(0,O.jsx)(ce.Ay,{item:!0,xs:12,sm:6,children:(0,O.jsx)(V.A,{size:"small",label:"Short-term Index",value:(null===l||void 0===l||null===(a=l.indexes)||void 0===a||null===(a=a.short_term)||void 0===a?void 0:a.name)||"",onChange:e=>d("indexes.short_term.name",e.target.value||void 0),placeholder:"catalog.schema.short_term_memory",fullWidth:!0})}),(0,O.jsx)(ce.Ay,{item:!0,xs:12,sm:6,children:(0,O.jsx)(V.A,{size:"small",label:"Long-term Index",value:(null===l||void 0===l||null===(s=l.indexes)||void 0===s||null===(s=s.long_term)||void 0===s?void 0:s.name)||"",onChange:e=>d("indexes.long_term.name",e.target.value||void 0),placeholder:"catalog.schema.long_term_memory",fullWidth:!0})}),(0,O.jsx)(ce.Ay,{item:!0,xs:12,sm:6,children:(0,O.jsx)(V.A,{size:"small",label:"Entity Index",value:(null===l||void 0===l||null===(i=l.indexes)||void 0===i||null===(i=i.entity)||void 0===i?void 0:i.name)||"",onChange:e=>d("indexes.entity.name",e.target.value||void 0),placeholder:"catalog.schema.entity_memory",fullWidth:!0})}),(0,O.jsx)(ce.Ay,{item:!0,xs:12,sm:6,children:(0,O.jsx)(V.A,{size:"small",label:"Document Index",value:(null===l||void 0===l||null===(r=l.indexes)||void 0===r||null===(r=r.document)||void 0===r?void 0:r.name)||"",onChange:e=>d("indexes.document.name",e.target.value||void 0),placeholder:"catalog.schema.document_embeddings",fullWidth:!0})})]})]})]})};var Xo=n(99530);const Zo=e=>{var t,n,a,s,i,r,l,d,u,h,m,p;let{savedConfig:x,endpointStatuses:g,onDeleteEndpoint:f}=e;return(0,O.jsxs)(o.A,{sx:{mb:1.5},children:[(0,O.jsx)(c.A,{variant:"caption",color:"text.secondary",sx:{display:"block",mb:.5},children:"Endpoints:"}),(0,O.jsxs)(o.A,{sx:{display:"flex",gap:.5,flexWrap:"wrap",alignItems:"center"},children:[(null===(t=x.endpoints)||void 0===t?void 0:t.memory)&&(0,O.jsx)(R.A,{size:"small",label:"Memory Endpoint".concat(null!==(n=g.memory)&&void 0!==n&&n.state?" (".concat(g.memory.state,")"):""),clickable:!0,icon:(0,O.jsx)(_o.A,{}),color:"ONLINE"===(null===(a=g.memory)||void 0===a?void 0:a.state)?"success":"PROVISIONING"===(null===(s=g.memory)||void 0===s?void 0:s.state)?"warning":"NOT_FOUND"===(null===(i=g.memory)||void 0===i?void 0:i.state)?"error":"default",onClick:()=>{var e;return window.open(zo(x.workspace_url||"",(null===(e=x.endpoints)||void 0===e||null===(e=e.memory)||void 0===e?void 0:e.name)||""),"_blank")},onDelete:Fo(x,"memory")&&"NOT_FOUND"!==(null===(r=g.memory)||void 0===r?void 0:r.state)?void 0:()=>f("memory"),deleteIcon:(0,O.jsx)(li.A,{})}),(null===(l=x.endpoints)||void 0===l?void 0:l.document)&&(0,O.jsx)(R.A,{size:"small",label:"Document Endpoint".concat(null!==(d=g.document)&&void 0!==d&&d.state?" (".concat(g.document.state,")"):""),clickable:!0,icon:(0,O.jsx)(Xo.A,{}),color:"ONLINE"===(null===(u=g.document)||void 0===u?void 0:u.state)?"success":"PROVISIONING"===(null===(h=g.document)||void 0===h?void 0:h.state)?"warning":"NOT_FOUND"===(null===(m=g.document)||void 0===m?void 0:m.state)?"error":"default",onClick:()=>{var e;return window.open(zo(x.workspace_url||"",(null===(e=x.endpoints)||void 0===e||null===(e=e.document)||void 0===e?void 0:e.name)||""),"_blank")},onDelete:Fo(x,"document")&&"NOT_FOUND"!==(null===(p=g.document)||void 0===p?void 0:p.state)?void 0:()=>f("document"),deleteIcon:(0,O.jsx)(li.A,{})})]})]})};var Qo=n(16666),$o=n(958),er=n(10877);const tr=(0,j.vt)((e,t)=>({graphInstance:null,graphData:{nodes:[],links:[]},filteredGraphData:{nodes:[],links:[]},loading:!1,error:null,focusedNodeId:null,selectedNode:null,showInferredNodes:!0,deduplicateNodes:!1,showOrphanedNodes:!1,forceStrength:-300,linkDistance:100,linkCurvature:0,centerForce:.3,initializeGraph:n=>{const a=t();a.graphInstance&&a.cleanupGraph();try{var s,i,o,r;const l=(0,Qo.A)()(n).backgroundColor("#fafafa").nodeId("id").nodeLabel(e=>'\n          <div style="background: rgba(0,0,0,0.8); color: white; padding: 8px; border-radius: 4px; max-width: 200px;">\n            <div style="font-weight: bold; margin-bottom: 4px;">'.concat(e.name,'</div>\n            <div style="font-size: 12px; color: #ccc; margin-bottom: 4px;">Type: ').concat(e.type,"</div>\n            ").concat(Object.entries(e.attributes||{}).length>0?'<div style="font-size: 11px;">'+Object.entries(e.attributes||{}).slice(0,3).map(e=>{let[t,n]=e;return"".concat(t,": ").concat(String(n))}).join("<br/>")+"</div>":"","\n          </div>\n        ")).nodeCanvasObject((e,t,n)=>{var a,s;const i=e.size||5,o=null!==(a=e.x)&&void 0!==a?a:0,r=null!==(s=e.y)&&void 0!==s?s:0;t.beginPath(),t.arc(o,r,i,0,2*Math.PI,!1),t.fillStyle=e.color||"#999",t.fill(),t.strokeStyle="rgba(0,0,0,0.3)",t.lineWidth=2,t.stroke();const l=e.name||e.id||"Unknown";t.font="bold ".concat(14,"px Arial"),t.textAlign="center",t.textBaseline="top";const d=t.measureText(l).width,c=r+i+3;t.fillStyle="rgba(255, 255, 255, 0.95)",t.fillRect(o-(d+4)/2,c,d+4,16.8),t.strokeStyle="rgba(0,0,0,0.1)",t.lineWidth=1,t.strokeRect(o-(d+4)/2,c,d+4,16.8),t.fillStyle="#333",t.fillText(l,o,c+2)}).linkWidth(2).linkColor(()=>"rgba(100, 100, 100, 0.4)").linkDirectionalArrowLength(6).linkDirectionalArrowRelPos(1).linkCurvature(a.linkCurvature).onNodeClick(t=>{e({selectedNode:t})}).onBackgroundClick(()=>{e({selectedNode:null,focusedNodeId:null})});null===(s=l.d3Force("charge"))||void 0===s||s.strength(a.forceStrength),null===(i=l.d3Force("link"))||void 0===i||i.distance(a.linkDistance),null===(o=l.d3Force("center"))||void 0===o||o.strength(a.centerForce),null===(r=l.d3Force("collide"))||void 0===r||r.radius(25).strength(1.2);const d=n.offsetWidth,c=n.offsetHeight,u=d/2,h=c/2;a.centerForce<.3?(l.d3Force("x",null),l.d3Force("y",null)):a.centerForce<.7?(l.d3Force("x",$o.A(u).strength(.1)),l.d3Force("y",er.A(h).strength(.1))):(l.d3Force("x",$o.A(u).strength(.5)),l.d3Force("y",er.A(h).strength(.5))),e({graphInstance:l});const{filteredGraphData:m}=t();m.nodes.length>0?(l.graphData(m),setTimeout(()=>{l.zoomToFit(400,50)},500)):l.graphData({nodes:[],links:[]})}catch(l){e({error:"Failed to initialize graph visualization"})}},cleanupGraph:()=>{const{graphInstance:n}=t();if(n){try{"function"===typeof n._destructor&&n._destructor()}catch(a){}e({graphInstance:null})}},setGraphData:t=>{e({graphData:t})},setFilteredGraphData:n=>{const{graphInstance:a}=t();e({filteredGraphData:n}),a&&n.nodes.length>0&&a.graphData(n)},setLoading:t=>{e({loading:t})},setError:t=>{e({error:t})},setFocusedNode:t=>{e({focusedNodeId:t})},setSelectedNode:t=>{e({selectedNode:t})},updateForceParameters:(n,a,s)=>{const{graphInstance:i}=t(),o=t().centerForce,r=void 0!==s?s:o;var l,d;if(e({forceStrength:n,linkDistance:a,centerForce:r}),i)if(null===(l=i.d3Force("charge"))||void 0===l||l.strength(n),null===(d=i.d3Force("link"))||void 0===d||d.distance(a),void 0!==s){var c;const e=i.width()/2,t=i.height()/2;var u;if(null===(c=i.d3Force("center"))||void 0===c||c.strength(r),r<.3)i.d3Force("x",null),i.d3Force("y",null),null===(u=i.d3Force("center"))||void 0===u||u.strength(.01);else if(r<.7)i.d3Force("x",$o.A(e).strength(.1)),i.d3Force("y",er.A(t).strength(.1));else{var h;i.d3Force("x",$o.A(e).strength(.5)),i.d3Force("y",er.A(t).strength(.5)),null===(h=i.d3Force("charge"))||void 0===h||h.strength(-100)}const a=r>.7?1:.8;var m;if(i.d3ReheatSimulation(a),r<.7)null===(m=i.d3Force("charge"))||void 0===m||m.strength(n)}else i.d3ReheatSimulation(.3)},setLinkCurvature:n=>{const{graphInstance:a}=t();e({linkCurvature:n}),a&&a.linkCurvature(n)},resetFilters:()=>{e({focusedNodeId:null,selectedNode:null,showInferredNodes:!0,deduplicateNodes:!1})},toggleInferredNodes:()=>{e(e=>({showInferredNodes:!e.showInferredNodes}))},toggleDeduplication:()=>{e(e=>({deduplicateNodes:!e.deduplicateNodes}))},toggleOrphanedNodes:()=>{e(e=>({showOrphanedNodes:!e.showOrphanedNodes}))},zoomToFit:()=>{const{graphInstance:e}=t();e&&e.zoomToFit(400,50)},zoomIn:()=>{const{graphInstance:e}=t();if(e){const t=e.zoom();e.zoom(1.2*t,300)}},zoomOut:()=>{const{graphInstance:e}=t();if(e){const t=e.zoom();e.zoom(.8*t,300)}}})),nr=e=>{let{open:t,onClose:n,indexName:s,workspaceUrl:h,endpointName:p}=e;const g=(0,i.useRef)(null),{graphData:f,filteredGraphData:v,loading:A,error:y,selectedNode:b,focusedNodeId:j,showInferredNodes:w,deduplicateNodes:k,showOrphanedNodes:C,forceStrength:S,linkDistance:_,linkCurvature:E,centerForce:I,initializeGraph:T,cleanupGraph:D,setGraphData:N,setFilteredGraphData:M,setLoading:z,setError:L,setFocusedNode:F,setSelectedNode:W,updateForceParameters:B,setLinkCurvature:H,resetFilters:K,toggleInferredNodes:G,toggleDeduplication:J,toggleOrphanedNodes:q,zoomToFit:Y,zoomIn:X,zoomOut:Z}=tr(),Q=e=>{const t={person:"#68CCE5",organization:"#94D82D",system:"#FCC940",concept:"#F25A29",location:"#AD4BAC",event:"#D62728",conference:"#E91E63",meetup:"#FF5722",document:"#8FBC8F",project:"#FFB366",technology:"#00BCD4",tool:"#9C27B0",framework:"#3F51B5",unknown:"#C5C5C5"};return t[e.toLowerCase()]||t.unknown},$=(0,i.useCallback)(async()=>{if(s&&h&&p){z(!0),L(null);try{const e=await ye.uE.get("/memory-backend/databricks/entity-data",{params:{index_name:s,workspace_url:h,endpoint_name:p}}),{entities:t,relationships:n}=e.data,a=new Map,i=t.map(e=>{const t={id:e.id||e.name,name:e.name||e.id,type:e.type||"unknown",attributes:e.attributes||{},color:Q(e.type||"unknown"),size:5};return a.set(t.id,t),t}),o={nodes:i,links:n.filter(e=>a.has(e.source)&&a.has(e.target)).map(e=>({source:e.source,target:e.target,relationship:e.type||e.label||"related_to"}))};N(o),M(o)}catch(t){var e;const n=t instanceof Error?t.message:(null===t||void 0===t||null===(e=t.response)||void 0===e||null===(e=e.data)||void 0===e?void 0:e.detail)||"Failed to fetch entity data";L(n)}finally{z(!1)}}},[s,h,p,N,M,z,L]);(0,i.useEffect)(()=>{t&&$()},[t,$]),(0,i.useEffect)(()=>{if(!t||A||y||!g.current)return;if(0===f.nodes.length)return;const e=setTimeout(()=>{g.current&&T(g.current)},100);return()=>{clearTimeout(e)}},[t,A,y,f,T]),(0,i.useEffect)(()=>{t||(D(),K())},[t,D,K]),(0,i.useEffect)(()=>{let e=[...f.nodes],t=[...f.links];const n=new Set;if(t.forEach(e=>{const t="object"===typeof e.source?e.source.id:e.source,a="object"===typeof e.target?e.target.id:e.target;n.add(t),n.add(a)}),!j&&!C&&n.size>0){e.filter(e=>!n.has(e.id)).length;e=e.filter(e=>n.has(e.id))}if(j){if(e.find(e=>e.id===j)){const n=new Set([j]);t.forEach(e=>{const t="object"===typeof e.source?e.source.id:e.source,a="object"===typeof e.target?e.target.id:e.target;t===j&&n.add(a),a===j&&n.add(t)}),e=e.filter(e=>n.has(e.id)),t=t.filter(e=>{const t="object"===typeof e.source?e.source.id:e.source,a="object"===typeof e.target?e.target.id:e.target;return n.has(t)&&n.has(a)})}}else if(k){const n=new Map,s=new Map;e.forEach(e=>{if(s.has(e.name)){const t=s.get(e.name);n.set(e.id,t.id)}else s.set(e.name,e),n.set(e.id,e.id)}),e=Array.from(s.values());const i=new Set(e.map(e=>e.id)),o=t.map(e=>{const t="object"===typeof e.source?e.source.id:e.source,s="object"===typeof e.target?e.target.id:e.target,i=n.get(t)||t,o=n.get(s)||s;return(0,a.A)((0,a.A)({},e),{},{source:i,target:o})});t=o.filter(e=>{const t=e.source!==e.target&&i.has(e.source)&&i.has(e.target);return t});const r=new Map;t.forEach(e=>{const t="".concat(e.source,"-").concat(e.target,"-").concat(e.relationship||"related");r.has(t)||r.set(t,e)}),t=Array.from(r.values())}M({nodes:e,links:t})},[f,j,k,C,M]);const ne=()=>{K(),n()};return(0,O.jsxs)(r.A,{open:t,onClose:ne,maxWidth:"xl",fullWidth:!0,PaperProps:{sx:{height:"90vh",display:"flex",flexDirection:"column"}},children:[(0,O.jsxs)(d.A,{sx:{m:0,p:2,display:"flex",alignItems:"center",gap:1},children:[(0,O.jsx)(Dn.A,{}),(0,O.jsx)(c.A,{variant:"h6",children:"Entity Graph Visualization"}),(0,O.jsx)(o.A,{sx:{flexGrow:1}}),(0,O.jsx)(Se.A,{options:f.nodes,getOptionLabel:e=>e.name,groupBy:e=>e.type,sx:{width:350},size:"small",value:f.nodes.find(e=>e.id===j)||null,onChange:(e,t)=>(e=>{if(e){F(e.id);const t=f.nodes.find(t=>t.id===e.id);t&&W(t)}})(t),renderInput:e=>(0,O.jsx)(V.A,(0,a.A)((0,a.A)({},e),{},{label:j?"Focused Entity":"Search entities...",variant:"outlined",color:j?"secondary":"primary"})),renderOption:(e,t)=>(0,O.jsx)(o.A,(0,a.A)((0,a.A)({component:"li"},e),{},{children:(0,O.jsxs)(hs.A,{direction:"row",spacing:1,alignItems:"center",children:[(0,O.jsx)(o.A,{sx:{width:10,height:10,borderRadius:"50%",backgroundColor:t.color,border:"1px solid rgba(0,0,0,0.2)"}}),(0,O.jsx)(c.A,{variant:"body2",children:t.name}),(0,O.jsxs)(c.A,{variant:"caption",color:"text.secondary",children:["(",t.type,")"]})]})}))}),(0,O.jsx)(P.A,{title:"Zoom In",children:(0,O.jsx)(u.A,{onClick:X,size:"small",children:(0,O.jsx)(In.A,{})})}),(0,O.jsx)(P.A,{title:"Zoom Out",children:(0,O.jsx)(u.A,{onClick:Z,size:"small",children:(0,O.jsx)(Tn.A,{})})}),(0,O.jsx)(P.A,{title:"Fit to Screen",children:(0,O.jsx)(u.A,{onClick:Y,size:"small",children:(0,O.jsx)(En.A,{})})}),(0,O.jsx)(P.A,{title:"Refresh",children:(0,O.jsx)(u.A,{onClick:$,size:"small",children:(0,O.jsx)(Bo.A,{})})}),(0,O.jsx)(u.A,{onClick:ne,sx:{ml:2},children:(0,O.jsx)(U.A,{})})]}),(0,O.jsx)(l.A,{sx:{p:0,position:"relative",flex:1,overflow:"hidden"},children:(0,O.jsxs)(o.A,{sx:{display:"flex",height:"100%"},children:[(0,O.jsxs)(o.A,{sx:{flex:1,position:"relative"},children:[(0,O.jsxs)(o.A,{sx:{position:"absolute",top:16,left:16,display:"flex",flexDirection:"column",gap:2,zIndex:10,maxHeight:"calc(100vh - 250px)"},children:[(0,O.jsx)(_e.A,{sx:{p:2,width:320,boxShadow:2},children:(0,O.jsxs)(hs.A,{spacing:2,children:[(0,O.jsx)(he.A,{control:(0,O.jsx)(me.A,{checked:w,onChange:G}),label:"Show Inferred Nodes"}),(0,O.jsx)(he.A,{control:(0,O.jsx)(me.A,{checked:k,onChange:J,disabled:!!j}),label:j?"Deduplication disabled (focused)":"Deduplicate Nodes"}),(0,O.jsx)(he.A,{control:(0,O.jsx)(me.A,{checked:C,onChange:q,disabled:!!j}),label:"Show Unconnected Nodes"}),(0,O.jsx)(te.A,{}),(0,O.jsx)(c.A,{variant:"subtitle2",children:"Line Style"}),(0,O.jsxs)(hs.A,{direction:"row",spacing:1,sx:{mb:1},children:[(0,O.jsx)(x.A,{variant:0===E?"contained":"outlined",size:"small",onClick:()=>H(0),children:"Straight"}),(0,O.jsx)(x.A,{variant:.2===E?"contained":"outlined",size:"small",onClick:()=>H(.2),children:"Curved"}),(0,O.jsx)(x.A,{variant:.5===E?"contained":"outlined",size:"small",onClick:()=>H(.5),children:"Arc"})]}),(0,O.jsx)(c.A,{variant:"subtitle2",sx:{mb:1},children:"Cluster Spacing"}),(0,O.jsx)(o.A,{sx:{px:2,mb:2},children:(0,O.jsx)(ja.Ay,{value:I,onChange:(e,t)=>B(S,_,t),min:0,max:1,step:.1,valueLabelDisplay:"auto",marks:[{value:0,label:"Spread"},{value:.5,label:"Balanced"},{value:1,label:"Compact"}],sx:{"& .MuiSlider-markLabel":{fontSize:"0.7rem"},'& .MuiSlider-markLabel[data-index="2"]':{transform:"translateX(-70%)"}}})}),(0,O.jsx)(c.A,{variant:"subtitle2",children:"Force Strength"}),(0,O.jsx)(ja.Ay,{value:S,onChange:(e,t)=>B(t,_,I),min:-1e3,max:-100,valueLabelDisplay:"auto"}),(0,O.jsx)(c.A,{variant:"subtitle2",children:"Link Distance"}),(0,O.jsx)(ja.Ay,{value:_,onChange:(e,t)=>B(S,t,I),min:50,max:500,valueLabelDisplay:"auto"})]})}),(0,O.jsxs)(_e.A,{sx:{p:2,width:320,boxShadow:2},children:[(0,O.jsx)(c.A,{variant:"subtitle2",gutterBottom:!0,children:"Entity Types"}),(0,O.jsx)(hs.A,{spacing:.5,children:Object.entries({Event:"#D62728",Conference:"#E91E63",Person:"#68CCE5",System:"#FCC940",Concept:"#F25A29",Unknown:"#C5C5C5"}).map(e=>{let[t,n]=e;return(0,O.jsxs)(o.A,{sx:{display:"flex",alignItems:"center",gap:1},children:[(0,O.jsx)(o.A,{sx:{width:12,height:12,borderRadius:"50%",backgroundColor:n,border:"1px solid rgba(0,0,0,0.2)"}}),(0,O.jsx)(c.A,{variant:"caption",children:t})]},t)})})]})]}),!A&&!y&&(0,O.jsx)(_e.A,{sx:{position:"absolute",top:16,right:16,p:2,zIndex:10,minWidth:150,boxShadow:2},children:(0,O.jsxs)(hs.A,{spacing:1,children:[j&&(0,O.jsx)(R.A,{label:"Focused View",size:"small",color:"secondary",variant:"filled"}),(0,O.jsxs)(c.A,{variant:"caption",children:["Nodes: ",v.nodes.length,f.nodes.length!==v.nodes.length&&" / ".concat(f.nodes.length)]}),(0,O.jsxs)(c.A,{variant:"caption",children:["Links: ",v.links.length,f.links.length!==v.links.length&&" / ".concat(f.links.length)]}),k&&!j&&(0,O.jsx)(R.A,{label:"Deduplicated",size:"small",variant:"outlined"})]})}),A&&(0,O.jsxs)(o.A,{sx:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",zIndex:20,display:"flex",flexDirection:"column",alignItems:"center",gap:2,bgcolor:"rgba(255, 255, 255, 0.9)",p:3,borderRadius:2,boxShadow:3},children:[(0,O.jsx)(ue.A,{}),(0,O.jsx)(c.A,{children:"Loading entity data..."})]}),y&&!A&&(0,O.jsx)(m.A,{severity:"warning",sx:{m:2,position:"absolute",top:0,left:0,right:0,zIndex:20},children:y}),(0,O.jsx)("div",{ref:g,style:{width:"100%",height:"100%",minHeight:"600px",display:A||y?"none":"block",backgroundColor:"#fafafa"}})]}),b&&(0,O.jsx)(_e.A,{sx:{width:400,p:2,overflow:"auto",maxHeight:"100%"},children:(0,O.jsx)(ee.A,{children:(0,O.jsxs)(Xt.A,{children:[(0,O.jsxs)(hs.A,{direction:"row",justifyContent:"space-between",alignItems:"center",sx:{mb:2},children:[(0,O.jsx)(c.A,{variant:"h6",children:b.name}),(0,O.jsx)(u.A,{size:"small",onClick:()=>{W(null),F(null)},children:(0,O.jsx)(U.A,{fontSize:"small"})})]}),(0,O.jsxs)(hs.A,{direction:"row",spacing:1,sx:{mb:2},children:[(0,O.jsx)(R.A,{label:b.type,size:"small",sx:{backgroundColor:b.color,color:"white"}}),j===b.id&&(0,O.jsx)(R.A,{label:"Focused",size:"small",color:"secondary",variant:"outlined"})]}),(0,O.jsxs)(o.A,{sx:{mb:2,p:1,bgcolor:"grey.100",borderRadius:1},children:[(0,O.jsx)(c.A,{variant:"caption",color:"textSecondary",children:"Connections"}),(0,O.jsxs)(c.A,{variant:"body2",children:[f.links.filter(e=>{const t="object"===typeof e.source?e.source.id:e.source,n="object"===typeof e.target?e.target.id:e.target;return t===b.id||n===b.id}).length," relationships"]})]}),Object.entries(b.attributes||{}).length>0&&(0,O.jsxs)(O.Fragment,{children:[(0,O.jsx)(c.A,{variant:"subtitle2",gutterBottom:!0,sx:{mt:2},children:"Attributes"}),(0,O.jsx)(hs.A,{spacing:1,sx:{mb:2},children:Object.entries(b.attributes).map(e=>{let[t,n]=e;return(0,O.jsxs)(o.A,{children:[(0,O.jsx)(c.A,{variant:"caption",color:"textSecondary",children:t}),(0,O.jsx)(c.A,{variant:"body2",children:String(n)})]},t)})})]}),(0,O.jsx)(te.A,{sx:{my:2}}),(0,O.jsx)(c.A,{variant:"subtitle2",gutterBottom:!0,children:"Connected Entities"}),(0,O.jsx)(hs.A,{spacing:1,sx:{maxHeight:300,overflow:"auto",mb:2},children:(()=>{const e=new Map;return f.links.forEach(t=>{const n="object"===typeof t.source?t.source.id:t.source,a="object"===typeof t.target?t.target.id:t.target;if(n===b.id){const n=f.nodes.find(e=>e.id===a);n&&(e.has(n.id)||e.set(n.id,{node:n,relationships:[]}),e.get(n.id).relationships.push({type:t.relationship||"related_to",direction:"outgoing"}))}if(a===b.id){const a=f.nodes.find(e=>e.id===n);a&&(e.has(a.id)||e.set(a.id,{node:a,relationships:[]}),e.get(a.id).relationships.push({type:t.relationship||"related_to",direction:"incoming"}))}}),0===e.size?(0,O.jsx)(c.A,{variant:"body2",color:"textSecondary",children:"No connections found"}):Array.from(e.values()).map(e=>{let{node:t,relationships:n}=e;return(0,O.jsx)(ee.A,{variant:"outlined",sx:{p:1,cursor:"pointer","&:hover":{bgcolor:"action.hover"}},onClick:()=>{W(t),F(t.id)},children:(0,O.jsxs)(hs.A,{direction:"row",spacing:1,alignItems:"center",children:[(0,O.jsx)(o.A,{sx:{width:12,height:12,borderRadius:"50%",backgroundColor:t.color||Q(t.type),border:"1px solid rgba(0,0,0,0.2)",flexShrink:0}}),(0,O.jsxs)(o.A,{sx:{flex:1,minWidth:0},children:[(0,O.jsx)(c.A,{variant:"body2",noWrap:!0,children:t.name}),(0,O.jsxs)(hs.A,{direction:"row",spacing:.5,flexWrap:"wrap",children:[(0,O.jsx)(c.A,{variant:"caption",color:"textSecondary",children:t.type}),n.map((e,t)=>(0,O.jsx)(R.A,{label:"".concat("incoming"===e.direction?"\u2190":"\u2192"," ").concat(e.type),size:"small",variant:"outlined",sx:{height:18,fontSize:"0.7rem"}},t))]})]})]})},t.id)})})()}),(0,O.jsxs)(hs.A,{direction:"row",spacing:1,sx:{mt:2},children:[j!==b.id&&(0,O.jsx)(x.A,{variant:"contained",size:"small",onClick:()=>F(b.id),children:"Focus on Node"}),j===b.id&&(0,O.jsx)(x.A,{variant:"outlined",size:"small",onClick:()=>{F(null)},children:"Show All"})]})]})})})]})})]})};var ar=n(49715);const sr=e=>{let{open:t,onClose:n,indexName:a,indexType:s,workspaceUrl:h,endpointName:p,backendId:g}=e;const[f,v]=(0,i.useState)([]),[A,y]=(0,i.useState)(!1),[b,j]=(0,i.useState)(""),[w,k]=(0,i.useState)(""),[C,S]=(0,i.useState)([]),_=(0,i.useCallback)(async()=>{y(!0),j("");try{const e={index_name:a,workspace_url:h,endpoint_name:p,index_type:s,limit:30};g&&(e.backend_id=g);const t=await ye.uE.get("/memory-backend/databricks/index-documents",{params:e});t.data.success?v(t.data.documents||[]):j(t.data.message||"Failed to fetch documents")}catch(e){j("Failed to fetch documents. Please try again.")}finally{y(!1)}},[a,h,p,s,g]);(0,i.useEffect)(()=>{t&&a&&h&&p&&_()},[t,a,h,p,_]),(0,i.useEffect)(()=>{if(w){const e=w.toLowerCase(),t=f.filter(t=>{var n,a,s;return(null===(n=t.text)||void 0===n?void 0:n.toLowerCase().includes(e))||(null===(a=t.id)||void 0===a?void 0:a.toLowerCase().includes(e))||(null===(s=JSON.stringify(t.metadata))||void 0===s?void 0:s.toLowerCase().includes(e))});S(t)}else S(f)},[w,f]);const E=e=>{if(!e)return null;try{return"string"===typeof e?JSON.stringify(JSON.parse(e),null,2):JSON.stringify(e,null,2)}catch(t){return String(e)}};return(0,O.jsxs)(r.A,{open:t,onClose:n,maxWidth:"lg",fullWidth:!0,PaperProps:{sx:{height:"80vh",display:"flex",flexDirection:"column"}},children:[(0,O.jsxs)(d.A,{children:[(0,O.jsxs)(o.A,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[(0,O.jsxs)(o.A,{sx:{display:"flex",alignItems:"center",gap:2},children:[(0,O.jsx)(c.A,{variant:"h6",children:"Index Documents"}),(0,O.jsx)(R.A,{label:{short_term:"Short-term Memory",long_term:"Long-term Memory",entity:"Entity Memory",document:"Document Embeddings"}[s]||s,color:{short_term:"primary",long_term:"secondary",entity:"success",document:"info"}[s]||"default",size:"small"})]}),(0,O.jsxs)(o.A,{sx:{display:"flex",alignItems:"center",gap:1},children:[(0,O.jsx)(P.A,{title:"Refresh",children:(0,O.jsx)(u.A,{onClick:_,disabled:A,children:(0,O.jsx)(Bo.A,{})})}),(0,O.jsx)(u.A,{onClick:n,children:(0,O.jsx)(U.A,{})})]})]}),(0,O.jsxs)(c.A,{variant:"caption",color:"text.secondary",sx:{mt:1,display:"block"},children:[a," (",C.length," of ",f.length," documents)"]})]}),(0,O.jsxs)(l.A,{dividers:!0,sx:{flex:1,overflow:"auto"},children:[(0,O.jsx)(o.A,{sx:{mb:2},children:(0,O.jsx)(V.A,{fullWidth:!0,size:"small",placeholder:"Search documents...",value:w,onChange:e=>k(e.target.value),InputProps:{startAdornment:(0,O.jsx)(ne.A,{position:"start",children:(0,O.jsx)(ar.A,{})})}})}),A&&(0,O.jsx)(o.A,{sx:{display:"flex",justifyContent:"center",py:4},children:(0,O.jsx)(ue.A,{})}),b&&(0,O.jsx)(m.A,{severity:"error",sx:{mb:2},children:b}),!A&&!b&&0===C.length&&(0,O.jsx)(m.A,{severity:"info",children:w?"No documents match your search.":"No documents found in this index."}),!A&&!b&&C.length>0&&(0,O.jsx)(o.A,{sx:{display:"flex",flexDirection:"column",gap:2},children:C.map((e,t)=>(0,O.jsxs)(_e.A,{variant:"outlined",sx:{p:2},children:[(0,O.jsxs)(o.A,{sx:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",mb:1},children:[(0,O.jsxs)(c.A,{variant:"subtitle2",color:"primary",children:["Document #",t+1]}),(0,O.jsx)(P.A,{title:"Copy document text",children:(0,O.jsx)(u.A,{size:"small",onClick:()=>{return t=e.text,void navigator.clipboard.writeText(t);var t},children:(0,O.jsx)(Qa.A,{fontSize:"small"})})})]}),e.id&&(0,O.jsxs)(c.A,{variant:"caption",color:"text.secondary",sx:{display:"block",mb:1},children:["ID: ",e.id]}),(0,O.jsx)(te.A,{sx:{my:1}}),(0,O.jsx)(c.A,{variant:"body2",sx:{whiteSpace:"pre-wrap",wordBreak:"break-word",mb:e.metadata?1:0},children:e.text}),e.metadata&&Object.keys(e.metadata).length>0&&(0,O.jsxs)(O.Fragment,{children:[(0,O.jsx)(te.A,{sx:{my:1}}),(0,O.jsxs)(o.A,{children:[(0,O.jsx)(c.A,{variant:"caption",color:"text.secondary",sx:{fontWeight:"bold"},children:"Metadata:"}),(0,O.jsx)(o.A,{component:"pre",sx:{backgroundColor:"grey.50",p:1,borderRadius:1,overflow:"auto",fontSize:"0.75rem",mt:.5,fontFamily:"monospace"},children:E(e.metadata)})]})]})]},e.id||t))})]}),(0,O.jsx)(B.A,{children:(0,O.jsx)(x.A,{onClick:n,children:"Close"})})]})},ir=()=>{var e,t,n,s,r,l,d,h;const[p,x]=(0,i.useState)("disabled"),[g,f]=(0,i.useState)("auto"),[v,A]=(0,i.useState)(null),[y,b]=(0,i.useState)("ml"),[j,w]=(0,i.useState)("agents"),[k,C]=(0,i.useState)("databricks-bge-large-en"),[S,_]=(0,i.useState)(!1),[E,I]=(0,i.useState)(null),[T,D]=(0,i.useState)(!1),[N,P]=(0,i.useState)(""),[M,z]=(0,i.useState)(null),[L,F]=(0,i.useState)({}),[W,R]=(0,i.useState)(null),[V,B]=(0,i.useState)(!1),[U,H]=(0,i.useState)(null),[K,G]=(0,i.useState)({}),[J,q]=(0,i.useState)(!1),[Y,X]=(0,i.useState)(!1),[Z,Q]=(0,i.useState)(!1),[$,ee]=(0,i.useState)({workspace_url:"",endpoint_name:"",document_endpoint_name:"",short_term_index:"",long_term_index:"",entity_index:"",document_index:"",embedding_model:"databricks-bge-large-en"}),[ne,ae]=(0,i.useState)(!1),[se,ie]=(0,i.useState)(null),{updateConfig:oe,visualizationOpen:re,visualizationIndex:le,openVisualization:de,closeVisualization:ce}=So();(0,i.useEffect)(()=>{xe(),pe()},[]),(0,i.useEffect)(()=>{if(null!==M&&void 0!==M&&M.workspace_url&&M.backend_id){const e=setTimeout(()=>{ve()},500);return()=>clearTimeout(e)}},[null===M||void 0===M?void 0:M.backend_id]),(0,i.useEffect)(()=>{},[M]),(0,i.useEffect)(()=>{(async()=>{null!==M&&void 0!==M&&M.workspace_url&&await ve()})()},[M]),(0,i.useEffect)(()=>{if(W&&null!==M&&void 0!==M&&M.endpoints){var e,t;const n={};if(null!==(e=M.endpoints.memory)&&void 0!==e&&e.name)if(W.endpoints[M.endpoints.memory.name]){const e=W.endpoints[M.endpoints.memory.name];n.memory={name:e.name,state:e.state||"UNKNOWN",ready:e.ready||!1,can_delete_indexes:"ONLINE"===e.state}}else n.memory={name:M.endpoints.memory.name,state:"NOT_FOUND",ready:!1,can_delete_indexes:!1};if(null!==(t=M.endpoints.document)&&void 0!==t&&t.name)if(W.endpoints[M.endpoints.document.name]){const e=W.endpoints[M.endpoints.document.name];n.document={name:e.name,state:e.state||"UNKNOWN",ready:e.ready||!1,can_delete_indexes:"ONLINE"===e.state}}else n.document={name:M.endpoints.document.name,state:"NOT_FOUND",ready:!1,can_delete_indexes:!1};F(n)}},[W,M]);const pe=async()=>{try{var e,t;const n=await ye.uE.get("/memory-backend/databricks/workspace-url");null!==(e=n.data)&&void 0!==e&&e.detected&&null!==(t=n.data)&&void 0!==t&&t.workspace_url&&A(n.data.workspace_url)}catch(N){}},xe=async()=>{try{const e=await ye.uE.get("/memory-backend/configs/default");if(!e.data||0===Object.keys(e.data).length){try{const e=await ye.uE.get("/memory-backend/configs");if(e.data&&e.data.length>0){const t=e.data[0];return ge(t),void q(!0)}}catch(t){}return x("disabled"),void q(!0)}ge(e.data),q(!0)}catch(N){var e;if(N instanceof Le.pe&&404===(null===(e=N.response)||void 0===e?void 0:e.status))try{const e=await ye.uE.get("/memory-backend/configs");if(e.data&&e.data.length>0){const t=e.data[0];return ge(t),void q(!0)}}catch(t){x("disabled")}x("disabled"),q(!0)}},ge=e=>{if(e&&e.backend_type===bs.DATABRICKS&&e.databricks_config){const t=e.databricks_config,n={backend_id:e.id,workspace_url:t.workspace_url,catalog:t.catalog||"ml",schema:t.schema||"agents",endpoints:{memory:t.endpoint_name?{name:t.endpoint_name}:void 0,document:t.document_endpoint_name?{name:t.document_endpoint_name}:void 0},indexes:{short_term:t.short_term_index?{name:t.short_term_index}:void 0,long_term:t.long_term_index?{name:t.long_term_index}:void 0,entity:t.entity_index?{name:t.entity_index}:void 0,document:t.document_index?{name:t.document_index}:void 0}};z(n),x("databricks"),Q(e.enable_relationship_retrieval||!1)}else e&&e.backend_type===bs.DEFAULT&&(z({backend_id:e.id}),x("disabled"))},fe=async e=>{if(e.backend_id)try{var t,n,a,s,i,o;const r={databricks_config:{workspace_url:e.workspace_url,catalog:e.catalog,schema:e.schema,endpoint_name:(null===(t=e.endpoints)||void 0===t||null===(t=t.memory)||void 0===t?void 0:t.name)||null,document_endpoint_name:(null===(n=e.endpoints)||void 0===n||null===(n=n.document)||void 0===n?void 0:n.name)||null,short_term_index:(null===(a=e.indexes)||void 0===a||null===(a=a.short_term)||void 0===a?void 0:a.name)||null,long_term_index:(null===(s=e.indexes)||void 0===s||null===(s=s.long_term)||void 0===s?void 0:s.name)||null,entity_index:(null===(i=e.indexes)||void 0===i||null===(i=i.entity)||void 0===i?void 0:i.name)||null,document_index:(null===(o=e.indexes)||void 0===o||null===(o=o.document)||void 0===o?void 0:o.name)||null,auth_type:"default",embedding_dimension:768}},l=await ye.uE.put("/memory-backend/configs/".concat(e.backend_id),r);window.dispatchEvent(new CustomEvent("memory-backend-updated",{detail:{config:l.data}})),l.data}catch(N){}},ve=async()=>{if(null!==M&&void 0!==M&&M.workspace_url)try{const r=await ye.uE.get("/memory-backend/databricks/verify-resources",{params:{workspace_url:M.workspace_url,backend_id:M.backend_id}});if(r.data.success){var e,t,n,s,i,o;R(r.data.resources);const l=(0,a.A)({},M);let d=!1;null!==(e=M.endpoints)&&void 0!==e&&e.memory&&(r.data.resources.endpoints[M.endpoints.memory.name]||(l.endpoints=(0,a.A)((0,a.A)({},l.endpoints),{},{memory:void 0}),d=!0)),null!==(t=M.endpoints)&&void 0!==t&&t.document&&(r.data.resources.endpoints[M.endpoints.document.name]||(l.endpoints=(0,a.A)((0,a.A)({},l.endpoints),{},{document:void 0}),d=!0)),null!==(n=M.indexes)&&void 0!==n&&n.short_term&&(r.data.resources.indexes[M.indexes.short_term.name]||(l.indexes=(0,a.A)((0,a.A)({},l.indexes),{},{short_term:void 0}),d=!0)),null!==(s=M.indexes)&&void 0!==s&&s.long_term&&(r.data.resources.indexes[M.indexes.long_term.name]||(l.indexes=(0,a.A)((0,a.A)({},l.indexes),{},{long_term:void 0}),d=!0)),null!==(i=M.indexes)&&void 0!==i&&i.entity&&(r.data.resources.indexes[M.indexes.entity.name]||(l.indexes=(0,a.A)((0,a.A)({},l.indexes),{},{entity:void 0}),d=!0)),null!==(o=M.indexes)&&void 0!==o&&o.document&&(r.data.resources.indexes[M.indexes.document.name]||(l.indexes=(0,a.A)((0,a.A)({},l.indexes),{},{document:void 0}),d=!0)),d&&(z(l),await fe(l))}}catch(N){}},Ae=async e=>{var t,n;if(null===M||void 0===M||null===(t=M.indexes)||void 0===t||!t[e])return;const s=null===(n=M.indexes[e])||void 0===n?void 0:n.name;if(!s)return;const i=K[s];if("NOT_FOUND"===(null===i||void 0===i?void 0:i.status)||"DELETED"===(null===i||void 0===i?void 0:i.index_type))return void P("Cannot delete index: ".concat(e.replace("_"," ")," index has already been deleted from Databricks."));const o=L["document"===e?"document":"memory"];if(o&&!o.can_delete_indexes)return void P("Cannot delete index: Endpoint is ".concat(o.state,". Indexes can only be deleted when the endpoint is ONLINE."));if(window.confirm("Are you sure you want to delete the ".concat(e.replace("_"," ")," index?"))){_(!0),P("");try{var r,l,d;const t=await ye.uE.delete("/memory-backend/databricks/index",{data:{workspace_url:M.workspace_url,index_name:null===(r=M.indexes[e])||void 0===r?void 0:r.name,endpoint_name:"document"===e?null===(l=M.endpoints)||void 0===l||null===(l=l.document)||void 0===l?void 0:l.name:null===(d=M.endpoints)||void 0===d||null===(d=d.memory)||void 0===d?void 0:d.name}});if(t.data.success){const t=(0,a.A)((0,a.A)({},M),{},{indexes:(0,a.A)((0,a.A)({},M.indexes),{},{[e]:void 0})});z(t),await fe(t)}else P(t.data.message||"Failed to delete index")}catch(N){P("Failed to delete index. Please try again.")}finally{_(!1)}}},be=async(e,t)=>{if(null!==M&&void 0!==M&&M.workspace_url){G(t=>(0,a.A)((0,a.A)({},t),{},{[e]:{doc_count:0,loading:!0}}));try{const i=await ye.uE.get("/memory-backend/databricks/index-info",{params:{workspace_url:M.workspace_url,index_name:e,endpoint_name:t}});if(i.data.success)G(t=>(0,a.A)((0,a.A)({},t),{},{[e]:{doc_count:i.data.doc_count||0,loading:!1,status:i.data.status||"UNKNOWN",ready:i.data.ready||!1,index_type:i.data.index_type||"UNKNOWN"}}));else{var n,s;const t=(null===(n=i.data.message)||void 0===n?void 0:n.toLowerCase().includes("not found"))||(null===(s=i.data.message)||void 0===s?void 0:s.toLowerCase().includes("does not exist"));G(n=>(0,a.A)((0,a.A)({},n),{},{[e]:{doc_count:0,loading:!1,error:i.data.message,status:t?"NOT_FOUND":"ERROR",ready:!1,index_type:"DELETED"}}))}}catch(N){var i,o;const n=N instanceof Le.pe&&404===(null===(i=N.response)||void 0===i?void 0:i.status),s=N instanceof Le.pe?(null===(o=N.response)||void 0===o||null===(o=o.data)||void 0===o?void 0:o.detail)||N.message:"Failed to fetch index info";G(t=>(0,a.A)((0,a.A)({},t),{},{[e]:{doc_count:0,loading:!1,error:s,status:n?"NOT_FOUND":"ERROR",ready:!1,index_type:n?"DELETED":"UNKNOWN"}}))}}};(0,i.useEffect)(()=>{if(null!==M&&void 0!==M&&M.indexes&&null!==M&&void 0!==M&&M.workspace_url){var e,t,n,a,s,i,o,r;const l=M.indexes;null!==(e=l.short_term)&&void 0!==e&&e.name&&null!==(t=M.endpoints)&&void 0!==t&&null!==(t=t.memory)&&void 0!==t&&t.name&&be(l.short_term.name,M.endpoints.memory.name),null!==(n=l.long_term)&&void 0!==n&&n.name&&null!==(a=M.endpoints)&&void 0!==a&&null!==(a=a.memory)&&void 0!==a&&a.name&&be(l.long_term.name,M.endpoints.memory.name),null!==(s=l.entity)&&void 0!==s&&s.name&&null!==(i=M.endpoints)&&void 0!==i&&null!==(i=i.memory)&&void 0!==i&&i.name&&be(l.entity.name,M.endpoints.memory.name),null!==(o=l.document)&&void 0!==o&&o.name&&null!==(r=M.endpoints)&&void 0!==r&&null!==(r=r.document)&&void 0!==r&&r.name&&be(l.document.name,M.endpoints.document.name)}},[null===M||void 0===M?void 0:M.indexes,null===M||void 0===M?void 0:M.workspace_url]);const je=async e=>{var t,n;if(null===M||void 0===M||null===(t=M.indexes)||void 0===t||!t[e]||null===M||void 0===M||!M.workspace_url||null===M||void 0===M||!M.backend_id)return;const a=null===(n=M.indexes[e])||void 0===n?void 0:n.name;if(!a)return;if(window.confirm("Are you sure you want to empty the ".concat(e.replace("_"," ")," index? This will delete all documents but keep the index structure."))){_(!0),P("");try{var s,i,o;const t=(null===(s=(await ye.uE.get("/memory-backend/configs/".concat(M.backend_id))).data)||void 0===s||null===(s=s.databricks_config)||void 0===s?void 0:s.embedding_dimension)||768,n="document"===e?null===(i=M.endpoints)||void 0===i||null===(i=i.document)||void 0===i?void 0:i.name:null===(o=M.endpoints)||void 0===o||null===(o=o.memory)||void 0===o?void 0:o.name;if(!n)return void P("Could not determine endpoint for this index");const l=await ye.uE.post("/memory-backend/databricks/empty-index",{workspace_url:M.workspace_url,index_name:a,endpoint_name:n,index_type:e,embedding_dimension:t});if(l.data.success){setTimeout(()=>{be(a,n)},3e3);const t=l.data.deleted_count||0;P(""),l.data.message&&l.data.message.includes("created new index")?alert("Index ".concat(e.replace("_"," ")," was not found, so a new one was created successfully.")):alert("Successfully emptied ".concat(e.replace("_"," ")," index. ").concat(t," documents removed.\n\nNote: The index was deleted and recreated to clear all documents."))}else{var r;const e=l.data.message||"Failed to empty index";P(e),null!==(r=l.data.error)&&void 0!==r&&r.includes("not supported")&&alert(e)}}catch(N){P("Failed to empty index. Please try again.")}finally{_(!1)}}},we=(e,t)=>{var n,a;const s="document"===e?null===M||void 0===M||null===(n=M.endpoints)||void 0===n||null===(n=n.document)||void 0===n?void 0:n.name:null===M||void 0===M||null===(a=M.endpoints)||void 0===a||null===(a=a.memory)||void 0===a?void 0:a.name;s?(ie({name:t,type:e,endpointName:s}),ae(!0)):P("Cannot view documents: endpoint not configured")};return J?(0,O.jsxs)(o.A,{children:[(0,O.jsx)(o.A,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",mb:3},children:(0,O.jsxs)(o.A,{sx:{display:"flex",alignItems:"center"},children:[(0,O.jsx)(_o.A,{sx:{mr:1.5,color:"primary.main",fontSize:"1.4rem"}}),(0,O.jsx)(c.A,{variant:"h6",children:"Memory Configuration"})]})}),(0,O.jsxs)(_e.A,{variant:"outlined",sx:{p:3,borderRadius:2,bgcolor:"background.paper"},children:[(0,O.jsxs)(Jt.A,{value:p,onChange:async e=>{const t=e.target.value;if(x(t),"disabled"===t){oe({backend_type:bs.DEFAULT,enable_short_term:!1,enable_long_term:!1,enable_entity:!1});try{await No.switchToDisabledMode();z(null),P("")}catch(N){P("Failed to save disabled mode. Please try again.")}}},row:!0,sx:{mb:2},children:[(0,O.jsx)(he.A,{value:"databricks",control:(0,O.jsx)(qt.A,{size:"small"}),label:(0,O.jsxs)(o.A,{sx:{display:"flex",alignItems:"center"},children:[(0,O.jsx)(Eo.A,{sx:{fontSize:18,mr:.5}}),"Databricks Vector Search"]}),sx:{mr:3}}),(0,O.jsx)(he.A,{value:"disabled",control:(0,O.jsx)(qt.A,{size:"small"}),label:(0,O.jsxs)(o.A,{sx:{display:"flex",alignItems:"center"},children:[(0,O.jsx)(Io.A,{sx:{fontSize:18,mr:.5}}),"Disabled"]})})]}),(0,O.jsx)(Bi.A,{in:"databricks"===p,children:(0,O.jsxs)(o.A,{children:[(!M||!M.workspace_url)&&(0,O.jsxs)(O.Fragment,{children:[(0,O.jsx)(m.A,{severity:"info",sx:{mb:2},children:"Choose how to configure Databricks Vector Search"}),(0,O.jsxs)(Jt.A,{value:g,onChange:e=>f(e.target.value),row:!0,sx:{mb:2},children:[(0,O.jsx)(he.A,{value:"auto",control:(0,O.jsx)(qt.A,{size:"small"}),label:(0,O.jsxs)(o.A,{children:[(0,O.jsx)(c.A,{variant:"body2",fontWeight:"medium",children:"Auto-create"}),(0,O.jsx)(c.A,{variant:"caption",color:"text.secondary",children:"Automatically creates endpoints and indexes"})]}),sx:{mr:4}}),(0,O.jsx)(he.A,{value:"manual",control:(0,O.jsx)(qt.A,{size:"small"}),label:(0,O.jsxs)(o.A,{children:[(0,O.jsx)(c.A,{variant:"body2",fontWeight:"medium",children:"Manual setup"}),(0,O.jsx)(c.A,{variant:"caption",color:"text.secondary",children:"Use existing endpoints and indexes"})]})})]})]}),N&&(0,O.jsx)(m.A,{severity:"error",sx:{mb:2},onClose:()=>P(""),children:N}),"auto"===g&&(!M||!M.workspace_url)&&(0,O.jsx)(qo,{detectedWorkspaceUrl:v,catalog:y,schema:j,embeddingModel:k,isSettingUp:S,error:N,onCatalogChange:b,onSchemaChange:w,onEmbeddingModelChange:C,onSetup:async()=>{const e=v;if(e){_(!0),P(""),I(null);try{var t;try{await No.deleteAllConfigurations()}catch(N){}await No.cleanupDisabledConfigurations();const n=await No.performOneClickSetup({workspace_url:e,catalog:y,schema:j,embedding_dimension:(null===(t=Po.find(e=>e.value===k))||void 0===t?void 0:t.dimension)||768});I(n),D(!0),n.success&&(z({workspace_url:e,catalog:n.catalog||y,schema:n.schema||j,endpoints:n.endpoints,indexes:n.indexes}),oe({backend_type:bs.DATABRICKS,enable_short_term:!0,enable_long_term:!0,enable_entity:!0}),setTimeout(()=>{xe()},1500))}catch(N){var n;const t=N instanceof Le.pe?null===(n=N.response)||void 0===n||null===(n=n.data)||void 0===n?void 0:n.detail:N instanceof Error?N.message:"Failed to complete setup";P(t||"Failed to complete setup. Please check your configuration and try again.")}finally{_(!1)}}else P("No Databricks workspace detected. Please set DATABRICKS_HOST environment variable and reload.")}}),"manual"===g&&(!M||!M.workspace_url)&&(0,O.jsx)(Jo,{manualConfig:$,isSettingUp:S,error:N,onConfigChange:ee,onSave:async()=>{if(!$.workspace_url||!$.endpoint_name||!$.document_endpoint_name||!$.short_term_index||!$.long_term_index||!$.entity_index||!$.document_index)return void P("All fields are required. Please provide workspace URL, both endpoints, and all four indexes.");const e=[{name:"Short-term index",value:$.short_term_index},{name:"Long-term index",value:$.long_term_index},{name:"Entity index",value:$.entity_index},{name:"Document index",value:$.document_index}];for(const a of e)if(!Lo(a.value))return void P("".concat(a.name," must be in the format: catalog.schema.indexname (e.g., ml.agents.short_term_memory)"));_(!0),P("");try{var t;try{await ye.uE.delete("/memory-backend/configs/disabled/cleanup")}catch(n){}let e=y,a=j;const s=$.short_term_index.split(".");s.length>=3&&(e=s[0],a=s[1]);let i=null===M||void 0===M?void 0:M.backend_id;if(!i)try{const e=await ye.uE.get("/memory-backend/configs/default");e.data&&e.data.id&&(i=e.data.id)}catch(N){}const o={name:"Databricks Vector Search Configuration",description:"Manually configured Databricks Vector Search",backend_type:bs.DATABRICKS,enable_short_term:!0,enable_long_term:!0,enable_entity:!0,databricks_config:{workspace_url:$.workspace_url,endpoint_name:$.endpoint_name,document_endpoint_name:$.document_endpoint_name,short_term_index:$.short_term_index,long_term_index:$.long_term_index,entity_index:$.entity_index,document_index:$.document_index,auth_type:"default",embedding_dimension:(null===(t=Po.find(e=>e.value===$.embedding_model))||void 0===t?void 0:t.dimension)||768,catalog:e,schema:a}};let r;i?r=await ye.uE.put("/memory-backend/configs/".concat(i),o):(r=await ye.uE.post("/memory-backend/configs",o),r.data&&await ye.uE.post("/memory-backend/configs/".concat(r.data.id,"/set-default"))),window.dispatchEvent(new CustomEvent("memory-backend-updated",{detail:{config:r.data}})),r.data&&(oe({backend_type:bs.DATABRICKS,enable_short_term:!0,enable_long_term:!0,enable_entity:!0}),await xe(),ee({workspace_url:"",endpoint_name:"",document_endpoint_name:"",short_term_index:"",long_term_index:"",entity_index:"",document_index:"",embedding_model:"databricks-bge-large-en"}))}catch(N){P("Failed to save configuration. Please try again.")}finally{_(!1)}}}),null,M&&M.workspace_url&&(0,O.jsx)(Go,{savedConfig:M,isEditingConfig:V,isSettingUp:S,onStartEdit:()=>{H(JSON.parse(JSON.stringify(M))),B(!0)},onSaveEdit:async()=>{if(U&&U.backend_id){_(!0),P("");try{await fe(U),z(U),B(!1),H(null),setTimeout(()=>{ve()},500)}catch(N){P("Failed to save configuration. Please try again.")}finally{_(!1)}}},onCancelEdit:()=>{H(null),B(!1)},onRefresh:ve,children:(0,O.jsx)(o.A,{sx:{mt:1.5},children:V?(0,O.jsx)(Yo,{editedConfig:U,onEditChange:(e,t)=>{if(!U)return;const n=e.split("."),s=(0,a.A)({},U);"endpoints"===n[0]&&n[1]&&"name"===n[2]?(s.endpoints||(s.endpoints={}),s.endpoints[n[1]]=t?{name:t}:void 0):"indexes"===n[0]&&n[1]&&"name"===n[2]&&(s.indexes||(s.indexes={}),s.indexes[n[1]]=t?{name:t}:void 0),H(s)}}):(0,O.jsxs)(O.Fragment,{children:[(0,O.jsx)(Zo,{savedConfig:M,endpointStatuses:L,onDeleteEndpoint:async e=>{var t;if(null===M||void 0===M||null===(t=M.endpoints)||void 0===t||!t[e])return;const n=L[e],s="NOT_FOUND"===(null===n||void 0===n?void 0:n.state),i=0===Object.entries(M.endpoints||{}).filter(t=>{let[n,a]=t;return n!==e&&void 0!==a}).length,o=s?"The ".concat(e," endpoint no longer exists in Databricks. Remove it from configuration?"):i?"This is the last endpoint. Deleting it will disable memory backend entirely. Continue?":"Are you sure you want to delete the ".concat(e," endpoint?");if(window.confirm(o)){_(!0),P("");try{if(i){await No.switchToDisabledMode();return x("disabled"),z(null),void oe({backend_type:bs.DEFAULT,enable_short_term:!1,enable_long_term:!1,enable_entity:!1})}if(s){const t=(0,a.A)((0,a.A)({},M),{},{endpoints:(0,a.A)((0,a.A)({},M.endpoints),{},{[e]:void 0})});z(t),await fe(t)}else{var r;const t=await ye.uE.delete("/memory-backend/databricks/endpoint",{data:{workspace_url:M.workspace_url,endpoint_name:null===(r=M.endpoints[e])||void 0===r?void 0:r.name}});if(t.data.success){const t=(0,a.A)((0,a.A)({},M),{},{endpoints:(0,a.A)((0,a.A)({},M.endpoints),{},{[e]:void 0})});z(t),await fe(t)}else P(t.data.message||"Failed to delete endpoint")}}catch(N){P("Failed to delete endpoint. Please try again.")}finally{_(!1)}}}}),(0,O.jsxs)(o.A,{sx:{mt:2,mb:2},children:[(0,O.jsx)(te.A,{sx:{mb:1}}),(0,O.jsxs)(o.A,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",cursor:"pointer",py:.5},onClick:()=>X(!Y),children:[(0,O.jsx)(c.A,{variant:"subtitle2",color:"text.secondary",children:"Advanced Settings"}),(0,O.jsx)(u.A,{size:"small",children:Y?(0,O.jsx)(To.A,{}):(0,O.jsx)(Do.A,{})})]}),(0,O.jsx)(Bi.A,{in:Y,children:(0,O.jsx)(o.A,{sx:{mt:1,pl:1},children:(0,O.jsx)(he.A,{control:(0,O.jsx)(me.A,{checked:Z,onChange:e=>(async e=>{if(Q(e),null!==M&&void 0!==M&&M.backend_id)try{await ye.uE.put("/memory-backend/configs/".concat(M.backend_id),{enable_relationship_retrieval:e})}catch(N){P("Failed to save advanced settings")}})(e.target.checked),color:"primary"}),label:(0,O.jsxs)(o.A,{children:[(0,O.jsx)(c.A,{variant:"body2",children:"Enable Relationship-Based Entity Retrieval"}),(0,O.jsx)(c.A,{variant:"caption",color:"text.secondary",children:"Experimental: Use graph-based relationships for smarter entity search instead of just semantic similarity."})]})})})}),(0,O.jsx)(te.A,{sx:{mt:1}})]}),(0,O.jsxs)(o.A,{children:[(0,O.jsx)(c.A,{variant:"caption",color:"text.secondary",sx:{display:"block",mb:.5},children:"Indexes:"}),(0,O.jsxs)(o.A,{children:[(null===(e=M.indexes)||void 0===e?void 0:e.document)&&(0,O.jsx)(Ho,{title:"Knowledge Base",subtitle:"The knowledge base contains documentation embeddings used to provide context when creating crews, agents, and tasks. This helps the AI understand available tools, patterns, and best practices.",savedConfig:M,endpointName:null===(t=M.endpoints)||void 0===t||null===(t=t.document)||void 0===t?void 0:t.name,endpointType:"document",indexes:[{type:"document",name:null===(n=M.indexes.document)||void 0===n?void 0:n.name}],indexInfoMap:K,endpointStatuses:L,isSettingUp:S,onRefresh:async()=>{var e;if(null===M||void 0===M||null===(e=M.indexes)||void 0===e||!e.document||null===M||void 0===M||!M.workspace_url||null===M||void 0===M||!M.backend_id)return;if(window.confirm("Are you sure you want to re-seed the documentation? This will empty the index and reload all documentation.")){_(!0),P("");try{var t,n;const e=M.indexes.document.name,a=null===(t=M.endpoints)||void 0===t||null===(t=t.document)||void 0===t?void 0:t.name;if(!a)return void P("Could not determine document endpoint");const s=(null===(n=(await ye.uE.get("/memory-backend/configs/".concat(M.backend_id))).data)||void 0===n||null===(n=n.databricks_config)||void 0===n?void 0:n.embedding_dimension)||768,i=await ye.uE.post("/memory-backend/databricks/empty-index",{workspace_url:M.workspace_url,index_name:e,endpoint_name:a,index_type:"document",embedding_dimension:s});if(!i.data.success)throw new Error(i.data.message||"Failed to empty document index");const o=await ye.uE.post("/documentation-embeddings/seed-all");o.data.success?(I({success:!0,message:"Documentation re-seeding initiated successfully. This may take a few minutes to complete.",info:"The document index has been emptied and re-seeding has started. Documents will be processed in the background."}),D(!0),setTimeout(()=>{be(e,a)},5e3)):P(o.data.message||"Failed to initiate documentation re-seeding")}catch(N){const t=N instanceof Error?N.message:"Failed to re-seed documentation";if(N&&"object"===typeof N&&"response"in N){var a;P((null===(a=N.response)||void 0===a||null===(a=a.data)||void 0===a?void 0:a.detail)||t)}else P(t)}finally{_(!1)}}},onEmpty:e=>je(e),onDelete:e=>Ae(e),onViewDocuments:we}),((null===(s=M.indexes)||void 0===s?void 0:s.short_term)||(null===(r=M.indexes)||void 0===r?void 0:r.long_term)||(null===(l=M.indexes)||void 0===l?void 0:l.entity))&&(0,O.jsx)(Ho,{title:"Memory Indexes",subtitle:"Memory indexes store agent conversations and interactions during runtime. Short-term memory holds recent context, long-term memory persists important information across sessions, and entity memory tracks relationships and facts about people, organizations, and concepts.",savedConfig:M,endpointName:null===(d=M.endpoints)||void 0===d||null===(d=d.memory)||void 0===d?void 0:d.name,endpointType:"memory",indexes:[M.indexes.short_term&&{type:"short_term",name:M.indexes.short_term.name},M.indexes.long_term&&{type:"long_term",name:M.indexes.long_term.name},M.indexes.entity&&{type:"entity",name:M.indexes.entity.name}].filter(e=>Boolean(e)),indexInfoMap:K,endpointStatuses:L,isSettingUp:S,onEmpty:e=>je(e),onDelete:e=>Ae(e),onVisualize:(e,t)=>de(t,e),onViewDocuments:we})]})]})]})})})]})}),(0,O.jsx)(Bi.A,{in:"disabled"===p,children:(0,O.jsx)(m.A,{severity:"info",sx:{mt:2},children:"Memory storage is disabled. Agents will not persist information between conversations."})}),(0,O.jsx)(Wo,{open:T,onClose:()=>D(!1),setupResult:E,workspaceUrl:v||"",savedConfigWorkspaceUrl:null===M||void 0===M?void 0:M.workspace_url}),(0,O.jsx)(nr,{open:re,onClose:ce,indexName:null===le||void 0===le?void 0:le.name,workspaceUrl:null===M||void 0===M?void 0:M.workspace_url,endpointName:null===M||void 0===M||null===(h=M.endpoints)||void 0===h||null===(h=h.memory)||void 0===h?void 0:h.name}),se&&(0,O.jsx)(sr,{open:ne,onClose:()=>{ae(!1),ie(null)},indexName:se.name,indexType:se.type,workspaceUrl:(null===M||void 0===M?void 0:M.workspace_url)||"",endpointName:se.endpointName,backendId:null===M||void 0===M?void 0:M.backend_id})]})]}):(0,O.jsxs)(o.A,{children:[(0,O.jsx)(o.A,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",mb:3},children:(0,O.jsxs)(o.A,{sx:{display:"flex",alignItems:"center"},children:[(0,O.jsx)(_o.A,{sx:{mr:1.5,color:"primary.main",fontSize:"1.4rem"}}),(0,O.jsx)(c.A,{variant:"h6",children:"Memory Configuration"})]})}),(0,O.jsx)(_e.A,{variant:"outlined",sx:{p:3,borderRadius:2,bgcolor:"background.paper",display:"flex",justifyContent:"center",alignItems:"center",minHeight:200},children:(0,O.jsxs)(o.A,{sx:{textAlign:"center"},children:[(0,O.jsx)(ue.A,{size:40,sx:{mb:2}}),(0,O.jsx)(c.A,{variant:"body2",color:"text.secondary",children:"Loading memory configuration..."})]})})]})};var or=n(51275),rr=n(74748),lr=n(62246),dr=n(57516);const cr=["children","value","index"];function ur(e){const{children:t,value:n,index:i}=e,r=(0,s.A)(e,cr);return(0,O.jsx)("div",(0,a.A)((0,a.A)({role:"tabpanel",hidden:n!==i,id:"database-tabpanel-".concat(i)},r),{},{children:n===i&&(0,O.jsx)(o.A,{sx:{py:2},children:t})}))}const hr=()=>{const[e,t]=(0,i.useState)(!1),[n,s]=(0,i.useState)(null),[h,p]=(0,i.useState)(null),[g,f]=(0,i.useState)(null),[v,A]=(0,i.useState)(null),[y,b]=(0,i.useState)(!1),[j,w]=(0,i.useState)(!1),[k,C]=(0,i.useState)(null),[S,_]=(0,i.useState)(null),[E,I]=(0,i.useState)(0),[T,D]=(0,i.useState)("disabled"),[N,P]=(0,i.useState)("connect"),[M,z]=(0,i.useState)({enabled:!1,instance_name:"kasal-lakebase",capacity:"CU_1",retention_days:14,node_count:1,instance_status:"NOT_CREATED"}),[L,F]=(0,i.useState)(!1),[W,U]=(0,i.useState)(!1),[K]=(0,i.useState)(!1),[G,J]=(0,i.useState)({lakebaseConfig:!1,migration:!1}),[q,Y]=(0,i.useState)(!1),[X,Z]=(0,i.useState)("users"),[Q,$]=(0,i.useState)("default"),[ne,ae]=(0,i.useState)("kasal_backups"),[se,ie]=(0,i.useState)("sql");(0,i.useEffect)(()=>{me(),pe()},[]);const me=async()=>{try{t(!0);const e=await ye.uE.get("/database-management/info");f(e.data)}catch(e){s("Failed to load database information")}finally{t(!1)}},pe=async()=>{try{const e=await ye.uE.get("/database-management/lakebase/config");z(e.data),D(e.data.enabled?"lakebase":"disabled"),e.data.instance_name&&await xe(e.data.instance_name)}catch(e){}},xe=async e=>{try{var t;U(!0);const n=await ye.uE.get("/database-management/lakebase/instance/".concat(e));let s;const i=null===(t=n.data.state)||void 0===t?void 0:t.toUpperCase();s="READY"===i||"AVAILABLE"===i||"RUNNING"===i?"READY":"STOPPED"===i||"STOPPING"===i?"STOPPED":"CREATING"===i||"STARTING"===i?"CREATING":"ERROR"===i||"FAILED"===i?"ERROR":"NOT_FOUND"===i?"NOT_FOUND":n.data.read_write_dns?"READY":"STOPPED",z(e=>(0,a.A)((0,a.A)({},e),{},{instance_status:s,endpoint:n.data.read_write_dns,created_at:n.data.created_at}))}catch(s){var n;404===(null===(n=s.response)||void 0===n?void 0:n.status)&&z(e=>(0,a.A)((0,a.A)({},e),{},{instance_status:"NOT_CREATED"}))}finally{U(!1)}},ge=async()=>{try{F(!0),s(null);const e=await ye.uE.post("/database-management/lakebase/create",{instance_name:M.instance_name,capacity:M.capacity,retention_days:M.retention_days,node_count:M.node_count});z(t=>(0,a.A)((0,a.A)({},t),{},{enabled:!0,instance_status:"READY",endpoint:e.data.read_write_dns,created_at:e.data.created_at})),p('Lakebase instance "'.concat(e.data.name,'" created successfully!')),await fe()}catch(t){var e;s((null===(e=t.response)||void 0===e||null===(e=e.data)||void 0===e?void 0:e.detail)||"Failed to create Lakebase instance")}finally{F(!1)}},fe=async()=>{try{t(!0),s(null);const e=(0,a.A)((0,a.A)({},M),{},{enabled:"lakebase"===T}),n=await ye.uE.post("/database-management/lakebase/config",e);z(n.data),p("Lakebase configuration saved successfully!")}catch(n){var e;s((null===(e=n.response)||void 0===e||null===(e=e.data)||void 0===e?void 0:e.detail)||"Failed to save Lakebase configuration")}finally{t(!1)}},ve=e=>new Date(e).toLocaleString(),Ae=e=>e<1?"".concat((1024*e).toFixed(2)," KB"):e>1024?"".concat((e/1024).toFixed(2)," GB"):"".concat(e.toFixed(2)," MB"),be=async()=>{try{t(!0);const e=await ye.uE.post("/database-management/list-backups",{catalog:X,schema:Q,volume:ne});A(e.data)}catch(n){var e;s((null===(e=n.response)||void 0===e||null===(e=e.data)||void 0===e?void 0:e.error)||"Failed to load backups")}finally{t(!1)}};return(0,O.jsxs)(o.A,{children:[(0,O.jsx)(c.A,{variant:"h6",sx:{mb:3},children:"Database Management"}),(0,O.jsx)(_e.A,{sx:{mb:3},children:(0,O.jsxs)(ea.A,{value:E,onChange:(e,t)=>{I(t)},children:[(0,O.jsx)(ta.A,{label:"General",icon:(0,O.jsx)(Xo.A,{})}),(0,O.jsx)(ta.A,{label:"Databricks Import/Export",icon:(0,O.jsx)(or.A,{})}),(0,O.jsx)(ta.A,{label:"Lakebase",icon:(0,O.jsx)(rr.A,{})})]})}),(0,O.jsx)(ur,{value:E,index:0,children:g&&(0,O.jsx)(ee.A,{sx:{mb:3},children:(0,O.jsxs)(Xt.A,{children:[(0,O.jsx)(c.A,{variant:"h6",gutterBottom:!0,children:"Database Information"}),(0,O.jsxs)(ce.Ay,{container:!0,spacing:2,children:[(0,O.jsxs)(ce.Ay,{item:!0,xs:12,md:6,children:[(0,O.jsx)(c.A,{variant:"body2",color:"text.secondary",children:"Type"}),(0,O.jsx)(c.A,{variant:"body1",children:g.database_type})]}),(0,O.jsxs)(ce.Ay,{item:!0,xs:12,md:6,children:[(0,O.jsx)(c.A,{variant:"body2",color:"text.secondary",children:"Size"}),(0,O.jsx)(c.A,{variant:"body1",children:Ae(g.size_mb||0)})]}),(0,O.jsxs)(ce.Ay,{item:!0,xs:12,children:[(0,O.jsx)(c.A,{variant:"body2",color:"text.secondary",children:"Path"}),(0,O.jsx)(c.A,{variant:"body1",sx:{wordBreak:"break-all"},children:g.database_path})]}),(0,O.jsxs)(ce.Ay,{item:!0,xs:12,md:6,children:[(0,O.jsx)(c.A,{variant:"body2",color:"text.secondary",children:"Created"}),(0,O.jsx)(c.A,{variant:"body1",children:ve(g.created_at||"")})]}),(0,O.jsxs)(ce.Ay,{item:!0,xs:12,md:6,children:[(0,O.jsx)(c.A,{variant:"body2",color:"text.secondary",children:"Modified"}),(0,O.jsx)(c.A,{variant:"body1",children:ve(g.modified_at||"")})]}),g.tables&&(0,O.jsxs)(ce.Ay,{item:!0,xs:12,children:[(0,O.jsxs)(c.A,{variant:"body2",color:"text.secondary",children:["Tables (",g.total_tables,")"]}),(0,O.jsx)(o.A,{sx:{mt:1},children:Object.entries(g.tables).map(e=>{let[t,n]=e;return(0,O.jsx)(R.A,{label:"".concat(t," (").concat(n," rows)"),size:"small",sx:{m:.5}},t)})})]})]})]})})}),(0,O.jsx)(ur,{value:E,index:1,children:(0,O.jsx)(ee.A,{children:(0,O.jsxs)(Xt.A,{children:[(0,O.jsx)(c.A,{variant:"h6",gutterBottom:!0,children:"Databricks Volume Settings"}),(0,O.jsxs)(ce.Ay,{container:!0,spacing:2,sx:{mb:3},children:[(0,O.jsx)(ce.Ay,{item:!0,xs:12,md:4,children:(0,O.jsx)(V.A,{fullWidth:!0,label:"Catalog",value:X,onChange:e=>Z(e.target.value)})}),(0,O.jsx)(ce.Ay,{item:!0,xs:12,md:4,children:(0,O.jsx)(V.A,{fullWidth:!0,label:"Schema",value:Q,onChange:e=>$(e.target.value)})}),(0,O.jsx)(ce.Ay,{item:!0,xs:12,md:4,children:(0,O.jsx)(V.A,{fullWidth:!0,label:"Volume Name",value:ne,onChange:e=>ae(e.target.value)})})]}),(0,O.jsxs)(o.A,{sx:{display:"flex",gap:2,mb:3},children:[(0,O.jsx)(x.A,{variant:"contained",startIcon:(0,O.jsx)(ai.A,{}),onClick:()=>b(!0),children:"Export to Volume"}),(0,O.jsx)(x.A,{variant:"outlined",startIcon:(0,O.jsx)(lr.A,{}),onClick:()=>{be(),w(!0)},children:"Import from Volume"}),(0,O.jsx)(x.A,{variant:"outlined",startIcon:(0,O.jsx)(Bo.A,{}),onClick:be,children:"List Backups"})]}),v&&v.backups&&v.backups.length>0&&(0,O.jsxs)(o.A,{children:[(0,O.jsxs)(c.A,{variant:"subtitle1",gutterBottom:!0,children:["Available Backups (",v.total_backups,")"]}),v.volume_path&&(0,O.jsxs)(c.A,{variant:"body2",color:"text.secondary",sx:{mb:2},children:["Volume Path: ",v.volume_path]}),(0,O.jsx)(at.A,{children:v.backups.map(e=>(0,O.jsxs)(st.Ay,{divider:!0,children:[(0,O.jsx)(ot.A,{primary:e.filename,secondary:"".concat(Ae(e.size_mb)," \u2022 ").concat(ve(e.created_at))}),(0,O.jsx)(ti.A,{children:e.databricks_url&&(0,O.jsx)(u.A,{edge:"end",onClick:()=>window.open(e.databricks_url,"_blank"),title:"View in Databricks",children:(0,O.jsx)(dr.A,{})})})]},e.filename))})]})]})})}),(0,O.jsx)(ur,{value:E,index:2,children:(0,O.jsxs)(_e.A,{sx:{p:3},children:[(0,O.jsxs)(oe.A,{component:"fieldset",sx:{mb:3},children:[(0,O.jsx)(Gt.A,{component:"legend",children:(0,O.jsx)(c.A,{variant:"h6",sx:{mb:2},children:"Database Backend Configuration"})}),(0,O.jsxs)(Jt.A,{value:T,onChange:async e=>{const n=e.target.value;if("disabled"!==n||"lakebase"!==T){D(n),z(e=>(0,a.A)((0,a.A)({},e),{},{enabled:"lakebase"===n}));try{t(!0),s(null);const e=(0,a.A)((0,a.A)({},M),{},{enabled:"lakebase"===n});await ye.uE.post("/database-management/lakebase/config",e),p("disabled"===n?"Lakebase disabled and configuration deleted. System now using PostgreSQL/SQLite.":"Lakebase enabled. System will use Lakebase when available.")}catch(o){var i;s((null===(i=o.response)||void 0===i||null===(i=i.data)||void 0===i?void 0:i.detail)||"Failed to update Lakebase configuration"),D("lakebase"===n?"disabled":"lakebase"),z(e=>(0,a.A)((0,a.A)({},e),{},{enabled:"lakebase"!==n}))}finally{t(!1)}}else Y(!0)},children:[(0,O.jsx)(he.A,{value:"disabled",control:(0,O.jsx)(qt.A,{}),label:(0,O.jsxs)(o.A,{children:[(0,O.jsx)(c.A,{variant:"body1",children:"Disabled"}),(0,O.jsx)(c.A,{variant:"caption",color:"text.secondary",children:"Use default SQLite/PostgreSQL database"})]})}),(0,O.jsx)(he.A,{value:"lakebase",control:(0,O.jsx)(qt.A,{}),label:(0,O.jsxs)(o.A,{children:[(0,O.jsx)(c.A,{variant:"body1",children:"Databricks Lakebase"}),(0,O.jsx)(c.A,{variant:"caption",color:"text.secondary",children:"Fully-managed PostgreSQL OLTP engine within Databricks"})]})})]})]}),"lakebase"===T&&(0,O.jsxs)(O.Fragment,{children:[(0,O.jsx)(te.A,{sx:{mb:3}}),(0,O.jsxs)(o.A,{sx:{mb:3},children:[(0,O.jsxs)(c.A,{variant:"subtitle1",sx:{mb:2,display:"flex",alignItems:"center"},children:[(0,O.jsx)(Xo.A,{sx:{mr:1}}),"Current Status"]}),(0,O.jsxs)(ce.Ay,{container:!0,spacing:2,alignItems:"center",children:[(0,O.jsx)(ce.Ay,{item:!0,children:(0,O.jsx)(R.A,{icon:(e=>{switch(e){case"READY":return(0,O.jsx)(oi.A,{color:"success"});case"CREATING":return(0,O.jsx)(ue.A,{size:16});case"STOPPED":return(0,O.jsx)(ts.A,{color:"warning"});case"ERROR":return(0,O.jsx)(ri.A,{color:"error"});default:return(0,O.jsx)(Ro.A,{color:"info"})}})(M.instance_status),label:M.instance_status||"NOT_CONFIGURED",color:"READY"===M.instance_status?"success":"default"})}),M.instance_name&&"READY"===M.instance_status&&(0,O.jsx)(ce.Ay,{item:!0,children:(0,O.jsxs)(c.A,{variant:"body2",color:"text.secondary",children:["Instance: ",M.instance_name]})}),M.endpoint&&"READY"===M.instance_status&&(0,O.jsx)(ce.Ay,{item:!0,xs:12,children:(0,O.jsxs)(c.A,{variant:"body2",color:"text.secondary",children:["Endpoint: ",M.endpoint]})})]}),"READY"===M.instance_status&&(0,O.jsxs)(o.A,{sx:{mt:2},children:[(0,O.jsx)(x.A,{variant:"outlined",size:"small",startIcon:(0,O.jsx)(dr.A,{}),onClick:async()=>{const e=await(async()=>{try{const t=await ke.O.getConfiguration();let n=(null===t||void 0===t?void 0:t.workspace_url)||"";if(!n||"compute"===n||!n.includes("."))if(window.location.hostname.includes("databricks"))n="https://".concat(window.location.hostname);else try{n=(await ye.uE.get("/databricks/workspace-url")).data.workspace_url||""}catch(e){}return n?(n.endsWith("/")&&(n=n.slice(0,-1)),n.startsWith("http://")||n.startsWith("https://")||(n="https://".concat(n)),"".concat(n,"/compute/database-instances/").concat(M.instance_name)):"#"}catch(t){return"#"}})();window.open(e,"_blank")},children:"View in Databricks"}),(0,O.jsx)(x.A,{variant:"outlined",size:"small",startIcon:(0,O.jsx)(Bo.A,{}),onClick:()=>xe(M.instance_name),disabled:W,sx:{ml:1},children:"Refresh Status"})]})]}),(0,O.jsx)(te.A,{sx:{mb:3}}),(0,O.jsxs)(o.A,{sx:{mb:3},children:[(0,O.jsx)(c.A,{variant:"subtitle1",sx:{mb:2},children:"How would you like to set up Lakebase?"}),(0,O.jsxs)(ce.Ay,{container:!0,spacing:2,children:[(0,O.jsx)(ce.Ay,{item:!0,xs:12,md:6,children:(0,O.jsx)(ee.A,{variant:"connect"===N?"outlined":"elevation",sx:{border:"connect"===N?"2px solid":"none",borderColor:"connect"===N?"primary.main":"transparent",cursor:"pointer",height:"100%"},onClick:()=>P("connect"),children:(0,O.jsxs)(Xt.A,{children:[(0,O.jsx)(c.A,{variant:"h6",gutterBottom:!0,color:"connect"===N?"primary":"inherit",children:"Connect to Existing Instance"}),(0,O.jsx)(c.A,{variant:"body2",color:"text.secondary",children:"I already have a Lakebase instance and want to connect to it"})]})})}),(0,O.jsx)(ce.Ay,{item:!0,xs:12,md:6,children:(0,O.jsx)(ee.A,{variant:"create"===N?"outlined":"elevation",sx:{border:"create"===N?"2px solid":"none",borderColor:"create"===N?"primary.main":"transparent",cursor:"pointer",height:"100%"},onClick:()=>P("create"),children:(0,O.jsxs)(Xt.A,{children:[(0,O.jsx)(c.A,{variant:"h6",gutterBottom:!0,color:"create"===N?"primary":"inherit",children:"Create New Instance"}),(0,O.jsx)(c.A,{variant:"body2",color:"text.secondary",children:"Create a new Lakebase instance in my Databricks workspace"})]})})})]})]}),"connect"===N&&(0,O.jsx)(o.A,{sx:{mb:3},children:(0,O.jsxs)(_e.A,{sx:{p:2,backgroundColor:"background.default"},children:[(0,O.jsx)(c.A,{variant:"subtitle2",sx:{mb:2,fontWeight:"bold"},children:"Connect to Existing Lakebase Instance"}),(0,O.jsxs)(ce.Ay,{container:!0,spacing:2,children:[(0,O.jsx)(ce.Ay,{item:!0,xs:12,children:(0,O.jsx)(V.A,{fullWidth:!0,label:"Instance Name",value:M.instance_name,onChange:e=>z((0,a.A)((0,a.A)({},M),{},{instance_name:e.target.value})),helperText:"Name of your existing Lakebase instance",placeholder:"kasal-lakebase",required:!0})}),(0,O.jsx)(ce.Ay,{item:!0,xs:12,children:(0,O.jsx)(V.A,{fullWidth:!0,label:"Endpoint (Optional)",value:M.endpoint||"",onChange:e=>z((0,a.A)((0,a.A)({},M),{},{endpoint:e.target.value,instance_status:e.target.value?"READY":"NOT_CREATED"})),helperText:"Leave empty to auto-detect, or enter manually (e.g., instance-xxxx.database.cloud.databricks.com)",placeholder:"instance-xxxx.database.cloud.databricks.com"})}),(0,O.jsx)(ce.Ay,{item:!0,xs:12,children:(0,O.jsx)(x.A,{variant:"contained",onClick:async()=>{try{t(!0),await xe(M.instance_name),await fe(),p("Successfully connected to existing Lakebase instance")}catch(e){s("Failed to connect to instance. Please verify the instance name.")}finally{t(!1)}},disabled:!M.instance_name||e,children:"Connect to Instance"})})]})]})}),"create"===N&&(0,O.jsx)(o.A,{sx:{mb:3},children:(0,O.jsxs)(_e.A,{sx:{p:2,backgroundColor:"background.default"},children:[(0,O.jsx)(c.A,{variant:"subtitle2",sx:{mb:2,fontWeight:"bold"},children:"Create New Lakebase Instance"}),(0,O.jsxs)(ce.Ay,{container:!0,spacing:2,children:[(0,O.jsx)(ce.Ay,{item:!0,xs:12,md:6,children:(0,O.jsx)(V.A,{fullWidth:!0,label:"Instance Name",value:M.instance_name,onChange:e=>z((0,a.A)((0,a.A)({},M),{},{instance_name:e.target.value})),helperText:"1-63 characters, letters and hyphens only",placeholder:"kasal-lakebase",required:!0})}),(0,O.jsx)(ce.Ay,{item:!0,xs:12,md:6,children:(0,O.jsxs)(oe.A,{fullWidth:!0,children:[(0,O.jsx)(re.A,{children:"Capacity"}),(0,O.jsxs)(le.A,{value:M.capacity,onChange:e=>z((0,a.A)((0,a.A)({},M),{},{capacity:e.target.value})),label:"Capacity",children:[(0,O.jsx)(de.A,{value:"CU_1",children:"CU_1 (Small - 1 compute unit)"}),(0,O.jsx)(de.A,{value:"CU_2",children:"CU_2 (Medium - 2 compute units)"}),(0,O.jsx)(de.A,{value:"CU_4",children:"CU_4 (Large - 4 compute units)"})]}),(0,O.jsx)($e.A,{children:"Select compute capacity based on your workload"})]})}),(0,O.jsx)(ce.Ay,{item:!0,xs:12,md:6,children:(0,O.jsx)(V.A,{fullWidth:!0,type:"number",label:"Backup Retention (Days)",value:M.retention_days,onChange:e=>z((0,a.A)((0,a.A)({},M),{},{retention_days:parseInt(e.target.value)})),inputProps:{min:2,max:35},helperText:"How long to keep backups (2-35 days)"})}),(0,O.jsx)(ce.Ay,{item:!0,xs:12,md:6,children:(0,O.jsx)(V.A,{fullWidth:!0,type:"number",label:"High Availability Nodes",value:M.node_count,onChange:e=>z((0,a.A)((0,a.A)({},M),{},{node_count:parseInt(e.target.value)})),inputProps:{min:1,max:3},helperText:"1 = Basic, 2+ = High Availability"})}),(0,O.jsxs)(ce.Ay,{item:!0,xs:12,children:[(0,O.jsx)(m.A,{severity:"info",sx:{mb:2},children:"Creating a new instance will provision resources in your Databricks workspace. This may take 3-5 minutes."}),(0,O.jsx)(x.A,{variant:"contained",onClick:ge,disabled:!M.instance_name||L||"READY"===M.instance_status,children:L?"Creating Instance...":"Create Instance"})]})]})]})}),M.endpoint&&(0,O.jsx)(O.Fragment,{children:(0,O.jsxs)(o.A,{sx:{mb:3},children:[(0,O.jsx)(x.A,{onClick:()=>{return e="migration",void J(t=>(0,a.A)((0,a.A)({},t),{},{[e]:!t[e]}));var e},endIcon:G.migration?(0,O.jsx)(To.A,{}):(0,O.jsx)(Do.A,{}),sx:{mb:2},children:"Migration Status"}),(0,O.jsxs)(Bi.A,{in:G.migration,children:[M.migration_status?(0,O.jsxs)(m.A,{severity:"completed"===M.migration_status?"success":"failed"===M.migration_status?"error":"info",children:[(0,O.jsxs)(c.A,{variant:"body2",children:["Migration Status: ",(0,O.jsx)("strong",{children:M.migration_status}),M.migration_result&&(0,O.jsxs)("span",{children:[" (",M.migration_result.total_tables," tables, ",M.migration_result.total_rows," rows)"]})]}),M.migration_error&&(0,O.jsxs)(c.A,{variant:"caption",color:"error.main",sx:{display:"block",mt:.5},children:["Error: ",M.migration_error]})]}):(0,O.jsx)(m.A,{severity:"warning",children:"No migration has been performed yet. Click 'Migrate Data' to start migration."}),!M.migration_completed&&(0,O.jsx)(x.A,{variant:"contained",color:"warning",onClick:async()=>{try{t(!0),s(null),await ye.uE.post("/database-management/lakebase/migrate",{instance_name:M.instance_name,endpoint:M.endpoint}),p("Migration started successfully"),await pe()}catch(n){var e;s((null===(e=n.response)||void 0===e||null===(e=e.data)||void 0===e?void 0:e.detail)||"Failed to start migration")}finally{t(!1)}},disabled:e,sx:{mt:2},children:"Migrate Data to Lakebase"})]})]})}),(0,O.jsxs)(o.A,{sx:{mt:3,display:"flex",gap:2},children:[!K&&"NOT_CREATED"===M.instance_status&&(0,O.jsx)(x.A,{variant:"contained",startIcon:L?(0,O.jsx)(ue.A,{size:20}):(0,O.jsx)(H.A,{}),onClick:ge,disabled:L||!M.instance_name,children:"Create Lakebase Instance"}),(K||"NOT_CREATED"!==M.instance_status)&&(0,O.jsx)(x.A,{variant:"contained",startIcon:(0,O.jsx)(Wn.A,{}),onClick:fe,disabled:e||!K&&"NOT_CREATED"===M.instance_status,children:"Save Configuration"})]}),(0,O.jsxs)(m.A,{severity:"info",sx:{mt:3},children:[(0,O.jsxs)(c.A,{variant:"body2",children:[(0,O.jsx)("strong",{children:"Lakebase"})," is a fully-managed PostgreSQL OLTP engine within Databricks that provides:"]}),(0,O.jsxs)("ul",{style:{margin:"8px 0 0 0",paddingLeft:"20px"},children:[(0,O.jsx)("li",{children:"High availability with automatic failover"}),(0,O.jsx)("li",{children:"Point-in-time restore and automated backups"}),(0,O.jsx)("li",{children:"Built-in monitoring and alerting"}),(0,O.jsx)("li",{children:"Seamless integration with Databricks ecosystem"})]})]})]})]})}),(0,O.jsxs)(r.A,{open:y,onClose:()=>b(!1),maxWidth:"sm",fullWidth:!0,children:[(0,O.jsx)(d.A,{children:"Export Database to Databricks Volume"}),(0,O.jsx)(l.A,{children:(0,O.jsxs)(o.A,{sx:{pt:2},children:[(0,O.jsxs)(oe.A,{fullWidth:!0,sx:{mb:2},children:[(0,O.jsx)(re.A,{children:"Export Format"}),(0,O.jsxs)(le.A,{value:se,onChange:e=>ie(e.target.value),label:"Export Format",children:[(0,O.jsx)(de.A,{value:"sql",children:"SQL"}),(0,O.jsx)(de.A,{value:"json",children:"JSON"}),(0,O.jsx)(de.A,{value:"csv",children:"CSV"})]})]}),(0,O.jsxs)(m.A,{severity:"info",children:["Database will be exported to: /Volumes/",X,"/",Q,"/",ne,"/"]})]})}),(0,O.jsxs)(B.A,{children:[(0,O.jsx)(x.A,{onClick:()=>b(!1),children:"Cancel"}),(0,O.jsx)(x.A,{onClick:async()=>{try{t(!0),s(null);const e=await ye.uE.post("/database-management/export",{catalog:X,schema:Q,volume:ne,format:se});_(e.data),e.data.success?(p("Database exported successfully!"),b(!1),be()):s(e.data.error||"Export failed")}catch(n){var e;s((null===(e=n.response)||void 0===e||null===(e=e.data)||void 0===e?void 0:e.error)||"Failed to export database")}finally{t(!1)}},variant:"contained",disabled:e,children:e?(0,O.jsx)(ue.A,{size:20}):"Export"})]})]}),(0,O.jsxs)(r.A,{open:j,onClose:()=>w(!1),maxWidth:"md",fullWidth:!0,children:[(0,O.jsx)(d.A,{children:"Import Database from Databricks Volume"}),(0,O.jsx)(l.A,{children:v&&v.backups&&v.backups.length>0?(0,O.jsxs)(o.A,{sx:{pt:2},children:[(0,O.jsx)(c.A,{variant:"body2",sx:{mb:2},children:"Select a backup to import:"}),(0,O.jsx)(at.A,{children:v.backups.map(e=>(0,O.jsx)(st.Ay,{button:!0,selected:k===e.filename,onClick:()=>C(e.filename),children:(0,O.jsx)(ot.A,{primary:e.filename,secondary:"".concat(Ae(e.size_mb)," \u2022 ").concat(ve(e.created_at))})},e.filename))}),(0,O.jsx)(m.A,{severity:"warning",sx:{mt:2},children:"Warning: This will replace the current database with the selected backup."})]}):(0,O.jsx)(o.A,{sx:{pt:2},children:(0,O.jsx)(m.A,{severity:"info",children:"No backups found in the specified volume."})})}),(0,O.jsxs)(B.A,{children:[(0,O.jsx)(x.A,{onClick:()=>w(!1),children:"Cancel"}),(0,O.jsx)(x.A,{onClick:async()=>{if(k)try{t(!0),s(null);const e=await ye.uE.post("/database-management/import",{catalog:X,schema:Q,volume:ne,filename:k});e.data.success?(p("Database imported successfully from ".concat(e.data.backup_filename,"!")),w(!1),me()):s(e.data.error||"Import failed")}catch(n){var e;s((null===(e=n.response)||void 0===e||null===(e=e.data)||void 0===e?void 0:e.error)||"Failed to import database")}finally{t(!1)}else s("Please select a backup file to import")},variant:"contained",color:"warning",disabled:e||!k,children:e?(0,O.jsx)(ue.A,{size:20}):"Import"})]})]}),S&&(0,O.jsxs)(r.A,{open:!0,onClose:()=>_(null),maxWidth:"md",fullWidth:!0,children:[(0,O.jsx)(d.A,{children:"Export Complete"}),(0,O.jsx)(l.A,{children:(0,O.jsxs)(o.A,{sx:{pt:2},children:[(0,O.jsx)(m.A,{severity:"success",sx:{mb:2},children:"Database exported successfully!"}),(0,O.jsxs)(c.A,{variant:"body2",sx:{mb:1},children:[(0,O.jsx)("strong",{children:"Backup Path:"})," ",S.volume_path]}),S.backup_filename&&(0,O.jsxs)(c.A,{variant:"body2",sx:{mb:1},children:[(0,O.jsx)("strong",{children:"Filename:"})," ",S.backup_filename]}),S.size_mb&&(0,O.jsxs)(c.A,{variant:"body2",sx:{mb:1},children:[(0,O.jsx)("strong",{children:"Size:"})," ",Ae(S.size_mb)]}),S.volume_browse_url&&(0,O.jsx)(x.A,{variant:"outlined",startIcon:(0,O.jsx)(dr.A,{}),onClick:()=>window.open(S.volume_browse_url,"_blank"),sx:{mt:2},children:"View in Databricks"})]})}),(0,O.jsx)(B.A,{children:(0,O.jsx)(x.A,{onClick:()=>_(null),children:"Close"})})]}),h&&(0,O.jsx)(m.A,{severity:"success",onClose:()=>p(null),sx:{mt:2},children:h}),n&&(0,O.jsx)(m.A,{severity:"error",onClose:()=>s(null),sx:{mt:2},children:n}),(0,O.jsxs)(r.A,{open:q,onClose:()=>Y(!1),maxWidth:"sm",fullWidth:!0,children:[(0,O.jsx)(d.A,{children:(0,O.jsxs)(o.A,{sx:{display:"flex",alignItems:"center",gap:1},children:[(0,O.jsx)(ts.A,{color:"warning"}),"Disable Databricks Lakebase"]})}),(0,O.jsxs)(l.A,{children:[(0,O.jsx)(c.A,{variant:"body1",sx:{mb:2},children:"Are you sure you want to disable Databricks Lakebase?"}),(0,O.jsx)(m.A,{severity:"info",sx:{mb:2},children:(0,O.jsxs)(c.A,{variant:"body2",component:"div",children:["This action will:",(0,O.jsxs)("ul",{style:{margin:"8px 0",paddingLeft:"20px"},children:[(0,O.jsx)("li",{children:"Delete the Lakebase configuration from your database"}),(0,O.jsxs)("li",{children:["Revert all database operations to ",(0,O.jsx)("strong",{children:"SQLite"})," (in Databricks Apps) or ",(0,O.jsx)("strong",{children:"PostgreSQL"})," (in local development)"]}),(0,O.jsx)("li",{children:"Keep your Lakebase instance running (if created) - you can re-enable it later"}),(0,O.jsx)("li",{children:"Preserve any data already migrated to Lakebase"})]})]})}),(0,O.jsx)(c.A,{variant:"body2",color:"text.secondary",children:"Note: You can re-enable Lakebase at any time by selecting it again."})]}),(0,O.jsxs)(B.A,{children:[(0,O.jsx)(x.A,{onClick:()=>Y(!1),children:"Cancel"}),(0,O.jsx)(x.A,{onClick:async()=>{Y(!1),D("disabled"),z(e=>(0,a.A)((0,a.A)({},e),{},{enabled:!1}));try{t(!0),s(null);const e=(0,a.A)((0,a.A)({},M),{},{enabled:!1});await ye.uE.post("/database-management/lakebase/config",e),p("Lakebase disabled and configuration deleted. System now using SQLite (or PostgreSQL in local development).")}catch(n){var e;s((null===(e=n.response)||void 0===e||null===(e=e.data)||void 0===e?void 0:e.detail)||"Failed to disable Lakebase"),D("lakebase"),z(e=>(0,a.A)((0,a.A)({},e),{},{enabled:!0}))}finally{t(!1)}},color:"warning",variant:"contained",startIcon:(0,O.jsx)(Xo.A,{}),children:"Disable and Use SQLite/PostgreSQL"})]})]})]})};var mr=n(19489),pr=n(52472),xr=n(49380);class gr{static getInstance(){return gr.instance||(gr.instance=new gr),gr.instance}async getUsers(){return(await ye.uE.get("/users")).data}async getCurrentUser(){return(await ye.uE.get("/users/me")).data}async updateUserPermissions(e,t){return(await ye.uE.put("/users/".concat(e,"/permissions"),t)).data}async getUser(e){return(await ye.uE.get("/users/".concat(e))).data}async deleteUser(e){await ye.uE.delete("/users/".concat(e))}}gr.instance=void 0;var fr=n(79893),vr=n(50294),Ar=n(82092),yr=n(66141),br=n(93553),jr=n(45919),wr=n(76281);const kr=()=>{const{userRole:e,isLoading:t}=(0,Pn.o)(e=>({userRole:e.userRole,isLoading:e.isLoading})),[n,s]=(0,i.useState)([]),[g,f]=(0,i.useState)(null),[v,A]=(0,i.useState)([]),[y,b]=(0,i.useState)(!1),[j,w]=(0,i.useState)(!1),[k,C]=(0,i.useState)(!1),[S,_]=(0,i.useState)(null),[E,I]=(0,i.useState)(!1),[T,D]=(0,i.useState)(""),[N,M]=(0,i.useState)("groups"),[z,L]=(0,i.useState)(null),[F,W]=(0,i.useState)(null),[U,K]=(0,i.useState)(null),[G,J]=(0,i.useState)(null),[q,Y]=(0,i.useState)(!1),[X,Z]=(0,i.useState)(null),[Q,$]=(0,i.useState)({open:!1,message:"",severity:"success"}),[ne,ae]=(0,i.useState)(null),[se,ie]=(0,i.useState)("operator"),[ue,he]=(0,i.useState)([]),[me,pe]=(0,i.useState)(!1),[xe,ge]=(0,i.useState)({name:"",description:""}),[fe,ve]=(0,i.useState)({user_email:"",role:"operator"}),[Ae,ye]=(0,i.useState)([]),be=n.reduce((e,t)=>e+(t.user_count||0),0),je=n.filter(e=>e.name.toLowerCase().includes(T.toLowerCase())),we=(0,i.useCallback)(async()=>{I(!0);try{const e=Ve.B.getInstance(),t=await e.getGroups();s(t)}catch(e){Te("Failed to load workspaces","error")}finally{I(!1)}},[]);(0,i.useEffect)(()=>{we()},[we]);const ke=(0,i.useCallback)(async()=>{pe(!0);try{const e=gr.getInstance(),t=await e.getUsers();he(t)}catch(e){Te("Failed to load users","error")}finally{pe(!1)}},[]);(0,i.useEffect)(()=>{j&&ke()},[j,ke]);const Ce=async e=>{I(!0);try{const t=Ve.B.getInstance(),n=await t.getGroupUsers(e);A(n)}catch(t){Te("Failed to load team members","error")}finally{I(!1)}},Se=()=>{L(null),W(null)},Ee=()=>{K(null),J(null)},Ie=()=>{ae(null)},Te=(e,t)=>{$({open:!0,message:e,severity:t})},De=e=>{switch(e){case"admin":return"error";case"manager":return"warning";case"user":return"primary";default:return"default"}},Ne=e=>{switch(e){case"admin":return(0,O.jsx)(fr.A,{fontSize:"small"});case"editor":return(0,O.jsx)(Za.A,{fontSize:"small"});default:return(0,O.jsx)(vr.A,{fontSize:"small"})}},Pe=e=>{switch(e){case"admin":return"Full system control";case"editor":return"Can build and modify workflows";case"operator":return"Can execute workflows and monitor";default:return"Standard access"}};return t?(0,O.jsxs)(o.A,{sx:{p:3,textAlign:"center"},children:[(0,O.jsx)(ei.A,{sx:{mb:2}}),(0,O.jsx)(c.A,{color:"text.secondary",children:"Checking permissions..."})]}):"admin"!==e?(0,O.jsxs)(o.A,{sx:{p:3,textAlign:"center"},children:[(0,O.jsx)(ns.A,{sx:{bgcolor:"error.light",mx:"auto",mb:2,width:60,height:60},children:(0,O.jsx)(Ar.A,{fontSize:"large"})}),(0,O.jsx)(c.A,{variant:"h6",gutterBottom:!0,children:"Access Denied"}),(0,O.jsx)(c.A,{variant:"body2",color:"text.secondary",children:"You do not have permission to manage workspaces."}),(0,O.jsx)(c.A,{variant:"body2",color:"text.secondary",sx:{mt:1},children:"Only administrators can manage workspaces and team members."})]}):(0,O.jsx)(O.Fragment,{children:(0,O.jsxs)(o.A,{children:[(0,O.jsxs)(o.A,{sx:{mb:4},children:[(0,O.jsxs)(o.A,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",mb:2},children:[(0,O.jsxs)(o.A,{sx:{display:"flex",alignItems:"center"},children:[(0,O.jsx)(ns.A,{sx:{bgcolor:"primary.main",mr:2},children:(0,O.jsx)(yr.A,{})}),(0,O.jsxs)(o.A,{children:[(0,O.jsx)(c.A,{variant:"h5",fontWeight:"600",color:"text.primary",children:"Workspaces"}),(0,O.jsxs)(c.A,{variant:"body2",color:"text.secondary",children:["Create team workspaces for collaboration \u2022 ",n.length," workspaces \u2022 ",be," members"]})]})]}),(0,O.jsx)(mr.A,{in:!E,children:(0,O.jsx)(pr.A,{color:"primary",size:"medium",onClick:()=>b(!0),disabled:E,sx:{boxShadow:3},children:(0,O.jsx)(H.A,{})})})]}),E&&(0,O.jsx)(ei.A,{sx:{mb:2}})]}),(0,O.jsx)(ee.A,{sx:{mb:3},children:(0,O.jsx)(Xt.A,{children:(0,O.jsxs)(ce.Ay,{container:!0,spacing:2,alignItems:"center",children:[(0,O.jsx)(ce.Ay,{item:!0,xs:12,md:6,children:(0,O.jsx)(V.A,{fullWidth:!0,size:"small",placeholder:"Search workspaces by name...",value:T,onChange:e=>D(e.target.value),InputProps:{startAdornment:(0,O.jsx)(ar.A,{sx:{mr:1,color:"text.secondary"}})}})}),(0,O.jsx)(ce.Ay,{item:!0,xs:12,md:6})]})})}),(0,O.jsx)(m.A,{severity:"info",icon:(0,O.jsx)(br.A,{}),sx:{mb:3,borderRadius:2},children:(0,O.jsxs)(c.A,{variant:"body2",children:[(0,O.jsx)("strong",{children:"Secure Workspaces:"})," Each workspace provides isolated data and workflows. Users can belong to multiple workspaces and switch between them easily."]})}),(0,O.jsxs)(ce.Ay,{container:!0,spacing:3,children:[(0,O.jsx)(ce.Ay,{item:!0,xs:12,lg:8,children:(0,O.jsxs)(ee.A,{children:[(0,O.jsx)(Yt.A,{title:(0,O.jsxs)(o.A,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[(0,O.jsxs)(c.A,{variant:"h6",children:["Workspaces (",je.length,")"]}),(0,O.jsx)(x.A,{variant:"outlined",size:"small",startIcon:(0,O.jsx)(H.A,{}),onClick:()=>b(!0),children:"New Workspace"})]})}),(0,O.jsx)(te.A,{}),(0,O.jsx)(at.A,{children:0===je.length?(0,O.jsxs)(o.A,{sx:{textAlign:"center",py:6},children:[(0,O.jsx)(jr.A,{sx:{fontSize:64,color:"text.secondary",mb:2}}),(0,O.jsx)(c.A,{variant:"h6",color:"text.secondary",gutterBottom:!0,children:T?"No groups found":"No groups yet"}),(0,O.jsx)(c.A,{variant:"body2",color:"text.secondary",sx:{mb:3},children:T?"Try adjusting your search terms":"Create your first group to get started"}),!T&&(0,O.jsx)(x.A,{variant:"contained",startIcon:(0,O.jsx)(H.A,{}),onClick:()=>b(!0),children:"Create First Workspace"})]}):je.map((e,t)=>(0,O.jsxs)(i.Fragment,{children:[(0,O.jsxs)(st.Ay,{sx:{py:2,cursor:"pointer","&:hover":{bgcolor:"action.hover"},borderRadius:1,mx:1},onClick:()=>{f(e),Ce(e.id)},children:[(0,O.jsx)(Hs.A,{children:(0,O.jsx)(ns.A,{sx:{bgcolor:"active"===e.status?"success.main":"grey.400"},children:(0,O.jsx)(Ya.A,{})})}),(0,O.jsx)(ot.A,{primary:(0,O.jsxs)(o.A,{sx:{display:"flex",alignItems:"center",gap:1},children:[(0,O.jsx)(c.A,{variant:"subtitle1",fontWeight:"medium",children:e.name}),e.auto_created&&(0,O.jsx)(R.A,{label:"Auto-created",size:"small",variant:"outlined",sx:{height:20}})]}),secondary:(0,O.jsxs)(c.A,{variant:"body2",color:"text.secondary",children:[e.user_count||0," users \u2022 Created ",new Date(e.created_at||Date.now()).toLocaleDateString()]})}),(0,O.jsx)(ti.A,{children:(0,O.jsxs)(o.A,{sx:{display:"flex",gap:1},children:[(0,O.jsx)(P.A,{title:"Manage Users",children:(0,O.jsx)(u.A,{onClick:t=>{t.stopPropagation(),f(e),Ce(e.id)},children:(0,O.jsx)(vr.A,{})})}),(0,O.jsx)(P.A,{title:"Group Actions",children:(0,O.jsx)(u.A,{onClick:t=>((e,t)=>{e.stopPropagation(),L(e.currentTarget),W(t)})(t,e),children:(0,O.jsx)(wr.A,{})})})]})})]}),t<je.length-1&&(0,O.jsx)(te.A,{variant:"inset",component:"li"})]},e.id))})]})}),(0,O.jsx)(ce.Ay,{item:!0,xs:12,lg:4,children:(0,O.jsxs)(ee.A,{sx:{height:"fit-content",position:"sticky",top:16},children:[(0,O.jsx)(Yt.A,{title:(0,O.jsxs)(o.A,{sx:{display:"flex",alignItems:"center",gap:1},children:[(0,O.jsx)(vr.A,{}),(0,O.jsx)(c.A,{variant:"h6",children:g?"".concat(g.name," Members"):"Select a Workspace"})]}),action:g&&(0,O.jsx)(x.A,{variant:"contained",size:"small",startIcon:(0,O.jsx)(Ln.A,{}),onClick:()=>w(!0),disabled:E,children:"Add User"})}),(0,O.jsx)(te.A,{}),g?(0,O.jsxs)(o.A,{children:[(0,O.jsxs)(o.A,{sx:{p:2,bgcolor:"grey.50"},children:[(0,O.jsx)(c.A,{variant:"subtitle2",color:"primary",gutterBottom:!0,children:"Group Information"}),(0,O.jsxs)(c.A,{variant:"body2",color:"text.secondary",children:[(0,O.jsx)("strong",{children:"Total Users:"})," ",g.user_count||0]})]}),(0,O.jsx)(at.A,{children:0===v.length?(0,O.jsxs)(o.A,{sx:{textAlign:"center",py:4},children:[(0,O.jsx)(vr.A,{sx:{fontSize:48,color:"text.secondary",mb:1}}),(0,O.jsx)(c.A,{variant:"body2",color:"text.secondary",gutterBottom:!0,children:"No users in this group yet"}),(0,O.jsx)(x.A,{variant:"outlined",size:"small",startIcon:(0,O.jsx)(Ln.A,{}),onClick:()=>w(!0),children:"Add First User"})]}):v.map((e,t)=>(0,O.jsxs)(i.Fragment,{children:[(0,O.jsxs)(st.Ay,{children:[(0,O.jsx)(Hs.A,{children:(0,O.jsx)(ns.A,{sx:{bgcolor:De(e.role)+".main"},children:Ne(e.role)})}),(0,O.jsx)(ot.A,{primary:(0,O.jsx)(c.A,{variant:"subtitle2",children:e.email}),secondary:(0,O.jsxs)(o.A,{children:[(0,O.jsx)(o.A,{sx:{display:"flex",alignItems:"center",gap:.5,mt:.5},children:ne===(e.user_id||e.id)?(0,O.jsxs)(o.A,{sx:{display:"flex",alignItems:"center",gap:1},children:[(0,O.jsx)(oe.A,{size:"small",sx:{minWidth:120},children:(0,O.jsxs)(le.A,{value:se,onChange:e=>ie(e.target.value),sx:{height:28},children:[(0,O.jsx)(de.A,{value:"admin",children:"Admin"}),(0,O.jsx)(de.A,{value:"editor",children:"Editor"}),(0,O.jsx)(de.A,{value:"operator",children:"Operator"})]})}),(0,O.jsx)(x.A,{size:"small",variant:"contained",onClick:()=>(async(e,t)=>{if(g){I(!0);try{const n=Ve.B.getInstance();await n.updateGroupUser(g.id,e,{role:t}),Te("Member role updated to ".concat(t),"success"),ae(null),await Ce(g.id)}catch(n){Te("Failed to update member role","error")}finally{I(!1)}}})(e.user_id||e.id,se),disabled:E,sx:{height:28,minWidth:50},children:"Save"}),(0,O.jsx)(x.A,{size:"small",variant:"outlined",onClick:Ie,disabled:E,sx:{height:28,minWidth:50},children:"Cancel"})]}):(0,O.jsxs)(o.A,{sx:{display:"flex",alignItems:"center",gap:.5},children:[(0,O.jsx)(R.A,{icon:Ne(e.role),label:e.role,size:"small",color:De(e.role),sx:{height:20}}),(0,O.jsx)(P.A,{title:"Edit Role",children:(0,O.jsx)(u.A,{size:"small",onClick:()=>{return t=e.user_id||e.id,n=e.role,ae(t),void ie(n);var t,n},sx:{padding:"2px"},children:(0,O.jsx)(Za.A,{sx:{fontSize:16}})})})]})}),(0,O.jsxs)(c.A,{variant:"caption",color:"text.secondary",sx:{display:"block",mt:.5},children:[Pe(e.role),e.auto_created&&" \u2022 Auto-assigned"]})]})}),(0,O.jsx)(ti.A,{children:(0,O.jsx)(P.A,{title:"User Actions",children:(0,O.jsx)(u.A,{size:"small",onClick:t=>((e,t)=>{e.stopPropagation(),K(e.currentTarget),J(t)})(t,e),children:(0,O.jsx)(wr.A,{fontSize:"small"})})})})]}),t<v.length-1&&(0,O.jsx)(te.A,{variant:"inset",component:"li"})]},e.id))})]}):(0,O.jsxs)(o.A,{sx:{textAlign:"center",py:6},children:[(0,O.jsx)(yr.A,{sx:{fontSize:64,color:"text.secondary",mb:2}}),(0,O.jsx)(c.A,{variant:"h6",color:"text.secondary",gutterBottom:!0,children:"Select a Workspace"}),(0,O.jsx)(c.A,{variant:"body2",color:"text.secondary",children:"Click on a workspace to view and manage team members"})]})]})})]}),(0,O.jsx)(p.A,{anchorEl:z,open:Boolean(z),onClose:Se,anchorOrigin:{vertical:"bottom",horizontal:"right"},transformOrigin:{vertical:"top",horizontal:"right"},children:(0,O.jsx)(xr.A,{children:(0,O.jsxs)(de.A,{onClick:()=>F&&(_(F),C(!0),void Se()),sx:{color:"error.main"},children:[(0,O.jsx)(li.A,{sx:{mr:1},fontSize:"small"}),"Delete Workspace"]})})}),(0,O.jsx)(p.A,{anchorEl:U,open:Boolean(U),onClose:Ee,anchorOrigin:{vertical:"bottom",horizontal:"right"},transformOrigin:{vertical:"top",horizontal:"right"},children:(0,O.jsx)(xr.A,{children:(0,O.jsxs)(de.A,{onClick:()=>G&&(e=>{Z(e),Y(!0),Ee()})(G),sx:{color:"error.main"},children:[(0,O.jsx)(vr.A,{sx:{mr:1},fontSize:"small"}),"Remove from Workspace"]})})}),(0,O.jsxs)(r.A,{open:q,onClose:()=>Y(!1),maxWidth:"sm",fullWidth:!0,PaperProps:{sx:{borderRadius:2}},children:[(0,O.jsx)(d.A,{children:(0,O.jsxs)(o.A,{sx:{display:"flex",alignItems:"center",gap:1},children:[(0,O.jsx)(ns.A,{sx:{bgcolor:"warning.main"},children:(0,O.jsx)(ts.A,{})}),(0,O.jsxs)(o.A,{children:[(0,O.jsx)(c.A,{variant:"h6",children:"Remove User from Group"}),(0,O.jsx)(c.A,{variant:"body2",color:"text.secondary",children:"This will revoke the user's access to this group"})]})]})}),(0,O.jsxs)(l.A,{children:[(0,O.jsx)(m.A,{severity:"warning",sx:{mb:2},children:(0,O.jsxs)(c.A,{variant:"body2",children:[(0,O.jsx)("strong",{children:"Warning:"})," Removing this user will immediately revoke their access to all data and workflows in this group."]})}),(0,O.jsxs)(ao.A,{children:["Are you sure you want to remove ",(0,O.jsx)("strong",{children:null===X||void 0===X?void 0:X.email})," from the group ",(0,O.jsxs)("strong",{children:["\u201c",null===g||void 0===g?void 0:g.name,"\u201d"]}),"?",(0,O.jsx)("br",{}),(0,O.jsx)("br",{}),"They will no longer be able to access any data or workflows within this group."]})]}),(0,O.jsxs)(B.A,{sx:{p:2.5,gap:1},children:[(0,O.jsx)(x.A,{onClick:()=>Y(!1),variant:"outlined",disabled:E,children:"Cancel"}),(0,O.jsx)(x.A,{onClick:async()=>{if(X&&g){I(!0);try{const e=Ve.B.getInstance();await e.removeUserFromGroup(g.id,X.id),Y(!1),Z(null),Te("Member removed successfully","success"),Ce(g.id)}catch(e){Te("Failed to remove member","error")}finally{I(!1)}}},variant:"contained",color:"warning",disabled:E,startIcon:E?void 0:(0,O.jsx)(vr.A,{}),children:E?"Removing...":"Remove User"})]})]}),(0,O.jsxs)(r.A,{open:k,onClose:()=>C(!1),maxWidth:"sm",fullWidth:!0,PaperProps:{sx:{borderRadius:2}},children:[(0,O.jsx)(d.A,{children:(0,O.jsxs)(o.A,{sx:{display:"flex",alignItems:"center",gap:1},children:[(0,O.jsx)(ns.A,{sx:{bgcolor:"error.main"},children:(0,O.jsx)(ts.A,{})}),(0,O.jsxs)(o.A,{children:[(0,O.jsx)(c.A,{variant:"h6",children:"Delete Group"}),(0,O.jsx)(c.A,{variant:"body2",color:"text.secondary",children:"This action cannot be undone"})]})]})}),(0,O.jsxs)(l.A,{children:[(0,O.jsx)(m.A,{severity:"warning",sx:{mb:2},children:(0,O.jsxs)(c.A,{variant:"body2",children:[(0,O.jsx)("strong",{children:"Warning:"})," Deleting this group will permanently remove all associated data and user access."]})}),(0,O.jsxs)(ao.A,{children:["Are you sure you want to delete the group ",(0,O.jsxs)("strong",{children:["\u201c",null===S||void 0===S?void 0:S.name,"\u201d"]}),"?",(null===S||void 0===S?void 0:S.user_count)&&S.user_count>0&&(0,O.jsxs)(O.Fragment,{children:[(0,O.jsx)("br",{}),(0,O.jsx)("br",{}),"This group currently has ",(0,O.jsxs)("strong",{children:[S.user_count," user(s)"]})," assigned to it."]})]})]}),(0,O.jsxs)(B.A,{sx:{p:2.5,gap:1},children:[(0,O.jsx)(x.A,{onClick:()=>C(!1),variant:"outlined",disabled:E,children:"Cancel"}),(0,O.jsx)(x.A,{onClick:async()=>{if(S){I(!0);try{const e=Ve.B.getInstance();await e.deleteGroup(S.id),C(!1),_(null),(null===g||void 0===g?void 0:g.id)===S.id&&(f(null),A([])),Te("Workspace deleted successfully","success"),we()}catch(e){Te("Failed to delete workspace","error")}finally{I(!1)}}},variant:"contained",color:"error",disabled:E,startIcon:E?void 0:(0,O.jsx)(li.A,{}),children:E?"Deleting...":"Delete Group"})]})]}),(0,O.jsxs)(r.A,{open:y,onClose:()=>b(!1),maxWidth:"md",fullWidth:!0,PaperProps:{sx:{borderRadius:2}},children:[(0,O.jsx)(d.A,{children:(0,O.jsxs)(o.A,{sx:{display:"flex",alignItems:"center",gap:1},children:[(0,O.jsx)(ns.A,{sx:{bgcolor:"primary.main"},children:(0,O.jsx)(yr.A,{})}),(0,O.jsxs)(o.A,{children:[(0,O.jsx)(c.A,{variant:"h6",children:"Create New Workspace"}),(0,O.jsx)(c.A,{variant:"body2",color:"text.secondary",children:"Set up a collaborative workspace for your team"})]})]})}),(0,O.jsxs)(l.A,{children:[(0,O.jsx)(m.A,{severity:"info",sx:{mb:3,mt:1},children:"Workspaces provide secure, isolated environments for teams. Members can belong to multiple workspaces."}),(0,O.jsxs)(ce.Ay,{container:!0,spacing:3,children:[(0,O.jsx)(ce.Ay,{item:!0,xs:12,children:(0,O.jsx)(V.A,{fullWidth:!0,label:"Workspace Name",value:xe.name,onChange:e=>ge((0,a.A)((0,a.A)({},xe),{},{name:e.target.value})),placeholder:"e.g., Product Team, Marketing, Engineering",required:!0,InputProps:{startAdornment:(0,O.jsx)(Ya.A,{sx:{mr:1,color:"text.secondary"}})}})}),(0,O.jsx)(ce.Ay,{item:!0,xs:12,children:(0,O.jsx)(V.A,{fullWidth:!0,label:"Description (Optional)",value:xe.description,onChange:e=>ge((0,a.A)((0,a.A)({},xe),{},{description:e.target.value})),multiline:!0,rows:3,placeholder:"Describe the purpose of this workspace...",helperText:"Help others understand this workspace's purpose"})})]})]}),(0,O.jsxs)(B.A,{sx:{p:2.5,gap:1},children:[(0,O.jsx)(x.A,{onClick:()=>b(!1),variant:"outlined",disabled:E,children:"Cancel"}),(0,O.jsx)(x.A,{onClick:async()=>{if(xe.name){I(!0);try{const e=Ve.B.getInstance();await e.createGroup(xe),b(!1),ge({name:"",description:""}),Te("Workspace created successfully","success"),we()}catch(e){Te("Failed to create workspace","error")}finally{I(!1)}}else Te("Please fill in all required fields","warning")},variant:"contained",disabled:E||!xe.name,startIcon:E?void 0:(0,O.jsx)(H.A,{}),children:E?"Creating...":"Create Workspace"})]})]}),(0,O.jsxs)(r.A,{open:j,onClose:()=>w(!1),maxWidth:"md",fullWidth:!0,PaperProps:{sx:{borderRadius:2}},children:[(0,O.jsx)(d.A,{children:(0,O.jsxs)(o.A,{sx:{display:"flex",alignItems:"center",gap:1},children:[(0,O.jsx)(ns.A,{sx:{bgcolor:"secondary.main"},children:(0,O.jsx)(Ln.A,{})}),(0,O.jsxs)(o.A,{children:[(0,O.jsxs)(c.A,{variant:"h6",children:["Add Members to ",null===g||void 0===g?void 0:g.name]}),(0,O.jsx)(c.A,{variant:"body2",color:"text.secondary",children:"Select multiple team members and set their permissions"})]})]})}),(0,O.jsxs)(l.A,{children:[(0,O.jsx)(m.A,{severity:"info",sx:{mb:3,mt:1},children:"Team members will gain access to this workspace's data and workflows based on their role."}),(0,O.jsx)(m.A,{severity:"warning",sx:{mb:3},children:(0,O.jsxs)(c.A,{variant:"body2",children:[(0,O.jsx)("strong",{children:"Note:"})," Users must log in to Kasal at least once to appear in this list. If you don't see the user you're looking for, ask them to visit the application first."]})}),(0,O.jsxs)(ce.Ay,{container:!0,spacing:3,children:[(0,O.jsx)(ce.Ay,{item:!0,xs:12,children:(0,O.jsxs)(oe.A,{fullWidth:!0,required:!0,children:[(0,O.jsx)(re.A,{children:"Select Users"}),(0,O.jsx)(le.A,{multiple:!0,value:Ae,label:"Select Users",onChange:e=>ye("string"===typeof e.target.value?e.target.value.split(","):e.target.value),disabled:me,renderValue:e=>(0,O.jsx)(o.A,{sx:{display:"flex",flexWrap:"wrap",gap:.5},children:e.map(e=>{const t=ue.find(t=>t.id===e);return(0,O.jsx)(R.A,{label:(null===t||void 0===t?void 0:t.email)||e,size:"small",onDelete:()=>{ye(Ae.filter(t=>t!==e))},deleteIcon:(0,O.jsx)(li.A,{})},e)})}),children:me?(0,O.jsx)(de.A,{disabled:!0,children:(0,O.jsx)(c.A,{color:"text.secondary",children:"Loading users..."})}):0===ue.length?(0,O.jsx)(de.A,{disabled:!0,children:(0,O.jsx)(c.A,{color:"text.secondary",children:"No users found - ask team members to log in first"})}):ue.filter(e=>!v.some(t=>t.email===e.email)).map(e=>(0,O.jsx)(de.A,{value:e.id,children:(0,O.jsxs)(o.A,{sx:{display:"flex",alignItems:"center",gap:1,width:"100%"},children:[(0,O.jsx)(vr.A,{fontSize:"small"}),(0,O.jsxs)(o.A,{children:[(0,O.jsx)(c.A,{variant:"body2",children:e.email}),(0,O.jsxs)(c.A,{variant:"caption",color:"text.secondary",children:["Last login: ",e.last_login?new Date(e.last_login).toLocaleDateString():"Never"]})]})]})},e.id))}),(0,O.jsx)(c.A,{variant:"caption",color:"text.secondary",sx:{mt:1,display:"block"},children:"Hold Ctrl/Cmd to select multiple users. Only users who have logged in to Kasal will appear in this list."})]})}),(0,O.jsx)(ce.Ay,{item:!0,xs:12,children:(0,O.jsxs)(oe.A,{fullWidth:!0,required:!0,children:[(0,O.jsx)(re.A,{children:"Role & Permissions"}),(0,O.jsxs)(le.A,{value:fe.role,label:"Role & Permissions",onChange:e=>ve((0,a.A)((0,a.A)({},fe),{},{role:e.target.value})),startAdornment:Ne(fe.role),children:[(0,O.jsx)(de.A,{value:"operator",children:(0,O.jsxs)(o.A,{sx:{display:"flex",alignItems:"center",gap:1,width:"100%"},children:[(0,O.jsx)(vr.A,{fontSize:"small"}),(0,O.jsxs)(o.A,{children:[(0,O.jsx)(c.A,{variant:"body2",fontWeight:"medium",children:"Operator"}),(0,O.jsx)(c.A,{variant:"caption",color:"text.secondary",children:"Execute workflows and monitor execution"})]})]})}),(0,O.jsx)(de.A,{value:"editor",children:(0,O.jsxs)(o.A,{sx:{display:"flex",alignItems:"center",gap:1,width:"100%"},children:[(0,O.jsx)(Za.A,{fontSize:"small"}),(0,O.jsxs)(o.A,{children:[(0,O.jsx)(c.A,{variant:"body2",fontWeight:"medium",children:"Editor"}),(0,O.jsx)(c.A,{variant:"caption",color:"text.secondary",children:"Build and modify AI agent workflows"})]})]})}),(0,O.jsx)(de.A,{value:"admin",children:(0,O.jsxs)(o.A,{sx:{display:"flex",alignItems:"center",gap:1,width:"100%"},children:[(0,O.jsx)(fr.A,{fontSize:"small"}),(0,O.jsxs)(o.A,{children:[(0,O.jsx)(c.A,{variant:"body2",fontWeight:"medium",children:"Admin"}),(0,O.jsx)(c.A,{variant:"caption",color:"text.secondary",children:"Full system control and configuration"})]})]})})]})]})})]}),(0,O.jsxs)(_e.A,{sx:{p:2,mt:2,bgcolor:"grey.50"},children:[(0,O.jsxs)(c.A,{variant:"subtitle2",color:"primary",gutterBottom:!0,children:["Selected Role: ",fe.role.charAt(0).toUpperCase()+fe.role.slice(1)]}),(0,O.jsx)(c.A,{variant:"body2",color:"text.secondary",children:Pe(fe.role)})]})]}),(0,O.jsxs)(B.A,{sx:{p:2.5,gap:1},children:[(0,O.jsx)(x.A,{onClick:()=>w(!1),variant:"outlined",disabled:E,children:"Cancel"}),(0,O.jsx)(x.A,{onClick:async()=>{if(Ae.length&&g){I(!0);try{const t=Ve.B.getInstance();let n=0,a=0;for(const s of Ae)try{const e=ue.find(e=>e.id===s);if(!e){a++;continue}const i={user_email:e.email,role:fe.role};await t.assignUserToGroup(g.id,i),n++}catch(e){a++}w(!1),ve({user_email:"",role:"operator"}),ye([]),0===a?Te("".concat(n," member").concat(n>1?"s":""," added successfully"),"success"):0===n?Te("Failed to add any members","error"):Te("".concat(n," member").concat(n>1?"s":""," added, ").concat(a," failed"),"warning"),Ce(g.id)}catch(e){Te("Failed to add members","error")}finally{I(!1)}}else Te("Please select at least one user and role","warning")},variant:"contained",disabled:E||!Ae.length,startIcon:E?void 0:(0,O.jsx)(Ln.A,{}),children:E?"Adding...":"Add ".concat(Ae.length," Member").concat(1!==Ae.length?"s":"")})]})]}),(0,O.jsx)(h.A,{open:Q.open,autoHideDuration:6e3,onClose:()=>$((0,a.A)((0,a.A)({},Q),{},{open:!1})),children:(0,O.jsx)(m.A,{onClose:()=>$((0,a.A)((0,a.A)({},Q),{},{open:!1})),severity:Q.severity,sx:{width:"100%"},children:Q.message})})]})})};var Cr=n(13801);const Sr=function(e){var t,n;let{onConfigureSection:a}=e;const[s,r]=(0,i.useState)(!0),[l,d]=(0,i.useState)(null),[u,h]=(0,i.useState)(null),[p,x]=(0,i.useState)(null),[g,f]=(0,i.useState)(null),v=localStorage.getItem("selectedGroupId"),A=null===v||void 0===v?void 0:v.startsWith("user_"),y=(0,Pn.o)(e=>e.userRole);(0,i.useEffect)(()=>{(async()=>{await b()})()},[v]);const b=async()=>{try{if(r(!0),f(null),v&&!A){const e=(await Ve.B.getInstance().getMyGroups()).find(e=>e.id===v);e&&d({name:e.name,description:e.description,member_count:e.user_count,created_at:e.created_at})}else d({name:"Personal Workspace",description:"Your personal workspace",is_default:!0,member_count:1});try{const e=await ke.O.getInstance().getDatabricksConfig();h(e)}catch(e){}try{const e=await ys.getConfig();x(e)}catch(e){}}catch(e){f("Failed to load workspace information")}finally{r(!1)}},j=e=>e?(0,O.jsx)(rt.A,{color:"success",fontSize:"small"}):(0,O.jsx)(dt.A,{color:"warning",fontSize:"small"}),w=e=>e?(0,O.jsx)(R.A,{label:"Configured",size:"small",color:"success",variant:"outlined"}):(0,O.jsx)(R.A,{label:"Not Configured",size:"small",color:"warning",variant:"outlined"});return s?(0,O.jsx)(o.A,{sx:{p:3},children:(0,O.jsx)(c.A,{children:"Loading workspace information..."})}):g?(0,O.jsx)(o.A,{sx:{p:3},children:(0,O.jsx)(m.A,{severity:"error",children:g})}):(0,O.jsxs)(o.A,{children:[(0,O.jsxs)(o.A,{sx:{mb:3},children:[(0,O.jsx)(c.A,{variant:"h5",gutterBottom:!0,children:"Workspace Configuration Overview"}),(0,O.jsx)(c.A,{variant:"body2",color:"text.secondary",children:"Manage your workspace settings and configurations"})]}),(0,O.jsx)(ee.A,{sx:{mb:3},children:(0,O.jsxs)(Xt.A,{children:[(0,O.jsxs)(o.A,{sx:{display:"flex",alignItems:"center",mb:2},children:[(0,O.jsx)(ca.A,{sx:{mr:1,color:"primary.main"}}),(0,O.jsx)(c.A,{variant:"h6",children:(null===l||void 0===l?void 0:l.name)||"Workspace"})]}),(0,O.jsxs)(ce.Ay,{container:!0,spacing:2,children:[(0,O.jsxs)(ce.Ay,{item:!0,xs:12,md:6,children:[(0,O.jsx)(c.A,{variant:"body2",color:"text.secondary",gutterBottom:!0,children:"Workspace Type"}),(0,O.jsx)(c.A,{variant:"body1",children:A?"Personal":"Team"})]}),(0,O.jsxs)(ce.Ay,{item:!0,xs:12,md:6,children:[(0,O.jsx)(c.A,{variant:"body2",color:"text.secondary",gutterBottom:!0,children:"Your Role"}),(0,O.jsx)(R.A,{label:y||"Unknown",size:"small",color:"admin"===y?"primary":"default",icon:"admin"===y?(0,O.jsx)(Cr.A,{}):void 0})]}),!A&&(0,O.jsxs)(O.Fragment,{children:[(0,O.jsxs)(ce.Ay,{item:!0,xs:12,md:6,children:[(0,O.jsx)(c.A,{variant:"body2",color:"text.secondary",gutterBottom:!0,children:"Members"}),(0,O.jsxs)(c.A,{variant:"body1",children:[(null===l||void 0===l?void 0:l.member_count)||0," members"]})]}),(0,O.jsxs)(ce.Ay,{item:!0,xs:12,md:6,children:[(0,O.jsx)(c.A,{variant:"body2",color:"text.secondary",gutterBottom:!0,children:"Created"}),(0,O.jsx)(c.A,{variant:"body1",children:null!==l&&void 0!==l&&l.created_at?new Date(l.created_at).toLocaleDateString():"N/A"})]})]})]})]})}),(0,O.jsx)(c.A,{variant:"h6",sx:{mb:2},children:"Configuration Status"}),(0,O.jsxs)(ce.Ay,{container:!0,spacing:2,children:[(0,O.jsx)(ce.Ay,{item:!0,xs:12,md:6,children:(0,O.jsxs)(_e.A,{sx:{p:2,height:"100%"},children:[(0,O.jsxs)(o.A,{sx:{display:"flex",alignItems:"center",mb:2},children:[(0,O.jsx)(ba.A,{sx:{mr:1,color:"primary.main"}}),(0,O.jsx)(c.A,{variant:"subtitle1",sx:{flexGrow:1},children:"Databricks Integration"}),w(!!u)]}),u?(0,O.jsxs)(at.A,{dense:!0,children:[(0,O.jsxs)(st.Ay,{children:[(0,O.jsx)(it.A,{sx:{minWidth:36},children:j(!!u.warehouse_id)}),(0,O.jsx)(ot.A,{primary:"SQL Warehouse",secondary:u.warehouse_id||"Not configured"})]}),(0,O.jsxs)(st.Ay,{children:[(0,O.jsx)(it.A,{sx:{minWidth:36},children:j(!!u.catalog)}),(0,O.jsx)(ot.A,{primary:"Catalog",secondary:u.catalog||"Not configured"})]}),(0,O.jsxs)(st.Ay,{children:[(0,O.jsx)(it.A,{sx:{minWidth:36},children:j(u.enabled)}),(0,O.jsx)(ot.A,{primary:"Status",secondary:u.enabled?"Enabled":"Disabled"})]})]}):(0,O.jsx)(c.A,{variant:"body2",color:"text.secondary",children:"Databricks is not configured for this workspace"})]})}),(0,O.jsx)(ce.Ay,{item:!0,xs:12,md:6,children:(0,O.jsxs)(_e.A,{sx:{p:2,height:"100%"},children:[(0,O.jsxs)(o.A,{sx:{display:"flex",alignItems:"center",mb:2},children:[(0,O.jsx)(Z.A,{sx:{mr:1,color:"primary.main"}}),(0,O.jsx)(c.A,{variant:"subtitle1",sx:{flexGrow:1},children:"Memory Backend"}),w(!!p)]}),p?(0,O.jsxs)(at.A,{dense:!0,children:[(0,O.jsxs)(st.Ay,{children:[(0,O.jsx)(it.A,{sx:{minWidth:36},children:j(!0)}),(0,O.jsx)(ot.A,{primary:"Backend Type",secondary:p.backend_type||"Default"})]}),(0,O.jsxs)(st.Ay,{children:[(0,O.jsx)(it.A,{sx:{minWidth:36},children:j(p.is_default||!1)}),(0,O.jsx)(ot.A,{primary:"Default Configuration",secondary:p.is_default?"Yes":"No"})]}),"databricks"===p.backend_type&&(0,O.jsxs)(st.Ay,{children:[(0,O.jsx)(it.A,{sx:{minWidth:36},children:j(!(null===(t=p.databricks_config)||void 0===t||!t.endpoint_name))}),(0,O.jsx)(ot.A,{primary:"Vector Endpoint",secondary:(null===(n=p.databricks_config)||void 0===n?void 0:n.endpoint_name)||"Not configured"})]})]}):(0,O.jsx)(c.A,{variant:"body2",color:"text.secondary",children:"Memory backend is not configured for this workspace"})]})}),(0,O.jsx)(ce.Ay,{item:!0,xs:12,md:6,children:(0,O.jsxs)(_e.A,{sx:{p:2,height:"100%"},children:[(0,O.jsxs)(o.A,{sx:{display:"flex",alignItems:"center",mb:2},children:[(0,O.jsx)(et.A,{sx:{mr:1,color:"primary.main"}}),(0,O.jsx)(c.A,{variant:"subtitle1",sx:{flexGrow:1},children:"Volume Storage"}),w((null===u||void 0===u?void 0:u.volume_enabled)||!1)]}),null!==u&&void 0!==u&&u.volume_enabled?(0,O.jsxs)(at.A,{dense:!0,children:[(0,O.jsxs)(st.Ay,{children:[(0,O.jsx)(it.A,{sx:{minWidth:36},children:j(!!u.volume_path)}),(0,O.jsx)(ot.A,{primary:"Volume Path",secondary:u.volume_path||"Not configured"})]}),(0,O.jsxs)(st.Ay,{children:[(0,O.jsx)(it.A,{sx:{minWidth:36},children:j(!0)}),(0,O.jsx)(ot.A,{primary:"File Format",secondary:u.volume_file_format||"json"})]})]}):(0,O.jsx)(c.A,{variant:"body2",color:"text.secondary",children:"Volume storage is not configured for this workspace"})]})}),(0,O.jsx)(ce.Ay,{item:!0,xs:12,md:6,children:(0,O.jsxs)(_e.A,{sx:{p:2,height:"100%"},children:[(0,O.jsxs)(o.A,{sx:{display:"flex",alignItems:"center",mb:2},children:[(0,O.jsx)(et.A,{sx:{mr:1,color:"primary.main"}}),(0,O.jsx)(c.A,{variant:"subtitle1",sx:{flexGrow:1},children:"Knowledge Base"}),w((null===u||void 0===u?void 0:u.knowledge_volume_enabled)||!1)]}),null!==u&&void 0!==u&&u.knowledge_volume_enabled?(0,O.jsxs)(at.A,{dense:!0,children:[(0,O.jsxs)(st.Ay,{children:[(0,O.jsx)(it.A,{sx:{minWidth:36},children:j(!!u.knowledge_volume_path)}),(0,O.jsx)(ot.A,{primary:"Knowledge Path",secondary:u.knowledge_volume_path||"Not configured"})]}),(0,O.jsxs)(st.Ay,{children:[(0,O.jsx)(it.A,{sx:{minWidth:36},children:j(!0)}),(0,O.jsx)(ot.A,{primary:"Chunk Size",secondary:"".concat(u.knowledge_chunk_size||1e3," tokens")})]})]}):(0,O.jsx)(c.A,{variant:"body2",color:"text.secondary",children:"Knowledge base is not configured for this workspace"})]})})]}),"admin"===y&&(0,O.jsx)(m.A,{severity:"info",sx:{mt:3},children:(0,O.jsx)(c.A,{variant:"body2",children:"As a workspace admin, you can configure all workspace-specific settings including Databricks integration, memory backend, and storage volumes. Use the navigation menu to access each configuration section."})})]})};const _r=function(){const[e,t]=(0,i.useState)([]),[n,s]=(0,i.useState)(!0),[p,g]=(0,i.useState)(null),[f,v]=(0,i.useState)(null),[A,y]=(0,i.useState)(!1),[b,j]=(0,i.useState)(null),[w,k]=(0,i.useState)({open:!1,message:"",severity:"info"}),C=gr.getInstance();(0,i.useEffect)(()=>{S()},[]);const S=async()=>{try{s(!0);const e=await C.getUsers();t(e)}catch(e){_("Failed to load users","error")}finally{s(!1)}},_=(e,t)=>{k({open:!0,message:e,severity:t})},E=async(n,a,s)=>{try{g(n);const i={[a]:s},o=await C.updateUserPermissions(n,i);t(e.map(e=>e.id===n?o:e));_("".concat("is_system_admin"===a?"System Admin":"Personal Workspace Manager"," permission ").concat(s?"granted":"revoked"," for ").concat(o.email),"success")}catch(i){_("Failed to update user permissions","error")}finally{g(null)}},I=e=>{const t=[];return e.is_system_admin&&t.push((0,O.jsx)(R.A,{label:"System Admin",color:"error",size:"small",icon:(0,O.jsx)(Cr.A,{})},"sys")),e.is_personal_workspace_manager&&t.push((0,O.jsx)(R.A,{label:"Personal Workspace Manager",color:"primary",size:"small",icon:(0,O.jsx)(to.A,{})},"pw")),0===t.length&&t.push((0,O.jsx)(R.A,{label:"Standard User",color:"default",size:"small",icon:(0,O.jsx)(J.A,{})},"std")),(0,O.jsx)(o.A,{sx:{display:"flex",gap:1,flexWrap:"wrap"},children:t})};return n?(0,O.jsxs)(o.A,{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"400px",children:[(0,O.jsx)(ue.A,{}),(0,O.jsx)(c.A,{variant:"body1",sx:{ml:2},children:"Loading users..."})]}):(0,O.jsxs)(o.A,{children:[(0,O.jsxs)(ee.A,{children:[(0,O.jsx)(Yt.A,{title:(0,O.jsxs)(o.A,{sx:{display:"flex",alignItems:"center"},children:[(0,O.jsx)(ns.A,{sx:{bgcolor:"error.main",mr:2},children:(0,O.jsx)(Cr.A,{})}),(0,O.jsxs)(o.A,{children:[(0,O.jsx)(c.A,{variant:"h5",fontWeight:"600",color:"text.primary",children:"User Permission Management"}),(0,O.jsx)(c.A,{variant:"body2",color:"text.secondary",children:"Grant system-wide and personal workspace permissions to users"})]})]})}),(0,O.jsxs)(Xt.A,{children:[(0,O.jsx)(m.A,{severity:"warning",sx:{mb:3},children:(0,O.jsxs)(c.A,{variant:"body2",children:[(0,O.jsx)("strong",{children:"System Admin Only:"})," Only you can manage these permissions. Use carefully as these grant significant access rights."]})}),(0,O.jsx)(c.A,{variant:"h6",gutterBottom:!0,sx:{mt:2,mb:2},children:"Permission Overview"}),(0,O.jsxs)(o.A,{sx:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(300px, 1fr))",gap:2,mb:3},children:[(0,O.jsxs)(_e.A,{sx:{p:2,border:"1px solid",borderColor:"error.light"},children:[(0,O.jsx)(c.A,{variant:"subtitle1",color:"error.main",fontWeight:"600",children:"System Admin"}),(0,O.jsx)(c.A,{variant:"body2",color:"text.secondary",children:"Full platform control, can manage all workspaces and grant permissions"})]}),(0,O.jsxs)(_e.A,{sx:{p:2,border:"1px solid",borderColor:"primary.light"},children:[(0,O.jsx)(c.A,{variant:"subtitle1",color:"primary.main",fontWeight:"600",children:"Personal Workspace Manager"}),(0,O.jsx)(c.A,{variant:"body2",color:"text.secondary",children:"Can configure Databricks, Memory, and Volumes in their personal workspace"})]})]}),(0,O.jsx)(Pi.A,{component:_e.A,sx:{mt:2},children:(0,O.jsxs)(Mi.A,{children:[(0,O.jsx)(zi.A,{children:(0,O.jsxs)(Oi.A,{children:[(0,O.jsx)(Li.A,{children:"User"}),(0,O.jsx)(Li.A,{children:"Current Permissions"}),(0,O.jsx)(Li.A,{align:"center",children:"System Admin"}),(0,O.jsx)(Li.A,{align:"center",children:"Personal Workspace Manager"}),(0,O.jsx)(Li.A,{children:"Last Login"}),(0,O.jsx)(Li.A,{align:"center",children:"Actions"})]})}),(0,O.jsx)(Fi.A,{children:e.map(e=>(0,O.jsxs)(Oi.A,{hover:!0,children:[(0,O.jsx)(Li.A,{children:(0,O.jsxs)(o.A,{children:[(0,O.jsx)(c.A,{variant:"body1",fontWeight:"500",children:e.email}),(0,O.jsxs)(c.A,{variant:"caption",color:"text.secondary",children:["ID: ",e.id]})]})}),(0,O.jsx)(Li.A,{children:I(e)}),(0,O.jsx)(Li.A,{align:"center",children:(0,O.jsx)(P.A,{title:"Grant/revoke system-wide administrative access",children:(0,O.jsx)(he.A,{control:(0,O.jsx)(me.A,{checked:e.is_system_admin,onChange:t=>E(e.id,"is_system_admin",t.target.checked),disabled:p===e.id,color:"error"}),label:""})})}),(0,O.jsx)(Li.A,{align:"center",children:(0,O.jsx)(P.A,{title:"Allow user to configure their personal workspace",children:(0,O.jsx)(he.A,{control:(0,O.jsx)(me.A,{checked:e.is_personal_workspace_manager,onChange:t=>E(e.id,"is_personal_workspace_manager",t.target.checked),disabled:p===e.id,color:"primary"}),label:""})})}),(0,O.jsx)(Li.A,{children:(0,O.jsx)(c.A,{variant:"body2",color:"text.secondary",children:e.last_login?new Date(e.last_login).toLocaleDateString():"Never"})}),(0,O.jsx)(Li.A,{align:"center",children:(0,O.jsx)(P.A,{title:"Delete user permanently",children:(0,O.jsx)(u.A,{color:"error",onClick:()=>(e=>{j(e),y(!0)})(e),disabled:f===e.id,size:"small",children:f===e.id?(0,O.jsx)(ue.A,{size:20}):(0,O.jsx)(q.A,{})})})})]},e.id))})]})}),0===e.length&&(0,O.jsxs)(o.A,{textAlign:"center",py:4,children:[(0,O.jsx)(c.A,{variant:"h6",color:"text.secondary",children:"No users found"}),(0,O.jsx)(c.A,{variant:"body2",color:"text.secondary",children:"Users will appear here once they log in to the system"})]})]})]}),(0,O.jsxs)(r.A,{open:A,onClose:()=>y(!1),maxWidth:"sm",fullWidth:!0,PaperProps:{sx:{borderRadius:2}},children:[(0,O.jsx)(d.A,{children:(0,O.jsxs)(o.A,{sx:{display:"flex",alignItems:"center",gap:1},children:[(0,O.jsx)(ns.A,{sx:{bgcolor:"error.main"},children:(0,O.jsx)(dt.A,{})}),(0,O.jsxs)(o.A,{children:[(0,O.jsx)(c.A,{variant:"h6",children:"Delete User"}),(0,O.jsx)(c.A,{variant:"body2",color:"text.secondary",children:"This action cannot be undone"})]})]})}),(0,O.jsxs)(l.A,{children:[(0,O.jsx)(m.A,{severity:"error",sx:{mb:2},children:(0,O.jsxs)(c.A,{variant:"body2",children:[(0,O.jsx)("strong",{children:"Warning:"})," This will permanently delete the user and all their data. This action cannot be undone."]})}),(0,O.jsxs)(ao.A,{children:["Are you sure you want to delete the user ",(0,O.jsx)("strong",{children:null===b||void 0===b?void 0:b.email}),"?",(0,O.jsx)("br",{}),(0,O.jsx)("br",{}),"This will permanently remove: \u2022 User account and authentication \u2022 All workspace memberships \u2022 User permissions and settings \u2022 Any associated data"]})]}),(0,O.jsxs)(B.A,{sx:{p:2.5,gap:1},children:[(0,O.jsx)(x.A,{onClick:()=>y(!1),variant:"outlined",disabled:null!==f,children:"Cancel"}),(0,O.jsx)(x.A,{onClick:async()=>{if(b)try{v(b.id),await C.deleteUser(b.id),t(e.filter(e=>e.id!==b.id)),y(!1),j(null),_("User ".concat(b.email," has been deleted successfully"),"success")}catch(n){_("Failed to delete user","error")}finally{v(null)}},variant:"contained",color:"error",disabled:null!==f,startIcon:f?(0,O.jsx)(ue.A,{size:16}):(0,O.jsx)(q.A,{}),children:f?"Deleting...":"Delete User"})]})]}),(0,O.jsx)(h.A,{open:w.open,autoHideDuration:6e3,onClose:()=>k((0,a.A)((0,a.A)({},w),{},{open:!1})),message:w.message})]})};var Er=n(15642);class Ir{static async getEnvironmentInfo(){if(this.cachedEnvironment)return this.cachedEnvironment;try{const e=await ye.uE.get("/databricks/environment");return this.cachedEnvironment=e.data,e.data}catch(e){return{is_databricks_apps:!1,has_oauth_credentials:!1,message:"Unable to determine environment"}}}static async isDatabricksApps(){return(await this.getEnvironmentInfo()).is_databricks_apps}static clearCache(){this.cachedEnvironment=null}}Ir.cachedEnvironment=null;const Tr=Ir,Dr=["children","value","index"];function Nr(e){const{children:t,value:n,index:i}=e,r=(0,s.A)(e,Dr);return(0,O.jsx)("div",(0,a.A)((0,a.A)({role:"tabpanel",hidden:n!==i,id:"config-panel-".concat(i),"aria-labelledby":"config-nav-".concat(i)},r),{},{children:n===i&&(0,O.jsx)(o.A,{sx:{py:2},children:t})}))}const Pr=function(e){let{onClose:t}=e;const{t:n}=(0,y.Bd)(),[s,r]=(0,i.useState)("en"),{currentTheme:l,changeTheme:d}=(0,f.C)(),{userRole:p,isLoading:x,loadPermissions:g,isSystemAdmin:v,isPersonalWorkspaceManager:A}=(0,Pn.o)(e=>({userRole:e.userRole,isLoading:e.isLoading,loadPermissions:e.loadPermissions,isSystemAdmin:e.isSystemAdmin,isPersonalWorkspaceManager:e.isPersonalWorkspaceManager})),b=(0,rs.k)(e=>e.currentUser),j=localStorage.getItem("selectedGroupId"),w=j&&j.startsWith("user_"),k=!x&&(v||A||null!==p),C=v||k&&("admin"===p||w&&A),S=v,_=k&&"admin"===p,E=k&&"operator"===p,I=k&&"editor"===p;(0,i.useEffect)(()=>{},[k,p,_,E,I,C,S,w,j,x,v,A]);const[T,N]=(0,i.useState)({open:!1,message:"",severity:"success"}),[P,M]=(0,i.useState)(0),[z,L]=(0,i.useState)(!0),[F,W]=(0,i.useState)(!1),R=i.useMemo(()=>{let e=0;const t=[];return t.push({label:n("configuration.general.title",{defaultValue:"General"}),icon:(0,O.jsx)(Xi.A,{fontSize:"small"}),index:e++}),S&&(t.push({label:n("configuration.workspaces.tab",{defaultValue:"Workspaces"}),icon:(0,O.jsx)(to.A,{fontSize:"small"}),index:e++}),t.push({label:n("configuration.engines.tab",{defaultValue:"Engines"}),icon:(0,O.jsx)(eo.A,{fontSize:"small"}),index:e++}),t.push({label:n("configuration.models.tab",{defaultValue:"Models"}),icon:(0,O.jsx)(ct.A,{fontSize:"small"}),index:e++}),t.push({label:n("configuration.tools.tab",{defaultValue:"Tools"}),icon:(0,O.jsx)(Qi.A,{fontSize:"small"}),index:e++}),t.push({label:n("configuration.userPermissions.tab",{defaultValue:"User Permissions"}),icon:(0,O.jsx)(ht.A,{fontSize:"small"}),index:e++}),z&&t.push({label:n("configuration.database.tab",{defaultValue:"Database Management"}),icon:(0,O.jsx)(et.A,{fontSize:"small"}),index:e++})),C&&(t.push({label:n("configuration.workspaceOverview.tab",{defaultValue:"Workspace Overview"}),icon:(0,O.jsx)(to.A,{fontSize:"small"}),index:e++}),F||t.push({label:n("configuration.databricks.tab",{defaultValue:"Databricks"}),icon:(0,O.jsx)(ba.A,{fontSize:"small"}),index:e++}),t.push({label:n("configuration.memoryBackend.tab",{defaultValue:"Memory Backend"}),icon:(0,O.jsx)(Z.A,{fontSize:"small"}),index:e++}),t.push({label:n("configuration.mcpServers.tab",{defaultValue:"MCP Servers"}),icon:(0,O.jsx)(ba.A,{fontSize:"small"}),index:e++})),E||(t.push({label:n("configuration.apiKeys.tab",{defaultValue:"API Keys"}),icon:(0,O.jsx)(Wi.A,{fontSize:"small"}),index:e++}),t.push({label:n("configuration.objects.tab",{defaultValue:"Object Management"}),icon:(0,O.jsx)(X.A,{fontSize:"small"}),index:e++}),t.push({label:n("configuration.prompts.tab",{defaultValue:"Prompt Instructions"}),icon:(0,O.jsx)($i.A,{fontSize:"small"}),index:e++})),t},[z,F,n,S,C,E]);(0,i.useEffect)(()=>{k||x||g()},[k,x,g]),(0,i.useEffect)(()=>{b&&b.email&&g()},[b,g]),(0,i.useEffect)(()=>{(async()=>{try{const e=no.g.getInstance(),t=await e.getCurrentLanguage();r(t);const n=await Tr.getEnvironmentInfo();W(n.is_databricks_apps),n.is_databricks_apps,L(!0)}catch(e){}})()},[]);const V=async e=>{const t=e.target.value;try{const e=no.g.getInstance();await e.setLanguage(t),r(t),N({open:!0,message:n("configuration.language.saved",{defaultValue:"Language changed successfully"}),severity:"success"})}catch(a){N({open:!0,message:a instanceof Error?a.message:"Failed to change language",severity:"error"})}},B=e=>{const t=e.target.value;d(t),N({open:!0,message:n("configuration.theme.saved",{defaultValue:"Theme changed successfully"}),severity:"success"})},U=()=>{N((0,a.A)((0,a.A)({},T),{},{open:!1}))};return(0,O.jsxs)(o.A,{sx:{width:"80vw",height:"80vh",mx:"auto",px:2,py:1.5},children:[(0,O.jsxs)(o.A,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",mb:3,pb:1.5,borderBottom:"1px solid",borderColor:"divider"},children:[(0,O.jsxs)(o.A,{sx:{display:"flex",alignItems:"center"},children:[(0,O.jsx)(ht.A,{sx:{mr:1.5,color:"primary.main",fontSize:"1.4rem"}}),(0,O.jsx)(c.A,{variant:"h5",children:n("configuration.title")})]}),t&&(0,O.jsx)(u.A,{onClick:t,size:"small",sx:{color:"text.secondary","&:hover":{color:"text.primary"}},children:(0,O.jsx)(D.A,{})})]}),k?(0,O.jsxs)(o.A,{sx:{display:"flex",flexDirection:"row",gap:2,height:"calc(100% - 60px)",overflow:"hidden"},children:[(0,O.jsx)(_e.A,{sx:{width:240,flexShrink:0,borderRadius:1,height:"100%",overflow:"auto"},elevation:1,children:(0,O.jsx)(at.A,{sx:{py:1},children:R.map(e=>(0,O.jsxs)(ha.A,{selected:P===e.index,onClick:()=>{return t=e.index,void M(t);var t},sx:{mb:.5,borderRadius:1,mx:.5,"&.Mui-selected":{backgroundColor:"action.selected","&:hover":{backgroundColor:"action.hover"}}},children:[(0,O.jsx)(it.A,{sx:{minWidth:40},children:e.icon}),(0,O.jsx)(ot.A,{primary:e.label})]},e.index))})}),(0,O.jsx)(o.A,{sx:{flex:1,bgcolor:"background.paper",borderRadius:1,p:2,overflow:"auto",height:"100%"},children:R.map(e=>e.label===n("configuration.general.title",{defaultValue:"General"})?(0,O.jsxs)(Nr,{value:P,index:e.index,children:[(0,O.jsxs)(o.A,{sx:{mb:3},children:[(0,O.jsxs)(o.A,{sx:{display:"flex",alignItems:"center",mb:1.5},children:[(0,O.jsx)(Xi.A,{sx:{mr:1,color:"primary.main",fontSize:"1.2rem"}}),(0,O.jsx)(c.A,{variant:"subtitle1",fontWeight:"medium",children:n("configuration.language.title")})]}),(0,O.jsxs)(oe.A,{fullWidth:!0,size:"small",children:[(0,O.jsx)(re.A,{id:"language-select-label",children:n("configuration.language.select")}),(0,O.jsx)(le.A,{labelId:"language-select-label",value:s,onChange:V,label:n("configuration.language.select"),size:"small",children:Object.entries(Er.Y).map(e=>{let[t,{nativeName:n}]=e;return(0,O.jsx)(de.A,{value:t,children:n},t)})})]})]}),(0,O.jsxs)(o.A,{sx:{mb:3},children:[(0,O.jsxs)(o.A,{sx:{display:"flex",alignItems:"center",mb:1.5},children:[(0,O.jsx)(Zi.A,{sx:{mr:1,color:"primary.main",fontSize:"1.2rem"}}),(0,O.jsx)(c.A,{variant:"subtitle1",fontWeight:"medium",children:n("configuration.theme.title")})]}),(0,O.jsxs)(oe.A,{fullWidth:!0,size:"small",children:[(0,O.jsx)(re.A,{children:n("configuration.theme.select")}),(0,O.jsxs)(le.A,{value:l,onChange:B,label:n("configuration.theme.select"),children:[(0,O.jsx)(de.A,{value:"professional",children:"Professional (Blue)"}),(0,O.jsx)(de.A,{value:"calmEarth",children:"Calm Earth (Green)"}),(0,O.jsx)(de.A,{value:"deepOcean",children:"Deep Ocean (Dark)"}),(0,O.jsx)(de.A,{value:"vibrantCreative",children:"Vibrant Creative (Purple)"})]})]})]})]},e.index):e.label===n("configuration.workspaceOverview.tab",{defaultValue:"Workspace Overview"})?(0,O.jsx)(Nr,{value:P,index:e.index,children:(0,O.jsx)(Sr,{})},e.index):e.label===n("configuration.workspaces.tab",{defaultValue:"Workspaces"})?(0,O.jsx)(Nr,{value:P,index:e.index,children:(0,O.jsx)(kr,{})},e.index):e.label===n("configuration.engines.tab",{defaultValue:"Engines"})?(0,O.jsx)(Nr,{value:P,index:e.index,children:(0,O.jsx)(Co,{})},e.index):e.label===n("configuration.models.tab",{defaultValue:"Models"})?(0,O.jsx)(Nr,{value:P,index:e.index,children:(0,O.jsx)(xo,{})},e.index):e.label===n("configuration.tools.tab",{defaultValue:"Tools"})?(0,O.jsx)(Nr,{value:P,index:e.index,children:(0,O.jsx)(fo.default,{})},e.index):e.label===n("configuration.userPermissions.tab",{defaultValue:"User Permissions"})?(0,O.jsx)(Nr,{value:P,index:e.index,children:(0,O.jsx)(_r,{})},e.index):e.label===n("configuration.database.tab",{defaultValue:"Database Management"})?(0,O.jsx)(Nr,{value:P,index:e.index,children:(0,O.jsx)(hr,{})},e.index):e.label===n("configuration.mcpServers.tab",{defaultValue:"MCP Servers"})?(0,O.jsx)(Nr,{value:P,index:e.index,children:(0,O.jsx)(_a,{})},e.index):e.label===n("configuration.memoryBackend.tab",{defaultValue:"Memory Backend"})?(0,O.jsx)(Nr,{value:P,index:e.index,children:(0,O.jsx)(ir,{})},e.index):e.label===n("configuration.databricks.tab",{defaultValue:"Databricks"})?(0,O.jsx)(Nr,{value:P,index:e.index,children:(0,O.jsx)(jo,{onSaved:t})},e.index):e.label===n("configuration.apiKeys.tab",{defaultValue:"API Keys"})?(0,O.jsx)(Nr,{value:P,index:e.index,children:(0,O.jsx)(Vi,{})},e.index):e.label===n("configuration.objects.tab",{defaultValue:"Object Management"})?(0,O.jsx)(Nr,{value:P,index:e.index,children:(0,O.jsx)(go,{})},e.index):e.label===n("configuration.prompts.tab",{defaultValue:"Prompt Instructions"})?(0,O.jsx)(Nr,{value:P,index:e.index,children:(0,O.jsx)(yo,{})},e.index):null)})]}):(0,O.jsx)(o.A,{sx:{display:"flex",justifyContent:"center",alignItems:"center",height:"calc(100% - 60px)"},children:(0,O.jsx)(c.A,{variant:"body1",color:"text.secondary",children:"Loading permissions..."})}),(0,O.jsx)(h.A,{open:T.open,autoHideDuration:6e3,onClose:U,anchorOrigin:{vertical:"bottom",horizontal:"center"},children:(0,O.jsx)(m.A,{onClose:U,severity:T.severity,sx:{width:"100%"},children:T.message})})]})},Mr=e=>{let{nodes:t,edges:n,trigger:s,disabled:o=!1}=e;const[c,u]=(0,i.useState)(!1),[h,m]=(0,i.useState)(""),[p,g]=(0,i.useState)(null),f=(0,i.useRef)(null),[v,A]=(0,i.useState)(!1),{activeTabId:y,updateTabCrewInfo:b}=C();(0,i.useEffect)(()=>{const e=()=>{o||u(!0)},t=async e=>{if(o)return;const t=e,{tabId:n,crewId:a}=t.detail;try{const e=C.getState().getTab(n);if(!e)return;A(!0);const t=e.edges.reduce((e,t)=>{const n="".concat(t.source,"-").concat(t.target);return e.some(e=>"".concat(e.source,"-").concat(e.target)===n)||e.push(t),e},[]),s=await We.updateCrew(a,{name:e.savedCrewName||e.name,agent_ids:[],task_ids:[],nodes:e.nodes,edges:t}),{updateTabCrewInfo:i,markTabClean:o}=C.getState();i(n,s.id,s.name),o(n),setTimeout(()=>{const e=new CustomEvent("updateCrewComplete",{detail:{crewId:s.id,crewName:s.name}});window.dispatchEvent(e)},100)}catch(p){}finally{A(!1)}},n=async e=>{if(o)return;const t=e,{tabId:n,crewName:a}=t.detail;try{const e=C.getState().getTab(n);if(!e)return;A(!0);const t=(await We.getCrews()).find(e=>e.name===a);if(!t)return void u(!0);const s=e.edges.reduce((e,t)=>{const n="".concat(t.source,"-").concat(t.target);return e.some(e=>"".concat(e.source,"-").concat(e.target)===n)||e.push(t),e},[]),i=await We.updateCrew(t.id.toString(),{name:a,agent_ids:[],task_ids:[],nodes:e.nodes,edges:s}),{updateTabCrewInfo:o,markTabClean:r}=C.getState();o(n,i.id,i.name),r(n),setTimeout(()=>{const e=new CustomEvent("updateCrewComplete",{detail:{crewId:i.id,crewName:i.name}});window.dispatchEvent(e)},100)}catch(p){u(!0)}finally{A(!1)}};return window.addEventListener("openSaveCrewDialog",e),window.addEventListener("updateExistingCrew",t),window.addEventListener("updateExistingCrewByName",n),()=>{window.removeEventListener("openSaveCrewDialog",e),window.removeEventListener("updateExistingCrew",t),window.removeEventListener("updateExistingCrewByName",n)}},[o]);const j=()=>{u(!1),m(""),g("")},w=async e=>{if(e&&e.preventDefault(),h.trim()){if(!v){A(!0);try{const e=n.reduce((e,t)=>{const n="".concat(t.source,"-").concat(t.target);return e.some(e=>"".concat(e.source,"-").concat(e.target)===n)||e.push(t),e},[]),s=t.filter(e=>"agentNode"===e.type).filter(e=>{var t;const n=null===(t=e.data)||void 0===t?void 0:t.agentId;if(void 0!==n&&null!==n&&!isNaN(Number(n)))return!0;const a=e.id.match(/^agent-(\d+)/);return a&&a[1]}).map(e=>{var t;const n=null===(t=e.data)||void 0===t?void 0:t.agentId;if(void 0!==n&&null!==n&&!isNaN(Number(n)))return String(Number(n));const a=e.id.match(/^agent-(\d+)/);return a?a[1]:null}).filter(Boolean),i=t.filter(e=>"taskNode"===e.type).filter(e=>{var t;const n=null===(t=e.data)||void 0===t?void 0:t.taskId;if(void 0!==n&&null!==n&&!isNaN(Number(n)))return!0;const a=e.id.match(/^task-(\d+)/);return a&&a[1]}).map(e=>{var t;const n=null===(t=e.data)||void 0===t?void 0:t.taskId;if(void 0!==n&&null!==n&&!isNaN(Number(n)))return String(Number(n));const a=e.id.match(/^task-(\d+)/);return a?a[1]:null}).filter(Boolean),o=t.map(e=>{if("taskNode"===e.type){var t,n;const s=(null===(t=e.data)||void 0===t?void 0:t.config)||{};return(0,a.A)((0,a.A)({},e),{},{data:(0,a.A)((0,a.A)({},e.data),{},{config:(0,a.A)((0,a.A)({},s),{},{markdown:void 0!==(null===(n=e.data)||void 0===n?void 0:n.markdown)?e.data.markdown:s.markdown||!1})})})}return e}),r=await We.saveCrew({name:h,agent_ids:s,task_ids:i,nodes:o,edges:e});y&&r.id&&b(y,r.id,h),j(),setTimeout(()=>{const e=new CustomEvent("saveCrewComplete",{detail:{crewId:r.id,crewName:h}});window.dispatchEvent(e)},100)}catch(p){var s;if(Ae.A.isAxiosError(p)&&null!==(s=p.response)&&void 0!==s&&s.data){const t=p.response.data;let n="Failed to save crew";if("string"===typeof t)n=t;else if(t.detail&&Array.isArray(t.detail)){var i;n=(null===(i=t.detail[0])||void 0===i?void 0:i.msg)||t.detail[0]||"Validation error"}else t.detail?n=t.detail:t.message&&(n=t.message);g(n)}else g(p instanceof Error?p.message:"Failed to save crew")}finally{A(!1)}}}else g("Crew name is required")};return(0,O.jsxs)(O.Fragment,{children:[i.cloneElement(s,{onClick:()=>{o||u(!0)},disabled:o}),(0,O.jsxs)(r.A,{open:c,onClose:j,maxWidth:"sm",fullWidth:!0,component:"form",onSubmit:w,children:[(0,O.jsx)(d.A,{children:"Save Crew"}),(0,O.jsx)(l.A,{children:(0,O.jsx)(V.A,{inputRef:f,margin:"dense",label:"Crew Name",type:"text",fullWidth:!0,value:h,onChange:e=>m(e.target.value),error:!!p,helperText:p,onKeyDown:e=>{"Enter"===e.key&&(e.preventDefault(),e.stopPropagation(),w())},autoFocus:!0})}),(0,O.jsxs)(B.A,{children:[(0,O.jsx)(x.A,{onClick:j,children:"Cancel"}),(0,O.jsx)(x.A,{type:"submit",variant:"contained",color:"primary",children:"Save"})]})]})]})},zr=(e,t)=>{const n=new Set(t.map(e=>e.id)),a=new Set(t.map(e=>"".concat(e.source,"-").concat(e.target)));return e.filter(e=>{const t="".concat(e.source,"-").concat(e.target);return!n.has(e.id)&&!a.has(t)})},Or="split",Lr="left-only",Fr="right-only";var Wr=n(69203);const Rr=["job_id","execution_id"];(()=>{if("undefined"!==typeof window&&!Object.prototype.hasOwnProperty.call(window,"_resizeObserverHandled")){Object.defineProperty(window,"_resizeObserverHandled",{value:!0,writable:!1,configurable:!1}),window.addEventListener("error",e=>{if(e.message&&(e.message.includes("ResizeObserver loop")||e.message.includes("ResizeObserver Loop")))return e.stopImmediatePropagation(),e.preventDefault(),!1}),window.addEventListener("unhandledrejection",e=>{if(e.reason&&"string"===typeof e.reason.message&&(e.reason.message.includes("ResizeObserver loop")||e.reason.message.includes("ResizeObserver Loop")))return e.preventDefault(),!1});const e=console.error;console.error=function(){for(var t=arguments.length,n=new Array(t),a=0;a<t;a++)n[a]=arguments[a];n.length>0&&"string"===typeof n[0]&&(n[0].includes("ResizeObserver loop")||n[0].includes("ResizeObserver Loop"))||e.apply(console,n)}}})();const Vr=()=>{var e;const{isDarkMode:t}=v(),{showError:f,errorMessage:j,handleCloseError:w,showErrorMessage:N}=(()=>{const[e,t]=(0,i.useState)(!1),[n,a]=(0,i.useState)("");return{showError:e,errorMessage:n,handleCloseError:(0,i.useCallback)(()=>{t(!1)},[]),showErrorMessage:(0,i.useCallback)(e=>{a(e),t(!0)},[])}})(),{hasSeenTutorial:P,hasSeenHandlebar:M,setHasSeenTutorial:z,setHasSeenHandlebar:L,uiState:{isMinimapVisible:F,controlsVisible:R},setUIState:V}=(0,g.Y)(),{tabs:B,getActiveTab:U,updateTabExecutionStatus:H}=C(),{crewAIFlowEnabled:G}=(0,S.d)(),{runHistory:J,startPolling:q,stopPolling:Y}=(0,E.a)(),{nodes:X,edges:Z,setNodes:Q,setEdges:$,onNodesChange:ee,onEdgesChange:te,onConnect:ne,handleEdgeContextMenu:ae,selectedEdges:se,setSelectedEdges:ie,manuallyPositionedNodes:oe}=(e=>{let{showErrorMessage:t}=e;const{t:n}=(0,y.Bd)(),{nodes:s,edges:o,setNodes:r,setEdges:l,selectedEdges:d,setSelectedEdges:c,contextMenu:u,setContextMenu:h,flowConfig:m,setFlowConfig:p,draggedNodeIds:x,setDraggedNodeIds:f,manuallyPositionedNodes:v,setManuallyPositionedNodes:b,clearCanvas:j,deleteEdge:w,addEdge:k}=(0,g.Y)(),C=(0,i.useMemo)(()=>new Set(x),[x]),S=(0,i.useMemo)(()=>new Set(v),[v]),_=(0,i.useCallback)(()=>{j()},[j]),E=(0,i.useCallback)(e=>{const t=e.filter(e=>"position"===e.type),n=e.filter(e=>"position"!==e.type||!("position"in e));if(t.length>0){const e=new Set(C),n=new Set(S);r(s.map(s=>{const i=t.find(e=>e.id===s.id);return i&&(i.dragging?(e.add(s.id),n.add(s.id)):e.has(s.id)&&e.delete(s.id),i.position&&isFinite(i.position.x)&&isFinite(i.position.y))?(0,a.A)((0,a.A)({},s),{},{position:{x:i.position.x,y:i.position.y}}):s})),f(Array.from(e)),b(Array.from(n))}n.length>0&&r((0,A._0)(n,s))},[s,r,C,S,f,b]);(0,i.useEffect)(()=>{const e=new Set(s.map(e=>e.id));let t=!1;const n=new Set;S.forEach(a=>{e.has(a)?n.add(a):t=!0}),t&&b(Array.from(n))},[s,S,b]);const I=(0,i.useCallback)(e=>{l((0,A.zW)(e,o))},[o,l]),T=(0,i.useCallback)(e=>{if(e.source&&e.target){const a=s.find(t=>t.id===e.source),i=s.find(t=>t.id===e.target);if(!a||!i)return;if("agentNode"===a.type&&"agentNode"===i.type)return void t(n("nemo.errors.agentConnection"));k(e)}},[s,k,n,t]),D=(0,i.useCallback)((e,t)=>{e.preventDefault(),h({mouseX:e.clientX,mouseY:e.clientY,edgeId:t.id})},[h]),N=(0,i.useCallback)(()=>{h(null)},[h]),P=(0,i.useCallback)(e=>{w(e)},[w]);return{nodes:s,setNodes:r,edges:o,setEdges:l,onNodesChange:E,onEdgesChange:I,onConnect:T,handleClearCanvas:_,handleEdgeContextMenu:D,handleContextMenuClose:N,handleDeleteEdge:P,selectedEdges:d,setSelectedEdges:c,contextMenu:u,flowConfig:m,setFlowConfig:p,manuallyPositionedNodes:Array.from(S),setManuallyPositionedNodes:e=>b(e)}})({showErrorMessage:N}),{activeTabId:re}=_({nodes:X,edges:Z,setNodes:Q,setEdges:$}),{agents:le,addAgentNode:de,isAgentDialogOpen:ce,setIsAgentDialogOpen:ue,handleAgentSelect:he,handleShowAgentForm:me,fetchAgents:pe,openInCreateMode:xe,openAgentDialog:ge}=(e=>{let{nodes:t,setNodes:n}=e;const[s,o]=(0,i.useState)([]),[r,l]=(0,i.useState)(!1),[d,c]=(0,i.useState)(!1),u=(0,i.useCallback)(async()=>{try{const e=await fe.AgentService.listAgents();o(e)}catch(e){}},[]);(0,i.useEffect)(()=>{u()},[u]);const h=(0,i.useCallback)((e,t)=>{const s=t||{x:100,y:400*Math.random()},i=e.id||"temp-".concat(Date.now(),"-").concat(Math.random().toString(36).substr(2,9)),o={id:"agent-".concat(i),type:"agentNode",position:s,data:(0,a.A)((0,a.A)({},e),{},{agentId:e.id,id:e.id,label:e.name,type:"agent"})};n(e=>[...e,o])},[n]),m=(0,i.useCallback)(e=>{e.forEach((e,t)=>{h(e,{x:100,y:200+150*t})}),l(!1)},[h]),p=(0,i.useCallback)(()=>{},[]),x=(0,i.useCallback)(function(){c(arguments.length>0&&void 0!==arguments[0]&&arguments[0]),l(!0)},[]);return{agents:s,addAgentNode:h,isAgentDialogOpen:r,setIsAgentDialogOpen:l,handleAgentSelect:m,handleShowAgentForm:p,fetchAgents:u,openInCreateMode:d,openAgentDialog:x}})({nodes:X,setNodes:Q}),{tasks:ve,addTaskNode:Ae,isTaskDialogOpen:ye,setIsTaskDialogOpen:be,handleTaskSelect:je,handleShowTaskForm:we,fetchTasks:ke,openInCreateMode:Ce,openTaskDialog:Se}=(e=>{let{nodes:t,setNodes:n}=e;const[s,o]=(0,i.useState)([]),[r,l]=(0,i.useState)(!1),[d,c]=(0,i.useState)(!1),u=(0,i.useCallback)(async()=>{try{const e=await Re.listTasks();o(e)}catch(e){}},[]);(0,i.useEffect)(()=>{u()},[u]);const h=(0,i.useCallback)((e,t)=>{var s;const i=t||{x:100,y:400*Math.random()},o={id:"task-".concat(e.id),type:"taskNode",position:i,data:(0,a.A)((0,a.A)({},e),{},{taskId:e.id,label:e.name,type:"task",config:(0,a.A)((0,a.A)({},e.config),{},{markdown:(null===(s=e.config)||void 0===s?void 0:s.markdown)||!1})})};n(e=>[...e,o])},[n]),m=(0,i.useCallback)(e=>{e.forEach((e,t)=>{h(e,{x:400,y:200+150*t})}),l(!1)},[h]),p=(0,i.useCallback)(()=>{},[]),x=(0,i.useCallback)(function(){c(arguments.length>0&&void 0!==arguments[0]&&arguments[0]),l(!0)},[]);return{tasks:s,addTaskNode:h,isTaskDialogOpen:r,setIsTaskDialogOpen:l,handleTaskSelect:m,handleShowTaskForm:p,fetchTasks:u,openInCreateMode:d,openTaskDialog:x}})({nodes:X,setNodes:Q}),{updateScreenDimensions:_e,setChatPanelWidth:Ee,setChatPanelCollapsed:Ie,setChatPanelVisible:Te,setExecutionHistoryHeight:De,setExecutionHistoryVisible:Ne,setPanelPosition:Pe,setAreFlowsVisible:Me,chatPanelWidth:ze,chatPanelCollapsed:Oe,executionHistoryHeight:Le,chatPanelVisible:Fe,executionHistoryVisible:We,panelPosition:Ve,areFlowsVisible:Ue}=Ns(),{isDraggingPanel:He,setIsDraggingPanel:Ke,panelState:Ge,setPanelState:Je,handlePanelDragStart:qe,handleSnapToLeft:Ye,handleSnapToRight:Xe,handleResetPanel:Ze}=(()=>{const[e,t]=(0,i.useState)(50),[n,a]=(0,i.useState)(!1),[s,o]=(0,i.useState)(Or),[r,l]=(0,i.useState)(!1),[d,c]=(0,i.useState)(!0),[u,h]=(0,i.useState)(!0),m=(0,i.useCallback)(()=>{a(!0)},[]),p=(0,i.useCallback)(()=>{o(Fr),t(5)},[]),x=(0,i.useCallback)(()=>{o(Lr),t(95)},[]),g=(0,i.useCallback)(()=>{o(Or),t(50)},[]),f=(0,i.useCallback)(()=>{l(e=>(e?(t(50),setTimeout(()=>{var e;const t=null===(e=document.querySelector("[data-crew-container]"))||void 0===e?void 0:e.parentElement;t&&(t.style.gridTemplateColumns="1fr")},0)):setTimeout(()=>{var e;const t=null===(e=document.querySelector("[data-crew-container]"))||void 0===e?void 0:e.parentElement;t&&(t.style.gridTemplateColumns="50% 50%")},0),!e))},[]),v=(0,i.useCallback)(()=>{h(e=>!e)},[]);return(0,i.useEffect)(()=>{if(n){const e=e=>{const n=document.querySelector(".react-flow");if(!n)return;const a=n.getBoundingClientRect(),s=(e.clientX-a.left)/a.width*100,i=Math.max(10,Math.min(90,s));t(i)},n=()=>{a(!1)};return document.addEventListener("mousemove",e),document.addEventListener("mouseup",n),()=>{document.removeEventListener("mousemove",e),document.removeEventListener("mouseup",n)}}},[n]),{panelPosition:e,setPanelPosition:t,isDraggingPanel:n,setIsDraggingPanel:a,panelState:s,setPanelState:o,areFlowsVisible:r,setAreFlowsVisible:l,handlePanelDragStart:m,handleSnapToLeft:p,handleSnapToRight:x,handleResetPanel:g,toggleFlowsVisibility:f,showRunHistory:d,setShowRunHistory:c,showChatPanel:u,setShowChatPanel:h,toggleChatPanel:v}})(),Qe=i.useCallback(()=>{Me(!Ue)},[Ue,Me]),$e=i.useCallback(()=>{Te(!Fe),setTimeout(()=>{const e=new CustomEvent("recalculateNodePositions",{detail:{reason:"chat-panel-visibility-toggle"}});window.dispatchEvent(e)},350)},[Fe,Te]),et=i.useCallback(e=>{const t="function"===typeof e?e(Ve):e;Pe(t)},[Ve,Pe]),tt=i.useCallback(()=>{Ne(!We)},[We,Ne]);i.useEffect(()=>{const e=()=>{We||Ne(!0)};return window.addEventListener("openExecutionHistory",e),()=>{window.removeEventListener("openExecutionHistory",e)}},[We,Ne]);const nt=((e,t)=>{const[n,a]=(0,i.useState)(!1),[s,o]=(0,i.useState)(!1),[r,l]=(0,i.useState)(!1),[d,c]=(0,i.useState)(!1),[u,h]=(0,i.useState)(!1),[m,p]=(0,i.useState)(!1),[x,g]=(0,i.useState)(!1),[f,v]=(0,i.useState)(!1),[A,y]=(0,i.useState)(!1),[b,j]=(0,i.useState)(!1);(0,i.useEffect)(()=>{},[b]),(0,i.useEffect)(()=>{const e=new URLSearchParams(window.location.search),t=e.get("config"),n=e.get("provider");"apikeys"===t&&(h(!0),n&&Be.getState().openApiKeyEditor(n),window.history.replaceState({},document.title,window.location.pathname))},[]),(0,i.useCallback)(()=>{p(!0)},[]);const w=(0,i.useCallback)(()=>{j(!1),t(!0)},[t]);return(0,i.useEffect)(()=>{const e=()=>{h(!0)};return window.addEventListener("openConfigAPIKeysInternal",e),()=>{window.removeEventListener("openConfigAPIKeysInternal",e)}},[]),{isAgentDialogOpen:n,setIsAgentDialogOpen:a,isTaskDialogOpen:s,setIsTaskDialogOpen:o,isCrewPlanningOpen:r,setCrewPlanningOpen:l,isScheduleDialogOpen:d,setScheduleDialogOpen:c,isAPIKeysDialogOpen:u,setIsAPIKeysDialogOpen:h,isToolsDialogOpen:m,setIsToolsDialogOpen:p,isLogsDialogOpen:x,setIsLogsDialogOpen:g,isConfigurationDialogOpen:f,setIsConfigurationDialogOpen:v,isFlowDialogOpen:A,setIsFlowDialogOpen:y,isTutorialOpen:b,setIsTutorialOpen:j,handleCloseTutorial:w}})(0,z),[at,st]=i.useState(!1),[it,ot]=i.useState(!1),[rt,lt]=i.useState(!1),[dt,ct]=i.useState(0),[ut,ht]=i.useState(!1),[mt,pt]=i.useState([]),[xt,gt]=i.useState(null),[ft,vt]=i.useState(!1),[At,yt]=i.useState(null),[bt,jt]=i.useState(null),[wt,kt]=i.useState(null),{handleResizeStart:Ct}=I(Ee);i.useEffect(()=>{const e=()=>{_e(window.innerWidth,window.innerHeight)};return _e(window.innerWidth,window.innerHeight),window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)},[_e]);const{handleHistoryResizeStart:St}=T(De,lt);i.useEffect(()=>{if(!rt&&We){const e=100,t=32,n=4;if(0===dt)De(e+t);else{const a=Math.min(dt,n);De(e+a*t)}}},[dt,rt,We,De]);const{isExecuting:_t,selectedModel:Et,planningEnabled:It,reasoningEnabled:Tt,schemaDetectionEnabled:Dt,tools:Nt,selectedTools:Mt,setSelectedModel:zt,setPlanningEnabled:Ot,setReasoningEnabled:Lt,setSchemaDetectionEnabled:Ft,setSelectedTools:Rt,handleRunClick:Vt,handleGenerateCrew:Bt,executeTab:Ut,executeFlow:Ht,setNodes:Kt,setEdges:Gt,showInputVariablesDialog:Jt,setShowInputVariablesDialog:qt,executeWithVariables:Yt}=(0,b.E)();i.useEffect(()=>{},[wt,_t]),i.useEffect(()=>("undefined"!==typeof window&&(window.clearStuckTabs=()=>{const e=C.getState();e.tabs.forEach(t=>{"running"===t.executionStatus&&e.updateTabExecutionStatus(t.id,"completed")})}),()=>{"undefined"!==typeof window&&delete window.clearStuckTabs}),[]),(0,i.useEffect)(()=>{Kt(X)},[X,Kt]),(0,i.useEffect)(()=>{Gt(Z)},[Z,Gt]),(0,i.useEffect)(()=>{localStorage.getItem("hasSeenHandlebar")||(localStorage.setItem("hasSeenHandlebar","true"),L(!0))},[L]),(0,i.useEffect)(()=>{const e=e=>{const{jobId:t}=e.detail;jt(t)};return window.addEventListener("jobViewed",e),()=>{window.removeEventListener("jobViewed",e)}},[]);const[Xt,Zt]=i.useState(null),Qt=i.useRef(null),$t=i.useRef(null),{loadTaskStates:en,clearTaskStates:tn}=(0,Pt.useTaskExecutionStore)();(0,i.useEffect)(()=>{const e=e=>{const{jobId:t}=e.detail;Xt!==t&&tn(),Zt(t),$t.current&&clearInterval($t.current),$t.current=setInterval(()=>{en(t)},2e3),en(t),q()};return window.addEventListener("jobCreated",e),()=>{window.removeEventListener("jobCreated",e)}},[q,en,tn,Xt]),(0,i.useEffect)(()=>{const e=()=>{$t.current&&(clearInterval($t.current),$t.current=null),setTimeout(()=>{tn()},1e4);const e=U(),t=C.getState();wt?(t.updateTabExecutionStatus(wt,"completed"),kt(null)):"running"===(null===e||void 0===e?void 0:e.executionStatus)?t.updateTabExecutionStatus(e.id,"completed"):t.tabs.forEach(e=>{"running"===e.executionStatus&&t.updateTabExecutionStatus(e.id,"completed")}),Qt.current&&(clearTimeout(Qt.current),Qt.current=null),Zt(null)},t=()=>{$t.current&&(clearInterval($t.current),$t.current=null),setTimeout(()=>{tn()},1e4);const e=U(),t=C.getState();wt?(t.updateTabExecutionStatus(wt,"failed"),kt(null)):"running"===(null===e||void 0===e?void 0:e.executionStatus)?t.updateTabExecutionStatus(e.id,"failed"):t.tabs.forEach(e=>{"running"===e.executionStatus&&t.updateTabExecutionStatus(e.id,"failed")}),Qt.current&&(clearTimeout(Qt.current),Qt.current=null),Zt(null)};return window.addEventListener("jobCompleted",e),window.addEventListener("jobFailed",t),()=>{window.removeEventListener("jobCompleted",e),window.removeEventListener("jobFailed",t),$t.current&&(clearInterval($t.current),$t.current=null)}},[wt,U,tn]),(0,i.useEffect)(()=>{if(Xt&&J.length>0){const e=J.find(e=>e.job_id===Xt);if(e&&("completed"===e.status.toLowerCase()||"failed"===e.status.toLowerCase())){wt&&(H(wt,e.status.toLowerCase()),kt(null));const t=C.getState();t.tabs.forEach(n=>{"running"===n.executionStatus&&t.updateTabExecutionStatus(n.id,e.status.toLowerCase())}),Zt(null)}}},[Xt,J,wt,H]),(0,i.useEffect)(()=>{const e=()=>{const e=C.getState();e.tabs.forEach(t=>{"running"===t.executionStatus&&e.updateTabExecutionStatus(t.id,"completed")}),wt&&kt(null),Zt(null),Qt.current&&(clearTimeout(Qt.current),Qt.current=null)};return window.addEventListener("forceClearExecution",e),()=>{window.removeEventListener("forceClearExecution",e)}},[wt]);const{paneContextMenu:nn,handlePaneContextMenu:sn,handlePaneContextMenuClose:on}=(()=>{const[e,t]=(0,i.useState)(null);return{paneContextMenu:e,handlePaneContextMenu:(0,i.useCallback)(e=>{e.preventDefault(),t({mouseX:e.clientX,mouseY:e.clientY})},[]),handlePaneContextMenuClose:(0,i.useCallback)(()=>{t(null)},[])}})(),{crewFlowInstanceRef:rn,flowFlowInstanceRef:ln,handleCrewFlowInit:dn,handleFlowFlowInit:cn}=(()=>{const e=(0,i.useRef)(null),t=(0,i.useRef)(null),n=(0,i.useCallback)(t=>{e.current=t,setTimeout(()=>{window.dispatchEvent(new CustomEvent("crewFlowInitialized",{detail:{instance:t}}))},100)},[]),a=(0,i.useCallback)(e=>{t.current=e},[]);return{crewFlowInstanceRef:e,flowFlowInstanceRef:t,handleCrewFlowInit:n,handleFlowFlowInit:a}})(),un=(0,i.useRef)(null),hn=(0,i.useRef)(!1);(0,i.useEffect)(()=>(hn.current=!1,()=>{hn.current=!0,Y()}),[Y]),(0,i.useEffect)(()=>{const e=setTimeout(async()=>{const{tabs:e}=C.getState(),{fetchRunHistory:t}=E.a.getState(),{loadTaskStates:n,clearTaskStates:a}=Pt.useTaskExecutionStore.getState(),s=e.find(e=>"running"===e.executionStatus);s&&kt(s.id),await t();const{runHistory:i}=E.a.getState();if(i.length>0){const e=i.filter(e=>"running"===e.status.toLowerCase()||"queued"===e.status.toLowerCase());if(e.length>0){const t=e[0];Zt(t.job_id),a(),$t.current&&clearInterval($t.current),$t.current=setInterval(()=>{n(t.job_id)},2e3),n(t.job_id)}}},100);return()=>{clearTimeout(e),$t.current&&clearInterval($t.current)}},[]),((e,t,n,s,o,r,l,d,c,u)=>{(0,i.useEffect)(()=>{if(!e.length)return;if(n)return;const i=new Set(r),h=Date.now(),m=new Set(e.filter(e=>{var t;return(null===(t=e.data)||void 0===t?void 0:t.addedTimestamp)&&h-e.data.addedTimestamp<1e3}).map(e=>e.id)),p=()=>s&&o!==Lr&&d.current?d.current:l.current?l.current:null;return p()?(c.current&&clearTimeout(c.current),c.current=setTimeout(()=>{if(u.current)return;let n=!1;const s=e.map(e=>i.has(e.id)||m.has(e.id)||e.position&&isFinite(e.position.x)&&isFinite(e.position.y)&&Math.abs(e.position.x)<1e4&&Math.abs(e.position.y)<1e4?e:(n=!0,(0,a.A)((0,a.A)({},e),{},{position:{x:300*Math.random(),y:300*Math.random()}})));n&&(t(s),setTimeout(()=>{if(u.current)return;const e=p();e&&e.fitView({padding:.2,includeHiddenNodes:!1})},300))},200),()=>{c.current&&clearTimeout(c.current)}):void 0},[e,t,o,s,n,r,l,d,c,u])})(X,Q,He,Ue,Ge,oe,rn,ln,un,hn);const mn=(e=>(0,i.useCallback)(t=>{e(t.edges||[])},[e]))(ie),pn=((e,t)=>(0,i.useCallback)((n,s,i)=>{setTimeout(()=>{(()=>{const o=new Map,r=n.map(e=>{const t=e.id,n=(0,k.A)();return o.set(t,n),(0,a.A)((0,a.A)({},e),{},{id:n,position:{x:e.position.x,y:e.position.y},data:(0,a.A)({},e.data)})}),l=s.map(e=>{const t={source:o.get(e.source)||e.source,target:o.get(e.target)||e.target,sourceHandle:null,targetHandle:null};return(0,Wr.Qd)(t,"animated",!0,{stroke:"#9c27b0"})});r.length>0&&e(e=>{const t=new Set(e.map(e=>{var t;return null===(t=e.data)||void 0===t?void 0:t.label})),n=r.filter(e=>{var n,a,s,i;return!(null!==(n=e.type)&&void 0!==n&&n.includes("crewNode")||null!==(a=e.type)&&void 0!==a&&a.includes("agentNode")||null!==(s=e.type)&&void 0!==s&&s.includes("taskNode"))||!t.has(null===(i=e.data)||void 0===i?void 0:i.label)});return[...e,...n]}),i&&i.listeners&&i.listeners.length>0&&r.forEach(e=>{var t;e.data&&e.data.listener&&(null===(t=i.listeners)||void 0===t||t.find(t=>t.crewId===String(e.data.crewRef)&&t.tasks&&Array.isArray(t.tasks)&&t.tasks.some(t=>e.data.listener.tasks.some(e=>e.id===t.id))))}),l.length>0&&t(e=>zr(l,e)),setTimeout(()=>{window.dispatchEvent(new CustomEvent("fitViewToNodes"));const e=(null===i||void 0===i?void 0:i.name)||"Flow";window.dispatchEvent(new CustomEvent("showNotification",{detail:{message:"".concat(e," loaded successfully")}}))},300)})()},100)},[e,t]))(Q,$),{isCrewFlowDialogOpen:xn,setIsCrewFlowDialogOpen:gn,openCrewOrFlowDialog:fn}=(()=>{const[e,t]=(0,i.useState)(!1),n=(0,i.useCallback)(()=>{t(!0)},[]);return(0,i.useEffect)(()=>{const e=()=>{n()};return window.addEventListener("openCrewFlowDialog",e),()=>{window.removeEventListener("openCrewFlowDialog",e)}},[n]),{isCrewFlowDialogOpen:e,setIsCrewFlowDialogOpen:t,openCrewOrFlowDialog:n}})(),[vn,An]=(0,i.useState)(0),[yn,bn]=(0,i.useState)(void 0),{isFlowDialogOpen:jn,setIsFlowDialogOpen:wn,openFlowDialog:kn}=(()=>{const[e,t]=(0,i.useState)(!1),n=(0,i.useCallback)(()=>{t(!0)},[]);return(0,i.useEffect)(()=>{const e=()=>{n()};return window.addEventListener("openFlowDialog",e),()=>{window.removeEventListener("openFlowDialog",e)}},[n]),{isFlowDialogOpen:e,setIsFlowDialogOpen:t,openFlowDialog:n}})(),Cn=((e,t,n)=>(0,i.useCallback)(function(a,s,i){let o=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const r=a.map(e=>{const t=s[e.id.toString()];return{id:"crew-".concat(Date.now(),"-").concat(e.id),type:"crewNode",position:t,data:{id:e.id.toString(),label:e.name,crewName:e.name,crewId:e.id,flowConfig:i}}}),l=oa(r);e(e=>[...e,...l]);const d=[];if(i&&i.listeners){const e=l.reduce((e,t)=>(e[t.data.crewId.toString()]=t.id,e),{});i.listeners.forEach(t=>{const n=e[t.crewId.toString()];n&&t.tasks&&t.tasks.forEach(t=>{const a=t,s=a.agent_id?Number(a.agent_id):null;if(s&&e[s.toString()]){const t=e[s.toString()],a={source:n,target:t,sourceHandle:null,targetHandle:null};d.push((0,Wr.Qd)(a,"animated",!0,{stroke:"#9c27b0"}))}})}),d.length>0&&t(e=>zr(d,e))}if(o&&i){const e=a[0];if(!e||!e.id)return void n("No valid crew found to associate with the flow");const t=e.id,s={name:i.name,crew_id:String(t),nodes:l,edges:d,flowConfig:i};Wt.saveFlow(s).then(e=>{n("Flow saved successfully")}).catch(e=>{n("Failed to save flow: ".concat(e instanceof Error?e.message:"Unknown error"))})}},[e,t,n]))(Q,$,N),{handleRunClickWrapper:Sn,handleCrewSelectWrapper:_n}=((e,t,n)=>{const a=(0,i.useCallback)(async t=>{t&&await e(t)},[e]),s=(0,i.useCallback)((e,a,s,i)=>{var o;window.dispatchEvent(new CustomEvent("crewLoadStarted"));const{createTab:r,updateTabNodes:l,updateTabEdges:d,setActiveTab:c,getActiveTab:u,updateTabCrewInfo:h}=C.getState(),m=(null===(o=u())||void 0===o||o.id,r(s||"Loaded Crew"));c(m),setTimeout(()=>{u(),l(m,e),d(m,a),s&&i&&h(m,i,s),t(e),n(a),setTimeout(()=>{window.dispatchEvent(new CustomEvent("fitViewToNodes"))},200),setTimeout(()=>{window.dispatchEvent(new CustomEvent("crewLoadCompleted"))},500)},100)},[t,n]);return(0,i.useEffect)(()=>{const e=()=>{a("crew")},t=()=>{a("flow")};return window.addEventListener("executeCrewEvent",e),window.addEventListener("executeFlowEvent",t),()=>{window.removeEventListener("executeCrewEvent",e),window.removeEventListener("executeFlowEvent",t)}},[a]),(0,i.useEffect)(()=>{const e=()=>{window.dispatchEvent(new CustomEvent("fitViewToNodesInternal"))};return window.addEventListener("fitViewToNodes",e),()=>{window.removeEventListener("fitViewToNodes",e)}},[]),(0,i.useEffect)(()=>{const e=()=>{window.dispatchEvent(new CustomEvent("openConfigAPIKeysInternal"))};return window.addEventListener("openConfigAPIKeys",e),()=>{window.removeEventListener("openConfigAPIKeys",e)}},[]),{handleRunClickWrapper:a,handleCrewSelectWrapper:s}})(e=>e?Vt(e):Promise.resolve(),Q,$),En=(0,i.useRef)(null),In=(0,i.useCallback)(async e=>{const t=B.find(t=>t.id===e);if(t){kt(e),H(e,"running");try{await Ut(e,t.nodes,t.edges,t.name)}catch(n){kt(null),H(e,"failed")}}},[B,Ut,H]),Tn=(0,i.useCallback)(async e=>{try{const t=e||bt;if(!t){const e=new CustomEvent("executionError",{detail:{message:"No execution found. Please run a crew first or select an execution from the history.",type:"logs"}});return void window.dispatchEvent(e)}vt(!0),yt(null),gt(t),ht(!0),jt(t);const n=await Yi.m.getHistoricalLogs(t);pt(n.map(e=>{let{job_id:t,execution_id:n}=e,i=(0,s.A)(e,Rr);return(0,a.A)((0,a.A)({},i),{},{output:i.output||i.content,id:i.id||Date.now()})})),Yi.m.connectToJobLogs(t);const i=Yi.m.onConnected(t,()=>{vt(!1)}),o=Yi.m.onJobLogs(t,e=>{pt(t=>[...t,{id:e.id||Date.now(),output:e.output||e.content,timestamp:e.timestamp}])}),r=Yi.m.onError(t,()=>{yt("Failed to connect to log stream"),vt(!1)}),l=Yi.m.onClose(t,()=>{vt(!1)});return()=>{i(),o(),r(),l(),Yi.m.disconnectFromJobLogs(t)}}catch(t){yt("Failed to load execution logs"),vt(!1)}},[bt]),{handleUIAwareFitView:Dn,handleFitViewToNodesInternal:Nn}=xi({nodes:X,crewFlowInstanceRef:rn,flowFlowInstanceRef:ln});return gi({nodes:X,setNodes:Q,crewFlowInstanceRef:rn,flowFlowInstanceRef:ln,handleUIAwareFitView:Dn,handleFitViewToNodesInternal:Nn}),(0,O.jsx)("div",{className:"workflow-designer",children:(0,O.jsxs)(o.A,{sx:{width:"100%",height:"100vh",position:"relative",display:"flex",flexDirection:"column",overflow:"hidden"},"data-tour":"workflow-designer",children:[(0,O.jsx)(Ni,{isOpen:nt.isTutorialOpen,onClose:nt.handleCloseTutorial}),(0,O.jsx)(ds,{onRunTab:In,isRunning:!!wt,runningTabId:wt,onLoadCrew:()=>{An(0),bn(0),gn(!0)},onLoadAgents:()=>{An(1),bn(1),gn(!0)},onLoadTasks:()=>{An(2),bn(2),gn(!0)},disabled:it||at||!!wt}),(0,O.jsx)(o.A,{sx:{flex:1,display:"flex",flexDirection:"row",overflow:"hidden",position:"relative"},children:(0,O.jsxs)(o.A,{sx:{flex:1,display:"flex",flexDirection:"column",overflow:"hidden",position:"relative",width:Fe?"calc(100% - ".concat(Oe?60:ze,"px)"):"100%",transition:"width 0.3s ease-in-out"},children:[(0,O.jsx)(Ka,{areFlowsVisible:Ue,showRunHistory:!1,panelPosition:Ve,isDraggingPanel:He,isDarkMode:t,nodes:X,edges:Z,onNodesChange:ee,onEdgesChange:te,onConnect:ne,onSelectionChange:mn,onPaneContextMenu:sn,onCrewFlowInit:dn,onFlowFlowInit:cn,planningEnabled:It,setPlanningEnabled:Ot,reasoningEnabled:Tt,setReasoningEnabled:Lt,schemaDetectionEnabled:Dt,setSchemaDetectionEnabled:Ft,selectedModel:Et,setSelectedModel:zt,onOpenLogsDialog:()=>nt.setIsLogsDialogOpen(!0),onToggleChat:$e,isChatOpen:Fe,setIsAgentDialogOpen:()=>ge(!0),setIsTaskDialogOpen:()=>Se(!0),setIsFlowDialogOpen:nt.setIsFlowDialogOpen,onOpenTutorial:()=>{nt.setIsTutorialOpen(!0)},onOpenConfiguration:()=>nt.setIsConfigurationDialogOpen(!0),onPanelDragStart:e=>{e.preventDefault();const t=e.currentTarget.parentElement;if(!t)return;const n=t.getBoundingClientRect(),a=e.currentTarget;let s=Ve;const i=e=>{const i=(e.clientX-n.left)/n.width*100,o=Math.max(20,Math.min(80,i));Math.abs(o-s)<.1||(a.style.left="".concat(o,"%"),t.style.gridTemplateColumns="".concat(o,"% ").concat(100-o,"%"),s=o)},o=()=>{Ke(!1),et(s),document.removeEventListener("mousemove",i),document.removeEventListener("mouseup",o)};Ke(!0),document.addEventListener("mousemove",i),document.addEventListener("mouseup",o)}}),Fe&&(0,O.jsxs)(o.A,{onMouseEnter:()=>{window.postMessage({type:"chat-hover-state",isHovering:!0},"*")},onMouseLeave:()=>{window.postMessage({type:"chat-hover-state",isHovering:!1},"*")},sx:{position:"absolute",top:0,right:48,bottom:We?"".concat(Le-0,"px"):0,width:Oe?"60px":"".concat(ze,"px"),display:"flex",flexDirection:"row",overflow:"hidden",borderLeft:1,borderColor:"divider",backgroundColor:"background.paper",zIndex:10,transition:Oe?"width 0.3s ease-in-out":"none"},children:[!Oe&&(0,O.jsx)(o.A,{onMouseDown:Ct,sx:{width:4,height:"100%",backgroundColor:"divider",cursor:"ew-resize","&:hover":{backgroundColor:"primary.main"},transition:"background-color 0.2s ease",zIndex:7}}),(0,O.jsx)(o.A,{sx:{flex:1,display:"flex",flexDirection:"column"},children:(0,O.jsx)(pi,{onNodesGenerated:(e,t)=>{Q(t=>[...t,...e]),$(e=>[...e,...t])},onLoadingStateChange:ot,isVisible:Fe,nodes:X,edges:Z,onExecuteCrew:()=>{const e=U();if(e){kt(e.id),H(e.id,"running"),Qt.current&&clearTimeout(Qt.current);const t=e.id;Qt.current=setTimeout(()=>{kt(e=>e===t?null:e),H(t,"completed")},3e5)}Kt(X),Gt(Z),setTimeout(()=>{Vt("crew")},100)},isCollapsed:Oe,onToggleCollapse:()=>{Ie(!Oe),setTimeout(()=>{const e=new CustomEvent("recalculateNodePositions",{detail:{reason:"chat-panel-toggle"}});window.dispatchEvent(e)},350)},chatSessionId:null===(e=U())||void 0===e?void 0:e.chatSessionId,onOpenLogs:Tn})})]})]})}),G&&(0,O.jsx)(W,{isVisible:Ue,togglePanel:Qe,position:"right",tooltip:Ue?"Hide Flows Panel":"Show Flows Panel"}),We&&(0,O.jsxs)(o.A,{sx:{position:"absolute",bottom:0,left:0,right:0,height:"".concat(Le,"px"),backgroundColor:t?"rgba(26, 26, 26, 0.95)":"rgba(255, 255, 255, 0.95)",backdropFilter:"blur(8px)",display:"flex",flexDirection:"column",borderTop:1,borderColor:"divider",zIndex:8},children:[(0,O.jsx)(o.A,{onMouseDown:St,sx:{position:"absolute",top:0,left:0,right:0,height:4,backgroundColor:"divider",cursor:"ns-resize","&:hover":{backgroundColor:"primary.main"},transition:"background-color 0.2s ease",zIndex:7}}),(0,O.jsx)(o.A,{sx:{flex:1,paddingTop:"4px",overflow:"hidden",display:"flex",flexDirection:"column"},children:(0,O.jsx)(Si,{executionHistoryHeight:Le,onExecutionCountChange:ct})})]}),(0,O.jsx)(fi,{open:ce,onClose:()=>ue(!1),onAgentSelect:he,agents:le,onShowAgentForm:me,fetchAgents:pe,showErrorMessage:N,openInCreateMode:xe}),(0,O.jsx)(vi,{open:ye,onClose:()=>be(!1),onTaskSelect:je,tasks:ve,onShowTaskForm:we,fetchTasks:ke,openInCreateMode:Ce}),(0,O.jsx)($n,{open:nt.isCrewPlanningOpen,onClose:()=>nt.setCrewPlanningOpen(!1),onGenerateCrew:Bt,selectedModel:Et,tools:Nt,selectedTools:Mt.map(e=>e.id||""),onToolsChange:e=>{const t=Nt.filter(t=>t.id&&e.includes(t.id));Rt(t)}}),(0,O.jsx)(xa,{open:xn,onClose:()=>{gn(!1),An(0),bn(void 0)},onCrewSelect:_n,onFlowSelect:pn,onAgentSelect:he,onTaskSelect:je,initialTab:vn,showOnlyTab:yn}),(0,O.jsx)(xa,{open:jn,onClose:()=>wn(!1),onCrewSelect:_n,onFlowSelect:pn,onAgentSelect:he,onTaskSelect:je,initialTab:1}),(0,O.jsx)(ki,{open:nt.isScheduleDialogOpen,onClose:()=>nt.setScheduleDialogOpen(!1),nodes:X,edges:Z,planningEnabled:It,selectedModel:Et}),(0,O.jsx)(r.A,{open:nt.isAPIKeysDialogOpen,onClose:()=>nt.setIsAPIKeysDialogOpen(!1),maxWidth:"lg",fullWidth:!0,children:(0,O.jsx)(l.A,{children:(0,O.jsx)(Vi,{})})}),(0,O.jsx)(r.A,{open:nt.isToolsDialogOpen,onClose:()=>nt.setIsToolsDialogOpen(!1),maxWidth:"lg",fullWidth:!0,children:(0,O.jsx)(l.A,{children:(0,O.jsx)(fo.default,{})})}),(0,O.jsxs)(r.A,{open:nt.isLogsDialogOpen,onClose:()=>nt.setIsLogsDialogOpen(!1),maxWidth:"lg",fullWidth:!0,children:[(0,O.jsxs)(d.A,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",pb:1.5,borderBottom:"1px solid",borderColor:"divider"},children:[(0,O.jsx)(c.A,{variant:"h6",children:"LLM Logs"}),(0,O.jsx)(u.A,{onClick:()=>nt.setIsLogsDialogOpen(!1),size:"small",sx:{color:"text.secondary","&:hover":{color:"text.primary"}},children:(0,O.jsx)(D.A,{})})]}),(0,O.jsx)(l.A,{children:(0,O.jsx)(Ji,{})})]}),(0,O.jsx)(r.A,{open:nt.isConfigurationDialogOpen,onClose:()=>nt.setIsConfigurationDialogOpen(!1),fullWidth:!0,maxWidth:"xl",PaperProps:{sx:{width:"80vw",maxWidth:"none",height:"80vh"}},children:(0,O.jsx)(l.A,{sx:{p:0},children:(0,O.jsx)(Pr,{onClose:()=>nt.setIsConfigurationDialogOpen(!1)})})}),(0,O.jsx)(an,{open:nt.isFlowDialogOpen,onClose:()=>nt.setIsFlowDialogOpen(!1),onAddCrews:Cn}),(0,O.jsx)(K,{open:Jt,onClose:()=>qt(!1),onConfirm:Yt,nodes:X}),(0,O.jsx)(h.A,{open:f,autoHideDuration:6e3,onClose:w,anchorOrigin:{vertical:"top",horizontal:"center"},children:(0,O.jsx)(m.A,{onClose:w,severity:"error",variant:"filled",sx:{whiteSpace:"pre-line"},children:j})}),(0,O.jsx)(p.A,{open:null!==nn,onClose:on,anchorReference:"anchorPosition",anchorPosition:null!==nn?{top:nn.mouseY,left:nn.mouseX}:void 0}),X.length>0&&(0,O.jsx)(Mr,{nodes:X,edges:Z,trigger:(0,O.jsx)(x.A,{style:{display:"none"},ref:En,children:"Save"})}),(0,O.jsx)(qi.A,{open:ut,onClose:()=>{ht(!1),xt&&Yi.m.disconnectFromJobLogs(xt)},logs:mt,jobId:xt||"",isConnecting:ft,connectionError:At}),(0,O.jsx)(Hn,{onOpenLogsDialog:()=>nt.setIsLogsDialogOpen(!0),onToggleChat:()=>Te(!Fe),isChatOpen:Fe,setIsAgentDialogOpen:()=>ge(!0),setIsTaskDialogOpen:()=>Se(!0),setIsFlowDialogOpen:nt.setIsFlowDialogOpen,setIsCrewDialogOpen:()=>{An(0),bn(void 0),gn(!0)},onSaveCrewClick:()=>{const e=new CustomEvent("openSaveCrewDialog");window.dispatchEvent(e)},showRunHistory:We,executionHistoryHeight:Le,onOpenSchedulesDialog:()=>{nt.setScheduleDialogOpen(!0)},onToggleExecutionHistory:tt}),(0,O.jsx)(zn,{onClearCanvas:()=>{Q([]),$([])},isGeneratingConnections:at,onGenerateConnections:async()=>{st(!0);try{var e;const{ConnectionService:t}=await n.e(531).then(n.bind(n,62531)),a=X.filter(e=>"agentNode"===e.type),s=X.filter(e=>"taskNode"===e.type);if(0===a.length)return void N("No agents found. Please add at least one agent to generate connections.");if(0===s.length)return void N("No tasks found. Please add at least one task to generate connections.");const i=a.map(e=>({name:e.data.label||e.data.name||"Agent ".concat(e.id),role:e.data.role||"Assistant",goal:e.data.goal||"Complete assigned tasks effectively",backstory:e.data.backstory||"A dedicated AI agent designed to help with various tasks",tools:e.data.tools||[]})),o=s.map(e=>{var t,n,a,s;return{name:e.data.label||e.data.name||"Task ".concat(e.id),description:e.data.description||e.data.label||"Task ".concat(e.id),expected_output:e.data.expected_output||"Complete the task successfully",agent_id:e.data.agent_id||"",tools:e.data.tools||[],async_execution:e.data.async_execution||!1,human_input:(null===(t=e.data.config)||void 0===t?void 0:t.human_input)||!1,markdown:(null===(n=e.data.config)||void 0===n?void 0:n.markdown)||!1,context:{type:"general",priority:1===(null===(a=e.data.config)||void 0===a?void 0:a.priority)?"high":2===(null===(s=e.data.config)||void 0===s?void 0:s.priority)?"medium":"low",complexity:"medium",required_skills:[],metadata:{}}}}),r="llama-3.1-70b-instruct",l=await t.generateConnections(i,o,r),d=[];l.assignments.forEach(e=>{const t=a.find(t=>(t.data.label||t.data.name)===e.agent_name);t&&e.tasks.forEach(e=>{const n=s.find(t=>(t.data.label||t.data.name)===e.task_name);if(n){const a="".concat(t.id,"-").concat(n.id);d.push({id:a,source:t.id,target:n.id,type:"default",data:{reasoning:e.reasoning}})}})}),null===(e=l.dependencies)||void 0===e||e.forEach(e=>{const t=s.find(t=>(t.data.label||t.data.name)===e.task_name);t&&e.depends_on&&e.depends_on.forEach(n=>{const a=s.find(e=>(e.data.label||e.data.name)===n);if(a){const n="dep-".concat(a.id,"-").concat(t.id);d.push({id:n,source:a.id,target:t.id,type:"default",style:{stroke:"#ff6b6b",strokeDasharray:"5,5"},data:{reasoning:e.reasoning,isDependency:!0}})}})}),d.length>0?$(d):N("No connections could be generated. Please check that agent and task names are properly set.")}catch(t){N("Failed to generate connections: ".concat(t instanceof Error?t.message:"Unknown error"))}finally{st(!1)}},onZoomIn:()=>{const e=rn.current||ln.current;e&&e.zoomIn({duration:200})},onZoomOut:()=>{const e=rn.current||ln.current;e&&e.zoomOut({duration:200})},onFitView:()=>{Dn()},onToggleInteractivity:()=>{},planningEnabled:It,setPlanningEnabled:Ot,reasoningEnabled:Tt,setReasoningEnabled:Lt,schemaDetectionEnabled:Dt,setSchemaDetectionEnabled:Ft,setIsConfigurationDialogOpen:nt.setIsConfigurationDialogOpen,onOpenLogsDialog:()=>nt.setIsLogsDialogOpen(!0),showRunHistory:We,executionHistoryHeight:Le,onOpenTutorial:()=>{nt.setIsTutorialOpen(!0)}})]})})},Br=Vr}}]);