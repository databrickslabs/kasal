(self.webpackChunkfrontend=self.webpackChunkfrontend||[]).push([[665],{9030:(e,t,n)=>{"use strict";n.d(t,{A:()=>s});var o=n(27887);const r=[1],s={async checkRunExists(e){try{const t="string"===typeof e&&e.includes("-");t||isNaN(parseInt(e))||parseInt(e);0;const n="/traces/job/".concat(e);return 200===(await o.Ay.get(n)).status}catch(t){const n=t;if(n.response&&404===n.response.status){"string"===typeof e&&e.includes("-");return!1}return n.response&&n.response.status,!1}},async getRunDetails(e){try{const t="string"===typeof e&&e.includes("-");r.includes(Number(e));const n=t||isNaN(parseInt(e))?null:parseInt(e);let s;0,s=t||null===n?"/executions/".concat(e):"/executions/history/".concat(n);return(await o.Ay.get(s)).data}catch(t){const n=t;if(n.response&&404===n.response.status){"string"===typeof e&&e.includes("-");0}throw t}},async getTaskDetails(e){try{return(await o.Ay.get("/tasks/".concat(e))).data}catch(t){throw t}},async getTaskName(e){try{return(await o.Ay.get("/tasks/".concat(e,"/name"))).data}catch(t){throw t}},async getTraces(e){try{const t="string"===typeof e&&e.includes("-"),n=t||isNaN(parseInt(e))?null:parseInt(e);let r;0,r=t||null===n?"/traces/job/".concat(e):"/traces/execution/".concat(n);const s=await o.Ay.get(r);return s.data&&s.data.traces&&Array.isArray(s.data.traces)?s.data.traces.map(e=>({id:e.id.toString(),event_source:e.event_source||"",event_context:e.event_context||"",event_type:e.event_type||"",task_id:e.task_id||void 0,created_at:e.created_at||e.timestamp||(new Date).toISOString(),output:e.output||e.output_data||"",extra_data:e.extra_data||void 0,trace_metadata:e.trace_metadata||void 0})):Array.isArray(s.data)?s.data.map(e=>({id:e.id.toString(),event_source:e.event_source||"",event_context:e.event_context||"",event_type:e.event_type||"",task_id:e.task_id||void 0,created_at:e.created_at||e.timestamp||(new Date).toISOString(),output:e.output||e.output_data||"",extra_data:e.extra_data||void 0,trace_metadata:e.trace_metadata||void 0})):[]}catch(t){const n=t;if(n.response&&404===n.response.status){"string"===typeof e&&e.includes("-");0}throw t}}}},24397:(e,t,n)=>{"use strict";n.d(t,{m:()=>s});var o=n(28981),r=n(27887);const s=new class{constructor(){this.connections={},this.reconnectTimers={},this.eventEmitter=void 0,this.apiUrl=void 0,this.wsUrl=void 0,this.isReconnecting={},this.eventEmitter=new o.EventEmitter,this.apiUrl=r.$W.apiUrl,this.wsUrl=this.apiUrl.replace(/^http/,"ws")}async getHistoricalLogs(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1e3,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;try{const o=(await r.uE.get("/runs/".concat(e,"/outputs"),{params:{limit:t,offset:n}})).data;return(o.logs||[]).map(t=>({id:t.id||Date.now(),job_id:e,execution_id:e,output:t.content,content:t.content,timestamp:t.timestamp,type:"historical"}))}catch(s){var o;if(404===(null===(o=s.response)||void 0===o?void 0:o.status))return[];throw s}}calculateBackoffDelay(e){return Math.min(3e3*Math.pow(2,e),48e3)}connectToJobLogs(e){if(!this.connections[e]&&!this.isReconnecting[e])try{const t=localStorage.getItem("mockUserEmail"),o=t?"?tenant_email=".concat(encodeURIComponent(t)):"",r=new WebSocket("".concat(this.wsUrl,"/logs/executions/").concat(e,"/stream").concat(o));let s=0;const a=5;r.onopen=()=>{s=0,this.isReconnecting[e]=!1,this.eventEmitter.emit("connected-".concat(e))},r.onmessage=t=>{try{const r=JSON.parse(t.data);let s=null;try{"string"===typeof r.content&&r.content.includes('"type":"task_status_update"')&&(s=JSON.parse(r.content))}catch(o){}if(s&&"task_status_update"===s.type)return Promise.resolve().then(n.bind(n,61031)).then(e=>{let{useTaskExecutionStore:t}=e;const{setTaskState:n}=t.getState(),o=s.task_id||"task_".concat(s.task_name),r="TASK_STARTED"===s.event_type?"running":"TASK_COMPLETED"===s.event_type?"completed":"failed";n(o,{status:r,task_name:s.task_name,["".concat("running"===r?"started":r,"_at")]:s.timestamp})}),void this.eventEmitter.emit("task-status-".concat(e),s);const a={id:r.id||Date.now(),job_id:e,execution_id:r.execution_id||e,output:r.content,content:r.content,timestamp:r.timestamp||(new Date).toISOString(),type:r.type||"live"};this.eventEmitter.emit("logs-".concat(e),a)}catch(r){this.eventEmitter.emit("error-".concat(e),new Error("Failed to parse message"))}},r.onerror=t=>{this.eventEmitter.emit("error-".concat(e),t)},r.onclose=t=>{if(this.eventEmitter.emit("close-".concat(e),t),delete this.connections[e],this.reconnectTimers[e]&&(clearTimeout(this.reconnectTimers[e]),delete this.reconnectTimers[e]),!t.wasClean&&s<a&&!this.isReconnecting[e]){const t=this.calculateBackoffDelay(s);this.isReconnecting[e]=!0,this.reconnectTimers[e]=setTimeout(()=>{s++,this.connectToJobLogs(e)},t)}else s>=a&&(delete this.isReconnecting[e],this.eventEmitter.emit("error-".concat(e),new Error("Failed to establish WebSocket connection after multiple attempts")))},this.connections[e]=r}catch(t){this.eventEmitter.emit("error-".concat(e),t),delete this.isReconnecting[e]}}disconnectFromJobLogs(e){this.reconnectTimers[e]&&(clearTimeout(this.reconnectTimers[e]),delete this.reconnectTimers[e]),delete this.isReconnecting[e];const t=this.connections[e];t&&(t.close(1e3,"Client disconnected"),delete this.connections[e])}onConnected(e,t){const n="connected-".concat(e);return this.eventEmitter.on(n,t),()=>{this.eventEmitter.off(n,t)}}onJobLogs(e,t){const n="logs-".concat(e);return this.eventEmitter.on(n,t),()=>{this.eventEmitter.off(n,t)}}onError(e,t){const n="error-".concat(e);return this.eventEmitter.on(n,t),()=>{this.eventEmitter.off(n,t)}}onClose(e,t){const n="close-".concat(e);return this.eventEmitter.on(n,t),()=>{this.eventEmitter.off(n,t)}}onTaskStatus(e,t){const n="task-status-".concat(e);return this.eventEmitter.on(n,t),()=>{this.eventEmitter.off(n,t)}}cleanup(){Object.keys(this.reconnectTimers).forEach(e=>{clearTimeout(this.reconnectTimers[e]),delete this.reconnectTimers[e]}),this.isReconnecting={},Object.keys(this.connections).forEach(e=>{this.disconnectFromJobLogs(e)}),this.eventEmitter.removeAllListeners()}}},27721:(e,t,n)=>{"use strict";n.d(t,{O:()=>s});var o=n(27887),r=n(13062);class s{static getInstance(){return s.instance||(s.instance=new s),s.instance}async setDatabricksConfig(e){try{return(await o.Ay.post("/databricks/config",e)).data.config}catch(n){var t;if(n instanceof r.pe)throw new Error((null===(t=n.response)||void 0===t||null===(t=t.data)||void 0===t?void 0:t.detail)||"Failed to set Databricks configuration");throw new Error("Failed to connect to the server")}}async getDatabricksConfig(){try{return(await o.Ay.get("/databricks/config")).data}catch(n){if(n instanceof r.pe){var e,t;if(404===(null===(e=n.response)||void 0===e?void 0:e.status))return null;throw new Error((null===(t=n.response)||void 0===t||null===(t=t.data)||void 0===t?void 0:t.detail)||"Failed to get Databricks configuration")}throw new Error("Failed to connect to the server")}}async checkPersonalTokenRequired(){try{return(await o.Ay.get("/databricks/status/personal-token-required")).data}catch(t){var e;if(t instanceof r.pe)throw new Error((null===(e=t.response)||void 0===e||null===(e=e.data)||void 0===e?void 0:e.detail)||"Failed to check personal token status");throw new Error("Failed to connect to the server")}}async checkDatabricksConnection(){try{return(await o.Ay.get("/databricks/connection")).data}catch(t){var e;if(t instanceof r.pe)throw new Error((null===(e=t.response)||void 0===e||null===(e=e.data)||void 0===e?void 0:e.detail)||"Failed to check Databricks connection");throw new Error("Failed to connect to the server")}}static async getConfiguration(){return s.getInstance().getDatabricksConfig()}static async updateConfiguration(e){return s.getInstance().setDatabricksConfig(e)}}s.instance=void 0},36060:(e,t,n)=>{"use strict";n.d(t,{l:()=>r});var o=n(27887);class r{static async createSchedule(e){return(await o.uE.post("/schedules",e)).data}static async listSchedules(){return(await o.uE.get("/schedules")).data}static async getSchedule(e){return(await o.uE.get("/schedules/".concat(e))).data}static async updateSchedule(e,t){return(await o.uE.put("/schedules/".concat(e),t)).data}static async deleteSchedule(e){await o.uE.delete("/schedules/".concat(e))}static async toggleSchedule(e){return(await o.uE.post("/schedules/".concat(e,"/toggle"))).data}}new r},43833:(e,t,n)=>{"use strict";n.d(t,{A:()=>I});var o=n(80045),r=n(89379),s=n(9950),a=n(2235),i=n(16491),l=n(25277),c=n(63464),d=n(92649),u=n(82053),p=n(83274),h=n(25333),m=n(28170),g=n(46639),x=n(65429),f=n(79739),y=n(18216),b=n(4804),j=n(24397),A=n(67818),v=n(44414);const w=["job_id","execution_id"],S=["job_id","execution_id"],k=e=>{if(!e)return{content:"",type:"INFO"};let t=(e=>{if(!e)return"";const t=String.fromCharCode(27),n=String.fromCharCode(7);return e.replace(new RegExp("".concat(t,"\\[[0-9;]*[ABCDEFGHJKLMSTfminsulh]"),"g"),"").replace(new RegExp("".concat(t,"\\][^").concat(n,"]*").concat(n),"g"),"").replace(new RegExp("".concat(t,"[NOPGKabcdfghinqrstuABCDHIJMOPRTl]"),"g"),"").replace(new RegExp("".concat(t,"[\\[\\]\\?\\(\\)#;0-9]*[0-9A-Za-z]"),"g"),"").replace(new RegExp(t,"g"),"").replace(/^[([{|]+/gm,"")})(e);if(t=t.replace(/^[([{|]+/gm,"").trim(),t.includes("INFO - CREW-STDOUT:")&&(t=t.replace(/INFO - CREW-STDOUT:\s*/,"").trim()),t.includes("INFO - CREWAI-LOG:")&&(t=t.replace(/INFO - CREWAI-LOG:\s*/,"").trim()),t.includes("INFO - EVENT-")&&(t=t.replace(/INFO - EVENT-/,"EVENT: ").trim()),t.includes("[CREW]")){const e=t.match(/\[CREW\]\s+\d{4}-\d{2}-\d{2}\s+\d{2}:\d{2}:\d{2},\d{3}\s*-\s*(.*)/);t=e&&e[1]?e[1].trim():t.replace(/\[CREW\]/g,"").trim()}t=t.replace(/[\u2502\u251c\u2514\u2500\u2551\u2554\u2557\u255a\u255d\u2560\u2563\u2566\u2569\u256c\u256d\u256e\u256f\u2570]/g," ").replace(/\s{2,}/g," ");let n="INFO";return e.includes("[LLM-CALL-START]")?n="LLM-CALL":e.includes("Error")||e.includes("ERROR")||e.includes("Failed")||e.includes("\u274c")?n="ERROR":e.includes("STDOUT")?n="INFO":e.includes("CREWAI-LOG:")?n="API":e.includes("EVENT-")?n="EVENT":(e.includes("[CREW]")||e.includes("\u{1f680} Crew:"))&&(n="CREW"),{content:t,type:n}},_=e=>{switch(e){case"ERROR":return"#ff5252";case"LLM-CALL":return"#ffab40";case"CREW":return"#42a5f5";case"STDOUT":return"#66bb6a";case"API":return"#7986cb";case"EVENT":return"#ba68c8";default:return"#e0e0e0"}},C={30:"#000000",31:"#ff5252",32:"#4caf50",33:"#ffeb3b",34:"#2196f3",35:"#e040fb",36:"#00bcd4",37:"#e0e0e0",90:"#9e9e9e",91:"#ff8a80",92:"#b9f6ca",93:"#ffff8d",94:"#82b1ff",95:"#ea80fc",96:"#84ffff",97:"#ffffff"},E=e=>{if(!e||!e.includes("["))return e;const t=e.split(/(\[\d+(?:;\d+)*m|\[0m)/);if(t.length<=1)return e;let n="",o=!1;return(0,v.jsx)(v.Fragment,{children:t.map((e,t)=>{if(e.match(/\[\d+(?:;\d+)*m/)){var r;if("[0m"===e)return n="",o=!1,null;return((null===(r=e.match(/\[(\d+(?:;\d+)*)m/))||void 0===r?void 0:r[1].split(";"))||[]).forEach(e=>{C[e]?n=C[e]:"1"===e&&(o=!0)}),null}return e?(0,v.jsx)("span",{style:{color:n||void 0,fontWeight:o?"bold":void 0},children:e},t):null})})},T=e=>{const t=e.includes("Error")||e.includes("Failure"),n=(e.includes("Completed")||e.includes("Success"),e.includes("Crew Execution Started"));let o="#4caf50",r="#66bb6a",s="rgba(102, 187, 106, 0.1)";t?(o="#ff5252",r="#ff5252",s="rgba(255, 82, 82, 0.1)"):n&&(o="#42a5f5",r="#42a5f5",s="rgba(66, 165, 245, 0.1)");const{title:l,lines:c}=(e=>{const t=(e=e.replace(/[\u2502\u251c\u2514\u2500\u2551\u2554\u2557\u255a\u255d\u2560\u2563\u2566\u2569\u256c\u256d\u256e\u256f\u2570]/g," ").replace(/\s{2,}/g," ")).split("\n").filter(e=>""!==e.trim());let n="";return t.length>0&&(n=t[0].trim()),{title:n,lines:t.slice(1).map(e=>e.trim()).filter(Boolean)}})(e);return(0,v.jsxs)(a.A,{elevation:0,sx:{border:"1px solid ".concat(o),borderRadius:"4px",overflow:"hidden",backgroundColor:"rgba(33, 37, 43, 0.7)",mb:.5},children:[l&&(0,v.jsx)(i.A,{sx:{backgroundColor:s,color:r,fontWeight:"bold",px:1.5,py:.5,borderBottom:"1px solid ".concat(o),fontSize:"0.9rem"},children:E(l)}),(0,v.jsx)(i.A,{sx:{p:1.5},children:c.map((e,t)=>{const n=(e=>{const t=e.match(/([^:]+):\s*(.*)/);return t?{key:t[1].trim(),value:t[2].trim()}:null})(e);return n?(0,v.jsxs)(i.A,{sx:{display:"flex",mb:.25},children:[(0,v.jsxs)(i.A,{sx:{color:"#e0e0e0",minWidth:"100px"},children:[n.key,":"]}),(0,v.jsx)(i.A,{sx:{color:o,fontWeight:"bold",ml:1},children:E(n.value)})]},t):(0,v.jsx)(i.A,{sx:{color:"white",mb:.25,fontSize:"0.85rem",lineHeight:"1.2"},children:E(e)},t)})})]})},R=e=>{if(!e)return null;const t=e.replace(/[\u2502\u251c\u2514\u2500\u2551\u2554\u2557\u255a\u255d\u2560\u2563\u2566\u2569\u256c\u256d\u256e\u256f\u2570]/g," ").replace(/\s{2,}/g," ");if(t.includes("Crew Execution Started")||t.includes("Completed")||t.includes("Error")||t.includes("Failure")){const e=t.replace(/[\u2502\u251c\u2514\u2500\u2551\u2554\u2557\u255a\u255d\u2560\u2563\u2566\u2569\u256c\u256d\u256e\u256f\u2570]/g," ");return T(e)}if(t.includes("\u{1f680} Crew:")||t.includes("\u{1f4cb} Task:")||t.includes("\u{1f916} Agent:")||t.includes("Assigned to:")||t.includes("Status:"))return z(t);const n=e=>{if((e=e.replace(/[\u2502\u251c\u2514\u2500\u2551\u2554\u2557\u255a\u255d\u2560\u2563\u2566\u2569\u256c\u256d\u256e\u256f\u2570]/g," ").replace(/\s{2,}/g," ")).match(/\[\d+(?:;\d+)*m/)||e.includes("[0m"))return E(e);if(e.includes("\u274c"))return(0,v.jsx)("span",{style:{color:"#ff5252",fontWeight:"bold"},children:e});if(e.includes("\u{1f680}"))return(0,v.jsx)("span",{style:{color:"#42a5f5",fontWeight:"bold"},children:e});if(e.includes("Agent:")){const t=e.match(/Agent:\s+(.+)$/);return t?(0,v.jsxs)(v.Fragment,{children:[(0,v.jsx)("span",{children:"Agent: "}),(0,v.jsx)("span",{style:{color:"#4caf50",fontWeight:"bold"},children:t[1]})]}):(0,v.jsx)("span",{style:{color:"#66bb6a",fontWeight:"bold"},children:e})}if(e.includes("Task:")){const t=e.match(/Task:\s+(.+)$/);return t?(0,v.jsxs)(v.Fragment,{children:[(0,v.jsx)("span",{children:"Task: "}),(0,v.jsx)("span",{style:{color:"#ffab40",fontWeight:"bold"},children:t[1]})]}):(0,v.jsx)("span",{style:{color:"#ffab40",fontWeight:"bold"},children:e})}if(e.includes("Status:")){const t=e.match(/Status:\s+(.+)$/);return t?(0,v.jsxs)(v.Fragment,{children:[(0,v.jsx)("span",{children:"Status: "}),(0,v.jsx)("span",{style:{color:"#ba68c8",fontWeight:"bold"},children:t[1]})]}):(0,v.jsx)("span",{style:{color:"#ba68c8",fontWeight:"bold"},children:e})}if(e.includes("Assigned to:")){const t=e.match(/Assigned to:\s+(.+)$/);if(t)return(0,v.jsxs)(v.Fragment,{children:[(0,v.jsx)("span",{children:"Assigned to: "}),(0,v.jsx)("span",{style:{color:"#4caf50",fontWeight:"bold"},children:t[1]})]})}return e.match(/HTTP Request:/)?(0,v.jsx)("span",{style:{color:"#7986cb"},children:e}):e.match(/^\d+\.\s+\*\*.+\*\*/)?(0,v.jsx)("span",{style:{color:"#81c784",fontWeight:"bold"},children:e}):(0,v.jsx)("span",{children:e})},o=t.split("\n");return(0,v.jsx)(v.Fragment,{children:o.map((e,t)=>(0,v.jsx)("div",{style:{lineHeight:"1.2"},children:n(e)},t))})},z=e=>{const t=(e=e.replace(/[\u2502\u251c\u2514\u2500\u2551\u2554\u2557\u255a\u255d\u2560\u2563\u2566\u2569\u256c\u256d\u256e\u256f\u2570]/g," ").replace(/\s{2,}/g," ")).split("\n").filter(e=>""!==e.trim());if(0===t.length)return null;const n=t.map((e,t)=>{const n={raw:e,type:"unknown",content:"",icon:"",label:"",value:"",isKeyValue:!1},o=e.trim().replace(/[\u2502\u251c\u2514\u2500\u2551\u2554\u2557\u255a\u255d\u2560\u2563\u2566\u2569\u256c\u256d\u256e\u256f\u2570]/g,"").replace(/^[([{|]+/,"").trim();if(o.startsWith("\u{1f680} Crew:"))n.type="crew",n.icon="\u{1f680}",n.content=o.replace("\u{1f680} Crew:","").trim();else if(o.startsWith("\u{1f4cb} Task:"))n.type="task",n.icon="\u{1f4cb}",n.content=o.replace("\u{1f4cb} Task:","").trim();else if(o.startsWith("\u{1f916} Agent:"))n.type="agent",n.icon="\u{1f916}",n.content=o.replace("\u{1f916} Agent:","").trim();else if(o.includes("Assigned to:")){n.type="assigned",n.isKeyValue=!0;const e=o.split("Assigned to:");n.label="Assigned to",n.value=e[1].trim()}else if(o.includes("Status:")){n.type="status",n.isKeyValue=!0;const e=o.split("Status:");n.label="Status",n.value=e[1].trim().replace(/[\u2502\u251c\u2514\u2500\u2551\u2554\u2557\u255a\u255d\u2560\u2563\u2566\u2569\u256c\u256d\u256e\u256f\u2570]/g,"").trim()}else n.type="text",n.content=o;return n});return(0,v.jsx)(i.A,{sx:{fontFamily:"monospace",my:.5,pl:1.5,pt:.5,pb:.25,borderLeft:"2px solid #42a5f5",backgroundColor:"rgba(66, 165, 245, 0.05)",borderRadius:"4px",fontSize:"0.85rem"},children:n.map((e,t)=>{switch(e.type){case"crew":return(0,v.jsxs)(i.A,{sx:{display:"flex",alignItems:"center",py:.25,color:"#42a5f5",fontWeight:"bold"},children:[(0,v.jsx)("span",{style:{marginRight:"4px"},children:e.icon}),(0,v.jsxs)("span",{children:["Crew: ",e.content]})]},t);case"task":return(0,v.jsxs)(i.A,{sx:{display:"flex",alignItems:"center",py:.25,color:"#ffab40",fontWeight:"bold"},children:[(0,v.jsx)("span",{style:{marginRight:"4px"},children:e.icon}),(0,v.jsxs)("span",{children:["Task: ",e.content]})]},t);case"agent":return(0,v.jsxs)(i.A,{sx:{display:"flex",alignItems:"center",py:.25,color:"#4caf50",fontWeight:"bold"},children:[(0,v.jsx)("span",{style:{marginRight:"4px"},children:e.icon}),(0,v.jsxs)("span",{children:["Agent: ",e.content]})]},t);case"assigned":return(0,v.jsxs)(i.A,{sx:{display:"flex",py:.25},children:[(0,v.jsx)("span",{style:{color:"#e0e0e0",minWidth:"100px"},children:"Assigned to:"}),(0,v.jsx)("span",{style:{color:"#4caf50",fontWeight:"bold",marginLeft:"4px"},children:e.value})]},t);case"status":{let n="#ba68c8";return e.value.includes("\u2705 Completed")?n="#66bb6a":e.value.includes("\u274c")?n="#ff5252":e.value.includes("Executing")&&(n="#ffab40"),(0,v.jsxs)(i.A,{sx:{display:"flex",py:.25},children:[(0,v.jsx)("span",{style:{color:"#e0e0e0",minWidth:"100px"},children:"Status:"}),(0,v.jsx)("span",{style:{color:n,fontWeight:"bold",marginLeft:"4px"},children:e.value})]},t)}default:return(0,v.jsx)(i.A,{sx:{py:.25,color:"#e0e0e0"},children:e.content},t)}})})},L=e=>e&&0!==e.length?e.map(e=>{const t=e.output||e.content||"",{content:n,type:o}=k(t);return(0,r.A)((0,r.A)({},e),{},{output:n,content:n,logType:o})}):[],D=e=>{if(e.length<=1)return e;const t=[];let n=0;for(;n<e.length;){const o=e[n],s=o.content||"";if(s.match(/^\d{2}:\d{2}:\d{2}\s+[AP]M$/))n++;else if("API"===o.logType&&s.includes("HTTP Request:")){let a=s,i=n+1;for(;i<e.length;){const t=e[i],n=t.content||"";if(n.match(/^\d{2}:\d{2}:\d{2}\s+[AP]M$/))i++;else{if("API"!==t.logType||!n.includes("HTTP Request:"))break;a+="\n"+n,i++}}t.push((0,r.A)((0,r.A)({},o),{},{content:a,output:a})),n=i}else t.push(o),n++}return t},I=e=>{let{open:t,onClose:n,logs:a,jobId:k,isConnecting:C,connectionError:E}=e;const[T,z]=(0,s.useState)(a),[I,O]=(0,s.useState)([]),[F,W]=(0,s.useState)(!1),[N,H]=(0,s.useState)(0),[M,P]=(0,s.useState)(!0),[B,U]=(0,s.useState)(!1),[J,Y]=(0,s.useState)(!0),V=(0,s.useRef)(null),K=1e3,{t:q}=(0,A.Bd)(),G=e=>e.filter(e=>{const t=e.output||e.content;if(!t)return!1;return t.trim().length>0});(0,s.useEffect)(()=>{const e=[...a].sort((e,t)=>new Date(e.timestamp).getTime()-new Date(t.timestamp).getTime()),t=G(e);z(t);const n=L(t),o=D(n);O(o)},[a]),(0,s.useEffect)(()=>{J&&V.current&&(V.current.scrollTop=V.current.scrollHeight)},[I,J]);return(0,v.jsxs)(c.A,{open:t,onClose:n,maxWidth:"lg",fullWidth:!0,PaperProps:{sx:{height:"80vh"}},children:[(0,v.jsx)(d.A,{children:(0,v.jsxs)(i.A,{display:"flex",justifyContent:"space-between",alignItems:"center",children:[(0,v.jsx)(u.A,{children:q("logs.executionLogs.title")}),(0,v.jsxs)(i.A,{children:[(0,v.jsx)(p.A,{title:q(J?"logs.executionLogs.autoScrollOn":"logs.executionLogs.autoScrollOff"),children:(0,v.jsx)(u.A,{variant:"caption",sx:{mr:2,color:J?"success.main":"text.secondary"},children:q(J?"logs.executionLogs.autoScrollOn":"logs.executionLogs.autoScrollOff")})}),(0,v.jsx)(p.A,{title:q("logs.executionLogs.refreshLogs"),children:(0,v.jsx)(h.A,{onClick:async()=>{try{U(!0);const e=await j.m.getHistoricalLogs(k,K,0),t=G(e.map(e=>{let{job_id:t,execution_id:n}=e,s=(0,o.A)(e,S);return(0,r.A)((0,r.A)({},s),{},{output:s.output||s.content})}).sort((e,t)=>new Date(e.timestamp).getTime()-new Date(t.timestamp).getTime())),n=new Set(T.map(e=>e.id));if(t.some(e=>!n.has(e.id))||t.length!==T.length){z(t);const e=L(t),n=D(e);O(n),H(0),P(!0),Y(!0)}}catch(e){}finally{U(!1)}},disabled:B,children:(0,v.jsx)(b.A,{})})})]})]})}),(0,v.jsxs)(m.A,{children:[C&&(0,v.jsxs)(i.A,{display:"flex",justifyContent:"center",mb:2,children:[(0,v.jsx)(g.A,{size:20}),(0,v.jsx)(u.A,{variant:"body2",ml:1,children:q("logs.executionLogs.connecting")})]}),E&&(0,v.jsx)(x.A,{severity:"error",sx:{mb:2},children:q("logs.executionLogs.connectionError")}),F&&(0,v.jsx)(i.A,{display:"flex",justifyContent:"center",mt:2,children:(0,v.jsx)(g.A,{size:20})}),(0,v.jsx)(i.A,{ref:V,onScroll:()=>{if(!V.current)return;const{scrollTop:e,scrollHeight:t,clientHeight:n}=V.current;Y(t-e-n<50),e<50&&!F&&M&&(async()=>{if(!F&&M)try{W(!0);const e=N+K,t=await j.m.getHistoricalLogs(k,K,e);if(0===t.length)P(!1);else{const n=G(t.map(e=>{let{job_id:t,execution_id:n}=e,s=(0,o.A)(e,w);return(0,r.A)((0,r.A)({},s),{},{output:s.output||s.content})}).sort((e,t)=>new Date(e.timestamp).getTime()-new Date(t.timestamp).getTime())),s=[...T,...n];z(s);const a=L(s),i=D(a);O(i),H(e)}}catch(e){}finally{W(!1)}})()},sx:{height:"calc(100% - 20px)",overflowY:"auto",bgcolor:"#21252b",p:2,borderRadius:1,fontFamily:"monospace",fontSize:"0.875rem",whiteSpace:"pre-wrap",wordBreak:"break-word"},children:(()=>{let e=null;return I.map((t,n)=>{const o=t.output||t.content||"",r=t.logType||"INFO",s=((e,t)=>"INFO"!==e&&(null===t||e!==t))(r,e);return e=r,(0,v.jsxs)(i.A,{sx:{mb:.5,py:.25,px:.5,borderRadius:"4px",backgroundColor:"ERROR"===r?"rgba(255,82,82,0.1)":"transparent",borderLeft:"3px solid ".concat(_(r)),"&:hover":{bgcolor:"rgba(255,255,255,0.05)"}},children:[s&&(0,v.jsx)(l.A,{label:r,size:"small",sx:{height:"16px",fontSize:"0.7rem",backgroundColor:_(r),color:"#000","& .MuiChip-label":{px:.75},mb:.25}}),(0,v.jsx)(i.A,{sx:{color:"INFO"===r?"#e0e0e0":"ERROR"===r?"#ff8a80":"STDOUT"===r?"#b9f6ca":"API"===r?"#c5cae9":"EVENT"===r?"#e1bee7":"#e1f5fe",fontFamily:"monospace",fontSize:"0.85rem",mt:s?.25:0,lineHeight:"1.2"},children:R(o)})]},"".concat(t.timestamp,"-").concat(n))})})()})]}),(0,v.jsx)(f.A,{children:(0,v.jsx)(y.A,{onClick:n,children:q("common.close")})})]})}},50477:()=>{},61031:(e,t,n)=>{"use strict";n.r(t),n.d(t,{useTaskExecutionStore:()=>s});var o=n(19458),r=n(27887);const s=(0,o.vt)((e,t)=>({taskStates:new Map,seenTasks:new Set,setTaskState:(t,n)=>{e(e=>{const o=new Map(e.taskStates);return o.set(t,n),{taskStates:o}})},hasSeenTask:e=>t().seenTasks.has(e),markTaskSeen:t=>{e(e=>{const n=new Set(e.seenTasks);return n.add(t),{seenTasks:n}})},loadTaskStates:async t=>{try{const n=await r.uE.get("/traces/job/".concat(t,"/task-states"));e(e=>{const t=new Map(e.taskStates);return Object.entries(n.data).forEach(e=>{let[n,o]=e,r=n;r.startsWith("task_")&&(r=r.substring(5)),r.startsWith("task-")&&(r=r.substring(5)),t.set(r,o)}),{taskStates:t}})}catch(n){}},clearTaskStates:()=>{e({taskStates:new Map,seenTasks:new Set})},isTaskRunning:e=>{const n=t().taskStates.get(e);return"running"===(null===n||void 0===n?void 0:n.status)},getTaskStatus:e=>t().taskStates.get(e)}))},69893:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>gt});var o=n(89379),r=n(80045),s=n(9950),a=n(25277),i=n(46639),l=n(16491),c=n(48089),d=n(50704),u=n(1320),p=n(15769),h=n(69780),m=n(9213),g=n(21671),x=n(34075),f=n(65429),y=n(83274),b=n(25333),j=n(72362),A=n(8145),v=n(2046),w=n(4753),S=n(57988),k=n(19223),_=n(51069),C=n(90037),E=n(86456),T=n(78287),R=n(62375),z=n(91602),L=n(38924),D=n(75737),I=n(36060),O=n(63464),F=n(92649),W=n(82053),N=n(74763),H=n(28170),M=n(2235),P=n(33738),B=n(79739),U=n(18216),J=n(96319),Y=n(18726),V=n(13246),K=n(4983),q=n(34593),G=n(69935),$=n(40155),Q=n(4804),Z=n(9030),X=n(19458),ee=n(11758);const te={useNewExecutionUI:!0},ne=(0,X.vt)()((0,ee.Zr)(e=>(0,o.A)((0,o.A)({},te),{},{setUseNewExecutionUI:t=>e({useNewExecutionUI:t}),resetPreferences:()=>e(te)}),{name:"user-preferences"}));var oe=n(67818),re=n(43833),se=n(24397),ae=n(27575),ie=n(35987),le=n(52180),ce=n(44414);const de=e=>{var t,n;let{open:o,onClose:r,runId:c,run:d,onViewResult:u,onShowLogs:p}=e;const{t:h}=(0,oe.Bd)(),{useNewExecutionUI:m}=ne(),{showRunResult:g}=(0,ae.K)(),[x,f]=(0,s.useState)([]),[j,A]=(0,s.useState)(null),[v,w]=(0,s.useState)(!0),[S,k]=(0,s.useState)(null),[_,C]=(0,s.useState)(new Set),[E,R]=(0,s.useState)(new Set),[z,D]=(0,s.useState)(null),[I,X]=(0,s.useState)(!1),[ee,te]=(0,s.useState)([]),[de,ue]=(0,s.useState)(!1),[pe,he]=(0,s.useState)(null),[me,ge]=(0,s.useState)(!1),xe=(0,s.useCallback)(e=>{const t=[...e.filter(e=>"Task Orchestrator"!==e.event_source&&"task_management"!==e.event_context)].sort((e,t)=>new Date(e.created_at).getTime()-new Date(t.created_at).getTime());if(0===t.length)return{agents:[],globalEvents:{start:[],end:[]}};const n=new Date(t[0].created_at),o=new Date(t[t.length-1].created_at),r=o.getTime()-n.getTime(),s={start:t.filter(e=>"crew"===e.event_source&&("crew_started"===e.event_type||"execution_started"===e.event_type)),end:t.filter(e=>"crew"===e.event_source&&("crew_completed"===e.event_type||"execution_completed"===e.event_type))},a=new Map,i=new Map,l=new Map;let c=null;t.forEach(e=>{if("task"===e.event_source&&"task_completed"===e.event_type&&e.event_context&&(i.set(e.event_context,e.event_context),c=e.event_context),e.event_source&&"crew"!==e.event_source&&"task"!==e.event_source&&"Unknown Agent"!==e.event_source&&c&&l.set(c,e.event_source),"agent_execution"===e.event_type&&e.extra_data&&"object"===typeof e.extra_data){const t=e.extra_data.agent_role;t&&"UnknownAgent-str"!==t&&"Unknown Agent"!==t&&c&&l.set(c,t)}}),t.forEach(e=>{if("crew"===e.event_source||"task"===e.event_source||"Task Orchestrator"===e.event_source||"task_management"===e.event_context)return;let t=e.event_source||"Unknown Agent";if("llm_call"===e.event_type&&e.extra_data&&"object"===typeof e.extra_data){const n=e.extra_data.agent_role;n&&"UnknownAgent-str"!==n&&"Unknown Agent"!==n&&(t=n)}if(("Unknown Agent"===t||t.startsWith("Unknown"))&&c){const e=l.get(c);e&&(t=e)}a.has(t)||a.set(t,[]);const n=a.get(t);n&&n.push(e)});const d=[];return a.forEach((e,n)=>{if(0===e.length)return;const o=new Date(e[0].created_at),r=new Date(e[e.length-1].created_at),s=new Map;let a=null,c=0;e.forEach(e=>{if("task_started"===e.event_type){let t=null;if(e.trace_metadata){const n=e.trace_metadata.task_name;n&&(t=n)}if(!t&&e.extra_data){const n=e.extra_data.task_name;n&&(t=n)}if(t){let e=t;s.has(t)&&(c++,e="".concat(t," (").concat(c,")")),a=e}}if(!a){const o=new Date(e.created_at).getTime(),r=Array.from(i.entries());for(const[e,s]of r){const r=t.find(t=>"task"===t.event_source&&"task_completed"===t.event_type&&t.event_context===e);if(r){if(o<=new Date(r.created_at).getTime()+1e3){const t=l.get(e);if(!t||t===n){a=s;break}}}}}a||(a="Processing Task"),s.has(a)||s.set(a,[]);const o=s.get(a);o&&o.push(e)});const u=Array.from(s.entries()).map(e=>{let[t,n]=e;const o=new Date(n[0].created_at),r=new Date(n[n.length-1].created_at),s=n.map((e,t)=>{const o=new Date(e.created_at),r=n[t+1],s=r?new Date(r.created_at).getTime()-o.getTime():void 0;let a="info",i="";if("llm_call"===e.event_type){a="llm";let t="",n="";if(e.extra_data&&"object"===typeof e.extra_data){const o=e.extra_data;t=o.agent_role||"",n=o.model||""}if(i=t&&"Unknown Agent"!==t?"LLM call (".concat(t,")"):"LLM call",n){const e=n.split("/"),t=e[e.length-1];i+=" - ".concat(t)}}else if("tool_usage"===e.event_type){a="tool";i=e.event_context||"Tool"}else if("agent_execution"===e.event_type||"agent_step"===e.event_type){let t="";e.output&&("string"===typeof e.output?t=e.output:"object"===typeof e.output&&"content"in e.output&&(t=String(e.output.content||"")));const n=t;let o="";if(e.extra_data&&"object"===typeof e.extra_data){o=e.extra_data.step_type||""}if(n.includes("Tool:")){const e=n.match(/Tool: ([^|]+)/);a="tool",i=e?e[1].trim():"Tool Usage"}else n.includes("ToolResult")?(a="tool_result",i="Tool Result"):n.toLowerCase().includes("llm")?(a="llm",i="LLM call"):"AgentFinish"===o?(a="agent_complete",i="Final Answer"):"AgentStart"===o?(a="agent_start",i="Task Started"):n&&n.length>100?(a="agent_output",i="Task Output"):(a="agent_processing",i="Processing")}else if("task_started"===e.event_type){a="task_start";let t="Task Started";if(e.trace_metadata&&"object"===typeof e.trace_metadata){const n=e.trace_metadata.task_name;n&&(t=n.length>50?n.substring(0,47)+"...":n)}else if(e.extra_data&&"object"===typeof e.extra_data){const n=e.extra_data.task_name;n&&(t=n.length>50?n.substring(0,47)+"...":n)}i="Starting: ".concat(t)}else if("task_completed"===e.event_type){a="task_complete";let t="Task Completed";if(e.trace_metadata&&"object"===typeof e.trace_metadata){const n=e.trace_metadata.task_name;n&&(t=n.length>50?n.substring(0,47)+"...":n)}else if(e.extra_data&&"object"===typeof e.extra_data){const n=e.extra_data.task_name;n&&(t=n.length>50?n.substring(0,47)+"...":n)}i="Completed: ".concat(t)}else if("memory_operation"===e.event_type)a="memory_operation",i=e.event_context?e.event_context.includes("query")?"Memory Query":e.event_context.includes("sav")?"Memory Save":"Memory Operation":"Memory Operation";else if("knowledge_operation"===e.event_type)a="knowledge_operation",i="Knowledge Operation";else if("agent_reasoning"===e.event_type||"agent_reasoning_error"===e.event_type)a="reasoning","agent_reasoning_error"===e.event_type?i="Reasoning Failed":(i="Agent Reasoning",e.output&&"string"===typeof e.output&&e.output.includes("plan")&&(i="Agent Planning"));else if("llm_guardrail"===e.event_type){if(a="guardrail",i="LLM Guardrail Check",e.extra_data&&"object"===typeof e.extra_data){const t=e.extra_data;!0===t.success?i="Guardrail Passed":!1===t.success&&(i="Guardrail Failed")}}else{a=e.event_type;i=e.event_type.replace(/_/g," ").replace(/\b\w/g,e=>e.toUpperCase())}let l=e.output;if(e.output&&"object"===typeof e.output&&"content"in e.output){const t=e.output.content;("string"===typeof t||"object"===typeof t&&null!==t)&&(l=t)}return{type:a,description:i,timestamp:o,duration:s,output:l}});return{taskName:t,taskId:n[0].task_id,startTime:o,endTime:r,duration:r.getTime()-o.getTime(),events:s}});d.push({agent:n,startTime:o,endTime:r,duration:r.getTime()-o.getTime(),tasks:u})}),{globalStart:n,globalEnd:o,totalDuration:r,agents:d,globalEvents:s}},[]),fe=(0,s.useCallback)(async function(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];if(c)try{e?w(!0):ge(!0);if(!await Z.A.checkRunExists(c))return k("Run ID ".concat(c," does not exist or is no longer available.")),w(!1),void ge(!1);const t=await Z.A.getRunDetails(c),n=t.job_id&&t.job_id.includes("-")?t.job_id:c,o=await Z.A.getTraces(n);if(o&&Array.isArray(o)&&0!==o.length){f(o);const t=xe(o);A(t),C(e?new Set(t.agents.map((e,t)=>t)):e=>e),k(null)}else k("No trace data is available for this run."),f([])}catch(t){const e=t instanceof Error?t.message:"Unknown error";k("Failed to load traces: ".concat(e)),f([])}finally{w(!1),ge(!1)}},[c,xe]);(0,s.useEffect)(()=>{o&&fe(!0)},[o,fe]),(0,s.useEffect)(()=>{j&&me&&R(e=>{const t=new Set(e);return _.forEach(e=>{j.agents[e]&&j.agents[e].tasks.forEach((n,o)=>{const r="".concat(e,"-").concat(o);t.add(r)})}),t})},[j,_,me]),(0,s.useEffect)(()=>{if(!o)return;if((null===d||void 0===d?void 0:d.status)&&["completed","failed","cancelled","stopped","error"].includes(d.status.toLowerCase()))return;const e=setInterval(()=>{fe(!1)},5e3);return()=>{clearInterval(e)}},[o,null===d||void 0===d?void 0:d.status,fe]);const ye=e=>{if(e<1e3)return"".concat(e,"ms");const t=e/1e3;if(t<60)return"".concat(t.toFixed(1),"s");return"".concat((t/60).toFixed(1),"m")},be=(e,t)=>{const n=t.getTime()-e.getTime();return"+".concat(ye(n))},je=e=>{switch(e){case"tool":case"tool_result":case"tool_usage":return"\u{1f527}";case"llm":return"\u{1f916}";case"agent_start":case"task_start":case"started":return"\u25b6\ufe0f";case"agent_complete":case"task_complete":case"completed":return"\u2705";case"agent_output":case"agent_execution":return"\u{1f4dd}";case"agent_processing":return"\u2699\ufe0f";case"memory_operation":return"\u{1f4be}";case"knowledge_operation":return"\u{1f4da}";case"crew_started":return"\u{1f680}";case"crew_completed":return"\u{1f3c1}";default:return"\u2022"}},Ae=e=>{if(!e)return"No output available";if("string"===typeof e){if(e.includes("ToolResult")){const n=e.match(/result="([^"]+)"/);if(n)try{const e=JSON.parse(n[1].replace(/'/g,'"'));return JSON.stringify(e,null,2)}catch(t){return e}}return e}return JSON.stringify(e,null,2)};return o?(0,ce.jsxs)(ce.Fragment,{children:[(0,ce.jsxs)(O.A,{open:o,onClose:r,maxWidth:"lg",fullWidth:!0,PaperProps:{sx:{minHeight:"80vh",maxHeight:"90vh"}},children:[(0,ce.jsx)(F.A,{sx:{m:0,p:2},children:(0,ce.jsxs)(l.A,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,ce.jsxs)(l.A,{sx:{display:"flex",alignItems:"center",gap:1},children:[(0,ce.jsx)(W.A,{variant:"h6",children:"Execution Trace Timeline"}),me&&(0,ce.jsx)(y.A,{title:"Refreshing...",children:(0,ce.jsx)(Q.A,{sx:{fontSize:20,color:"primary.main",animation:"spin 1s linear infinite","@keyframes spin":{"0%":{transform:"rotate(0deg)"},"100%":{transform:"rotate(360deg)"}}}})}),(0,ce.jsx)(y.A,{title:null!==d&&void 0!==d&&d.status&&["completed","failed","cancelled","stopped","error"].includes(d.status.toLowerCase())?"Refresh now (auto-refresh disabled - execution completed)":"Refresh now (auto-refreshes every 5s)",children:(0,ce.jsx)(b.A,{size:"small",onClick:()=>fe(!1),disabled:me||v,sx:{ml:.5},children:(0,ce.jsx)(Q.A,{fontSize:"small"})})})]}),(0,ce.jsxs)(l.A,{sx:{display:"flex",gap:1,alignItems:"center"},children:[m&&d&&(0,ce.jsxs)(ce.Fragment,{children:[(0,ce.jsx)(y.A,{title:h("runHistory.actions.viewResult"),children:(0,ce.jsx)("span",{children:(0,ce.jsx)(b.A,{size:"small",onClick:()=>{u&&d&&g(d)},color:"primary",disabled:["running","pending","queued","in_progress"].includes((null===d||void 0===d||null===(t=d.status)||void 0===t?void 0:t.toLowerCase())||""),children:(0,ce.jsx)(T.A,{fontSize:"small"})})})}),(0,ce.jsx)(y.A,{title:h("runHistory.actions.viewLogs"),children:(0,ce.jsx)("span",{children:(0,ce.jsx)(b.A,{size:"small",onClick:async()=>{if(d){X(!0),ue(!0),he(null);try{const e=(await se.m.getHistoricalLogs(d.job_id)).map(e=>({id:e.id,output:e.output,content:e.content,timestamp:e.timestamp,logType:e.type}));te(e)}catch(S){he("Failed to fetch logs")}finally{ue(!1)}}},color:"primary",disabled:["running","pending","queued","in_progress"].includes((null===d||void 0===d||null===(n=d.status)||void 0===n?void 0:n.toLowerCase())||""),children:(0,ce.jsx)($.A,{fontSize:"small"})})})}),(0,ce.jsx)(N.A,{orientation:"vertical",flexItem:!0,sx:{mx:1}})]}),(0,ce.jsx)(b.A,{"aria-label":"close",onClick:r,sx:{color:e=>e.palette.grey[500]},children:(0,ce.jsx)(J.A,{})})]})]})}),(0,ce.jsx)(H.A,{dividers:!0,sx:{p:0},children:v?(0,ce.jsx)(l.A,{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"400px",children:(0,ce.jsx)(i.A,{})}):S?(0,ce.jsx)(l.A,{sx:{p:3,textAlign:"center"},children:(0,ce.jsx)(W.A,{color:"error",children:S})}):j&&j.agents.length>0?(0,ce.jsxs)(l.A,{sx:{p:2},children:[j.globalEvents.start.map((e,t)=>(0,ce.jsxs)(l.A,{sx:{mb:2,display:"flex",alignItems:"center",gap:1},children:[(0,ce.jsx)(q.A,{color:"primary"}),(0,ce.jsx)(W.A,{variant:"body2",color:"text.secondary",children:e.event_type.replace(/_/g," ").toUpperCase()}),(0,ce.jsx)(W.A,{variant:"caption",color:"text.secondary",children:new Date(e.created_at).toLocaleTimeString()})]},t)),j.agents.map((e,t)=>(0,ce.jsxs)(M.A,{sx:{mb:2,overflow:"hidden"},children:[(0,ce.jsxs)(l.A,{sx:{p:2,bgcolor:"grey.100",display:"flex",alignItems:"center",justifyContent:"space-between",cursor:"pointer","&:hover":{bgcolor:"grey.200"}},onClick:()=>(e=>{const t=new Set(_);t.has(e)?t.delete(e):t.add(e),C(t)})(t),children:[(0,ce.jsxs)(l.A,{sx:{display:"flex",alignItems:"center",gap:2},children:[(0,ce.jsx)(b.A,{size:"small",children:_.has(t)?(0,ce.jsx)(V.A,{}):(0,ce.jsx)(Y.A,{})}),(0,ce.jsx)(W.A,{variant:"subtitle1",fontWeight:"bold",children:e.agent}),(0,ce.jsx)(a.A,{size:"small",label:ye(e.duration),icon:(0,ce.jsx)(L.A,{})}),j.globalStart&&(0,ce.jsxs)(W.A,{variant:"caption",color:"text.secondary",children:["(",be(j.globalStart,e.endTime),")"]})]}),(0,ce.jsxs)(W.A,{variant:"body2",color:"text.secondary",children:[e.tasks.length," task",1!==e.tasks.length?"s":""]})]}),(0,ce.jsx)(P.A,{in:_.has(t),children:(0,ce.jsx)(l.A,{sx:{pl:6,pr:2,py:1},children:e.tasks.map((e,n)=>{const o="".concat(t,"-").concat(n);return(0,ce.jsxs)(l.A,{sx:{mb:2},children:[(0,ce.jsxs)(l.A,{sx:{display:"flex",alignItems:"center",gap:1,p:1,bgcolor:"grey.50",borderRadius:1,cursor:"pointer","&:hover":{bgcolor:"grey.100"}},onClick:()=>(e=>{const t=new Set(E);t.has(e)?t.delete(e):t.add(e),R(t)})(o),children:[(0,ce.jsx)(b.A,{size:"small",children:E.has(o)?(0,ce.jsx)(V.A,{}):(0,ce.jsx)(Y.A,{})}),(0,ce.jsx)(W.A,{variant:"body2",fontWeight:"medium",children:e.taskName}),(0,ce.jsx)(a.A,{size:"small",label:ye(e.duration),variant:"outlined"})]}),(0,ce.jsx)(P.A,{in:E.has(o),children:(0,ce.jsx)(l.A,{sx:{pl:4,mt:1},children:e.events.map((e,t)=>{const n=!!e.output&&("llm"===e.type||"agent_complete"===e.type||"agent_output"===e.type||"tool_result"===e.type||"task_complete"===e.type||"memory_operation"===e.type||"tool_usage"===e.type||"knowledge_operation"===e.type||"agent_execution"===e.type||e.type.includes("memory")||e.type.includes("tool")||e.type.includes("knowledge"));return(0,ce.jsxs)(l.A,{sx:{display:"flex",alignItems:"center",gap:1,py:.5,borderLeft:"2px solid",borderColor:"grey.300",pl:2,ml:1,position:"relative",cursor:n?"pointer":"default","&:hover":{bgcolor:n?"action.hover":"transparent","& .output-hint":{opacity:1},"& .click-hint":{visibility:"visible"}}},onClick:()=>n&&(e=>{D(e)})(e),children:[(0,ce.jsx)(W.A,{variant:"caption",sx:{minWidth:60},children:j.globalStart&&be(j.globalStart,e.timestamp)}),(0,ce.jsx)(W.A,{variant:"body2",sx:{minWidth:20},children:je(e.type)}),(0,ce.jsx)(W.A,{variant:"body2",sx:{flex:1,color:n?"primary.main":"text.primary",textDecoration:n?"underline dotted":"none",textUnderlineOffset:"3px"},children:e.description}),e.duration&&(0,ce.jsx)(a.A,{size:"small",label:ye(e.duration),sx:{height:20}}),n&&(0,ce.jsxs)(ce.Fragment,{children:[(0,ce.jsx)(a.A,{className:"output-hint",size:"small",label:"View",sx:{height:18,fontSize:"0.65rem",bgcolor:"primary.main",color:"white",opacity:.7,transition:"opacity 0.2s","& .MuiChip-label":{px:.5}}}),(0,ce.jsx)(W.A,{className:"click-hint",variant:"caption",sx:{position:"absolute",right:-10,top:"50%",transform:"translateY(-50%)",bgcolor:"grey.900",color:"white",px:1,py:.5,borderRadius:1,fontSize:"0.7rem",visibility:"hidden",zIndex:1e3,whiteSpace:"nowrap","&::before":{content:'""',position:"absolute",left:-4,top:"50%",transform:"translateY(-50%)",width:0,height:0,borderTop:"4px solid transparent",borderBottom:"4px solid transparent",borderRight:"4px solid",borderRightColor:"grey.900"}},children:"Click to view output"})]})]},t)})})})]},n)})})})]},t)),j.globalEvents.end.map((e,t)=>(0,ce.jsxs)(l.A,{sx:{mt:2,display:"flex",alignItems:"center",gap:1},children:[(0,ce.jsx)(K.A,{color:"success"}),(0,ce.jsx)(W.A,{variant:"body2",color:"text.secondary",children:e.event_type.replace(/_/g," ").toUpperCase()}),(0,ce.jsx)(W.A,{variant:"caption",color:"text.secondary",children:new Date(e.created_at).toLocaleTimeString()}),j.totalDuration&&(0,ce.jsx)(a.A,{size:"small",label:"Total: ".concat(ye(j.totalDuration)),color:"primary"})]},t))]}):(0,ce.jsx)(l.A,{sx:{p:3,textAlign:"center"},children:(0,ce.jsx)(W.A,{children:"No trace data available"})})}),(0,ce.jsx)(O.A,{open:!!z,onClose:()=>D(null),maxWidth:"md",fullWidth:!0,children:z&&(0,ce.jsxs)(ce.Fragment,{children:[(0,ce.jsxs)(F.A,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,ce.jsxs)(l.A,{children:[(0,ce.jsx)(W.A,{variant:"h6",children:z.description}),(0,ce.jsxs)(W.A,{variant:"caption",color:"text.secondary",children:["Event Type: ",z.type]})]}),(0,ce.jsx)(b.A,{onClick:()=>D(null),size:"small",children:(0,ce.jsx)(J.A,{})})]}),(0,ce.jsx)(H.A,{dividers:!0,children:(0,ce.jsxs)(l.A,{sx:{position:"relative"},children:["memory_operation"===z.type||z.type.includes("memory")?(0,ce.jsxs)(l.A,{children:[(0,ce.jsx)(W.A,{variant:"subtitle2",gutterBottom:!0,children:"Memory Operation Details"}),"object"===typeof z.output&&z.output&&(0,ce.jsxs)(l.A,{sx:{mb:2},children:["operation"in z.output&&(0,ce.jsx)(a.A,{label:"Operation: ".concat(z.output.operation),sx:{mr:1,mb:1},size:"small",color:"primary"}),"memory_type"in z.output&&(0,ce.jsx)(a.A,{label:"Type: ".concat(z.output.memory_type),sx:{mr:1,mb:1},size:"small",color:"secondary"})]})]}):null,"tool_usage"===z.type||"tool_result"===z.type?(0,ce.jsxs)(l.A,{children:[(0,ce.jsx)(W.A,{variant:"subtitle2",gutterBottom:!0,children:"Tool Usage Details"}),"object"===typeof z.output&&z.output&&(0,ce.jsx)(l.A,{sx:{mb:2},children:"tool_name"in z.output&&(0,ce.jsx)(a.A,{label:"Tool: ".concat(z.output.tool_name),sx:{mr:1,mb:1},size:"small",color:"info"})})]}):null,(0,ce.jsx)(M.A,{sx:{p:2,mt:1,backgroundColor:e=>"dark"===e.palette.mode?"grey.900":"grey.50",maxHeight:"60vh",overflow:"auto","& pre":{overflowX:"auto",padding:1,borderRadius:1,backgroundColor:e=>"dark"===e.palette.mode?"grey.800":"grey.100",fontFamily:"monospace",fontSize:"0.875rem"},"& code":{fontFamily:"monospace",fontSize:"0.875rem",backgroundColor:e=>"dark"===e.palette.mode?"grey.800":"grey.200",padding:"2px 4px",borderRadius:"3px"},"& p":{marginTop:1,marginBottom:1},"& ul, & ol":{paddingLeft:3,marginTop:1,marginBottom:1},"& li":{marginTop:.5,marginBottom:.5},"& blockquote":{borderLeft:"4px solid",borderColor:"primary.main",paddingLeft:2,marginLeft:0,marginTop:1,marginBottom:1,fontStyle:"italic",color:"text.secondary"},"& h1, & h2, & h3, & h4, & h5, & h6":{marginTop:2,marginBottom:1,fontWeight:"bold"},"& h1":{fontSize:"1.5rem"},"& h2":{fontSize:"1.3rem"},"& h3":{fontSize:"1.1rem"},"& h4":{fontSize:"1rem"},"& h5":{fontSize:"0.9rem"},"& h6":{fontSize:"0.85rem"},"& table":{width:"100%",borderCollapse:"collapse",marginTop:1,marginBottom:1},"& th, & td":{border:"1px solid",borderColor:"divider",padding:1,textAlign:"left"},"& th":{backgroundColor:e=>"dark"===e.palette.mode?"grey.800":"grey.200",fontWeight:"bold"},"& hr":{marginTop:2,marginBottom:2,border:"none",borderTop:"1px solid",borderColor:"divider"},"& a":{color:"primary.main",textDecoration:"none","&:hover":{textDecoration:"underline"}}},children:(0,ce.jsx)(ie.oz,{remarkPlugins:[le.A],children:Ae(z.output)})})]})}),(0,ce.jsxs)(B.A,{children:[(0,ce.jsx)(U.A,{onClick:()=>{navigator.clipboard.writeText(Ae(z.output))},startIcon:(0,ce.jsx)(G.A,{}),size:"small",children:"Copy Output"}),(0,ce.jsx)(U.A,{onClick:()=>D(null),size:"small",children:"Close"})]})]})})]}),m&&d&&I&&(0,ce.jsx)(re.A,{open:I,onClose:()=>X(!1),logs:ee,jobId:d.job_id,isConnecting:de,connectionError:pe})]}):null};var ue=n(14857),pe=n(36080),he=n(40038),me=n(39919),ge=n(8808),xe=n(87899),fe=n(7626),ye=n(19221),be=n(16702),je=n(2334),Ae=n(18655),ve=n(36314),we=n(60783),Se=n(87078);Se.KQ.register({family:"Inter",fonts:[{src:"https://fonts.gstatic.com/s/inter/v12/UcCO3FwrK3iLTeHuS_fvQtMwCp50KnMw2boKoduKmMEVuLyfAZ9hjp-Ek-_EeA.woff"},{src:"https://fonts.gstatic.com/s/inter/v12/UcCO3FwrK3iLTeHuS_fvQtMwCp50KnMw2boKoduKmMEVuGKYAZ9hjp-Ek-_EeA.woff",fontWeight:600},{src:"https://fonts.gstatic.com/s/inter/v12/UcCO3FwrK3iLTeHuS_fvQtMwCp50KnMw2boKoduKmMEVuFuYAZ9hjp-Ek-_EeA.woff",fontWeight:700}]}),Se.KQ.register({family:"JetBrainsMono",src:"https://fonts.gstatic.com/s/jetbrainsmono/v13/tDbY2o-flEEny0FZhsfKu5WU4zr3E_BX0PnT8RD8yKxjPVmUsaaDhw.ttf"});const ke=Se.vv.create({page:{padding:50,backgroundColor:"#ffffff",fontFamily:"Inter"},header:{backgroundColor:"#f8fafb",borderLeft:4,borderLeftColor:"#3b82f6",padding:25,marginBottom:30,borderRadius:8},headerTop:{flexDirection:"row",justifyContent:"space-between",alignItems:"center",marginBottom:15},logo:{width:40,height:40},title:{fontSize:28,marginBottom:12,color:"#111827",fontFamily:"Inter",fontWeight:700,letterSpacing:-.5},subtitle:{fontSize:14,marginBottom:6,color:"#6b7280",fontFamily:"Inter",fontWeight:400},statusBadge:{flexDirection:"row",alignItems:"center",backgroundColor:"#10b981",paddingHorizontal:12,paddingVertical:4,borderRadius:12,alignSelf:"flex-start"},statusText:{color:"#ffffff",fontSize:11,fontWeight:600,fontFamily:"Inter"},text:{fontSize:11,marginBottom:12,color:"#374151",fontFamily:"Inter",lineHeight:1.7},section:{marginBottom:25,paddingBottom:20,borderBottom:1,borderBottomColor:"#e5e7eb"},sectionTitle:{fontSize:16,marginBottom:12,color:"#111827",fontFamily:"Inter",fontWeight:600,borderLeft:3,borderLeftColor:"#3b82f6",paddingLeft:12},codeBlock:{backgroundColor:"#1e293b",color:"#e2e8f0",padding:15,borderRadius:6,marginBottom:12,fontFamily:"JetBrainsMono",fontSize:9,lineHeight:1.6},inlineCode:{backgroundColor:"#f3f4f6",color:"#dc2626",paddingHorizontal:4,paddingVertical:1,borderRadius:3,fontFamily:"JetBrainsMono",fontSize:10},list:{marginLeft:24,marginBottom:12},listItem:{fontSize:11,marginBottom:6,color:"#374151",fontFamily:"Inter",flexDirection:"row"},listBullet:{width:20,fontSize:11,color:"#3b82f6"},link:{color:"#2563eb",textDecoration:"underline"},strong:{fontWeight:600,color:"#111827"},emphasis:{fontStyle:"italic",color:"#4b5563"},blockquote:{borderLeft:3,borderLeftColor:"#d1d5db",paddingLeft:15,marginLeft:0,marginBottom:12,fontStyle:"italic",color:"#6b7280"},table:{marginBottom:15},tableRow:{flexDirection:"row",borderBottom:1,borderBottomColor:"#e5e7eb"},tableHeader:{backgroundColor:"#f9fafb",paddingVertical:8,paddingHorizontal:10,fontWeight:600,fontSize:10,color:"#111827"},tableCell:{paddingVertical:8,paddingHorizontal:10,fontSize:10,color:"#374151"},footer:{position:"absolute",bottom:30,left:50,right:50,paddingTop:15,borderTop:1,borderTopColor:"#e5e7eb",flexDirection:"row",justifyContent:"space-between"},footerText:{fontSize:9,color:"#9ca3af",fontFamily:"Inter"},pageNumber:{fontSize:9,color:"#9ca3af",fontFamily:"Inter"}}),_e=e=>{const t=e.split("\n"),n=[];let r=[];const s=()=>{if(r.length>0){const e=r.join(" ").trim();e&&n.push((0,ce.jsx)(Se.EY,{style:ke.text,children:Ce(e)},n.length)),r=[]}};let a=0;for(;a<t.length;){const e=t[a],i=e.trim();if(i){if(i.startsWith("#")){s();const e=i.replace(/^#+\s*/,"").trim(),t=(i.match(/^#+/)||[""])[0].length;let r;r=1===t?(0,o.A)((0,o.A)({},ke.sectionTitle),{},{fontSize:16,marginTop:20,marginBottom:10}):2===t?(0,o.A)((0,o.A)({},ke.sectionTitle),{},{fontSize:14,marginTop:15,marginBottom:8}):(0,o.A)((0,o.A)({},ke.text),{},{fontWeight:600,marginTop:10,marginBottom:5}),n.push((0,ce.jsx)(Se.EY,{style:r,children:Ce(e)},n.length)),a++;continue}if(i.match(/^\d+\.\s+/)){s();const e=a,r=[];for(;a<t.length;){const n=t[a].trim(),o=n.match(/^(\d+)\.\s+(.+)/);if(o)r.push({number:o[1],content:Ce(o[2])}),a++;else{if(!(n&&a>e&&t[a].startsWith("  ")))break;r.length>0&&(r[r.length-1].content+=" "+Ce(n)),a++}}r.length>0&&n.push((0,ce.jsx)(Se.Ss,{style:ke.list,children:r.map((e,t)=>(0,ce.jsxs)(Se.Ss,{style:ke.listItem,children:[(0,ce.jsxs)(Se.EY,{style:(0,o.A)((0,o.A)({},ke.listBullet),{},{minWidth:25}),children:[e.number,"."]}),(0,ce.jsx)(Se.EY,{style:(0,o.A)((0,o.A)({},ke.text),{},{flex:1}),children:e.content})]},t))},n.length));continue}if(i.match(/^[-*+]\s+/)){s();const e=[];for(;a<t.length;){const n=t[a].trim(),o=n.match(/^[-*+]\s+(.+)/);if(o)e.push(Ce(o[1])),a++;else{if(!n||!t[a].startsWith("  "))break;e.length>0&&(e[e.length-1]+=" "+Ce(n)),a++}}e.length>0&&n.push((0,ce.jsx)(Se.Ss,{style:ke.list,children:e.map((e,t)=>(0,ce.jsxs)(Se.Ss,{style:ke.listItem,children:[(0,ce.jsx)(Se.EY,{style:ke.listBullet,children:"\u2022"}),(0,ce.jsx)(Se.EY,{style:(0,o.A)((0,o.A)({},ke.text),{},{flex:1}),children:e})]},t))},n.length));continue}if(e.startsWith("  ")||e.startsWith("\t")){s();const e=[];for(;a<t.length&&(t[a].startsWith("  ")||t[a].startsWith("\t"));)e.push(t[a].replace(/^( {2}|\t)/,"")),a++;e.length>0&&n.push((0,ce.jsx)(Se.Ss,{style:ke.codeBlock,children:(0,ce.jsx)(Se.EY,{style:{color:"#e2e8f0",fontFamily:"JetBrainsMono",fontSize:9},children:e.join("\n")})},n.length));continue}if(i.startsWith(">")){s();const e=[];for(;a<t.length&&t[a].trim().startsWith(">");)e.push(t[a].trim().substring(1).trim()),a++;n.push((0,ce.jsx)(Se.Ss,{style:ke.blockquote,children:(0,ce.jsx)(Se.EY,{style:(0,o.A)((0,o.A)({},ke.text),{},{color:"#6b7280",fontStyle:"italic"}),children:e.join(" ")})},n.length));continue}i.match(/^(-{3,}|\*{3,}|_{3,})$/)?(s(),n.push((0,ce.jsx)(Se.Ss,{style:{borderBottom:1,borderBottomColor:"#e5e7eb",marginVertical:15}},n.length)),a++):(r.push(i),a++)}else s(),a++}return s(),(0,ce.jsx)(Se.Ss,{children:n})},Ce=e=>e=(e=(e=(e=(e=(e=(e=e.replace(/\*\*([^*]+)\*\*/g,"$1")).replace(/__([^_]+)__/g,"$1")).replace(/(?<!\*)\*(?!\*)([^*]+)(?<!\*)\*(?!\*)/g,"$1")).replace(/(?<!_)_(?!_)([^_]+)(?<!_)_(?!_)/g,"$1")).replace(/`([^`]+)`/g,"$1")).replace(/\[([^\]]+)\]\([^)]+\)/g,"$1")).replace(/\\([*_`[\]()])/g,"$1"),Ee=e=>e.replace(/_/g," ").replace(/([A-Z])/g," $1").trim().split(" ").map(e=>e.charAt(0).toUpperCase()+e.slice(1).toLowerCase()).join(" "),Te=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(!e)return(0,ce.jsx)(Se.Ss,{style:{padding:20,backgroundColor:"#f9fafb",borderRadius:6},children:(0,ce.jsx)(Se.EY,{style:(0,o.A)((0,o.A)({},ke.text),{},{color:"#9ca3af",textAlign:"center"}),children:"No results available"})});if("string"===typeof e)try{const n=JSON.parse(e);return Te(n,t)}catch(n){return _e(e)}if(Array.isArray(e))return(0,ce.jsx)(Se.Ss,{children:e.map((e,n)=>(0,ce.jsxs)(Se.Ss,{style:{marginBottom:10},children:[(0,ce.jsx)(Se.Ss,{style:{flexDirection:"row",alignItems:"center",marginBottom:5},children:(0,ce.jsx)(Se.Ss,{style:{width:24,height:24,backgroundColor:"#3b82f6",borderRadius:12,alignItems:"center",justifyContent:"center",marginRight:8},children:(0,ce.jsx)(Se.EY,{style:{color:"#ffffff",fontSize:10,fontWeight:600},children:n+1})})}),Te(e,t+1)]},n))});if("object"===typeof e&&null!==e){if("data"in e&&e.data)return Te(e.data,t);const n=Object.entries(e).filter(e=>{let[t]=e;return!["_id","__v","createdAt","updatedAt"].includes(t)});return 0===n.length?(0,ce.jsx)(Se.EY,{style:ke.text,children:"Empty object"}):(0,ce.jsx)(Se.Ss,{children:n.map(e=>{let[n,r]=e;const s="object"===typeof r&&null!==r;return(0,ce.jsxs)(Se.Ss,{style:{marginBottom:15},children:[0===t?(0,ce.jsx)(Se.EY,{style:ke.sectionTitle,children:Ee(n)}):(0,ce.jsxs)(Se.EY,{style:(0,o.A)((0,o.A)({},ke.text),{},{fontWeight:600,marginBottom:5}),children:[Ee(n),":"]}),"string"===typeof r?_e(r):s?(0,ce.jsx)(Se.Ss,{style:{paddingLeft:t>0?15:0},children:Te(r,t+1)}):(0,ce.jsx)(Se.EY,{style:ke.text,children:String(r)})]},n)})})}return(0,ce.jsx)(Se.EY,{style:ke.text,children:String(e)})},Re=e=>{var t,n;let{run:r}=e;const s=(e=>{switch(null===e||void 0===e?void 0:e.toLowerCase()){case"completed":case"success":return"#10b981";case"failed":case"error":return"#ef4444";case"running":case"in_progress":return"#3b82f6";case"pending":case"queued":return"#f59e0b";default:return"#6b7280"}})(r.status),a=(new Date).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"});return(0,ce.jsx)(Se.yo,{children:(0,ce.jsxs)(Se.YW,{size:"A4",style:ke.page,children:[(0,ce.jsxs)(Se.Ss,{style:ke.header,children:[(0,ce.jsxs)(Se.Ss,{style:ke.headerTop,children:[(0,ce.jsx)(Se.Ss,{style:{flex:1},children:(0,ce.jsx)(Se.EY,{style:ke.title,children:r.run_name})}),(0,ce.jsxs)(Se.BS,{width:"40",height:"40",viewBox:"0 0 40 40",children:[(0,ce.jsx)(Se.wA,{d:"M20 5 L35 15 L35 25 L20 35 L5 25 L5 15 Z",fill:"#3b82f6",opacity:"0.1"}),(0,ce.jsx)(Se.wA,{d:"M20 10 L30 17 L30 23 L20 30 L10 23 L10 17 Z",fill:"#3b82f6"})]})]}),(0,ce.jsxs)(Se.Ss,{style:{marginTop:12},children:[(0,ce.jsx)(Se.EY,{style:ke.subtitle,children:new Date(r.created_at).toLocaleDateString("en-US",{weekday:"long",year:"numeric",month:"long",day:"numeric"})}),r.completed_at&&"completed"!==(null===(t=r.status)||void 0===t?void 0:t.toLowerCase())&&(0,ce.jsx)(Se.Ss,{style:{flexDirection:"row",alignItems:"center",marginTop:8},children:(0,ce.jsx)(Se.Ss,{style:(0,o.A)((0,o.A)({},ke.statusBadge),{},{backgroundColor:s}),children:(0,ce.jsx)(Se.EY,{style:ke.statusText,children:(null===(n=r.status)||void 0===n?void 0:n.toUpperCase())||"UNKNOWN"})})})]})]}),(0,ce.jsx)(Se.Ss,{style:{marginTop:20,flex:1},children:Te(r.result)}),(0,ce.jsxs)(Se.Ss,{style:ke.footer,children:[(0,ce.jsxs)(Se.EY,{style:ke.footerText,children:["Generated on ",a]}),(0,ce.jsx)(Se.EY,{style:ke.pageNumber,children:"Page 1"})]})]})})},ze=async e=>{try{const t=await(0,Se.x8)((0,ce.jsx)(Re,{run:e})).toBlob(),n=URL.createObjectURL(t),o=document.createElement("a");o.href=n;const r=e.run_name.replace(/[^a-z0-9]/gi,"_").toLowerCase(),s=(new Date).toISOString().split("T")[0];o.download="".concat(r,"_").concat(s,"_").concat(e.job_id,".pdf"),document.body.appendChild(o),o.click(),document.body.removeChild(o),URL.revokeObjectURL(n)}catch(t){throw t}};var Le=n(27721);const De=["node","children","href"],Ie=["node","children","href"],Oe=(0,s.memo)(e=>{let{open:t,onClose:n,result:a,run:i}=e;const c=(0,ue.A)(),[d,u]=(0,s.useState)(!1),[p,h]=(0,s.useState)("code"),[m,g]=(0,s.useState)(!1),[x,f]=(0,s.useState)(null),j=(0,s.useRef)(null),A=(0,s.useRef)(!1);(0,s.useEffect)(()=>{if(t&&(A.current=!0,a)){const e=JSON.stringify(a);/<[^>]*>/.test(e)||e.includes("<!DOCTYPE")||e.includes("<html")?h("html"):h("code"),v(a)}},[t,a,i]);const v=async e=>{try{if(!i)return;const e=Le.O.getInstance(),n=await e.getDatabricksConfig();if(!n||!n.workspace_url)return;let o=null,r=!1;if(null!==i&&void 0!==i&&i.tasks_yaml)try{const e=null===i||void 0===i?void 0:i.tasks_yaml;if(/callback_config:\s*["']?DatabricksVolumeCallback/.test(e)){const t=/volume_path:\s*["']?([^"'\n]+)["']?/.exec(e);t&&t[1]?(o=t[1],r=!0):n.volume_enabled&&n.volume_path&&(o=n.volume_path,r=!0)}}catch(t){}if(!r&&n.volume_enabled&&n.volume_path&&(o=n.volume_path,r=!0),r&&o){const e=(null===i||void 0===i?void 0:i.run_name)||(null===i||void 0===i?void 0:i.job_id)||"unknown",t="/Volumes/".concat(o.replace(/\./g,"/"),"/").concat(e);f({path:t,workspaceUrl:n.workspace_url})}}catch(t){}},w=/(https?:\/\/[^\s]+)/g,S=(0,s.useMemo)(()=>{if(!a)return!1;const e=JSON.stringify(a);return/<[^>]*>/.test(e)||e.includes("<!DOCTYPE")||e.includes("<html")},[a]),k=(0,s.useMemo)(()=>a||{},[a]);(0,s.useEffect)(()=>{const e=()=>{g(!!document.fullscreenElement)};return document.addEventListener("fullscreenchange",e),document.addEventListener("webkitfullscreenchange",e),document.addEventListener("mozfullscreenchange",e),document.addEventListener("MSFullscreenChange",e),()=>{document.removeEventListener("fullscreenchange",e),document.removeEventListener("webkitfullscreenchange",e),document.removeEventListener("mozfullscreenchange",e),document.removeEventListener("MSFullscreenChange",e)}},[]);const _=e=>"object"===typeof e&&null!==e?JSON.stringify(e,null,2):String(null!==e&&void 0!==e?e:""),C=e=>e.split(w).map((e,t)=>e.match(w)?(0,ce.jsx)(l.A,{sx:{display:"inline-flex",alignItems:"center",gap:.5},children:(0,ce.jsxs)(pe.A,{href:e,target:"_blank",rel:"noopener noreferrer",sx:{display:"inline-flex",alignItems:"center",gap:.5,color:"primary.main",textDecoration:"none","&:hover":{textDecoration:"underline"}},children:[e,(0,ce.jsx)(ge.A,{sx:{fontSize:16}})]})},t):e),E=e=>[/^#+ /m,/\*\*.+\*\*/,/_.+_/,/\[.+\]\(.+\)/,/^\s*[-*+]\s/m,/^\s*\d+\.\s/m,/```[\s\S]*```/,/^\s*>/m].some(t=>t.test(e)),T=e=>{if(e.match(/^```(html|HTML)\s*\n[\s\S]*\n```\s*$/))return!0;return[/<\/?[a-z][\s\S]*>/i,/<!DOCTYPE\s+html/i,/<html[^>]*>/i,/<body[^>]*>/i,/<div[^>]*>/i,/<p[^>]*>/i,/<h[1-6][^>]*>/i,/<table[^>]*>/i].some(t=>t.test(e))},R=(0,s.memo)(function(e){let{html:t,isFullscreen:n=!1}=e;const o=(0,s.useRef)(null),r=(0,s.useRef)(!1),a=(0,s.useRef)(""),i=(0,s.useRef)(""),d=(e=>{let t=e;return t.match(/^```(html|HTML)\s*\n/)&&(t=t.replace(/^```(html|HTML)\s*\n/,""),t=t.replace(/\n```\s*$/,"")),t})(t),u=(e=>{const t=e.substring(0,100);let n=0;for(let o=0;o<t.length;o++)n=(n<<5)-n+t.charCodeAt(o),n&=n;return n.toString()})(d),p=a.current!==u;return p&&(a.current=u,r.current=!1),(0,s.useEffect)(()=>{if(!o.current)return;const e=o.current;if(!p&&r.current)return;if(i.current===d&&r.current)return;r.current=!0,i.current=d;let t=d;const n="\n        <script>\n          // Polyfill for History API in sandboxed iframe\n          (function() {\n            // Store the original methods if they exist\n            const originalPushState = window.history.pushState;\n            const originalReplaceState = window.history.replaceState;\n            \n            // Override history methods to prevent errors in sandboxed context\n            try {\n              window.history.pushState = function(state, title, url) {\n                try {\n                  // Try to call the original method\n                  return originalPushState.apply(window.history, arguments);\n                } catch (e) {\n                  // Silently fail if not allowed in sandbox\n                  console.debug('pushState blocked in sandbox:', e.message);\n                }\n              };\n              \n              window.history.replaceState = function(state, title, url) {\n                try {\n                  // Try to call the original method\n                  return originalReplaceState.apply(window.history, arguments);\n                } catch (e) {\n                  // Silently fail if not allowed in sandbox\n                  console.debug('replaceState blocked in sandbox:', e.message);\n                }\n              };\n              \n              // Also handle popstate events that might cause issues\n              window.addEventListener('error', function(e) {\n                if (e.message && e.message.includes('history')) {\n                  e.preventDefault();\n                  console.debug('History-related error prevented:', e.message);\n                }\n              }, true);\n            } catch (e) {\n              // Even the override might fail in some strict contexts\n              console.debug('Could not override history methods:', e.message);\n            }\n            \n            // For libraries that check for history API support\n            if (!window.history.state) {\n              try {\n                Object.defineProperty(window.history, 'state', {\n                  get: function() { return null; },\n                  configurable: true\n                });\n              } catch (e) {\n                // Ignore if we can't define the property\n              }\n            }\n            \n            // Handle location.hash for navigation-based libraries\n            let virtualHash = '';\n            try {\n              Object.defineProperty(window.location, 'hash', {\n                get: function() { return virtualHash; },\n                set: function(value) { \n                  virtualHash = value;\n                  // Trigger hashchange event for libraries that listen to it\n                  window.dispatchEvent(new HashChangeEvent('hashchange'));\n                },\n                configurable: true\n              });\n            } catch (e) {\n              // If we can't override location.hash, that's okay\n            }\n          })();\n        <\/script>\n        <style>\n          /* Responsive scaling for iframe content */\n          html, body {\n            margin: 0 !important;\n            padding: 0 !important;\n            width: 100% !important;\n            height: 100% !important;\n            overflow: auto !important;\n          }\n          \n          /* Ensure content fits viewport */\n          body > *:first-child:not(script):not(style) {\n            max-width: 100% !important;\n            max-height: 100vh !important;\n          }\n        </style>\n        <script>\n          // Basic iframe initialization - no library-specific code\n          (function() {\n            // Ensure iframe content is properly sized\n            if (document.readyState === 'complete' || document.readyState === 'interactive') {\n              // Content already loaded\n              if (document.body) {\n                document.body.style.margin = '0';\n                document.body.style.padding = '0';\n              }\n            } else {\n              // Wait for content to load\n              window.addEventListener('DOMContentLoaded', function() {\n                if (document.body) {\n                  document.body.style.margin = '0';\n                  document.body.style.padding = '0';\n                }\n              });\n            }\n          })();\n        <\/script>\n      ";t=t.includes("<head>")?t.replace("<head>","<head>"+n):t.includes("<html>")?t.replace("<html>","<html><head>"+n+"</head>"):n+t,e.srcdoc=t},[p,d]),(0,ce.jsx)(l.A,{sx:{width:"100%",height:n?"calc(100vh - 80px)":"calc(80vh - 100px)",minHeight:"400px",maxHeight:n?"calc(100vh - 80px)":"calc(95vh - 120px)",border:"1px solid ".concat(c.palette.divider),borderRadius:1,overflow:"hidden",display:"flex",flexDirection:"column"},children:(0,ce.jsx)("iframe",{ref:o,sandbox:"allow-scripts allow-forms allow-modals allow-popups allow-presentation allow-pointer-lock allow-downloads",allow:"accelerometer; camera; encrypted-media; fullscreen; gyroscope; magnetometer; microphone; midi; payment; usb; xr-spatial-tracking",style:{width:"100%",height:"100%",border:"none",backgroundColor:c.palette.background.paper},title:"Sandboxed HTML/JS Content"})})},(e,t)=>e.html.replace(/^```(html|HTML)\s*\n/,"").replace(/\n```\s*$/,"").trim()===t.html.replace(/^```(html|HTML)\s*\n/,"").replace(/\n```\s*$/,"").trim()&&e.isFullscreen===t.isFullscreen),z=e=>(0,ce.jsx)(M.A,{elevation:0,sx:{bgcolor:"light"===c.palette.mode?"grey.50":"grey.900",p:2.5,borderRadius:1.5,border:"1px solid",borderColor:"light"===c.palette.mode?"grey.200":"grey.800",transition:"all 0.2s ease-in-out","&:hover":{bgcolor:"light"===c.palette.mode?"grey.100":"grey.800",borderColor:"light"===c.palette.mode?"grey.300":"grey.700"}},children:"string"===typeof e&&T(e)&&"html"===p?(0,ce.jsx)(R,{html:e,isFullscreen:m}):"string"===typeof e&&E(e)&&!T(e)?(0,ce.jsx)(l.A,{sx:{"& .markdown-body":{fontFamily:c.typography.fontFamily,fontSize:"0.9rem",lineHeight:1.6,color:"light"===c.palette.mode?"rgba(0, 0, 0, 0.87)":"rgba(255, 255, 255, 0.87)","& h1, & h2, & h3, & h4, & h5, & h6":{color:c.palette.primary.main,fontWeight:600,marginTop:c.spacing(2),marginBottom:c.spacing(1)},"& p":{marginBottom:c.spacing(1.5)},"& ul, & ol":{paddingLeft:c.spacing(2.5),marginBottom:c.spacing(1.5)},"& li":{marginBottom:c.spacing(.5)},"& code":{backgroundColor:"light"===c.palette.mode?"rgba(0, 0, 0, 0.04)":"rgba(255, 255, 255, 0.1)",padding:c.spacing(.25,.5),borderRadius:4,fontSize:"0.85em"},"& pre":{backgroundColor:"light"===c.palette.mode?"rgba(0, 0, 0, 0.04)":"rgba(255, 255, 255, 0.1)",padding:c.spacing(1.5),borderRadius:4,overflow:"auto","& code":{backgroundColor:"transparent",padding:0}},"& blockquote":{borderLeft:"4px solid ".concat(c.palette.primary.main),margin:0,padding:c.spacing(.5,2),backgroundColor:"light"===c.palette.mode?"rgba(0, 0, 0, 0.04)":"rgba(255, 255, 255, 0.1)"},"& a":{color:c.palette.primary.main,textDecoration:"none","&:hover":{textDecoration:"underline"}},"& table":{borderCollapse:"collapse",width:"100%",marginBottom:c.spacing(2)},"& th, & td":{border:"1px solid ".concat(c.palette.divider),padding:c.spacing(.75,1)},"& th":{backgroundColor:"light"===c.palette.mode?"rgba(0, 0, 0, 0.04)":"rgba(255, 255, 255, 0.1)",fontWeight:600}}},children:(0,ce.jsx)(ie.oz,{className:"markdown-body",remarkPlugins:[le.A],components:{a:e=>{let{node:t,children:n,href:s}=e,a=(0,r.A)(e,Ie);return(0,ce.jsxs)("a",(0,o.A)((0,o.A)({href:s,target:"_blank",rel:"noopener noreferrer",style:{display:"inline-flex",alignItems:"center",gap:"4px",color:c.palette.primary.main,textDecoration:"none"},onMouseEnter:e=>{e.currentTarget.style.textDecoration="underline"},onMouseLeave:e=>{e.currentTarget.style.textDecoration="none"}},a),{},{children:[n,(0,ce.jsx)(ge.A,{sx:{fontSize:16}})]}))}},children:e})}):(0,ce.jsx)("pre",{style:{margin:0,whiteSpace:"pre-wrap",wordWrap:"break-word",fontFamily:'"Roboto Mono", monospace',fontSize:"0.9rem",lineHeight:1.6,color:"light"===c.palette.mode?"rgba(0, 0, 0, 0.87)":"rgba(255, 255, 255, 0.87)"},children:"string"===typeof e?C(e):_(e)})});return(0,ce.jsxs)(O.A,{ref:j,open:t,onClose:n,keepMounted:A.current,maxWidth:"html"===p&&Object.values(k||{}).some(e=>"string"===typeof e&&T(e))?"xl":"lg",fullWidth:!0,sx:{zIndex:e=>e.zIndex.modal+100},PaperProps:{sx:{maxHeight:m?"100vh":"95vh",borderRadius:m?0:2,width:"html"===p&&Object.values(k||{}).some(e=>"string"===typeof e&&T(e))?m?"100vw":"95vw":void 0,margin:m?0:void 0}},children:[(0,ce.jsxs)(F.A,{sx:{px:3,py:2,display:"flex",justifyContent:"space-between",alignItems:"center"},children:[Object.values(k||{}).some(e=>"string"===typeof e&&T(e))?(0,ce.jsxs)(he.A,{value:p,exclusive:!0,onChange:(e,t)=>t&&h(t),size:"small",sx:{height:32},children:[(0,ce.jsxs)(me.A,{value:"code","aria-label":"code view",children:[(0,ce.jsx)(fe.A,{sx:{mr:.5,fontSize:18}}),"Code"]}),(0,ce.jsxs)(me.A,{value:"html","aria-label":"html view",children:[(0,ce.jsx)(ye.A,{sx:{mr:.5,fontSize:18}}),"HTML"]})]}):(0,ce.jsx)(l.A,{}),(0,ce.jsxs)(l.A,{sx:{display:"flex",gap:1},children:[(0,ce.jsx)(y.A,{title:m?"Exit fullscreen":"Fullscreen",children:(0,ce.jsx)(b.A,{onClick:async()=>{if(document.fullscreenElement)try{await document.exitFullscreen(),g(!1)}catch(t){}else try{var e;const t=null===(e=j.current)||void 0===e?void 0:e.querySelector(".MuiDialog-paper");t&&(await t.requestFullscreen(),g(!0))}catch(t){}},size:"small",sx:{color:"text.secondary",transition:"all 0.2s","&:hover":{color:"primary.main",backgroundColor:"action.hover"}},children:m?(0,ce.jsx)(je.A,{}):(0,ce.jsx)(be.A,{})})}),(0,ce.jsx)(y.A,{title:d?"Copied!":"Copy to clipboard",children:(0,ce.jsx)(b.A,{onClick:async()=>{try{let e="";if("string"===typeof k)e=k;else if("object"===typeof k&&null!==k){const t=Object.entries(k);e=1===t.length&&"value"===t[0][0].toLowerCase()?String(t[0][1]):t.map(e=>{let[t,n]=e;return"string"===typeof n?"".concat(t,":\n").concat(n):"".concat(t,":\n").concat(JSON.stringify(n,null,2))}).join("\n\n")}else e=String(k);await navigator.clipboard.writeText(e),u(!0),setTimeout(()=>{u(!1)},2e3)}catch(e){u(!1)}},size:"small",sx:{color:d?"success.main":"text.secondary",transition:"all 0.2s","&:hover":{color:"primary.main",backgroundColor:"action.hover"}},children:d?(0,ce.jsx)(xe.A,{}):(0,ce.jsx)(G.A,{})})})]})]}),(0,ce.jsx)(H.A,{sx:{px:"html"===p&&Object.values(k||{}).some(e=>"string"===typeof e&&T(e))?1:3,py:"html"===p&&Object.values(k||{}).some(e=>"string"===typeof e&&T(e))?1:2,overflow:"auto",display:"flex",flexDirection:"column"},children:(0,ce.jsx)(l.A,{sx:{px:0,py:0,flexGrow:1,display:"flex",flexDirection:"column"},children:(e=>{if("object"===typeof e&&null!==e){const t=Object.entries(e);if(1===t.length&&"value"===t[0][0].toLowerCase()){const e=t[0][1];return z(e)}return t.map((t,n)=>{let[s,a]=t;return(0,ce.jsxs)(l.A,{sx:{mb:3},children:[(0,ce.jsx)(W.A,{variant:"subtitle1",sx:{color:"primary.main",fontWeight:700,mb:1,letterSpacing:"0.01em"},children:s}),(0,ce.jsx)(M.A,{elevation:0,sx:{bgcolor:"light"===c.palette.mode?"grey.50":"grey.900",p:2.5,borderRadius:1.5,border:"1px solid",borderColor:"light"===c.palette.mode?"grey.200":"grey.800",transition:"all 0.2s ease-in-out","&:hover":{bgcolor:"light"===c.palette.mode?"grey.100":"grey.800",borderColor:"light"===c.palette.mode?"grey.300":"grey.700"}},children:"string"===typeof a&&T(a)&&"html"===p?(0,ce.jsx)(R,{html:a,isFullscreen:m}):"string"===typeof a&&E(a)&&!T(a)?(0,ce.jsx)(l.A,{sx:{"& .markdown-body":{fontFamily:c.typography.fontFamily,fontSize:"0.9rem",lineHeight:1.6,color:"light"===c.palette.mode?"rgba(0, 0, 0, 0.87)":"rgba(255, 255, 255, 0.87)","& h1, & h2, & h3, & h4, & h5, & h6":{color:c.palette.primary.main,fontWeight:600,marginTop:c.spacing(2),marginBottom:c.spacing(1)},"& p":{marginBottom:c.spacing(1.5)},"& ul, & ol":{paddingLeft:c.spacing(2.5),marginBottom:c.spacing(1.5)},"& li":{marginBottom:c.spacing(.5)},"& code":{backgroundColor:"light"===c.palette.mode?"rgba(0, 0, 0, 0.04)":"rgba(255, 255, 255, 0.1)",padding:c.spacing(.25,.5),borderRadius:4,fontSize:"0.85em"},"& pre":{backgroundColor:"light"===c.palette.mode?"rgba(0, 0, 0, 0.04)":"rgba(255, 255, 255, 0.1)",padding:c.spacing(1.5),borderRadius:4,overflow:"auto","& code":{backgroundColor:"transparent",padding:0}},"& blockquote":{borderLeft:"4px solid ".concat(c.palette.primary.main),margin:0,padding:c.spacing(.5,2),backgroundColor:"light"===c.palette.mode?"rgba(0, 0, 0, 0.04)":"rgba(255, 255, 255, 0.1)"},"& a":{color:c.palette.primary.main,textDecoration:"none","&:hover":{textDecoration:"underline"}},"& table":{borderCollapse:"collapse",width:"100%",marginBottom:c.spacing(2)},"& th, & td":{border:"1px solid ".concat(c.palette.divider),padding:c.spacing(.75,1)},"& th":{backgroundColor:"light"===c.palette.mode?"rgba(0, 0, 0, 0.04)":"rgba(255, 255, 255, 0.1)",fontWeight:600}}},children:(0,ce.jsx)(ie.oz,{className:"markdown-body",remarkPlugins:[le.A],components:{a:e=>{let{node:t,children:n,href:s}=e,a=(0,r.A)(e,De);return(0,ce.jsxs)("a",(0,o.A)((0,o.A)({href:s,target:"_blank",rel:"noopener noreferrer",style:{display:"inline-flex",alignItems:"center",gap:"4px",color:c.palette.primary.main,textDecoration:"none"},onMouseEnter:e=>{e.currentTarget.style.textDecoration="underline"},onMouseLeave:e=>{e.currentTarget.style.textDecoration="none"}},a),{},{children:[n,(0,ce.jsx)(ge.A,{sx:{fontSize:16}})]}))}},children:a})}):(0,ce.jsx)("pre",{style:{margin:0,whiteSpace:"pre-wrap",wordWrap:"break-word",fontFamily:'"Roboto Mono", monospace',fontSize:"0.9rem",lineHeight:1.6,color:"light"===c.palette.mode?"rgba(0, 0, 0, 0.87)":"rgba(255, 255, 255, 0.87)"},children:"string"===typeof a?C(a):_(a)})}),n<Object.entries(e).length-1&&(0,ce.jsx)(N.A,{sx:{my:3}})]},s)})}return(0,ce.jsx)(M.A,{elevation:0,sx:{bgcolor:"light"===c.palette.mode?"grey.50":"grey.900",p:2.5,borderRadius:1.5,border:"1px solid",borderColor:"light"===c.palette.mode?"grey.200":"grey.800",transition:"all 0.2s ease-in-out","&:hover":{bgcolor:"light"===c.palette.mode?"grey.100":"grey.800",borderColor:"light"===c.palette.mode?"grey.300":"grey.700"}},children:"string"===typeof e&&T(e)&&"html"===p?(0,ce.jsx)(R,{html:e,isFullscreen:m}):"string"===typeof e&&E(e)&&!T(e)?(0,ce.jsx)(ie.oz,{className:"markdown-body",remarkPlugins:[le.A],children:e}):(0,ce.jsx)("pre",{style:{margin:0,whiteSpace:"pre-wrap",wordWrap:"break-word",fontFamily:'"Roboto Mono", monospace',fontSize:"0.9rem",lineHeight:1.6,color:"light"===c.palette.mode?"rgba(0, 0, 0, 0.87)":"rgba(255, 255, 255, 0.87)"},children:"string"===typeof e?C(e):_(e)})})})(k)})}),(0,ce.jsxs)(B.A,{sx:{px:3,py:2,gap:1},children:[x&&(0,ce.jsx)(y.A,{title:"Open Databricks Volume Location",children:(0,ce.jsx)(U.A,{onClick:()=>{if(x.workspaceUrl){const e=x.path.replace("/Volumes/","").split("/");if(e.length>=3){const t=e[0],n=e[1],o=e[2],r=x.workspaceUrl.replace(/\/$/,""),s="".concat(r,"/explore/data/volumes/").concat(t,"/").concat(n,"/").concat(o);window.open(s,"_blank")}else window.open(x.workspaceUrl,"_blank")}else alert("Databricks workspace URL not configured. Please configure Databricks to access the volume.")},variant:"outlined",startIcon:(0,ce.jsx)(we.A,{}),sx:{borderRadius:"8px",textTransform:"none",fontWeight:500,borderColor:"#FF5722",color:"#FF5722","&:hover":{borderColor:"#F4511E",backgroundColor:"rgba(255, 87, 34, 0.04)"}},children:"Open in Databricks Volume"})}),i&&(0,ce.jsx)(y.A,{title:S?"Download as HTML":"Download as PDF",children:(0,ce.jsx)(U.A,{onClick:S?()=>{if(!i)return;let e="";if(a&&"object"===typeof a){const t=JSON.stringify(a);if(t.includes("<html")||t.includes("<!DOCTYPE"))for(const n of Object.values(a)){const t=String(n);if(t.includes("<html")||t.includes("<!DOCTYPE")){e=t;break}}}e||(e='\n<!DOCTYPE html>\n<html lang="en">\n<head>\n    <meta charset="UTF-8">\n    <meta name="viewport" content="width=device-width, initial-scale=1.0">\n    <title>Result</title>\n</head>\n<body>\n    <pre>'.concat(JSON.stringify(a,null,2),"</pre>\n</body>\n</html>\n      "));const t=new Blob([e],{type:"text/html"}),n=URL.createObjectURL(t),o=document.createElement("a");o.href=n;const r=null!==i&&void 0!==i&&i.run_name?i.run_name.replace(/[^a-z0-9]/gi,"_").toLowerCase():"result",s=(new Date).toISOString().split("T")[0],l=(null===i||void 0===i?void 0:i.job_id)||"unknown";o.download="".concat(r,"_").concat(s,"_").concat(l,".html"),document.body.appendChild(o),o.click(),document.body.removeChild(o),URL.revokeObjectURL(n)}:()=>ze(i),variant:"outlined",startIcon:S?(0,ce.jsx)(ve.A,{}):(0,ce.jsx)(Ae.A,{}),sx:{borderRadius:"8px",textTransform:"none",fontWeight:500},children:S?"Download HTML":"Download PDF"})}),(0,ce.jsx)(U.A,{onClick:n,variant:"contained",color:"primary",sx:{borderRadius:1.5,textTransform:"none",px:3,py:1,fontWeight:600},children:"Close"})]})]})},(e,t)=>e.open===t.open&&e.onClose===t.onClose&&JSON.stringify(e.result)===JSON.stringify(t.result));Oe.displayName="ShowResult";const Fe=Oe;var We=n(35887),Ne=n(13115),He=n(36873),Me=n(6493),Pe=n(11679),Be=n(95699),Ue=n(27887);const Je=e=>{let{executionId:t,status:n,variant:o="button",size:r="medium",onStopComplete:a,onStatusChange:c}=e;const[d,u]=(0,s.useState)(!1),[p,h]=(0,s.useState)(!1),m=["RUNNING","PREPARING"].includes(null===n||void 0===n?void 0:n.toUpperCase()),g="STOPPING"===(null===n||void 0===n?void 0:n.toUpperCase())||d,x=()=>{h(!0)},j=async e=>{h(!1),u(!0);try{const n="/executions/".concat(t,"force"===e?"/force-stop":"/stop"),o="graceful"===e?{stop_type:"graceful",reason:"User requested stop",preserve_partial_results:!0}:{},r=await Ue.uE.post(n,o);r.data&&(We.oR.success("Execution ".concat("force"===e?"forcefully":"gracefully"," stopped")),c&&c(r.data.status),a&&a(r.data),"STOPPED"===r.data.status&&window.dispatchEvent(new CustomEvent("jobStopped",{detail:{jobId:t,status:r.data.status,partialResults:r.data.partial_results}})))}catch(o){var n;We.oR.error((null===(n=o.response)||void 0===n||null===(n=n.data)||void 0===n?void 0:n.detail)||"Failed to stop execution")}finally{u(!1)}},A=()=>{h(!1)};return m||g?(0,ce.jsxs)(ce.Fragment,{children:["icon"===o?(0,ce.jsx)(y.A,{title:g?"Stopping execution...":"Stop execution",children:(0,ce.jsx)("span",{children:(0,ce.jsx)(b.A,{color:"error",size:r,onClick:x,disabled:g,children:g?(0,ce.jsx)(i.A,{size:20}):(0,ce.jsx)(Pe.A,{})})})}):(0,ce.jsx)(U.A,{variant:"contained",color:"error",size:r,startIcon:g?(0,ce.jsx)(i.A,{size:16}):(0,ce.jsx)(Pe.A,{}),onClick:x,disabled:g,children:g?"Stopping...":"Stop Execution"}),(0,ce.jsxs)(O.A,{open:p,onClose:A,maxWidth:"sm",fullWidth:!0,children:[(0,ce.jsx)(F.A,{children:(0,ce.jsxs)(l.A,{display:"flex",alignItems:"center",children:[(0,ce.jsx)(Be.A,{color:"warning",sx:{mr:1}}),"Stop Execution?"]})}),(0,ce.jsx)(H.A,{children:(0,ce.jsxs)(Me.A,{component:"div",children:[(0,ce.jsx)(W.A,{variant:"body1",gutterBottom:!0,children:"Choose how you want to stop the execution:"}),(0,ce.jsxs)(l.A,{sx:{mt:2},children:[(0,ce.jsxs)(f.A,{severity:"info",sx:{mb:2},children:[(0,ce.jsx)(W.A,{variant:"subtitle2",fontWeight:"bold",children:"Graceful Stop"}),(0,ce.jsx)(W.A,{variant:"body2",children:"Completes the current task before stopping. Preserves all partial results."})]}),(0,ce.jsxs)(f.A,{severity:"warning",children:[(0,ce.jsx)(W.A,{variant:"subtitle2",fontWeight:"bold",children:"Force Stop"}),(0,ce.jsx)(W.A,{variant:"body2",children:"Immediately terminates the execution. May lose data from the current task."})]})]})]})}),(0,ce.jsxs)(B.A,{children:[(0,ce.jsx)(U.A,{onClick:A,color:"inherit",children:"Cancel"}),(0,ce.jsx)(U.A,{onClick:()=>j("graceful"),color:"warning",variant:"outlined",children:"Graceful Stop"}),(0,ce.jsx)(U.A,{onClick:()=>j("force"),color:"error",variant:"contained",children:"Force Stop"})]})]})]}):null},Ye=e=>{var t,n;let{run:o,onViewResult:r,onShowTrace:s,onShowLogs:a,onSchedule:i,onDelete:c,onStatusChange:d}=e;const{t:u}=(0,oe.Bd)(),{useNewExecutionUI:p}=ne();return p?(0,ce.jsxs)(l.A,{sx:{display:"flex",gap:.5,alignItems:"center"},children:[(0,ce.jsx)(Je,{executionId:o.job_id,status:o.status,variant:"icon",size:"small",onStatusChange:e=>{d&&d(o.id,e)}}),(0,ce.jsx)(y.A,{title:u("runHistory.actions.deleteRun"),children:(0,ce.jsx)(b.A,{size:"small",onClick:()=>c(o),color:"error",children:(0,ce.jsx)(S.A,{fontSize:"small"})})})]}):(0,ce.jsxs)(l.A,{sx:{display:"flex",gap:.5,alignItems:"center"},children:[(0,ce.jsx)(Je,{executionId:o.job_id,status:o.status,variant:"icon",size:"small",onStatusChange:e=>{d&&d(o.id,e)}}),(0,ce.jsx)(y.A,{title:u("runHistory.actions.viewResult"),children:(0,ce.jsx)("span",{children:(0,ce.jsx)(b.A,{size:"small",onClick:()=>r(o),color:"primary",disabled:["running","pending","queued","in_progress"].includes((null===(t=o.status)||void 0===t?void 0:t.toLowerCase())||""),children:(0,ce.jsx)(T.A,{fontSize:"small"})})})}),(0,ce.jsx)(y.A,{title:u("runHistory.actions.downloadPdf"),children:(0,ce.jsx)(b.A,{size:"small",onClick:()=>ze(o),color:"primary",children:(0,ce.jsx)(Ae.A,{fontSize:"small"})})}),(0,ce.jsx)(y.A,{title:u("runHistory.actions.viewTrace"),children:(0,ce.jsx)(b.A,{size:"small",onClick:()=>s(o.id),color:"primary","aria-label":"View execution trace",children:(0,ce.jsx)(R.A,{fontSize:"small"})})}),(0,ce.jsx)(y.A,{title:u("runHistory.actions.viewLogs"),children:(0,ce.jsx)("span",{children:(0,ce.jsx)(b.A,{size:"small",onClick:()=>a(o.job_id),color:"primary",disabled:["running","pending","queued","in_progress"].includes((null===(n=o.status)||void 0===n?void 0:n.toLowerCase())||""),children:(0,ce.jsx)($.A,{fontSize:"small"})})})}),(0,ce.jsx)(y.A,{title:u("runHistory.actions.schedule"),children:(0,ce.jsx)(b.A,{size:"small",onClick:()=>i(o),color:"primary",children:(0,ce.jsx)(z.A,{fontSize:"small"})})}),(0,ce.jsx)(y.A,{title:u("runHistory.actions.deleteRun"),children:(0,ce.jsx)(b.A,{size:"small",onClick:()=>c(o),color:"error",children:(0,ce.jsx)(S.A,{fontSize:"small"})})})]})};var Ve=n(25979),Ke=n(19647),qe=n(70006),Ge=n(23266),$e=n(60899),Qe=n(96557),Ze=n(16497),Xe=n(93038),et=n(4862);const tt=e=>{let{open:t,onClose:n,scheduleName:r,cronExpression:a,scheduleNameInputRef:i,onScheduleNameChange:c,onCronExpressionChange:d,onScheduleJob:u}=e;const{t:p}=(0,oe.Bd)(),[h,m]=(0,s.useState)("visual"),[g,x]=(0,s.useState)("daily"),[y,j]=(0,s.useState)({hour:"0",minute:"0"}),[v,w]=(0,s.useState)([]),[S,k]=(0,s.useState)([]),[_,C]=(0,s.useState)([]),[E,T]=(0,s.useState)(null),[R,z]=(0,s.useState)(!1),L=(0,s.useCallback)(e=>{const t=e.split(" ");if(5!==t.length)return;const[n,o,r,s,a]=t;j({minute:"*"===n?"0":n,hour:"*"===o?"0":o}),"*"===o?x("hourly"):"*"===r&&"*"===s&&"*"===a?x("daily"):"*"===r&&"*"===s&&"*"!==a?(x("weekly"),w(a.split(","))):"*"!==r&&"*"===s?(x("monthly"),C(r.split(","))):"*"!==s&&(x("yearly"),k(s.split(",")))},[]),D=(0,s.useCallback)(()=>{const{hour:e,minute:t}=y;let n="";const o=v.length>0?v.join(","):"*",r=_.length>0?_.join(","):"*",s=S.length>0?S.join(","):"*";switch(g){case"hourly":n="".concat(t," * * * *");break;case"daily":n="".concat(t," ").concat(e," * * *");break;case"weekly":n="".concat(t," ").concat(e," * * ").concat(o);break;case"monthly":n="".concat(t," ").concat(e," ").concat(r," * *");break;case"yearly":n="".concat(t," ").concat(e," * ").concat(s," *");break;default:n="0 0 * * *"}d({target:{value:n}})},[g,y,v,S,_,d]),[I,N]=(0,s.useState)(!1);(0,s.useEffect)(()=>{t&&(N(!0),a&&"0 0 * * *"!==a?L(a):(x("daily"),j({hour:"0",minute:"0"}),w([]),k([]),C([])),T(null),setTimeout(()=>N(!1),100))},[t,a,L]),(0,s.useEffect)(()=>{"visual"===h&&t&&!I&&D()},[h,g,y,v,S,_,t,I,D]);const M=()=>{T(null)};return(0,ce.jsxs)(ce.Fragment,{children:[(0,ce.jsxs)(O.A,{open:t,onClose:n,maxWidth:"sm",fullWidth:!0,children:[(0,ce.jsxs)(F.A,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",pb:1.5,borderBottom:"1px solid",borderColor:"divider"},children:[(0,ce.jsx)(W.A,{variant:"h6",children:"Schedule Job"}),(0,ce.jsx)(b.A,{onClick:n,size:"small",sx:{color:"text.secondary","&:hover":{color:"text.primary"}},children:(0,ce.jsx)(J.A,{})})]}),(0,ce.jsxs)(H.A,{children:[(0,ce.jsx)(A.A,{fullWidth:!0,label:"Schedule Name",value:r,onChange:c,margin:"normal",inputRef:i}),(0,ce.jsxs)(l.A,{sx:{mb:2,mt:2},children:[(0,ce.jsxs)(he.A,{value:h,exclusive:!0,onChange:(e,t)=>t&&m(t),sx:{mb:2},children:[(0,ce.jsx)(me.A,{value:"visual",children:"Simple Schedule"}),(0,ce.jsx)(me.A,{value:"manual",children:"Advanced (Cron)"})]}),"manual"===h?(0,ce.jsx)(A.A,{fullWidth:!0,label:"Cron Expression",value:a,onChange:d,helperText:"Example: '0 0 * * *' for daily at midnight"}):(()=>{const e=Array.from({length:24},(e,t)=>t.toString()),t=Array.from({length:60},(e,t)=>t.toString()),n=Array.from({length:31},(e,t)=>(t+1).toString());return(0,ce.jsxs)(l.A,{sx:{mt:2},children:[(0,ce.jsxs)(Ve.A,{fullWidth:!0,sx:{mb:2},children:[(0,ce.jsx)(Ke.A,{children:"Frequency"}),(0,ce.jsxs)(qe.A,{value:g,onChange:e=>x(e.target.value),label:"Frequency",children:[(0,ce.jsx)(Ge.A,{value:"hourly",children:"Hourly"}),(0,ce.jsx)(Ge.A,{value:"daily",children:"Daily"}),(0,ce.jsx)(Ge.A,{value:"weekly",children:"Weekly"}),(0,ce.jsx)(Ge.A,{value:"monthly",children:"Monthly"}),(0,ce.jsx)(Ge.A,{value:"yearly",children:"Yearly"})]})]}),(0,ce.jsxs)($e.Ay,{container:!0,spacing:2,sx:{mb:2},children:[(0,ce.jsx)($e.Ay,{item:!0,xs:6,children:(0,ce.jsxs)(Ve.A,{fullWidth:!0,children:[(0,ce.jsx)(Ke.A,{children:"Hour"}),(0,ce.jsx)(qe.A,{value:y.hour,onChange:e=>j(t=>(0,o.A)((0,o.A)({},t),{},{hour:e.target.value})),label:"Hour",disabled:"hourly"===g,children:e.map(e=>(0,ce.jsx)(Ge.A,{value:e,children:e.padStart(2,"0")},e))})]})}),(0,ce.jsx)($e.Ay,{item:!0,xs:6,children:(0,ce.jsxs)(Ve.A,{fullWidth:!0,children:[(0,ce.jsx)(Ke.A,{children:"Minute"}),(0,ce.jsx)(qe.A,{value:y.minute,onChange:e=>j(t=>(0,o.A)((0,o.A)({},t),{},{minute:e.target.value})),label:"Minute",children:t.map(e=>(0,ce.jsx)(Ge.A,{value:e,children:e.padStart(2,"0")},e))})]})})]}),"weekly"===g&&(0,ce.jsxs)(Ve.A,{component:"fieldset",fullWidth:!0,sx:{mb:2},children:[(0,ce.jsx)(W.A,{variant:"subtitle2",gutterBottom:!0,children:"Select Days"}),(0,ce.jsx)(Qe.A,{row:!0,children:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"].map((e,t)=>(0,ce.jsx)(Ze.A,{control:(0,ce.jsx)(Xe.A,{checked:v.includes(t.toString()),onChange:e=>{e.target.checked?w([...v,t.toString()]):w(v.filter(e=>e!==t.toString()))}}),label:e},e))})]}),"monthly"===g&&(0,ce.jsxs)(Ve.A,{component:"fieldset",fullWidth:!0,sx:{mb:2},children:[(0,ce.jsx)(W.A,{variant:"subtitle2",gutterBottom:!0,children:"Select Days of Month"}),(0,ce.jsx)(Qe.A,{row:!0,children:n.map(e=>(0,ce.jsx)(Ze.A,{control:(0,ce.jsx)(Xe.A,{checked:_.includes(e),onChange:t=>{t.target.checked?C([..._,e]):C(_.filter(t=>t!==e))}}),label:e,sx:{width:"70px"}},e))})]}),"yearly"===g&&(0,ce.jsxs)(Ve.A,{component:"fieldset",fullWidth:!0,sx:{mb:2},children:[(0,ce.jsx)(W.A,{variant:"subtitle2",gutterBottom:!0,children:"Select Months"}),(0,ce.jsx)(Qe.A,{row:!0,children:["January","February","March","April","May","June","July","August","September","October","November","December"].map((e,t)=>(0,ce.jsx)(Ze.A,{control:(0,ce.jsx)(Xe.A,{checked:S.includes((t+1).toString()),onChange:e=>{e.target.checked?k([...S,(t+1).toString()]):k(S.filter(e=>e!==(t+1).toString()))}}),label:e},e))})]})]})})()]}),"visual"===h&&(0,ce.jsx)(l.A,{sx:{mt:2,p:2,bgcolor:"grey.50",borderRadius:1},children:(0,ce.jsxs)(W.A,{variant:"body2",color:"text.secondary",children:[(0,ce.jsx)("strong",{children:"Generated Cron Expression:"})," ",a]})})]}),(0,ce.jsxs)(B.A,{children:[(0,ce.jsx)(U.A,{onClick:n,disabled:R,children:"Cancel"}),(0,ce.jsx)(U.A,{onClick:async()=>{if(r&&a)try{z(!0),T(null),await u()}catch(E){T("Failed to schedule job")}finally{z(!1)}else T("Please fill in all required fields")},variant:"contained",color:"primary",disabled:R||!r||!a,children:R?"Scheduling...":"Schedule Job"})]})]}),(0,ce.jsx)(et.A,{open:!!E,autoHideDuration:6e3,onClose:M,anchorOrigin:{vertical:"top",horizontal:"center"},children:(0,ce.jsx)(f.A,{onClose:M,severity:"error",variant:"filled",sx:{width:"100%",whiteSpace:"pre-line"},children:E})})]})},nt=e=>{let{deleteDialogOpen:t,deleteLoading:n,scheduleDialogOpen:o,scheduleName:r,cronExpression:s,scheduleNameInputRef:a,deleteRunDialogOpen:i,onCloseDeleteDialog:l,onCloseScheduleDialog:c,onCloseDeleteRunDialog:d,onDeleteAllRuns:u,onDeleteRun:p,onScheduleJob:h,onScheduleNameChange:m,onCronExpressionChange:g}=e;const{t:x}=(0,oe.Bd)();return(0,ce.jsxs)(ce.Fragment,{children:[(0,ce.jsxs)(O.A,{open:t,onClose:l,children:[(0,ce.jsx)(F.A,{children:x("common.confirm")}),(0,ce.jsx)(H.A,{children:(0,ce.jsx)(Me.A,{children:x("runHistory.deleteConfirm")})}),(0,ce.jsxs)(B.A,{children:[(0,ce.jsx)(U.A,{onClick:l,disabled:n,children:x("common.cancel")}),(0,ce.jsx)(U.A,{onClick:u,color:"error",disabled:n,children:x(n?"common.loading":"common.delete")})]})]}),(0,ce.jsx)(tt,{open:o,onClose:c,scheduleName:r,cronExpression:s,scheduleNameInputRef:a,onScheduleNameChange:m,onCronExpressionChange:g,onScheduleJob:h}),(0,ce.jsxs)(O.A,{open:i,onClose:d,children:[(0,ce.jsx)(F.A,{children:x("common.confirm")}),(0,ce.jsx)(H.A,{children:(0,ce.jsx)(Me.A,{children:x("runHistory.deleteRunConfirm")})}),(0,ce.jsxs)(B.A,{children:[(0,ce.jsx)(U.A,{onClick:d,disabled:n,children:x("common.cancel")}),(0,ce.jsx)(U.A,{onClick:p,color:"error",disabled:n,children:x(n?"common.loading":"common.delete")})]})]})]})};var ot=n(61031),rt=n(73499),st=n(73364),at=n(59943),it=n(16724),lt=n(11227),ct=n(99905),dt=n(49885);const ut=e=>{let{status:t,size:n="small",showIcon:o=!0}=e;const r=(()=>{switch(null===t||void 0===t?void 0:t.toUpperCase()){case"PENDING":return{label:"Pending",color:"warning",icon:(0,ce.jsx)(st.A,{})};case"QUEUED":return{label:"Queued",color:"warning",icon:(0,ce.jsx)(st.A,{})};case"PREPARING":return{label:"Preparing",color:"info",icon:(0,ce.jsx)(at.A,{})};case"RUNNING":return{label:"Running",color:"primary",icon:(0,ce.jsx)(it.A,{})};case"STOPPING":return{label:"Stopping",color:"warning",icon:(0,ce.jsx)(l.A,{display:"flex",alignItems:"center",children:(0,ce.jsx)(i.A,{size:16,color:"inherit"})})};case"STOPPED":return{label:"Stopped",color:"warning",icon:(0,ce.jsx)(Pe.A,{})};case"COMPLETED":return{label:"Completed",color:"success",icon:(0,ce.jsx)(lt.A,{})};case"FAILED":return{label:"Failed",color:"error",icon:(0,ce.jsx)(ct.A,{})};case"CANCELLED":return{label:"Cancelled",color:"default",icon:(0,ce.jsx)(dt.A,{})};default:return{label:t?t.charAt(0).toUpperCase()+t.slice(1).toLowerCase():"Unknown",color:"default",icon:null}}})();return(0,ce.jsx)(a.A,{label:r.label,color:r.color,size:n,icon:o&&r.icon?r.icon:void 0,variant:"STOPPING"===(null===t||void 0===t?void 0:t.toUpperCase())?"filled":"outlined",sx:{animation:"STOPPING"===(null===t||void 0===t?void 0:t.toUpperCase())?"pulse 2s infinite":"none","@keyframes pulse":{"0%":{opacity:1},"50%":{opacity:.6},"100%":{opacity:1}}}})},pt=["job_id","execution_id"],ht=e=>{let{run:t}=e;const[n,o]=(0,s.useState)("-"),[r,c]=(0,s.useState)(!0);return(0,s.useEffect)(()=>{let e=!0;const n=(t.status||"").toUpperCase();return"COMPLETED"===n||"FAILED"===n||"CANCELLED"===n?(async()=>{try{const n=await(0,D.Jc)(t);e&&(o(n),c(!1))}catch(n){e&&(o("-"),c(!1))}})():(o("-"),c(!1)),()=>{e=!1}},[t]),r?(0,ce.jsx)(a.A,{label:(0,ce.jsx)(i.A,{size:10,thickness:4}),size:"small",variant:"outlined",sx:{height:"18px","& .MuiChip-label":{px:.75},borderColor:e=>e.palette.grey[400]}}):"-"===n?(0,ce.jsx)("span",{style:{color:"#999",fontSize:"0.75rem"},children:"-"}):(0,ce.jsx)(a.A,{label:(0,ce.jsxs)(l.A,{sx:{display:"flex",alignItems:"center",gap:.5},children:[(0,ce.jsx)(L.A,{sx:{fontSize:"0.75rem"}}),(0,ce.jsx)("span",{children:n})]}),size:"small",variant:"outlined",sx:{height:"20px","& .MuiChip-label":{px:.5,fontSize:"0.7rem",fontWeight:500},borderColor:e=>e.palette.grey[400]}})},mt=(0,s.forwardRef)((e,t)=>{let{executionHistoryHeight:n=200,onExecutionCountChange:i}=e;const{t:L}=(0,oe.Bd)(),{showRunResult:D,selectedRun:O,isOpen:F,closeRunResult:W}=(0,ae.K)(),{userRole:N}=(0,rt.Sk)(),{runs:H,searchQuery:M,loading:P,showSkeleton:B,error:U,page:J,totalPages:Y,totalRuns:V,jobsPerPage:K,sortField:q,sortOrder:G,fetchRuns:$,handlePageChange:Q,handleSearchChange:Z,handleDeleteAllRuns:X,handleDeleteRun:ee,getCurrentPageJobs:te,handleSort:ne}=(0,Ne.V)(),ie=(0,He.a)(e=>e.startPolling),le=(0,He.a)(e=>e.stopPolling),ue=(0,He.a)(e=>e.setUserActive),pe=(0,He.a)(e=>e.cleanup),[he,me]=(0,s.useState)(null),[ge,xe]=(0,s.useState)(null),[fe,ye]=(0,s.useState)(!1),[be,je]=(0,s.useState)(!1),[Ae,ve]=(0,s.useState)(!1),[we,Se]=(0,s.useState)(!1),[ke,_e]=(0,s.useState)([]),[Ce,Ee]=(0,s.useState)(null),[Te,Re]=(0,s.useState)(!1),[ze,Le]=(0,s.useState)(null),[De,Ie]=(0,s.useState)(!1),[Oe,Me]=(0,s.useState)(null),[Pe,Be]=(0,s.useState)(""),[Ue,Je]=(0,s.useState)("0 0 * * *"),[Ve,Ke]=(0,s.useState)(null),qe=(0,s.useRef)(null),Ge=(0,s.useRef)(null),[$e,Qe]=(0,s.useState)(!1),[Ze,Xe]=(0,s.useState)(null),[et,tt]=(0,s.useState)(1),st=(0,s.useRef)(!1),at=(0,s.useRef)(!1),it=(0,s.useRef)(!1),lt=(0,s.useRef)(null),ct=s.useMemo(()=>{const e=n-80;return Math.max(6,Math.floor(e/32))},[n]),dt=(et-1)*ct,mt=dt+ct,gt=H.slice(dt,mt),xt=Math.ceil(H.length/ct),ft=s.useMemo(()=>(null===O||void 0===O?void 0:O.result)||{},[null===O||void 0===O?void 0:O.result]);(0,s.useEffect)(()=>{at.current=fe,it.current=we},[fe,we]),(0,s.useEffect)(()=>{tt(1)},[H.length,M]),(0,s.useEffect)(()=>{i&&i(H.length)},[H.length,i]),(0,s.useEffect)(()=>{if(st.current)return;st.current=!0;const e=(async()=>{try{await $()}catch(t){}const e=()=>{ue(!0),lt.current&&clearTimeout(lt.current),lt.current=setTimeout(()=>{ue(!1)},3e5)};return window.addEventListener("mousemove",e),window.addEventListener("keydown",e),window.addEventListener("click",e),e(),ie(),()=>{lt.current&&clearTimeout(lt.current),window.removeEventListener("mousemove",e),window.removeEventListener("keydown",e),window.removeEventListener("click",e),le(),pe()}})();return()=>{e.then(e=>e())}},[$,ie,le,ue,pe]),(0,s.useEffect)(()=>{if(!st.current)return;const e=at.current&&!fe,t=it.current&&!we;(e||t)&&$().catch(e=>{})},[fe,we,$]),(0,s.useEffect)(()=>{const e=()=>{$().catch(e=>{})};return window.addEventListener("refreshRunHistory",e),()=>{window.removeEventListener("refreshRunHistory",e)}},[$]);const yt=e=>{me(e);const t=H.find(t=>t.id===e);xe(t||null),ye(!0)},bt=e=>{D(e)},jt=e=>{Xe(e),Qe(!0)},At=async e=>{try{window.dispatchEvent(new CustomEvent("jobViewed",{detail:{jobId:e}})),Re(!0),Le(null),Ee(e),Se(!0);const t=await se.m.getHistoricalLogs(e);_e(t.map(e=>{let{job_id:t,execution_id:n}=e,s=(0,r.A)(e,pt);return(0,o.A)((0,o.A)({},s),{},{output:s.output||s.content,id:s.id||Date.now()})})),se.m.connectToJobLogs(e);const{loadTaskStates:n}=ot.useTaskExecutionStore.getState();await n(e);const s=se.m.onConnected(e,()=>{Re(!1)}),a=se.m.onJobLogs(e,e=>{_e(t=>[...t,{id:e.id||Date.now(),output:e.output||e.content,timestamp:e.timestamp}])}),i=se.m.onError(e,e=>{Le("Failed to connect to log stream"),Re(!1)}),l=se.m.onClose(e,e=>{Re(!1)});return()=>{s(),a(),i(),l(),se.m.disconnectFromJobLogs(e)}}catch(U){return Le("Failed to fetch logs"),Re(!1),()=>{}}};(0,s.useEffect)(()=>()=>{se.m.cleanup()},[]);const vt=e=>{var t,n;Je("0 0 * * *"),Me(e),Be("".concat(null!==(t=e.run_name)&&void 0!==t&&t.startsWith('"')&&null!==(n=e.run_name)&&void 0!==n&&n.endsWith('"')?e.run_name.slice(1,-1):e.run_name," Schedule")),Ie(!0),setTimeout(()=>{Ge.current&&Ge.current.focus()},150)},wt=()=>{Ke(null)},St=Boolean(Ve),kt=St?"filter-popover":void 0,_t=e=>q!==e?null:"asc"===G?(0,ce.jsx)(C.A,{fontSize:"small"}):(0,ce.jsx)(E.A,{fontSize:"small"});return s.useImperativeHandle(t,()=>({refreshRuns:async()=>{await $()}})),B?(0,ce.jsx)(c.A,{sx:{boxShadow:"none",height:"100%"},children:(0,ce.jsx)(d.A,{sx:{p:0,height:"100%","&:last-child":{pb:0},display:"flex",flexDirection:"column"},children:(0,ce.jsx)(u.A,{sx:{flex:"1 1 auto",overflow:"auto"},children:(0,ce.jsxs)(p.A,{size:"small",stickyHeader:!0,children:[(0,ce.jsx)(h.A,{children:(0,ce.jsxs)(m.A,{children:[(0,ce.jsx)(g.A,{sx:{py:.25,fontSize:"0.8125rem",backgroundColor:e=>e.palette.background.paper},children:(0,ce.jsx)(l.A,{sx:{display:"flex",alignItems:"center",gap:1},children:L("jobs.runName")})}),(0,ce.jsx)(g.A,{sx:{py:.25,fontSize:"0.8125rem",backgroundColor:e=>e.palette.background.paper},children:L("jobs.status")}),(0,ce.jsx)(g.A,{sx:{py:.25,fontSize:"0.8125rem",backgroundColor:e=>e.palette.background.paper},children:L("jobs.duration")}),(0,ce.jsx)(g.A,{sx:{py:.25,fontSize:"0.8125rem",backgroundColor:e=>e.palette.background.paper},children:L("jobs.date")}),(0,ce.jsx)(g.A,{sx:{py:.25,fontSize:"0.8125rem",backgroundColor:e=>e.palette.background.paper,textAlign:"center"},children:L("jobs.actions")})]})}),(0,ce.jsx)(x.A,{children:Array.from({length:3},(e,t)=>(0,ce.jsxs)(m.A,{children:[(0,ce.jsx)(g.A,{sx:{py:.25,fontSize:"0.75rem"},children:(0,ce.jsx)(l.A,{sx:{height:"1rem",backgroundColor:e=>e.palette.action.hover,borderRadius:"4px",animation:"pulse 1.5s ease-in-out infinite","@keyframes pulse":{"0%":{opacity:1},"50%":{opacity:.4},"100%":{opacity:1}}}})}),(0,ce.jsx)(g.A,{sx:{py:.25,fontSize:"0.75rem"},children:(0,ce.jsx)(l.A,{sx:{height:"1.5rem",width:"60px",backgroundColor:e=>e.palette.action.hover,borderRadius:"12px",animation:"pulse 1.5s ease-in-out infinite","@keyframes pulse":{"0%":{opacity:1},"50%":{opacity:.4},"100%":{opacity:1}}}})}),(0,ce.jsx)(g.A,{sx:{py:.25,fontSize:"0.75rem"},children:(0,ce.jsx)(l.A,{sx:{height:"1rem",width:"40px",backgroundColor:e=>e.palette.action.hover,borderRadius:"4px",animation:"pulse 1.5s ease-in-out infinite","@keyframes pulse":{"0%":{opacity:1},"50%":{opacity:.4},"100%":{opacity:1}}}})}),(0,ce.jsx)(g.A,{sx:{py:.25,fontSize:"0.75rem"},children:(0,ce.jsx)(l.A,{sx:{height:"1rem",width:"80px",backgroundColor:e=>e.palette.action.hover,borderRadius:"4px",animation:"pulse 1.5s ease-in-out infinite","@keyframes pulse":{"0%":{opacity:1},"50%":{opacity:.4},"100%":{opacity:1}}}})}),(0,ce.jsx)(g.A,{sx:{py:.25,fontSize:"0.75rem"},children:(0,ce.jsx)(l.A,{sx:{height:"1rem",width:"50px",backgroundColor:e=>e.palette.action.hover,borderRadius:"4px",animation:"pulse 1.5s ease-in-out infinite","@keyframes pulse":{"0%":{opacity:1},"50%":{opacity:.4},"100%":{opacity:1}}}})}),(0,ce.jsx)(g.A,{sx:{py:.25,fontSize:"0.75rem",textAlign:"center"},children:(0,ce.jsx)(l.A,{sx:{height:"1.5rem",width:"60px",backgroundColor:e=>e.palette.action.hover,borderRadius:"4px",animation:"pulse 1.5s ease-in-out infinite","@keyframes pulse":{"0%":{opacity:1},"50%":{opacity:.4},"100%":{opacity:1}},margin:"0 auto"}})})]},"skeleton-".concat(t)))})]})})})}):U?(0,ce.jsx)(f.A,{severity:"error",sx:{mb:2},children:U}):(0,ce.jsx)(ce.Fragment,{children:(0,ce.jsx)(c.A,{sx:{boxShadow:"none",height:"100%"},children:(0,ce.jsxs)(d.A,{sx:{p:0,height:"100%","&:last-child":{pb:0},display:"flex",flexDirection:"column"},children:[(0,ce.jsx)(u.A,{sx:{flex:"1 1 auto",overflow:"auto"},children:(0,ce.jsxs)(p.A,{size:"small",stickyHeader:!0,children:[(0,ce.jsx)(h.A,{children:(0,ce.jsxs)(m.A,{children:[(0,ce.jsx)(g.A,{sx:{py:.25,fontSize:"0.8125rem",backgroundColor:e=>e.palette.background.paper},children:(0,ce.jsxs)(l.A,{sx:{display:"flex",alignItems:"center",gap:1},children:[L("runHistory.columns.jobId"),(0,ce.jsx)(y.A,{title:L("runHistory.filter"),children:(0,ce.jsx)(b.A,{size:"small",onClick:e=>{Ke(e.currentTarget),setTimeout(()=>{qe.current&&qe.current.focus()},150)},sx:{p:.25,color:M?e=>e.palette.primary.main:"inherit"},"aria-describedby":kt,children:(0,ce.jsx)(_.A,{sx:{fontSize:"1rem"}})})}),(0,ce.jsx)(j.Ay,{id:kt,open:St,anchorEl:Ve,onClose:wt,anchorOrigin:{vertical:"bottom",horizontal:"left"},children:(0,ce.jsx)(l.A,{sx:{p:1.5},onKeyDown:e=>{e.stopPropagation()},children:(0,ce.jsx)(A.A,{inputRef:qe,size:"small",placeholder:L("runHistory.search"),variant:"outlined",value:M,onChange:Z,onKeyDown:e=>{e.stopPropagation(),"Escape"===e.key&&wt()},InputProps:{startAdornment:(0,ce.jsx)(v.A,{position:"start",children:(0,ce.jsx)(k.A,{fontSize:"small"})})},sx:{width:"200px"}})})})]})}),(0,ce.jsx)(g.A,{sx:{py:.25,fontSize:"0.8125rem",cursor:"pointer",backgroundColor:e=>e.palette.background.paper},onClick:()=>ne("status"),children:(0,ce.jsxs)(l.A,{sx:{display:"flex",alignItems:"center",gap:.5},children:[L("runHistory.columns.status"),_t("status")]})}),(0,ce.jsx)(g.A,{sx:{py:.25,fontSize:"0.8125rem",backgroundColor:e=>e.palette.background.paper,textAlign:"center"},children:"Agents/Tasks"}),(0,ce.jsx)(g.A,{sx:{py:.25,fontSize:"0.8125rem",backgroundColor:e=>e.palette.background.paper},children:"Submitter"}),(0,ce.jsx)(g.A,{sx:{py:.25,fontSize:"0.8125rem",cursor:"pointer",backgroundColor:e=>e.palette.background.paper},onClick:()=>ne("created_at"),children:(0,ce.jsxs)(l.A,{sx:{display:"flex",alignItems:"center",gap:.5},children:[L("runHistory.columns.startTime"),_t("created_at")]})}),(0,ce.jsx)(g.A,{sx:{py:.25,fontSize:"0.8125rem",backgroundColor:e=>e.palette.background.paper},children:"Duration"}),(0,ce.jsx)(g.A,{sx:{py:.25,fontSize:"0.8125rem",backgroundColor:e=>e.palette.background.paper,textAlign:"center"},children:"Result"}),(0,ce.jsx)(g.A,{sx:{py:.25,fontSize:"0.8125rem",backgroundColor:e=>e.palette.background.paper,textAlign:"center"},children:"Trace"}),(0,ce.jsx)(g.A,{sx:{py:.25,fontSize:"0.8125rem",backgroundColor:e=>e.palette.background.paper,textAlign:"center"},children:"Schedule Execution"}),(0,ce.jsx)(g.A,{sx:{py:.25,fontSize:"0.8125rem",width:"120px",backgroundColor:e=>e.palette.background.paper},children:(0,ce.jsxs)(l.A,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",position:"relative","&:hover .delete-all-button, &:hover .settings-button":{opacity:1,visibility:"visible"}},children:[(0,ce.jsx)(l.A,{children:L("runHistory.columns.actions")}),(0,ce.jsx)(l.A,{sx:{display:"flex",gap:.5},children:"operator"!==N&&(0,ce.jsx)(y.A,{title:L("runHistory.deleteAllRuns"),children:(0,ce.jsx)(b.A,{className:"delete-all-button",size:"small",color:"error",onClick:()=>je(!0),disabled:0===H.length,sx:{height:"20px",width:"20px",p:.25,opacity:0,visibility:"hidden",transition:"opacity 0.2s ease-in-out, visibility 0.2s ease-in-out","&.Mui-disabled":{opacity:0,visibility:"hidden"}},children:(0,ce.jsx)(S.A,{sx:{fontSize:"0.875rem"}})})})})]})})]})}),(0,ce.jsx)(x.A,{children:0===gt.length?(0,ce.jsx)(m.A,{children:(0,ce.jsx)(g.A,{colSpan:10,align:"center",sx:{py:1,fontSize:"0.8125rem"},children:L(M?"runHistory.noSearchResults":"runHistory.noRuns")})}):gt.map(e=>{var t,n,o;return(0,ce.jsxs)(m.A,{sx:{transition:"all 0.2s ease-in-out","&:hover":{backgroundColor:e=>e.palette.action.hover},"& td":{py:.25,fontSize:"0.8125rem"}},children:[(0,ce.jsx)(g.A,{children:null!==(t=e.run_name)&&void 0!==t&&t.startsWith('"')&&null!==(n=e.run_name)&&void 0!==n&&n.endsWith('"')?e.run_name.slice(1,-1):e.run_name}),(0,ce.jsx)(g.A,{children:(0,ce.jsx)(ut,{status:e.status,size:"small"})}),(0,ce.jsx)(g.A,{align:"center",children:(()=>{let t=0,n=0,o=!1;try{var r,s;if(null!==(r=e.inputs)&&void 0!==r&&r.agents_yaml&&"object"===typeof e.inputs.agents_yaml)t=Object.keys(e.inputs.agents_yaml).length,o=!0;else if(e.agents_yaml){const n="string"===typeof e.agents_yaml?JSON.parse(e.agents_yaml):e.agents_yaml;t=Object.keys(n).length,o=!0}if(null!==(s=e.inputs)&&void 0!==s&&s.tasks_yaml&&"object"===typeof e.inputs.tasks_yaml)n=Object.keys(e.inputs.tasks_yaml).length,o=!0;else if(e.tasks_yaml){const t="string"===typeof e.tasks_yaml?JSON.parse(e.tasks_yaml):e.tasks_yaml;n=Object.keys(t).length,o=!0}}catch(i){}return o&&(t>0||n>0)?(0,ce.jsx)(a.A,{label:"".concat(t,"/").concat(n),size:"small",variant:"outlined",sx:{height:"20px",minWidth:"45px","& .MuiChip-label":{px:.75,fontSize:"0.75rem",fontWeight:600},borderColor:e=>e.palette.divider}}):(0,ce.jsx)("span",{style:{color:"#999",fontSize:"0.75rem"},children:"-"})})()}),(0,ce.jsx)(g.A,{children:e.group_email||"-"}),(0,ce.jsx)(g.A,{children:new Date(e.created_at).toLocaleString()}),(0,ce.jsx)(g.A,{children:(0,ce.jsx)(ht,{run:e})}),(0,ce.jsx)(g.A,{align:"center",children:(0,ce.jsx)(y.A,{title:L("runHistory.actions.viewResult"),children:(0,ce.jsx)("span",{children:(0,ce.jsx)(b.A,{size:"small",onClick:()=>bt(e),color:"primary",disabled:["running","pending","queued","in_progress"].includes((null===(o=e.status)||void 0===o?void 0:o.toLowerCase())||""),children:(0,ce.jsx)(T.A,{fontSize:"small"})})})})}),(0,ce.jsx)(g.A,{align:"center",children:(0,ce.jsx)(y.A,{title:L("runHistory.actions.viewTrace"),children:(0,ce.jsx)(b.A,{size:"small",onClick:()=>yt(e.id),color:"primary",children:(0,ce.jsx)(R.A,{fontSize:"small"})})})}),(0,ce.jsx)(g.A,{align:"center",children:(0,ce.jsx)(y.A,{title:L("runHistory.actions.schedule"),children:(0,ce.jsx)(b.A,{size:"small",onClick:()=>vt(e),color:"primary",children:(0,ce.jsx)(z.A,{fontSize:"small"})})})}),(0,ce.jsx)(g.A,{children:(0,ce.jsx)(Ye,{run:e,onViewResult:bt,onShowTrace:yt,onShowLogs:At,onSchedule:vt,onDelete:jt,onStatusChange:(e,t)=>{$()}})})]},"".concat(e.id,"-").concat(e.status))})})]})}),xt>1&&(0,ce.jsx)(l.A,{sx:{display:"flex",justifyContent:"center",py:.25,borderTop:1,borderColor:"divider",flex:"0 0 auto"},children:(0,ce.jsx)(w.A,{count:xt,page:et,onChange:(e,t)=>tt(t),color:"primary",size:"small",sx:{"& .MuiPaginationItem-root":{minWidth:"20px",height:"20px",fontSize:"0.7rem"}}})}),he&&(0,ce.jsx)(de,{open:fe,onClose:()=>{ye(!1),me(null),xe(null),$().catch(e=>{})},runId:he,run:ge||void 0,onViewResult:bt,onShowLogs:At}),we&&Ce&&(0,ce.jsx)(re.A,{open:we,onClose:()=>{Ce&&(se.m.disconnectFromJobLogs(Ce),Ee(null));const{clearTaskStates:e}=ot.useTaskExecutionStore.getState();e(),Se(!1),_e([]),$().catch(e=>{})},logs:ke,jobId:Ce,isConnecting:Te,connectionError:ze}),(0,ce.jsx)(nt,{deleteDialogOpen:be,deleteLoading:Ae,scheduleDialogOpen:De,scheduleName:Pe,cronExpression:Ue,scheduleNameInputRef:Ge,deleteRunDialogOpen:$e,onCloseDeleteDialog:()=>je(!1),onCloseScheduleDialog:()=>{Ie(!1),Be(""),Je("0 0 * * *"),Me(null)},onCloseDeleteRunDialog:()=>Qe(!1),onDeleteAllRuns:async()=>{try{ve(!0),await X(),je(!1)}finally{ve(!1)}},onDeleteRun:async()=>{if(Ze)try{ve(!0),await ee(Ze.id),Qe(!1),Xe(null)}catch(e){We.oR.error(L("runHistory.deleteRunError"))}finally{ve(!1)}},onScheduleJob:async()=>{var e,t;if(!Oe||!Pe||!Ue)return void We.oR.error("Please fill in all required fields");let n=null,o=null;if(null!==(e=Oe.inputs)&&void 0!==e&&e.agents_yaml&&(n=Oe.inputs.agents_yaml),null!==(t=Oe.inputs)&&void 0!==t&&t.tasks_yaml&&(o=Oe.inputs.tasks_yaml),!n&&Oe.agents_yaml)try{n="string"===typeof Oe.agents_yaml?JSON.parse(Oe.agents_yaml):Oe.agents_yaml}catch(a){}if(!o&&Oe.tasks_yaml)try{o="string"===typeof Oe.tasks_yaml?JSON.parse(Oe.tasks_yaml):Oe.tasks_yaml}catch(a){}let r="",s="";if(n&&o&&Object.keys(n).length>0&&Object.keys(o).length>0){r=JSON.stringify(n),s=JSON.stringify(o);try{const e={name:Pe,cron_expression:Ue,agents_yaml:JSON.parse(r||"{}"),tasks_yaml:JSON.parse(s||"{}"),inputs:{},is_active:!0,planning:!1};await I.l.createSchedule(e),Ie(!1),Me(null),Be(""),Je("0 0 * * *")}catch(U){We.oR.error("Failed to schedule job")}}else We.oR.error("\u274c Cannot schedule: This execution is missing its agent and task configuration. Please create a new execution with proper configuration instead.",{duration:1e4})},onScheduleNameChange:e=>Be(e.target.value),onCronExpressionChange:e=>Je(e.target.value)}),(0,ce.jsx)(Fe,{open:F&&!!O,onClose:W,result:ft,run:O||void 0})]})})})});mt.displayName="History";const gt=mt}}]);