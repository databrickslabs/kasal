"use strict";(self.webpackChunkfrontend=self.webpackChunkfrontend||[]).push([[469,722],{11625:(e,t,n)=>{n.d(t,{A:()=>k});var a=n(9950),s=n(63464),i=n(40033),o=n(82053),r=n(16491),l=n(25277),c=n(28170),d=n(65429),u=n(18216),h=n(33738),m=n(249),g=n(26050),p=n(83563),x=n(74745),f=n(79739),y=n(73175),b=n(33893),v=n(18726),A=n(13246),j=n(44414);const w={FileReadTool:{riskLevel:"CRITICAL",description:"Can read files within the container filesystem",risks:["Path traversal attacks (../../../etc/passwd)","Access to other users' sensitive files","Reading system configuration files","Exposure of API keys, passwords, and secrets","No tenant isolation in multi-user environments"],mitigations:["Restrict to specific directories only","Implement path validation and sanitization","Use sandboxed file access","Add audit logging for all file reads"],singleTenantRiskLevel:"LOW",singleTenantRisks:["Can read files within user's dedicated container","Access to user's workspace files and configurations","Reading of temporary files and logs within container"],singleTenantMitigations:["Container runs with non-root user privileges","Filesystem isolated to user's container only","API keys managed through secure backend service","No access to other users or system files"],deploymentContext:"Single-tenant containerized deployment on Databricks"},FileWriterTool:{riskLevel:"CRITICAL",description:"Can write/overwrite files anywhere on the system",risks:["Overwrite critical system files","Create malicious executable files","Modify other users' data","Path traversal for unauthorized file creation","No size limits or content validation"],mitigations:["Restrict write operations to specific directories","Implement file size and content validation","Use sandboxed file system access","Add malware scanning for uploaded content"],singleTenantRiskLevel:"LOW",singleTenantRisks:["Can write files within user's container workspace","Potential to fill container disk space"],singleTenantMitigations:["Container filesystem isolation","Non-root user privileges","Disk quotas prevent space exhaustion"],deploymentContext:"Single-tenant containerized deployment"},CodeInterpreterTool:{riskLevel:"CRITICAL",description:"Executes arbitrary Python code with potential system access",risks:["Arbitrary code execution on host system","Network access to internal systems","File system manipulation","Process spawning and system commands","Installation of malicious packages"],mitigations:["Use containerized execution environment","Implement strict resource limits","Block network access and system calls","Use read-only file systems"],singleTenantRiskLevel:"MEDIUM",singleTenantRisks:["Code execution within container sandbox","Resource consumption (CPU, memory)","Network requests to external services"],singleTenantMitigations:["Sandboxed execution environment","Resource limits enforced","Network access controlled","Non-persistent container state"],deploymentContext:"Single-tenant containerized deployment"},DirectoryReadTool:{riskLevel:"CRITICAL",description:"Can read and traverse any directory structure",risks:["Exposure of directory structures and file paths","Discovery of hidden files and folders","Access to other users' directory listings","Information gathering for further attacks"],mitigations:["Restrict to user-specific directories","Implement path validation","Add access control checks"],singleTenantRiskLevel:"LOW",singleTenantRisks:["Can list directories within user's container","Access to container workspace structure"],singleTenantMitigations:["Container filesystem isolation","Non-root user privileges","Limited to user's workspace"],deploymentContext:"Single-tenant containerized deployment"},DatabricksJobsTool:{riskLevel:"HIGH",description:"Manages Databricks Jobs with create, run, and monitor capabilities",risks:["Creation of arbitrary compute jobs","Resource consumption through job execution","Access to job configurations and outputs","Potential for running malicious code via jobs","Cross-tenant job visibility without proper filtering"],mitigations:["Validate job configurations before creation","Implement job resource limits and quotas","Add job approval workflows for sensitive operations","Monitor job execution patterns for anomalies"],singleTenantRiskLevel:"MEDIUM",singleTenantRisks:["Job creation and execution within user's workspace","Compute resource usage based on job configurations","Access to job outputs and logs","Potential for expensive compute operations"],singleTenantMitigations:["Databricks OBO ensures jobs run with user's permissions","User can only manage jobs they have access to","Databricks enforces compute resource limits","Job execution is logged and auditable","Workspace-level security policies apply"],deploymentContext:"Single-tenant with Databricks OBO security model"},GenieTool:{riskLevel:"HIGH",description:"Natural language interface to Databricks Genie AI assistant",risks:["Unrestricted natural language queries to database","Potential for complex data aggregations","Access to sensitive data through conversational interface","Query interpretation may expose unexpected data"],mitigations:["Implement query complexity limits","Add data access monitoring","Review query translations before execution","Use read-only database connections where possible"],singleTenantRiskLevel:"LOW",singleTenantRisks:["Natural language queries within user's data scope","Potential for unintended data exposure through AI interpretation","Performance impact from complex generated queries"],singleTenantMitigations:["Databricks OBO ensures queries run with user's permissions only","Genie AI respects existing data access controls","Query execution limited to user's authorized datasets","All interactions logged and auditable"],deploymentContext:"Single-tenant with Databricks OBO and Genie AI security"},NL2SQLTool:{riskLevel:"CRITICAL",description:"Converts natural language to SQL with injection risks",risks:["SQL injection through natural language manipulation","Unrestricted database access","Data exfiltration across tenant boundaries","Expensive query execution"],mitigations:["Use parameterized queries","Implement query whitelisting","Add tenant isolation filters","Monitor and limit query complexity"],singleTenantRiskLevel:"MEDIUM",singleTenantRisks:["SQL injection if NL parsing is compromised","Access to database within user permissions","Potential for complex expensive queries"],singleTenantMitigations:["Database access limited to user permissions","Query complexity monitoring","Parameterized query generation","Database connection limits"],deploymentContext:"Single-tenant with database access controls"},SeleniumScrapingTool:{riskLevel:"HIGH",description:"Full browser automation with web interaction capabilities",risks:["Automated interactions with any website","Cookie and session manipulation","Form submission with arbitrary data","Download of potentially malicious content"],mitigations:["Implement strict URL validation","Use sandboxed browser environment","Add content filtering and scanning","Limit interaction capabilities"],singleTenantRiskLevel:"MEDIUM",singleTenantRisks:["Web scraping within container environment","Network requests to external websites","Local file downloads within container"],singleTenantMitigations:["Container network controls","File downloads isolated to container","Browser runs in sandboxed environment","Resource limits prevent abuse"],deploymentContext:"Single-tenant containerized deployment"},MySQLSearchTool:{riskLevel:"HIGH",description:"Direct MySQL database access without tenant filtering",risks:["Cross-tenant data access","Potential for SQL injection","Unauthorized database operations","Performance impact from expensive queries"],mitigations:["Implement tenant-based access controls","Use read-only database connections","Add query validation and sanitization","Monitor database access patterns"],singleTenantRiskLevel:"MEDIUM",singleTenantRisks:["Database access within user permissions","Potential for expensive queries","MySQL connection resource usage"],singleTenantMitigations:["Database user permissions control access","Connection pooling and limits","Query timeout enforcement","API key service manages credentials"],deploymentContext:"Single-tenant with API key service"},PGSearchTool:{riskLevel:"HIGH",description:"Direct PostgreSQL database access without restrictions",risks:["Unrestricted database query execution","Cross-tenant data exposure","Performance degradation from complex queries","Access to system tables and metadata"],mitigations:["Implement row-level security","Use dedicated read-only database user","Add query complexity limits","Enable comprehensive audit logging"],singleTenantRiskLevel:"MEDIUM",singleTenantRisks:["PostgreSQL access within user permissions","Complex query execution","Database resource consumption"],singleTenantMitigations:["Database role-based access controls","Connection limits and timeouts","Query monitoring and limits","Secure credential management"],deploymentContext:"Single-tenant with API key service"},CSVSearchTool:{riskLevel:"MEDIUM",description:"Searches within CSV files with potential path traversal",risks:["Access to CSV files outside intended scope","Exposure of structured data across tenants","Path traversal to unauthorized files"],mitigations:["Restrict file access to specific directories","Validate file paths and extensions","Implement user-based access controls"],singleTenantRiskLevel:"LOW",singleTenantRisks:["Access to CSV files within user's container workspace","File content exposure limited to user's data"],singleTenantMitigations:["Container filesystem isolation","Non-root user privileges","File access limited to user workspace"],deploymentContext:"Single-tenant containerized deployment"},JSONSearchTool:{riskLevel:"MEDIUM",description:"Accesses JSON files potentially containing sensitive data",risks:["Exposure of configuration files","Access to API keys in JSON format","Cross-tenant file access"],mitigations:["Sanitize sensitive data from results","Restrict to approved file locations","Add content filtering"],singleTenantRiskLevel:"LOW",singleTenantRisks:["Access to JSON files within user's container","Configuration file exposure limited to user scope"],singleTenantMitigations:["API keys managed through secure backend service","Container filesystem isolation","Non-root user privileges"],deploymentContext:"Single-tenant containerized deployment"},DirectorySearchTool:{riskLevel:"HIGH",description:"Searches directory structures without path restrictions",risks:["Discovery of hidden files and directories","Mapping of system file structures","Information gathering for targeted attacks","Cross-tenant directory access"],mitigations:["Restrict to user-specific directories only","Implement path validation and sanitization","Add audit logging for directory searches"],singleTenantRiskLevel:"LOW",singleTenantRisks:["Directory structure discovery within user container","Access to user workspace file organization"],singleTenantMitigations:["Container filesystem isolation","Non-root user privileges","Limited to user's workspace directories"],deploymentContext:"Single-tenant containerized deployment"},TXTSearchTool:{riskLevel:"MEDIUM",description:"Searches text files that may contain sensitive information",risks:["Access to log files containing secrets","Reading configuration files with credentials","Cross-tenant file access","Exposure of debugging information"],mitigations:["Restrict file access to approved directories","Filter out sensitive content from results","Implement content scanning and sanitization"],singleTenantRiskLevel:"LOW",singleTenantRisks:["Access to text files within user container","Log file access limited to user's processes","Configuration exposure within user scope"],singleTenantMitigations:["Container filesystem isolation","API keys managed through secure backend service","Non-root user privileges","Content limited to user workspace"],deploymentContext:"Single-tenant containerized deployment"},PDFSearchTool:{riskLevel:"MEDIUM",description:"Searches PDF documents that may contain sensitive data",risks:["Access to confidential documents","Cross-tenant document access","Exposure of embedded metadata","Access to password-protected content"],mitigations:["Implement document access controls","Strip metadata from search results","Add content filtering capabilities"],singleTenantRiskLevel:"LOW",singleTenantRisks:["Access to PDF documents within user container","Document metadata exposure limited to user files","Content access within user workspace"],singleTenantMitigations:["Container filesystem isolation","Non-root user privileges","Document access limited to user workspace","No cross-tenant document exposure"],deploymentContext:"Single-tenant containerized deployment"},DOCXSearchTool:{riskLevel:"MEDIUM",description:"Searches Word documents potentially containing sensitive data",risks:["Access to business-critical documents","Exposure of document metadata and history","Cross-tenant document access","Reading embedded objects and macros"],mitigations:["Restrict to approved document repositories","Sanitize document metadata","Implement virus scanning for macros"],singleTenantRiskLevel:"LOW",singleTenantRisks:["Access to Word documents within user container","Document metadata exposure limited to user files","Macro execution within sandboxed environment"],singleTenantMitigations:["Container filesystem isolation","Non-root user privileges","Document access limited to user workspace","Macro execution in controlled environment"],deploymentContext:"Single-tenant containerized deployment"},XMLSearchTool:{riskLevel:"MEDIUM",description:"Searches XML files including configuration and data files",risks:["Access to application configuration files","Exposure of API endpoints and credentials","Reading database connection strings","Access to structured sensitive data"],mitigations:["Implement XML content filtering","Restrict to non-sensitive XML files","Sanitize credential information"],singleTenantRiskLevel:"LOW",singleTenantRisks:["Access to XML files within user container","Configuration file exposure limited to user scope","Structured data access within user workspace"],singleTenantMitigations:["Container filesystem isolation","API keys managed through secure backend service","Non-root user privileges","XML content limited to user workspace"],deploymentContext:"Single-tenant containerized deployment"},SnowflakeSearchTool:{riskLevel:"HIGH",description:"Direct Snowflake data warehouse access without tenant filtering",risks:["Cross-tenant data warehouse access","Exposure of enterprise data analytics","Unauthorized query execution on large datasets","Performance impact from expensive operations"],mitigations:["Implement row-level security policies","Use role-based access controls","Add query monitoring and limits","Enable comprehensive audit logging"],singleTenantRiskLevel:"MEDIUM",singleTenantRisks:["Snowflake access within user permissions","Query execution on authorized datasets","Performance impact from complex queries","Data warehouse resource consumption"],singleTenantMitigations:["Snowflake role-based access controls","API key service manages credentials","Query timeout and resource limits","Connection pooling and monitoring"],deploymentContext:"Single-tenant with API key service"},QdrantVectorSearchTool:{riskLevel:"HIGH",description:"Vector database access for similarity searches",risks:["Access to vectorized sensitive data","Cross-tenant vector space access","Potential for data inference attacks","Exposure of ML model embeddings"],mitigations:["Implement vector space isolation","Add tenant-based filtering","Monitor similarity search patterns"],singleTenantRiskLevel:"MEDIUM",singleTenantRisks:["Vector database access within user permissions","Similarity searches on user's vector collections","ML model embedding exposure within user scope"],singleTenantMitigations:["Vector database access controls","API key service manages credentials","Collection-level access restrictions","Query monitoring and limits"],deploymentContext:"Single-tenant with API key service"},WeaviateVectorSearchTool:{riskLevel:"HIGH",description:"Vector database operations with multi-modal search",risks:["Multi-modal data access across tenants","Exposure of knowledge graphs","Semantic search across sensitive content","Vector-based data correlation attacks"],mitigations:["Implement strict schema-based isolation","Add vector access controls","Monitor cross-modal search patterns"],singleTenantRiskLevel:"MEDIUM",singleTenantRisks:["Multi-modal vector search within user permissions","Knowledge graph access limited to user's data","Semantic search on authorized content"],singleTenantMitigations:["Weaviate schema-based access controls","API key service manages credentials","User-specific vector collections","Query monitoring and resource limits"],deploymentContext:"Single-tenant with API key service"}},k=e=>{let{open:t,onClose:n,onConfirm:k,tool:C}=e;const[S,_]=(0,a.useState)(!1);if(!C)return null;const E=w[C.title]||{riskLevel:"MEDIUM",description:"This tool may pose security risks in multi-tenant environments",risks:["Potential for unauthorized access","May affect other users"],mitigations:["Monitor usage carefully","Implement proper access controls"],singleTenantRiskLevel:"LOW",singleTenantRisks:["Limited risk in containerized single-tenant environment"],singleTenantMitigations:["Container isolation provides security boundaries"],deploymentContext:"Single-tenant containerized deployment"},I=e=>{switch(e){case"CRITICAL":return"error";case"HIGH":return"warning";case"MEDIUM":return"info";case"LOW":return"success";default:return"default"}};return(0,j.jsxs)(s.A,{open:t,onClose:n,maxWidth:"md",fullWidth:!0,PaperProps:{sx:{minHeight:"400px"}},children:[(0,j.jsxs)(i.A,{sx:{display:"flex",alignItems:"center",gap:1,pb:1},children:[(0,j.jsx)(b.A,{color:"error"}),(0,j.jsx)(o.A,{variant:"h6",children:"Security Warning"}),(0,j.jsxs)(r.A,{sx:{ml:"auto",display:"flex",gap:1},children:[(0,j.jsx)(l.A,{label:"MULTI-TENANT: "+E.riskLevel,color:I(E.riskLevel),size:"small"}),E.singleTenantRiskLevel&&(0,j.jsx)(l.A,{label:"SINGLE-TENANT: "+E.singleTenantRiskLevel,color:I(E.singleTenantRiskLevel),size:"small",variant:"outlined"})]})]}),(0,j.jsxs)(c.A,{children:[(0,j.jsxs)(d.A,{severity:"warning",sx:{mb:3},children:[(0,j.jsx)(o.A,{variant:"subtitle1",gutterBottom:!0,children:(0,j.jsxs)("strong",{children:["\u26a0\ufe0f You are about to enable: ",C.title]})}),(0,j.jsx)(o.A,{variant:"body2",sx:{mb:2},children:"This tool has security implications. Please review the risk classifications below."}),(0,j.jsxs)(r.A,{sx:{display:"flex",alignItems:"center",gap:1,mb:2},children:[(0,j.jsx)(o.A,{variant:"body2",sx:{fontWeight:"bold"},children:"Security Risk Levels:"}),(0,j.jsx)(l.A,{label:"Multi-Tenant: "+E.riskLevel,color:I(E.riskLevel),size:"small"}),(0,j.jsx)(l.A,{label:"Single-Tenant: "+(E.singleTenantRiskLevel||"LOW"),color:I(E.singleTenantRiskLevel||"LOW"),size:"small",variant:"outlined"})]}),(0,j.jsx)(u.A,{onClick:()=>_(!S),startIcon:S?(0,j.jsx)(A.A,{}):(0,j.jsx)(v.A,{}),size:"small",sx:{mt:1},children:S?"Hide Details":"Show Security Details"})]}),(0,j.jsx)(h.A,{in:S,children:(0,j.jsxs)(r.A,{sx:{mb:3},children:[E.deploymentContext&&(0,j.jsxs)(o.A,{variant:"body2",sx:{mb:2,fontStyle:"italic",color:"text.secondary"},children:["Deployment Context: ",E.deploymentContext]}),(0,j.jsxs)(r.A,{sx:{mb:3},children:[(0,j.jsxs)(o.A,{variant:"h6",color:"error",gutterBottom:!0,sx:{display:"flex",alignItems:"center",gap:1},children:[(0,j.jsx)(y.A,{})," Multi-Tenant Security Risks"]}),(0,j.jsx)(m.A,{dense:!0,children:E.risks.map((e,t)=>(0,j.jsx)(g.Ay,{sx:{py:.5},children:(0,j.jsx)(p.A,{primary:"\u2022 "+e,sx:{color:"error.main"}})},t))})]}),E.singleTenantRisks&&(0,j.jsxs)(r.A,{sx:{mb:3},children:[(0,j.jsx)(o.A,{variant:"h6",color:"info.main",gutterBottom:!0,sx:{display:"flex",alignItems:"center",gap:1},children:"\u{1f4e6} Single-Tenant Containerized Risks"}),(0,j.jsx)(m.A,{dense:!0,children:E.singleTenantRisks.map((e,t)=>(0,j.jsx)(g.Ay,{sx:{py:.5},children:(0,j.jsx)(p.A,{primary:"\u2022 "+e,sx:{color:"info.main"}})},t))})]}),(0,j.jsx)(x.A,{sx:{my:2}}),(0,j.jsxs)(r.A,{sx:{mb:2},children:[(0,j.jsx)(o.A,{variant:"h6",color:"success.main",gutterBottom:!0,children:"\u{1f6e1}\ufe0f General Security Mitigations"}),(0,j.jsx)(m.A,{dense:!0,children:E.mitigations.map((e,t)=>(0,j.jsx)(g.Ay,{sx:{py:.5},children:(0,j.jsx)(p.A,{primary:"\u2022 "+e,sx:{color:"text.secondary"}})},t))})]}),E.singleTenantMitigations&&(0,j.jsxs)(r.A,{sx:{mb:2},children:[(0,j.jsx)(o.A,{variant:"h6",color:"success.main",gutterBottom:!0,children:"\u2705 Container Security Mitigations"}),(0,j.jsx)(m.A,{dense:!0,children:E.singleTenantMitigations.map((e,t)=>(0,j.jsx)(g.Ay,{sx:{py:.5},children:(0,j.jsx)(p.A,{primary:"\u2022 "+e,sx:{color:"success.main"}})},t))})]})]})}),(0,j.jsxs)(d.A,{severity:"error",sx:{mt:3},children:[(0,j.jsx)(o.A,{variant:"body2",children:(0,j.jsx)("strong",{children:"By enabling this tool, you acknowledge that:"})}),(0,j.jsxs)(o.A,{variant:"body2",component:"ul",sx:{mt:1,mb:0},children:[(0,j.jsx)("li",{children:"You understand the security risks associated with this tool"}),(0,j.jsx)("li",{children:"You will monitor its usage in your environment"}),(0,j.jsx)("li",{children:"You are responsible for implementing appropriate security controls"}),(0,j.jsx)("li",{children:"This tool may access sensitive data or system resources"})]})]})]}),(0,j.jsxs)(f.A,{sx:{px:3,pb:3},children:[(0,j.jsx)(u.A,{onClick:n,variant:"outlined",children:"Cancel"}),(0,j.jsx)(u.A,{onClick:k,variant:"contained",color:"warning",startIcon:(0,j.jsx)(b.A,{}),children:"I Understand the Risks - Enable Tool"})]})]})}},19258:(e,t,n)=>{n.r(t),n.d(t,{default:()=>Xr});var a=n(98587),s=n(9950),i=(n(522),n(16491)),o=n(63464),r=n(28170),l=n(40033),c=n(82053),d=n(25333),u=n(4862),h=n(65429),m=n(70610),g=n(18216),p=n(60788),x=n(19597);const f=()=>(()=>{const{currentTheme:e,isDarkMode:t,toggleTheme:n,changeTheme:a}=(0,x.C)();return{currentTheme:e,isDarkMode:t,toggleTheme:n,changeTheme:a}})();var y=n(9992),b=n(67818);var v=n(2257),A=n(19458),j=n(11758),w=n(72842);const k=(0,A.vt)()((0,j.Zr)((e,t)=>({tabs:[],activeTabId:null,createTab:n=>{const a=(0,w.A)(),s=n||"Canvas "+(t().tabs.length+1),i={id:a,name:s,nodes:[],edges:[],isActive:!0,isDirty:!1,createdAt:new Date,lastModified:new Date,chatSessionId:(0,w.A)()};return e(e=>({tabs:[...e.tabs.map(e=>Object.assign({},e,{isActive:!1})),i],activeTabId:a})),setTimeout(()=>{window.dispatchEvent(new CustomEvent("clearCanvas",{detail:{tabId:a}}))},0),a},closeTab:t=>{e(e=>{const n=e.tabs.findIndex(e=>e.id===t);if(-1===n)return e;const a=e.tabs.filter(e=>e.id!==t);let s=e.activeTabId;if(e.activeTabId===t)if(a.length>0){var i;s=(null==(i=a[n>0?n-1:0])?void 0:i.id)||null,a.forEach(e=>{e.isActive=e.id===s})}else s=null;return{tabs:a,activeTabId:s}})},setActiveTab:t=>{e(e=>({tabs:e.tabs.map(e=>Object.assign({},e,{isActive:e.id===t})),activeTabId:t}))},updateTabName:(t,n)=>{e(e=>({tabs:e.tabs.map(e=>e.id===t?Object.assign({},e,{name:n,lastModified:new Date}):e)}))},updateTabNodes:(t,n)=>{e(e=>{const a=e.tabs.find(e=>e.id===t);if(!a)return e;const s=((e,t)=>{if(e.length!==t.length)return!0;const n=new Map(e.map(e=>[e.id,e])),a=new Map(t.map(e=>[e.id,e]));if(n.size!==a.size)return!0;for(const s of t){const e=n.get(s.id);if(!e)return!0;if(e.type!==s.type||Math.abs(e.position.x-s.position.x)>.1||Math.abs(e.position.y-s.position.y)>.1||JSON.stringify(e.data)!==JSON.stringify(s.data))return!0}return!1})(a.nodes,n),i=s&&(!a.savedCrewId||a.isDirty),o=s&&a.executionStatus;return{tabs:e.tabs.map(e=>e.id===t?Object.assign({},e,{nodes:n.map(e=>Object.assign({},e,{position:Object.assign({},e.position),data:Object.assign({},e.data)})),isDirty:i,lastModified:new Date,executionStatus:o?void 0:e.executionStatus,lastExecutionTime:o?void 0:e.lastExecutionTime}):e)}})},updateTabEdges:(t,n)=>{e(e=>{const a=e.tabs.find(e=>e.id===t);if(!a)return e;const s=((e,t)=>{if(e.length!==t.length)return!0;const n=new Map(e.map(e=>[e.id,e])),a=new Map(t.map(e=>[e.id,e]));if(n.size!==a.size)return!0;for(const s of t){const e=n.get(s.id);if(!e)return!0;if(e.source!==s.source||e.target!==s.target||e.type!==s.type||JSON.stringify(e.data)!==JSON.stringify(s.data))return!0}return!1})(a.edges,n),i=s&&(!a.savedCrewId||a.isDirty),o=s&&a.executionStatus;return{tabs:e.tabs.map(e=>e.id===t?Object.assign({},e,{edges:n.map(e=>Object.assign({},e,{data:e.data?Object.assign({},e.data):void 0})),isDirty:i,lastModified:new Date,executionStatus:o?void 0:e.executionStatus,lastExecutionTime:o?void 0:e.lastExecutionTime}):e)}})},markTabDirty:t=>{e(e=>({tabs:e.tabs.map(e=>e.id===t?Object.assign({},e,{isDirty:!0,lastModified:new Date}):e)}))},markTabClean:t=>{e(e=>({tabs:e.tabs.map(e=>e.id===t?Object.assign({},e,{isDirty:!1}):e)}))},duplicateTab:n=>{const a=t().getTab(n);if(!a)return"";const s=(0,w.A)(),i={id:s,name:a.name+" (Copy)",nodes:a.nodes.map(e=>Object.assign({},e,{id:(0,w.A)(),selected:!1})),edges:a.edges.map(e=>Object.assign({},e,{id:(0,w.A)(),selected:!1})),isActive:!0,isDirty:!0,createdAt:new Date,lastModified:new Date,savedCrewId:void 0,savedCrewName:void 0,lastSavedAt:void 0,chatSessionId:(0,w.A)()},o=new Map;return a.nodes.forEach((e,t)=>{o.set(e.id,i.nodes[t].id)}),i.edges=i.edges.map(e=>Object.assign({},e,{source:o.get(e.source)||e.source,target:o.get(e.target)||e.target})),e(e=>({tabs:[...e.tabs.map(e=>Object.assign({},e,{isActive:!1})),i],activeTabId:s})),s},getActiveTab:()=>{const e=t();return e.tabs.find(t=>t.id===e.activeTabId)||null},getTab:e=>t().tabs.find(t=>t.id===e)||null,clearAllTabs:()=>{e({tabs:[],activeTabId:null})},updateTabCrewInfo:(t,n,a)=>{e(e=>({tabs:e.tabs.map(e=>e.id===t?Object.assign({},e,{savedCrewId:n,savedCrewName:a,lastSavedAt:new Date,isDirty:!1,name:a}):e)}))},clearTabCrewInfo:t=>{e(e=>({tabs:e.tabs.map(e=>e.id===t?Object.assign({},e,{savedCrewId:void 0,savedCrewName:void 0,lastSavedAt:void 0}):e)}))},isTabSaved:e=>{const n=t().getTab(e);return!!n&&(!n.isDirty&&!!n.savedCrewId)},updateTabExecutionStatus:(t,n)=>{e(e=>({tabs:e.tabs.map(e=>e.id===t?Object.assign({},e,{executionStatus:n,lastExecutionTime:new Date}):e)}))},clearTabExecutionStatus:t=>{e(e=>({tabs:e.tabs.map(e=>e.id===t?Object.assign({},e,{executionStatus:void 0,lastExecutionTime:void 0}):e)}))}}),{name:"tab-manager-storage",partialize:e=>({tabs:e.tabs.map(e=>{var t,n;return Object.assign({},e,{createdAt:e.createdAt.toISOString(),lastModified:e.lastModified.toISOString(),lastSavedAt:null==(t=e.lastSavedAt)?void 0:t.toISOString(),lastExecutionTime:null==(n=e.lastExecutionTime)?void 0:n.toISOString(),executionStatus:"running"===e.executionStatus?void 0:e.executionStatus})}),activeTabId:e.activeTabId}),onRehydrateStorage:()=>e=>{e&&(e.tabs=e.tabs.map(e=>Object.assign({},e,{createdAt:new Date(e.createdAt),lastModified:new Date(e.lastModified),lastSavedAt:e.lastSavedAt?new Date(e.lastSavedAt):void 0,lastExecutionTime:e.lastExecutionTime?new Date(e.lastExecutionTime):void 0})))}}));"undefined"!==typeof window&&(window.useTabManagerStore=k);var C=n(77679);const S=e=>{let{nodes:t,edges:n,setNodes:a,setEdges:i}=e;const{activeTabId:o,getActiveTab:r,updateTabNodes:l,updateTabEdges:c,updateTabCrewInfo:d}=k(),u=(0,s.useRef)(!1),h=(0,s.useRef)(!1),m=(0,s.useRef)(null),g=(0,s.useRef)([]),p=(0,s.useRef)([]);(0,s.useEffect)(()=>{h.current||(g.current=t,p.current=n)},[t,n]);const x=(0,s.useCallback)((e,t,n)=>{e&&!u.current&&(l(e,t),c(e,n))},[l,c]);(0,s.useEffect)(()=>{if(o!==m.current){if(u.current)return void(m.current=o);m.current&&!u.current&&x(m.current,g.current,p.current),h.current=!0;const e=r();if(e){const t=e.nodes.map(e=>Object.assign({},e,{position:Object.assign({},e.position),data:Object.assign({},e.data)})),n=e.edges.map(e=>Object.assign({},e,{data:e.data?Object.assign({},e.data):void 0}));u.current||(a(t),i(n),g.current=t,p.current=n,0===t.length&&0===n.length&&setTimeout(()=>{a([]),i([]),g.current=[],p.current=[]},50),setTimeout(()=>{t.length>0&&window.dispatchEvent(new CustomEvent("fitViewToNodes",{bubbles:!0}))},300),setTimeout(()=>{window.dispatchEvent(new CustomEvent("updateReactFlowInstance",{detail:{nodes:t,edges:n}}))},100)),setTimeout(()=>{h.current=!1},500)}m.current=o}},[o,r,a,i,x]);const f=(0,s.useCallback)(()=>{!o||u.current||h.current||x(o,g.current,p.current)},[o,x]);(0,s.useEffect)(()=>{const e=()=>{o&&x(o,g.current,p.current)};return window.addEventListener("beforeunload",e),()=>{window.removeEventListener("beforeunload",e)}},[o,x]);const y=(0,s.useCallback)(()=>{if(o&&!u.current&&!h.current){const e=r();e&&((e,t)=>{if(e.length!==t.length)return!0;const n=new Map(e.map(e=>[e.id,e]));for(const a of t){const e=n.get(a.id);if(!e)return!0;if(e.type!==a.type||Math.abs(e.position.x-a.position.x)>.1||Math.abs(e.position.y-a.position.y)>.1||JSON.stringify(e.data)!==JSON.stringify(a.data))return!0}return!1})(e.nodes,t)&&l(o,t)}},[t,o,l,r]),b=(0,s.useCallback)(()=>{if(o&&!u.current&&!h.current){const e=r();e&&((e,t)=>{if(e.length!==t.length)return!0;const n=new Map(e.map(e=>[e.id,e]));for(const a of t){const e=n.get(a.id);if(!e)return!0;if(e.source!==a.source||e.target!==a.target||e.type!==a.type||JSON.stringify(e.data)!==JSON.stringify(a.data))return!0}return!1})(e.edges,n)&&c(o,n)}},[n,o,c,r]);return(0,s.useEffect)(()=>{const e=setTimeout(y,300);return()=>clearTimeout(e)},[y]),(0,s.useEffect)(()=>{const e=setTimeout(b,300);return()=>clearTimeout(e)},[b]),(0,s.useEffect)(()=>{const e=e=>{if(e.detail){const{crewId:t,crewName:n,tabId:a}=e.detail,s=a||o;s&&t&&n&&!u.current?d(s,t,n):u.current}};return window.addEventListener("saveCrewComplete",e),()=>{window.removeEventListener("saveCrewComplete",e)}},[o,d]),(0,s.useEffect)(()=>{const e=()=>{u.current=!0},t=()=>{setTimeout(()=>{u.current=!1},200)};return window.addEventListener("crewLoadStarted",e),window.addEventListener("crewLoadCompleted",t),()=>{window.removeEventListener("crewLoadStarted",e),window.removeEventListener("crewLoadCompleted",t)}},[]),(0,s.useEffect)(()=>{const e=e=>{e.detail.tabId===o&&(a([]),i([]))};return window.addEventListener("clearCanvas",e),()=>{window.removeEventListener("clearCanvas",e)}},[o,a,i]),{activeTabId:o,getActiveTab:r,saveCurrentState:f}};var _=n(36873),E=n(77005);function I(e){const[t,n]=s.useState(!1),a=s.useRef(0),{chatPanelSide:i,leftSidebarBaseWidth:o}=(0,E.z)(),r=s.useCallback(e=>{e.preventDefault(),n(!0)},[]),l=s.useCallback(n=>{if(!t)return;const s=performance.now();if(s-(a.current||0)<50)return;let r;a.current=s,r="right"===i?window.innerWidth-n.clientX-48:n.clientX-o;const l=Math.min(800,.6*window.innerWidth);e(Math.min(Math.max(r,280),l));const c=new CustomEvent("recalculateNodePositions",{detail:{reason:"chat-panel-resizing"}});window.dispatchEvent(c)},[t,e,i,o]),c=s.useCallback(()=>{n(!1),setTimeout(()=>{const e=new CustomEvent("recalculateNodePositions",{detail:{reason:"chat-panel-resize"}});window.dispatchEvent(e)},50)},[]);return s.useEffect(()=>{if(t)return document.addEventListener("mousemove",l),document.addEventListener("mouseup",c),document.body.style.cursor="ew-resize",document.body.style.userSelect="none",()=>{document.removeEventListener("mousemove",l),document.removeEventListener("mouseup",c),document.body.style.cursor="",document.body.style.userSelect=""}},[t,l,c]),{handleResizeStart:r}}function T(e,t){const[n,a]=s.useState(!1),i=s.useRef(0),o=s.useCallback(e=>{e.preventDefault(),a(!0)},[]),r=s.useCallback(t=>{if(!n)return;const a=performance.now();if(a-(i.current||0)<50)return;i.current=a;const s=window.innerHeight-t.clientY,o=Math.min(500,.5*window.innerHeight);e(Math.min(Math.max(s,100),o))},[n,e]),l=s.useCallback(()=>{a(!1),t(!0)},[t]);return s.useEffect(()=>{if(n)return document.addEventListener("mousemove",r),document.addEventListener("mouseup",l),document.body.style.cursor="ns-resize",document.body.style.userSelect="none",()=>{document.removeEventListener("mousemove",r),document.removeEventListener("mouseup",l),document.body.style.cursor="",document.body.style.userSelect=""}},[n,r,l]),{handleHistoryResizeStart:o}}const D=e=>{const t=e.some(e=>"agentNode"===e.type),n=e.some(e=>"taskNode"===e.type);return t&&n},O=(e,t,n,a)=>{(e=>{const t=e.filter(e=>"agentNode"===e.type).length,n=e.filter(e=>"taskNode"===e.type).length;return t>1&&n>1})(e)?(n(e),a(t)):(n(t=>{const n=new Set(t.map(e=>e.id)),a=e.filter(e=>!n.has(e.id));return[...t,...a]}),a(e=>{const n=new Set(e.map(e=>e.source+"-"+e.target)),a=t.filter(e=>!n.has(e.source+"-"+e.target));return[...e,...a]}))};var N=n(96319),P=n(59254),M=n(83274),z=n(62145),L=n(80392),W=n(44414);const R=(0,P.Ay)(d.A)(e=>{let{theme:t}=e;return{backgroundColor:"dark"===t.palette.mode?"rgba(255,255,255,0.08)":"rgba(0,0,0,0.04)",borderRadius:"4px",padding:"4px","&:hover":{backgroundColor:"dark"===t.palette.mode?"rgba(255,255,255,0.15)":"rgba(0,0,0,0.08)"}}}),F=(0,P.Ay)(i.A)(e=>{let{theme:t}=e;return{position:"absolute",zIndex:10,display:"flex",alignItems:"center",justifyContent:"center",backgroundColor:"dark"===t.palette.mode?"rgba(0,0,0,0.6)":"rgba(255,255,255,0.8)",borderRadius:"4px",padding:"2px",boxShadow:"0 1px 3px rgba(0,0,0,0.2)"}}),B=e=>{let{isVisible:t,togglePanel:n,tooltip:a}=e;return(0,W.jsx)(F,{sx:{top:"50%",right:t?"auto":0,left:t?"calc(100% - 24px)":"auto",transform:"translateY(-50%)",transition:"left 0.3s ease, right 0.3s ease"},children:(0,W.jsx)(M.A,{title:a,children:(0,W.jsx)(R,{onClick:n,size:"small",children:t?(0,W.jsx)(L.A,{fontSize:"small"}):(0,W.jsx)(z.A,{fontSize:"small"})})})})};var V=n(25277),U=n(8145),H=n(79739),K=n(86835),G=n(53256);const q=e=>{let{open:t,onClose:n,onConfirm:a,nodes:u}=e;const[m,p]=(0,s.useState)([]),[x,f]=(0,s.useState)([]),[y,b]=(0,s.useState)({});(0,s.useEffect)(()=>{if(!t)return;const e=/\{([^}]+)\}/g,n=new Set;u.forEach(t=>{if("agentNode"===t.type||"taskNode"===t.type){const a=t.data;[a.role,a.goal,a.backstory,a.description,a.expected_output,a.label].forEach(t=>{if(t&&"string"===typeof t){let a;for(;null!==(a=e.exec(t));)n.add(a[1])}})}});const a=Array.from(n);f(a),0===m.length&&a.length>0&&p(a.map(e=>({name:e,value:""})))},[t,u,m.length]);const v=(e,t,n)=>{const a=[...m];if(a[e]=Object.assign({},a[e],{[t]:n}),p(a),"value"===t&&n){const t=Object.assign({},y);delete t[a[e].name],b(t)}};return(0,W.jsxs)(o.A,{open:t,onClose:n,maxWidth:"md",fullWidth:!0,children:[(0,W.jsx)(l.A,{children:(0,W.jsxs)(i.A,{display:"flex",alignItems:"center",justifyContent:"space-between",children:[(0,W.jsx)(c.A,{variant:"h6",children:"Input Variables"}),(0,W.jsx)(d.A,{onClick:n,size:"small",children:(0,W.jsx)(K.A,{})})]})}),(0,W.jsxs)(i.A,{component:"form",onSubmit:e=>{e.preventDefault(),(()=>{const e={};let t=!1;if(x.forEach(n=>{const a=m.find(e=>e.name===n);a&&a.value||(e[n]="This variable is required",t=!0)}),t)return void b(e);const n={};m.forEach(e=>{e.name&&e.value&&(n[e.name]=e.value)}),a(n)})()},children:[(0,W.jsxs)(r.A,{children:[x.length>0&&(0,W.jsx)(h.A,{severity:"info",sx:{mb:2},children:(0,W.jsxs)(i.A,{display:"flex",alignItems:"center",gap:1,children:[(0,W.jsx)(c.A,{variant:"body2",children:"Detected variables in your workflow:"}),x.map(e=>(0,W.jsx)(V.A,{label:"{"+e+"}",size:"small",color:"primary"},e))]})}),(0,W.jsxs)(i.A,{sx:{mt:2},children:[(0,W.jsx)(c.A,{variant:"subtitle2",gutterBottom:!0,children:"Define values for variables used in your agents and tasks:"}),m.map((e,t)=>(0,W.jsxs)(i.A,{sx:{display:"flex",gap:1,mb:2,alignItems:"flex-start"},children:[(0,W.jsx)(U.A,{label:"Variable Name",value:e.name,onChange:e=>v(t,"name",e.target.value),size:"small",sx:{flex:1},error:!!y[e.name],disabled:x.includes(e.name)}),(0,W.jsx)(U.A,{label:"Value",value:e.value,onChange:e=>v(t,"value",e.target.value),size:"small",sx:{flex:2},error:!!y[e.name],helperText:y[e.name],required:x.includes(e.name)}),!x.includes(e.name)&&(0,W.jsx)(d.A,{onClick:()=>(e=>{const t=m.filter((t,n)=>n!==e);p(t)})(t),size:"small",color:"error",children:(0,W.jsx)(K.A,{})})]},t)),(0,W.jsx)(g.A,{startIcon:(0,W.jsx)(G.A,{}),onClick:()=>{p([...m,{name:"",value:""}])},variant:"outlined",size:"small",sx:{mt:1},children:"Add Custom Variable"})]}),(0,W.jsxs)(h.A,{severity:"info",sx:{mt:3},children:[(0,W.jsx)(c.A,{variant:"body2",children:(0,W.jsx)("strong",{children:"How to use variables:"})}),(0,W.jsxs)(c.A,{variant:"body2",component:"ul",sx:{mt:1,pl:2},children:[(0,W.jsxs)("li",{children:["Use ","{variable_name}"," syntax in agent roles, goals, backstories, and task descriptions"]}),(0,W.jsx)("li",{children:"Variables will be replaced with the values you provide here during execution"}),(0,W.jsxs)("li",{children:["Example: ",'"Analyze {topic} trends in {industry}"'," \u2192 ",'"Analyze AI trends in Healthcare"']})]})]})]}),(0,W.jsxs)(H.A,{children:[(0,W.jsx)(g.A,{onClick:n,children:"Cancel"}),(0,W.jsx)(g.A,{type:"submit",variant:"contained",color:"primary",autoFocus:!0,children:"Execute with Variables"})]})]})]})};var J=n(85668),Y=n(46639),X=n(82570),Q=n(57988),Z=n(7999),$=n(7626),ee=n(51260),te=n(48089),ne=n(74745),ae=n(2046),se=n(74616),ie=n(46986),oe=n(23165),re=n(25979),le=n(19647),ce=n(70006),de=n(23266),ue=n(60899),he=n(16497),me=n(37324),ge=n(18726),pe=n(98424),xe=n(87305),fe=n(39582),ye=n(29478),be=n(26910),ve=n(27887);class Ae{static async generateAgent(e,t,n){void 0===n&&(n=[]);try{const a=n.map(e=>String(e));return(await ve.Ay.post("/agent-generation/generate",{prompt:e,model:t||"gpt-4o-mini",tools:a})).data}catch(a){return null}}static async generateTask(e,t){try{return(await ve.Ay.post("/task-generation/generate-task",{text:e.trim(),model:t||void 0},{headers:{"Content-Type":"application/json"}})).data}catch(n){return null}}static async generateTemplates(e){try{return(await ve.Ay.post("/template-generation/generate-templates",e,{headers:{"Content-Type":"application/json",Accept:"application/json"},transformResponse:[e=>{const t=JSON.parse(e);if("system_template"in t)return t;return{system_template:t["System Template"]||t.system_template||"",prompt_template:t["Prompt Template"]||t.prompt_template||"",response_template:t["Response Template"]||t.response_template||""}}]})).data}catch(n){var t;if(be.A.isAxiosError(n))null!=(t=n.response)&&null!=(t=t.data)&&t.detail;return null}}}const je="default_memory_backend_config";class we{constructor(){}static getInstance(){return we.instance||(we.instance=new we),we.instance}getDefaultConfig(){const e=localStorage.getItem(je);if(e)try{return JSON.parse(e)}catch(t){return null}return null}setDefaultConfig(e){localStorage.setItem(je,JSON.stringify(e))}clearDefaultConfig(){localStorage.removeItem(je)}hasDefaultConfig(){return null!==localStorage.getItem(je)}}we.instance=void 0;var ke=n(27721),Ce=n(21816),Se=n(77922),_e=n(2235),Ee=n(19223),Ie=n(7762),Te=n(30444),De=n(79606);class Oe{static async getSpaces(e,t){void 0===t&&(t=50);try{const n={page_size:t};e&&(n.page_token=e);return(await ve.uE.get("/api/genie/spaces",{params:n})).data}catch(n){return{spaces:[]}}}static async searchSpaces(e){try{return(await ve.uE.post("/api/genie/spaces/search",e)).data}catch(t){return{spaces:[]}}}static async getSpaceDetails(e){try{return(await ve.uE.get("/api/genie/spaces/"+e)).data}catch(t){throw t}}static formatSpaceName(e){return e.description?e.name+" - "+e.description:e.name}static getDefaultSpaceId(){return"01efdd2cd03211d0ab74f620f0023b77"}}const Ne=["key"],Pe=e=>{let{value:t,onChange:n,multiple:o=!1,label:r="Genie Space",placeholder:l="Search for Genie spaces...",disabled:u=!1,required:h=!1,helperText:m,error:g=!1,fullWidth:p=!0,toolId:x}=e;const[f,y]=(0,s.useState)(!1),[b,v]=(0,s.useState)([]),[A,j]=(0,s.useState)(null),[w,k]=(0,s.useState)(""),[C,S]=(0,s.useState)(!1),[_,E]=(0,s.useState)(!0),[I,T]=(0,s.useState)(void 0),[D,O]=(0,s.useState)(""),[N,P]=(0,s.useState)([]),z=(0,s.useRef)(!1),L=(0,s.useRef)(null);(0,s.useEffect)(()=>{const e=localStorage.getItem("pinnedGenieSpaces");if(e)try{P(JSON.parse(e))}catch(t){}},[]);const R=e=>{P(e),localStorage.setItem("pinnedGenieSpaces",JSON.stringify(e))},F=e=>{N.includes(e)?R(N.filter(t=>t!==e)):R([...N,e])};(0,s.useEffect)(()=>{(async()=>{if(t){if(o&&Array.isArray(t)){const e=b.filter(e=>t.includes(e.id));j(e.length>0?e:null)}else if(!o&&"string"===typeof t){let e=b.find(e=>e.id===t);if(!e&&t)try{const n=await Oe.searchSpaces({search_query:t,page_size:10,enabled_only:!1});e=n.spaces.find(e=>e.id===t),e&&v(t=>!t.some(t=>{var n;return t.id===(null==(n=e)?void 0:n.id)})&&e?[...t,e]:t)}catch(g){}j(e||null)}}else j(null)})()},[t,o,b]);const B=async function(e,t,n){if(void 0===n&&(n=!1),!z.current||!n)try{let a;z.current=n,n||S(!0),a=e?await Oe.searchSpaces({search_query:e,page_token:t,page_size:50,enabled_only:!0}):await Oe.getSpaces(t,50),v(n?e=>[...e,...a.spaces]:a.spaces),T(a.next_page_token),E(a.has_more||!1)}catch(g){}finally{S(!1),z.current=!1}},H=e=>{const t=e.currentTarget,n=t.scrollTop;t.scrollHeight-n<=1.5*t.clientHeight&&_&&!z.current&&B(D,I,!0)};(0,s.useEffect)(()=>{t&&0===b.length&&!C&&B(),f&&0===b.length&&!C&&B()},[f,b.length,t,C]),(0,s.useEffect)(()=>()=>{L.current&&clearTimeout(L.current)},[]);const K=s.useMemo(()=>[...b].sort((e,t)=>{const n=N.includes(e.id),a=N.includes(t.id);return n&&!a?-1:!n&&a?1:0}),[b,N]),G=s.forwardRef((e,t)=>(0,W.jsx)("ul",Object.assign({},e,{ref:t,onScroll:H,style:{maxHeight:300,overflow:"auto"}})));return G.displayName="ListboxComponent",(0,W.jsx)(Se.A,{multiple:o,open:f,onOpen:()=>y(!0),onClose:()=>y(!1),value:A,onChange:(e,t)=>{j(t),o&&Array.isArray(t)?n(t.map(e=>e.id)):o||!t||Array.isArray(t)?n(null):n(t.id,t.name)},inputValue:w,onInputChange:(e,t)=>{k(t),f&&(L.current&&clearTimeout(L.current),L.current=setTimeout(()=>{O(t),T(void 0),B(t)},300))},options:K,loading:C,loadingText:"Loading spaces...",noOptionsText:C?"Loading spaces...":w?'No spaces found matching "'+w+'"':"Start typing to search for spaces",getOptionLabel:e=>e.name,isOptionEqualToValue:(e,t)=>e.id===t.id,renderOption:(e,t)=>{const n=N.includes(t.id);return(0,W.jsxs)(i.A,Object.assign({component:"li"},e,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[(0,W.jsxs)(i.A,{sx:{flex:1},children:[(0,W.jsx)(c.A,{variant:"body2",children:t.name}),t.description&&(0,W.jsx)(c.A,{variant:"caption",color:"text.secondary",children:t.description})]}),(0,W.jsx)(M.A,{title:n?"Unpin space":"Pin space",children:(0,W.jsx)(d.A,{size:"small",onClick:e=>{e.stopPropagation(),F(t.id)},sx:{ml:1},children:n?(0,W.jsx)(Te.A,{fontSize:"small"}):(0,W.jsx)(De.A,{fontSize:"small"})})})]}))},ListboxComponent:G,disabled:u,fullWidth:p,renderInput:e=>(0,W.jsx)(U.A,Object.assign({},e,{label:r,placeholder:l,required:h,error:g,helperText:m,InputProps:Object.assign({},e.InputProps,{startAdornment:(0,W.jsxs)(W.Fragment,{children:[(0,W.jsx)(ae.A,{position:"start",children:(0,W.jsx)(Ee.A,{})}),e.InputProps.startAdornment]}),endAdornment:(0,W.jsxs)(W.Fragment,{children:[C?(0,W.jsx)(Y.A,{color:"inherit",size:20}):null,!o&&A&&!Array.isArray(A)&&(0,W.jsxs)(i.A,{sx:{display:"flex",alignItems:"center",mr:1},children:[(0,W.jsx)(M.A,{title:N.includes(A.id)?"Unpin space":"Pin space",children:(0,W.jsx)(d.A,{size:"small",onClick:e=>{e.stopPropagation(),F(A.id)},children:N.includes(A.id)?(0,W.jsx)(Te.A,{fontSize:"small",color:"primary"}):(0,W.jsx)(De.A,{fontSize:"small"})})}),(0,W.jsx)(M.A,{title:"Clear selection",children:(0,W.jsx)(d.A,{size:"small",onClick:e=>{e.stopPropagation(),j(null),n(null),k("")},children:(0,W.jsx)(Ie.A,{fontSize:"small"})})})]}),e.InputProps.endAdornment]})})})),renderTags:(e,t)=>e.map((e,n)=>{const s=t({index:n}),{key:i}=s,o=(0,a.A)(s,Ne);return(0,W.jsx)(V.A,Object.assign({label:e.name},o,{size:"small"}),i||e.id)}),PaperComponent:e=>(0,W.jsxs)(_e.A,Object.assign({},e,{children:[e.children,z.current&&(0,W.jsx)(i.A,{display:"flex",justifyContent:"center",p:1,children:(0,W.jsx)(Y.A,{size:20})})]}))})};var Me=n(2660),ze=n(67991),Le=n(13062);class We{static getInstance(){return We.instance||(We.instance=new We),We.instance}async isDatabricksEnabled(){try{var e;const t=ke.O.getInstance(),n=await t.getDatabricksConfig();return null!=(e=null==n?void 0:n.enabled)&&e}catch(t){return!1}}async getAPIKeys(){try{return(await ve.Ay.get("/api-keys")).data}catch(t){if(t instanceof Le.pe){var e;const n=(null==(e=t.response)||null==(e=e.data)?void 0:e.detail)||"Failed to load API keys";throw new Error(n)}throw new Error("Failed to connect to the server")}}async getDatabricksSecrets(){try{if(!await this.isDatabricksEnabled())return[];return(await ve.Ay.get("/databricks-secrets")).data}catch(t){if(t instanceof Le.pe){var e;const n=(null==(e=t.response)||null==(e=e.data)?void 0:e.detail)||"Failed to load Databricks secrets";throw new Error(n)}throw new Error("Failed to connect to the server")}}async createAPIKey(e){try{return(await ve.Ay.post("/api-keys",e)).data}catch(n){if(n instanceof Le.pe){var t;const e=(null==(t=n.response)||null==(t=t.data)?void 0:t.detail)||"Failed to create API key";throw new Error(e)}throw new Error("Failed to connect to the server")}}async createDatabricksSecret(e){try{return(await ve.Ay.post("/databricks-secrets",e)).data}catch(n){if(n instanceof Le.pe){var t;const e=(null==(t=n.response)||null==(t=t.data)?void 0:t.detail)||"Failed to create Databricks secret";throw new Error(e)}throw new Error("Failed to connect to the server")}}async updateAPIKey(e,t){try{return(await ve.Ay.put("/api-keys/"+e,t)).data}catch(a){if(a instanceof Le.pe){var n;const e=(null==(n=a.response)||null==(n=n.data)?void 0:n.detail)||"Failed to update API key";throw new Error(e)}throw new Error("Failed to connect to the server")}}async updateDatabricksSecret(e,t){try{return(await ve.Ay.put("/databricks-secrets/"+e,t)).data}catch(a){if(a instanceof Le.pe){var n;const e=(null==(n=a.response)||null==(n=n.data)?void 0:n.detail)||"Failed to update Databricks secret";throw new Error(e)}throw new Error("Failed to connect to the server")}}async deleteAPIKey(e){try{return(await ve.Ay.delete("/api-keys/"+e)).data}catch(n){if(n instanceof Le.pe){var t;const e=(null==(t=n.response)||null==(t=t.data)?void 0:t.detail)||"Failed to delete API key";throw new Error(e)}throw new Error("Failed to connect to the server")}}async deleteDatabricksSecret(e){try{return(await ve.Ay.delete("/databricks-secrets/"+e)).data}catch(n){if(n instanceof Le.pe){var t;const e=(null==(t=n.response)||null==(t=t.data)?void 0:t.detail)||"Failed to delete Databricks secret";throw new Error(e)}throw new Error("Failed to connect to the server")}}async setDatabricksToken(e,t){try{if(!e)throw new Error("Databricks workspace URL is required");const n={workspace_url:e,token:t};await ve.Ay.post("/databricks/token",n)}catch(a){if(a instanceof Le.pe){var n;const e=(null==(n=a.response)||null==(n=n.data)?void 0:n.detail)||"Failed to set Databricks token";throw new Error(e)}throw new Error("Failed to connect to the server")}}}We.instance=void 0;class Re{static async getCrews(){try{return(await ve.uE.get("/crews")).data}catch(e){throw e}}static async getCrew(e){try{return(await ve.uE.get("/crews/"+e)).data}catch(t){throw t}}static async getTasks(e){try{const t=(await ve.uE.get("/crews/"+e)).data;let n=[];if(t.nodes&&Array.isArray(t.nodes)){t.nodes.filter(e=>"taskNode"===e.type||e.data&&"object"===typeof e.data&&"taskId"in e.data).forEach(t=>{if(t.data&&"object"===typeof t.data){var a,s;const i=String(t.data.taskId||t.data.id||t.id);n.push({id:i,name:String(t.data.label||t.data.name||"Unnamed Task"),description:String(t.data.description||""),expected_output:String(t.data.expected_output||""),agent_id:String(e),tools:Array.isArray(t.data.tools)?t.data.tools:[],context:Array.isArray(t.data.context)?t.data.context:[],markdown:!0===(null==(a=t.data.config)?void 0:a.markdown)||"true"===(null==(s=t.data.config)?void 0:s.markdown)})}})}return t.tasks&&Array.isArray(t.tasks)&&t.tasks.forEach(t=>{if(t.data){var a,s;const i=String(t.id);n.push({id:i,name:String(t.data.name||t.data.label||"Unnamed Task"),description:String(t.data.description||""),expected_output:String(t.data.expected_output||""),agent_id:String(e),tools:Array.isArray(t.data.tools)?t.data.tools:[],context:Array.isArray(t.data.context)?t.data.context:[],markdown:!0===(null==(a=t.data.config)?void 0:a.markdown)||"true"===(null==(s=t.data.config)?void 0:s.markdown)})}}),n=n.filter(e=>!String(e.id).startsWith("agent-")),n}catch(t){return[]}}static async saveCrew(e){try{const t=e=>{if("object"!==typeof e||null===e)return"boolean"===typeof e?String(e):e;if(Array.isArray(e))return e.map(e=>t(e));const n={};for(const[a,s]of Object.entries(e))"knowledge_sources"===a&&Array.isArray(s)?n[a]=s.map(e=>{if(e&&"object"===typeof e){return t(e)}return e}):n[a]="tool_configs"===a&&null!==s&&"object"===typeof s?s:"taskId"!==a&&"agentId"!==a||null===s?"object"===typeof s&&null!==s?t(s):"boolean"===typeof s?String(s):s:String(s);return n},n=e.nodes.filter(e=>"agentNode"===e.type),a=e.nodes.filter(e=>"taskNode"===e.type),s=n.map(e=>{var t;if(null!=(t=e.data)&&t.agentId)return String(e.data.agentId);if(e.id){if(e.id.startsWith("agent-")){const t=e.id.split("agent-");if(t.length>1)return t[1]}return e.id}return null}).filter(Boolean),i=a.map(e=>{var t;if(null!=(t=e.data)&&t.taskId)return String(e.data.taskId);if(e.id){if(e.id.startsWith("task-")){const t=e.id.split("task-");if(t.length>1)return t[1]}return e.id}return null}).filter(Boolean),o=e.nodes.map(e=>{e.data||(e.data={label:e.id}),e.data.label&&"string"===typeof e.data.label||(e.data.label=e.id),e.data.tools&&Array.isArray(e.data.tools)||(e.data.tools=[]),e.data.context&&Array.isArray(e.data.context)||(e.data.context=[]),void 0===e.data.async_execution?e.data.async_execution="false":e.data.async_execution=String(e.data.async_execution),"agentNode"===e.type&&(e.data.knowledge_sources,e.data.tool_configs),"taskNode"===e.type&&e.data.tool_configs;const n={id:e.id,type:e.type,position:{x:e.position.x,y:e.position.y},data:t(e.data)};if("agentNode"===e.type){e.data.knowledge_sources,e.data.tool_configs}if("taskNode"===e.type&&e.data.tool_configs){}return n}),r=e.edges.map(e=>({id:e.id,source:e.source,target:e.target})),l={name:e.name,agent_ids:s,task_ids:i,nodes:o,edges:r},c=(await ve.uE.post("/crews",l)).data;return{id:c.id.toString(),name:c.name,agent_ids:c.agent_ids,task_ids:c.task_ids,nodes:c.nodes||o,edges:c.edges||r,created_at:c.created_at,updated_at:c.updated_at}}catch(t){if(be.A.isAxiosError(t)&&t.response){t.response.data}throw t}}static async updateCrew(e,t){try{const n=e=>{if("object"!==typeof e||null===e)return"boolean"===typeof e?String(e):e;if(Array.isArray(e))return e.map(e=>n(e));const t={};for(const[a,s]of Object.entries(e))"knowledge_sources"===a&&Array.isArray(s)?t[a]=s.map(e=>{if(e&&"object"===typeof e){return n(e)}return e}):t[a]="tool_configs"===a&&null!==s&&"object"===typeof s?s:"taskId"!==a&&"agentId"!==a||null===s?"object"===typeof s&&null!==s?n(s):"boolean"===typeof s?String(s):s:String(s);return t},a=t.nodes.filter(e=>"agentNode"===e.type),s=t.nodes.filter(e=>"taskNode"===e.type),i=a.map(e=>{var t;if(null!=(t=e.data)&&t.agentId)return String(e.data.agentId);if(e.id){if(e.id.startsWith("agent-")){const t=e.id.split("agent-");if(t.length>1)return t[1]}return e.id}return null}).filter(Boolean),o=s.map(e=>{var t;if(null!=(t=e.data)&&t.taskId)return String(e.data.taskId);if(e.id){if(e.id.startsWith("task-")){const t=e.id.split("task-");if(t.length>1)return t[1]}return e.id}return null}).filter(Boolean),r=t.nodes.map(e=>{e.data||(e.data={label:e.id}),e.data.label&&"string"===typeof e.data.label||(e.data.label=e.id),e.data.tools&&Array.isArray(e.data.tools)||(e.data.tools=[]),e.data.context&&Array.isArray(e.data.context)||(e.data.context=[]),void 0===e.data.async_execution?e.data.async_execution="false":e.data.async_execution=String(e.data.async_execution),"agentNode"===e.type&&(e.data.knowledge_sources,e.data.tool_configs),"taskNode"===e.type&&e.data.tool_configs;const t={id:e.id,type:e.type,position:{x:e.position.x,y:e.position.y},data:n(e.data)};if("agentNode"===e.type){e.data.knowledge_sources,e.data.tool_configs}if("taskNode"===e.type&&e.data.tool_configs){}return t}),l=t.edges.map(e=>({id:e.id,source:e.source,target:e.target})),c={name:t.name,agent_ids:i,task_ids:o,nodes:r,edges:l},d=(await ve.uE.put("/crews/"+e,c)).data;return{id:d.id.toString(),name:d.name,agent_ids:d.agent_ids,task_ids:d.task_ids,nodes:d.nodes||r,edges:d.edges||l,created_at:d.created_at,updated_at:d.updated_at}}catch(n){if(be.A.isAxiosError(n)&&n.response){n.response.data}throw n}}static async deleteCrew(e){try{return await ve.uE.delete("/crews/"+e),!0}catch(t){return!1}}static async deleteAllCrews(){try{await ve.uE.delete("/crews")}catch(e){throw e}}}var Fe=n(31076),Be=n(42004);const Ve=(0,A.vt)(e=>({secrets:[],loading:!1,error:null,editDialogOpen:!1,providerToEdit:null,fetchAPIKeys:async()=>{e({loading:!0,error:null});try{const t=We.getInstance(),n=await t.getAPIKeys();e({secrets:n,loading:!1})}catch(t){e({loading:!1,error:t instanceof Error?t.message:"An unexpected error occurred"})}},updateSecrets:t=>e(()=>({secrets:t,error:null})),clearError:()=>e(()=>({error:null})),openApiKeyEditor:t=>e(()=>({editDialogOpen:!0,providerToEdit:t})),closeApiKeyEditor:()=>e(()=>({editDialogOpen:!1,providerToEdit:null}))})),Ue=[{value:"sonar",label:"Sonar (Default)"},{value:"sonar-pro",label:"Sonar Pro"},{value:"sonar-deep-research",label:"Sonar Deep Research"},{value:"sonar-reasoning",label:"Sonar Reasoning"},{value:"sonar-reasoning-pro",label:"Sonar Reasoning Pro"},{value:"r1-1776",label:"R1-1776"}],He=[{value:"day",label:"Past Day"},{value:"week",label:"Past Week"},{value:"month",label:"Past Month"},{value:"year",label:"Past Year"}],Ke=[{value:"low",label:"Low"},{value:"medium",label:"Medium"},{value:"high",label:"High"}],Ge={model:"sonar",max_tokens:2e3,temperature:.1,top_p:.9,top_k:0,presence_penalty:0,frequency_penalty:1,search_recency_filter:"month",search_domain_filter:["<any>"],return_images:!1,return_related_questions:!1,web_search_options:{search_context_size:"high"}},qe=e=>{var t,n;let{value:a,onChange:o,label:r="Perplexity Configuration",helperText:l="Configure Perplexity AI search parameters",fullWidth:u=!0,disabled:m=!1}=e;const[g,p]=(0,s.useState)(Object.assign({},Ge,a)),{secrets:x,fetchAPIKeys:f}=Ve(),[y,b]=(0,s.useState)(!1);(0,s.useEffect)(()=>{f()},[f]),(0,s.useEffect)(()=>{const e=x.find(e=>{var t;return(null==(t=e.name)?void 0:t.toLowerCase().includes("perplexity"))||"PERPLEXITY_API_KEY"===e.name});b(!!e)},[x]),(0,s.useEffect)(()=>{p(Object.assign({},Ge,a))},[a]);const v=(e,t)=>{const n=Object.assign({},g,{[e]:t});p(n),o(n)};return(0,W.jsxs)(i.A,{sx:{width:u?"100%":"auto"},children:[(0,W.jsx)(c.A,{variant:"subtitle2",gutterBottom:!0,children:r}),(0,W.jsx)(c.A,{variant:"caption",color:"text.secondary",sx:{mb:2,display:"block"},children:l}),y&&(0,W.jsx)(h.A,{severity:"info",sx:{mb:2},children:(0,W.jsxs)(i.A,{sx:{display:"flex",alignItems:"center",gap:1},children:[(0,W.jsx)(c.A,{variant:"body2",children:"\u2705 System API key configured - leave empty to use system default, or enter a custom key to override"}),(0,W.jsx)(M.A,{title:"A Perplexity API key is already configured in the system settings. You can override it here for this specific task/agent, or leave empty to use the system default.",children:(0,W.jsx)(d.A,{size:"small",children:(0,W.jsx)(ze.A,{fontSize:"small"})})})]})}),(0,W.jsx)(U.A,{fullWidth:!0,label:y?"API Key Override (Optional)":"API Key",value:g.perplexity_api_key||"",onChange:e=>v("perplexity_api_key",e.target.value),disabled:m,type:"password",sx:{mb:2},helperText:y?"Leave empty to use system default, or enter a custom key to override":"Enter your Perplexity API key, or leave empty to use environment variable",placeholder:y?"Override system API key...":"Enter API key..."}),(0,W.jsxs)(re.A,{fullWidth:!0,sx:{mb:2},disabled:m,children:[(0,W.jsx)(le.A,{children:"Model"}),(0,W.jsx)(ce.A,{value:g.model||"sonar",onChange:e=>v("model",e.target.value),label:"Model",children:Ue.map(e=>(0,W.jsx)(de.A,{value:e.value,children:e.label},e.value))})]}),(0,W.jsxs)(se.A,{sx:{mb:2},children:[(0,W.jsx)(ie.A,{expandIcon:(0,W.jsx)(ge.A,{}),children:(0,W.jsx)(c.A,{children:"Search Configuration"})}),(0,W.jsx)(oe.A,{children:(0,W.jsxs)(ue.Ay,{container:!0,spacing:2,children:[(0,W.jsx)(ue.Ay,{item:!0,xs:12,md:6,children:(0,W.jsxs)(re.A,{fullWidth:!0,disabled:m,children:[(0,W.jsx)(le.A,{children:"Search Recency"}),(0,W.jsx)(ce.A,{value:g.search_recency_filter||"month",onChange:e=>v("search_recency_filter",e.target.value),label:"Search Recency",children:He.map(e=>(0,W.jsx)(de.A,{value:e.value,children:e.label},e.value))})]})}),(0,W.jsx)(ue.Ay,{item:!0,xs:12,md:6,children:(0,W.jsxs)(re.A,{fullWidth:!0,disabled:m,children:[(0,W.jsx)(le.A,{children:"Search Context Size"}),(0,W.jsx)(ce.A,{value:(null==(t=g.web_search_options)?void 0:t.search_context_size)||"high",onChange:e=>((e,t)=>{const n=Object.assign({},g.web_search_options,{[e]:t}),a=Object.assign({},g,{web_search_options:n});p(a),o(a)})("search_context_size",e.target.value),label:"Search Context Size",children:Ke.map(e=>(0,W.jsx)(de.A,{value:e.value,children:e.label},e.value))})]})}),(0,W.jsxs)(ue.Ay,{item:!0,xs:12,children:[(0,W.jsxs)(re.A,{fullWidth:!0,disabled:m,children:[(0,W.jsx)(le.A,{children:"Domain Filter"}),(0,W.jsxs)(ce.A,{multiple:!0,value:g.search_domain_filter||["<any>"],onChange:e=>{const t=e.target.value,n="string"===typeof t?t.split(","):t,a=n.includes("<any>")?["<any>"]:n.filter(e=>"<any>"!==e);v("search_domain_filter",a)},input:(0,W.jsx)(Me.A,{label:"Domain Filter"}),renderValue:e=>(0,W.jsx)(i.A,{sx:{display:"flex",flexWrap:"wrap",gap:.5},children:e.map(e=>(0,W.jsx)(V.A,{label:"<any>"===e?"Any Domain":e,size:"small"},e))}),children:[(0,W.jsx)(de.A,{value:"<any>",children:"Any Domain"}),null==(n=g.search_domain_filter)?void 0:n.filter(e=>"<any>"!==e).map(e=>(0,W.jsx)(de.A,{value:e,children:e},e))]})]}),(0,W.jsx)(U.A,{fullWidth:!0,placeholder:"Add custom domain (press Enter)",onKeyPress:e=>{if("Enter"===e.key){var t;e.preventDefault();const n=e.target,a=n.value.trim();if(a&&(null==(t=g.search_domain_filter)||!t.includes(a))){const e=(g.search_domain_filter||[]).filter(e=>"<any>"!==e);v("search_domain_filter",[...e,a]),n.value=""}}},disabled:m,sx:{mt:1},size:"small",helperText:"Type a domain and press Enter to add it to the filter"})]}),(0,W.jsx)(ue.Ay,{item:!0,xs:12,md:6,children:(0,W.jsx)(he.A,{control:(0,W.jsx)(me.A,{checked:g.return_images||!1,onChange:e=>v("return_images",e.target.checked),disabled:m}),label:"Return Images"})}),(0,W.jsx)(ue.Ay,{item:!0,xs:12,md:6,children:(0,W.jsx)(he.A,{control:(0,W.jsx)(me.A,{checked:g.return_related_questions||!1,onChange:e=>v("return_related_questions",e.target.checked),disabled:m}),label:"Return Related Questions"})})]})})]}),(0,W.jsxs)(se.A,{sx:{mb:2},children:[(0,W.jsx)(ie.A,{expandIcon:(0,W.jsx)(ge.A,{}),children:(0,W.jsx)(c.A,{children:"Advanced Parameters"})}),(0,W.jsx)(oe.A,{children:(0,W.jsxs)(ue.Ay,{container:!0,spacing:2,children:[(0,W.jsx)(ue.Ay,{item:!0,xs:12,md:6,children:(0,W.jsx)(U.A,{fullWidth:!0,label:"Max Tokens",type:"number",value:g.max_tokens||2e3,onChange:e=>v("max_tokens",parseInt(e.target.value)||2e3),disabled:m,inputProps:{min:1,max:4e3},helperText:"Maximum output tokens (1-4000)"})}),(0,W.jsx)(ue.Ay,{item:!0,xs:12,md:6,children:(0,W.jsx)(U.A,{fullWidth:!0,label:"Temperature",type:"number",value:g.temperature||.1,onChange:e=>v("temperature",parseFloat(e.target.value)||.1),disabled:m,inputProps:{min:0,max:1,step:.1},helperText:"Controls randomness (0.0-1.0)"})}),(0,W.jsx)(ue.Ay,{item:!0,xs:12,md:6,children:(0,W.jsx)(U.A,{fullWidth:!0,label:"Top P",type:"number",value:g.top_p||.9,onChange:e=>v("top_p",parseFloat(e.target.value)||.9),disabled:m,inputProps:{min:0,max:1,step:.1},helperText:"Nucleus sampling parameter (0.0-1.0)"})}),(0,W.jsx)(ue.Ay,{item:!0,xs:12,md:6,children:(0,W.jsx)(U.A,{fullWidth:!0,label:"Top K",type:"number",value:g.top_k||0,onChange:e=>v("top_k",parseInt(e.target.value)||0),disabled:m,inputProps:{min:0},helperText:"Top-k sampling parameter (0 = disabled)"})}),(0,W.jsx)(ue.Ay,{item:!0,xs:12,md:6,children:(0,W.jsx)(U.A,{fullWidth:!0,label:"Presence Penalty",type:"number",value:g.presence_penalty||0,onChange:e=>v("presence_penalty",parseFloat(e.target.value)||0),disabled:m,inputProps:{min:-2,max:2,step:.1},helperText:"Penalizes new topics (-2.0 to 2.0)"})}),(0,W.jsx)(ue.Ay,{item:!0,xs:12,md:6,children:(0,W.jsx)(U.A,{fullWidth:!0,label:"Frequency Penalty",type:"number",value:g.frequency_penalty||1,onChange:e=>v("frequency_penalty",parseFloat(e.target.value)||1),disabled:m,inputProps:{min:-2,max:2,step:.1},helperText:"Penalizes repetition (-2.0 to 2.0)"})})]})})]})]})},Je=[{value:"us",label:"United States (us)"},{value:"gb",label:"United Kingdom (gb)"},{value:"ca",label:"Canada (ca)"},{value:"au",label:"Australia (au)"},{value:"de",label:"Germany (de)"},{value:"fr",label:"France (fr)"},{value:"es",label:"Spain (es)"},{value:"it",label:"Italy (it)"},{value:"jp",label:"Japan (jp)"},{value:"cn",label:"China (cn)"},{value:"in",label:"India (in)"},{value:"br",label:"Brazil (br)"},{value:"mx",label:"Mexico (mx)"},{value:"ru",label:"Russia (ru)"},{value:"kr",label:"South Korea (kr)"}],Ye=[{value:"en",label:"English (en)"},{value:"es",label:"Spanish (es)"},{value:"fr",label:"French (fr)"},{value:"de",label:"German (de)"},{value:"it",label:"Italian (it)"},{value:"pt",label:"Portuguese (pt)"},{value:"ru",label:"Russian (ru)"},{value:"ja",label:"Japanese (ja)"},{value:"ko",label:"Korean (ko)"},{value:"zh",label:"Chinese (zh)"},{value:"ar",label:"Arabic (ar)"},{value:"hi",label:"Hindi (hi)"}],Xe=[{value:"search",label:"Search",url:"https://google.serper.dev/search",description:"Regular Google search results with organic results, knowledge graph, and related searches"},{value:"news",label:"News",url:"https://google.serper.dev/news",description:"Google News results with recent articles from various sources"}],Qe={n_results:10,search_url:"https://google.serper.dev/search",endpoint_type:"search",country:"us",locale:"en",location:""},Ze=e=>{let{value:t,onChange:n,label:a="Serper Configuration",helperText:o="Configure Serper.dev search parameters",fullWidth:r=!0,disabled:l=!1}=e;const[u,m]=(0,s.useState)(Object.assign({},Qe,t)),{secrets:g,fetchAPIKeys:p}=Ve(),[x,f]=(0,s.useState)(!1);(0,s.useEffect)(()=>{p()},[p]),(0,s.useEffect)(()=>{const e=g.find(e=>{var t;return(null==(t=e.name)?void 0:t.toLowerCase().includes("serper"))||"SERPER_API_KEY"===e.name});f(!!e)},[g]),(0,s.useEffect)(()=>{m(Object.assign({},Qe,t))},[t]);const y=(e,t)=>{const a=Object.assign({},u,{[e]:t});if("endpoint_type"===e){const e=Xe.find(e=>e.value===t);e&&(a.search_url=e.url)}m(a),n(a)};return(0,W.jsxs)(i.A,{sx:{width:r?"100%":"auto"},children:[(0,W.jsx)(c.A,{variant:"subtitle2",gutterBottom:!0,children:a}),(0,W.jsx)(c.A,{variant:"caption",color:"text.secondary",sx:{mb:2,display:"block"},children:o}),x&&(0,W.jsx)(h.A,{severity:"info",sx:{mb:2},children:(0,W.jsxs)(i.A,{sx:{display:"flex",alignItems:"center",gap:1},children:[(0,W.jsx)(c.A,{variant:"body2",children:"\u2705 System API key configured - leave empty to use system default, or enter a custom key to override"}),(0,W.jsx)(M.A,{title:"A Serper API key is already configured in the system settings. You can override it here for this specific task/agent, or leave empty to use the system default.",children:(0,W.jsx)(d.A,{size:"small",children:(0,W.jsx)(ze.A,{fontSize:"small"})})})]})}),(0,W.jsx)(U.A,{fullWidth:!0,label:x?"API Key Override (Optional)":"API Key",value:u.serper_api_key||"",onChange:e=>y("serper_api_key",e.target.value),disabled:l,type:"password",sx:{mb:2},helperText:x?"Leave empty to use system default, or enter a custom key to override":"Enter your Serper.dev API key, or leave empty to use environment variable",placeholder:x?"Override system API key...":"Enter API key..."}),(0,W.jsxs)(ue.Ay,{container:!0,spacing:2,sx:{mb:2},children:[(0,W.jsx)(ue.Ay,{item:!0,xs:12,md:6,children:(0,W.jsx)(U.A,{fullWidth:!0,label:"Number of Results",type:"number",value:u.n_results||10,onChange:e=>y("n_results",parseInt(e.target.value)||10),disabled:l,inputProps:{min:1,max:100},helperText:"Number of search results to return (1-100)"})}),(0,W.jsx)(ue.Ay,{item:!0,xs:12,md:6,children:(0,W.jsxs)(re.A,{fullWidth:!0,disabled:l,children:[(0,W.jsx)(le.A,{children:"Search Endpoint"}),(0,W.jsx)(ce.A,{value:u.endpoint_type||"search",onChange:e=>y("endpoint_type",e.target.value),label:"Search Endpoint",children:Xe.map(e=>(0,W.jsx)(de.A,{value:e.value,children:(0,W.jsxs)(i.A,{children:[(0,W.jsx)(c.A,{variant:"body2",sx:{fontWeight:"medium"},children:e.label}),(0,W.jsx)(c.A,{variant:"caption",color:"text.secondary",sx:{display:"block",fontSize:"0.7rem"},children:e.description})]})},e.value))})]})})]}),(0,W.jsxs)(c.A,{variant:"caption",color:"text.secondary",sx:{mb:2,display:"block"},children:[(0,W.jsx)("strong",{children:"Current Endpoint:"})," ",u.search_url||"https://google.serper.dev/search"]}),(0,W.jsxs)(se.A,{sx:{mb:2},children:[(0,W.jsx)(ie.A,{expandIcon:(0,W.jsx)(ge.A,{}),children:(0,W.jsx)(c.A,{children:"Geographic & Language Settings"})}),(0,W.jsx)(oe.A,{children:(0,W.jsxs)(ue.Ay,{container:!0,spacing:2,children:[(0,W.jsx)(ue.Ay,{item:!0,xs:12,md:6,children:(0,W.jsxs)(re.A,{fullWidth:!0,disabled:l,children:[(0,W.jsx)(le.A,{children:"Country"}),(0,W.jsx)(ce.A,{value:u.country||"us",onChange:e=>y("country",e.target.value),label:"Country",children:Je.map(e=>(0,W.jsx)(de.A,{value:e.value,children:e.label},e.value))})]})}),(0,W.jsx)(ue.Ay,{item:!0,xs:12,md:6,children:(0,W.jsxs)(re.A,{fullWidth:!0,disabled:l,children:[(0,W.jsx)(le.A,{children:"Language Locale"}),(0,W.jsx)(ce.A,{value:u.locale||"en",onChange:e=>y("locale",e.target.value),label:"Language Locale",children:Ye.map(e=>(0,W.jsx)(de.A,{value:e.value,children:e.label},e.value))})]})}),(0,W.jsx)(ue.Ay,{item:!0,xs:12,children:(0,W.jsx)(U.A,{fullWidth:!0,label:"Specific Location",value:u.location||"",onChange:e=>y("location",e.target.value),disabled:l,placeholder:"e.g., New York, London, Tokyo",helperText:"Optional specific location for geographically-targeted results"})})]})})]}),(0,W.jsx)(h.A,{severity:"info",sx:{mt:2},children:(0,W.jsxs)(c.A,{variant:"body2",children:["\u{1f4a1} ",(0,W.jsx)("strong",{children:"Tip:"})," Serper.dev provides access to multiple Google search types through API. Choose from Search, News, Images, Videos, Places, Shopping, Scholar, Patents, and Autocomplete endpoints. Configure geographic settings for location-specific results."]})})]})};var $e=n(24516),et=n(14302);class tt{static getInstance(){return tt.instance||(tt.instance=new tt),tt.instance}async getMcpServers(){try{return(await ve.uE.get("/mcp/servers")).data}catch(t){var e;throw new Error((null==(e=t.response)||null==(e=e.data)?void 0:e.detail)||"Error fetching MCP servers")}}async getMcpServer(e){try{return(await ve.uE.get("/mcp/servers/"+e)).data}catch(a){var t,n;if(404===(null==(t=a.response)?void 0:t.status))return null;throw new Error((null==(n=a.response)||null==(n=n.data)?void 0:n.detail)||"Error fetching MCP server with ID "+e)}}async createMcpServer(e){try{return(await ve.uE.post("/mcp/servers",e)).data}catch(n){var t;throw new Error((null==(t=n.response)||null==(t=t.data)?void 0:t.detail)||"Error creating MCP server")}}async updateMcpServer(e,t){try{return(await ve.uE.put("/mcp/servers/"+e,t)).data}catch(a){var n;throw new Error((null==(n=a.response)||null==(n=n.data)?void 0:n.detail)||"Error updating MCP server with ID "+e)}}async deleteMcpServer(e){try{return await ve.uE.delete("/mcp/servers/"+e),!0}catch(n){var t;throw new Error((null==(t=n.response)||null==(t=t.data)?void 0:t.detail)||"Error deleting MCP server with ID "+e)}}async toggleMcpServerEnabled(e){try{return{enabled:(await ve.uE.patch("/mcp/servers/"+e+"/toggle-enabled")).data.enabled}}catch(n){var t;throw new Error((null==(t=n.response)||null==(t=t.data)?void 0:t.detail)||"Error toggling MCP server "+e+" enabled state")}}async toggleMcpServerGlobalEnabled(e){try{return{enabled:(await ve.uE.patch("/mcp/servers/"+e+"/toggle-global-enabled")).data.enabled}}catch(n){var t;throw new Error((null==(t=n.response)||null==(t=t.data)?void 0:t.detail)||"Error toggling MCP server "+e+" global enabled state")}}async testConnection(e){try{return(await ve.uE.post("/mcp/test-connection",e)).data}catch(n){var t;return{success:!1,message:(null==(t=n.response)||null==(t=t.data)?void 0:t.detail)||"Error testing connection"}}}async getGlobalSettings(){try{return(await ve.uE.get("/mcp/settings")).data}catch(t){var e;throw new Error((null==(e=t.response)||null==(e=e.data)?void 0:e.detail)||"Error fetching MCP global settings")}}async updateGlobalSettings(e){try{return(await ve.uE.put("/mcp/settings",e)).data}catch(n){var t;throw new Error((null==(t=n.response)||null==(t=t.data)?void 0:t.detail)||"Error updating MCP global settings")}}async enableForWorkspace(e){try{return(await ve.uE.post("/mcp/servers/"+e+"/enable-for-workspace")).data}catch(n){var t;throw new Error((null==(t=n.response)||null==(t=t.data)?void 0:t.detail)||"Error enabling server "+e+" for workspace")}}}tt.instance=void 0;const nt=e=>{let{value:t,onChange:n,multiple:a=!0,label:o="MCP Servers",placeholder:r="Select MCP servers...",disabled:l=!1,required:d=!1,helperText:u,error:h=!1,fullWidth:m=!0}=e;const[g,p]=(0,s.useState)(!1),[x,f]=(0,s.useState)([]),[y,b]=(0,s.useState)(null),[v,A]=(0,s.useState)(!1),[j,w]=(0,s.useState)(null);(0,s.useEffect)(()=>{g&&0===x.length&&k()},[g,x.length]),(0,s.useEffect)(()=>{if(t)if(x.length>0)if(a){const e=Array.isArray(t)?t:[t],n=x.filter(t=>e.includes(t.name));b(n)}else{const e=x.find(e=>e.name===t);b(e||null)}else b(a?[]:null);else b(a?[]:null)},[t,x,a]);const k=async()=>{try{A(!0),w(null);const e=tt.getInstance(),t=(await e.getMcpServers()).servers.filter(e=>e.enabled);f(t)}catch(h){w("Failed to load MCP servers"),f([])}finally{A(!1)}};return(0,W.jsxs)(i.A,{children:[(0,W.jsx)(Se.A,{multiple:a,open:g,onOpen:()=>p(!0),onClose:()=>p(!1),value:a?y||[]:y||null,onChange:(e,t)=>{if(b(t),t)if(a){const e=(Array.isArray(t)?t:[t]).map(e=>e.name);n(e)}else{const e=Array.isArray(t)?t[0]:t;n((null==e?void 0:e.name)||null)}else n(a?[]:null)},options:x,getOptionLabel:e=>e.name+" ("+e.server_type+")",renderOption:(e,t)=>(0,W.jsxs)(i.A,Object.assign({component:"li"},e,{children:[(0,W.jsx)(et.A,{sx:{mr:2,color:"primary.main"}}),(0,W.jsxs)(i.A,{children:[(0,W.jsx)(c.A,{variant:"body2",fontWeight:"medium",children:t.name}),(0,W.jsxs)(c.A,{variant:"caption",color:"text.secondary",children:[t.server_type," \u2022 ",t.server_url||"No URL"]})]})]})),renderTags:a?(e,t)=>e.map((e,n)=>(0,s.createElement)(V.A,Object.assign({},t({index:n}),{key:e.name,label:e.name,size:"small",color:"primary",variant:"outlined"}))):void 0,loading:v,disabled:l,fullWidth:m,isOptionEqualToValue:(e,t)=>e.name===t.name,renderInput:e=>(0,W.jsx)(U.A,Object.assign({},e,{label:o,placeholder:y&&(a?y.length>0:y)?"":r,required:d,error:h||!!j,InputProps:Object.assign({},e.InputProps,{startAdornment:(0,W.jsx)(ae.A,{position:"start",children:(0,W.jsx)(et.A,{color:"action"})}),endAdornment:(0,W.jsxs)(W.Fragment,{children:[v?(0,W.jsx)(Y.A,{color:"inherit",size:20}):null,e.InputProps.endAdornment]})})})),noOptionsText:j?(0,W.jsx)(i.A,{sx:{p:2,textAlign:"center"},children:(0,W.jsx)(c.A,{color:"error",variant:"body2",children:j})}):v?(0,W.jsxs)(i.A,{sx:{p:2,textAlign:"center"},children:[(0,W.jsx)(Y.A,{size:20}),(0,W.jsx)(c.A,{variant:"body2",sx:{ml:1},children:"Loading MCP servers..."})]}):(0,W.jsxs)(i.A,{sx:{p:2,textAlign:"center"},children:[(0,W.jsx)(c.A,{variant:"body2",color:"text.secondary",children:"No enabled MCP servers found"}),(0,W.jsx)(c.A,{variant:"caption",color:"text.secondary",children:"Configure MCP servers in Settings \u2192 Configuration \u2192 MCP"})]})}),(u||j)&&(0,W.jsx)($e.A,{error:h||!!j,children:j||u})]})};var at=n(249),st=n(26050),it=n(14195),ot=n(83563),rt=n(4983),lt=n(92900),ct=n(73175),dt=n(98818),ut=n(39309),ht=n(55858);const mt=e=>{let{open:t,onClose:n}=e;return(0,W.jsxs)(o.A,{open:t,onClose:n,maxWidth:"md",fullWidth:!0,PaperProps:{sx:{borderRadius:2,minHeight:"80vh"}},children:[(0,W.jsx)(l.A,{children:(0,W.jsxs)(i.A,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[(0,W.jsxs)(i.A,{sx:{display:"flex",alignItems:"center",gap:1},children:[(0,W.jsx)(dt.A,{color:"primary"}),(0,W.jsx)(c.A,{variant:"h6",children:"Agent Best Practices"})]}),(0,W.jsx)(d.A,{onClick:n,size:"small",children:(0,W.jsx)(N.A,{})})]})}),(0,W.jsx)(r.A,{dividers:!0,children:(0,W.jsxs)(i.A,{sx:{py:2},children:[(0,W.jsx)(h.A,{severity:"info",sx:{mb:3},children:"Agents are autonomous units that perform specific tasks. They combine a role, goal, backstory, and tools to accomplish their objectives effectively."}),(0,W.jsxs)(_e.A,{elevation:0,sx:{p:3,mb:3,bgcolor:"background.default"},children:[(0,W.jsxs)(c.A,{variant:"h6",gutterBottom:!0,sx:{display:"flex",alignItems:"center",gap:1},children:[(0,W.jsx)(lt.A,{color:"primary"}),"Core Principles"]}),(0,W.jsxs)(at.A,{children:[(0,W.jsxs)(st.Ay,{children:[(0,W.jsx)(it.A,{children:(0,W.jsx)(rt.A,{color:"success"})}),(0,W.jsx)(ot.A,{primary:"Single Responsibility",secondary:"Each agent should focus on one specific area of expertise. Avoid creating agents that try to do everything."})]}),(0,W.jsxs)(st.Ay,{children:[(0,W.jsx)(it.A,{children:(0,W.jsx)(rt.A,{color:"success"})}),(0,W.jsx)(ot.A,{primary:"Clear Role Definition",secondary:"Define the agent's role precisely. For example: 'Senior Data Analyst' instead of just 'Analyst'."})]}),(0,W.jsxs)(st.Ay,{children:[(0,W.jsx)(it.A,{children:(0,W.jsx)(rt.A,{color:"success"})}),(0,W.jsx)(ot.A,{primary:"Actionable Goals",secondary:"Set specific, measurable goals that the agent can achieve. Avoid vague objectives."})]})]})]}),(0,W.jsxs)(_e.A,{elevation:0,sx:{p:3,mb:3,bgcolor:"background.default"},children:[(0,W.jsxs)(c.A,{variant:"h6",gutterBottom:!0,sx:{display:"flex",alignItems:"center",gap:1},children:[(0,W.jsx)(ht.A,{color:"primary"}),"Writing Effective Agent Descriptions"]}),(0,W.jsxs)(i.A,{sx:{mt:2},children:[(0,W.jsx)(c.A,{variant:"subtitle1",fontWeight:"medium",gutterBottom:!0,children:"Role"}),(0,W.jsx)(c.A,{variant:"body2",color:"text.secondary",paragraph:!0,children:"Define WHO the agent is. Be specific about their expertise level and domain."}),(0,W.jsx)(i.A,{sx:{bgcolor:"grey.100",p:2,borderRadius:1,mb:2},children:(0,W.jsxs)(c.A,{variant:"body2",fontFamily:"monospace",children:["\u2705 Good: ",'"Senior Python Developer specializing in API development"',(0,W.jsx)("br",{}),"\u274c Poor: ",'"Developer"']})})]}),(0,W.jsxs)(i.A,{sx:{mt:2},children:[(0,W.jsx)(c.A,{variant:"subtitle1",fontWeight:"medium",gutterBottom:!0,children:"Goal"}),(0,W.jsx)(c.A,{variant:"body2",color:"text.secondary",paragraph:!0,children:"Define WHAT the agent should achieve. Make it specific and measurable."}),(0,W.jsx)(i.A,{sx:{bgcolor:"grey.100",p:2,borderRadius:1,mb:2},children:(0,W.jsxs)(c.A,{variant:"body2",fontFamily:"monospace",children:["\u2705 Good: ",'"Design and implement RESTful APIs with proper error handling and documentation"',(0,W.jsx)("br",{}),"\u274c Poor: ",'"Write code"']})})]}),(0,W.jsxs)(i.A,{sx:{mt:2},children:[(0,W.jsx)(c.A,{variant:"subtitle1",fontWeight:"medium",gutterBottom:!0,children:"Backstory"}),(0,W.jsx)(c.A,{variant:"body2",color:"text.secondary",paragraph:!0,children:"Provide context that helps the agent understand their approach and constraints."}),(0,W.jsx)(i.A,{sx:{bgcolor:"grey.100",p:2,borderRadius:1,mb:2},children:(0,W.jsxs)(c.A,{variant:"body2",fontFamily:"monospace",children:["\u2705 Good: ",'"You have 10 years of experience building scalable systems. You prioritize clean, maintainable code and always consider security implications."',(0,W.jsx)("br",{}),"\u274c Poor: ",'"You are experienced"']})})]})]}),(0,W.jsxs)(_e.A,{elevation:0,sx:{p:3,mb:3,bgcolor:"background.default"},children:[(0,W.jsxs)(c.A,{variant:"h6",gutterBottom:!0,sx:{display:"flex",alignItems:"center",gap:1},children:[(0,W.jsx)(ut.A,{color:"primary"}),"Tool Selection"]}),(0,W.jsxs)(at.A,{children:[(0,W.jsxs)(st.Ay,{children:[(0,W.jsx)(it.A,{children:(0,W.jsx)(rt.A,{color:"success"})}),(0,W.jsx)(ot.A,{primary:"Minimal Tool Set",secondary:"Only assign tools that are essential for the agent's tasks. Too many tools can confuse the agent."})]}),(0,W.jsxs)(st.Ay,{children:[(0,W.jsx)(it.A,{children:(0,W.jsx)(rt.A,{color:"success"})}),(0,W.jsx)(ot.A,{primary:"Tool Relevance",secondary:"Ensure each tool directly relates to the agent's goal and role."})]}),(0,W.jsxs)(st.Ay,{children:[(0,W.jsx)(it.A,{children:(0,W.jsx)(rt.A,{color:"success"})}),(0,W.jsx)(ot.A,{primary:"Custom Tools",secondary:"Create custom tools for specific needs rather than overloading agents with generic ones."})]})]})]}),(0,W.jsxs)(_e.A,{elevation:0,sx:{p:3,mb:3,bgcolor:"error.50"},children:[(0,W.jsxs)(c.A,{variant:"h6",gutterBottom:!0,sx:{display:"flex",alignItems:"center",gap:1,color:"error.main"},children:[(0,W.jsx)(ct.A,{color:"error"}),"Common Pitfalls to Avoid"]}),(0,W.jsxs)(at.A,{children:[(0,W.jsxs)(st.Ay,{children:[(0,W.jsx)(it.A,{children:(0,W.jsx)(ct.A,{color:"error"})}),(0,W.jsx)(ot.A,{primary:"Overlapping Responsibilities",secondary:"Don't create agents with overlapping roles. This causes confusion and inefficiency."})]}),(0,W.jsxs)(st.Ay,{children:[(0,W.jsx)(it.A,{children:(0,W.jsx)(ct.A,{color:"error"})}),(0,W.jsx)(ot.A,{primary:"Vague Instructions",secondary:"Avoid ambiguous language in roles and goals. Be explicit about expectations."})]}),(0,W.jsxs)(st.Ay,{children:[(0,W.jsx)(it.A,{children:(0,W.jsx)(ct.A,{color:"error"})}),(0,W.jsx)(ot.A,{primary:"Over-complexity",secondary:"Don't make agents too complex. Break down complex roles into multiple specialized agents."})]}),(0,W.jsxs)(st.Ay,{children:[(0,W.jsx)(it.A,{children:(0,W.jsx)(ct.A,{color:"error"})}),(0,W.jsx)(ot.A,{primary:"Ignoring Dependencies",secondary:"Consider how agents will interact. Define clear handoff points and communication patterns."})]})]})]}),(0,W.jsxs)(_e.A,{elevation:0,sx:{p:3,bgcolor:"success.50"},children:[(0,W.jsxs)(c.A,{variant:"h6",gutterBottom:!0,sx:{display:"flex",alignItems:"center",gap:1,color:"success.main"},children:[(0,W.jsx)(rt.A,{color:"success"}),"Quick Checklist"]}),(0,W.jsxs)(at.A,{dense:!0,children:[(0,W.jsxs)(st.Ay,{children:[(0,W.jsx)(it.A,{children:(0,W.jsx)(rt.A,{color:"success",fontSize:"small"})}),(0,W.jsx)(ot.A,{primary:"Is the role specific and clear?"})]}),(0,W.jsxs)(st.Ay,{children:[(0,W.jsx)(it.A,{children:(0,W.jsx)(rt.A,{color:"success",fontSize:"small"})}),(0,W.jsx)(ot.A,{primary:"Is the goal measurable and achievable?"})]}),(0,W.jsxs)(st.Ay,{children:[(0,W.jsx)(it.A,{children:(0,W.jsx)(rt.A,{color:"success",fontSize:"small"})}),(0,W.jsx)(ot.A,{primary:"Does the backstory provide useful context?"})]}),(0,W.jsxs)(st.Ay,{children:[(0,W.jsx)(it.A,{children:(0,W.jsx)(rt.A,{color:"success",fontSize:"small"})}),(0,W.jsx)(ot.A,{primary:"Are all assigned tools necessary?"})]}),(0,W.jsxs)(st.Ay,{children:[(0,W.jsx)(it.A,{children:(0,W.jsx)(rt.A,{color:"success",fontSize:"small"})}),(0,W.jsx)(ot.A,{primary:"Is the agent focused on a single responsibility?"})]}),(0,W.jsxs)(st.Ay,{children:[(0,W.jsx)(it.A,{children:(0,W.jsx)(rt.A,{color:"success",fontSize:"small"})}),(0,W.jsx)(ot.A,{primary:"Have you avoided overlapping with other agents?"})]})]})]})]})}),(0,W.jsx)(H.A,{sx:{px:3,py:2},children:(0,W.jsx)(g.A,{onClick:n,variant:"contained",color:"primary",children:"Close"})})]})},gt={"databricks-llama-4-maverick":{name:"databricks-llama-4-maverick",temperature:.7,context_window:128e3,max_output_tokens:4096,enabled:!0}},pt=e=>{var t,n;let{initialData:a,onCancel:u,onAgentSaved:m,tools:p,isCreateMode:x}=e;const{updateAgent:f}=(0,Ce.useAgentStore)(),[y,b]=(0,s.useState)(gt),[v,A]=(0,s.useState)(!0),[j,w]=(0,s.useState)(!1),[k,C]=(0,s.useState)(!1),[S,_]=(0,s.useState)(!1),[E,I]=(0,s.useState)(!1),[T,D]=(0,s.useState)(!1),[O,P]=(0,s.useState)(null),[z,L]=(0,s.useState)({}),[R,F]=(0,s.useState)({}),[B,K]=(0,s.useState)([]),[G,q]=(0,s.useState)((null==a?void 0:a.tool_configs)||{}),J=Object.entries(y).filter(e=>{let[t,n]=e;return"openai"===n.provider||"anthropic"===n.provider}),[X,Z]=(0,s.useState)(()=>{var e,t,n;const s=null!=a&&a.id?void 0:we.getInstance().getDefaultConfig(),i={name:(null==a?void 0:a.name)||"",role:(null==a?void 0:a.role)||"",goal:(null==a?void 0:a.goal)||"",backstory:(null==a?void 0:a.backstory)||"",llm:(null==a?void 0:a.llm)||"databricks-llama-4-maverick",temperature:(null==a?void 0:a.temperature)||void 0,tools:null!=a&&a.tools?a.tools.map(e=>String(e)):[],function_calling_llm:(null==a?void 0:a.function_calling_llm)||void 0,max_iter:(null==a?void 0:a.max_iter)||25,max_rpm:(null==a?void 0:a.max_rpm)||1,max_execution_time:(null==a?void 0:a.max_execution_time)||300,memory:null==(e=null==a?void 0:a.memory)||e,verbose:null!=(t=null==a?void 0:a.verbose)&&t,allow_delegation:(null==a?void 0:a.allow_delegation)||!1,cache:null==(n=null==a?void 0:a.cache)||n,system_template:(null==a?void 0:a.system_template)||void 0,prompt_template:(null==a?void 0:a.prompt_template)||void 0,response_template:(null==a?void 0:a.response_template)||void 0,allow_code_execution:(null==a?void 0:a.allow_code_execution)||!1,code_execution_mode:(null==a?void 0:a.code_execution_mode)||"safe",max_retry_limit:(null==a?void 0:a.max_retry_limit)||3,use_system_prompt:(null==a?void 0:a.use_system_prompt)||!0,respect_context_window:(null==a?void 0:a.respect_context_window)||!0,embedder_config:(null==a?void 0:a.embedder_config)||{provider:"databricks",config:{model:"databricks-gte-large-en"}},knowledge_sources:(null==a?void 0:a.knowledge_sources)||[],memory_backend_config:(null==a?void 0:a.memory_backend_config)||s||void 0};return null!=a&&a.id?Object.assign({},i,{id:a.id}):i});(0,s.useEffect)(()=>{if(null!=a&&a.tool_configs){q(a.tool_configs);const e=a.tool_configs.GenieTool;if(e){const t=e.spaceId||e.space_id,n=e.spaceName||e.space_name||t;t&&"string"===typeof t&&P({id:t,name:n})}if(a.tool_configs.PerplexityTool&&L(a.tool_configs.PerplexityTool),a.tool_configs.SerperDevTool&&F(a.tool_configs.SerperDevTool),a.tool_configs.MCP_SERVERS){const e=a.tool_configs.MCP_SERVERS,t=Array.isArray(e.servers)?e.servers:Array.isArray(a.tool_configs.MCP_SERVERS)?a.tool_configs.MCP_SERVERS:[];K(t)}}},[null==a?void 0:a.tool_configs]),(0,s.useEffect)(()=>{(async()=>{try{A(!0);const e=ye.J.getInstance(),t=await e.getActiveModels();if(Object.keys(t).length>0){b(t);const e=X.llm;if(e&&!t[e]){const e=Object.keys(t)[0];Z(t=>Object.assign({},t,{llm:e}))}}}catch(e){}finally{A(!1)}})()},[]);const[$,ee]=(0,s.useState)(!1),[be,ve]=(0,s.useState)(!1),je=(e,t)=>{Z(n=>Object.assign({},n,{[e]:t}))},Se=e=>{const t=(Array.isArray(e.target.value)?e.target.value:[e.target.value]).map(e=>String(e)),n=new Map;t.forEach(e=>{const t=n.get(e)||0;n.set(e,t+1)});Array.from(n.entries()).filter(e=>{let[t,n]=e;return n>1}).map(e=>{let[t]=e;return t}).length;const s=Array.from(new Set(t));je("tools",s),null!=a&&a.id&&f(a.id,{tools:s})},_e=Boolean(X.role&&X.goal&&X.backstory),Ee=()=>{w(!1)},Ie=()=>{C(!1)},Te=()=>{_(!1)},De=()=>{I(!1)},Oe=()=>{D(!1)};return(0,W.jsxs)(W.Fragment,{children:[(0,W.jsxs)(te.A,{sx:{display:"flex",flexDirection:"column",height:"70vh",position:"relative",overflow:"hidden"},children:[!x&&(0,W.jsxs)(i.A,{sx:{p:3,pb:2},children:[(0,W.jsxs)(i.A,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:3},children:[(0,W.jsx)(c.A,{variant:"h6",children:null!=a&&a.id?"Edit Agent":"Create New Agent"}),(0,W.jsx)(g.A,{startIcon:(0,W.jsx)(pe.A,{}),onClick:()=>ve(!0),variant:"outlined",size:"small",sx:{ml:2},children:"Best Practices"})]}),(0,W.jsx)(ne.A,{})]}),(0,W.jsx)(i.A,{sx:{flex:"1 1 auto",overflow:"auto",px:3,pb:2,pt:x?3:0,height:x?"calc(90vh - 120px)":"calc(90vh - 170px)"},children:(0,W.jsxs)(i.A,{sx:{display:"flex",flexDirection:"column",gap:2},children:[(0,W.jsx)(U.A,{fullWidth:!0,label:"Name",value:X.name,onChange:e=>je("name",e.target.value),required:!0,margin:"normal",sx:{"& .MuiOutlinedInput-root":{"& fieldset":{borderColor:"rgba(0, 0, 0, 0.23)"}},"& .MuiInputLabel-root":{backgroundColor:"white",padding:"0 4px"}}}),(0,W.jsx)(U.A,{fullWidth:!0,label:"Role",value:X.role,onChange:e=>je("role",e.target.value),required:!0}),(0,W.jsx)(U.A,{fullWidth:!0,label:"Goal",value:X.goal,onChange:e=>je("goal",e.target.value),multiline:!0,rows:2,required:!0,InputProps:{endAdornment:(0,W.jsx)(ae.A,{position:"end",children:(0,W.jsx)(d.A,{edge:"end",onClick:()=>{w(!0)},size:"small",sx:{opacity:.7},title:"Expand goal",children:(0,W.jsx)(xe.A,{fontSize:"small"})})})}}),(0,W.jsx)(U.A,{fullWidth:!0,label:"Backstory",value:X.backstory,onChange:e=>je("backstory",e.target.value),multiline:!0,rows:3,required:!0,InputProps:{endAdornment:(0,W.jsx)(ae.A,{position:"end",children:(0,W.jsx)(d.A,{edge:"end",onClick:()=>{C(!0)},size:"small",sx:{opacity:.7},title:"Expand backstory",children:(0,W.jsx)(xe.A,{fontSize:"small"})})})}}),(0,W.jsxs)(se.A,{children:[(0,W.jsx)(ie.A,{expandIcon:(0,W.jsx)(ge.A,{}),children:(0,W.jsx)(c.A,{children:"Templates"})}),(0,W.jsx)(oe.A,{children:(0,W.jsxs)(i.A,{sx:{display:"flex",flexDirection:"column",gap:2},children:[(0,W.jsx)(i.A,{sx:{display:"flex",justifyContent:"flex-end",mb:2},children:(0,W.jsx)(g.A,{variant:"contained",onClick:async()=>{if(X.role&&X.goal&&X.backstory){ee(!0);try{const e=await Ae.generateTemplates({role:X.role,goal:X.goal,backstory:X.backstory,model:X.llm});e&&(je("system_template",e.system_template),je("prompt_template",e.prompt_template),je("response_template",e.response_template))}catch(e){}finally{ee(!1)}}},disabled:!_e||$,children:$?"Generating...":"Generate Templates"})}),(0,W.jsx)(U.A,{fullWidth:!0,label:"System Template",value:X.system_template||"",onChange:e=>je("system_template",e.target.value),multiline:!0,rows:4,InputProps:{endAdornment:(0,W.jsx)(ae.A,{position:"end",children:(0,W.jsx)(d.A,{edge:"end",onClick:()=>{_(!0)},size:"small",sx:{opacity:.7},title:"Expand system template",children:(0,W.jsx)(xe.A,{fontSize:"small"})})})}}),(0,W.jsxs)(c.A,{variant:"caption",color:"text.secondary",sx:{mt:.5,mb:1},children:["Defines the agent's core identity and fundamental instructions. Controls how the agent understands its ","{role}",", ","{goal}",", and ","{backstory}",". Use this to establish expertise boundaries, ethical guidelines, and overall behavior patterns."]}),(0,W.jsx)(U.A,{fullWidth:!0,label:"Prompt Template",value:X.prompt_template||"",onChange:e=>je("prompt_template",e.target.value),multiline:!0,rows:4,InputProps:{endAdornment:(0,W.jsx)(ae.A,{position:"end",children:(0,W.jsx)(d.A,{edge:"end",onClick:()=>{I(!0)},size:"small",sx:{opacity:.7},title:"Expand prompt template",children:(0,W.jsx)(xe.A,{fontSize:"small"})})})}}),(0,W.jsxs)(c.A,{variant:"caption",color:"text.secondary",sx:{mt:.5,mb:1},children:["Structures how tasks are presented to the agent. Controls the format and flow of task instructions. Include placeholders for dynamic content like ","{input}",", ","{context}",", and task-specific variables to ensure consistent task processing."]}),(0,W.jsx)(U.A,{fullWidth:!0,label:"Response Template",value:X.response_template||"",onChange:e=>je("response_template",e.target.value),multiline:!0,rows:4,InputProps:{endAdornment:(0,W.jsx)(ae.A,{position:"end",children:(0,W.jsx)(d.A,{edge:"end",onClick:()=>{D(!0)},size:"small",sx:{opacity:.7},title:"Expand response template",children:(0,W.jsx)(xe.A,{fontSize:"small"})})})}}),(0,W.jsx)(c.A,{variant:"caption",color:"text.secondary",sx:{mt:.5,mb:1},children:"Guides how the agent formats its responses and output structure. Enforces consistency in deliverables by defining sections like THOUGHTS, ACTION, and RESULT. Use this to ensure structured, actionable, and predictable agent outputs."})]})})]}),(0,W.jsxs)(re.A,{fullWidth:!0,children:[(0,W.jsx)(le.A,{id:"tools-label",children:"Tools"}),(0,W.jsx)(ce.A,{labelId:"tools-label",multiple:!0,value:X.tools,onChange:Se,label:"Tools",renderValue:e=>(0,W.jsx)(i.A,{sx:{display:"flex",flexWrap:"wrap",gap:.5},children:e.map((e,t)=>{const n=p.find(t=>String(t.id)===String(e)),a=n?n.title:"DatabricksKnowledgeSearchTool"===String(e)?"Databricks Knowledge Search Tool":String(e);return(0,W.jsx)(V.A,{label:a,size:"small",onDelete:()=>{(e=>{const t=X.tools.filter(t=>String(t)!==String(e));Se({target:{value:t}})})(e)},onMouseDown:e=>{e.stopPropagation()},deleteIcon:(0,W.jsx)(Q.A,{fontSize:"small",sx:{fontSize:"16px !important"}})},"selected-tool-"+e+"-"+t)})}),children:p.map(e=>(0,W.jsx)(de.A,{value:String(e.id),children:(0,W.jsxs)(i.A,{sx:{display:"flex",flexDirection:"column"},children:[(0,W.jsx)(c.A,{children:e.title}),(0,W.jsx)(c.A,{variant:"caption",color:"text.secondary",children:e.description})]})},"tool-"+e.id))})]}),X.tools.some(e=>{const t=p.find(t=>String(t.id)===String(e));return"GenieTool"===(null==t?void 0:t.title)})&&(0,W.jsxs)(i.A,{sx:{mt:2},children:[(0,W.jsx)(c.A,{variant:"subtitle2",sx:{mb:1},children:"Genie Space"}),O?(0,W.jsx)(M.A,{title:"Space ID: "+O.id+" - Click to open in Databricks",arrow:!0,children:(0,W.jsx)(V.A,{label:O.name,size:"medium",color:"primary",variant:"outlined",onClick:async e=>{if(e.stopPropagation(),O)try{const e=ke.O.getInstance(),t=await e.getDatabricksConfig();if(t&&t.workspace_url){let e=t.workspace_url.startsWith("https://")?t.workspace_url:"https://"+t.workspace_url;e=e.replace(/\/$/,"");const n=e+"/genie/rooms/"+O.id+"/monitoring";window.open(n,"_blank","noopener,noreferrer")}else alert("Databricks workspace URL is not configured. Please configure it in Settings > Configuration > Databricks.")}catch(t){alert("Error opening Genie space. Please check the console for details.")}},onDelete:()=>{P(null),q(e=>{const t=Object.assign({},e);return delete t.GenieTool,t})},deleteIcon:(0,W.jsx)(Q.A,{fontSize:"small"}),sx:{cursor:"pointer","&:hover":{backgroundColor:"rgba(25, 118, 210, 0.08)"}}})}):(0,W.jsx)(i.A,{sx:{display:"flex",alignItems:"center",gap:1},children:(0,W.jsx)(Pe,{value:"",onChange:(e,t)=>{e&&(P({id:e,name:t||e}),q(n=>Object.assign({},n,{GenieTool:{spaceId:e,spaceName:t||e}})))},label:"",placeholder:"Select a Genie space...",helperText:"",fullWidth:!0})})]}),X.tools.some(e=>{const t=p.find(t=>String(t.id)===String(e));return"PerplexityTool"===(null==t?void 0:t.title)})&&(0,W.jsx)(i.A,{sx:{mt:2},children:(0,W.jsx)(qe,{value:z,onChange:e=>{L(e),q(t=>Object.assign({},t,{PerplexityTool:e}))},label:"Perplexity Configuration",helperText:"Configure Perplexity AI search parameters for this agent",fullWidth:!0})}),X.tools.some(e=>{const t=p.find(t=>String(t.id)===String(e));return"SerperDevTool"===(null==t?void 0:t.title)})&&(0,W.jsx)(i.A,{sx:{mt:2},children:(0,W.jsx)(Ze,{value:R,onChange:e=>{F(e),q(t=>Object.assign({},t,{SerperDevTool:e}))},label:"Serper Configuration",helperText:"Configure Serper.dev search parameters for this agent",fullWidth:!0})}),(0,W.jsxs)(i.A,{sx:{mt:2},children:[B.length>0&&(0,W.jsxs)(i.A,{sx:{mb:2,p:2,backgroundColor:"rgba(25, 118, 210, 0.04)",borderRadius:1,border:"1px solid rgba(25, 118, 210, 0.12)"},children:[(0,W.jsxs)(c.A,{variant:"subtitle2",color:"primary",sx:{mb:1,fontWeight:600,fontSize:"0.875rem"},children:["Selected MCP Servers (",B.length,")"]}),(0,W.jsx)(i.A,{sx:{display:"flex",flexWrap:"wrap",gap:1},children:B.map(e=>(0,W.jsx)(V.A,{label:e,size:"medium",color:"primary",variant:"filled",onDelete:()=>{const t=B.filter(t=>t!==e);K(t),q(e=>Object.assign({},e,{MCP_SERVERS:t}))},sx:{"& .MuiChip-deleteIcon":{fontSize:"18px","&:hover":{color:"error.main"}},fontWeight:500}},e))})]}),(0,W.jsx)(nt,{value:B,onChange:e=>{const t=Array.isArray(e)?e:e?[e]:[];K(t),q(e=>Object.assign({},e,{MCP_SERVERS:t}))},label:"MCP Servers",placeholder:"Select MCP servers for this agent...",helperText:"Choose which MCP (Model Context Protocol) servers this agent should have access to",multiple:!0,fullWidth:!0})]}),(0,W.jsxs)(se.A,{children:[(0,W.jsx)(ie.A,{expandIcon:(0,W.jsx)(ge.A,{}),children:(0,W.jsx)(c.A,{children:"LLM Configuration"})}),(0,W.jsx)(oe.A,{children:(0,W.jsxs)(ue.Ay,{container:!0,spacing:2,children:[(0,W.jsx)(ue.Ay,{item:!0,xs:12,children:(0,W.jsxs)(re.A,{fullWidth:!0,children:[(0,W.jsx)(le.A,{children:"LLM Model"}),(0,W.jsx)(ce.A,{value:v?"":X.llm,onChange:e=>je("llm",e.target.value),label:"LLM Model",disabled:v,children:v?(0,W.jsx)(de.A,{value:"",disabled:!0,children:(0,W.jsxs)(i.A,{sx:{display:"flex",alignItems:"center"},children:[(0,W.jsx)(Y.A,{size:20,sx:{mr:1}}),"Loading models..."]})},"loading-models"):Object.keys(y).length>0?Object.entries(y).map(e=>{let[t,n]=e;return(0,W.jsxs)(de.A,{value:t,children:[n.name,n.provider&&(0,W.jsxs)(c.A,{variant:"caption",sx:{ml:1,color:"text.secondary"},children:["(",n.provider,")"]})]},"llm-model-"+t)}):(0,W.jsxs)(de.A,{value:X.llm,children:[X.llm||"Default Model"," (No models available)"]},"no-models")})]})}),(0,W.jsx)(ue.Ay,{item:!0,xs:12,children:(0,W.jsx)(U.A,{fullWidth:!0,type:"number",label:"Temperature Override (0-100)",value:X.temperature||"",onChange:e=>{const t=e.target.value?parseInt(e.target.value):void 0;(void 0===t||t>=0&&t<=100)&&je("temperature",t)},helperText:"Override the default model temperature. 0 = deterministic, 100 = creative. Leave empty to use model default.",InputProps:{inputProps:{min:0,max:100}}})}),(0,W.jsx)(ue.Ay,{item:!0,xs:12,children:(0,W.jsxs)(re.A,{fullWidth:!0,children:[(0,W.jsx)(le.A,{children:"Function Calling LLM"}),(0,W.jsxs)(ce.A,{value:v?"":X.function_calling_llm||"",onChange:e=>je("function_calling_llm",e.target.value),label:"Function Calling LLM",disabled:v,children:[(0,W.jsx)(de.A,{value:"",children:(0,W.jsx)("em",{children:"Default"})},"default-function-model"),v?(0,W.jsx)(de.A,{value:"",disabled:!0,children:(0,W.jsxs)(i.A,{sx:{display:"flex",alignItems:"center"},children:[(0,W.jsx)(Y.A,{size:20,sx:{mr:1}}),"Loading models..."]})},"loading-function-models"):J.length>0?J.map(e=>{let[t,n]=e;return(0,W.jsxs)(de.A,{value:t,children:[n.name,n.provider&&(0,W.jsxs)(c.A,{variant:"caption",sx:{ml:1,color:"text.secondary"},children:["(",n.provider,")"]})]},"func-model-"+t)}):(0,W.jsx)(de.A,{value:X.function_calling_llm||"",disabled:!0,children:"No function calling models available"},"no-function-models")]})]})})]})})]}),(0,W.jsxs)(se.A,{children:[(0,W.jsx)(ie.A,{expandIcon:(0,W.jsx)(ge.A,{}),children:(0,W.jsx)(c.A,{children:"Execution Settings"})}),(0,W.jsx)(oe.A,{children:(0,W.jsxs)(ue.Ay,{container:!0,spacing:2,children:[(0,W.jsx)(ue.Ay,{item:!0,xs:12,md:4,children:(0,W.jsx)(U.A,{fullWidth:!0,type:"number",label:"Max Iterations",value:X.max_iter,onChange:e=>je("max_iter",parseInt(e.target.value))})}),(0,W.jsx)(ue.Ay,{item:!0,xs:12,md:4,children:(0,W.jsx)(U.A,{fullWidth:!0,type:"number",label:"Max RPM",value:X.max_rpm||"",onChange:e=>je("max_rpm",e.target.value?parseInt(e.target.value):void 0)})}),(0,W.jsx)(ue.Ay,{item:!0,xs:12,md:4,children:(0,W.jsx)(U.A,{fullWidth:!0,type:"number",label:"Max Execution Time (s)",value:X.max_execution_time||"",onChange:e=>je("max_execution_time",e.target.value?parseInt(e.target.value):void 0)})}),(0,W.jsx)(ue.Ay,{item:!0,xs:12,md:4,children:(0,W.jsx)(U.A,{fullWidth:!0,type:"number",label:"Max Retry Limit",value:X.max_retry_limit,onChange:e=>je("max_retry_limit",parseInt(e.target.value))})})]})})]}),(0,W.jsxs)(se.A,{children:[(0,W.jsx)(ie.A,{expandIcon:(0,W.jsx)(ge.A,{}),children:(0,W.jsx)(c.A,{children:"Behavior Settings"})}),(0,W.jsx)(oe.A,{children:(0,W.jsxs)(ue.Ay,{container:!0,spacing:2,children:[(0,W.jsx)(ue.Ay,{item:!0,xs:12,md:6,children:(0,W.jsx)(he.A,{control:(0,W.jsx)(me.A,{checked:X.memory,onClick:e=>{e.stopPropagation(),e.preventDefault(),je("memory",!X.memory)},onChange:e=>{e.stopPropagation()},onMouseDown:e=>{e.stopPropagation()},onTouchStart:e=>{e.stopPropagation()}}),label:"Enable Memory",onClick:e=>{e.stopPropagation()}})}),(0,W.jsx)(ue.Ay,{item:!0,xs:12,md:6,children:(0,W.jsx)(he.A,{control:(0,W.jsx)(me.A,{checked:X.verbose,onClick:e=>{e.stopPropagation(),e.preventDefault(),je("verbose",!X.verbose)},onChange:e=>{e.stopPropagation()},onMouseDown:e=>{e.stopPropagation()},onTouchStart:e=>{e.stopPropagation()}}),label:"Verbose Mode",onClick:e=>{e.stopPropagation()}})}),(0,W.jsx)(ue.Ay,{item:!0,xs:12,md:6,children:(0,W.jsx)(he.A,{control:(0,W.jsx)(me.A,{checked:X.allow_delegation,onClick:e=>{e.stopPropagation(),e.preventDefault(),je("allow_delegation",!X.allow_delegation)},onChange:e=>{e.stopPropagation()},onMouseDown:e=>{e.stopPropagation()},onTouchStart:e=>{e.stopPropagation()}}),label:"Allow Delegation",onClick:e=>{e.stopPropagation()}})}),(0,W.jsx)(ue.Ay,{item:!0,xs:12,md:6,children:(0,W.jsx)(he.A,{control:(0,W.jsx)(me.A,{checked:X.cache,onClick:e=>{e.stopPropagation(),e.preventDefault(),je("cache",!X.cache)},onChange:e=>{e.stopPropagation()},onMouseDown:e=>{e.stopPropagation()},onTouchStart:e=>{e.stopPropagation()}}),label:"Enable Cache",onClick:e=>{e.stopPropagation()}})}),(0,W.jsx)(ue.Ay,{item:!0,xs:12,md:6,children:(0,W.jsx)(he.A,{control:(0,W.jsx)(me.A,{checked:X.use_system_prompt,onClick:e=>{e.stopPropagation(),e.preventDefault(),je("use_system_prompt",!X.use_system_prompt)},onChange:e=>{e.stopPropagation()},onMouseDown:e=>{e.stopPropagation()},onTouchStart:e=>{e.stopPropagation()}}),label:"Use System Prompt",onClick:e=>{e.stopPropagation()}})}),(0,W.jsx)(ue.Ay,{item:!0,xs:12,md:6,children:(0,W.jsx)(he.A,{control:(0,W.jsx)(me.A,{checked:X.respect_context_window,onClick:e=>{e.stopPropagation(),e.preventDefault(),je("respect_context_window",!X.respect_context_window)},onChange:e=>{e.stopPropagation()},onMouseDown:e=>{e.stopPropagation()},onTouchStart:e=>{e.stopPropagation()}}),label:"Respect Context Window",onClick:e=>{e.stopPropagation()}})})]})})]}),(0,W.jsxs)(se.A,{children:[(0,W.jsx)(ie.A,{expandIcon:(0,W.jsx)(ge.A,{}),children:(0,W.jsx)(c.A,{children:"Memory Configuration"})}),(0,W.jsx)(oe.A,{children:(0,W.jsxs)(ue.Ay,{container:!0,spacing:2,children:[(0,W.jsx)(ue.Ay,{item:!0,xs:12,children:(0,W.jsx)(c.A,{variant:"subtitle2",sx:{mb:1},children:"Memory provides agents with the ability to remember past interactions and context"})}),(0,W.jsx)(ue.Ay,{item:!0,xs:12,md:6,children:(0,W.jsxs)(re.A,{fullWidth:!0,disabled:!X.memory,children:[(0,W.jsx)(le.A,{children:"Embedding Provider"}),(0,W.jsxs)(ce.A,{value:(null==(t=X.embedder_config)?void 0:t.provider)||"databricks",onChange:e=>{const t=X.embedder_config||{},n=e.target.value;let a="text-embedding-3-small";"databricks"===n?a="databricks-gte-large-en":"ollama"===n?a="nomic-embed-text":"google"===n&&(a="text-embedding-004"),je("embedder_config",Object.assign({},t,{provider:n,config:Object.assign({},t.config||{},{model:a})}))},label:"Embedding Provider",children:[(0,W.jsx)(de.A,{value:"databricks",children:"Databricks (Default)"}),(0,W.jsx)(de.A,{value:"openai",children:"OpenAI"}),(0,W.jsx)(de.A,{value:"ollama",children:"Ollama"}),(0,W.jsx)(de.A,{value:"google",children:"Google AI"}),(0,W.jsx)(de.A,{value:"azure",children:"Azure OpenAI"}),(0,W.jsx)(de.A,{value:"vertex",children:"Vertex AI"}),(0,W.jsx)(de.A,{value:"cohere",children:"Cohere"}),(0,W.jsx)(de.A,{value:"voyage",children:"VoyageAI"}),(0,W.jsx)(de.A,{value:"huggingface",children:"HuggingFace"}),(0,W.jsx)(de.A,{value:"watson",children:"Watson"}),(0,W.jsx)(de.A,{value:"bedrock",children:"Amazon Bedrock"})]})]})}),(0,W.jsx)(ue.Ay,{item:!0,xs:12,md:6,children:(0,W.jsx)(U.A,{fullWidth:!0,label:"Embedding Model",value:(null==(n=X.embedder_config)||null==(n=n.config)?void 0:n.model)||"databricks-gte-large-en",onChange:e=>{const t=X.embedder_config||{provider:"databricks",config:{model:"databricks-gte-large-en"}},n=t.config||{};je("embedder_config",Object.assign({},t,{config:Object.assign({},n,{model:e.target.value})}))},disabled:!X.memory,helperText:"Model to use for text embeddings (e.g., databricks-gte-large-en for Databricks, text-embedding-3-small for OpenAI)"})}),(0,W.jsxs)(ue.Ay,{item:!0,xs:12,children:[(0,W.jsx)(ne.A,{sx:{my:2}}),(0,W.jsx)(h.A,{severity:"info",sx:{mt:2},children:(0,W.jsxs)(c.A,{variant:"body2",children:["Memory storage backend is configured globally in the Configuration settings.",X.memory_backend_config&&(0,W.jsxs)(W.Fragment,{children:[(0,W.jsx)("br",{}),"Current backend: ",(0,W.jsx)("strong",{children:"databricks"===X.memory_backend_config.backend_type?"Databricks Vector Search":"Default (ChromaDB + SQLite)"})]})]})})]}),(0,W.jsxs)(ue.Ay,{item:!0,xs:12,children:[(0,W.jsx)(c.A,{variant:"body2",color:"text.secondary",sx:{mt:1},children:"The agent uses three memory types:"}),(0,W.jsxs)("ul",{style:{color:"rgba(0, 0, 0, 0.6)",paddingLeft:"20px",margin:"4px 0"},children:[(0,W.jsx)("li",{children:"Short-Term Memory: Stores recent conversations and context"}),(0,W.jsx)("li",{children:"Long-Term Memory: Preserves insights and learnings between executions"}),(0,W.jsx)("li",{children:"Entity Memory: Tracks information about important entities"})]})]})]})})]})]})}),(0,W.jsxs)(i.A,{sx:{display:"flex",gap:2,justifyContent:"flex-end",p:2,backgroundColor:"white",borderTop:"1px solid rgba(0, 0, 0, 0.12)",position:"static",width:"100%",zIndex:1100},children:[u&&(0,W.jsx)(g.A,{onClick:u,variant:"outlined",children:"Cancel"}),(0,W.jsx)(g.A,{onClick:async()=>{if(!X)return;const e=JSON.parse(JSON.stringify(X));let t=Object.assign({},G);O&&e.tools.some(e=>{const t=p.find(t=>String(t.id)===String(e));return"GenieTool"===(null==t?void 0:t.title)})?t=Object.assign({},t,{GenieTool:{spaceId:O.id,spaceName:O.name}}):O||delete t.GenieTool,z&&Object.keys(z).length>0&&e.tools.some(e=>{const t=p.find(t=>String(t.id)===String(e));return"PerplexityTool"===(null==t?void 0:t.title)})?t=Object.assign({},t,{PerplexityTool:z}):e.tools.some(e=>{const t=p.find(t=>String(t.id)===String(e));return"PerplexityTool"===(null==t?void 0:t.title)})||delete t.PerplexityTool,R&&Object.keys(R).length>0&&e.tools.some(e=>{const t=p.find(t=>String(t.id)===String(e));return"SerperDevTool"===(null==t?void 0:t.title)})?t=Object.assign({},t,{SerperDevTool:R}):e.tools.some(e=>{const t=p.find(t=>String(t.id)===String(e));return"SerperDevTool"===(null==t?void 0:t.title)})||delete t.SerperDevTool,B&&B.length>0?t=Object.assign({},t,{MCP_SERVERS:{servers:B}}):delete t.MCP_SERVERS,Object.keys(t).length>0&&(e.tool_configs=t),e.memory||(delete e.embedder_config,delete e.memory_backend_config),e.knowledge_sources&&e.knowledge_sources.length>0&&(e.knowledge_sources=e.knowledge_sources.map(e=>"text"!==e.type&&"url"!==e.type&&e.source?Object.assign({},e,{fileInfo:e.fileInfo||{filename:e.source.split("/").pop()||"",path:e.source,exists:!1,is_uploaded:!0}}):e)),ee(!0);try{let t;t=null!=a&&a.id?await fe.AgentService.updateAgentFull(a.id,e):await fe.AgentService.createAgent(e),t&&m&&(t.id&&f(t.id,t),m(t))}catch(n){}finally{ee(!1)}},variant:"contained",color:"primary",children:"Save"})]})]}),(0,W.jsxs)(o.A,{open:j,onClose:Ee,fullWidth:!0,maxWidth:"md",children:[(0,W.jsx)(l.A,{children:(0,W.jsxs)(i.A,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:["Agent Goal",(0,W.jsx)(d.A,{onClick:Ee,children:(0,W.jsx)(N.A,{})})]})}),(0,W.jsx)(r.A,{children:(0,W.jsx)(U.A,{autoFocus:!0,fullWidth:!0,multiline:!0,rows:15,value:X.goal,onChange:e=>je("goal",e.target.value),variant:"outlined",sx:{mt:2}})}),(0,W.jsx)(H.A,{children:(0,W.jsx)(g.A,{onClick:Ee,variant:"contained",children:"Done"})})]}),(0,W.jsxs)(o.A,{open:k,onClose:Ie,fullWidth:!0,maxWidth:"md",children:[(0,W.jsx)(l.A,{children:(0,W.jsxs)(i.A,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:["Agent Backstory",(0,W.jsx)(d.A,{onClick:Ie,children:(0,W.jsx)(N.A,{})})]})}),(0,W.jsx)(r.A,{children:(0,W.jsx)(U.A,{autoFocus:!0,fullWidth:!0,multiline:!0,rows:15,value:X.backstory,onChange:e=>je("backstory",e.target.value),variant:"outlined",sx:{mt:2}})}),(0,W.jsx)(H.A,{children:(0,W.jsx)(g.A,{onClick:Ie,variant:"contained",children:"Done"})})]}),(0,W.jsxs)(o.A,{open:S,onClose:Te,fullWidth:!0,maxWidth:"md",children:[(0,W.jsx)(l.A,{children:(0,W.jsxs)(i.A,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:["System Template",(0,W.jsx)(d.A,{onClick:Te,children:(0,W.jsx)(N.A,{})})]})}),(0,W.jsx)(r.A,{children:(0,W.jsx)(U.A,{autoFocus:!0,fullWidth:!0,multiline:!0,rows:15,value:X.system_template||"",onChange:e=>je("system_template",e.target.value),variant:"outlined",sx:{mt:2}})}),(0,W.jsx)(H.A,{children:(0,W.jsx)(g.A,{onClick:Te,variant:"contained",children:"Done"})})]}),(0,W.jsxs)(o.A,{open:E,onClose:De,fullWidth:!0,maxWidth:"md",children:[(0,W.jsx)(l.A,{children:(0,W.jsxs)(i.A,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:["Prompt Template",(0,W.jsx)(d.A,{onClick:De,children:(0,W.jsx)(N.A,{})})]})}),(0,W.jsx)(r.A,{children:(0,W.jsx)(U.A,{autoFocus:!0,fullWidth:!0,multiline:!0,rows:15,value:X.prompt_template||"",onChange:e=>je("prompt_template",e.target.value),variant:"outlined",sx:{mt:2}})}),(0,W.jsx)(H.A,{children:(0,W.jsx)(g.A,{onClick:De,variant:"contained",children:"Done"})})]}),(0,W.jsxs)(o.A,{open:T,onClose:Oe,fullWidth:!0,maxWidth:"md",children:[(0,W.jsx)(l.A,{children:(0,W.jsxs)(i.A,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:["Response Template",(0,W.jsx)(d.A,{onClick:Oe,children:(0,W.jsx)(N.A,{})})]})}),(0,W.jsx)(r.A,{children:(0,W.jsx)(U.A,{autoFocus:!0,fullWidth:!0,multiline:!0,rows:15,value:X.response_template||"",onChange:e=>je("response_template",e.target.value),variant:"outlined",sx:{mt:2}})}),(0,W.jsx)(H.A,{children:(0,W.jsx)(g.A,{onClick:Oe,variant:"contained",children:"Done"})})]}),(0,W.jsx)(mt,{open:be,onClose:()=>ve(!1)})]})};var xt=n(95849);const ft=()=>{const{getActiveTab:e,markTabDirty:t}=k();return{markCurrentTabDirty:(0,s.useCallback)(()=>{const n=e();n&&(t(n.id),window.dispatchEvent(new CustomEvent("tabMarkedDirty",{detail:{tabId:n.id,tabName:n.name}})))},[e,t]),markTabDirtyById:(0,s.useCallback)(e=>{t(e),window.dispatchEvent(new CustomEvent("tabMarkedDirty",{detail:{tabId:e}}))},[t])}},yt=e=>{var t;let{data:n,id:a}=e;const{setNodes:l,setEdges:u,getNodes:h,getEdges:m}=(0,y.VH)(),[g,p]=(0,s.useState)(!1),[x,f]=(0,s.useState)([]),[b,A]=(0,s.useState)(!1),{markCurrentTabDirty:j}=ft(),{getAgent:w,updateAgent:k}=(0,Ce.useAgentStore)(),[C,S]=(0,s.useState)(null),_=(0,E.z)(e=>e.layoutOrientation),I=(0,v.E)(e=>e.processType);(0,s.useEffect)(()=>{if(n.agentId){const e=async()=>{const e=await w(n.agentId);S(e)};e()}},[n.agentId,w]),(0,s.useEffect)(()=>{T()},[]);const T=async()=>{try{const e=await xt.m.listEnabledTools();f(e.map(e=>Object.assign({},e,{id:String(e.id)})))}catch(e){}},D=(0,s.useCallback)(()=>{A(e=>!e)},[a,b]),O=(0,s.useCallback)(()=>{l(e=>e.filter(e=>e.id!==a)),u(e=>e.filter(e=>e.source!==a&&e.target!==a))},[a,l,u]),N=(0,s.useCallback)(async()=>{try{document.activeElement&&document.activeElement.blur();const e=n.agentId||n.id||n.agent_id;if(!e){const e={id:void 0,name:String(n.label||n.name||""),role:String(n.role||""),goal:String(n.goal||""),backstory:String(n.backstory||""),llm:String(n.llm||""),tools:n.tools||[],max_iter:n.max_iter||25,verbose:n.verbose||!1,allow_delegation:n.allow_delegation||!1,cache:n.cache||!0,allow_code_execution:n.allow_code_execution||!1,code_execution_mode:"unsafe"===n.code_execution_mode?"unsafe":"safe",memory:n.memory,tool_configs:n.tool_configs,temperature:"number"===typeof n.temperature?n.temperature:void 0,function_calling_llm:n.function_calling_llm,max_rpm:n.max_rpm,max_execution_time:n.max_execution_time,embedder_config:n.embedder_config,knowledge_sources:n.knowledge_sources};return S(e),void p(!0)}const t=await w(e);if(t)S(t),p(!0)}catch(e){}},[n.agentId,n.id,n.agent_id]);(0,s.useEffect)(()=>{},[g]);const P=(0,s.useCallback)(()=>{const e=h(),t=m(),n=[...e.filter(e=>"taskNode"===e.type).filter(e=>!t.some(t=>t.target===e.id))].sort((e,t)=>e.position.y-t.position.y);if(n.length>0){const e=n[0],{layoutOrientation:t}=E.z.getState(),s="vertical"===t?"bottom":"right",i="vertical"===t?"top":"left",o={id:a+"-"+e.id,source:a,target:e.id,sourceHandle:s,targetHandle:i,type:"default"};u(e=>[...e,o])}},[a,h,m,u]),z=(0,s.useCallback)(async e=>{try{var t;k((null==(t=e.id)?void 0:t.toString())||n.agentId,e),S(e),l(t=>t.map(t=>t.id===a?Object.assign({},t,{data:Object.assign({},t.data,{label:e.name,role:e.role,goal:e.goal,backstory:e.backstory,tools:e.tools,tool_configs:e.tool_configs||{},llm:e.llm,function_calling_llm:e.function_calling_llm,max_iter:e.max_iter,max_rpm:e.max_rpm,max_execution_time:e.max_execution_time,memory:e.memory,verbose:e.verbose,allow_delegation:e.allow_delegation,cache:e.cache,system_template:e.system_template,prompt_template:e.prompt_template,response_template:e.response_template,allow_code_execution:e.allow_code_execution,code_execution_mode:e.code_execution_mode,max_retry_limit:e.max_retry_limit,use_system_prompt:e.use_system_prompt,respect_context_window:e.respect_context_window,embedder_config:e.embedder_config,knowledge_sources:e.knowledge_sources})}):t))}catch(s){}},[a,l,k,n.agentId]);(0,s.useEffect)(()=>{g&&n.knowledge_sources!==(null==C?void 0:C.knowledge_sources)&&S(e=>e?Object.assign({},e,{knowledge_sources:n.knowledge_sources||[]}):null)},[n.knowledge_sources,g,null==C?void 0:C.knowledge_sources]);const L=(0,s.useCallback)(e=>{e.preventDefault(),e.stopPropagation();if(document.querySelectorAll(".MuiDialog-root").length>0)return;const t=e.target,n=!!t.closest("button"),a=!!t.closest(".action-buttons");n||a||(0===e.button?N():2===e.button&&D())},[a,D,N]),R=(0,s.useCallback)(e=>{e.preventDefault(),e.stopPropagation()},[]);return(0,W.jsxs)(i.A,{sx:Object.assign({},(()=>{const e={width:160,minHeight:140,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"space-between",gap:.1,position:"relative",background:e=>b?e.palette.primary.light+"20":e.palette.background.paper,borderRadius:"12px",boxShadow:e=>b?"0 0 0 2px "+e.palette.primary.main:"0 2px 4px "+("light"===e.palette.mode?"rgba(0, 0, 0, 0.1)":"rgba(0, 0, 0, 0.4)"),border:e=>"1px solid "+(b?e.palette.primary.main:e.palette.primary.light),transition:"all 0.3s ease",padding:"16px 8px","&:hover":{boxShadow:e=>"0 4px 12px "+("light"===e.palette.mode?"rgba(0, 0, 0, 0.2)":"rgba(0, 0, 0, 0.6)"),transform:"translateY(-1px)"},"& .action-buttons":{display:"none",position:"absolute",top:2,right:4,gap:"2px"},"&:hover .action-buttons":{display:"flex"}};return n.isActive?Object.assign({},e,{background:e=>"light"===e.palette.mode?"rgba("+e.palette.primary.main+", 0.15)":e.palette.background.paper,border:e=>"3px solid "+e.palette.primary.main,transform:"scale(1.05)",boxShadow:e=>"0 0 12px "+e.palette.primary.main+"70","&::before":{content:'"ACTIVE"',position:"absolute",top:"-10px",left:"50%",transform:"translateX(-50%)",backgroundColor:e=>e.palette.primary.main,color:e=>e.palette.primary.contrastText,padding:"2px 6px",borderRadius:"4px",fontSize:"11px",fontWeight:"bold",zIndex:10}}):n.isCompleted?Object.assign({},e,{background:e=>"light"===e.palette.mode?"rgba("+e.palette.success.main+", 0.1)":e.palette.background.paper,border:e=>"2px solid "+e.palette.success.main,boxShadow:e=>"0 0 8px "+e.palette.success.main+"70","&::before":{content:'"COMPLETED"',position:"absolute",top:"-10px",left:"50%",transform:"translateX(-50%)",backgroundColor:e=>e.palette.success.main,color:"#ffffff",padding:"2px 6px",borderRadius:"4px",fontSize:"10px",fontWeight:"bold",zIndex:10}}):e})(),{cursor:"pointer"}),onClick:L,onContextMenu:R,"data-agentid":n.agentId,"data-nodeid":a,"data-nodetype":"agent","data-selected":b?"true":"false",children:[(0,W.jsx)(y.h7,{type:"target",position:y.yX.Top,id:"top",style:{background:"#ff9800",width:"7px",height:"7px",opacity:"vertical"===_&&"hierarchical"===I?1:0,pointerEvents:"vertical"===_&&"hierarchical"===I?"all":"none"}}),(0,W.jsx)(y.h7,{type:"target",position:y.yX.Left,id:"left",style:{background:"#ff9800",width:"7px",height:"7px",opacity:"horizontal"===_&&"hierarchical"===I?1:0,pointerEvents:"horizontal"===_&&"hierarchical"===I?"all":"none"}}),(0,W.jsx)(y.h7,{type:"source",position:y.yX.Bottom,id:"bottom",style:{background:"#2196f3",width:"7px",height:"7px",opacity:"vertical"===_?1:0,pointerEvents:"vertical"===_?"all":"none"},onDoubleClick:P}),(0,W.jsx)(y.h7,{type:"source",position:y.yX.Right,id:"right",style:{background:"#2196f3",width:"7px",height:"7px",opacity:"horizontal"===_?1:0,pointerEvents:"horizontal"===_?"all":"none"},onDoubleClick:P}),(0,W.jsx)(i.A,{sx:{backgroundColor:e=>e.palette.primary.main+"20",borderRadius:"50%",padding:"8px",display:"flex",alignItems:"center",justifyContent:"center",border:e=>"2px solid "+e.palette.primary.main},children:(0,W.jsx)(X.A,{sx:{color:e=>e.palette.primary.main,fontSize:"1.5rem"}})}),(0,W.jsx)(c.A,{variant:"body2",sx:{fontWeight:500,textAlign:"center",color:e=>e.palette.primary.main,maxWidth:"140px",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:n.role||"Agent"}),(0,W.jsxs)(i.A,{sx:{background:e=>"linear-gradient(135deg, "+e.palette.primary.main+"15, "+e.palette.primary.main+"30)",borderRadius:"4px",padding:"2px 6px",display:"flex",alignItems:"center",justifyContent:"center",mt:.25,mb:.25,border:e=>"1px solid "+e.palette.primary.main+"20",boxShadow:e=>"0 1px 2px "+e.palette.primary.main+"10",transition:"all 0.2s ease",maxWidth:"120px","&:hover":{background:e=>"linear-gradient(135deg, "+e.palette.primary.main+"25, "+e.palette.primary.main+"40)",boxShadow:e=>"0 2px 4px "+e.palette.primary.main+"15"}},children:[(0,W.jsx)(ee.A,{sx:{fontSize:"0.65rem",mr:.25,color:e=>e.palette.primary.main,opacity:.8}}),(0,W.jsx)(c.A,{variant:"caption",sx:{color:e=>e.palette.primary.main,fontSize:"0.65rem",fontWeight:500,textAlign:"center",maxWidth:"100px",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:n.llm||"databricks-llama-4-maverick"})]}),(0,W.jsxs)(i.A,{sx:{display:"flex",gap:1,mt:1},children:[n.allow_code_execution&&(0,W.jsx)(M.A,{title:"Code Execution Enabled",disableInteractive:!0,placement:"top",children:(0,W.jsx)("div",{children:(0,W.jsx)($.A,{sx:{fontSize:"1rem",color:"#2196f3"}})})}),n.memory&&(0,W.jsx)(M.A,{title:"Memory: "+(null!=(t=n.embedder_config)&&t.provider?n.embedder_config.provider+" embeddings":"OpenAI embeddings (default)"),disableInteractive:!0,placement:"top",children:(0,W.jsx)("div",{children:(0,W.jsx)(ee.A,{sx:{fontSize:"1rem",color:"#2196f3"}})})})]}),(0,W.jsxs)(i.A,{className:"action-buttons",children:[(0,W.jsx)(M.A,{title:"Edit Agent",disableInteractive:!0,placement:"top",children:(0,W.jsx)(d.A,{size:"small",onClick:N,sx:{opacity:.4,padding:"4px","&:hover":{opacity:1,backgroundColor:"transparent"}},children:(0,W.jsx)(Z.A,{sx:{fontSize:"1rem",color:"#2196f3"}})})}),(0,W.jsx)(M.A,{title:"Delete Agent",disableInteractive:!0,placement:"top",children:(0,W.jsx)(d.A,{size:"small",onClick:O,sx:{opacity:.4,padding:"4px","&:hover":{opacity:1,backgroundColor:"transparent"}},children:(0,W.jsx)(Q.A,{sx:{fontSize:"1rem",color:"#2196f3"}})})})]}),Boolean(null==n?void 0:n.loading)&&(0,W.jsx)(i.A,{sx:{position:"absolute",inset:0,borderRadius:"12px",background:e=>"light"===e.palette.mode?"linear-gradient(180deg, rgba(255,255,255,0.6), rgba(255,255,255,0.4))":"linear-gradient(180deg, rgba(0,0,0,0.3), rgba(0,0,0,0.2))",backdropFilter:"blur(1px)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:5},children:(0,W.jsxs)(i.A,{sx:{display:"flex",alignItems:"center",gap:1,animation:"bounce 1.2s ease-in-out infinite","@keyframes bounce":{"0%":{transform:"translateY(0)"},"50%":{transform:"translateY(-3px)"},"100%":{transform:"translateY(0)"}}},children:[(0,W.jsx)(Y.A,{size:16,sx:{color:"primary.main"}}),(0,W.jsx)(c.A,{variant:"caption",color:"textSecondary",children:"Creating\u2026"})]})}),g&&C&&(0,W.jsx)(o.A,{open:g,onClose:()=>p(!1),maxWidth:"md",fullWidth:!0,PaperProps:{sx:{display:"flex",flexDirection:"column",height:"85vh",maxHeight:"85vh"}},children:(0,W.jsx)(r.A,{sx:{p:2,overflow:"hidden",display:"flex",flexDirection:"column",flex:1},children:(0,W.jsx)(pt,{initialData:C,tools:x,onCancel:()=>p(!1),onAgentSaved:e=>{p(!1),e&&(j(),z(e))}})})})]})},bt=s.memo(yt);var vt=n(78218);const At=e=>{let{data:t,id:n}=e;const[a,o]=(0,s.useState)(!1),r=(0,E.z)(e=>e.layoutOrientation);return(0,W.jsxs)(i.A,{sx:{padding:"12px",borderRadius:"12px",border:e=>"2px solid "+e.palette.warning.main,background:e=>"linear-gradient(135deg, "+e.palette.warning.light+"15 0%, "+e.palette.warning.main+"25 100%)",minWidth:"200px",maxWidth:"200px",minHeight:"150px",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",gap:"8px",boxShadow:a?"0 0 0 2px rgba(255, 152, 0, 0.5)":"0 2px 8px rgba(0,0,0,0.1)",transition:"all 0.2s ease-in-out","&:hover":{boxShadow:"0 4px 12px rgba(255, 152, 0, 0.3)",transform:"translateY(-2px)"}},onClick:e=>{e.stopPropagation(),o(!0)},"data-nodeid":n,"data-nodetype":"manager","data-selected":a?"true":"false",children:[(0,W.jsx)(y.h7,{type:"target",position:y.yX.Top,id:"top",style:{background:"#ff9800",width:"7px",height:"7px",opacity:"vertical"===r?1:0,pointerEvents:"vertical"===r?"all":"none"}}),(0,W.jsx)(y.h7,{type:"target",position:y.yX.Left,id:"left",style:{background:"#ff9800",width:"7px",height:"7px",opacity:"horizontal"===r?1:0,pointerEvents:"horizontal"===r?"all":"none"}}),(0,W.jsx)(y.h7,{type:"source",position:y.yX.Bottom,id:"bottom",style:{background:"#ff9800",width:"7px",height:"7px",opacity:"vertical"===r?1:0,pointerEvents:"vertical"===r?"all":"none"}}),(0,W.jsx)(y.h7,{type:"source",position:y.yX.Right,id:"right",style:{background:"#ff9800",width:"7px",height:"7px",opacity:"horizontal"===r?1:0,pointerEvents:"horizontal"===r?"all":"none"}}),(0,W.jsx)(i.A,{sx:{backgroundColor:e=>e.palette.warning.main+"20",borderRadius:"50%",padding:"8px",display:"flex",alignItems:"center",justifyContent:"center",border:e=>"2px solid "+e.palette.warning.main},children:(0,W.jsx)(vt.A,{sx:{color:e=>e.palette.warning.main,fontSize:"1.5rem"}})}),(0,W.jsx)(i.A,{sx:{backgroundColor:e=>e.palette.warning.main,color:"white",padding:"2px 8px",borderRadius:"4px",fontSize:"0.65rem",fontWeight:600,textTransform:"uppercase",letterSpacing:"0.5px"},children:"Manager"}),(0,W.jsx)(c.A,{variant:"body2",sx:{fontWeight:600,textAlign:"center",color:e=>e.palette.text.primary,fontSize:"0.875rem",maxWidth:"180px",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:t.label}),t.llm&&(0,W.jsx)(i.A,{sx:{display:"flex",alignItems:"center",gap:.5,backgroundColor:e=>e.palette.warning.main+"15",padding:"2px 6px",borderRadius:"4px",border:e=>"1px solid "+e.palette.warning.main+"40"},children:(0,W.jsx)(c.A,{variant:"caption",sx:{color:e=>e.palette.warning.dark,fontSize:"0.65rem",fontWeight:500,textAlign:"center",maxWidth:"150px",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:t.llm})}),t.isActive&&(0,W.jsx)(i.A,{sx:{position:"absolute",top:8,right:8,width:8,height:8,borderRadius:"50%",backgroundColor:"#4caf50",animation:"pulse 2s infinite","@keyframes pulse":{"0%, 100%":{opacity:1},"50%":{opacity:.5}}}}),t.isCompleted&&(0,W.jsx)(i.A,{sx:{position:"absolute",top:8,right:8,width:8,height:8,borderRadius:"50%",backgroundColor:"#2196f3"}})]})};var jt=n(28169),wt=n(1589),kt=n(79708);const Ct=[{value:"DetailedOutputLogger",label:"Detailed Output Logger",description:"Logs detailed task output and execution metrics"},{value:"SchemaValidator",label:"Schema Validator",description:"Validates output against a JSON schema"},{value:"ContentValidator",label:"Content Validator",description:"Validates output content against specified rules"},{value:"TypeValidator",label:"Type Validator",description:"Validates output data types"},{value:"JsonFileStorage",label:"JSON File Storage",description:"Stores output in a JSON file",requiresPath:!0},{value:"DatabaseStorage",label:"Database Storage",description:"Stores output in a database"},{value:"FileSystemStorage",label:"File System Storage",description:"Stores output in the file system",requiresPath:!0},{value:"DatabricksVolumeCallback",label:"Databricks Volume Storage",description:"Stores output in Databricks Volumes",requiresPath:!1},{value:"OutputFormatter",label:"Output Formatter",description:"Formats output according to specified rules"},{value:"DataExtractor",label:"Data Extractor",description:"Extracts specific data from the output"},{value:"OutputEnricher",label:"Output Enricher",description:"Enriches output with additional data"},{value:"OutputSummarizer",label:"Output Summarizer",description:"Creates a summary of the output"}];class St{constructor(){this.CACHE_TTL=3e5,this.schemasCache=null,this.schemasByTypeCache={},this.clearCaches()}static getInstance(){return St.instance||(St.instance=new St),St.instance}isCacheValid(e){return!!e&&Date.now()<e.expiry}setCache(e,t){const n=Date.now();return{data:t,timestamp:n,expiry:n+this.CACHE_TTL}}clearCaches(){this.schemasCache=null,this.schemasByTypeCache={}}async getSchemas(){if(this.isCacheValid(this.schemasCache)&&this.schemasCache)return this.schemasCache.data;try{const e=await ve.uE.get("/schemas");if(e.data&&e.data.schemas){let t=e.data.schemas;return t=t.map(e=>{try{if(e.schema_definition&&"string"===typeof e.schema_definition)return Object.assign({},e,{schema_definition:JSON.parse(e.schema_definition)})}catch(t){}return e}),this.schemasCache=this.setCache(this.schemasCache,t),t}return[]}catch(e){return[]}}async getSchemasByType(e){const t=this.schemasByTypeCache[e];if(this.isCacheValid(t))return t.data;try{const n=await ve.uE.get("/schemas/by-type/"+e);if(n.data&&n.data.schemas){const a=n.data.schemas;return this.schemasByTypeCache[e]=this.setCache(t,a),a}return[]}catch(n){return[]}}async getSchema(e){try{const t=await ve.uE.get("/schemas/"+e);if(t.data){let e=t.data;try{e.schema_definition&&"string"===typeof e.schema_definition&&(e=Object.assign({},e,{schema_definition:JSON.parse(e.schema_definition)}))}catch(n){}return e}return null}catch(n){if(be.A.isAxiosError(n)){var t;if(404===(null==(t=n.response)?void 0:t.status))return null}return null}}async createSchema(e){try{const t=Object.assign({},e),n=await ve.uE.post("/schemas",t);return n.data?(this.clearCaches(),n.data):null}catch(a){if(a&&"object"===typeof a&&"response"in a){var t,n;const e=a;if(422===(null==(t=e.response)?void 0:t.status)&&null!=(n=e.response)&&n.data){const t=e.response.data;throw new Error("Validation error: "+JSON.stringify(t.detail))}}throw a}}async updateSchema(e,t){try{const n=Object.assign({},t),a=await ve.uE.put("/schemas/"+e,n);return a.data?(this.clearCaches(),a.data):null}catch(n){return null}}async deleteSchema(e){try{return await ve.uE.delete("/schemas/"+e),this.clearCaches(),!0}catch(t){return!1}}}St.instance=void 0;const _t={volume_path:"main.default.task_outputs",file_format:"json",create_date_dirs:!0,max_file_size_mb:50},Et=e=>{let{config:t,onChange:n}=e;const[a,o]=(0,s.useState)(()=>t||_t);(0,s.useEffect)(()=>{o(t||_t)},[t]);const r=(e,t)=>{const s=Object.assign({},a,{[e]:t});o(s),n(s)};return(0,W.jsxs)(i.A,{sx:{mt:2,p:2,border:"1px solid",borderColor:"divider",borderRadius:1},children:[(0,W.jsx)(c.A,{variant:"subtitle2",color:"primary",sx:{mb:2},children:"Databricks Volume Configuration"}),(0,W.jsx)(h.A,{severity:"info",sx:{mb:2},children:"Task outputs will be uploaded to Databricks Volumes. Ensure DATABRICKS_HOST and DATABRICKS_TOKEN environment variables are set, or configure them below."}),(0,W.jsx)(U.A,{fullWidth:!0,label:"Volume Path",value:a.volume_path,onChange:e=>r("volume_path",e.target.value),helperText:"Format: catalog.schema.volume (e.g., catalog.schema.volume)",placeholder:"catalog.schema.volume",sx:{mb:2},required:!0}),(0,W.jsxs)(re.A,{fullWidth:!0,sx:{mb:2},children:[(0,W.jsx)(le.A,{children:"File Format"}),(0,W.jsxs)(ce.A,{value:a.file_format,onChange:e=>{r("file_format",e.target.value)},label:"File Format",children:[(0,W.jsx)(de.A,{value:"json",children:"JSON"}),(0,W.jsx)(de.A,{value:"csv",children:"CSV"}),(0,W.jsx)(de.A,{value:"txt",children:"Text"})]})]}),(0,W.jsx)(he.A,{control:(0,W.jsx)(me.A,{checked:a.create_date_dirs,onChange:e=>r("create_date_dirs",e.target.checked)}),label:"Create Date-based Directories",sx:{mb:2}}),(0,W.jsx)(c.A,{variant:"caption",color:"text.secondary",sx:{display:"block",mt:1},children:"Optional: Override environment variables (leave empty to use defaults)"}),(0,W.jsx)(U.A,{fullWidth:!0,label:"Workspace URL (Optional)",value:a.workspace_url||"",onChange:e=>r("workspace_url",e.target.value?e.target.value:void 0),placeholder:"https://your-workspace.databricks.com",sx:{mb:2,mt:1},InputProps:{startAdornment:(0,W.jsx)(ae.A,{position:"start",children:"https://"})}}),(0,W.jsx)(U.A,{fullWidth:!0,label:"Access Token (Optional)",value:a.token||"",onChange:e=>r("token",e.target.value?e.target.value:void 0),type:"password",placeholder:"Leave empty to use DATABRICKS_TOKEN env var",sx:{mb:1}}),(0,W.jsx)(h.A,{severity:"warning",sx:{mt:2},children:(0,W.jsxs)(c.A,{variant:"caption",children:[(0,W.jsx)("strong",{children:"Note:"})," Files will be organized as: ",a.volume_path,"/",a.create_date_dirs?"YYYY/MM/DD/":"","task_key_timestamp.",a.file_format]})})]})},It=e=>{var t;let{advancedConfig:n,onConfigChange:a,availableTasks:o}=e;const[r,l]=(0,s.useState)(n.callback&&Ct.find(e=>e.value===n.callback)||null),[u,h]=(0,s.useState)([]),[m,g]=(0,s.useState)(null);(0,s.useEffect)(()=>{(async()=>{try{const e=St.getInstance(),t=(await e.getSchemas()).map(e=>({value:e.name,label:e.name}));h(t)}catch(e){}})()},[]);const p=(0,s.useCallback)((e,t)=>{"type"!==e||a("condition",""===t?null:"is_data_missing")},[a]),x=(0,s.useCallback)(e=>{const t=Ct.find(t=>t.value===e);if(l(t||null),a("callback",e||null),null!=t&&t.requiresPath||a("output_file",null),"DatabricksVolumeCallback"===e){if(!m){const e={volume_path:"main.default.task_outputs",file_format:"json",create_date_dirs:!0,max_file_size_mb:50};g(e),a("callback_config",Object.assign({},e))}}else g(null),a("callback_config",null)},[a,m]);(0,s.useEffect)(()=>{if("DatabricksVolumeCallback"===n.callback){if(n.callback_config){const e=n.callback_config,t={volume_path:e.volume_path||"main.default.task_outputs",file_format:e.file_format||"json",create_date_dirs:void 0===e.create_date_dirs||e.create_date_dirs,max_file_size_mb:e.max_file_size_mb||50,workspace_url:e.workspace_url,token:e.token};g(t)}else if(!m){g({volume_path:"main.default.task_outputs",file_format:"json",create_date_dirs:!0,max_file_size_mb:50})}const e=Ct.find(e=>"DatabricksVolumeCallback"===e.value);e&&!r&&l(e)}else m&&g(null)},[n.callback,n.callback_config,m,r]);const f=(0,s.useCallback)(e=>{if(""===e)a("guardrail",null);else if("company_count"===e){const e={type:"company_count",min_companies:50};a("guardrail",JSON.stringify(e))}else if("data_processing"===e){const e={type:"data_processing"};a("guardrail",JSON.stringify(e))}else if("empty_data_processing"===e){const e={type:"empty_data_processing"};a("guardrail",JSON.stringify(e))}else if("data_processing_count"===e){const e={type:"data_processing_count",minimum_count:0};a("guardrail",JSON.stringify(e))}else if("company_name_not_null"===e){const e={type:"company_name_not_null"};a("guardrail",JSON.stringify(e))}else if("minimum_number"===e){const e={type:"minimum_number",min_value:5,field_name:"total_count"};a("guardrail",JSON.stringify(e))}else a("guardrail",JSON.stringify({type:e}))},[a]),y=(0,s.useCallback)((e,t)=>{try{const s=n.guardrail?JSON.parse(n.guardrail):{type:"company_count"};s[e]=t,a("guardrail",JSON.stringify(s))}catch(s){const n={type:"company_count",[e]:t};a("guardrail",JSON.stringify(n))}},[n.guardrail,a]),b=s.useMemo(()=>{try{return n.guardrail?JSON.parse(n.guardrail):null}catch(e){return null}},[n.guardrail]);return(0,s.useEffect)(()=>{"data_processing"!==(null==b?void 0:b.type)&&"empty_data_processing"!==(null==b?void 0:b.type)&&"company_name_not_null"!==(null==b?void 0:b.type)||n.retry_on_fail||(a("retry_on_fail",!0),a("max_retries",5))},[null==b?void 0:b.type,n.retry_on_fail,a]),(0,W.jsxs)(i.A,{sx:{display:"flex",flexDirection:"column",gap:2},children:[(0,W.jsx)(c.A,{variant:"subtitle2",color:"text.secondary",children:"Execution Settings"}),(0,W.jsx)(he.A,{control:(0,W.jsx)(me.A,{checked:Boolean(n.async_execution),onChange:e=>a("async_execution",e.target.checked)}),label:"Async Execution"}),(0,W.jsx)(he.A,{control:(0,W.jsx)(me.A,{checked:n.human_input,onChange:e=>a("human_input",e.target.checked)}),label:"Require Human Input"}),(0,W.jsx)(U.A,{type:"number",label:"Priority",value:n.priority,onChange:e=>a("priority",parseInt(e.target.value)),fullWidth:!0,inputProps:{min:1,max:10}}),(0,W.jsx)(U.A,{type:"number",label:"Timeout (seconds)",value:n.timeout||"",onChange:e=>a("timeout",e.target.value?parseInt(e.target.value):null),fullWidth:!0,inputProps:{min:0}}),(0,W.jsx)(ne.A,{sx:{my:2}}),(0,W.jsx)(c.A,{variant:"subtitle2",color:"text.secondary",children:"Caching & Output"}),(0,W.jsx)(he.A,{control:(0,W.jsx)(me.A,{checked:n.cache_response,onChange:e=>a("cache_response",e.target.checked)}),label:"Cache Response"}),(0,W.jsx)(U.A,{type:"number",label:"Cache TTL (seconds)",value:n.cache_ttl,onChange:e=>a("cache_ttl",parseInt(e.target.value)),fullWidth:!0,disabled:!n.cache_response,inputProps:{min:0}}),(0,W.jsx)(U.A,{label:"Output JSON Schema",value:n.output_json||"",onChange:e=>a("output_json",e.target.value||null),fullWidth:!0,multiline:!0,rows:3,helperText:"JSON schema for task output"}),(0,W.jsx)(U.A,{label:"Output File Path",value:n.output_file||"",onChange:e=>a("output_file",e.target.value||null),fullWidth:!0}),(0,W.jsx)(he.A,{control:(0,W.jsx)(me.A,{checked:n.markdown,onChange:e=>a("markdown",e.target.checked)}),label:"Enable Markdown Output"}),(0,W.jsx)(ne.A,{sx:{my:2}}),(0,W.jsx)(c.A,{variant:"subtitle2",color:"text.secondary",children:"Error Handling"}),(0,W.jsx)(he.A,{control:(0,W.jsx)(me.A,{checked:n.retry_on_fail,onChange:e=>a("retry_on_fail",e.target.checked)}),label:"Retry on Failure"}),(0,W.jsx)(U.A,{type:"number",label:"Max Retries",value:n.max_retries,onChange:e=>a("max_retries",parseInt(e.target.value)),fullWidth:!0,disabled:!n.retry_on_fail,inputProps:{min:1,max:10}}),(0,W.jsxs)(re.A,{fullWidth:!0,children:[(0,W.jsx)(le.A,{children:"Error Handling Strategy"}),(0,W.jsxs)(ce.A,{value:n.error_handling,onChange:e=>a("error_handling",e.target.value),label:"Error Handling Strategy",children:[(0,W.jsx)(de.A,{value:"default",children:"Default"}),(0,W.jsx)(de.A,{value:"retry",children:"Retry"}),(0,W.jsx)(de.A,{value:"ignore",children:"Ignore"}),(0,W.jsx)(de.A,{value:"fail",children:"Fail Immediately"})]})]}),(0,W.jsx)(ne.A,{sx:{my:2}}),(0,W.jsx)(c.A,{variant:"subtitle2",color:"text.secondary",children:"Advanced Functions"}),(0,W.jsxs)(i.A,{sx:{display:"flex",gap:2,alignItems:"flex-start"},children:[(0,W.jsxs)(re.A,{fullWidth:!0,children:[(0,W.jsx)(le.A,{children:"Callback"}),(0,W.jsxs)(ce.A,{value:n.callback||"",onChange:e=>x(e.target.value),label:"Callback Function",children:[(0,W.jsx)(de.A,{value:"",children:(0,W.jsx)("em",{children:"None"})}),Ct.map(e=>(0,W.jsx)(de.A,{value:e.value,children:(0,W.jsxs)(i.A,{sx:{display:"flex",flexDirection:"column"},children:[(0,W.jsx)(c.A,{children:e.label}),(0,W.jsx)(c.A,{variant:"caption",color:"text.secondary",children:e.description})]})},e.value))]})]}),r&&(0,W.jsx)(M.A,{title:r.description,children:(0,W.jsx)(d.A,{size:"small",sx:{mt:1},children:(0,W.jsx)(pe.A,{})})})]}),(null==r?void 0:r.requiresPath)&&(0,W.jsx)(U.A,{label:"Output File Path",value:n.output_file||"",onChange:e=>a("output_file",e.target.value||null),fullWidth:!0,helperText:"Path where the output will be saved"}),"DatabricksVolumeCallback"===(null==r?void 0:r.value)&&(0,W.jsx)(Et,{config:m,onChange:e=>{g(e),a("callback_config",Object.assign({},e))}}),(0,W.jsx)(U.A,{label:"Output Parser",value:n.output_parser||"",onChange:e=>a("output_parser",e.target.value||null),fullWidth:!0,helperText:"Custom parser for task output"}),(0,W.jsxs)(re.A,{fullWidth:!0,children:[(0,W.jsx)(le.A,{children:"Output Pydantic Model"}),(0,W.jsxs)(ce.A,{value:null!=(t=n.output_pydantic)?t:"",onChange:e=>{const t=""===e.target.value?null:e.target.value;a("output_pydantic",t)},label:"Output Pydantic Model",children:[(0,W.jsx)(de.A,{value:"",children:(0,W.jsx)("em",{children:"None"})}),u.map(e=>(0,W.jsx)(de.A,{value:e.value,children:e.label},e.value))]})]}),(0,W.jsx)(ne.A,{sx:{my:2}}),(0,W.jsx)(c.A,{variant:"subtitle2",color:"text.secondary",children:"Condition Settings"}),(0,W.jsxs)(re.A,{fullWidth:!0,children:[(0,W.jsx)(le.A,{children:"Condition Type"}),(0,W.jsxs)(ce.A,{value:n.condition||"",onChange:e=>p("type",e.target.value),label:"Condition Type",children:[(0,W.jsx)(de.A,{value:"",children:(0,W.jsx)("em",{children:"None"})}),(0,W.jsx)(de.A,{value:"is_data_missing",children:"Data Is Missing"})]})]}),(0,W.jsx)(ne.A,{sx:{my:2}}),(0,W.jsx)(c.A,{variant:"subtitle2",color:"text.secondary",children:"Guardrail Settings"}),(0,W.jsxs)(re.A,{fullWidth:!0,children:[(0,W.jsx)(le.A,{children:"Guardrail Type"}),(0,W.jsxs)(ce.A,{value:(null==b?void 0:b.type)||"",onChange:e=>f(e.target.value),label:"Guardrail Type",children:[(0,W.jsx)(de.A,{value:"",children:"None"}),(0,W.jsx)(de.A,{value:"company_count",children:"Company Count"}),(0,W.jsx)(de.A,{value:"data_processing",children:"Data Processing Status"}),(0,W.jsx)(de.A,{value:"empty_data_processing",children:"Empty Data Processing Check"}),(0,W.jsx)(de.A,{value:"data_processing_count",children:"Data Processing Count Check"}),(0,W.jsx)(de.A,{value:"company_name_not_null",children:"Company Name Not Null Check"}),(0,W.jsx)(de.A,{value:"minimum_number",children:"Minimum Number Check"})]})]}),"company_count"===(null==b?void 0:b.type)&&(0,W.jsx)(U.A,{type:"number",label:"Minimum Companies",value:b.min_companies||50,onChange:e=>y("min_companies",parseInt(e.target.value)),fullWidth:!0,inputProps:{min:1}}),"data_processing_count"===(null==b?void 0:b.type)&&(0,W.jsxs)(i.A,{sx:{mt:1},children:[(0,W.jsx)(c.A,{variant:"body2",color:"text.secondary",sx:{mb:1},children:"This guardrail checks if the total number of records in the data_processing table is at least the minimum count. The task will pass validation when the number of records equals or exceeds the minimum count."}),(0,W.jsx)(U.A,{type:"number",label:"Minimum Record Count",value:b.minimum_count||0,onChange:e=>y("minimum_count",parseInt(e.target.value)),fullWidth:!0,inputProps:{min:0}})]}),"data_processing"===(null==b?void 0:b.type)&&(0,W.jsx)(i.A,{sx:{mt:1},children:(0,W.jsx)(c.A,{variant:"body2",color:"text.secondary",sx:{mb:1},children:'This guardrail checks if all data records in the database have been processed. The task will only pass validation when all records have processed=true. Enable "Retry on Failure" to automatically retry the task until all data has been processed.'})}),"empty_data_processing"===(null==b?void 0:b.type)&&(0,W.jsx)(i.A,{sx:{mt:1},children:(0,W.jsx)(c.A,{variant:"body2",color:"text.secondary",sx:{mb:1},children:"This guardrail checks if the data_processing table is empty. The task will only pass validation when the table has NO records (is completely empty). Use this guardrail when you need to ensure that the table is clean before adding new data."})}),"company_name_not_null"===(null==b?void 0:b.type)&&(0,W.jsx)(i.A,{sx:{mt:1},children:(0,W.jsx)(c.A,{variant:"body2",color:"text.secondary",sx:{mb:1},children:'This guardrail checks if any company_name in the data_processing table is null. The task will only pass validation when all records have non-null company_name values. Enable "Retry on Failure" to automatically retry the task until all records have valid company names.'})}),"minimum_number"===(null==b?void 0:b.type)&&(0,W.jsxs)(i.A,{sx:{mt:1},children:[(0,W.jsx)(c.A,{variant:"body2",color:"text.secondary",sx:{mb:1},children:"This guardrail validates that a number in the output exceeds a specified minimum value. Particularly useful for ensuring search results, data counts, or other numerical values meet minimum thresholds."}),(0,W.jsx)(U.A,{type:"number",label:"Minimum Value",value:b.min_value||5,onChange:e=>y("min_value",parseInt(e.target.value)),fullWidth:!0,inputProps:{min:0},sx:{mb:2}}),(0,W.jsx)(U.A,{label:"Field Name",value:b.field_name||"total_count",onChange:e=>y("field_name",e.target.value),fullWidth:!0,helperText:"Name of the field to check (e.g., 'total_count', 'results')"})]})]})},Tt=(0,s.memo)(It);Tt.displayName="TaskAdvancedConfig";const Dt=function(e,t,n){void 0===n&&(n=100);const a=(0,s.useRef)(null),i=(0,s.useRef)(null),o=(0,s.useRef)(e);(0,s.useEffect)(()=>{o.current=e},[e]),(0,s.useEffect)(()=>{const e=t.current;if(!e)return;return i.current=new ResizeObserver(e=>{a.current&&window.clearTimeout(a.current),a.current=window.setTimeout(()=>{o.current(e[0])},n)}),i.current.observe(e),()=>{a.current&&window.clearTimeout(a.current),i.current&&(i.current.disconnect(),i.current=null)}},[t,n])};var Ot=n(49322),Nt=n(79084);const Pt=e=>{let{open:t,onClose:n}=e;return(0,W.jsxs)(o.A,{open:t,onClose:n,maxWidth:"md",fullWidth:!0,PaperProps:{sx:{borderRadius:2,minHeight:"80vh"}},children:[(0,W.jsx)(l.A,{children:(0,W.jsxs)(i.A,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[(0,W.jsxs)(i.A,{sx:{display:"flex",alignItems:"center",gap:1},children:[(0,W.jsx)(Ot.A,{color:"primary"}),(0,W.jsx)(c.A,{variant:"h6",children:"Task Best Practices"})]}),(0,W.jsx)(d.A,{onClick:n,size:"small",children:(0,W.jsx)(N.A,{})})]})}),(0,W.jsx)(r.A,{dividers:!0,children:(0,W.jsxs)(i.A,{sx:{py:2},children:[(0,W.jsx)(h.A,{severity:"info",sx:{mb:3},children:"Tasks are specific assignments given to agents. They define what needs to be done, the expected output, and how the task connects to the overall workflow."}),(0,W.jsxs)(_e.A,{elevation:0,sx:{p:3,mb:3,bgcolor:"background.default"},children:[(0,W.jsxs)(c.A,{variant:"h6",gutterBottom:!0,sx:{display:"flex",alignItems:"center",gap:1},children:[(0,W.jsx)(lt.A,{color:"primary"}),"Core Principles"]}),(0,W.jsxs)(at.A,{children:[(0,W.jsxs)(st.Ay,{children:[(0,W.jsx)(it.A,{children:(0,W.jsx)(rt.A,{color:"success"})}),(0,W.jsx)(ot.A,{primary:"Clear and Specific",secondary:"Tasks should have unambiguous instructions with clear deliverables."})]}),(0,W.jsxs)(st.Ay,{children:[(0,W.jsx)(it.A,{children:(0,W.jsx)(rt.A,{color:"success"})}),(0,W.jsx)(ot.A,{primary:"Atomic Operations",secondary:"Break complex operations into smaller, manageable tasks. Each task should do one thing well."})]}),(0,W.jsxs)(st.Ay,{children:[(0,W.jsx)(it.A,{children:(0,W.jsx)(rt.A,{color:"success"})}),(0,W.jsx)(ot.A,{primary:"Measurable Outcomes",secondary:"Define success criteria that can be objectively evaluated."})]})]})]}),(0,W.jsxs)(_e.A,{elevation:0,sx:{p:3,mb:3,bgcolor:"background.default"},children:[(0,W.jsxs)(c.A,{variant:"h6",gutterBottom:!0,sx:{display:"flex",alignItems:"center",gap:1},children:[(0,W.jsx)(ht.A,{color:"primary"}),"Writing Effective Task Descriptions"]}),(0,W.jsxs)(i.A,{sx:{mt:2},children:[(0,W.jsx)(c.A,{variant:"subtitle1",fontWeight:"medium",gutterBottom:!0,children:"Description"}),(0,W.jsx)(c.A,{variant:"body2",color:"text.secondary",paragraph:!0,children:"Provide clear, actionable instructions. Include context, constraints, and specific requirements."}),(0,W.jsx)(i.A,{sx:{bgcolor:"grey.100",p:2,borderRadius:1,mb:2},children:(0,W.jsxs)(c.A,{variant:"body2",fontFamily:"monospace",children:["\u2705 Good: ",'"Analyze the customer feedback data from the last quarter. Identify the top 3 pain points mentioned by users. Create a summary report with specific quotes and frequency data."',(0,W.jsx)("br",{}),(0,W.jsx)("br",{}),"\u274c Poor: ",'"Look at customer feedback"']})})]}),(0,W.jsxs)(i.A,{sx:{mt:2},children:[(0,W.jsx)(c.A,{variant:"subtitle1",fontWeight:"medium",gutterBottom:!0,children:"Expected Output"}),(0,W.jsx)(c.A,{variant:"body2",color:"text.secondary",paragraph:!0,children:"Define exactly what the task should produce. Specify format, structure, and content requirements."}),(0,W.jsx)(i.A,{sx:{bgcolor:"grey.100",p:2,borderRadius:1,mb:2},children:(0,W.jsxs)(c.A,{variant:"body2",fontFamily:"monospace",children:["\u2705 Good: ",'"A JSON object containing: analysis_date, top_issues (array of 3 items with title, description, frequency), recommendations (array), and raw_data_summary"',(0,W.jsx)("br",{}),(0,W.jsx)("br",{}),"\u274c Poor: ",'"A report"']})})]}),(0,W.jsxs)(i.A,{sx:{mt:2},children:[(0,W.jsx)(c.A,{variant:"subtitle1",fontWeight:"medium",gutterBottom:!0,children:"Context Variables"}),(0,W.jsx)(c.A,{variant:"body2",color:"text.secondary",paragraph:!0,children:"Use context variables to pass dynamic information from previous tasks or user input."}),(0,W.jsx)(i.A,{sx:{bgcolor:"grey.100",p:2,borderRadius:1,mb:2},children:(0,W.jsxs)(c.A,{variant:"body2",fontFamily:"monospace",children:["Example: ",'"Analyze the data for {customer_segment} in {region} market"',(0,W.jsx)("br",{}),"This allows the task to be reusable with different parameters."]})})]})]}),(0,W.jsxs)(_e.A,{elevation:0,sx:{p:3,mb:3,bgcolor:"background.default"},children:[(0,W.jsxs)(c.A,{variant:"h6",gutterBottom:!0,sx:{display:"flex",alignItems:"center",gap:1},children:[(0,W.jsx)(Nt.A,{color:"primary"}),"Task Dependencies and Flow"]}),(0,W.jsxs)(at.A,{children:[(0,W.jsxs)(st.Ay,{children:[(0,W.jsx)(it.A,{children:(0,W.jsx)(rt.A,{color:"success"})}),(0,W.jsx)(ot.A,{primary:"Sequential Dependencies",secondary:"Clearly define which tasks must complete before this task can start."})]}),(0,W.jsxs)(st.Ay,{children:[(0,W.jsx)(it.A,{children:(0,W.jsx)(rt.A,{color:"success"})}),(0,W.jsx)(ot.A,{primary:"Input/Output Mapping",secondary:"Ensure outputs from previous tasks match the expected inputs of dependent tasks."})]}),(0,W.jsxs)(st.Ay,{children:[(0,W.jsx)(it.A,{children:(0,W.jsx)(rt.A,{color:"success"})}),(0,W.jsx)(ot.A,{primary:"Error Handling",secondary:"Define what should happen if a task fails or produces unexpected output."})]}),(0,W.jsxs)(st.Ay,{children:[(0,W.jsx)(it.A,{children:(0,W.jsx)(rt.A,{color:"success"})}),(0,W.jsx)(ot.A,{primary:"Parallel Execution",secondary:"Identify tasks that can run simultaneously to optimize workflow performance."})]})]})]}),(0,W.jsxs)(_e.A,{elevation:0,sx:{p:3,mb:3,bgcolor:"background.default"},children:[(0,W.jsxs)(c.A,{variant:"h6",gutterBottom:!0,sx:{display:"flex",alignItems:"center",gap:1},children:[(0,W.jsx)(ht.A,{color:"primary"}),"Output Types and Formats"]}),(0,W.jsxs)(at.A,{children:[(0,W.jsxs)(st.Ay,{children:[(0,W.jsx)(it.A,{children:(0,W.jsx)(rt.A,{color:"info"})}),(0,W.jsx)(ot.A,{primary:"Structured Data (JSON/XML)",secondary:"Best for data that will be processed by other tasks or systems."})]}),(0,W.jsxs)(st.Ay,{children:[(0,W.jsx)(it.A,{children:(0,W.jsx)(rt.A,{color:"info"})}),(0,W.jsx)(ot.A,{primary:"Plain Text",secondary:"Suitable for summaries, reports, or human-readable content."})]}),(0,W.jsxs)(st.Ay,{children:[(0,W.jsx)(it.A,{children:(0,W.jsx)(rt.A,{color:"info"})}),(0,W.jsx)(ot.A,{primary:"Markdown",secondary:"Ideal for formatted documentation or reports with structure."})]}),(0,W.jsxs)(st.Ay,{children:[(0,W.jsx)(it.A,{children:(0,W.jsx)(rt.A,{color:"info"})}),(0,W.jsx)(ot.A,{primary:"Code",secondary:"For generated scripts, configurations, or program files."})]})]})]}),(0,W.jsxs)(_e.A,{elevation:0,sx:{p:3,mb:3,bgcolor:"error.50"},children:[(0,W.jsxs)(c.A,{variant:"h6",gutterBottom:!0,sx:{display:"flex",alignItems:"center",gap:1,color:"error.main"},children:[(0,W.jsx)(ct.A,{color:"error"}),"Common Pitfalls to Avoid"]}),(0,W.jsxs)(at.A,{children:[(0,W.jsxs)(st.Ay,{children:[(0,W.jsx)(it.A,{children:(0,W.jsx)(ct.A,{color:"error"})}),(0,W.jsx)(ot.A,{primary:"Overly Complex Tasks",secondary:"Don't try to accomplish too much in a single task. Break it down into smaller steps."})]}),(0,W.jsxs)(st.Ay,{children:[(0,W.jsx)(it.A,{children:(0,W.jsx)(ct.A,{color:"error"})}),(0,W.jsx)(ot.A,{primary:"Ambiguous Success Criteria",secondary:"Avoid vague outcomes like 'improve the process' without defining what improvement means."})]}),(0,W.jsxs)(st.Ay,{children:[(0,W.jsx)(it.A,{children:(0,W.jsx)(ct.A,{color:"error"})}),(0,W.jsx)(ot.A,{primary:"Missing Context",secondary:"Don't assume the agent knows background information. Provide all necessary context."})]}),(0,W.jsxs)(st.Ay,{children:[(0,W.jsx)(it.A,{children:(0,W.jsx)(ct.A,{color:"error"})}),(0,W.jsx)(ot.A,{primary:"Ignoring Edge Cases",secondary:"Consider what happens with empty inputs, errors, or unexpected data formats."})]}),(0,W.jsxs)(st.Ay,{children:[(0,W.jsx)(it.A,{children:(0,W.jsx)(ct.A,{color:"error"})}),(0,W.jsx)(ot.A,{primary:"Circular Dependencies",secondary:"Ensure tasks don't create dependency loops that prevent execution."})]})]})]}),(0,W.jsxs)(_e.A,{elevation:0,sx:{p:3,mb:3,bgcolor:"info.50"},children:[(0,W.jsxs)(c.A,{variant:"h6",gutterBottom:!0,sx:{display:"flex",alignItems:"center",gap:1,color:"info.main"},children:[(0,W.jsx)(lt.A,{color:"info"}),"Task Template Examples"]}),(0,W.jsxs)(i.A,{sx:{mt:2},children:[(0,W.jsx)(c.A,{variant:"subtitle2",fontWeight:"medium",gutterBottom:!0,children:"Data Analysis Task"}),(0,W.jsx)(i.A,{sx:{bgcolor:"white",p:2,borderRadius:1,mb:2,fontFamily:"monospace"},children:(0,W.jsx)(c.A,{variant:"body2",component:"pre",sx:{whiteSpace:"pre-wrap"},children:'Description: "Analyze sales data for Q4 2024. Calculate total revenue, \ntop 5 products by sales volume, and month-over-month growth rate."\n\nExpected Output: "JSON object with structure:\n{\n  quarter: \'Q4 2024\',\n  total_revenue: number,\n  top_products: [{name, units_sold, revenue}],\n  growth_rate: number,\n  summary: string\n}"'})})]}),(0,W.jsxs)(i.A,{sx:{mt:2},children:[(0,W.jsx)(c.A,{variant:"subtitle2",fontWeight:"medium",gutterBottom:!0,children:"Content Generation Task"}),(0,W.jsx)(i.A,{sx:{bgcolor:"white",p:2,borderRadius:1,mb:2,fontFamily:"monospace"},children:(0,W.jsx)(c.A,{variant:"body2",component:"pre",sx:{whiteSpace:"pre-wrap"},children:'Description: "Create a technical blog post about {topic}. \nInclude an introduction, 3 main sections with examples, \nand a conclusion with key takeaways."\n\nExpected Output: "Markdown formatted article with:\n- Title (H1)\n- Introduction (150-200 words)\n- 3 sections with code examples\n- Conclusion with bullet points\n- Total length: 1500-2000 words"'})})]})]}),(0,W.jsxs)(_e.A,{elevation:0,sx:{p:3,bgcolor:"success.50"},children:[(0,W.jsxs)(c.A,{variant:"h6",gutterBottom:!0,sx:{display:"flex",alignItems:"center",gap:1,color:"success.main"},children:[(0,W.jsx)(rt.A,{color:"success"}),"Quick Checklist"]}),(0,W.jsxs)(at.A,{dense:!0,children:[(0,W.jsxs)(st.Ay,{children:[(0,W.jsx)(it.A,{children:(0,W.jsx)(rt.A,{color:"success",fontSize:"small"})}),(0,W.jsx)(ot.A,{primary:"Is the task description clear and specific?"})]}),(0,W.jsxs)(st.Ay,{children:[(0,W.jsx)(it.A,{children:(0,W.jsx)(rt.A,{color:"success",fontSize:"small"})}),(0,W.jsx)(ot.A,{primary:"Is the expected output well-defined?"})]}),(0,W.jsxs)(st.Ay,{children:[(0,W.jsx)(it.A,{children:(0,W.jsx)(rt.A,{color:"success",fontSize:"small"})}),(0,W.jsx)(ot.A,{primary:"Are all dependencies identified?"})]}),(0,W.jsxs)(st.Ay,{children:[(0,W.jsx)(it.A,{children:(0,W.jsx)(rt.A,{color:"success",fontSize:"small"})}),(0,W.jsx)(ot.A,{primary:"Is the task appropriately sized (not too complex)?"})]}),(0,W.jsxs)(st.Ay,{children:[(0,W.jsx)(it.A,{children:(0,W.jsx)(rt.A,{color:"success",fontSize:"small"})}),(0,W.jsx)(ot.A,{primary:"Have you provided necessary context?"})]}),(0,W.jsxs)(st.Ay,{children:[(0,W.jsx)(it.A,{children:(0,W.jsx)(rt.A,{color:"success",fontSize:"small"})}),(0,W.jsx)(ot.A,{primary:"Is the output format specified?"})]}),(0,W.jsxs)(st.Ay,{children:[(0,W.jsx)(it.A,{children:(0,W.jsx)(rt.A,{color:"success",fontSize:"small"})}),(0,W.jsx)(ot.A,{primary:"Have you considered error scenarios?"})]})]})]})]})}),(0,W.jsx)(H.A,{sx:{px:3,py:2},children:(0,W.jsx)(g.A,{onClick:n,variant:"contained",color:"primary",children:"Close"})})]})},Mt=e=>{var t,n,a,m,p,x,f,y,b,v,A,j,w,k,C,S,_,E,I,T,D,O,P,z,L,R,F,B,K,G,q,J,Y,X,Z,$,ee,ue;let{initialData:he,onCancel:me,onTaskSaved:fe,onSubmit:ye,isEdit:be,tools:ve,hideTitle:Ae,isCreateMode:je,agent:we}=e;const[Ce,Se]=(0,s.useState)(!1),[_e,Ee]=(0,s.useState)(!1),[Ie,Te]=(0,s.useState)(!1),De=(0,s.useRef)(null),[Oe,Ne]=(0,s.useState)({id:null!=(t=null==he?void 0:he.id)?t:"",name:null!=(n=null==he?void 0:he.name)?n:"",description:null!=(a=null==he?void 0:he.description)?a:"",expected_output:null!=(m=null==he?void 0:he.expected_output)?m:"",tools:null!=(p=null==he?void 0:he.tools)?p:[],agent_id:null!=(x=null==he?void 0:he.agent_id)?x:null,async_execution:void 0!==(null==he?void 0:he.async_execution)&&Boolean(he.async_execution),context:null!=(f=null==he?void 0:he.context)?f:[],markdown:!0===(null==he?void 0:he.markdown)||"true"===String(null==he?void 0:he.markdown),config:null!=he&&he.config?{cache_response:null!=(y=he.config.cache_response)&&y,cache_ttl:null!=(b=he.config.cache_ttl)?b:3600,retry_on_fail:null==(v=he.config.retry_on_fail)||v,max_retries:null!=(A=he.config.max_retries)?A:3,timeout:null!=(j=he.config.timeout)?j:null,priority:null!=(w=he.config.priority)?w:1,error_handling:null!=(k=he.config.error_handling)?k:"default",output_file:null!=(C=he.config.output_file)?C:null,output_json:null!=(S=he.config.output_json)?S:null,output_pydantic:null!=(_=he.config.output_pydantic)?_:null,callback:null!=(E=he.config.callback)?E:null,callback_config:null!=(I=he.config.callback_config)?I:null,human_input:null!=(T=he.config.human_input)&&T,condition:he.config.condition,guardrail:null!=(D=he.config.guardrail)?D:null,markdown:null!=(O=he.config.markdown)&&O}:{cache_response:!1,cache_ttl:3600,retry_on_fail:!0,max_retries:3,timeout:null,priority:1,error_handling:"default",output_file:null,output_json:null,output_pydantic:null,callback:null,callback_config:null,human_input:!1,guardrail:null,markdown:!1}}),[Me,ze]=(0,s.useState)(null),[Le,We]=(0,s.useState)([]),[Re,Be]=(0,s.useState)(null),[Ve,Ue]=(0,s.useState)({}),[He,Ke]=(0,s.useState)({}),[Ge,Je]=(0,s.useState)([]),[Ye,Xe]=(0,s.useState)((null==he?void 0:he.tool_configs)||{}),[Qe,$e]=(0,s.useState)(!1),[et,tt]=(0,s.useState)("");(0,s.useEffect)(()=>{if(null!=he&&he.tools&&Ne(e=>Object.assign({},e,{tools:he.tools})),null!=he&&he.tool_configs){Xe(he.tool_configs);const e=he.tool_configs.GenieTool;if(e){const t=e.spaceId||e.space_id,n=e.spaceName||e.space_name||t;t&&"string"===typeof t&&Be({id:t,name:n})}if(he.tool_configs.PerplexityTool&&Ue(he.tool_configs.PerplexityTool),he.tool_configs.SerperDevTool&&Ke(he.tool_configs.SerperDevTool),he.tool_configs.MCP_SERVERS){const e=he.tool_configs.MCP_SERVERS,t=Array.isArray(e.servers)?e.servers:Array.isArray(he.tool_configs.MCP_SERVERS)?he.tool_configs.MCP_SERVERS:[];Je(t)}}},[null==he?void 0:he.tools,null==he?void 0:he.tool_configs,ve]),(0,s.useEffect)(()=>{(async()=>{try{const e=await Fe.TaskService.listTasks();We(e)}catch(Me){ze("Error loading available tasks")}})()},[]),(0,s.useEffect)(()=>{(async()=>{try{const e=ke.O.getInstance(),t=await e.getDatabricksEnvironment();t.databricks_host&&tt(t.databricks_host)}catch(Me){}})()},[]);const at=(e,t)=>{Ne(n=>Object.assign({},n,{[e]:t}))},st=e=>{const t=Array.isArray(e.target.value)?e.target.value:[e.target.value];Ne(e=>Object.assign({},e,{tools:t}))},it=async()=>{try{ze(null);try{var e,t;if(!Oe.name.trim())return void ze("Task name is required");if(Oe.tools.some(e=>{const t=ve.find(t=>String(t.id)===String(e)||t.id===Number(e)||t.title===e);return"GenieTool"===(null==t?void 0:t.title)})&&!Re)return void ze("Please select a Genie Space when GenieTool is selected");let n=Object.assign({},Ye);Re&&Oe.tools.some(e=>{const t=ve.find(t=>String(t.id)===String(e)||t.id===Number(e)||t.title===e);return"GenieTool"===(null==t?void 0:t.title)})?n=Object.assign({},n,{GenieTool:{spaceId:Re.id,spaceName:Re.name}}):Re||delete n.GenieTool,Ve&&Object.keys(Ve).length>0&&Oe.tools.some(e=>{const t=ve.find(t=>String(t.id)===String(e)||t.id===Number(e)||t.title===e);return"PerplexityTool"===(null==t?void 0:t.title)})?n=Object.assign({},n,{PerplexityTool:Ve}):Oe.tools.some(e=>{const t=ve.find(t=>String(t.id)===String(e)||t.id===Number(e)||t.title===e);return"PerplexityTool"===(null==t?void 0:t.title)})||delete n.PerplexityTool,He&&Object.keys(He).length>0&&Oe.tools.some(e=>{const t=ve.find(t=>String(t.id)===String(e)||t.id===Number(e)||t.title===e);return"SerperDevTool"===(null==t?void 0:t.title)})?n=Object.assign({},n,{SerperDevTool:He}):Oe.tools.some(e=>{const t=ve.find(t=>String(t.id)===String(e)||t.id===Number(e)||t.title===e);return"SerperDevTool"===(null==t?void 0:t.title)})||delete n.SerperDevTool,Ge&&Ge.length>0?n=Object.assign({},n,{MCP_SERVERS:{servers:Ge}}):delete n.MCP_SERVERS;const a=Object.assign({},Oe,{context:Array.from(Oe.context),tool_configs:Object.keys(n).length>0?n:void 0,markdown:null!=(e=Oe.config.markdown)?e:Oe.markdown,config:Object.assign({},Oe.config,{condition:"is_data_missing"===Oe.config.condition?"is_data_missing":void 0,callback:Oe.config.callback,callback_config:Oe.config.callback_config,output_pydantic:Oe.config.output_pydantic,markdown:null!=(t=Oe.config.markdown)?t:Oe.markdown})});try{let e;e=Oe.id?await Fe.TaskService.updateTask(Oe.id,a):await Fe.TaskService.createTask(a),fe&&fe(e),me&&me()}catch(Me){ze(Me instanceof Error?Me.message:"Error saving task")}}catch(Me){ze("Error validating task configuration.")}}catch(Me){ze("An unexpected error occurred.")}};Dt(()=>{},De,150);const ot=()=>{Ee(!1)},rt=()=>{Te(!1)},lt=Oe.tools.some(e=>{const t=ve.find(t=>String(t.id)===String(e)||t.id===Number(e)||t.title===e);return"GenieTool"===(null==t?void 0:t.title)})&&!Re;return(0,W.jsxs)(W.Fragment,{children:[(0,W.jsxs)(te.A,{sx:{display:"flex",flexDirection:"column",height:"70vh",position:"relative",overflow:"hidden"},children:[!je&&(0,W.jsxs)(i.A,{sx:{p:3,pb:2},children:[(0,W.jsxs)(i.A,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:3},children:[!Ae&&(0,W.jsx)(c.A,{variant:"h6",children:null!=he&&he.id?"Edit Task":"Create New Task"}),(0,W.jsx)(g.A,{startIcon:(0,W.jsx)(pe.A,{}),onClick:()=>$e(!0),variant:"outlined",size:"small",sx:{ml:2},children:"Best Practices"})]}),(0,W.jsx)(ne.A,{})]}),(0,W.jsx)(i.A,{sx:{flex:"1 1 auto",overflow:"auto",px:3,pb:2,pt:je?3:0,height:je?"calc(90vh - 120px)":"calc(90vh - 170px)"},children:(0,W.jsxs)(i.A,{component:"form",onSubmit:e=>{e.preventDefault(),it()},sx:{display:"flex",flexDirection:"column",gap:2},children:[(0,W.jsx)(U.A,{fullWidth:!0,label:"Name",value:Oe.name,onChange:e=>at("name",e.target.value),required:!0,margin:"normal",sx:{"& .MuiOutlinedInput-root":{"& fieldset":{borderColor:"rgba(0, 0, 0, 0.23)"}},"& .MuiInputLabel-root":{backgroundColor:"white",padding:"0 4px"}}}),(0,W.jsx)(U.A,{fullWidth:!0,label:"Description",value:Oe.description,onChange:e=>at("description",e.target.value),multiline:!0,rows:3,required:!0,InputProps:{endAdornment:(0,W.jsx)(ae.A,{position:"end",children:(0,W.jsx)(d.A,{edge:"end",onClick:()=>{Ee(!0)},size:"small",sx:{opacity:.7},title:"Expand description",children:(0,W.jsx)(xe.A,{fontSize:"small"})})})}}),(0,W.jsx)(U.A,{fullWidth:!0,label:"Expected Output",value:Oe.expected_output,onChange:e=>at("expected_output",e.target.value),multiline:!0,rows:3,required:!0,InputProps:{endAdornment:(0,W.jsx)(ae.A,{position:"end",children:(0,W.jsx)(d.A,{edge:"end",onClick:()=>{Te(!0)},size:"small",sx:{opacity:.7},title:"Expand expected output",children:(0,W.jsx)(xe.A,{fontSize:"small"})})})}}),(0,W.jsxs)(re.A,{fullWidth:!0,children:[(0,W.jsx)(le.A,{id:"tools-label",children:"Tools"}),(0,W.jsx)(ce.A,{labelId:"tools-label",multiple:!0,value:Oe.tools.map(String),onChange:st,label:"Tools",renderValue:e=>(0,W.jsx)(i.A,{sx:{display:"flex",flexWrap:"wrap",gap:.5},children:e.map(e=>{const t=ve.find(t=>String(t.id)===String(e)||t.id===Number(e)||t.title===e);return(0,W.jsx)(V.A,{label:t?t.title:"Tool "+e,size:"small",onDelete:()=>{const t=Oe.tools.filter(t=>String(t)!==String(e));st({target:{value:t}})},onMouseDown:e=>{e.stopPropagation()},deleteIcon:(0,W.jsx)(Q.A,{fontSize:"small",sx:{fontSize:"16px !important"}})},e)})}),children:ve&&ve.length>0?ve.filter(e=>!1!==e.enabled).map(e=>(0,W.jsx)(de.A,{value:e.id.toString(),children:(0,W.jsxs)(i.A,{sx:{display:"flex",flexDirection:"column"},children:[(0,W.jsx)(c.A,{children:e.title}),(0,W.jsx)(c.A,{variant:"caption",color:"text.secondary",children:e.description})]})},e.id)):(0,W.jsx)(de.A,{disabled:!0,children:(0,W.jsx)(c.A,{variant:"body2",color:"text.secondary",children:"No tools available"})})})]}),we&&we.knowledge_sources&&we.knowledge_sources.length>0&&(0,W.jsxs)(i.A,{sx:{mt:2,p:2,backgroundColor:"rgba(76, 175, 80, 0.04)",borderRadius:1,border:"1px solid rgba(76, 175, 80, 0.12)"},children:[(0,W.jsxs)(i.A,{sx:{display:"flex",alignItems:"center",mb:1},children:[(0,W.jsx)(kt.A,{sx:{mr:1,color:"success.main",fontSize:"1.2rem"}}),(0,W.jsxs)(c.A,{variant:"subtitle2",color:"success.main",sx:{fontWeight:600,fontSize:"0.875rem"},children:["Knowledge Files Attached (",we.knowledge_sources.length,")"]})]}),(0,W.jsx)(c.A,{variant:"caption",color:"text.secondary",sx:{display:"block",mb:1},children:"The DatabricksKnowledgeSearchTool will automatically search these files during task execution."}),(0,W.jsx)(i.A,{sx:{display:"flex",flexWrap:"wrap",gap:1},children:we.knowledge_sources.map((e,t)=>{var n;return(0,W.jsx)(V.A,{icon:(0,W.jsx)(kt.A,{}),label:(null==(n=e.fileInfo)?void 0:n.filename)||e.source,size:"small",color:"success",variant:"outlined",sx:{fontWeight:500}},t)})})]}),Oe.tools.some(e=>{const t=ve.find(t=>String(t.id)===String(e)||t.id===Number(e)||t.title===e);return"GenieTool"===(null==t?void 0:t.title)})&&(0,W.jsxs)(i.A,{sx:{mt:2},children:[(0,W.jsx)(c.A,{variant:"subtitle2",sx:{mb:1},children:"Genie Space"}),Re?(0,W.jsx)(M.A,{title:"Space ID: "+Re.id+" - Click to open in Databricks",arrow:!0,children:(0,W.jsx)(V.A,{label:Re.name,size:"medium",color:"primary",variant:"outlined",onClick:async e=>{if(e.stopPropagation(),Re)try{const e=ke.O.getInstance(),t=await e.getDatabricksConfig(),n=et||(null==t?void 0:t.workspace_url);if(n){let e=n.startsWith("https://")?n:"https://"+n;e=e.replace(/\/$/,"");const t=e+"/genie/rooms/"+Re.id+"/monitoring";window.open(t,"_blank","noopener,noreferrer")}else alert("Databricks workspace URL is not configured. Please configure it in Settings > Configuration > Databricks.")}catch(Me){alert("Error opening Genie space. Please check the console for details.")}},onDelete:()=>{Be(null),Xe(e=>{const t=Object.assign({},e);return delete t.GenieTool,t})},deleteIcon:(0,W.jsx)(Q.A,{fontSize:"small"}),sx:{cursor:"pointer","&:hover":{backgroundColor:"rgba(25, 118, 210, 0.08)"}}})}):(0,W.jsx)(i.A,{sx:{display:"flex",alignItems:"center",gap:1},children:(0,W.jsx)(Pe,{value:"",onChange:(e,t)=>{e&&(Be({id:e,name:t||e}),Xe(n=>Object.assign({},n,{GenieTool:{spaceId:e,spaceName:t||e}})))},label:"",placeholder:"Select a Genie space...",required:!0,error:lt,helperText:lt?"Genie Space is required when GenieTool is selected":"",fullWidth:!0})})]}),Oe.tools.some(e=>{const t=ve.find(t=>String(t.id)===String(e)||t.id===Number(e)||t.title===e);return"PerplexityTool"===(null==t?void 0:t.title)})&&(0,W.jsx)(i.A,{sx:{mt:2},children:(0,W.jsx)(qe,{value:Ve,onChange:e=>{Ue(e),Xe(t=>Object.assign({},t,{PerplexityTool:e}))},label:"Perplexity Configuration",helperText:"Configure Perplexity AI search parameters for this task",fullWidth:!0})}),Oe.tools.some(e=>{const t=ve.find(t=>String(t.id)===String(e)||t.id===Number(e)||t.title===e);return"SerperDevTool"===(null==t?void 0:t.title)})&&(0,W.jsx)(i.A,{sx:{mt:2},children:(0,W.jsx)(Ze,{value:He,onChange:e=>{Ke(e),Xe(t=>Object.assign({},t,{SerperDevTool:e}))},label:"Serper Configuration",helperText:"Configure Serper.dev search parameters for this task",fullWidth:!0})}),(0,W.jsxs)(i.A,{sx:{mt:2},children:[Ge.length>0&&(0,W.jsxs)(i.A,{sx:{mb:2,p:2,backgroundColor:"rgba(25, 118, 210, 0.04)",borderRadius:1,border:"1px solid rgba(25, 118, 210, 0.12)"},children:[(0,W.jsxs)(c.A,{variant:"subtitle2",color:"primary",sx:{mb:1,fontWeight:600,fontSize:"0.875rem"},children:["Selected MCP Servers (",Ge.length,")"]}),(0,W.jsx)(i.A,{sx:{display:"flex",flexWrap:"wrap",gap:1},children:Ge.map(e=>(0,W.jsx)(V.A,{label:e,size:"medium",color:"primary",variant:"filled",onDelete:()=>{const t=Ge.filter(t=>t!==e);Je(t),Xe(e=>Object.assign({},e,{MCP_SERVERS:t}))},sx:{"& .MuiChip-deleteIcon":{fontSize:"18px","&:hover":{color:"error.main"}},fontWeight:500}},e))})]}),(0,W.jsx)(nt,{value:Ge,onChange:e=>{const t=Array.isArray(e)?e:e?[e]:[];Je(t),Xe(e=>Object.assign({},e,{MCP_SERVERS:t}))},label:"MCP Servers",placeholder:"Select MCP servers for this task...",helperText:"Choose which MCP (Model Context Protocol) servers this task should have access to",multiple:!0,fullWidth:!0})]}),(0,W.jsxs)(se.A,{expanded:Ce,onChange:(e,t)=>{Se(t)},ref:De,TransitionProps:{unmountOnExit:!1,timeout:{enter:300,exit:200}},sx:{"& .MuiAccordionDetails-root":{padding:2}},children:[(0,W.jsx)(ie.A,{expandIcon:(0,W.jsx)(ge.A,{}),children:(0,W.jsx)(c.A,{children:"Advanced Configuration"})}),(0,W.jsx)(oe.A,{children:(0,W.jsx)(Tt,{advancedConfig:{async_execution:Oe.async_execution,cache_response:(null==(P=Oe.config)?void 0:P.cache_response)||!1,cache_ttl:(null==(z=Oe.config)?void 0:z.cache_ttl)||3600,callback:(null==(L=Oe.config)?void 0:L.callback)||null,callback_config:(null==(R=Oe.config)?void 0:R.callback_config)||null,context:Oe.context||[],dependencies:[],error_handling:(null==(F=Oe.config)?void 0:F.error_handling)||"default",human_input:(null==(B=Oe.config)?void 0:B.human_input)||!1,max_retries:(null==(K=Oe.config)?void 0:K.max_retries)||3,output_file:(null==(G=Oe.config)?void 0:G.output_file)||null,output_json:(null==(q=Oe.config)?void 0:q.output_json)||null,output_parser:null,output_pydantic:(null==(J=Oe.config)?void 0:J.output_pydantic)||null,priority:(null==(Y=Oe.config)?void 0:Y.priority)||1,retry_on_fail:(null==(X=Oe.config)?void 0:X.retry_on_fail)||!0,timeout:(null==(Z=Oe.config)?void 0:Z.timeout)||null,condition:null==($=Oe.config)?void 0:$.condition,guardrail:(null==(ee=Oe.config)?void 0:ee.guardrail)||null,markdown:(null==(ue=Oe.config)?void 0:ue.markdown)||!1},onConfigChange:(e,t)=>{Ne(n=>{if("async_execution"===e)return Object.assign({},n,{async_execution:void 0!==t&&Boolean(t)});const a=Object.assign({},n.config,{[e]:"condition"===e?t?"is_data_missing":void 0:t});return Object.assign({},n,{config:a})})},availableTasks:Le})})]})]})}),(0,W.jsxs)(i.A,{sx:{display:"flex",gap:2,justifyContent:"flex-end",p:2,backgroundColor:"white",borderTop:"1px solid rgba(0, 0, 0, 0.12)",position:"static",width:"100%",zIndex:1100},children:[(0,W.jsx)(g.A,{onClick:me,children:"Cancel"}),(0,W.jsx)(g.A,{onClick:()=>{it()},variant:"contained",color:"primary",disabled:lt,children:"Save"})]})]}),(0,W.jsx)(u.A,{open:!!Me,autoHideDuration:6e3,onClose:()=>ze(null),anchorOrigin:{vertical:"top",horizontal:"center"},children:(0,W.jsx)(h.A,{onClose:()=>ze(null),severity:"error",variant:"filled",sx:{width:"100%"},children:Me})}),(0,W.jsxs)(o.A,{open:_e,onClose:ot,fullWidth:!0,maxWidth:"md",children:[(0,W.jsx)(l.A,{children:(0,W.jsxs)(i.A,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:["Task Description",(0,W.jsx)(d.A,{onClick:ot,children:(0,W.jsx)(N.A,{})})]})}),(0,W.jsx)(r.A,{children:(0,W.jsx)(U.A,{autoFocus:!0,fullWidth:!0,multiline:!0,rows:15,value:Oe.description,onChange:e=>at("description",e.target.value),variant:"outlined",sx:{mt:2}})}),(0,W.jsx)(H.A,{children:(0,W.jsx)(g.A,{onClick:ot,variant:"contained",children:"Done"})})]}),(0,W.jsxs)(o.A,{open:Ie,onClose:rt,fullWidth:!0,maxWidth:"md",children:[(0,W.jsx)(l.A,{children:(0,W.jsxs)(i.A,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:["Expected Output",(0,W.jsx)(d.A,{onClick:rt,children:(0,W.jsx)(N.A,{})})]})}),(0,W.jsx)(r.A,{children:(0,W.jsx)(U.A,{autoFocus:!0,fullWidth:!0,multiline:!0,rows:15,value:Oe.expected_output,onChange:e=>at("expected_output",e.target.value),variant:"outlined",sx:{mt:2}})}),(0,W.jsx)(H.A,{children:(0,W.jsx)(g.A,{onClick:rt,variant:"contained",children:"Done"})})]}),(0,W.jsx)(Pt,{open:Qe,onClose:()=>$e(!1)})]})};var zt=n(61031);const Lt=e=>{var t,n,a;let{data:u,id:h}=e;const{setNodes:m,setEdges:g,getNodes:p,getEdges:x}=(0,y.VH)(),[f,b]=(0,s.useState)(!1),[v,A]=(0,s.useState)([]),[j,w]=(0,s.useState)(!1),[k,C]=(0,s.useState)(!1),[S,_]=(0,s.useState)(!1),{markCurrentTabDirty:I}=ft(),T=(0,E.z)(e=>e.layoutOrientation),D=(0,zt.useTaskExecutionStore)(e=>{let t=null;if(u.label){if(t=e.getTaskStatus(u.label),t||(t=e.getTaskStatus(u.label.toLowerCase())),!t){const n=u.label.replace(/_/g," ");t=e.getTaskStatus(n)}if(!t){const n="task_"+u.label.replace(/\s+/g,"_").toLowerCase();t=e.getTaskStatus(n)}if(!t){const n=u.label.toLowerCase(),a=n.split(/\s+/).filter(e=>e.length>2),s=Array.from(e.taskStates.keys());for(const i of s){const s=i.toLowerCase();if((s.startsWith(n)||s.startsWith(n.replace(/\s+/g,"_"))||s.startsWith(n.replace(/\s+/g,"-")))&&(t=e.getTaskStatus(i),t))break;if(!t&&a.length>0){if(a.every(e=>s.includes(e))&&(t=e.getTaskStatus(i),t))break}}}}if(!t&&u.taskId&&(t=e.getTaskStatus(u.taskId),!t&&u.taskId.startsWith("task-"))){const n=u.taskId.substring(5);t=e.getTaskStatus(n)}return t});(0,s.useEffect)(()=>{x()},[h,u,x]),(0,s.useEffect)(()=>{if(f){(async()=>{try{const e=await xt.m.listEnabledTools();A(e)}catch(e){}})()}},[f]),(0,s.useEffect)(()=>{(async()=>{try{const e=await xt.m.listEnabledTools();A(e)}catch(e){}})()},[]);const O=(0,s.useCallback)(()=>{_(e=>!e)},[]),P=(0,s.useCallback)(()=>{w(!1),C(!1),m(e=>e.filter(e=>e.id!==h)),g(e=>e.filter(e=>e.source!==h&&e.target!==h))},[h,m,g]),z=()=>{w(!1),C(!1),document.activeElement&&document.activeElement.blur(),b(!0)},L=(0,s.useCallback)(()=>{const e=p(),t=x(),n=e.find(e=>e.id===h);if(!n)return;const a=e.filter(e=>"taskNode"===e.type),s=a.find(e=>{const t=e.position.y>n.position.y,s=Math.abs(e.position.x-n.position.x)<100,i=!a.some(t=>{const a=t.position.y>n.position.y,s=Math.abs(t.position.x-n.position.x)<100,i=t.position.y<e.position.y;return t.id!==e.id&&a&&s&&i});return t&&s&&i});if(s){if(!t.some(e=>e.source===h&&e.target===s.id)){const e={id:h+"-"+s.id,source:h,target:s.id,sourceHandle:"right",targetHandle:"left",type:"default",animated:!0};g(t=>[...t,e])}}},[h,p,x,g]);(0,s.useEffect)(()=>{f&&(w(!1),C(!1))},[f]);const R=(0,s.useCallback)(e=>{e.preventDefault(),e.stopPropagation();const t=e.target,n=!!t.closest("button"),a=!!t.closest(".action-buttons");n||a||(0===e.button?z():2===e.button&&O())},[h,O,z]),F=(0,s.useCallback)(e=>{e.preventDefault(),e.stopPropagation()},[]),B={mr:1.5,color:e=>e.palette.primary.main,fontSize:"2rem",padding:"4px",borderRadius:"50%",backgroundColor:"rgba(25, 118, 210, 0.05)"},V=(null==(t=u.tools)?void 0:t.includes("DatabricksKnowledgeSearchTool"))||(null==(n=u.tools)?void 0:n.includes("36"));return(0,W.jsxs)(W.Fragment,{children:[(0,W.jsx)(y.h7,{type:"target",position:y.yX.Top,id:"top",style:{background:"#2196f3",width:"7px",height:"7px",opacity:"vertical"===T?1:0,pointerEvents:"vertical"===T?"all":"none"}}),(0,W.jsx)(y.h7,{type:"target",position:y.yX.Left,id:"left",style:{background:"#2196f3",width:"7px",height:"7px",opacity:"horizontal"===T?1:0,pointerEvents:"horizontal"===T?"all":"none"}}),(0,W.jsxs)(i.A,{sx:(()=>{const e="running"===(null==D?void 0:D.status),t="completed"===(null==D?void 0:D.status),n="failed"===(null==D?void 0:D.status),a={minWidth:160,minHeight:120,display:"flex",flexDirection:"column",position:"relative",padding:2,cursor:"pointer",background:a=>e?"linear-gradient(135deg, "+a.palette.info.light+"15, "+a.palette.info.main+"10)":t?"linear-gradient(135deg, "+a.palette.success.light+"15, "+a.palette.success.main+"10)":n?"linear-gradient(135deg, "+a.palette.error.light+"15, "+a.palette.error.main+"10)":S?a.palette.primary.light+"20":a.palette.background.paper,borderRadius:"8px",border:"1px solid",borderColor:a=>e?a.palette.info.main:t?a.palette.success.main:n?a.palette.error.main:S?a.palette.primary.main:a.palette.grey[300],boxShadow:e=>S?"0 0 0 2px "+e.palette.primary.main:"0 2px 4px "+("light"===e.palette.mode?"rgba(0, 0, 0, 0.05)":"rgba(0, 0, 0, 0.2)"),animation:e?"pulse 2s infinite":"none","@keyframes pulse":{"0%":{boxShadow:"0 0 0 0 rgba(33, 150, 243, 0.4)"},"70%":{boxShadow:"0 0 0 10px rgba(33, 150, 243, 0)"},"100%":{boxShadow:"0 0 0 0 rgba(33, 150, 243, 0)"}},"&:hover":{boxShadow:"0 4px 8px rgba(0, 0, 0, 0.15)","& .action-buttons":{display:"flex"}},"& .action-buttons":{display:"none",position:"absolute",top:4,right:4,zIndex:10,pointerEvents:"all"}};return a})(),onClick:R,onContextMenu:F,"data-taskid":u.taskId,"data-label":u.label,"data-nodeid":h,"data-nodetype":"task","data-selected":S?"true":"false",children:[V&&(0,W.jsx)(i.A,{sx:{position:"absolute",top:4,left:4,color:"primary.main",display:"flex",zIndex:5},children:(0,W.jsx)(M.A,{title:"Task has knowledge search capability",disableInteractive:!0,placement:"top",children:(0,W.jsx)(kt.A,{fontSize:"small"})})}),D&&(0,W.jsx)(i.A,{sx:{position:"absolute",top:8,right:8,display:"flex",alignItems:"center",justifyContent:"center"},children:(()=>{if(!D)return null;switch(D.status){case"running":return(0,W.jsx)(Y.A,{size:14,sx:{color:"info.main"}});case"completed":return(0,W.jsx)(rt.A,{sx:{fontSize:16,color:"success.main"}});case"failed":return(0,W.jsx)(wt.A,{sx:{fontSize:16,color:"error.main"}});default:return null}})()}),(0,W.jsxs)("div",{className:"action-buttons",children:[(0,W.jsx)(M.A,{title:"Edit Task",open:j,onOpen:()=>w(!0),onClose:()=>w(!1),children:(0,W.jsx)(d.A,{size:"small",onClick:z,onMouseEnter:()=>w(!0),onMouseLeave:()=>w(!1),sx:{mr:.5,backgroundColor:"rgba(255, 255, 255, 0.3)","&:hover":{backgroundColor:"rgba(255, 255, 255, 0.5)"},zIndex:20},children:(0,W.jsx)(Z.A,{fontSize:"small"})})}),(0,W.jsx)(M.A,{title:"Delete Task",open:k,onOpen:()=>C(!0),onClose:()=>C(!1),children:(0,W.jsx)(d.A,{size:"small",onClick:P,onMouseEnter:()=>C(!0),onMouseLeave:()=>C(!1),sx:{backgroundColor:"rgba(255, 255, 255, 0.3)","&:hover":{backgroundColor:"rgba(255, 255, 255, 0.5)"},zIndex:20},children:(0,W.jsx)(Q.A,{fontSize:"small"})})})]}),(0,W.jsxs)(i.A,{sx:{display:"flex",alignItems:"center",mb:1},children:[u.icon?(0,W.jsx)(i.A,{component:"span",sx:B,children:u.icon}):(0,W.jsx)(jt.A,{sx:B}),(0,W.jsx)(c.A,{variant:"body2",sx:{fontWeight:500,color:e=>e.palette.primary.main,fontSize:"0.9rem"},children:u.label})]}),(0,W.jsx)(c.A,{variant:"body2",color:"textSecondary",sx:{fontSize:"0.8rem",overflow:"hidden",textOverflow:"ellipsis",display:"-webkit-box",WebkitLineClamp:2,WebkitBoxOrient:"vertical"},children:u.description}),(0,W.jsxs)(c.A,{variant:"caption",color:"textSecondary",sx:{mt:"auto",pt:1,fontSize:"0.7rem",display:"flex",alignItems:"center",justifyContent:"space-between",width:"100%"},children:[(0,W.jsxs)("span",{children:["Tools: ",Array.isArray(u.tools)?u.tools.length:0]}),(null==(a=u.config)?void 0:a.human_input)&&(0,W.jsx)("span",{style:{color:"orange"},children:"Human Input"})]}),Boolean(null==u?void 0:u.loading)&&(0,W.jsx)(i.A,{sx:{position:"absolute",inset:0,borderRadius:"8px",background:e=>"light"===e.palette.mode?"linear-gradient(90deg, rgba(255,255,255,0.35) 25%, rgba(255,255,255,0.6) 37%, rgba(255,255,255,0.35) 63%)":"linear-gradient(90deg, rgba(255,255,255,0.08) 25%, rgba(255,255,255,0.16) 37%, rgba(255,255,255,0.08) 63%)",backgroundSize:"400% 100%",animation:"shimmer 1.6s linear infinite","@keyframes shimmer":{"0%":{backgroundPosition:"-200% 0"},"100%":{backgroundPosition:"200% 0"}},backdropFilter:"blur(1px)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:5},children:(0,W.jsxs)(i.A,{sx:{display:"flex",alignItems:"center",gap:1},children:[(0,W.jsx)(Y.A,{size:16,sx:{color:"primary.main"}}),(0,W.jsx)(c.A,{variant:"caption",color:"textSecondary",children:"Creating\u2026"})]})})]}),(0,W.jsx)(y.h7,{type:"source",position:y.yX.Right,style:{background:"#2196f3",width:"7px",height:"7px"},onDoubleClick:L}),(0,W.jsxs)(o.A,{open:f,onClose:()=>b(!1),maxWidth:"md",fullWidth:!0,PaperProps:{sx:{maxHeight:"80vh",position:"relative"}},children:[(0,W.jsxs)(l.A,{children:["Edit Task",(0,W.jsx)(d.A,{"aria-label":"close",onClick:()=>b(!1),sx:{position:"absolute",right:8,top:8},children:(0,W.jsx)(N.A,{})})]}),(0,W.jsx)(r.A,{children:(0,W.jsx)(i.A,{sx:{mt:2},children:(0,W.jsx)(Mt,{initialData:(()=>{var e,t,n,a,s,i,o,r,l,c,d,h,m,g,p,x;return{id:u.taskId,name:u.label,description:u.description||"",expected_output:u.expected_output||"",tools:u.tools||[],tool_configs:u.tool_configs||{},agent_id:"",async_execution:u.async_execution||!1,context:u.context||[],markdown:(null==(e=u.config)?void 0:e.markdown)||!1,config:{cache_response:(null==(t=u.config)?void 0:t.cache_response)||!1,cache_ttl:(null==(n=u.config)?void 0:n.cache_ttl)||3600,retry_on_fail:(null==(a=u.config)?void 0:a.retry_on_fail)||!0,max_retries:(null==(s=u.config)?void 0:s.max_retries)||3,timeout:(null==(i=u.config)?void 0:i.timeout)||null,priority:(null==(o=u.config)?void 0:o.priority)||1,error_handling:(null==(r=u.config)?void 0:r.error_handling)||"default",output_file:(null==(l=u.config)?void 0:l.output_file)||null,output_json:(null==(c=u.config)?void 0:c.output_json)||null,output_pydantic:(null==(d=u.config)?void 0:d.output_pydantic)||null,callback:(null==(h=u.config)?void 0:h.callback)||null,human_input:(null==(m=u.config)?void 0:m.human_input)||!1,condition:null==(g=u.config)?void 0:g.condition,guardrail:(null==(p=u.config)?void 0:p.guardrail)||void 0,markdown:(null==(x=u.config)?void 0:x.markdown)||!1}}})(),onCancel:()=>b(!1),onTaskSaved:e=>{I(),m(t=>t.map(t=>{if(t.id===h){var n,a,s,i,o,r,l;const c=Object.assign({},t.data,{label:e.name,description:e.description,expected_output:e.expected_output,tools:e.tools,tool_configs:e.tool_configs||{},async_execution:e.async_execution,context:e.context,markdown:void 0!==e.markdown?e.markdown:(null==(n=e.config)?void 0:n.markdown)||!1,config:Object.assign({},t.data.config,e.config,{output_pydantic:(null==(a=e.config)?void 0:a.output_pydantic)||null,output_json:(null==(s=e.config)?void 0:s.output_json)||null,output_file:(null==(i=e.config)?void 0:i.output_file)||null,callback:(null==(o=e.config)?void 0:o.callback)||null,guardrail:(null==(r=e.config)?void 0:r.guardrail)||void 0,markdown:void 0!==e.markdown?e.markdown:(null==(l=e.config)?void 0:l.markdown)||!1})});return Object.assign({},t,{data:c})}return t})),b(!1)},tools:v,hideTitle:!0})})})]})]})},Wt=s.memo(Lt);const Rt=n(51673).v.createChild("FlowService");class Ft{static async getFlows(){try{const e=await ve.uE.get("/flows");return e.data.map(e=>(e.flow_config&&(e.flowConfig=e.flow_config,e.nodes&&Array.isArray(e.nodes)&&(e.nodes=e.nodes.map(t=>t.data?Object.assign({},t,{data:Object.assign({},t.data,{flowConfig:e.flowConfig})}):t))),e))}catch(e){return[]}}static async getFlow(e){try{if(!e||""===e.trim())return null;let n=e;if(e&&!e.includes("-")&&e.length>=32)try{n=[e.substring(0,8),e.substring(8,12),e.substring(12,16),e.substring(16,20),e.substring(20)].join("-")}catch(t){n=e}const a=(await ve.uE.get("/flows/"+n)).data;return a&&"object"===typeof a?(a.flow_config&&(a.flowConfig=a.flow_config,a.nodes&&Array.isArray(a.nodes)&&(a.nodes=a.nodes.map(e=>e.data?Object.assign({},e,{data:Object.assign({},e.data,{flowConfig:a.flowConfig})}):e))),a):null}catch(n){if(n&&"object"===typeof n&&"response"in n){}return null}}static async saveFlow(e){try{if(Rt.info("Saving new flow with name:",e.name),!e.name)throw new Error("Flow name is required");if(void 0===e.crew_id||null===e.crew_id)throw new Error("Crew ID is required");if(!Array.isArray(e.nodes))throw new Error("Nodes must be an array");if(!Array.isArray(e.edges))throw new Error("Edges must be an array");let o=e.crew_id;("number"===typeof o||/^\d+$/.test(o))&&(Rt.debug("Converting numeric crew_id "+o+" to UUID format"),o=(0,w.A)(),Rt.debug("Generated UUID for crew_id: "+o)),Rt.debug("Incoming flow data:",{name:e.name,crew_id:o,nodes:e.nodes.length,edges:e.edges.length,hasFlowConfig:!!e.flowConfig});const r=e.flowConfig?{id:e.flowConfig.id||"flow-"+Date.now(),name:e.flowConfig.name||e.name,type:e.flowConfig.type||"default",listeners:(e.flowConfig.listeners||[]).map(e=>(Rt.debug("Processing listener:",e.name),Object.assign({id:e.id,name:e.name,crewId:e.crewId,crewName:e.crewName,listenToTaskIds:e.listenToTaskIds||[],listenToTaskNames:e.listenToTaskNames||[],tasks:(e.tasks||[]).map(e=>({id:e.id,name:e.name,agent_id:e.agent_id,description:e.description||"",expected_output:e.expected_output||"",tools:e.tools||[],context:e.context||[],markdown:Boolean(e.markdown||!1)})),state:e.state||{stateType:"unstructured",stateDefinition:"",stateData:{}},conditionType:e.conditionType||"NONE"},"ROUTER"===e.conditionType&&e.routerConfig?{routerConfig:{defaultRoute:e.routerConfig.defaultRoute,routes:e.routerConfig.routes.map(e=>({name:e.name,condition:e.condition,taskIds:e.taskIds}))}}:{}))),actions:(e.flowConfig.actions||[]).map(e=>(Rt.debug("Processing action:",e.id),{id:e.id,crewId:e.crewId,crewName:e.crewName,taskId:e.taskId,taskName:e.taskName})),startingPoints:(e.flowConfig.startingPoints||[]).filter(e=>e.isStartPoint).map(e=>(Rt.debug("Processing starting point:",e.taskName),{crewId:e.crewId,crewName:e.crewName,taskId:e.taskId,taskName:e.taskName,isStartPoint:!0}))}:{id:"flow-"+Date.now(),name:e.name,type:"default",listeners:[],actions:[],startingPoints:[]},l=e.nodes.map(e=>{var t;return Rt.debug("Processing node:",e.id),{id:e.id,type:e.type,position:e.position||{x:0,y:0},data:Object.assign({},e.data,{label:(null==(t=e.data)?void 0:t.label)||e.id})}}),c=e.edges.map(e=>(Rt.debug("Processing edge:",e.id),{id:e.id,source:e.source,target:e.target,type:e.type||"default"})),d={name:e.name,crew_id:o,nodes:l,edges:c,flow_config:r};Rt.debug("Sending flow data to backend:",{name:d.name,crew_id:d.crew_id,nodesCount:d.nodes.length,edgesCount:d.edges.length});try{const e=await ve.uE.post("/flows",d);Rt.info("Flow created successfully:",e.data.id);const t=e.data;return t.flow_config&&(t.flowConfig=t.flow_config),t}catch(i){if(i&&"object"===typeof i&&"response"in i){var t,n,a,s;const e=i;throw Rt.error("Server validation error details:",{status:null==(t=e.response)?void 0:t.status,statusText:null==(n=e.response)?void 0:n.statusText,data:null==(a=e.response)?void 0:a.data}),new Error("Server validation error: "+JSON.stringify(null==(s=e.response)?void 0:s.data))}throw i instanceof Error?i:new Error("Unknown error occurred")}}catch(i){throw Rt.error("Error creating flow:",i),i instanceof Error?i:new Error("Failed to save flow")}}static async updateFlow(e,t){try{let a=e;if(e&&!e.includes("-")&&e.length>=32)try{a=[e.substring(0,8),e.substring(8,12),e.substring(12,16),e.substring(16,20),e.substring(20)].join("-")}catch(n){a=e}const s=t.flowConfig?{id:t.flowConfig.id||"flow-"+Date.now(),name:t.flowConfig.name||t.name,type:t.flowConfig.type||"default",listeners:(t.flowConfig.listeners||[]).map(e=>Object.assign({id:e.id,name:e.name,crewId:e.crewId,crewName:e.crewName,listenToTaskIds:e.listenToTaskIds||[],listenToTaskNames:e.listenToTaskNames||[],tasks:(e.tasks||[]).map(e=>({id:e.id,name:e.name,agent_id:e.agent_id,description:e.description||"",expected_output:e.expected_output||"",tools:e.tools||[],context:e.context||[],markdown:Boolean(e.markdown||!1)})),state:e.state||{stateType:"unstructured",stateDefinition:"",stateData:{}},conditionType:e.conditionType||"NONE"},"ROUTER"===e.conditionType&&e.routerConfig?{routerConfig:{defaultRoute:e.routerConfig.defaultRoute,routes:e.routerConfig.routes.map(e=>({name:e.name,condition:e.condition,taskIds:e.taskIds}))}}:{})),actions:(t.flowConfig.actions||[]).map(e=>({id:e.id,crewId:e.crewId,crewName:e.crewName,taskId:e.taskId,taskName:e.taskName})),startingPoints:(t.flowConfig.startingPoints||[]).filter(e=>e.isStartPoint).map(e=>({crewId:e.crewId,crewName:e.crewName,taskId:e.taskId,taskName:e.taskName,isStartPoint:!0}))}:{},i={name:t.name,flow_config:s},o=(await ve.uE.put("/flows/"+a,i)).data;return o.flow_config&&(o.flowConfig=o.flow_config),o}catch(a){if(a instanceof Error)throw new Error("Failed to update flow: "+a.message);throw new Error("Failed to update flow: Unknown error occurred")}}static async deleteFlow(e){try{let t=e;if(e&&!e.includes("-")&&e.length>=32)try{t=[e.substring(0,8),e.substring(8,12),e.substring(12,16),e.substring(16,20),e.substring(20)].join("-")}catch(n){t=e}return await ve.uE.delete("/flows/"+t+"?force=true"),window.dispatchEvent(new CustomEvent("refreshFlows")),window.dispatchEvent(new CustomEvent("showNotification",{detail:{message:"Flow deleted successfully.",severity:"success"}})),!0}catch(a){let e="Failed to delete flow.";if(a&&"object"===typeof a&&"response"in a){var t;const n=a;if(null!=(t=n.response)&&t.data&&"object"===typeof n.response.data&&null!==n.response.data&&"detail"in n.response.data){e=n.response.data.detail||e}window.dispatchEvent(new CustomEvent("showNotification",{detail:{message:e,severity:"error"}}))}return!1}}static async deleteAllFlows(){try{await ve.uE.delete("/flows")}catch(e){throw e}}}let Bt=function(e){return e[e.SelectCrews=0]="SelectCrews",e[e.DefineStartingPoints=1]="DefineStartingPoints",e[e.ConfigureListeners=2]="ConfigureListeners",e[e.ConfigureState=3]="ConfigureState",e[e.Review=4]="Review",e}({});const Vt={activeStep:Bt.SelectCrews,crews:[],selectedCrewIds:[],listeners:[],tasks:[],actions:[],startingPoints:[],flowName:"New Flow",loading:!1,error:null,currentListenerIndex:-1,selectedListenerTasks:[],selectedListenToTasks:[],selectedActionTasks:{}},Ut=(0,A.vt)((e,t)=>Object.assign({},Vt,{setActiveStep:t=>e({activeStep:t}),setCrews:t=>e({crews:t}),setSelectedCrewIds:t=>e({selectedCrewIds:t}),setListeners:t=>e({listeners:t}),setTasks:t=>e({tasks:t}),setActions:t=>e({actions:t}),setStartingPoints:t=>e({startingPoints:t}),setFlowName:t=>e({flowName:t}),setLoading:t=>e({loading:t}),setError:t=>e({error:t}),setCurrentListenerIndex:t=>e({currentListenerIndex:t}),setSelectedListenerTasks:t=>e({selectedListenerTasks:t}),setSelectedListenToTasks:t=>e({selectedListenToTasks:t}),setSelectedActionTasks:t=>e({selectedActionTasks:t}),resetFlowWizard:()=>{e({activeStep:Bt.SelectCrews,crews:[],selectedCrewIds:[],listeners:[],tasks:[],actions:[],startingPoints:[],flowName:"",loading:!1,error:null,currentListenerIndex:-1,selectedListenerTasks:[],selectedListenToTasks:[],selectedActionTasks:{}})},loadCrews:async()=>{try{e({loading:!0,error:null});const n=await Re.getCrews();e({crews:n});const a=[];for(const e of n)try{const t=await Re.getTasks(e.id);a.push(...t)}catch(t){}e({tasks:a})}catch(t){e({error:"Failed to load crews. Please try again."})}finally{e({loading:!1})}},toggleCrewSelection:n=>{const{selectedCrewIds:a}=t(),s=a.includes(n)?a.filter(e=>e!==n):[...a,n];e({selectedCrewIds:s})},handleNext:()=>{const{activeStep:n,selectedCrewIds:a,startingPoints:s,crews:i,tasks:o}=t();if(n===Bt.SelectCrews){if(0===a.length)return void e({error:"Please select at least one crew"});const t=o.filter(e=>a.includes(e.agent_id)).map(e=>{const t=i.find(t=>t.id===e.agent_id);return{crewId:e.agent_id,taskId:e.id,isStartPoint:!1,taskName:e.name,crewName:(null==t?void 0:t.name)||"Unknown Crew"}});e({startingPoints:t,activeStep:Bt.DefineStartingPoints})}else if(n===Bt.DefineStartingPoints){if(!s.some(e=>e.isStartPoint))return void e({error:"Please select at least one task as a starting point"});e({activeStep:Bt.ConfigureListeners})}else n===Bt.ConfigureListeners?e({activeStep:Bt.ConfigureState}):n===Bt.ConfigureState&&e({activeStep:Bt.Review})},handleBack:()=>{const{activeStep:n}=t();n>0&&e({activeStep:n-1})},handleListenerTaskChange:n=>{const{currentListenerIndex:a,listeners:s}=t();if(a>=0){const i=[...s],o=n.map(e=>t().tasks.find(t=>t.id===e)||{id:e,name:e,agent_id:"",expected_output:"",description:"",context:[]});i[a]=Object.assign({},i[a],{tasks:o}),e({listeners:i,selectedListenerTasks:n})}},handleListenToTaskChange:n=>{const{currentListenerIndex:a,listeners:s}=t();if(a>=0){const i=[...s];i[a]=Object.assign({},i[a],{listenToTaskIds:n,listenToTaskNames:n.map(e=>{const n=t().tasks.find(t=>t.id===e);return(null==n?void 0:n.name)||e})}),e({listeners:i})}},handleStateUpdate:n=>{const{currentListenerIndex:a,listeners:s}=t();if(a>=0){const t=[...s];t[a]=Object.assign({},t[a],{state:n}),e({listeners:t})}},handleActionTaskChange:(t,n)=>{e(e=>({selectedActionTasks:Object.assign({},e.selectedActionTasks,{[t]:n})}))},handleDeleteAction:n=>{const a=t().actions.filter(e=>{const a=t().tasks.find(e=>e.id===n);return a&&a.id!==n});e({actions:a})},handleToggleStartingPoint:n=>{const{startingPoints:a}=t(),s=a.map(e=>e.taskId===n?Object.assign({},e,{isStartPoint:!e.isStartPoint}):e);e({startingPoints:s})},addListener:()=>{const{listeners:n,crews:a}=t(),s=a[0],i={id:"listener-"+Date.now()+"-"+n.length,name:"Listener "+(n.length+1),crewId:(null==s?void 0:s.id)||"",crewName:(null==s?void 0:s.name)||"Unknown Crew",listenToTaskIds:[],listenToTaskNames:[],tasks:[],waitForAll:!1,state:{stateType:"unstructured",stateDefinition:"",stateData:{}},conditionType:"NONE"};e({listeners:[...n,i],currentListenerIndex:n.length,selectedListenerTasks:[]})},deleteListener:n=>{const{listeners:a,currentListenerIndex:s}=t(),i=a.filter(e=>e.id!==n);e({listeners:i,currentListenerIndex:s>=i.length?i.length-1:s})},updateListenerName:(n,a)=>{const{listeners:s}=t(),i=[...s];i[n]=Object.assign({},i[n],{name:a}),e({listeners:i})},updateListenerConditionType:(n,a)=>{const{listeners:s}=t();if(n>=0&&n<s.length){const t=[...s];t[n]=Object.assign({},t[n],{conditionType:a}),e({listeners:t})}},updateRouterConfig:(n,a,s)=>{const{listeners:i}=t();if(n>=0&&n<i.length){const t=[...i];t[n]=Object.assign({},t[n],{routerConfig:{defaultRoute:a,routes:s}}),e({listeners:t})}}})),Ht=e=>{let{crews:t,selectedCrewIds:n,onCrewSelect:a}=e;return t&&0!==t.length?(0,W.jsxs)(i.A,{sx:{pt:2,pb:2},children:[(0,W.jsx)(c.A,{variant:"body1",gutterBottom:!0,children:"Select crews to add to the canvas:"}),(0,W.jsx)(i.A,{sx:{display:"flex",flexWrap:"wrap",gap:2,mt:2},children:t.map(e=>(0,W.jsxs)(i.A,{onClick:()=>a(e),sx:{border:"2px solid",borderColor:n.includes(e.id)?"primary.main":"grey.300",borderRadius:"8px",padding:2,cursor:"pointer",bgcolor:n.includes(e.id)?"primary.light":"background.paper",transition:"all 0.2s ease",width:"calc(50% - 8px)",boxSizing:"border-box","&:hover":{bgcolor:n.includes(e.id)?"primary.light":"grey.100"}},children:[(0,W.jsx)(c.A,{variant:"subtitle1",children:e.name}),(0,W.jsx)(c.A,{variant:"body2",color:"text.secondary",children:"ID: "+e.id})]},e.id))})]}):(0,W.jsx)(i.A,{display:"flex",justifyContent:"center",p:3,children:(0,W.jsx)(Y.A,{})})};var Kt=n(93038);const Gt=e=>{let{tasks:t,startingPoints:n,onToggleStartingPoint:a}=e;const s=n.filter(e=>{const n=t.find(t=>t.id===e.taskId);return n&&!n.id.startsWith("agent-")});return 0===s.length?(0,W.jsx)(c.A,{variant:"body2",color:"text.secondary",sx:{p:2},children:"No valid tasks found for the selected crews. Please go back and select different crews."}):(0,W.jsxs)(i.A,{sx:{pt:2,pb:2},children:[(0,W.jsx)(c.A,{variant:"body1",gutterBottom:!0,children:"Select tasks for your flow:"}),(0,W.jsxs)(i.A,{sx:{mt:2},children:[(0,W.jsx)(c.A,{variant:"caption",color:"text.secondary",sx:{mb:1,display:"block"},children:"At least one task must be selected as a starting point. Starting points are specific tasks that will trigger the workflow execution."}),(0,W.jsxs)(_e.A,{variant:"outlined",sx:{mb:2,p:2},children:[(0,W.jsx)(c.A,{variant:"subtitle2",color:"primary",gutterBottom:!0,children:"Only tasks (with numeric IDs) can be starting points, not agents"}),(0,W.jsx)(at.A,{dense:!0,children:s.map(e=>{const n=t.find(t=>t.id===e.taskId);return n?(0,W.jsx)(st.Ay,{secondaryAction:(0,W.jsx)(Kt.A,{edge:"end",checked:e.isStartPoint,onChange:()=>a(e.taskId),inputProps:{"aria-labelledby":"task-"+e.taskId}}),children:(0,W.jsx)(ot.A,{id:"task-"+e.taskId,primary:e.crewName+":"+n.name,secondary:"ID: "+n.id+" (Task)"})},e.taskId):null})})]})]})]})};var qt=n(29277),Jt=n(58567),Yt=n(85815),Xt=n(45180),Qt=n(50704),Zt=n(25713),$t=n(99532);const en=e=>{var t,n,a,o;let{tasks:r,listeners:l,selectedCrewIds:u,crews:h,onListenerTaskChange:m,onListenToTaskChange:p,onAddListener:x,onDeleteListener:f,onUpdateListenerName:y,onUpdateConditionType:b,onUpdateRouterConfig:v}=e;const[A,j]=(0,s.useState)(-1),[w,k]=(0,s.useState)([]),[C,S]=(0,s.useState)(""),_=r.filter(e=>e.agent_id&&u.includes(e.agent_id));return(0,W.jsxs)(i.A,{sx:{pt:2,pb:2},children:[(0,W.jsx)(c.A,{variant:"body1",gutterBottom:!0,children:"Configure listeners for your flow:"}),(0,W.jsx)(c.A,{variant:"caption",color:"text.secondary",sx:{mb:2,display:"block"},children:"Listeners respond to task outputs in the flow. Each listener can execute one or more tasks when triggered."}),(0,W.jsx)(g.A,{variant:"outlined",color:"primary",onClick:x,sx:{mb:3},children:"Add New Listener"}),0===l.length?(0,W.jsx)(c.A,{variant:"body2",sx:{my:2},children:"No listeners configured. Click the button above to add a listener."}):(0,W.jsxs)(ue.Ay,{container:!0,spacing:2,sx:{mt:1,mb:2},children:[(0,W.jsxs)(ue.Ay,{item:!0,xs:12,sm:4,children:[(0,W.jsx)(c.A,{variant:"subtitle2",gutterBottom:!0,children:"Listeners"}),(0,W.jsx)(_e.A,{variant:"outlined",sx:{p:2,height:"300px",overflow:"auto"},children:l.map((e,t)=>(0,W.jsxs)(i.A,{onClick:()=>j(t),sx:{p:1.5,mb:1,borderRadius:1,cursor:"pointer",bgcolor:A===t?"primary.light":"grey.100","&:hover":{bgcolor:A===t?"primary.light":"grey.200"},position:"relative"},children:[(0,W.jsxs)(c.A,{variant:"body2",fontWeight:A===t?"bold":"normal",children:[e.name," ","NONE"!==e.conditionType?"("+e.conditionType+")":""]}),(0,W.jsxs)(c.A,{variant:"caption",color:"text.secondary",display:"block",children:["Listening to: ",e.listenToTaskNames.join(", ")||"Not set"]}),(0,W.jsxs)(c.A,{variant:"caption",color:"text.secondary",children:[e.tasks.length," task(s) to execute"]}),(0,W.jsx)(d.A,{size:"small",onClick:t=>{t.stopPropagation(),f(e.id)},sx:{position:"absolute",right:8,top:8,opacity:A===t?1:0,"&:hover":{opacity:1}},children:(0,W.jsx)(Q.A,{fontSize:"small"})})]},e.id))})]}),A>=0&&(0,W.jsxs)(ue.Ay,{item:!0,xs:12,sm:8,children:[(0,W.jsxs)(c.A,{variant:"subtitle2",gutterBottom:!0,children:["Configure Listener: ",null==(t=l[A])?void 0:t.name]}),(0,W.jsxs)(_e.A,{variant:"outlined",sx:{p:2},children:[(0,W.jsx)(U.A,{fullWidth:!0,label:"Listener Name",value:(null==(n=l[A])?void 0:n.name)||"",onChange:e=>y(A,e.target.value),sx:{mb:2}}),(0,W.jsxs)(re.A,{component:"fieldset",sx:{mb:2},children:[(0,W.jsx)(qt.A,{component:"legend",children:"Connection Type"}),(0,W.jsxs)(Jt.A,{row:!0,value:(null==(a=l[A])?void 0:a.conditionType)||"NONE",onChange:e=>(e=>{if(A>=0&&b&&(b(A,e),"ROUTER"===e)){const e=l[A];e.routerConfig?(k(e.routerConfig.routes),S(e.routerConfig.defaultRoute)):(k([{name:"Default",condition:"",taskIds:[]}]),S("Default"),v&&v(A,"Default",[{name:"Default",condition:"",taskIds:[]}]))}})(e.target.value),children:[(0,W.jsx)(he.A,{value:"NONE",control:(0,W.jsx)(Yt.A,{}),label:"Default"}),(0,W.jsx)(he.A,{value:"AND",control:(0,W.jsx)(Yt.A,{}),label:"AND"}),(0,W.jsx)(he.A,{value:"OR",control:(0,W.jsx)(Yt.A,{}),label:"OR"}),(0,W.jsx)(he.A,{value:"ROUTER",control:(0,W.jsx)(Yt.A,{}),label:"ROUTER"})]}),(0,W.jsxs)(c.A,{variant:"caption",color:"text.secondary",children:[(0,W.jsx)("strong",{children:"Default:"})," Executes after all specified tasks complete.",(0,W.jsx)("strong",{children:" AND:"})," Requires ALL tasks to complete before triggering.",(0,W.jsx)("strong",{children:" OR:"})," Triggers when ANY of the tasks completes.",(0,W.jsx)("strong",{children:" ROUTER:"})," Routes execution based on conditions."]})]}),"ROUTER"!==(null==(o=l[A])?void 0:o.conditionType)?(0,W.jsxs)(W.Fragment,{children:[(0,W.jsxs)(re.A,{fullWidth:!0,sx:{mt:2},children:[(0,W.jsx)(le.A,{id:"listen-to-task-label",children:"Listen To Tasks"}),(0,W.jsx)(ce.A,{labelId:"listen-to-task-label",multiple:!0,value:l[A].listenToTaskIds,onChange:e=>p(e.target.value),label:"Listen To Tasks",renderValue:e=>(0,W.jsx)(i.A,{sx:{display:"flex",flexWrap:"wrap",gap:.5},children:e.map(e=>{const t=_.find(t=>String(t.id)===e),n=null!=t&&t.agent_id?h.find(e=>e.id===t.agent_id):void 0;return(0,W.jsx)(V.A,{label:((null==n?void 0:n.name)||"Unknown")+":"+((null==t?void 0:t.name)||e)},e)})}),children:_.map(e=>{const t=String(e.id),n=e.agent_id?h.find(t=>t.id===e.agent_id):void 0;return(0,W.jsxs)(de.A,{value:t,children:[(0,W.jsx)(Kt.A,{checked:l[A].listenToTaskIds.includes(t)}),(0,W.jsx)(ot.A,{primary:e.name,secondary:((null==n?void 0:n.name)||"Unknown Crew")+" (Task ID: "+e.id+")"})]},t)})})]}),(0,W.jsxs)(re.A,{fullWidth:!0,sx:{mt:3},children:[(0,W.jsx)(le.A,{id:"listener-task-label",children:"Tasks to Execute"}),(0,W.jsx)(ce.A,{labelId:"listener-task-label",multiple:!0,value:l[A].tasks.map(e=>String(e.id)),onChange:e=>m(e.target.value),label:"Tasks to Execute",renderValue:e=>(0,W.jsx)(i.A,{sx:{display:"flex",flexWrap:"wrap",gap:.5},children:e.map(e=>{const t=_.find(t=>String(t.id)===e),n=null!=t&&t.agent_id?h.find(e=>e.id===t.agent_id):void 0;return(0,W.jsx)(V.A,{label:((null==n?void 0:n.name)||"Unknown")+":"+((null==t?void 0:t.name)||e)},e)})}),children:_.map(e=>{const t=String(e.id),n=e.agent_id?h.find(t=>t.id===e.agent_id):void 0;return(0,W.jsxs)(de.A,{value:t,children:[(0,W.jsx)(Kt.A,{checked:l[A].tasks.map(e=>String(e.id)).includes(t)}),(0,W.jsx)(ot.A,{primary:e.name,secondary:((null==n?void 0:n.name)||"Unknown Crew")+" (Task ID: "+e.id+")"})]},t)})})]})]}):(0,W.jsxs)(i.A,{sx:{mt:3},children:[(0,W.jsx)(ne.A,{sx:{mb:2}}),(0,W.jsx)(c.A,{variant:"subtitle2",gutterBottom:!0,children:"Router Configuration"}),(0,W.jsxs)(re.A,{fullWidth:!0,sx:{mb:2},children:[(0,W.jsx)(le.A,{id:"listen-to-router-task-label",children:"Listen To Task"}),(0,W.jsx)(ce.A,{labelId:"listen-to-router-task-label",value:l[A].listenToTaskIds.length>0?l[A].listenToTaskIds[0]:"",onChange:e=>p([e.target.value]),label:"Listen To Task",children:_.map(e=>{const t=String(e.id),n=e.agent_id?h.find(t=>t.id===e.agent_id):void 0;return(0,W.jsx)(de.A,{value:t,children:(0,W.jsx)(ot.A,{primary:e.name,secondary:((null==n?void 0:n.name)||"Unknown Crew")+" (Task ID: "+e.id+")"})},t)})}),(0,W.jsx)(c.A,{variant:"caption",color:"text.secondary",sx:{mt:1},children:"For a router, you should select exactly one task to listen to."})]}),(0,W.jsxs)(re.A,{fullWidth:!0,sx:{mb:2},children:[(0,W.jsx)(le.A,{id:"default-route-label",children:"Default Route"}),(0,W.jsx)(ce.A,{labelId:"default-route-label",value:C,onChange:e=>{return t=e.target.value,S(t),void(A>=0&&v&&v(A,t,w));var t},label:"Default Route",children:w.map((e,t)=>(0,W.jsx)(de.A,{value:e.name,children:e.name},t))}),(0,W.jsx)(c.A,{variant:"caption",color:"text.secondary",sx:{mt:1},children:"The default route will be taken if no condition matches."})]}),(0,W.jsx)(i.A,{sx:{display:"flex",justifyContent:"flex-end",mb:2},children:(0,W.jsx)(g.A,{startIcon:(0,W.jsx)($t.A,{}),onClick:()=>{const e=[...w,{name:"Route "+(w.length+1),condition:"",taskIds:[]}];k(e),A>=0&&v&&v(A,C,e)},variant:"outlined",children:"Add Route"})}),w.map((e,t)=>(0,W.jsxs)(te.A,{variant:"outlined",sx:{mb:2},children:[(0,W.jsx)(Xt.A,{title:(0,W.jsx)(U.A,{fullWidth:!0,label:"Route Name",value:e.name,onChange:e=>((e,t)=>{const n=[...w];n[e].name=t,k(n),w[e].name===C&&S(t),A>=0&&v&&v(A,C===w[e].name?t:C,n)})(t,e.target.value),size:"small"}),action:(0,W.jsx)(d.A,{onClick:()=>(e=>{const t=w.filter((t,n)=>n!==e);k(t),w[e].name===C&&t.length>0?(S(t[0].name),A>=0&&v&&v(A,t[0].name,t)):A>=0&&v&&v(A,C,t)})(t),disabled:w.length<=1,children:(0,W.jsx)(Q.A,{})})}),(0,W.jsxs)(Qt.A,{children:[(0,W.jsx)(U.A,{fullWidth:!0,label:"Condition",value:e.condition,onChange:e=>((e,t)=>{const n=[...w];n[e].condition=t,k(n),A>=0&&v&&v(A,C,n)})(t,e.target.value),placeholder:"e.g., state.success_flag === true",helperText:"JavaScript condition that evaluates to true/false",sx:{mb:2}}),(0,W.jsxs)(re.A,{fullWidth:!0,children:[(0,W.jsx)(le.A,{id:"route-tasks-"+t+"-label",children:"Tasks to Execute"}),(0,W.jsx)(ce.A,{labelId:"route-tasks-"+t+"-label",multiple:!0,value:e.taskIds,onChange:e=>((e,t)=>{const n=[...w];n[e].taskIds=t,k(n),A>=0&&v&&v(A,C,n)})(t,e.target.value),label:"Tasks to Execute",renderValue:e=>(0,W.jsx)(i.A,{sx:{display:"flex",flexWrap:"wrap",gap:.5},children:e.map(e=>{const t=_.find(t=>String(t.id)===e),n=null!=t&&t.agent_id?h.find(e=>e.id===t.agent_id):void 0;return(0,W.jsx)(V.A,{label:((null==n?void 0:n.name)||"Unknown")+":"+((null==t?void 0:t.name)||e)},e)})}),children:_.map(t=>{const n=String(t.id),a=t.agent_id?h.find(e=>e.id===t.agent_id):void 0;return(0,W.jsxs)(de.A,{value:n,children:[(0,W.jsx)(Kt.A,{checked:e.taskIds.includes(n)}),(0,W.jsx)(ot.A,{primary:t.name,secondary:((null==a?void 0:a.name)||"Unknown Crew")+" (Task ID: "+t.id+")"})]},n)})})]})]}),(0,W.jsx)(Zt.A,{children:e.name===C&&(0,W.jsx)(c.A,{variant:"caption",color:"primary",sx:{ml:1},children:"Default Route"})})]},t))]})]})]})]})]})},tn=e=>{let{initialData:t,onCancel:n,onSubmit:a}=e;const[o,r]=(0,s.useState)((null==t?void 0:t.stateType)||"unstructured"),[l,d]=(0,s.useState)((null==t?void 0:t.stateDefinition)||""),[u,h]=(0,s.useState)(null!=t&&t.stateData?JSON.stringify(t.stateData,null,2):"{}"),m=e=>{try{return JSON.parse(e)}catch(t){return null}};return(0,W.jsxs)(i.A,{component:"form",onSubmit:e=>{e.preventDefault(),a&&a({stateType:o,stateDefinition:l,stateData:m(u)||{}})},sx:{mt:2},children:[(0,W.jsx)(c.A,{variant:"h6",gutterBottom:!0,children:"Edge State Configuration"}),(0,W.jsx)(c.A,{variant:"body2",sx:{mb:3},children:"Configure how state is managed and passed along this edge."}),(0,W.jsxs)(re.A,{fullWidth:!0,sx:{mb:3},children:[(0,W.jsx)(le.A,{id:"state-type-label",children:"State Type"}),(0,W.jsxs)(ce.A,{labelId:"state-type-label",value:o,onChange:e=>{return t=e.target.value,r(t),void(a&&a({stateType:t,stateDefinition:l,stateData:m(u)||{}}));var t},label:"State Type",children:[(0,W.jsx)(de.A,{value:"unstructured",children:(0,W.jsxs)(i.A,{children:[(0,W.jsx)(c.A,{variant:"body2",children:"Unstructured"}),(0,W.jsx)(c.A,{variant:"caption",color:"text.secondary",children:"Free-form state handling with no schema validation"})]})}),(0,W.jsx)(de.A,{value:"structured",children:(0,W.jsxs)(i.A,{children:[(0,W.jsx)(c.A,{variant:"body2",children:"Structured"}),(0,W.jsx)(c.A,{variant:"caption",color:"text.secondary",children:"Schema-based state handling with validation"})]})})]})]}),"structured"===o&&(0,W.jsxs)(i.A,{sx:{mb:3},children:[(0,W.jsx)(c.A,{variant:"subtitle2",sx:{mb:1},children:"State Definition"}),(0,W.jsx)(U.A,{fullWidth:!0,multiline:!0,rows:5,value:l,onChange:e=>{return t=e.target.value,d(t),void(a&&a({stateType:o,stateDefinition:t,stateData:m(u)||{}}));var t},placeholder:"class ExampleState(BaseModel): counter: int = 0 message: str = ''",sx:{"& .MuiInputBase-input":{fontFamily:"monospace"}}})]}),(0,W.jsxs)(i.A,{sx:{mb:3},children:[(0,W.jsx)(c.A,{variant:"subtitle2",sx:{mb:1},children:"Initial State Data"}),(0,W.jsx)(U.A,{fullWidth:!0,multiline:!0,rows:5,value:u,onChange:e=>{return t=e.target.value,h(t),void(a&&a({stateType:o,stateDefinition:l,stateData:m(t)||{}}));var t},error:!m(u),helperText:m(u)?"Valid JSON":"Invalid JSON",placeholder:'{\n  "key": "value"\n}',sx:{"& .MuiInputBase-input":{fontFamily:"monospace"}}})]}),(0,W.jsxs)(ue.Ay,{container:!0,spacing:2,justifyContent:"flex-end",children:[(0,W.jsx)(ue.Ay,{item:!0,children:(0,W.jsx)(g.A,{onClick:n,variant:"outlined",children:"Cancel"})}),(0,W.jsx)(ue.Ay,{item:!0,children:(0,W.jsx)(g.A,{type:"submit",variant:"contained",color:"primary",children:"Save"})})]})]})},nn=e=>{var t,n,a;let{listeners:o,onStateUpdate:r}=e;const[l,d]=(0,s.useState)(-1);return 0===o.length?(0,W.jsx)(c.A,{children:"No listeners configured. Go back to add listeners."}):(0,W.jsxs)(i.A,{sx:{pt:2,pb:2},children:[(0,W.jsx)(c.A,{variant:"body1",gutterBottom:!0,children:"Configure state handling for listeners:"}),(0,W.jsx)(c.A,{variant:"caption",color:"text.secondary",sx:{mb:2,display:"block"},children:"Define how each listener will process the output from the task it's listening to."}),(0,W.jsxs)(ue.Ay,{container:!0,spacing:2,children:[(0,W.jsxs)(ue.Ay,{item:!0,xs:12,sm:4,children:[(0,W.jsx)(c.A,{variant:"subtitle2",gutterBottom:!0,children:"Listeners"}),(0,W.jsx)(_e.A,{variant:"outlined",sx:{p:2,height:"400px",overflow:"auto"},children:o.map((e,t)=>(0,W.jsxs)(i.A,{onClick:()=>d(t),sx:{p:1.5,mb:1,borderRadius:1,cursor:"pointer",bgcolor:l===t?"primary.light":"grey.100","&:hover":{bgcolor:l===t?"primary.light":"grey.200"}},children:[(0,W.jsx)(c.A,{variant:"body2",fontWeight:l===t?"bold":"normal",children:e.name}),(0,W.jsxs)(c.A,{variant:"caption",color:"text.secondary",display:"block",children:["Listening to: ",e.listenToTaskNames.join(", ")||"Not set"]}),(0,W.jsxs)(c.A,{variant:"caption",color:"text.secondary",children:["State: ",e.state.stateType]})]},e.id))})]}),l>=0&&(0,W.jsxs)(ue.Ay,{item:!0,xs:12,sm:8,children:[(0,W.jsxs)(c.A,{variant:"subtitle2",gutterBottom:!0,children:["Configure State for Listener: ",null==(t=o[l])?void 0:t.name]}),(0,W.jsxs)(c.A,{variant:"caption",color:"text.secondary",sx:{mb:2,display:"block"},children:["Listening to: ",(null==(n=o[l])?void 0:n.listenToTaskNames.join(", "))||"Not set"]}),(0,W.jsx)(_e.A,{variant:"outlined",sx:{p:2,height:"400px",overflow:"auto"},children:(0,W.jsx)(tn,{initialData:null==(a=o[l])?void 0:a.state,onSubmit:r})})]})]})]})},an=e=>{let{flowName:t,setFlowName:n,listeners:a,actions:s,startingPoints:o}=e;return(0,W.jsxs)(i.A,{sx:{pt:2,pb:2},children:[(0,W.jsx)(c.A,{variant:"h6",gutterBottom:!0,children:"Review Your Flow Configuration"}),(0,W.jsx)(U.A,{fullWidth:!0,label:"Flow Name",value:t,onChange:e=>n(e.target.value),required:!0,error:!t.trim(),helperText:t.trim()?"":"Flow name is required",sx:{mb:3}}),(0,W.jsxs)(_e.A,{variant:"outlined",sx:{p:2,mb:3},children:[(0,W.jsx)(c.A,{variant:"subtitle1",gutterBottom:!0,children:"Starting Point Tasks"}),0===o.filter(e=>e.isStartPoint).length?(0,W.jsx)(c.A,{variant:"body2",color:"error",children:"No starting point tasks defined. Please go back and select at least one task."}):(0,W.jsxs)(i.A,{children:[(0,W.jsx)(c.A,{variant:"caption",color:"text.secondary",sx:{mb:1,display:"block"},children:"The following tasks will trigger the flow execution:"}),o.filter(e=>e.isStartPoint).map(e=>(0,W.jsx)(i.A,{sx:{mb:1},children:(0,W.jsxs)(c.A,{variant:"body2",children:[e.crewName,":",e.taskName]})},e.taskId))]})]}),(0,W.jsxs)(_e.A,{variant:"outlined",sx:{p:2,mb:3},children:[(0,W.jsx)(c.A,{variant:"subtitle1",gutterBottom:!0,children:"Listeners"}),a.map(e=>(0,W.jsxs)(i.A,{sx:{mb:2},children:[(0,W.jsx)(c.A,{variant:"body2",fontWeight:"bold",children:e.name}),(0,W.jsxs)(c.A,{variant:"body2",children:["Listening to: ",e.listenToTaskNames.length>0?e.listenToTaskNames.join(", "):"Not set"]}),(0,W.jsxs)(c.A,{variant:"body2",children:["State Type: ",e.state.stateType]}),(0,W.jsxs)(c.A,{variant:"body2",children:["Tasks to Execute: ",e.tasks.map(e=>e.name).join(", ")]}),(0,W.jsx)(ne.A,{sx:{my:1}})]},e.id))]}),s.length>0&&(0,W.jsxs)(_e.A,{variant:"outlined",sx:{p:2,mb:3},children:[(0,W.jsx)(c.A,{variant:"subtitle1",gutterBottom:!0,children:"Actions"}),(0,W.jsx)(i.A,{sx:{display:"flex",flexWrap:"wrap",gap:1},children:s.map(e=>(0,W.jsx)(V.A,{label:e.crewName+":"+e.taskName,variant:"outlined"},e.id))})]})]})},sn=e=>{let{open:t,onClose:n,onAddCrews:a}=e;const{activeStep:d,crews:u,selectedCrewIds:h,listeners:m,tasks:p,actions:x,startingPoints:f,loadCrews:y,toggleCrewSelection:b,handleNext:v,handleBack:A,handleListenerTaskChange:j,handleListenToTaskChange:w,handleStateUpdate:k,handleToggleStartingPoint:C,addListener:S,deleteListener:_,updateListenerName:E,updateListenerConditionType:I,updateRouterConfig:T,resetFlowWizard:D}=Ut(),[O,N]=(0,s.useState)("");(0,s.useEffect)(()=>{t&&y()},[t,y]);const P=(0,s.useCallback)(()=>{D(),N(""),n()},[D,n]),M=(0,s.useCallback)(e=>{b(e.id)},[b]),z=(0,s.useCallback)(()=>{const e={id:"flow-"+Date.now(),name:O,listeners:m,actions:x,startingPoints:f.filter(e=>e.isStartPoint)},t=u.filter(e=>h.includes(e.id)),n={};t.forEach((e,t)=>{const a=t%3,s=Math.floor(t/3);n[e.id.toString()]={x:150+300*a,y:150+200*s}}),a(t,n,e,!0),P()},[O,m,x,f,a,P,u,h]);return(0,W.jsxs)(o.A,{open:t,onClose:P,maxWidth:"md",fullWidth:!0,children:[(0,W.jsx)(l.A,{children:"Add Flow"}),(0,W.jsx)(r.A,{children:(0,W.jsxs)(i.A,{sx:{mt:2},children:[(0,W.jsxs)(c.A,{variant:"subtitle1",gutterBottom:!0,children:["Step ",d+1," of ",Object.keys(Bt).length/2]}),(()=>{switch(d){case Bt.SelectCrews:return(0,W.jsx)(Ht,{crews:u,selectedCrewIds:h,onCrewSelect:M});case Bt.DefineStartingPoints:return(0,W.jsx)(Gt,{tasks:p,startingPoints:f,onToggleStartingPoint:C});case Bt.ConfigureListeners:return(0,W.jsx)(en,{tasks:p,listeners:m,selectedCrewIds:h,crews:u,onListenerTaskChange:j,onListenToTaskChange:w,onAddListener:S,onDeleteListener:_,onUpdateListenerName:E,onUpdateConditionType:I,onUpdateRouterConfig:T});case Bt.ConfigureState:return(0,W.jsx)(nn,{listeners:m,onStateUpdate:k});case Bt.Review:return(0,W.jsx)(an,{flowName:O,setFlowName:N,listeners:m,actions:x,startingPoints:f});default:return null}})()]})}),(0,W.jsxs)(H.A,{children:[(0,W.jsx)(g.A,{onClick:P,children:"Cancel"}),(0,W.jsx)(g.A,{onClick:A,disabled:0===d,children:"Back"}),d===Bt.Review?(0,W.jsx)(g.A,{onClick:z,variant:"contained",color:"primary",children:"Save"}):(0,W.jsx)(g.A,{onClick:v,variant:"contained",color:"primary",children:"Next"})]})]})},on=e=>{let{data:t,selected:n,id:a,isConnectable:o}=e;const{crewName:r}=t,[l,u]=(0,s.useState)(!1),{deleteElements:h}=(0,y.VH)(),m=(e=>{const t=["#4caf50","#2196f3","#ff9800","#e91e63","#9c27b0","#00bcd4","#ff5722","#607d8b"];let n=0;for(let a=0;a<e.length;a++)n=e.charCodeAt(a)+((n<<5)-n);return t[Math.abs(n)%t.length]})(r),g={width:8,height:8,background:"#555",border:"2px solid #fff",cursor:"crosshair"};return(0,W.jsxs)(W.Fragment,{children:[(0,W.jsx)(y.h7,{type:"source",position:y.yX.Top,id:"top",isConnectable:o,style:Object.assign({},g,{top:-4})}),(0,W.jsx)(y.h7,{type:"target",position:y.yX.Top,id:"top-target",isConnectable:o,style:Object.assign({},g,{top:-4})}),(0,W.jsx)(y.h7,{type:"source",position:y.yX.Right,id:"right",isConnectable:o,style:Object.assign({},g,{right:-4})}),(0,W.jsx)(y.h7,{type:"target",position:y.yX.Right,id:"right-target",isConnectable:o,style:Object.assign({},g,{right:-4})}),(0,W.jsx)(y.h7,{type:"source",position:y.yX.Bottom,id:"bottom",isConnectable:o,style:Object.assign({},g,{bottom:-4})}),(0,W.jsx)(y.h7,{type:"target",position:y.yX.Bottom,id:"bottom-target",isConnectable:o,style:Object.assign({},g,{bottom:-4})}),(0,W.jsx)(y.h7,{type:"source",position:y.yX.Left,id:"left",isConnectable:o,style:Object.assign({},g,{left:-4})}),(0,W.jsx)(y.h7,{type:"target",position:y.yX.Left,id:"left-target",isConnectable:o,style:Object.assign({},g,{left:-4})}),(0,W.jsxs)(i.A,{sx:{width:140,height:80,display:"flex",justifyContent:"center",alignItems:"center",borderRadius:"8px",border:n?"2px solid #1976d2":"1px solid #e0e0e0",bgcolor:m,color:"white",boxShadow:n?3:1,position:"relative",transition:"all 0.2s ease",overflow:"visible",fontWeight:"bold",cursor:"pointer","&:hover":{boxShadow:4}},onMouseEnter:()=>u(!0),onMouseLeave:()=>u(!1),children:[(0,W.jsx)(c.A,{variant:"subtitle1",textAlign:"center",fontWeight:"bold",sx:{color:"white",textShadow:"1px 1px 2px rgba(0,0,0,0.4)",wordBreak:"break-word",padding:"0 5px"},children:t.label||"Unnamed Crew"}),(l||n)&&(0,W.jsx)(i.A,{sx:{position:"absolute",top:-6,right:-6,display:"flex",gap:.5},children:(0,W.jsx)(d.A,{size:"small",onClick:e=>{e.stopPropagation(),h({nodes:[{id:a}]})},sx:{backgroundColor:"rgba(255, 255, 255, 0.9)","&:hover":{backgroundColor:"#ffebee"},boxShadow:"0 0 4px rgba(0,0,0,0.2)",width:24,height:24},children:(0,W.jsx)(Q.A,{fontSize:"small",color:"error"})})})]})]})};var rn=n(99443);const ln=e=>{let{sourceX:t,sourceY:n,targetX:a,targetY:s,sourcePosition:o,targetPosition:r,style:l={},markerEnd:c,data:d}=e;const[u,h,m]=(0,y.oN)({sourceX:t,sourceY:n,sourcePosition:o,targetX:a,targetY:s,targetPosition:r,borderRadius:16}),g=(0,rn.RU)(rn.Gs.CREW_TO_CREW,!1,l);return(0,W.jsxs)("g",{children:[(0,W.jsx)(y.tE,{path:u,markerEnd:c,style:g}),(null==d?void 0:d.label)&&(0,W.jsx)("foreignObject",{width:250,height:60,x:h-125,y:m-30,requiredExtensions:"http://www.w3.org/1999/xhtml",children:(0,W.jsx)(i.A,{sx:{display:"flex",justifyContent:"center",alignItems:"center",width:"100%",height:"100%",fontSize:"12px",padding:"6px 12px",borderRadius:"8px",backgroundColor:"rgba(255, 255, 255, 0.95)",border:"1px solid rgba(33, 150, 243, 0.3)",boxShadow:"0 2px 4px rgba(0,0,0,0.1)",textAlign:"center",position:"relative",zIndex:5,fontWeight:"bold",wordBreak:"break-word",overflow:"hidden",color:rn.Wy.hover,transition:"all 0.2s ease","&:hover":{backgroundColor:"rgba(255, 255, 255, 1)",boxShadow:"0 4px 8px rgba(0,0,0,0.15)",transform:"translateY(-1px)"}},children:d.label})})]})},cn=e=>{let{sourceX:t,sourceY:n,targetX:a,targetY:i,sourcePosition:l,targetPosition:c,style:d={},markerEnd:u,source:h,target:m,id:g,data:p,animated:x=!1}=e;const[f,b]=(0,s.useState)(!1),[v,A]=(0,s.useState)(!1),[j,w,k]=(0,y.oN)({sourceX:t,sourceY:n,sourcePosition:l,targetX:a,targetY:i,targetPosition:c,borderRadius:16,offset:12}),C=(null==h?void 0:h.includes("flow"))&&(null==m?void 0:m.includes("flow"));let S;S=C&&null!=p&&p.stateType?p.stateType+" state":(0,rn.OG)(h,m);const _=w+50,E=k,I=w+75,T=k,D=Math.min(t,a)-8,O=Math.max(t,a)+8,N=Math.min(n,i)-10,P=O-D,M=Math.max(n,i)+10-N,z=(0,rn.Vr)(h,m,x,d),L=(0,s.useCallback)(()=>{f||b(!0)},[f]),R=(0,s.useCallback)(e=>{const t=e.target.getBoundingClientRect(),n=e.clientX,a=e.clientY;(n<t.left||n>t.right||a<t.top||a>t.bottom)&&b(!1)},[]),F=(0,s.useCallback)(e=>{e.stopPropagation();const t=new CustomEvent("edge:delete",{detail:{id:g}});window.dispatchEvent(t)},[g]),B=(0,s.useCallback)(e=>{e.stopPropagation(),A(!0)},[]),V=(0,s.useCallback)(e=>{const t=new CustomEvent("edge:update",{detail:{id:g,data:e}});window.dispatchEvent(t),A(!1)},[g]);return(0,W.jsxs)(W.Fragment,{children:[(0,W.jsxs)("g",{children:[(0,W.jsx)("rect",{x:D,y:N,width:P,height:M,fill:"transparent",onMouseEnter:L,onMouseLeave:R,style:{pointerEvents:"all"}}),(0,W.jsx)(y.tE,{path:j,markerEnd:u,style:z}),f&&(0,W.jsxs)("g",{style:{pointerEvents:"none"},children:[(0,W.jsx)(y.R5,{x:w,y:k,label:S,labelStyle:{fill:C?"#9c27b0":"#2196f3",fontSize:"12px",fontWeight:600},labelBgStyle:{fill:"white",fillOpacity:.8},labelBgPadding:[2,4],labelBgBorderRadius:4}),(0,W.jsxs)("g",{transform:"translate("+_+", "+E+")",onClick:F,style:{cursor:"pointer",pointerEvents:"all"},children:[(0,W.jsx)("rect",{x:"-8",y:"-8",width:"16",height:"16",fill:"white",fillOpacity:"0.9",rx:"2",pointerEvents:"all"}),(0,W.jsx)("line",{x1:"-4",y1:"-4",x2:"4",y2:"4",stroke:rn.Wy.delete,strokeWidth:"1.5",opacity:"0.8",pointerEvents:"none"}),(0,W.jsx)("line",{x1:"4",y1:"-4",x2:"-4",y2:"4",stroke:rn.Wy.delete,strokeWidth:"1.5",opacity:"0.8",pointerEvents:"none"})]}),C&&(0,W.jsxs)("g",{transform:"translate("+I+", "+T+")",onClick:B,style:{cursor:"pointer",pointerEvents:"all"},children:[(0,W.jsx)("rect",{x:"-8",y:"-8",width:"16",height:"16",fill:"white",fillOpacity:"0.9",rx:"2",pointerEvents:"all"}),(0,W.jsx)("circle",{cx:"0",cy:"0",r:"4",fill:"none",stroke:rn.Wy.delete,strokeWidth:"1.5",opacity:"0.8",pointerEvents:"none"}),(0,W.jsx)("line",{x1:"0",y1:"-3",x2:"0",y2:"-6",stroke:rn.Wy.delete,strokeWidth:"1.5",opacity:"0.8",pointerEvents:"none"}),(0,W.jsx)("line",{x1:"0",y1:"3",x2:"0",y2:"6",stroke:rn.Wy.delete,strokeWidth:"1.5",opacity:"0.8",pointerEvents:"none"}),(0,W.jsx)("line",{x1:"-3",y1:"0",x2:"-6",y2:"0",stroke:rn.Wy.delete,strokeWidth:"1.5",opacity:"0.8",pointerEvents:"none"}),(0,W.jsx)("line",{x1:"3",y1:"0",x2:"6",y2:"0",stroke:rn.Wy.delete,strokeWidth:"1.5",opacity:"0.8",pointerEvents:"none"})]})]})]}),C&&(0,W.jsx)(o.A,{open:v,onClose:()=>A(!1),maxWidth:"md",children:(0,W.jsx)(r.A,{children:(0,W.jsx)(tn,{initialData:p,onCancel:()=>A(!1),onSubmit:V})})})]})},dn={agentNode:bt,managerNode:At,taskNode:Wt,crewNode:on},un={default:cn,crewEdge:ln};var hn=n(91570);const mn=e=>({id:e.id,title:e.title,description:e.description,icon:e.icon,category:e.category,enabled:e.enabled}),gn={jobId:null,isRunning:!1,selectedModel:"",planningEnabled:!1,schemaDetectionEnabled:!0,tools:[],selectedTools:[]},pn=(0,A.vt)(e=>Object.assign({},gn,{setJobId:t=>e(()=>({jobId:t})),setIsRunning:t=>e(()=>({isRunning:t})),setSelectedModel:t=>e(()=>({selectedModel:t})),setPlanningEnabled:t=>e(()=>({planningEnabled:t})),setSchemaDetectionEnabled:t=>e(()=>({schemaDetectionEnabled:t})),setTools:t=>e(()=>({tools:t.map(mn)})),setSelectedTools:t=>e(()=>({selectedTools:t})),resetJobManagement:()=>e(()=>Object.assign({},gn))})),xn={showError:!1,errorMessage:""},fn=(0,A.vt)(e=>Object.assign({},xn,{setShowError:t=>e(()=>({showError:t})),setErrorMessage:t=>e(()=>({errorMessage:t})),showErrorMessage:t=>e(()=>({errorMessage:t,showError:!0})),clearError:()=>e(()=>({showError:!1,errorMessage:""})),resetError:()=>e(()=>Object.assign({},xn))})),yn=e=>{let{nodes:t,onNodesChange:n,reactFlowInstanceRef:a,setSuccessMessage:i,setShowSuccess:o}=e;const r=fn();return{handleTaskGenerated:(0,s.useCallback)(async e=>{if(e)try{var s,l;const r=await Fe.TaskService.createTask(e),c=Date.now(),d=r.id||c,u=t,h=u.filter(e=>"agentNode"===e.type),m=h.length>0?Math.max(...h.map(e=>e.position.x)):0,g=u.filter(e=>"taskNode"===e.type),p=((e,t)=>{const n=t.filter(e=>"taskNode"===e.type);if(n.length>0)return{x:n[0].position.x,y:Math.max(...n.map(e=>e.position.y))+80+100};return e})({x:Math.max(m+300,400),y:100},g),x={id:"task-"+d,type:"taskNode",position:p,width:280,height:140,data:{label:e.name,taskId:d,description:e.description||e.name,expected_output:e.expected_output||"",human_input:(null==(s=e.config)?void 0:s.human_input)||!1,tools:e.tools||[],config:{markdown:(null==(l=e.config)?void 0:l.markdown)||!1},task:Object.assign({},e,{description:e.description||e.name})}};n([{type:"add",item:x}]),setTimeout(()=>{var e;null==(e=a.current)||e.fitView({duration:800,padding:.2})},100),i('Task "'+e.name+'" generated successfully and added to canvas'),o(!0)}catch(c){r.showErrorMessage("Failed to create task")}},[t,n,a,i,o,r])}};var bn=n(11942),vn=n.n(bn);class An{constructor(e){void 0===e&&(e={margin:20,minNodeSpacing:50}),this.uiState=void 0,this.margin=void 0,this.minNodeSpacing=void 0,this.margin=e.margin,this.minNodeSpacing=e.minNodeSpacing,this.uiState=Object.assign({screenWidth:"undefined"!==typeof window?window.innerWidth:1200,screenHeight:"undefined"!==typeof window?window.innerHeight:800,tabBarHeight:48,leftSidebarVisible:!0,leftSidebarExpanded:!1,leftSidebarBaseWidth:48,leftSidebarExpandedWidth:280,rightSidebarVisible:!0,rightSidebarWidth:48,chatPanelVisible:!0,chatPanelCollapsed:!1,chatPanelWidth:450,chatPanelCollapsedWidth:60,chatPanelSide:"right",executionHistoryVisible:!1,executionHistoryHeight:60,panelPosition:50,areFlowsVisible:!0,layoutOrientation:"vertical"},e.defaultUIState)}updateUIState(e){this.uiState=Object.assign({},this.uiState,e)}updateScreenDimensions(e,t){this.uiState.screenWidth=e,this.uiState.screenHeight=t}getAvailableCanvasArea(e){void 0===e&&(e="full");let t=0;const n=this.uiState.tabBarHeight;let a=this.uiState.screenWidth,s=this.uiState.screenHeight-this.uiState.tabBarHeight;if(this.uiState.leftSidebarVisible){const e=this.uiState.leftSidebarExpanded?this.uiState.leftSidebarExpandedWidth:this.uiState.leftSidebarBaseWidth;t+=e,a-=e}if(this.uiState.rightSidebarVisible&&(a-=this.uiState.rightSidebarWidth),this.uiState.chatPanelVisible){const e=this.uiState.chatPanelCollapsed?this.uiState.chatPanelCollapsedWidth:this.uiState.chatPanelWidth;a-=e,"left"===this.uiState.chatPanelSide&&(t+=e)}if(this.uiState.executionHistoryVisible&&(s-=this.uiState.executionHistoryHeight),"crew"===e&&this.uiState.areFlowsVisible)a*=this.uiState.panelPosition/100;else if("flow"===e&&this.uiState.areFlowsVisible){t+=a*(this.uiState.panelPosition/100),a*=(100-this.uiState.panelPosition)/100}return{x:t+this.margin,y:n+this.margin,width:Math.max(200,a-2*this.margin),height:Math.max(150,s-2*this.margin)}}getAgentNodePosition(e,t){var n;void 0===t&&(t="crew");const a=this.getAvailableCanvasArea(t),s=e.filter(e=>"agentNode"===e.type),i=(e.filter(e=>"taskNode"===e.type),An.NODE_DIMENSIONS.agentNode),o=a.width<600?Math.max(20,this.minNodeSpacing/2):this.minNodeSpacing;if(0===s.length)return{x:a.x+o,y:a.y+o};const r=(null==(n=this.uiState)?void 0:n.layoutOrientation)||"horizontal";let l=r;if(s.length>=2){const e=s.map(e=>e.position.y),t=s.map(e=>e.position.x),n=Math.max(...e)-Math.min(...e),a=Math.max(...t)-Math.min(...t),i=a<10&&n>150;l=("vertical"===r?!(n<10&&a>150):!i)?i?"horizontal":"vertical":r}if("vertical"===l){const e=[...s].sort((e,t)=>e.position.x-t.position.x),t=e[e.length-1],n=Math.min(...s.map(e=>e.position.y)),a=Math.round(n),r=An.NODE_DIMENSIONS.taskNode,l=Math.max(o,r.width+80),c=t.position.x+i.width+l;return{x:Math.round(c),y:a}}{const e=Math.max(...s.map(e=>e.position.y)),t=s.find(t=>t.position.y===e),n=(null==t?void 0:t.position.x)||a.x+o,r=e+i.height+o;return{x:Math.round(n),y:Math.round(r)}}}getTaskNodePosition(e,t){var n;void 0===t&&(t="crew");const a=this.getAvailableCanvasArea(t),s=e.filter(e=>"taskNode"===e.type),i=e.filter(e=>"agentNode"===e.type),o=An.NODE_DIMENSIONS.agentNode,r=An.NODE_DIMENSIONS.taskNode,l=a.width<600?Math.max(20,this.minNodeSpacing/2):this.minNodeSpacing,c=(null==(n=this.uiState)?void 0:n.layoutOrientation)||"horizontal";let d=c;if(i.length>=2){const e=i.map(e=>e.position.y),t=i.map(e=>e.position.x),n=Math.max(...e)-Math.min(...e),a=Math.max(...t)-Math.min(...t),s=a<10&&n>150;d=("vertical"===c?!(n<10&&a>150):!s)?s?"horizontal":"vertical":c}if(0===i.length)return{x:a.x+l,y:a.y+l};const u=[...i].sort((e,t)=>"vertical"===d?e.position.x-t.position.x:e.position.y-t.position.y),h=u[s.length%u.length];if("vertical"===d){const e=Math.max(l,100),t=(r.width-o.width)/2,n=h.position.x-t,a=50,i=s.filter(e=>Math.abs(e.position.x-n)<a).sort((e,t)=>e.position.y-t.position.y);let c;if(0===i.length){c=h.position.y+o.height+e}else{c=i[i.length-1].position.y+r.height+e}return{x:Math.round(n),y:Math.round(c)}}{const e=h.position.y,t=50,n=s.filter(n=>Math.abs(n.position.y-e)<t).sort((e,t)=>e.position.x-t.position.x);let a;if(0===n.length)a=h.position.x+o.width+l;else{a=n[n.length-1].position.x+r.width+l}return{x:a,y:e}}}getManagerNodePosition(e,t){var n;void 0===t&&(t="crew");const a=this.getAvailableCanvasArea(t),s=An.NODE_DIMENSIONS.managerNode,i=e.filter(e=>"agentNode"===e.type),o=this.minNodeSpacing,r=(null==(n=this.uiState)?void 0:n.layoutOrientation)||"horizontal";if(0===i.length)return{x:Math.round(a.x+o),y:Math.round(a.y+o)};if("vertical"===r){const e=Math.min(...i.map(e=>e.position.y)),t=i.reduce((e,t)=>e+t.position.x,0)/i.length,n=e-s.height-4*o;return{x:Math.round(t),y:Math.round(n)}}{const e=Math.min(...i.map(e=>e.position.x)),t=i.reduce((e,t)=>e+t.position.y,0)/i.length,n=e-s.width-4*o;return{x:Math.round(n),y:Math.round(t)}}}getFlowNodePosition(e,t){void 0===t&&(t="flow");const n=this.getAvailableCanvasArea(t),a=e.filter(e=>"flowNode"===e.type),s=An.NODE_DIMENSIONS.flowNode;return 0===a.length?{x:n.x+(n.width-s.width)/2,y:n.y+50}:this.findOptimalPosition(a,s,n,"horizontal")}getCrewLayoutPositions(e,t,n){void 0===n&&(n="crew");const a=this.getAvailableCanvasArea(n),s=An.NODE_DIMENSIONS.agentNode,i=An.NODE_DIMENSIONS.taskNode,o=[],r=[],l=a.width<600,c=l?Math.max(20,this.minNodeSpacing/2):this.minNodeSpacing;if(l)return this.getCompactCrewLayout(e,t,a,c);const d=Math.max(1,Math.floor(a.height/(s.height+c))),u=t>0?1:0,h=Math.ceil(e/d)*(s.width+c),m=h+u*(i.width+c),g=a.x;for(let A=0;A<e;A++){const e=A%d,t=g+Math.floor(A/d)*(s.width+c),n=a.y+e*(s.height+c);o.push({x:t,y:n})}const p=g+h;for(let A=0;A<t;A++){const e=p,t=a.y+A*(i.height+c);r.push({x:e,y:t})}const x=[...o,...r];if(0===x.length)return{agentPositions:[],taskPositions:[],layoutBounds:{x:a.x,y:a.y,width:0,height:0},shouldAutoFit:!1};const f=Math.min(...x.map(e=>e.x)),y=Math.max(...x.map(e=>e.x),...o.map(e=>e.x+s.width),...r.map(e=>e.x+i.width)),b=Math.min(...x.map(e=>e.y)),v={x:f,y:b,width:y-f,height:Math.max(...x.map(e=>e.y),...o.map(e=>e.y+s.height),...r.map(e=>e.y+i.height))-b};return{agentPositions:o,taskPositions:r,layoutBounds:v,shouldAutoFit:m>a.width||v.height>a.height}}getCompactCrewLayout(e,t,n,a){const s=An.NODE_DIMENSIONS.agentNode,i=An.NODE_DIMENSIONS.taskNode,o=[],r=[],l=(e>0?1:0)+(t>0?1:0),c=n.width-a*(l+1),d=l>0?c/l:n.width,u=Math.max(140,Math.min(200,d));if(e>0){const t=n.x+a;for(let i=0;i<e;i++){const e=n.y+i*(s.height+a);o.push({x:t,y:e})}}if(t>0){const s=e>0?n.x+a+u+a:n.x+a;for(let e=0;e<t;e++){const t=n.y+e*(i.height+a);r.push({x:s,y:t})}}const h=[...o,...r];if(0===h.length)return{agentPositions:[],taskPositions:[],layoutBounds:{x:n.x,y:n.y,width:0,height:0},shouldAutoFit:!1};const m=Math.min(...h.map(e=>e.x)),g=Math.max(...h.map(e=>e.x+u)),p=Math.min(...h.map(e=>e.y)),x={x:m,y:p,width:g-m,height:Math.max(...o.map(e=>e.y+s.height),...r.map(e=>e.y+i.height))-p};return{agentPositions:o,taskPositions:r,layoutBounds:x,shouldAutoFit:x.width>n.width||x.height>n.height}}findSmartAgentPosition(e,t,n){const a=An.NODE_DIMENSIONS.agentNode,s=e.reduce((e,t)=>t.position.y>e.position.y?t:e),i=s.position.y+a.height+n;if(i+a.height<=t.y+t.height)return{x:s.position.x,y:i};return{x:e.reduce((e,t)=>t.position.x>e.position.x?t:e).position.x+a.width+n,y:t.y+n}}getFirstTaskPosition(e,t,n,a){const s=An.NODE_DIMENSIONS.agentNode;if(a){return{x:e.reduce((e,t)=>t.position.x>e.position.x?t:e).position.x+s.width+n,y:t.y+n}}const i=e.reduce((e,t)=>t.position.x>e.position.x?t:e);return{x:i.position.x+s.width+n,y:i.position.y}}findVerticalTaskPosition(e,t,n){const a=An.NODE_DIMENSIONS.taskNode,s=e.reduce((e,t)=>t.position.y>e.position.y?t:e),i=e[0].position.x,o=s.position.y+a.height+n;return a.height,t.y,t.height,{x:i,y:o}}findOptimalPosition(e,t,n,a){if(void 0===a&&(a="vertical"),"vertical"===a){const a=e.reduce((e,t)=>t.position.y>e.position.y?t:e),s=a.position.y+t.height+this.minNodeSpacing;if(s+t.height>n.y+n.height){const i=e.reduce((e,t)=>t.position.x>e.position.x?t:e).position.x+t.width+this.minNodeSpacing;return i+t.width<=n.x+n.width?{x:i,y:n.y}:{x:a.position.x,y:s}}return{x:a.position.x,y:s}}if("horizontal"===a){const a=e.reduce((e,t)=>t.position.x>e.position.x?t:e),s=a.position.x+t.width+this.minNodeSpacing;if(s+t.width>n.x+n.width){const a=e.reduce((e,t)=>t.position.y>e.position.y?t:e);return{x:n.x,y:a.position.y+t.height+this.minNodeSpacing}}return{x:s,y:a.position.y}}return{x:n.x,y:n.y}}wouldOverlap(e,t,n){const a=e.x,s=e.x+t.width,i=e.y,o=e.y+t.height;return n.some(e=>{const t=An.NODE_DIMENSIONS[e.type||"default"]||An.NODE_DIMENSIONS.default,n=e.position.x,r=e.position.x+t.width,l=e.position.y,c=e.position.y+t.height;return!(s+this.minNodeSpacing<n||a>r+this.minNodeSpacing||o+this.minNodeSpacing<l||i>c+this.minNodeSpacing)})}static getNodeDimensions(e){return An.NODE_DIMENSIONS[e]||An.NODE_DIMENSIONS.default}reorganizeNodes(e,t,n){void 0===t&&(t="full"),void 0===n&&(n=[]);const a=this.getAvailableCanvasArea(t),s=e.filter(e=>"agentNode"===e.type),i=e.filter(e=>"managerNode"===e.type),o=e.filter(e=>"taskNode"===e.type),r=e.filter(e=>"flowNode"===e.type),l=[...e.filter(e=>!["agentNode","managerNode","taskNode","flowNode"].includes(e.type||"")),...i],c=An.NODE_DIMENSIONS.agentNode,d=An.NODE_DIMENSIONS.taskNode,u=An.NODE_DIMENSIONS.flowNode;if("horizontal"===(this.uiState.layoutOrientation||"horizontal")){const e=new Map;n.forEach(t=>{var n,a;if((null==(n=t.source)?void 0:n.startsWith("agent-"))&&(null==(a=t.target)?void 0:a.startsWith("task-"))){const n=e.get(t.source)||[];n.push(t.target),e.set(t.source,n)}});const t=Math.max(this.minNodeSpacing,80),i=a.x+c.width+2*this.minNodeSpacing;let h=a.y;const m=new Map;s.forEach(n=>{const s=e.get(n.id)||[],r=o.filter(e=>s.includes(e.id));if(r.length>0){const e=h;r.forEach(e=>{m.set(e.id,{x:i,y:h}),l.push(Object.assign({},e,{position:{x:i,y:h}})),h+=d.height+t});const s=r.map((n,a)=>e+a*(d.height+t)+d.height/2),o=-10,u=(s[0]+s[s.length-1])/2-c.height/2+o;l.push(Object.assign({},n,{position:{x:a.x,y:u}}))}else l.push(Object.assign({},n,{position:{x:a.x,y:h}})),h+=c.height+t});const g=new Set(Array.from(e.values()).flat());o.filter(e=>!g.has(e.id)).forEach(e=>{l.push(Object.assign({},e,{position:{x:i,y:h}})),h+=d.height+t}),r.forEach((e,t)=>{l.push(Object.assign({},e,{position:{x:a.x+t*(u.width+this.minNodeSpacing),y:a.y+50}}))})}else{const e=new Map;n.forEach(t=>{var n,a;if((null==(n=t.source)?void 0:n.startsWith("agent-"))&&(null==(a=t.target)?void 0:a.startsWith("task-"))){const n=e.get(t.source)||[];n.push(t.target),e.set(t.source,n)}});const t=Math.max(this.minNodeSpacing,100),i=a.y,h=i+c.height+2*this.minNodeSpacing;let m=a.x;const g=new Map;s.forEach(n=>{const a=e.get(n.id)||[],s=o.filter(e=>a.includes(e.id)),r=m;if(s.forEach(e=>{const n=m;g.set(e.id,{x:n,y:h}),l.push(Object.assign({},e,{position:{x:n,y:h}})),m+=d.width+t}),s.length>0){const e=35,a=r+(m-t-r)/2-c.width/2+e;l.push(Object.assign({},n,{position:{x:a,y:i}}))}else l.push(Object.assign({},n,{position:{x:m,y:i}})),m+=c.width+t});const p=new Set(Array.from(e.values()).flat());o.filter(e=>!p.has(e.id)).forEach(e=>{l.push(Object.assign({},e,{position:{x:m,y:h}})),m+=d.width+t}),r.forEach((e,t)=>{l.push(Object.assign({},e,{position:{x:a.x+t*(u.width+this.minNodeSpacing),y:a.y+50}}))})}return l}scalePositionsToFit(e,t,n){if(void 0===n&&(n="full"),0===e.length)return e;const a=this.getAvailableCanvasArea(n),s=Math.min(...e.map(e=>e.x)),i=Math.max(...e.map(e=>e.x+t.width)),o=Math.min(...e.map(e=>e.y)),r=Math.max(...e.map(e=>e.y+t.height)),l=i-s,c=r-o,d=l>a.width?a.width/l:1,u=c>a.height?a.height/c:1,h=Math.min(d,u,1);return h>=1?e:e.map(e=>({x:a.x+(e.x-s)*h,y:a.y+(e.y-o)*h}))}getAutoFitZoom(e,t){void 0===t&&(t="full");const n=this.getAvailableCanvasArea(t),a=n.width<600,s=a?20:50,i=Math.max(100,n.width-2*s),o=Math.max(100,n.height-2*s),r=e.width>0?i/e.width:1,l=e.height>0?o/e.height:1,c=a?.3:.5,d=Math.min(r,l);return Math.max(c,Math.min(1,d))}getLayoutDebugInfo(){const e={full:this.getAvailableCanvasArea("full"),crew:this.getAvailableCanvasArea("crew"),flow:this.getAvailableCanvasArea("flow")},t=[];e.crew.width<400?t.push("\u274c CRITICAL: Canvas is extremely narrow. Collapse chat panel immediately!"):e.crew.width<600&&t.push("\u26a0\ufe0f Canvas width is narrow - collapse chat panel or reduce window elements"),e.crew.height<300?t.push("\u274c CRITICAL: Canvas height is too small. Reduce execution history height!"):e.crew.height<400&&t.push("\u26a0\ufe0f Canvas height is limited - consider reducing execution history height"),this.uiState.chatPanelVisible&&!this.uiState.chatPanelCollapsed&&this.uiState.chatPanelWidth>350&&t.push("\u{1f4a1} TIP: Reduce chat panel width or collapse it temporarily for better node visibility"),this.uiState.executionHistoryVisible&&this.uiState.executionHistoryHeight>200&&t.push("\u{1f4a1} TIP: Reduce execution history height to give more space for nodes");const n=(this.uiState.leftSidebarBaseWidth+this.uiState.rightSidebarWidth+(this.uiState.chatPanelVisible?this.uiState.chatPanelWidth:0))/this.uiState.screenWidth*100;return n>60&&t.push("\u{1f527} ACTION: UI elements take "+Math.round(n)+"% of screen width. Consider larger screen or hide panels."),{uiState:this.uiState,availableAreas:e,recommendations:t}}}An.NODE_DIMENSIONS={agentNode:{width:200,height:150},managerNode:{width:200,height:150},taskNode:{width:220,height:180},flowNode:{width:180,height:120},crewNode:{width:240,height:200},default:{width:200,height:150}};const jn=e=>{let{nodes:t,edges:n,setNodes:a,setEdges:i}=e;return(0,s.useEffect)(()=>()=>{},[]),(e=>{let{nodes:t,edges:n,setNodes:a,setEdges:i}=e;const{layoutOrientation:o}=(0,E.z)(),{managerLLM:r,processType:l,managerNodeId:c,setManagerNodeId:d}=(0,v.E)(),u=(0,s.useRef)(void 0),h=(0,s.useCallback)(()=>{if(t.find(e=>"managerNode"===e.type))return;const e=t.filter(e=>"agentNode"===e.type);e.length;const s=new An({margin:20,minNodeSpacing:50}),l=E.z.getState().getUILayoutState();l.screenWidth=window.innerWidth,l.screenHeight=window.innerHeight,s.updateUIState(l);const c={id:"manager-node",type:"managerNode",position:s.getManagerNodePosition(t,"crew"),data:{label:"Manager Agent",llm:r||"databricks-llama-4-maverick"}},u=e.map(e=>{const t="vertical"===o?"bottom":"right",n="vertical"===o?"top":"left";return{id:"manager-"+e.id,source:"manager-node",target:e.id,sourceHandle:t,targetHandle:n,type:"default",style:{stroke:"#ff9800",strokeWidth:2},animated:!1,label:""}});a([...t,c]),i([...n,...u]),d(c.id),setTimeout(()=>{window.dispatchEvent(new CustomEvent("recalculateNodePositions",{detail:{reason:"manager-node-created"}}))},100)},[t,n,a,i,o,r,d]),m=(0,s.useCallback)(()=>{const e=t.find(e=>"managerNode"===e.type);e&&(a(t.filter(t=>t.id!==e.id)),i(n.filter(t=>t.source!==e.id&&t.target!==e.id)),d(null))},[t,n,a,i,d]),g=(0,s.useCallback)(()=>{const e=t.find(e=>"managerNode"===e.type);if(!e)return;const a=t.filter(e=>"agentNode"===e.type),s=n.filter(t=>t.source!==e.id),r=a.map(t=>{const n="vertical"===o?"bottom":"right",a="vertical"===o?"top":"left";return{id:"manager-"+t.id,source:e.id,target:t.id,sourceHandle:n,targetHandle:a,type:"default",style:{stroke:"#ff9800",strokeWidth:2},animated:!1,label:""}});i([...s,...r])},[t,n,i,o]);(0,s.useEffect)(()=>{const e=t.some(e=>"managerNode"===e.type);if("hierarchical"===l)if(e){if(!c){const e=t.find(e=>"managerNode"===e.type);e&&d(e.id)}}else h();else e&&m()},[l,t,h,m]),(0,s.useEffect)(()=>{const e=t.find(e=>"managerNode"===e.type);if(u.current!==o)if(e){if(e&&"hierarchical"===l){const s=t.filter(e=>"agentNode"===e.type),r=new An({margin:20,minNodeSpacing:50}),l=E.z.getState().getUILayoutState();l.screenWidth=window.innerWidth,l.screenHeight=window.innerHeight,l.layoutOrientation=o,r.updateUIState(l);const c=r.getManagerNodePosition(t,"crew"),d=t.map(t=>t.id===e.id?Object.assign({},t,{position:c}):t);a(d);const h=n.filter(t=>t.source!==e.id),m=s.map(t=>{const n="vertical"===o?"bottom":"right",a="vertical"===o?"top":"left";return{id:"manager-"+t.id,source:e.id,target:t.id,sourceHandle:n,targetHandle:a,type:"default",style:{stroke:"#ff9800",strokeWidth:2},animated:!1,label:""}});i([...h,...m]),u.current=o}}else u.current=o},[o,l,c,t,n,a,i]),(0,s.useEffect)(()=>{const e=()=>{t.find(e=>"managerNode"===e.type)&&g()};let n;const a=()=>{clearTimeout(n),n=setTimeout(e,500)};return window.addEventListener("nodesChanged",a),()=>{window.removeEventListener("nodesChanged",a),clearTimeout(n)}},[t,g])})({nodes:t,edges:n,setNodes:a,setEdges:i}),null};jn.propTypes={nodes:vn().array.isRequired,edges:vn().array.isRequired,setNodes:vn().func.isRequired,setEdges:vn().func.isRequired};const wn=jn;var kn=n(80097),Cn=n(20227),Sn=n(12717),_n=n(72934),En=n(39837),In=n(78960),Tn=n(38517),Dn=n(33463),On=n(92974),Nn=n(79741);const Pn=e=>{let{onOpenLogsDialog:t,onToggleChat:n,isChatOpen:a,setIsAgentDialogOpen:o,setIsTaskDialogOpen:r,setIsFlowDialogOpen:l,setIsCrewDialogOpen:c,onSaveCrewClick:u,showRunHistory:h=!1,executionHistoryHeight:m=200,onOpenSchedulesDialog:g,onToggleExecutionHistory:p}=e;const[x,f]=(0,s.useState)(!0),[y,b]=(0,s.useState)(!1),{crewAIFlowEnabled:v}=(0,C.d)(),{userRole:A}=(0,Nn.o)(),j="operator"===A;(0,s.useEffect)(()=>{if(x){const e=setTimeout(()=>f(!1),1500);return()=>clearTimeout(e)}},[x]),(0,s.useEffect)(()=>{a||y||n()},[a,y,n]),(0,s.useEffect)(()=>{a||b(!1)},[a]);const w=[...j?[]:[{id:"add-agent",icon:(0,W.jsx)(Cn.A,{}),tooltip:"Add Agent",onClick:()=>o(!0),disabled:!1},{id:"add-task",icon:(0,W.jsx)(Sn.A,{}),tooltip:"Add Task",onClick:()=>r(!0),disabled:!1},{id:"separator2",isSeparator:!0},{id:"save-crew",icon:(0,W.jsx)(_n.A,{}),tooltip:"Save Crew",onClick:u,disabled:!1}],{id:"open-catalog",icon:(0,W.jsx)(En.A,{}),tooltip:"Open Catalog",onClick:()=>null==c?void 0:c(!0),disabled:!1},...v?[{id:"separator3",isSeparator:!0},{id:"add-flow",icon:(0,W.jsx)(In.A,{}),tooltip:"Add Flow",onClick:()=>l(!0),disabled:!1}]:[],{id:"separator4",isSeparator:!0},{id:"view-logs",icon:(0,W.jsx)(Tn.A,{}),tooltip:"View Assistant Logs",onClick:t,disabled:!1},{id:"toggle-execution-history",icon:(0,W.jsx)(Dn.A,{}),tooltip:h?"Hide Execution History":"Show Execution History",onClick:p,disabled:!p,isActive:h},{id:"schedules",icon:(0,W.jsx)(On.A,{}),tooltip:"Schedules",onClick:g,disabled:!g}];return(0,W.jsxs)(W.Fragment,{children:[(0,W.jsx)(kn.A,{styles:"\n        @keyframes ai-bounce {\n          0% { transform: scale(1) translateY(0); }\n          20% { transform: scale(1.2) translateY(-8px); }\n          40% { transform: scale(0.95) translateY(0); }\n          60% { transform: scale(1.1) translateY(-4px); }\n          80% { transform: scale(0.98) translateY(0); }\n          100% { transform: scale(1) translateY(0); }\n        }\n      "}),(0,W.jsx)(i.A,{sx:{position:"absolute",top:"48px",right:0,height:h?"calc(100% - 48px - "+m+"px)":"calc(100% - 48px)",zIndex:5,display:"flex",flexDirection:"row"},children:(0,W.jsx)(_e.A,{"data-tour":"right-sidebar",elevation:0,sx:{position:"fixed",top:48,right:0,width:48,height:h?"calc(100% - 48px - "+m+"px)":"calc(100% - 48px)",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"flex-start",py:1,borderLeft:1,borderColor:"divider",backgroundColor:"background.paper",zIndex:5,borderRadius:0},children:w.map(e=>(0,W.jsx)(s.Fragment,{children:e.isSeparator?(0,W.jsx)(ne.A,{sx:{width:"80%",my:.5}}):(0,W.jsx)(M.A,{title:e.tooltip,placement:"left",children:(0,W.jsx)(d.A,{onClick:()=>{e.onClick&&!e.disabled&&e.onClick()},disabled:e.disabled,sx:{width:40,height:40,mb:1,color:e.isActive?"primary.main":"text.secondary",backgroundColor:e.isActive?"primary.light":"transparent",borderRight:"2px solid transparent",borderRadius:"50%",display:"flex",alignItems:"center",justifyContent:"center",transition:"all 0.2s cubic-bezier(.4,2,.6,1)",opacity:e.disabled?.6:1,cursor:e.disabled?"not-allowed":"pointer","&:hover":e.disabled?{}:{backgroundColor:e.isActive?"primary.dark":"action.hover",color:e.isActive?"primary.contrastText":"text.primary"},animation:"none"},children:e.icon})})},e.id))})})]})},Mn={openai:"OPENAI_API_KEY","open-ai":"OPENAI_API_KEY","open ai":"OPENAI_API_KEY",anthropic:"ANTHROPIC_API_KEY",qwen:"QWEN_API_KEY",deepseek:"DEEPSEEK_API_KEY",grok:"GROK_API_KEY",databricks:"DATABRICKS_API_KEY",gemini:"GEMINI_API_KEY"};async function zn(e){const t=e.toLowerCase();if("ollama"===t)return!0;if("databricks"===t)try{const e=ke.O.getInstance(),t=await e.getDatabricksConfig();if(t&&t.enabled)return!0}catch(n){}return!1}async function Ln(e,t){const n=e.toLowerCase();if(await zn(n))return!0;const a=Mn[n]||"";if(!a)return!1;return t.some(e=>{const t=e.name.toUpperCase()===a.toUpperCase(),n=e.value&&""!==e.value.trim();return t&&n})}const Wn=e=>{let{open:t,onClose:n,onAgentGenerated:a,selectedModel:d,tools:u=[],selectedTools:m=[],onToolsChange:p=()=>{}}=e;const[x,f]=(0,s.useState)(""),[y,b]=(0,s.useState)(!1),[v,A]=(0,s.useState)(null),[j,w]=(0,s.useState)("databricks-llama-4-maverick"),[k,C]=(0,s.useState)({}),[S,_]=(0,s.useState)(!1),[E,I]=(0,s.useState)([]),[T,D]=(0,s.useState)(!1),[O,N]=(0,s.useState)(""),{secrets:P,fetchAPIKeys:M}=Ve();(0,s.useEffect)(()=>{u.length>0&&I(u)},[u]),(0,s.useEffect)(()=>{const e=e=>{if(e.detail&&Array.isArray(e.detail.tools)){const t=e.detail.tools.filter(e=>!1!==e.enabled);JSON.stringify(t)!==JSON.stringify(E)&&I(t)}};return window.addEventListener("toolStateChanged",e),()=>{window.removeEventListener("toolStateChanged",e)}},[E]),(0,s.useEffect)(()=>{if(t){f(""),A(null);(async()=>{_(!0);try{const e=ye.J.getInstance(),t=await e.getActiveModels();if(C(t),!d&&Object.keys(t).length>0){const e=Object.keys(t)[0];w(e)}else w(d||"databricks-llama-4-maverick")}catch(v){const t=ye.J.getInstance().getActiveModelsSync();if(C(t),!d&&Object.keys(t).length>0){const e=Object.keys(t)[0];w(e)}else w(d||"databricks-llama-4-maverick")}finally{_(!1)}})();const e=async()=>{try{const e=xt.m,t=await e.listTools(),n=t.map(e=>Object.assign({},e,{id:e.id.toString(),enabled:void 0===e.enabled||e.enabled})).filter(e=>!1!==e.enabled);I(n)}catch(v){}};0===E.length&&e()}},[t,d,E.length]);const z=async()=>{if(x.trim()){b(!0),A(null),D(!1),N("");try{await M();const t=Ve.getState().secrets;if(j){var e;const n=k[j],a=(null==n||null==(e=n.provider)?void 0:e.toLowerCase())||"openai";if(!await zn(a)){if(!await Ln(a,t))return D(!0),N(a),A(a.toUpperCase()+" API key is required. Please configure it in the API Keys section."),void b(!1)}}const s=await Ae.generateAgent(x,j,m);s?(a(s),n()):A("Failed to generate agent")}catch(t){if(t&&"object"===typeof t&&"response"in t&&t.response&&"object"===typeof t.response&&"data"in t.response){const e=t.response.data;if(e&&"object"===typeof e&&"detail"in e&&"string"===typeof e.detail){const t=e.detail.match(/No API key found for provider: (\w+)/i);if(t&&t[1]){const e=t[1].toLowerCase();D(!0),N(e),A(e.toUpperCase()+" API key is required. Please configure it in the API Keys section.")}else A(e.detail)}else A(t instanceof Error?t.message:"Failed to generate agent")}else A(t instanceof Error?t.message:"Failed to generate agent")}finally{b(!1)}}else A("Please enter a prompt")};return(0,W.jsxs)(o.A,{open:t,onClose:n,maxWidth:"md",fullWidth:!0,children:[(0,W.jsx)(l.A,{children:"Generate Agent with AI"}),(0,W.jsx)(r.A,{children:(0,W.jsxs)(i.A,{sx:{mt:2,display:"flex",flexDirection:"column",gap:2},children:[v&&(0,W.jsx)(h.A,{severity:"error",sx:{mb:2},action:T&&(0,W.jsx)(g.A,{color:"inherit",size:"small",onClick:()=>{Ve.getState().openApiKeyEditor(O);const e=new CustomEvent("openConfigAPIKeys");window.dispatchEvent(e),n()},children:"Configure API Keys"}),children:v}),(0,W.jsxs)(re.A,{fullWidth:!0,children:[(0,W.jsx)(le.A,{children:"Model"}),(0,W.jsx)(ce.A,{value:j,onChange:e=>{w(e.target.value)},label:"Model",disabled:y||S,children:S?(0,W.jsx)(de.A,{disabled:!0,children:"Loading models..."}):Object.entries(k).filter(e=>{let[t,n]=e;return!1!==n.enabled}).map(e=>{let[t,n]=e;return(0,W.jsxs)(de.A,{value:t,sx:{display:"flex",justifyContent:"space-between",gap:1},children:[(0,W.jsx)("span",{children:t}),(0,W.jsx)("span",{style:{fontSize:"0.8em"},children:n.provider?"("+n.provider+")":""})]},t)})})]}),(0,W.jsx)(U.A,{fullWidth:!0,label:"Describe the agent you want to create",multiline:!0,rows:4,value:x,onChange:e=>f(e.target.value),onKeyPress:e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),z())},placeholder:"Example: Create a research assistant agent specialized in analyzing scientific papers and summarizing key findings",disabled:y,autoFocus:!0}),E.length>0&&(0,W.jsxs)(i.A,{sx:{mt:2},children:[(0,W.jsx)(c.A,{variant:"subtitle1",gutterBottom:!0,children:"Available Tools"}),(0,W.jsx)(i.A,{sx:{display:"flex",flexWrap:"wrap",gap:1},children:E.filter(e=>!1!==e.enabled).map(e=>{const t=(e=>"string"===typeof e.id?e.id:"number"===typeof e.id?e.id.toString():"")(e);return(0,W.jsx)(V.A,{label:e.title||"Unnamed Tool",onClick:()=>(e=>{m.includes(e)?p(m.filter(t=>t!==e)):p([...m,e])})(t),color:m.includes(t)?"primary":"default",sx:{m:.5}},t)})}),0===E.filter(e=>!1!==e.enabled).length&&(0,W.jsx)(c.A,{color:"text.secondary",sx:{mt:1},children:"No enabled tools available. Please enable tools in the Tools section."})]})]})}),(0,W.jsxs)(H.A,{children:[(0,W.jsx)(g.A,{onClick:n,disabled:y,children:"Cancel"}),(0,W.jsx)(g.A,{onClick:z,variant:"contained",disabled:y||!x.trim()||S,startIcon:y?(0,W.jsx)(Y.A,{size:20}):null,children:y?"Generating...":"Generate"})]})]})},Rn=e=>{let{open:t,onClose:n,onTaskGenerated:a,selectedModel:c}=e;const[d,u]=(0,s.useState)(""),[m,p]=(0,s.useState)(!1),[x,f]=(0,s.useState)(null),[y,b]=(0,s.useState)("databricks-llama-4-maverick"),[v,A]=(0,s.useState)({}),[j,w]=(0,s.useState)(!1),[k,C]=(0,s.useState)(!1),[S,_]=(0,s.useState)(""),{secrets:E,fetchAPIKeys:I}=Ve();(0,s.useEffect)(()=>{if(t){u(""),f(null),C(!1),_("");(async()=>{w(!0);try{const e=ye.J.getInstance(),t=await e.getActiveModels();if(A(t),!c&&Object.keys(t).length>0){const e=Object.keys(t)[0];b(e)}else b(c||"databricks-llama-4-maverick")}catch(x){const t=ye.J.getInstance().getActiveModelsSync();if(A(t),!c&&Object.keys(t).length>0){const e=Object.keys(t)[0];b(e)}else b(c||"databricks-llama-4-maverick")}finally{w(!1)}})()}},[t,c]);const T=async()=>{if(d.trim()){p(!0),f(null),C(!1),_("");try{await I();const t=Ve.getState().secrets;if(y){var e;const n=v[y],a=(null==n||null==(e=n.provider)?void 0:e.toLowerCase())||"openai";if(!await zn(a)){if(!await Ln(a,t))return C(!0),_(a),f(a.toUpperCase()+" API key is required. Please configure it in the API Keys section."),void p(!1)}}const s=await Ae.generateTask(d,y);if(s){const e=Object.assign({},s,{id:"",agent_id:null,async_execution:!1,context:[],config:{cache_response:!1,cache_ttl:3600,retry_on_fail:!0,max_retries:3,timeout:null,priority:1,error_handling:"default",output_file:null,output_json:null,output_pydantic:null,callback:null,human_input:!1,guardrail:null,markdown:!1},tools:s.tools||[]});a(e),n(),u("")}else f("Failed to generate task")}catch(t){if(t&&"object"===typeof t&&"response"in t&&t.response&&"object"===typeof t.response&&"data"in t.response){const e=t.response.data;if(e&&"object"===typeof e&&"detail"in e&&"string"===typeof e.detail){const t=e.detail.match(/No API key found for provider: (\w+)/i);if(t&&t[1]){const e=t[1].toLowerCase();C(!0),_(e),f(e.toUpperCase()+" API key is required. Please configure it in the API Keys section.")}else f(e.detail)}else f(t instanceof Error?t.message:"Failed to generate task")}else f(t instanceof Error?t.message:"Failed to generate task")}finally{p(!1)}}else f("Please enter a prompt")};return(0,W.jsxs)(o.A,{open:t,onClose:n,maxWidth:"md",fullWidth:!0,children:[(0,W.jsx)(l.A,{children:"Generate Task with AI"}),(0,W.jsx)(r.A,{children:(0,W.jsxs)(i.A,{sx:{mt:2,display:"flex",flexDirection:"column",gap:2},children:[x&&(0,W.jsx)(h.A,{severity:"error",sx:{mb:2},action:k&&(0,W.jsx)(g.A,{color:"inherit",size:"small",onClick:()=>{Ve.getState().openApiKeyEditor(S);const e=new CustomEvent("openConfigAPIKeys");window.dispatchEvent(e),n()},children:"Configure API Keys"}),children:x}),(0,W.jsxs)(re.A,{fullWidth:!0,children:[(0,W.jsx)(le.A,{children:"Model"}),(0,W.jsx)(ce.A,{value:y,onChange:e=>{b(e.target.value)},label:"Model",disabled:m||j,children:j?(0,W.jsx)(de.A,{disabled:!0,children:"Loading models..."}):Object.entries(v).filter(e=>{let[t,n]=e;return!1!==n.enabled}).map(e=>{let[t,n]=e;return(0,W.jsxs)(de.A,{value:t,sx:{display:"flex",justifyContent:"space-between",gap:1},children:[(0,W.jsx)("span",{children:t}),(0,W.jsx)("span",{style:{fontSize:"0.8em"},children:n.provider?"("+n.provider+")":""})]},t)})})]}),(0,W.jsx)(U.A,{fullWidth:!0,label:"Describe the task you want to create",multiline:!0,rows:4,value:d,onChange:e=>u(e.target.value),onKeyPress:e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),T())},placeholder:"Example: Create a task that analyzes a dataset and generates a summary report",disabled:m,autoFocus:!0})]})}),(0,W.jsxs)(H.A,{children:[(0,W.jsx)(g.A,{onClick:n,disabled:m,children:"Cancel"}),(0,W.jsx)(g.A,{onClick:T,variant:"contained",disabled:m||!d.trim()||j,startIcon:m?(0,W.jsx)(Y.A,{size:20}):null,children:m?"Generating...":"Generate"})]})]})};var Fn=n(78135);const Bn=(0,A.vt)(e=>({models:Fn.J,currentEditModel:null,editDialogOpen:!1,isNewModel:!1,loading:!0,saving:!1,modelsChanged:!1,searchTerm:"",databricksEnabled:!1,error:null,refreshKey:0,activeTab:0,setModels:t=>e({models:t}),setCurrentEditModel:t=>e({currentEditModel:t}),setEditDialogOpen:t=>e({editDialogOpen:t}),setIsNewModel:t=>e({isNewModel:t}),setLoading:t=>e({loading:t}),setSaving:t=>e({saving:t}),setModelsChanged:t=>e({modelsChanged:t}),setSearchTerm:t=>e({searchTerm:t}),setDatabricksEnabled:t=>e({databricksEnabled:t}),setError:t=>e({error:t}),incrementRefreshKey:()=>e(e=>({refreshKey:e.refreshKey+1})),setActiveTab:t=>e({activeTab:t}),resetModelConfig:()=>e({models:Fn.J,currentEditModel:null,editDialogOpen:!1,isNewModel:!1,loading:!0,saving:!1,modelsChanged:!1,searchTerm:"",databricksEnabled:!1,error:null,refreshKey:0,activeTab:0})}));class Vn{static async createCrew(e){try{const t=await ve.uE.post("/crew/create-crew",{prompt:e.prompt,model:e.model,tools:e.tools||[]});return{agents:t.data.agents,tasks:t.data.tasks}}catch(t){throw t}}}const Un=e=>{let{open:t,onClose:n,onGenerateCrew:a,selectedModel:d,tools:u,selectedTools:m,onToolsChange:p}=e;const[x,f]=(0,s.useState)(""),[y,b]=(0,s.useState)(!1),[A,j]=(0,s.useState)(u),[w,k]=(0,s.useState)(""),[C,S]=(0,s.useState)({}),[_,E]=(0,s.useState)(!1),I=(0,s.useRef)(null),T=(0,s.useRef)(null),D=(0,s.useRef)(!1),O=(0,s.useRef)(d||""),[N,P]=(0,s.useState)(null),[M,z]=(0,s.useState)(!1),[L,R]=(0,s.useState)(""),[F,B]=(0,s.useState)(!1),K=Bn(),{models:G,loading:q}=K,{setSelectedModel:J}=(0,v.E)(),{secrets:X,fetchAPIKeys:Q}=Ve(),Z=(0,s.useMemo)(()=>Object.assign({},G,C),[C,G]);(0,s.useEffect)(()=>{if(t){E(!0);ye.J.getInstance().getActiveModels().then(e=>{if(S(e),E(!1),!w&&!O.current&&Object.keys(e).length>0){const t=Object.keys(e)[0];k(t),O.current=t,J(t)}}).catch(e=>{E(!1)})}},[t,J,w]),(0,s.useEffect)(()=>{if(Z&&Object.keys(Z).length>0&&(!O.current||""===O.current)){const e=Object.keys(Z)[0];O.current=e}},[Z]),(0,s.useEffect)(()=>{u&&u.length>0&&j(u)},[u]),(0,s.useEffect)(()=>{if(!t)return void(D.current=!1);if(D.current)return;(async()=>{if(D.current=!0,f(""),O.current||Object.keys(Z).length>0&&(O.current=Object.keys(Z)[0],J(O.current)),!A||0===A.length)try{const e=xt.m,t=(await e.listEnabledTools()).map(e=>Object.assign({},e,{id:e.id.toString(),enabled:void 0===e.enabled||e.enabled,category:e.category}));j(t)}catch(e){}})()},[t,Z,A,J]);const $=async()=>{if(x.trim()&&O.current){b(!0),P(null),z(!1),R(""),J(O.current);try{var e;await Q();const t=Z[O.current],s=(null==t||null==(e=t.provider)?void 0:e.toLowerCase())||"openai",i=await(async e=>{try{var t;if(!Z||!Z[e])return!1;const n=(null==(t=Z[e].provider)?void 0:t.toLowerCase())||"openai",a=Ve.getState().secrets;return!!await zn(n)||await Ln(n,a)}catch(n){return!1}})(O.current);if(!i)return z(!0),R(s),P(s.toUpperCase()+" API key is required. Please configure it in the API Keys section."),void b(!1);const o=await Vn.createCrew({prompt:x,model:O.current,tools:m});if(o.tasks&&o.tasks.length>0&&o.agents&&o.agents.length>0){const e=o.agents[0].id;o.tasks.forEach(t=>{!t.agent_id&&e&&(t.agent_id=e,t.assigned_agent=e),t.context&&Array.isArray(t.context)||(t.context=[])})}if(o.tasks&&o.tasks.length>1){let e=0,t=0;o.tasks.forEach(n=>{n.context&&n.context.length>0?e++:t++})}a(o,F),n()}catch(t){if(t&&"object"===typeof t&&"response"in t&&t.response&&"object"===typeof t.response&&"data"in t.response){const e=t.response.data;if(e&&"object"===typeof e&&"detail"in e&&"string"===typeof e.detail){const t=e.detail.match(/No API key found for provider: (\w+)/i);if(t&&t[1]){const e=t[1].toLowerCase();z(!0),R(e),P(e.toUpperCase()+" API key is required. Please configure it in the API Keys section.")}else P(e.detail)}else P("Failed to generate crew. Please try again later.")}else P("Failed to generate crew. Please try again later.")}finally{b(!1)}}};return(0,s.useEffect)(()=>{(()=>{if(Z&&Object.keys(Z).length>0&&!w){const e=Object.entries(Z).filter(e=>{let[t,n]=e;return!0===(null==n?void 0:n.enabled)});if(e.length>0){const[t]=e[0];k(t),O.current=t,J(t)}else{const e=Object.keys(Z)[0];k(e),O.current=e,J(e)}}})()},[Z,w,J]),(0,W.jsx)(o.A,{open:t,onClose:n,maxWidth:"md",fullWidth:!0,TransitionProps:{onEntered:()=>{setTimeout(()=>{I.current&&I.current.focus()},150)}},children:(0,W.jsxs)("form",{onSubmit:e=>{e.preventDefault(),!x||y||_||$()},children:[(0,W.jsx)(l.A,{children:"Generate Crew from Description"}),(0,W.jsxs)(r.A,{children:[N&&(0,W.jsx)(h.A,{severity:"error",sx:{mb:2,mt:1},action:M&&(0,W.jsx)(g.A,{color:"inherit",size:"small",onClick:()=>{Ve.getState().openApiKeyEditor(L);const e=new CustomEvent("openConfigAPIKeys");window.dispatchEvent(e),n()},children:"Configure API Keys"}),children:N}),(0,W.jsxs)(re.A,{fullWidth:!0,margin:"normal",children:[(0,W.jsx)(le.A,{id:"model-label",children:"Model"}),(0,W.jsx)(ce.A,{labelId:"model-label",value:w||O.current||"",onChange:e=>{const t=e.target.value;k(t),O.current=t,J(t)},label:"Model",disabled:y||_,MenuProps:{PaperProps:{style:{maxHeight:300,width:"auto"}}},sx:{minHeight:56,"& .MuiSelect-select":{display:"flex",alignItems:"center"}},children:_?(0,W.jsxs)(de.A,{disabled:!0,value:"",children:[(0,W.jsx)(Y.A,{size:20})," Loading models..."]}):0===Object.keys(Z).length?(0,W.jsx)(de.A,{disabled:!0,value:"",children:"No models available"}):Object.entries(Z).filter(e=>{let[t,n]=e;return!0===(null==n?void 0:n.enabled)}).map(e=>{let[t,n]=e;return(0,W.jsxs)(de.A,{value:t,sx:{minHeight:"40px"},children:[(null==n?void 0:n.name)||t," ",null!=n&&n.provider?"("+n.provider+")":""]},t)})})]}),(0,W.jsx)(U.A,{inputRef:I,label:"Describe your crew",multiline:!0,rows:6,value:x,onChange:e=>f(e.target.value),onKeyDown:e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),!x.trim()||y||_||$())},fullWidth:!0,margin:"normal",placeholder:"Example: I need a crew to help me analyze market research data and create a report with visualizations",disabled:y,autoFocus:!0}),(0,W.jsxs)(i.A,{sx:{mt:2},children:[(0,W.jsx)(c.A,{variant:"subtitle1",gutterBottom:!0,children:"Available Tools"}),(0,W.jsxs)(i.A,{sx:{display:"flex",flexWrap:"wrap",gap:1},children:[A&&A.filter(e=>!1!==e.enabled).map(e=>{const t=(e=>"string"===typeof e.id?e.id:"number"===typeof e.id?e.id.toString():"")(e);return(0,W.jsx)(V.A,{label:e.title||"Unnamed Tool",onClick:()=>(e=>{if(m.includes(e)){const t=m.filter(t=>t!==e);p(t)}else{const t=[...m,e];p(t)}})(t),color:m.includes(t)?"primary":"default",sx:{m:.5}},t)}),(!A||0===A.length)&&(0,W.jsx)(Y.A,{size:20,sx:{m:2}})]}),A&&A.length>0&&0===A.filter(e=>!1!==e.enabled).length&&(0,W.jsx)(c.A,{color:"text.secondary",sx:{mt:1},children:"No enabled tools available. Please enable tools in the Tools section."})]}),(0,W.jsx)(i.A,{sx:{mt:3},children:(0,W.jsx)(he.A,{control:(0,W.jsx)(Kt.A,{checked:F,onChange:e=>B(e.target.checked),disabled:y}),label:"Execute crew after generation"})})]}),(0,W.jsxs)(H.A,{children:[(0,W.jsx)(g.A,{onClick:n,disabled:y,children:"Cancel"}),(0,W.jsx)(g.A,{ref:T,onClick:$,color:"primary",disabled:!x.trim()||y||_,children:y?(0,W.jsx)(Y.A,{size:24}):"Generate"})]})]})})};var Hn=n(11966),Kn=n(84142),Gn=n(29635),qn=n(3148),Jn=n(33742),Yn=n(83716),Xn=n(41328);const Qn=e=>e.map(e=>e.position&&"number"===typeof e.position.x&&isFinite(e.position.x)&&"number"===typeof e.position.y&&isFinite(e.position.y)?Math.abs(e.position.x)>1e4||Math.abs(e.position.y)>1e4?Object.assign({},e,{position:{x:100+300*Math.random(),y:100+200*Math.random()}}):e:Object.assign({},e,{position:{x:100+300*Math.random(),y:100+200*Math.random()}})),Zn=["children","value","index"];function $n(e){const{children:t,value:n,index:s}=e,o=(0,a.A)(e,Zn);return(0,W.jsx)("div",Object.assign({role:"tabpanel",hidden:n!==s,id:"flow-tabpanel-"+s,"aria-labelledby":"flow-tab-"+s},o,{style:{padding:"16px 0",height:"calc(100% - 48px)",overflow:"auto"},children:n===s&&(0,W.jsx)(i.A,{sx:{height:"100%"},children:t})}))}const ea=e=>{var t,n,a,m,p,x;let{open:f,onClose:y,flowId:b,onSave:v}=e;const[A,j]=(0,s.useState)(0),[k,C]=(0,s.useState)(null),[S,_]=(0,s.useState)(""),[E,I]=(0,s.useState)(!1),[T,D]=(0,s.useState)(!1),[O,P]=(0,s.useState)(null),[M,z]=(0,s.useState)(!1),[L,R]=(0,s.useState)([]),[F,B]=(0,s.useState)([]),[K,G]=(0,s.useState)([]),[q,J]=(0,s.useState)(-1),[X,Z]=(0,s.useState)([]),[$,ee]=(0,s.useState)([]),[te,se]=(0,s.useState)([]),[ie,oe]=(0,s.useState)("");(0,s.useEffect)(()=>{f&&b?me(b):he()},[f,b]),(0,s.useEffect)(()=>{$.length&&f&&b&&(async()=>{if(!$.length)return;const e=[];for(const t of $)try{const n=await Re.getCrew(String(t.id));n&&n.tasks&&Array.isArray(n.tasks)&&n.tasks.forEach(n=>{const a=n;e.some(e=>e.id===String(a.id))||e.push({id:String(a.id),name:a.name||"Task "+a.id,agent_id:String(t.id)})})}catch(O){}Z(t=>{const n=new Map(t.map(e=>[e.id,e]));return e.forEach(e=>{n.has(e.id)||n.set(e.id,e)}),Array.from(n.values())}),B(t=>{const n=new Map(t.map(e=>[e.taskId,e])),a=[];return e.forEach(e=>{if(!n.has(e.id)){const t=$.find(t=>String(t.id)===e.agent_id);t&&a.push({crewId:String(t.id),taskId:e.id,taskName:e.name,crewName:t.name,isStartPoint:!1})}}),[...t,...a]})})()},[$,f,b]),(0,s.useEffect)(()=>{f&&b&&(async()=>{if($.length)try{const n=await Re.getCrews(),a=new Map($.map(e=>[e.id,e])),s=[];for(const i of Array.from(a.keys()))try{var e;const t=n.find(e=>String(e.id)===String(i));(null==t?void 0:t.name)||null==(e=a.get(i))||e.name,(await Re.getTasks(String(i))).forEach(e=>{s.some(t=>t.id===String(e.id))||s.push({id:String(e.id),name:e.name,agent_id:String(i)})})}catch(t){}Z(e=>{const t=new Map(e.map(e=>[e.id,e]));return s.forEach(e=>{t.has(e.id)||t.set(e.id,e)}),Array.from(t.values())}),B(e=>{const t=new Map(e.map(e=>[e.taskId,e])),i=[];return s.forEach(e=>{var s;if(t.has(e.id))return;const o=Number(e.agent_id),r=a.get(o)||{id:o,name:(null==(s=n.find(e=>String(e.id)===String(o)))?void 0:s.name)||"Crew "+o};i.push({crewId:String(r.id),taskId:e.id,taskName:e.name,crewName:r.name,isStartPoint:!1})}),[...e,...i]})}catch(O){}})()},[$,f,b]);const ue=(0,s.useCallback)(async()=>{try{const t=await Re.getCrews(),n=[];for(const a of t)try{(await Re.getTasks(String(a.id))).forEach(e=>{n.some(t=>t.id===String(e.id))||n.push({id:String(e.id),name:e.name,agent_id:String(a.id)})})}catch(e){}return Z(e=>{const t=new Map(e.map(e=>[e.id,e]));return n.forEach(e=>{t.has(e.id)||t.set(e.id,e)}),Array.from(t.values())}),B(e=>{const t=new Map(e.map(e=>[e.taskId,e])),a=[],s=$.map(e=>String(e.id));return n.forEach(e=>{if(t.has(e.id))return;const n=String(e.agent_id);if(s.includes(n)){const t=$.find(e=>String(e.id)===n);t&&a.push({crewId:String(t.id),taskId:e.id,taskName:e.name,crewName:t.name,isStartPoint:!1})}}),[...e,...a]}),!0}catch(O){return!1}},[$]);(0,s.useEffect)(()=>{b&&$.length>0&&f&&ue().then(e=>{})},[b,$.length,f,ue]);const he=()=>{C(null),_(""),P(null),R([]),B([]),G([]),J(-1),j(0)},me=async e=>{I(!0),P(null);try{const t=e.toString(),n=await Ft.getFlow(t);if(!n)throw new Error("Failed to load flow data");C(n),_(n.name||"");const a=[];if(n.flowConfig||n.flow_config){const e=n.flowConfig||n.flow_config;if(null!=e&&e.listeners&&Array.isArray(e.listeners)){const t=e.listeners.map(e=>{const t=e.listenToTaskIds||(e.listenTo&&Array.isArray(e.listenTo)?e.listenTo:"string"===typeof e.listenTo?[e.listenTo]:[]),n=e.listenToTaskNames||[];return e.crewId&&!a.some(t=>String(t.id)===String(e.crewId))&&a.push({id:"string"===typeof e.crewId?parseInt(e.crewId,10)||0:e.crewId,name:e.crewName||"Crew "+e.crewId}),Object.assign({},e,{listenToTaskIds:t,listenToTaskNames:n})});R(t)}else R([]);null!=e&&e.startingPoints&&Array.isArray(e.startingPoints)?(e.startingPoints.forEach(e=>{e.crewId&&!a.some(t=>String(t.id)===String(e.crewId))&&a.push({id:"string"===typeof e.crewId?parseInt(e.crewId,10)||0:e.crewId,name:e.crewName||"Crew "+e.crewId})}),B(e.startingPoints)):B([]),null!=e&&e.actions&&Array.isArray(e.actions)?(e.actions.forEach(e=>{e.crewId&&!a.some(t=>String(t.id)===String(e.crewId))&&a.push({id:"string"===typeof e.crewId?parseInt(e.crewId,10)||0:e.crewId,name:e.crewName||"Crew "+e.crewId})}),G(e.actions)):G([])}else R([]),B([]),G([]);ee(a),a.length}catch(O){P(O instanceof Error?O.message:"An error occurred while loading the flow")}finally{I(!1)}};return(0,s.useEffect)(()=>{},[A,X.length,F,$.length]),(0,W.jsxs)(W.Fragment,{children:[(0,W.jsxs)(o.A,{open:f,onClose:y,maxWidth:"md",fullWidth:!0,PaperProps:{sx:{height:"80vh"}},children:[(0,W.jsxs)(l.A,{sx:{borderBottom:"1px solid",borderColor:"divider"},children:["Edit Flow",(0,W.jsx)(d.A,{"aria-label":"close",onClick:y,sx:{position:"absolute",right:8,top:8},children:(0,W.jsx)(N.A,{})})]}),(0,W.jsx)(i.A,{sx:{borderBottom:1,borderColor:"divider",px:2},children:(0,W.jsxs)(Hn.A,{value:A,onChange:(e,t)=>{j(t)},"aria-label":"flow edit tabs",children:[(0,W.jsx)(Kn.A,{label:"Basic Info",id:"flow-tab-0","aria-controls":"flow-tabpanel-0"}),(0,W.jsx)(Kn.A,{label:"Crews",id:"flow-tab-1","aria-controls":"flow-tabpanel-1"}),(0,W.jsx)(Kn.A,{label:"Listeners",id:"flow-tab-2","aria-controls":"flow-tabpanel-2"}),(0,W.jsx)(Kn.A,{label:"Starting Points",id:"flow-tab-3","aria-controls":"flow-tabpanel-3"})]})}),(0,W.jsx)(r.A,{sx:{p:2,display:"flex",flexDirection:"column",height:"calc(100% - 120px)"},children:E?(0,W.jsx)(i.A,{sx:{display:"flex",justifyContent:"center",alignItems:"center",height:"100%"},children:(0,W.jsx)(Y.A,{})}):O?(0,W.jsx)(h.A,{severity:"error",sx:{mt:2},children:O}):k?(0,W.jsxs)(W.Fragment,{children:[(0,W.jsx)($n,{value:A,index:0,children:(0,W.jsxs)(_e.A,{variant:"outlined",sx:{p:3,border:"1px solid",borderColor:"primary.light",borderRadius:1},children:[(0,W.jsx)(c.A,{variant:"h6",gutterBottom:!0,color:"primary",children:"Basic Information"}),(0,W.jsx)(U.A,{label:"Flow Name",fullWidth:!0,value:S,onChange:e=>_(e.target.value),margin:"normal",variant:"outlined",required:!0,error:!S.trim(),helperText:!S.trim()&&"Flow name is required"}),(0,W.jsxs)(c.A,{variant:"body2",color:"text.secondary",sx:{mt:2},children:["ID: ",k.id]}),(0,W.jsxs)(c.A,{variant:"body2",color:"text.secondary",children:["Created: ",new Date(k.created_at).toLocaleString()]}),(0,W.jsxs)(c.A,{variant:"body2",color:"text.secondary",children:["Last Updated: ",new Date(k.updated_at).toLocaleString()]})]})}),(0,W.jsxs)($n,{value:A,index:1,children:[(0,W.jsx)(c.A,{variant:"body2",color:"text.secondary",paragraph:!0,children:"Manage the crews included in this flow. You can add or remove crews to modify which components are available in the flow."}),(0,W.jsxs)(i.A,{sx:{display:"flex",height:"calc(100% - 50px)"},children:[(0,W.jsxs)(_e.A,{variant:"outlined",sx:{width:"50%",p:2,mr:2,height:"100%",overflow:"auto"},children:[(0,W.jsx)(c.A,{variant:"subtitle2",gutterBottom:!0,fontWeight:"medium",children:"Current Crews in Flow"}),0===$.length?(0,W.jsx)(c.A,{variant:"body2",sx:{my:2,textAlign:"center",color:"text.secondary"},children:"No crews in this flow. Add crews from the list on the right."}):(0,W.jsx)(at.A,{sx:{p:0},children:$.map(e=>(0,W.jsxs)(_e.A,{elevation:0,sx:{p:2,mb:1,border:"1px solid",borderColor:"divider",borderRadius:1,display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,W.jsx)(c.A,{variant:"body1",children:e.name}),(0,W.jsx)(d.A,{size:"small",color:"error",onClick:()=>{ee(t=>t.filter(t=>t.id!==e.id))},children:(0,W.jsx)(Q.A,{fontSize:"small"})})]},e.id))})]}),(0,W.jsxs)(_e.A,{variant:"outlined",sx:{width:"50%",p:2,height:"100%",overflow:"auto"},children:[(0,W.jsx)(c.A,{variant:"subtitle2",gutterBottom:!0,fontWeight:"medium",children:"Available Crews"}),(0,W.jsx)(U.A,{placeholder:"Search crews...",size:"small",fullWidth:!0,sx:{mb:2},value:ie,onChange:e=>oe(e.target.value),InputProps:{startAdornment:(0,W.jsx)(ae.A,{position:"start",children:(0,W.jsx)(Ee.A,{fontSize:"small"})})}}),(0,W.jsxs)(at.A,{sx:{p:0},children:[te.filter(e=>e.name.toLowerCase().includes(ie.toLowerCase())&&!$.some(t=>t.id===e.id)).map(e=>(0,W.jsxs)(_e.A,{elevation:0,sx:{p:2,mb:1,border:"1px solid",borderColor:"divider",borderRadius:1,display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,W.jsx)(c.A,{variant:"body1",children:e.name}),(0,W.jsx)(d.A,{size:"small",color:"primary",onClick:()=>{ee(t=>[...t,e])},children:(0,W.jsx)($t.A,{fontSize:"small"})})]},e.id)),0===te.filter(e=>e.name.toLowerCase().includes(ie.toLowerCase())&&!$.some(t=>t.id===e.id)).length&&(0,W.jsx)(c.A,{variant:"body2",sx:{textAlign:"center",color:"text.secondary",p:2},children:"No matching crews found"})]})]})]})]}),(0,W.jsxs)($n,{value:A,index:2,children:[(0,W.jsx)(c.A,{variant:"body2",color:"text.secondary",paragraph:!0,children:"Configure listeners for your flow. Listeners respond to task outputs and can trigger actions in the flow. Each listener needs to know which tasks to listen to (Listen To Tasks) and which tasks to execute when triggered (Tasks To Execute)."}),(0,W.jsxs)(i.A,{sx:{display:"flex",mb:2,gap:1},children:[(0,W.jsx)(g.A,{startIcon:(0,W.jsx)($t.A,{}),variant:"outlined",onClick:()=>{const e={id:"listener-"+(0,w.A)(),name:"Listener "+(L.length+1),crewId:$.length>0?String($[0].id):"",crewName:$.length>0?$[0].name:"Unknown Crew",conditionType:"NONE",tasks:[],state:{stateType:"unstructured",stateDefinition:"",stateData:{}},listenToTaskIds:[]};R(t=>[...t,e]),J(L.length)},children:"Add Listener"}),(0,W.jsx)(g.A,{variant:"outlined",size:"small",onClick:()=>{alert("Debug info logged to console.\nListeners: "+L.length+"\nActions: "+K.length+"\nStarting Points: "+F.filter(e=>e.isStartPoint).length)},children:"Debug Flow"})]}),0===L.length?(0,W.jsx)(c.A,{variant:"body2",sx:{my:2,textAlign:"center"},children:"No listeners configured. Click the button above to add a listener."}):(0,W.jsxs)(i.A,{sx:{display:"flex",height:"calc(100% - 80px)"},children:[(0,W.jsxs)(_e.A,{variant:"outlined",sx:{width:"30%",p:2,mr:2,height:"100%",overflow:"auto"},children:[(0,W.jsx)(c.A,{variant:"subtitle2",gutterBottom:!0,fontWeight:"medium",children:"Listeners"}),L.map((e,t)=>(0,W.jsxs)(i.A,{onClick:()=>J(t),sx:{p:1.5,mb:1,borderRadius:1,cursor:"pointer",bgcolor:q===t?"primary.light":"grey.100",color:q===t?"primary.contrastText":"text.primary","&:hover":{bgcolor:q===t?"primary.light":"grey.200"},position:"relative"},children:[(0,W.jsx)(c.A,{variant:"body2",fontWeight:q===t?"bold":"normal",children:e.crewName}),(0,W.jsxs)(c.A,{variant:"caption",color:q===t?"primary.contrastText":"text.secondary",display:"block",children:["Listen To: ",e.listenToTaskIds&&e.listenToTaskIds.length>0?e.listenToTaskIds.map(e=>{const t=X.find(t=>String(t.id)===e),n=$.find(e=>String(e.id)===String(null==t?void 0:t.agent_id)),a=(null==t?void 0:t.name)||"Task "+e;return((null==n?void 0:n.name)||(null!=t&&t.agent_id?"Crew "+(null==t?void 0:t.agent_id):"System"))+":"+a}).join(", "):"Not set"]}),(0,W.jsxs)(c.A,{variant:"caption",color:q===t?"primary.contrastText":"text.secondary",display:"block",children:["Tasks: ",e.tasks.length>0?e.tasks.map(e=>{const t=X.find(t=>t.id===e.id),n=$.find(n=>String(n.id)===String(e.agent_id||(null==t?void 0:t.agent_id))),a=e.name||(null==t?void 0:t.name)||"Task "+e.id,s=(null==n?void 0:n.name)||(e.agent_id?"Crew "+e.agent_id:"");return s?s+":"+a:a}).join(", "):"None"]}),(0,W.jsx)(c.A,{variant:"caption",color:q===t?"primary.contrastText":"text.secondary",display:"block",children:e.conditionType||"No Condition"}),(0,W.jsx)(d.A,{size:"small",sx:{position:"absolute",top:4,right:4,color:q===t?"primary.contrastText":"error.main"},onClick:t=>{var n;t.stopPropagation(),n=e.id,R(e=>e.filter(e=>e.id!==n)),G(e=>e.filter(e=>!e.id.includes(n))),q>=L.length-1&&J(Math.max(0,L.length-2))},children:(0,W.jsx)(Q.A,{fontSize:"small"})})]},e.id))]}),q>=0&&q<L.length?(0,W.jsxs)(_e.A,{variant:"outlined",sx:{width:"70%",p:2,height:"100%",overflow:"auto"},children:[(0,W.jsx)(c.A,{variant:"subtitle2",gutterBottom:!0,fontWeight:"medium",children:"Configure Listener"}),(0,W.jsxs)(re.A,{fullWidth:!0,margin:"normal",children:[(0,W.jsx)(le.A,{id:"listen-to-task-label",children:"Listen To Tasks"}),(0,W.jsx)(ce.A,{labelId:"listen-to-task-label",multiple:!0,value:(null==(t=L[q])?void 0:t.listenToTaskIds)||[],onChange:e=>{if(q<0)return;const t=e.target.value;R(e=>{const n=[...e];return n[q]=Object.assign({},n[q],{listenToTaskIds:t}),n})},label:"Listen To Tasks",renderValue:e=>(0,W.jsx)(i.A,{sx:{display:"flex",flexWrap:"wrap",gap:.5},children:e.map(e=>{const t=X.find(t=>t.id===e),n=$.find(e=>e.id.toString()===(null==t?void 0:t.agent_id));return(0,W.jsx)(V.A,{label:((null==n?void 0:n.name)||(null!=t&&t.agent_id?"Crew "+(null==t?void 0:t.agent_id):"System"))+":"+((null==t?void 0:t.name)||"Task "+e)},e)})}),children:X.filter(e=>!String(e.id).startsWith("agent-")).map(e=>{var t;const n=$.find(t=>String(t.id)===e.agent_id);return(0,W.jsxs)(de.A,{value:e.id,children:[(0,W.jsx)(Kt.A,{checked:((null==(t=L[q])?void 0:t.listenToTaskIds)||[]).includes(e.id)}),(0,W.jsx)(ot.A,{primary:((null==n?void 0:n.name)||(null!=e&&e.agent_id?"Crew "+(null==e?void 0:e.agent_id):"System"))+":"+e.name,secondary:"ID: "+e.id+" (Task)"})]},e.id)})})]}),(0,W.jsxs)(re.A,{fullWidth:!0,margin:"normal",children:[(0,W.jsx)(le.A,{id:"condition-type-label",children:"Condition Type"}),(0,W.jsxs)(ce.A,{labelId:"condition-type-label",value:(null==(n=L[q])?void 0:n.conditionType)||"NONE",onChange:e=>{if(q<0)return;const t=e.target.value;R(e=>{const n=[...e];return n[q]=Object.assign({},n[q],{conditionType:t}),n})},label:"Condition Type",children:[(0,W.jsx)(de.A,{value:"NONE",children:(0,W.jsx)(ot.A,{primary:"NONE",secondary:"No condition, always trigger when task completes"})}),(0,W.jsx)(de.A,{value:"AND",children:(0,W.jsx)(ot.A,{primary:"AND",secondary:"Trigger when ALL listened tasks complete"})}),(0,W.jsx)(de.A,{value:"OR",children:(0,W.jsx)(ot.A,{primary:"OR",secondary:"Trigger when ANY listened task completes"})}),(0,W.jsx)(de.A,{value:"ROUTER",children:(0,W.jsx)(ot.A,{primary:"ROUTER",secondary:"Route based on task output conditions"})})]})]}),(0,W.jsxs)(re.A,{fullWidth:!0,margin:"normal",children:[(0,W.jsx)(le.A,{id:"listener-tasks-label",children:"Tasks To Execute"}),(0,W.jsx)(ce.A,{labelId:"listener-tasks-label",multiple:!0,value:(null==(a=L[q])?void 0:a.tasks.map(e=>e.id))||[],onChange:e=>{const t=e.target.value;R(e=>{const n=[...e];if(q>=0&&q<n.length){const e=t.map(e=>{const t=X.find(t=>t.id===e);return{id:e,name:(null==t?void 0:t.name)||"Task "+e,agent_id:(null==t?void 0:t.agent_id)||"",description:"",expected_output:"",context:(null==t?void 0:t.context)||[]}});n[q]=Object.assign({},n[q],{tasks:e})}return n});const n=[],a=new Map;L.forEach(e=>{a.set(e.id,e)}),L.forEach((e,a)=>{(a===q?t.map(e=>{const t=X.find(t=>t.id===e);return{id:e,name:(null==t?void 0:t.name)||"Task "+e,agent_id:(null==t?void 0:t.agent_id)||"",description:"",expected_output:"",context:(null==t?void 0:t.context)||[]}}):e.tasks).forEach(t=>{let a=e.crewId,s=e.crewName;if(t.agent_id){const e=$.find(e=>String(e.id)===t.agent_id);e&&(a=String(e.id),s=e.name)}const i="action-"+e.id+"-"+t.id;n.push({id:i,crewId:a,crewName:s,taskId:t.id,taskName:t.name||"Task "+t.id})})}),G(n)},label:"Tasks To Execute",renderValue:e=>(0,W.jsx)(i.A,{sx:{display:"flex",flexWrap:"wrap",gap:.5},children:e.map(e=>{const t=X.find(t=>t.id===e),n=$.find(e=>e.id.toString()===(null==t?void 0:t.agent_id));return(0,W.jsx)(V.A,{label:((null==n?void 0:n.name)||(null!=t&&t.agent_id?"Crew "+(null==t?void 0:t.agent_id):"System"))+":"+((null==t?void 0:t.name)||"Task "+e)},e)})}),children:X.filter(e=>!String(e.id).startsWith("agent-")).map(e=>{var t;const n=$.find(t=>String(t.id)===e.agent_id);return(0,W.jsxs)(de.A,{value:e.id,children:[(0,W.jsx)(Kt.A,{checked:((null==(t=L[q])?void 0:t.tasks.map(e=>e.id))||[]).includes(e.id)}),(0,W.jsx)(ot.A,{primary:((null==n?void 0:n.name)||(null!=e&&e.agent_id?"Crew "+(null==e?void 0:e.agent_id):"System"))+":"+e.name,secondary:"ID: "+e.id+" (Task)"})]},e.id)})})]}),(0,W.jsx)(ne.A,{sx:{my:3}}),(0,W.jsx)(c.A,{variant:"subtitle2",gutterBottom:!0,children:"State Configuration"}),(0,W.jsxs)(re.A,{fullWidth:!0,margin:"normal",children:[(0,W.jsx)(le.A,{id:"state-type-label",children:"State Type"}),(0,W.jsxs)(ce.A,{labelId:"state-type-label",value:(null==(m=L[q])||null==(m=m.state)?void 0:m.stateType)||"unstructured",onChange:e=>{if(q<0)return;const t=e.target.value;R(e=>{const n=[...e];return n[q]=Object.assign({},n[q],{state:Object.assign({},n[q].state,{stateType:t})}),n})},label:"State Type",children:[(0,W.jsx)(de.A,{value:"unstructured",children:(0,W.jsx)(ot.A,{primary:"Unstructured",secondary:"Free-form text state"})}),(0,W.jsx)(de.A,{value:"structured",children:(0,W.jsx)(ot.A,{primary:"Structured",secondary:"JSON-formatted state"})})]})]}),(0,W.jsx)(U.A,{label:"State Definition",fullWidth:!0,multiline:!0,rows:4,margin:"normal",value:(null==(p=L[q])||null==(p=p.state)?void 0:p.stateDefinition)||"",onChange:e=>{if(q<0)return;const t=e.target.value;R(e=>{const n=[...e];return n[q]=Object.assign({},n[q],{state:Object.assign({},n[q].state,{stateDefinition:t})}),n})},placeholder:"structured"===(null==(x=L[q])||null==(x=x.state)?void 0:x.stateType)?'{"key": "value"}':"Enter state description here...",InputProps:{sx:{fontFamily:"monospace"}}})]}):(0,W.jsx)(_e.A,{variant:"outlined",sx:{width:"70%",p:2,height:"100%",display:"flex",alignItems:"center",justifyContent:"center"},children:(0,W.jsx)(c.A,{color:"text.secondary",children:"Select a listener from the list or add a new one"})})]})]}),(0,W.jsxs)($n,{value:A,index:3,children:[(0,W.jsx)(c.A,{variant:"body2",color:"text.secondary",paragraph:!0,children:"Configure starting points for your flow. Starting points are specific tasks that will trigger the workflow execution."}),(0,W.jsx)(g.A,{variant:"outlined",size:"small",sx:{mb:2},onClick:async()=>{await ue()},children:"Refresh Tasks"}),0===F.length?(0,W.jsx)(c.A,{variant:"body1",align:"center",sx:{my:4},children:"No tasks available to set as starting points"}):(0,W.jsxs)(_e.A,{variant:"outlined",sx:{p:2},children:[(0,W.jsxs)(i.A,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2},children:[(0,W.jsx)(c.A,{variant:"subtitle2",color:"primary",children:"Select tasks to serve as starting points"}),(0,W.jsx)(i.A,{children:(0,W.jsxs)(c.A,{variant:"caption",sx:{ml:1},children:[F.length," total tasks across ",Array.from(new Set(F.map(e=>e.crewName))).length," crews"]})})]}),(0,W.jsx)(U.A,{placeholder:"Search tasks...",size:"small",fullWidth:!0,sx:{mb:2},InputProps:{startAdornment:(0,W.jsx)(ae.A,{position:"start",children:(0,W.jsx)(Ee.A,{fontSize:"small"})})},onChange:e=>{const t=e.target.value.toLowerCase();document.querySelectorAll("[data-task-item]").forEach(e=>{var n,a;const s=e,i=(null==(n=s.getAttribute("data-task-name"))?void 0:n.toLowerCase())||"",o=(null==(a=s.getAttribute("data-crew-name"))?void 0:a.toLowerCase())||"";i.includes(t)||o.includes(t)?s.style.display="":s.style.display="none"})}}),(0,W.jsxs)(i.A,{sx:{display:"flex",mb:2},children:[(0,W.jsxs)(c.A,{variant:"caption",color:"text.secondary",sx:{mr:2},children:["Total: ",F.length," tasks"]}),(0,W.jsxs)(c.A,{variant:"caption",color:"success.main",sx:{mr:2},children:["Selected: ",F.filter(e=>e.isStartPoint).length," tasks"]})]}),(0,W.jsx)(at.A,{children:Array.from(new Set(F.map(e=>e.crewName))).sort((e,t)=>e.localeCompare(t)).map(e=>{const t=F.filter(t=>t.crewName===e).sort((e,t)=>e.taskName.localeCompare(t.taskName));return(0,W.jsxs)(i.A,{sx:{mb:2},children:[(0,W.jsxs)(c.A,{variant:"subtitle2",sx:{bgcolor:"primary.light",color:"primary.contrastText",px:2,py:1,borderRadius:"4px 4px 0 0"},children:[e," (",t.length," tasks)"]}),(0,W.jsx)(_e.A,{variant:"outlined",sx:{borderRadius:"0 0 4px 4px",mt:"-1px"},children:t.map(e=>(0,W.jsx)(st.Ay,{sx:{borderBottom:"1px solid",borderColor:"divider",py:1},"data-task-item":"true","data-task-name":e.taskName,"data-crew-name":e.crewName,secondaryAction:(0,W.jsx)(Kt.A,{edge:"end",checked:!!e.isStartPoint,onChange:()=>{return t=e.taskId,void B(e=>e.map(e=>e.taskId===t?Object.assign({},e,{isStartPoint:!e.isStartPoint}):e));var t},inputProps:{"aria-labelledby":"task-"+e.taskId}}),children:(0,W.jsx)(ot.A,{id:"task-"+e.taskId,primary:(0,W.jsxs)(i.A,{sx:{display:"flex",alignItems:"center"},children:[(0,W.jsx)(Xn.A,{fontSize:"small",sx:{mr:1,color:e.isStartPoint?"success.main":"text.disabled"}}),(0,W.jsx)(c.A,{variant:"body1",sx:{fontWeight:e.isStartPoint?500:400},children:e.taskName})]}),secondary:"ID: "+e.taskId})},e.taskId))})]},e)})})]})]})]}):(0,W.jsx)(c.A,{sx:{textAlign:"center",py:4},children:"No flow selected"})}),(0,W.jsx)(H.A,{sx:{p:2,borderTop:"1px solid",borderColor:"divider"},children:(0,W.jsxs)(i.A,{sx:{display:"flex",justifyContent:"space-between",width:"100%",alignItems:"center"},children:[(0,W.jsx)(i.A,{children:O&&(0,W.jsx)(c.A,{color:"error",variant:"body2",children:O})}),(0,W.jsxs)(i.A,{sx:{display:"flex",gap:1},children:[(0,W.jsx)(g.A,{onClick:y,color:"inherit",disabled:T,children:"Cancel"}),(0,W.jsx)(g.A,{onClick:async()=>{try{var e;D(!0),P(null);const t={id:(null==k||null==(e=k.flowConfig)?void 0:e.id)||"flow-"+Date.now(),name:S,type:"default",listeners:L.map(e=>Object.assign({id:e.id,name:e.name||"Listener "+e.id,crewId:e.crewId,crewName:e.crewName,tasks:e.tasks||[],listenToTaskIds:e.listenToTaskIds||[],listenToTaskNames:e.listenToTaskNames||[],conditionType:e.conditionType||"NONE",state:e.state},"ROUTER"===e.conditionType&&e.routerConfig?{routerConfig:e.routerConfig}:{})),actions:K,startingPoints:F.filter(e=>e.isStartPoint)},n=null!=k&&k.nodes?Qn(k.nodes):[],a={name:S,crew_id:(null==k?void 0:k.crew_id)||"",nodes:n,edges:(null==k?void 0:k.edges)||[],flowConfig:t};let s;if(b){const e=b.toString();s=await Ft.updateFlow(e,a)}else s=await Ft.saveFlow(a);z(!0),v(),setTimeout(()=>{y()},1e3)}catch(O){P(O instanceof Error?O.message:"An unknown error occurred while saving the flow.")}finally{D(!1)}},variant:"contained",color:"primary",disabled:T||!k||!S.trim(),children:T?(0,W.jsx)(Y.A,{size:24}):"Save"})]})]})})]}),(0,W.jsx)(u.A,{open:M,autoHideDuration:6e3,onClose:()=>z(!1),children:(0,W.jsx)(h.A,{onClose:()=>z(!1),severity:"success",sx:{width:"100%"},children:"Flow updated successfully!"})})]})};var ta=n(18844),na=n(12406),aa=n(57357);const sa=["children","value","index"];function ia(e){const{children:t,value:n,index:s}=e,o=(0,a.A)(e,sa);return(0,W.jsx)("div",Object.assign({role:"tabpanel",hidden:n!==s,id:"dialog-tabpanel-"+s,"aria-labelledby":"dialog-tab-"+s},o,{children:n===s&&(0,W.jsx)(i.A,{sx:{pt:2},children:t})}))}const oa=e=>{let{open:t,onClose:n,onCrewSelect:a,onFlowSelect:u,onAgentSelect:m,onTaskSelect:p,initialTab:x=0,showOnlyTab:f}=e;const[y,b]=(0,s.useState)(x);(0,s.useEffect)(()=>{b(void 0!==f?f:x)},[f,x]);const[v,A]=(0,s.useState)([]),[j,w]=(0,s.useState)([]),[k,S]=(0,s.useState)([]),[_,E]=(0,s.useState)([]),[I,T]=(0,s.useState)([]),[D,O]=(0,s.useState)([]),[P,z]=(0,s.useState)(!1),[L,R]=(0,s.useState)(null),[F,B]=(0,s.useState)(null),V=(0,s.useRef)(null),[K,G]=(0,s.useState)("");(0,s.useEffect)(()=>{t||G("")},[t]);const[q,J]=(0,s.useState)(!1),[$,ee]=(0,s.useState)(null),[se,ie]=(0,s.useState)(0),oe=(0,s.useRef)(null),re=(0,s.useRef)(null),le=(0,s.useRef)(null),ce=(0,s.useRef)(null),{crewAIFlowEnabled:de}=(0,C.d)(),he=(0,s.useRef)(null),me=(0,s.useRef)(null);(0,s.useEffect)(()=>{t&&(0===y?ge():1===y?xe():2===y?ye():3===y&&de&&pe())},[t,y,de]),(0,s.useEffect)(()=>{t||(T([]),O([]))},[t]),(0,s.useEffect)(()=>{de||3!==y||b(0)},[de,y]);const ge=async()=>{z(!0);try{const e=await Re.getCrews();A(e),R(null)}catch(L){R("Failed to load crews")}finally{z(!1)}},pe=async()=>{z(!0);try{const e=await Ft.getFlows();w(e),R(null)}catch(L){R("Failed to load flows")}finally{z(!1)}},xe=async()=>{z(!0);try{const e=await fe.AgentService.listAgents();S(e),R(null)}catch(L){R("Failed to load agents")}finally{z(!1)}},ye=async()=>{z(!0);try{const e=await Fe.TaskService.listTasks();E(e),R(null)}catch(L){R("Failed to load tasks")}finally{z(!1)}},be=async e=>{z(!0),window.dispatchEvent(new CustomEvent("crewLoadStarted"));try{const k=await Re.getCrew(e);if(!k)throw new Error("Crew not found");const C={};for(const e of k.nodes||[])if("agentNode"===e.type)try{var t,s,i,o;const n=e.data,a={name:n.name||n.label||"",role:n.role||"",goal:n.goal||"",backstory:n.backstory||"",llm:n.llm||"databricks-llama-4-maverick",tools:n.tools||[],function_calling_llm:n.function_calling_llm,max_iter:n.max_iter||25,max_rpm:n.max_rpm,max_execution_time:n.max_execution_time||300,memory:null==(t=n.memory)||t,verbose:n.verbose||!1,allow_delegation:n.allow_delegation||!1,cache:null==(s=n.cache)||s,system_template:n.system_template,prompt_template:n.prompt_template,response_template:n.response_template,allow_code_execution:n.allow_code_execution||!1,code_execution_mode:n.code_execution_mode||"safe",max_retry_limit:n.max_retry_limit||3,use_system_prompt:null==(i=n.use_system_prompt)||i,respect_context_window:null==(o=n.respect_context_window)||o,embedder_config:n.embedder_config,knowledge_sources:n.knowledge_sources||[]},r=await fe.AgentService.createAgent(a);if(!r||!r.id)throw new Error("Failed to create agent: "+a.name);C[e.id]=r.id.toString()}catch(w){throw new Error("Failed to create agent: "+w.message)}for(const e of k.nodes||[])if("taskNode"===e.type)try{var r,l,c,d,u,h,m,g,p,x,f,y,b,v,A,j;const t=e.data,n=t.agent_id&&C[t.agent_id]?parseInt(C[t.agent_id]):0,a={name:String(t.label||""),description:String(t.description||""),expected_output:String(t.expected_output||""),tools:(t.tools||[]).map(e=>String(e)),agent_id:n?String(n):null,async_execution:Boolean(t.async_execution),context:(t.context||[]).map(e=>String(e)),config:{cache_response:Boolean(null==(r=t.config)?void 0:r.cache_response),cache_ttl:Number((null==(l=t.config)?void 0:l.cache_ttl)||3600),retry_on_fail:Boolean(null==(c=t.config)?void 0:c.retry_on_fail),max_retries:Number((null==(d=t.config)?void 0:d.max_retries)||3),timeout:null!=(u=t.config)&&u.timeout?Number(t.config.timeout):null,priority:Number((null==(h=t.config)?void 0:h.priority)||1),error_handling:(null==(m=t.config)?void 0:m.error_handling)||"default",output_file:(null==(g=t.config)?void 0:g.output_file)||null,output_json:(null==(p=t.config)?void 0:p.output_json)||null,output_pydantic:(null==(x=t.config)?void 0:x.output_pydantic)||null,callback:(null==(f=t.config)?void 0:f.callback)||null,human_input:Boolean(null==(y=t.config)?void 0:y.human_input),condition:"is_data_missing"===(null==(b=t.config)?void 0:b.condition)?"is_data_missing":void 0,guardrail:(null==(v=t.config)?void 0:v.guardrail)||null,markdown:!0===(null==(A=t.config)?void 0:A.markdown)||"true"===(null==(j=t.config)?void 0:j.markdown)||!0===t.markdown||"true"===t.markdown}},s=await Fe.TaskService.createTask(a);if(!s||!s.id)throw new Error("Failed to create task: "+a.name);C[e.id]=s.id.toString()}catch(w){throw new Error("Failed to create task: "+w.message)}const S=(k.nodes||[]).map(e=>{const t="agentNode"===e.type?"agent-"+(C[e.id]||e.id):"task-"+(C[e.id]||e.id);return Object.assign({},e,{id:t,type:e.type,data:Object.assign({},e.data,{id:C[e.id]||e.data.id,agent_id:e.data.agent_id&&C[e.data.agent_id]||e.data.agent_id,agentId:"agentNode"===e.type&&C[e.id]||e.data.agentId,taskId:"taskNode"===e.type&&C[e.id]||e.data.taskId,type:"agentNode"===e.type?"agent":"task"})})}),_=(k.edges||[]).map(e=>{var t,n;const a=null==k||null==(t=k.nodes)?void 0:t.find(t=>t.id===e.source),s=null==k||null==(n=k.nodes)?void 0:n.find(t=>t.id===e.target);return Object.assign({},e,{source:"agentNode"===(null==a?void 0:a.type)?"agent-"+(C[e.source]||e.source):"task-"+(C[e.source]||e.source),target:"agentNode"===(null==s?void 0:s.type)?"agent-"+(C[e.target]||e.target):"task-"+(C[e.target]||e.target)})});a(S,_,k.name,k.id.toString()),n(),setTimeout(()=>{if("undefined"!==typeof window){const e=new CustomEvent("fitViewToNodes",{bubbles:!0});window.dispatchEvent(e)}},100)}catch(w){R(w.message||"Failed to load crew")}finally{z(!1)}},ve=async e=>{try{z(!0),R(null);const t=await Ft.getFlow(e);if(!t)throw new Error("Failed to load flow data from server");if(!Array.isArray(t.nodes)||!Array.isArray(t.edges))throw new Error("Invalid flow data structure");let a=t.flowConfig;if(!a&&t.nodes.some(e=>{var t;return null==(t=e.data)?void 0:t.listener})){const e=t.nodes.filter(e=>{var t;return null==(t=e.data)?void 0:t.listener}).map(e=>({id:"listener-"+e.id,name:e.data.label||"Listener "+e.id,crewId:String(e.data.crewRef||""),crewName:e.data.crewName||e.data.label||"Unknown",tasks:e.data.listener.tasks||[],listenToTaskIds:e.data.listener.listenToTaskIds||[],listenToTaskNames:e.data.listener.listenToTaskNames||[],conditionType:e.data.listener.conditionType||"NONE",state:e.data.listener.state||{stateType:"unstructured",stateDefinition:"",stateData:{}}}));a={id:"flow-"+Date.now(),name:t.name,listeners:e,actions:[],startingPoints:[]}}a&&(a={id:a.id||"flow-"+Date.now(),name:a.name||t.name,listeners:a.listeners||[],actions:a.actions||[],startingPoints:a.startingPoints||[]}),u(t.nodes,t.edges,a),n(),setTimeout(()=>{if("undefined"!==typeof window){const e=new CustomEvent("fitViewToNodes",{bubbles:!0});window.dispatchEvent(e)}},100)}catch(t){R(t.message||"Failed to load flow")}finally{z(!1)}},Ae=(e,t,n,a)=>{let s;switch(n){case"crew":s=v;break;case"flow":s=j;break;case"agent":s=k;break;case"task":s=_;break;default:s=[]}if("Enter"===e.key||" "===e.key)e.preventDefault(),"crew"===n?be(t):ve(t.toString());else if("ArrowRight"===e.key){e.preventDefault();const t=(a+1)%s.length,i=document.querySelector('[data-card-index="'+n+"-"+t+'"]');i&&i.focus()}else if("ArrowLeft"===e.key){e.preventDefault();const t=(a-1+s.length)%s.length,i=document.querySelector('[data-card-index="'+n+"-"+t+'"]');i&&i.focus()}else if("ArrowDown"===e.key||"ArrowUp"===e.key){e.preventDefault();const t=window.innerWidth;let i=1;t>=960?i=3:t>=600&&(i=2);const o=Math.floor(a/i),r=a%i;let l;if("ArrowDown"===e.key){l=(o+1)*i+r,l>=s.length&&(l=r)}else{const e=o-1;if(e<0){l=Math.floor((s.length-1)/i)*i+r,l>=s.length&&(l=s.length-1)}else l=e*i+r}if(l>=0&&l<s.length){const e=document.querySelector('[data-card-index="'+n+"-"+l+'"]');e&&e.focus()}}};return(0,W.jsxs)(W.Fragment,{children:[(0,W.jsxs)(o.A,{open:t,onClose:n,maxWidth:"md",fullWidth:!0,TransitionProps:{onEntered:()=>{setTimeout(()=>{V.current&&V.current.focus()},150)}},PaperProps:{component:"div",role:"dialog",tabIndex:-1},children:[(0,W.jsxs)(l.A,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,W.jsx)(i.A,{children:0===f?"Load Existing Plans":1===f?"Load Existing Agents":2===f?"Load Existing Tasks":3===f?"Load Existing Flows":"Open Catalog"}),(0,W.jsx)(d.A,{onClick:n,children:(0,W.jsx)(N.A,{})})]}),(0,W.jsxs)(r.A,{onKeyDown:e=>{document.activeElement instanceof HTMLInputElement||document.activeElement instanceof HTMLTextAreaElement||("/"===e.key&&V.current&&(e.preventDefault(),V.current.focus()),"f"===e.key&&(e.preventDefault(),0===y&&oe.current?oe.current.focus():1===y&&le.current?le.current.focus():2===y&&ce.current?ce.current.focus():3===y&&re.current&&re.current.focus()))},"data-tour":"catalog-dialog",children:[L&&(0,W.jsx)(h.A,{severity:"error",sx:{mb:2},children:L}),F&&(0,W.jsx)(h.A,{severity:"success",sx:{mb:2},children:F}),(0,W.jsxs)(i.A,{sx:{width:"100%"},children:[void 0===f?(0,W.jsxs)(i.A,{sx:{borderBottom:1,borderColor:"divider",display:"flex",alignItems:"center",justifyContent:"space-between",gap:2},children:[(0,W.jsxs)(Hn.A,{value:y,onChange:(e,t)=>{(3!==t||de)&&void 0===f&&(b(t),G(""))},"aria-label":"catalog tabs",children:[(0,W.jsx)(Kn.A,{icon:(0,W.jsx)(X.A,{}),iconPosition:"start",label:"Plans",id:"plan-tab-0","aria-controls":"tabpanel-0",sx:{textTransform:"none"}}),(0,W.jsx)(Kn.A,{icon:(0,W.jsx)(ta.A,{}),iconPosition:"start",label:"Agents",id:"agent-tab-1","aria-controls":"tabpanel-1",sx:{textTransform:"none"}}),(0,W.jsx)(Kn.A,{icon:(0,W.jsx)(na.A,{}),iconPosition:"start",label:"Tasks",id:"task-tab-2","aria-controls":"tabpanel-2",sx:{textTransform:"none"}}),de&&(0,W.jsx)(Kn.A,{icon:(0,W.jsx)(qn.A,{}),iconPosition:"start",label:"Flows",id:"flow-tab-3","aria-controls":"tabpanel-3",sx:{textTransform:"none"}})]}),(0,W.jsxs)(i.A,{sx:{display:"flex",gap:1},children:[(0,W.jsx)(g.A,{startIcon:(0,W.jsx)(Yn.A,{}),variant:"outlined",size:"small",onClick:()=>{me.current&&me.current.click()},children:"Import"}),(0,W.jsx)(g.A,{startIcon:(0,W.jsx)(Gn.A,{}),variant:"outlined",size:"small",onClick:async()=>{try{z(!0),R(null);const e=await Re.getCrews(),t=await Ft.getFlows(),n=await fe.AgentService.listAgents(),a={crews:e,flows:t,agents:n,tasks:await Fe.TaskService.listTasks(),exportDate:(new Date).toISOString()},s=new Blob([JSON.stringify(a,null,2)],{type:"application/json"}),i=URL.createObjectURL(s),o=document.createElement("a");o.href=i,o.download="complete_export_"+(new Date).toISOString().slice(0,10)+".json",document.body.appendChild(o),o.click(),document.body.removeChild(o),URL.revokeObjectURL(i)}catch(L){R("Failed to export all data")}finally{z(!1)}},disabled:0===v.length&&0===j.length&&0===k.length&&0===_.length,children:"Export"})]})]}):null,(0,W.jsxs)(i.A,{sx:{py:1,display:"flex",justifyContent:"space-between"},children:[(0,W.jsx)(i.A,{sx:{flex:1},children:(0,W.jsx)(U.A,{placeholder:"Search...",size:"small",fullWidth:!0,value:K,onChange:e=>G(e.target.value),inputRef:V,autoComplete:"off",onKeyDown:e=>{"Tab"!==e.key||e.shiftKey?"Escape"===e.key&&G(""):(e.preventDefault(),0===y&&oe.current?oe.current.focus():1===y&&le.current?le.current.focus():2===y&&ce.current?ce.current.focus():3===y&&re.current&&re.current.focus())},InputProps:{startAdornment:(0,W.jsx)(ae.A,{position:"start",children:(0,W.jsx)(Ee.A,{fontSize:"small"})})}})}),void 0===f&&(0,W.jsx)(i.A,{sx:{ml:2,display:"flex",gap:1},children:3===y?(0,W.jsxs)(W.Fragment,{children:[(0,W.jsx)(g.A,{startIcon:(0,W.jsx)(Jn.A,{}),variant:"outlined",size:"small",onClick:()=>{he.current&&he.current.click()},children:"Import"}),(0,W.jsx)(g.A,{startIcon:(0,W.jsx)(Gn.A,{}),variant:"outlined",size:"small",onClick:async()=>{try{z(!0),R(null);const e={flows:await Ft.getFlows(),exportDate:(new Date).toISOString()},t=new Blob([JSON.stringify(e,null,2)],{type:"application/json"}),n=URL.createObjectURL(t),a=document.createElement("a");a.href=n,a.download="all_flows_export_"+(new Date).toISOString().slice(0,10)+".json",document.body.appendChild(a),a.click(),document.body.removeChild(a),URL.revokeObjectURL(n)}catch(L){R("Failed to export all flows")}finally{z(!1)}},disabled:0===j.length,children:"Export Flows"})]}):null})]}),(void 0===f||0===f)&&(0,W.jsxs)(ia,{value:y,index:0,children:[void 0===f&&(0,W.jsx)(h.A,{severity:"info",sx:{mb:2},children:"Loading a plan will open it in a new tab"}),P?(0,W.jsx)(i.A,{sx:{display:"flex",justifyContent:"center",p:4},children:(0,W.jsx)(Y.A,{})}):0===v.length?(0,W.jsx)(h.A,{severity:"info",children:"No plans found. Create a plan by adding agents and tasks, then click Save Plan."}):(0,W.jsx)(ue.Ay,{container:!0,spacing:2,children:v.filter(e=>!(!de&&(e=>{var t;return(null==(t=e.nodes)?void 0:t.some(e=>"flowNode"===e.type))||!1})(e))&&(!K||e.name.toLowerCase().includes(K.toLowerCase()))).map((e,t)=>(0,W.jsx)(ue.Ay,{item:!0,xs:12,sm:6,md:4,children:(0,W.jsx)(te.A,{sx:{height:"100%",cursor:"pointer","&:hover":{boxShadow:3,bgcolor:"action.hover"},"&:focus":{outline:"2px solid",outlineColor:"primary.main",boxShadow:6,bgcolor:"action.hover"},opacity:1,filter:"none",transition:"all 0.2s"},onClick:()=>be(e.id),onKeyDown:n=>Ae(n,e.id,"crew",t),tabIndex:0,ref:0===t?oe:void 0,"data-card-index":"crew-"+t,children:(0,W.jsxs)(Qt.A,{children:[(0,W.jsxs)(i.A,{sx:{display:"flex",justifyContent:"space-between",alignItems:"flex-start"},children:[(0,W.jsx)(c.A,{variant:"h6",component:"h2",gutterBottom:!0,noWrap:!0,children:e.name}),(0,W.jsxs)(i.A,{children:[(0,W.jsx)(M.A,{title:"Export Plan",children:(0,W.jsx)(d.A,{size:"small",onClick:t=>(async(e,t)=>{e.stopPropagation();try{const e=JSON.stringify(t,null,2),n=new Blob([e],{type:"application/json"}),a=URL.createObjectURL(n),s=document.createElement("a");s.href=a,s.download="crew_"+t.name.replace(/\s+/g,"_").toLowerCase()+".json",document.body.appendChild(s),s.click(),document.body.removeChild(s),URL.revokeObjectURL(a)}catch(L){R("Failed to export crew")}})(t,e),children:(0,W.jsx)(Gn.A,{fontSize:"small"})})}),(0,W.jsx)(M.A,{title:"Delete Plan",children:(0,W.jsx)(d.A,{size:"small",onClick:t=>(async(e,t)=>{e.stopPropagation();try{await Re.deleteCrew(t),ge()}catch(L){R("Failed to delete crew")}})(t,e.id),children:(0,W.jsx)(Q.A,{fontSize:"small"})})})]})]}),(0,W.jsx)(c.A,{variant:"body2",color:"text.secondary",sx:{mb:1},children:"No description"}),(0,W.jsxs)(c.A,{variant:"caption",color:"text.secondary",display:"block",children:["Created: ",new Date(e.created_at).toLocaleString()]}),(0,W.jsxs)(c.A,{variant:"caption",color:"text.secondary",display:"block",children:["Agents: ",(t=>{const n=(null==(t=e.nodes)?void 0:t.filter(e=>"agent"===e.type||"agentNode"===e.type||e.data&&("agent"===e.data.type||e.data.agentId||e.data.agentRef)||"string"===typeof e.id&&(e.id.startsWith("agent-")||e.id.startsWith("agent:"))).length)||0,a=e.agents&&Array.isArray(e.agents)?e.agents.length:0,s=e.agent_ids&&Array.isArray(e.agent_ids)?e.agent_ids.length:0;return Math.max(n,a,s)})()," / Tasks: ",(t=>{const n=(null==(t=e.nodes)?void 0:t.filter(e=>"task"===e.type||"taskNode"===e.type||e.data&&("task"===e.data.type||e.data.taskId||e.data.taskRef)||"string"===typeof e.id&&(e.id.includes("task")||e.id.includes("Task"))).length)||0,a=e.tasks&&Array.isArray(e.tasks)?e.tasks.length:0,s=e.task_ids&&Array.isArray(e.task_ids)?e.task_ids.length:0;return Math.max(n,a,s)})()]})]})})},e.id))})]}),(void 0===f||1===f)&&(0,W.jsxs)(ia,{value:y,index:1,children:[void 0===f&&(0,W.jsx)(h.A,{severity:"info",sx:{mb:2},children:"Loading agents will add them to the current tab"}),(0,W.jsxs)(i.A,{sx:{mb:2,display:"flex",gap:1,flexWrap:"wrap"},children:[(0,W.jsx)(g.A,{variant:"outlined",onClick:()=>{I.length===k.length?T([]):T([...k])},children:I.length===k.length?"Deselect All":"Select All"}),(0,W.jsxs)(g.A,{variant:"contained",onClick:()=>{m&&(m(I),T([]),n())},disabled:0===I.length,children:["Place Agents (",I.length,")"]}),(0,W.jsx)(g.A,{variant:"outlined",color:"error",onClick:async()=>{if(window.confirm("Are you sure you want to delete ALL agents? This action cannot be undone."))try{z(!0),R(null);for(const e of k)e.id&&await fe.AgentService.deleteAgent(e.id);S([]),T([]),await xe()}catch(e){R("Failed to delete all agents"),await xe()}finally{z(!1)}},disabled:0===k.length||P,startIcon:(0,W.jsx)(Q.A,{}),children:"Delete All"})]}),(0,W.jsx)(ne.A,{sx:{my:2}}),P?(0,W.jsx)(i.A,{sx:{display:"flex",justifyContent:"center",p:4},children:(0,W.jsx)(Y.A,{})}):0===k.length?(0,W.jsx)(h.A,{severity:"info",children:"No agents found. Create agents to use in your crews."}):(0,W.jsx)(at.A,{sx:{maxHeight:"50vh",overflow:"auto"},children:k.filter(e=>!K||(e.name.toLowerCase().includes(K.toLowerCase())||e.role.toLowerCase().includes(K.toLowerCase()))).map(e=>(0,W.jsxs)(aa.A,{onClick:()=>(e=>{T(t=>t.some(t=>t.id===e.id)?t.filter(t=>t.id!==e.id):[...t,e])})(e),selected:I.some(t=>t.id===e.id),children:[(0,W.jsx)(it.A,{children:(0,W.jsx)(ta.A,{})}),(0,W.jsx)(ot.A,{primary:e.name,secondary:e.role+" - LLM: "+e.llm}),(0,W.jsx)(M.A,{title:"Delete Agent",children:(0,W.jsx)(d.A,{onClick:t=>(async(e,t)=>{e.stopPropagation();try{z(!0),await fe.AgentService.deleteAgent(t)&&(await xe(),T(e=>e.filter(e=>e.id!==t)))}catch(L){R("Failed to delete agent")}finally{z(!1)}})(t,e.id||""),disabled:P,children:(0,W.jsx)(Q.A,{})})})]},e.id))})]}),(void 0===f||2===f)&&(0,W.jsxs)(ia,{value:y,index:2,children:[void 0===f&&(0,W.jsx)(h.A,{severity:"info",sx:{mb:2},children:"Loading tasks will add them to the current tab"}),(0,W.jsxs)(i.A,{sx:{mb:2,display:"flex",gap:1,flexWrap:"wrap"},children:[(0,W.jsx)(g.A,{variant:"outlined",onClick:()=>{D.length===_.length?O([]):O([..._])},children:D.length===_.length?"Deselect All":"Select All"}),(0,W.jsxs)(g.A,{variant:"contained",onClick:()=>{p&&(p(D),O([]),n())},disabled:0===D.length,children:["Place Tasks (",D.length,")"]}),(0,W.jsx)(g.A,{variant:"outlined",color:"error",onClick:async()=>{if(window.confirm("Are you sure you want to delete ALL tasks? This action cannot be undone."))try{z(!0),R(null);for(const e of _)e.id&&await Fe.TaskService.deleteTask(e.id);E([]),O([]),await ye()}catch(e){R("Failed to delete all tasks"),await ye()}finally{z(!1)}},disabled:0===_.length||P,startIcon:(0,W.jsx)(Q.A,{}),children:"Delete All"})]}),(0,W.jsx)(ne.A,{sx:{my:2}}),P?(0,W.jsx)(i.A,{sx:{display:"flex",justifyContent:"center",p:4},children:(0,W.jsx)(Y.A,{})}):0===_.length?(0,W.jsx)(h.A,{severity:"info",children:"No tasks found. Create tasks to use in your crews."}):(0,W.jsx)(at.A,{sx:{maxHeight:"50vh",overflow:"auto"},children:_.filter(e=>!K||(e.name.toLowerCase().includes(K.toLowerCase())||e.description.toLowerCase().includes(K.toLowerCase()))).map(e=>(0,W.jsxs)(aa.A,{onClick:()=>(e=>{O(t=>t.some(t=>t.id===e.id)?t.filter(t=>t.id!==e.id):[...t,e])})(e),selected:D.some(t=>t.id===e.id),children:[(0,W.jsx)(it.A,{children:(0,W.jsx)(na.A,{})}),(0,W.jsx)(ot.A,{primary:e.name,secondary:e.description}),(0,W.jsx)(M.A,{title:"Delete Task",children:(0,W.jsx)(d.A,{onClick:t=>(async(e,t)=>{e.stopPropagation();try{z(!0),await Fe.TaskService.deleteTask(t),await ye(),O(e=>e.filter(e=>e.id!==t))}catch(L){R("Failed to delete task")}finally{z(!1)}})(t,e.id),disabled:P,children:(0,W.jsx)(Q.A,{})})})]},e.id))})]}),de&&(void 0===f||3===f)&&(0,W.jsx)(ia,{value:y,index:3,children:P?(0,W.jsx)(i.A,{sx:{display:"flex",justifyContent:"center",p:4},children:(0,W.jsx)(Y.A,{})}):0===j.length?(0,W.jsx)(h.A,{severity:"info",children:"No flows found. Create a flow by adding flow components, then save it."}):(0,W.jsx)(ue.Ay,{container:!0,spacing:2,children:j.filter(e=>""===K||e.name.toLowerCase().includes(K.toLowerCase())).map((e,t)=>{var n,a;return(0,W.jsx)(ue.Ay,{item:!0,xs:12,sm:6,md:4,children:(0,W.jsx)(te.A,{sx:{height:"100%",cursor:"pointer","&:hover":{boxShadow:3,bgcolor:"action.hover"},"&:focus":{outline:"2px solid",outlineColor:"primary.main",boxShadow:6,bgcolor:"action.hover"},opacity:1,filter:"none",transition:"all 0.2s"},onClick:()=>ve(e.id.toString()),onKeyDown:n=>Ae(n,e.id,"flow",t),tabIndex:0,ref:0===t?re:void 0,"data-card-index":"flow-"+t,children:(0,W.jsxs)(Qt.A,{children:[(0,W.jsxs)(i.A,{sx:{display:"flex",justifyContent:"space-between",alignItems:"flex-start"},children:[(0,W.jsx)(c.A,{variant:"h6",component:"h2",gutterBottom:!0,noWrap:!0,children:e.name}),(0,W.jsxs)(i.A,{children:[(0,W.jsx)(M.A,{title:"Edit Flow",children:(0,W.jsx)(d.A,{size:"small",onClick:t=>(async(e,t)=>{e.stopPropagation();try{ee(t),J(!0)}catch(L){R("Failed to edit flow")}})(t,e.id.toString()),children:(0,W.jsx)(Z.A,{fontSize:"small"})})}),(0,W.jsx)(M.A,{title:"Export Flow",children:(0,W.jsx)(d.A,{size:"small",onClick:t=>(async(e,t)=>{e.stopPropagation();try{const e=JSON.stringify(t,null,2),n=new Blob([e],{type:"application/json"}),a=URL.createObjectURL(n),s=document.createElement("a");s.href=a,s.download="flow_"+t.name.replace(/\s+/g,"_").toLowerCase()+".json",document.body.appendChild(s),s.click(),document.body.removeChild(s),URL.revokeObjectURL(a)}catch(L){R("Failed to export flow")}})(t,e),children:(0,W.jsx)(Gn.A,{fontSize:"small"})})}),(0,W.jsx)(M.A,{title:"Delete Flow",children:(0,W.jsx)(d.A,{size:"small",onClick:t=>(async(e,t)=>{e.stopPropagation();try{z(!0),await Ft.deleteFlow(t),pe()}catch(L){R("Failed to delete flow")}finally{z(!1)}})(t,e.id.toString()),children:(0,W.jsx)(Q.A,{fontSize:"small"})})})]})]}),(0,W.jsx)(c.A,{variant:"body2",color:"text.secondary",sx:{mb:1},children:"No description"}),(0,W.jsx)(c.A,{variant:"subtitle2",color:"text.primary",sx:{mt:1},children:"Crews:"}),(0,W.jsxs)(i.A,{sx:{mt:1,maxHeight:"80px",overflowY:"auto",border:"1px solid",borderColor:"divider",borderRadius:1,p:1,bgcolor:"background.default","&::-webkit-scrollbar":{width:"8px"},"&::-webkit-scrollbar-track":{backgroundColor:"background.paper"},"&::-webkit-scrollbar-thumb":{backgroundColor:"primary.light",borderRadius:"4px"}},children:[e.nodes&&Array.isArray(e.nodes)&&e.nodes.filter(e=>{var t;return"crewNode"===e.type||(null==(t=e.data)?void 0:t.crewName)}).map((t,n)=>{var a,s;const i=(null==(a=t.data)?void 0:a.crewName)||(null==(s=t.data)?void 0:s.label)||"Crew "+(n+1);return(0,W.jsxs)(c.A,{variant:"body2",sx:{py:.5,borderBottom:n<e.nodes.filter(e=>{var t;return"crewNode"===e.type||(null==(t=e.data)?void 0:t.crewName)}).length-1?"1px solid":"none",borderColor:"divider"},children:["\u2022 ",i]},t.id)}),(!e.nodes||!Array.isArray(e.nodes)||!e.nodes.some(e=>{var t;return"crewNode"===e.type||(null==(t=e.data)?void 0:t.crewName)}))&&(0,W.jsx)(c.A,{variant:"body2",color:"text.secondary",children:"No crews found"})]}),(0,W.jsxs)(c.A,{variant:"caption",color:"text.secondary",display:"block",sx:{mt:1},children:["Created: ",new Date(e.created_at).toLocaleString()]}),(0,W.jsxs)(c.A,{variant:"caption",color:"text.secondary",display:"block",children:["Components: ",(null==(n=e.nodes)?void 0:n.length)||0," / Connections: ",(null==(a=e.edges)?void 0:a.length)||0]})]})})},e.id)})})})]})]}),(0,W.jsx)(H.A,{children:(0,W.jsx)(g.A,{onClick:n,color:"primary",children:"Cancel"})})]}),$&&(0,W.jsx)(ea,{open:q,onClose:()=>{J(!1),ee(null)},flowId:$,onSave:()=>{pe()}}),(0,W.jsx)("input",{type:"file",ref:he,style:{display:"none"},accept:".json",onChange:async e=>{if(e.target.files&&0!==e.target.files.length)try{z(!0),R(null),B(null);const t=e.target.files[0],n=await t.text(),a=JSON.parse(n);if(!a.name)throw new Error("Invalid flow data: missing name");await Ft.saveFlow({name:a.name,crew_id:a.crew_id||0,nodes:a.nodes||[],edges:a.edges||[],flowConfig:a.flowConfig||a.flow_config}),await pe(),B("Flow imported successfully"),e.target.value=""}catch(t){R("Failed to import flow: "+t.message)}finally{z(!1)}}}),(0,W.jsx)("input",{type:"file",ref:me,style:{display:"none"},accept:".json",onChange:async e=>{if(e.target.files&&0!==e.target.files.length)try{z(!0),R(null),B(null);const n=e.target.files[0],a=await n.text();let s=JSON.parse(a);if(s.name&&s.nodes&&Array.isArray(s.nodes)&&s.edges&&Array.isArray(s.edges)&&!s.crews&&!s.flows&&(s={crews:[s]}),!s.crews&&!s.flows&&!s.agents&&!s.tasks)throw new Error("Invalid import data: no valid data found");let i=0,o=0,r=0,l=0;if(Array.isArray(s.agents))for(const e of s.agents)e.name&&e.role&&(await fe.AgentService.createAgent({name:e.name,role:e.role,backstory:e.backstory||"",goal:e.goal||"",verbose:e.verbose||!1,allow_delegation:e.allow_delegation||!1,tools:e.tools||[],max_iter:e.max_iter||15,max_rpm:e.max_rpm||null,llm:e.llm||"",cache:void 0===e.cache||e.cache,allow_code_execution:e.allow_code_execution||!1,code_execution_mode:e.code_execution_mode||"safe"}),r++);if(Array.isArray(s.tasks))for(const e of s.tasks)e.description&&(await Fe.TaskService.createTask({name:e.name||e.description.slice(0,50),description:e.description,expected_output:e.expected_output||"",tools:e.tools||[],agent_id:e.agent_id||null,async_execution:e.async_execution||!1,context:e.context||null,config:e.config||{}}),l++);if(Array.isArray(s.crews))for(const e of s.crews){var t;const n=null!=(t=null==e?void 0:e.crew)?t:e,a=n.name||n.title||n.plan_name||n.workflow_name||"Imported Plan "+(new Date).toISOString().slice(0,19).replace("T"," ");await Re.saveCrew({name:a,nodes:n.nodes||[],edges:n.edges||[],agent_ids:n.agent_ids||[],task_ids:n.task_ids||[]}),i++}else if(s.crew){const e=s.crew,t=e.name||e.title||e.plan_name||e.workflow_name||"Imported Plan "+(new Date).toISOString().slice(0,19).replace("T"," ");await Re.saveCrew({name:t,nodes:e.nodes||[],edges:e.edges||[],agent_ids:e.agent_ids||[],task_ids:e.task_ids||[]}),i++}if(Array.isArray(s.flows))for(const e of s.flows)e.name&&(await Ft.saveFlow({name:e.name,crew_id:e.crew_id||0,nodes:e.nodes||[],edges:e.edges||[],flowConfig:e.flowConfig||e.flow_config}),o++);r>0&&await xe(),l>0&&await ye(),i>0&&await ge(),o>0&&await pe();const c=[];r>0&&c.push(r+" agents"),l>0&&c.push(l+" tasks"),i>0&&c.push(i+" crews"),o>0&&c.push(o+" flows"),B("Import successful: "+c.join(", ")+" imported."),e.target.value=""}catch(n){R("Failed to import: "+n.message)}finally{z(!1)}}})]})},ra={"databricks-llama-4-maverick":{name:"databricks-llama-4-maverick",temperature:.7,context_window:128e3,max_output_tokens:4096,enabled:!0}},la=e=>{let{open:t,onClose:n,onSelectLLM:a,isUpdating:u=!1}=e;const[h,m]=(0,s.useState)(""),[p,x]=(0,s.useState)(ra),[f,y]=(0,s.useState)(!1),b=(0,s.useRef)(null);(0,s.useEffect)(()=>{if(t){(async()=>{y(!0);try{const e=ye.J.getInstance(),t=await e.getActiveModels();Object.keys(t).length>0&&x(t)}catch(e){try{const e=ye.J.getInstance().getActiveModelsSync();Object.keys(e).length>0&&x(e)}catch(t){}}finally{y(!1),setTimeout(()=>{b.current&&b.current.focus()},100)}})()}else m("")},[t]);const v=()=>f||0===Object.keys(p).length?"":h&&p[h]?h:"",A=()=>{m(""),n()},j=(0,s.useCallback)(()=>{h&&p[h]&&(a(h),m(""),n())},[h,a,p,n]),w=Object.keys(p);return(0,W.jsxs)(o.A,{open:t,onClose:A,maxWidth:"sm",fullWidth:!0,onKeyDown:e=>{"Enter"!==e.key||!h||u||f||(e.preventDefault(),j())},children:[(0,W.jsxs)(l.A,{children:[(0,W.jsx)(c.A,{variant:"h6",component:"div",children:"Select LLM"}),(0,W.jsx)(d.A,{"aria-label":"close",onClick:A,sx:{position:"absolute",right:8,top:8},children:(0,W.jsx)(N.A,{})})]}),(0,W.jsx)(ne.A,{}),(0,W.jsx)(r.A,{children:(0,W.jsx)(i.A,{sx:{mt:2},children:f?(0,W.jsx)(i.A,{display:"flex",justifyContent:"center",alignItems:"center",py:4,children:(0,W.jsx)(Y.A,{})}):(0,W.jsxs)(re.A,{fullWidth:!0,children:[(0,W.jsx)(le.A,{children:"Select Model"}),(0,W.jsx)(ce.A,{value:v(),onChange:e=>{m(e.target.value)},label:"Select Model",inputRef:b,children:0===Object.keys(p).length?(0,W.jsx)(de.A,{value:"",children:"No models available"}):w.map(e=>(0,W.jsx)(de.A,{value:e,children:(0,W.jsxs)(i.A,{display:"flex",justifyContent:"space-between",width:"100%",children:[(0,W.jsx)(c.A,{children:p[e].name}),(0,W.jsx)(c.A,{variant:"caption",color:"text.secondary",children:p[e].provider})]})},e))})]})})}),(0,W.jsxs)(H.A,{children:[(0,W.jsx)(g.A,{onClick:A,children:"Cancel"}),(0,W.jsx)(g.A,{onClick:j,color:"primary",disabled:!v()||u||f,children:u?(0,W.jsx)(Y.A,{size:24}):"Select"})]})]})},ca=[{value:"1",label:"1 RPM"},{value:"3",label:"3 RPM"},{value:"10",label:"10 RPM"},{value:"20",label:"20 RPM"},{value:"30",label:"30 RPM"},{value:"40",label:"40 RPM"},{value:"50",label:"50 RPM"},{value:"60",label:"60 RPM (1 request per second)"},{value:"120",label:"120 RPM (2 requests per second)"},{value:"300",label:"300 RPM (5 requests per second)"},{value:"600",label:"600 RPM (10 requests per second)"},{value:"1200",label:"1200 RPM (20 requests per second)"}],da=e=>{let{open:t,onClose:n,onSelectMaxRPM:a,isUpdating:u=!1}=e;const[h,m]=(0,s.useState)(""),p=(0,s.useCallback)(()=>{m(""),n()},[n]),x=(0,s.useCallback)(()=>{h&&(a(h),p())},[h,a,p]);return(0,W.jsxs)(o.A,{open:t,onClose:p,maxWidth:"sm",fullWidth:!0,onKeyDown:e=>{"Enter"===e.key&&h&&!u&&(e.preventDefault(),x())},PaperComponent:_e.A,children:[(0,W.jsxs)(l.A,{children:["Set Max RPM for All Agents",(0,W.jsx)(d.A,{"aria-label":"close",onClick:p,sx:{position:"absolute",right:8,top:8},children:(0,W.jsx)(N.A,{})})]}),(0,W.jsxs)(r.A,{sx:{pb:1},children:[(0,W.jsx)(c.A,{variant:"body2",sx:{mb:2},children:"Select a Max RPM (Requests Per Minute) value to apply to all agents on the canvas. Press Enter to apply."}),(0,W.jsx)(ne.A,{sx:{my:2}}),(0,W.jsxs)(re.A,{fullWidth:!0,sx:{my:2},children:[(0,W.jsx)(le.A,{id:"max-rpm-select-label",children:"Max RPM"}),(0,W.jsx)(ce.A,{labelId:"max-rpm-select-label",id:"max-rpm-select",value:h,onChange:e=>{m(e.target.value)},label:"Max RPM",autoFocus:!0,children:ca.map(e=>(0,W.jsx)(de.A,{value:e.value,children:(0,W.jsxs)(i.A,{children:[(0,W.jsx)(c.A,{variant:"body1",children:e.label}),(0,W.jsx)(c.A,{variant:"caption",color:"textSecondary",children:"Maximum requests per minute limit"})]})},e.value))})]})]}),(0,W.jsxs)(H.A,{sx:{px:3,py:2},children:[(0,W.jsx)(g.A,{onClick:p,children:"Cancel"}),(0,W.jsxs)(i.A,{sx:{position:"relative"},children:[(0,W.jsx)(g.A,{variant:"contained",onClick:x,disabled:!h||u,children:"Apply to All Agents"}),u&&(0,W.jsx)(Y.A,{size:24,sx:{position:"absolute",top:"50%",left:"50%",marginTop:"-12px",marginLeft:"-12px"}})]})]})]})},ua=e=>{let{open:t,onClose:n,onSelectTools:a,isUpdating:u=!1,selectedNodes:h=[]}=e;const[m,p]=(0,s.useState)([]),[x,f]=(0,s.useState)([]),[y,b]=(0,s.useState)(!1),[v,A]=(0,s.useState)(""),[j,w]=(0,s.useState)(-1),[k,C]=(0,s.useState)("all"),[S,_]=(0,s.useState)([]),[E,I]=(0,s.useState)([]),[T,D]=(0,s.useState)([]),O=(0,s.useRef)(null),P=(0,s.useRef)(null),M=(0,s.useMemo)(()=>({agents:h.filter(e=>"agentNode"===e.type).map(e=>({id:e.id,label:e.data.label,type:"agent"})),tasks:h.filter(e=>"taskNode"===e.type).map(e=>({id:e.id,label:e.data.label,type:"task"}))}),[h]),z=m.filter(e=>e.title.toLowerCase().includes(v.toLowerCase())||e.description.toLowerCase().includes(v.toLowerCase()));(0,s.useEffect)(()=>{t&&(L(),R(),A(""),w(-1),C("all"),_([]),setTimeout(()=>{var e;return null==(e=O.current)?void 0:e.focus()},100))},[t]);const L=async()=>{b(!0);try{const e=await xt.m.listEnabledTools();p(e)}catch(e){}finally{b(!1)}},R=async()=>{try{const[e,t]=await Promise.all([fe.AgentService.listAgents(),Fe.TaskService.listTasks()]);I(e.map(e=>{var t;return{id:(null==(t=e.id)?void 0:t.toString())||"",label:e.name,type:"agent"}})),D(t.map(e=>{var t;return{id:(null==(t=e.id)?void 0:t.toString())||"",label:e.name,type:"task"}}))}catch(e){}},F=e=>{const t=String(e.id);f(e=>e.includes(t)?e.filter(e=>e!==t):[...e,t])},B=(0,s.useCallback)(()=>{f([]),n()},[n]),V=e=>{_(t=>t.some(t=>t.id===e.id)?t.filter(t=>t.id!==e.id):[...t,e])},K=(0,s.useCallback)(()=>{if(x.length>0){let e;e="all"===k?[...E.map(e=>e.id),...T.map(e=>e.id)]:"all_agents"===k?E.map(e=>e.id):"all_tasks"===k?T.map(e=>e.id):S.map(e=>e.id),a(x,e),B()}},[x,a,B,k,S,E,T]);return(0,W.jsxs)(o.A,{open:t,onClose:B,maxWidth:"sm",fullWidth:!0,PaperComponent:_e.A,children:[(0,W.jsx)(l.A,{sx:{pb:1},children:(0,W.jsxs)(i.A,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,W.jsx)(c.A,{variant:"h6",children:"Select Tools"}),(0,W.jsx)(d.A,{onClick:B,size:"small",children:(0,W.jsx)(N.A,{})})]})}),(0,W.jsxs)(r.A,{sx:{pb:1},children:[(0,W.jsx)(re.A,{fullWidth:!0,sx:{mb:2},children:(0,W.jsxs)(ce.A,{value:Array.isArray(k)?k[0]:k,onChange:e=>{const t=e.target.value;if("all"===t)C("all"),_([]);else if("all_agents"===t)C("all_agents"),_(M.agents);else if("all_tasks"===t)C("all_tasks"),_(M.tasks);else if("selected"===t)C("selected"),_([]);else if(t.startsWith("agent_")){const e=t.replace("agent_",""),n=M.agents.find(t=>t.id===e);n&&(C([e]),_([n]))}else if(t.startsWith("task_")){const e=t.replace("task_",""),n=M.tasks.find(t=>t.id===e);n&&(C([e]),_([n]))}},size:"small",displayEmpty:!0,sx:{"& .MuiSelect-select":{display:"flex",alignItems:"center"}},children:[(0,W.jsx)(de.A,{value:"all",children:"All Agents & Tasks"}),(0,W.jsxs)(de.A,{value:"all_agents",disabled:0===M.agents.length,children:["All Agents (",M.agents.length,")"]}),(0,W.jsxs)(de.A,{value:"all_tasks",disabled:0===M.tasks.length,children:["All Tasks (",M.tasks.length,")"]}),(0,W.jsxs)(de.A,{value:"selected",disabled:0===h.length,children:["Selected (",h.length," ",1===h.length?"Node":"Nodes",")"]}),M.agents.length>0&&(0,W.jsx)(de.A,{value:"individual_agents",disabled:!0,children:(0,W.jsx)(c.A,{variant:"caption",color:"text.secondary",children:"Individual Agents:"})}),M.agents.map(e=>(0,W.jsx)(de.A,{value:"agent_"+e.id,sx:{pl:3},children:e.label},"agent_"+e.id)),M.tasks.length>0&&(0,W.jsx)(de.A,{value:"individual_tasks",disabled:!0,children:(0,W.jsx)(c.A,{variant:"caption",color:"text.secondary",children:"Individual Tasks:"})}),M.tasks.map(e=>(0,W.jsx)(de.A,{value:"task_"+e.id,sx:{pl:3},children:e.label},"task_"+e.id))]})}),"selected"===k&&(0,W.jsxs)(i.A,{sx:{mb:2,maxHeight:"150px",overflow:"auto"},children:[(0,W.jsx)(c.A,{variant:"subtitle2",sx:{mb:1},children:"Select Nodes:"}),M.agents.length>0&&(0,W.jsxs)(i.A,{sx:{mb:1},children:[(0,W.jsx)(c.A,{variant:"caption",color:"text.secondary",children:"Agents:"}),M.agents.map(e=>(0,W.jsxs)(i.A,{onClick:()=>V(e),sx:{display:"flex",alignItems:"center",p:1,cursor:"pointer",borderRadius:1,bgcolor:S.some(t=>t.id===e.id)?"action.selected":"transparent","&:hover":{bgcolor:"action.hover"}},children:[(0,W.jsx)(Kt.A,{size:"small",checked:S.some(t=>t.id===e.id),onChange:()=>V(e)}),(0,W.jsx)(c.A,{variant:"body2",children:e.label})]},e.id))]}),M.tasks.length>0&&(0,W.jsxs)(i.A,{children:[(0,W.jsx)(c.A,{variant:"caption",color:"text.secondary",children:"Tasks:"}),M.tasks.map(e=>(0,W.jsxs)(i.A,{onClick:()=>V(e),sx:{display:"flex",alignItems:"center",p:1,cursor:"pointer",borderRadius:1,bgcolor:S.some(t=>t.id===e.id)?"action.selected":"transparent","&:hover":{bgcolor:"action.hover"}},children:[(0,W.jsx)(Kt.A,{size:"small",checked:S.some(t=>t.id===e.id),onChange:()=>V(e)}),(0,W.jsx)(c.A,{variant:"body2",children:e.label})]},e.id))]})]}),(0,W.jsx)(U.A,{inputRef:O,fullWidth:!0,placeholder:"Search tools... (\u2191\u2193 to navigate, Space/Enter to select)",value:v,onChange:e=>{A(e.target.value),w(0)},onKeyDown:e=>{const t=z.length;switch(e.key){case"ArrowDown":e.preventDefault(),w(e=>(e+1)%t);break;case"ArrowUp":e.preventDefault(),w(e=>(e-1+t)%t);break;case" ":case"Enter":e.preventDefault(),j>=0&&j<t&&F(z[j])}},margin:"normal",variant:"outlined",size:"small",InputProps:{startAdornment:(0,W.jsx)(ae.A,{position:"start",children:(0,W.jsx)(Ee.A,{})})},sx:{mb:2}}),y?(0,W.jsx)(i.A,{sx:{display:"flex",justifyContent:"center",p:3},children:(0,W.jsx)(Y.A,{size:24})}):(0,W.jsx)(re.A,{component:"fieldset",fullWidth:!0,children:(0,W.jsx)(at.A,{ref:P,dense:!0,sx:{maxHeight:"300px",overflow:"auto","& .Mui-selected":{backgroundColor:e=>"rgba("+e.palette.primary.main+", 0.1)"}},children:z.map((e,t)=>(0,W.jsx)(st.Ay,{disablePadding:!0,dense:!0,children:(0,W.jsxs)(aa.A,{selected:t===j,onClick:()=>F(e),sx:{borderRadius:1,mb:.5,"&.Mui-selected":{bgcolor:e=>"rgba("+e.palette.primary.main+", 0.1)"}},children:[(0,W.jsx)(it.A,{children:(0,W.jsx)(Kt.A,{edge:"start",checked:x.includes(String(e.id)),tabIndex:-1,disableRipple:!0})}),(0,W.jsx)(ot.A,{primary:e.title,secondary:e.description,primaryTypographyProps:{variant:"body2",fontWeight:x.includes(String(e.id))?"bold":"normal"},secondaryTypographyProps:{variant:"caption",color:"textSecondary"}})]})},e.id))})})]}),(0,W.jsxs)(H.A,{sx:{px:3,py:2},children:[(0,W.jsx)(g.A,{onClick:B,children:"Cancel"}),(0,W.jsxs)(i.A,{sx:{position:"relative"},children:[(0,W.jsx)(g.A,{variant:"contained",onClick:K,disabled:0===x.length||u,children:"Apply Tools"}),u&&(0,W.jsx)(Y.A,{size:24,sx:{position:"absolute",top:"50%",left:"50%",marginTop:"-12px",marginLeft:"-12px"}})]})]})]})};var ha=n(68926),ma=n(61188);const ga=["api_key"],pa={id:"",name:"Default MCP Server",enabled:!1,global_enabled:!1,server_url:"",api_key:"",server_type:"streamable",auth_type:"api_key",timeout_seconds:30,max_retries:3,rate_limit:60,command:"",args:[],additional_config:{},group_id:null},xa={servers:[],global_enabled:!1},fa=e=>{var t,n;let{open:u,onClose:m,server:p,onSave:x,isNew:f=!1}=e;const{t:y}=(0,b.Bd)(),[v,A]=(0,s.useState)(p),[j,w]=(0,s.useState)(""),[k,C]=(0,s.useState)(!1),[S,_]=(0,s.useState)({tested:!1,success:!1,message:""});if((0,s.useEffect)(()=>{(A(p),p)&&w(p.api_key||"");_({tested:!1,success:!1,message:""})},[p,f]),!v)return null;const E=e=>t=>{const n=t.target.value;A(t=>t?Object.assign({},t,{[e]:n}):null)},I=e=>t=>{const n=t.target.value;A(t=>t?Object.assign({},t,{[e]:n}):null)},T=e=>(t,n)=>{A(t=>t?Object.assign({},t,{[e]:n}):null)};return(0,W.jsxs)(o.A,{open:u,onClose:m,fullWidth:!0,maxWidth:"md",PaperProps:{sx:{borderRadius:2,boxShadow:"0 8px 32px rgba(0,0,0,0.12)"}},children:[(0,W.jsxs)(l.A,{sx:{borderBottom:"1px solid",borderColor:"divider",p:3,display:"flex",alignItems:"center",justifyContent:"space-between"},children:[(0,W.jsxs)(i.A,{sx:{display:"flex",alignItems:"center"},children:[(0,W.jsx)(ha.A,{sx:{mr:1.5,color:"primary.main",fontSize:"1.5rem"}}),(0,W.jsx)(c.A,{variant:"h5",children:f?y("configuration.mcp.addServer",{defaultValue:"Add MCP Server"}):y("configuration.mcp.editServer",{defaultValue:"Edit MCP Server"})})]}),(0,W.jsx)(d.A,{onClick:m,children:(0,W.jsx)(N.A,{})})]}),(0,W.jsxs)(r.A,{sx:{p:3},children:[(0,W.jsxs)(ue.Ay,{container:!0,spacing:3,sx:{mt:.5},children:[(0,W.jsx)(ue.Ay,{item:!0,xs:12,children:(0,W.jsx)(U.A,{label:y("configuration.mcp.serverName",{defaultValue:"Server Name"}),value:v.name,onChange:E("name"),fullWidth:!0,required:!0,sx:{"& .MuiOutlinedInput-root":{borderRadius:1.5}}})}),(0,W.jsx)(ue.Ay,{item:!0,xs:12,md:9,children:(0,W.jsx)(U.A,{label:y("configuration.mcp.serverUrl",{defaultValue:"Server URL"}),value:v.server_url,onChange:E("server_url"),fullWidth:!0,required:!0,helperText:y("configuration.mcp.serverUrlHelp",{defaultValue:"Full URL of the MCP server endpoint"}),sx:{"& .MuiOutlinedInput-root":{borderRadius:1.5}}})}),(0,W.jsx)(ue.Ay,{item:!0,xs:12,md:3,children:(0,W.jsxs)(re.A,{fullWidth:!0,children:[(0,W.jsx)(le.A,{id:"server-type-label",children:"Server Type"}),(0,W.jsx)(ce.A,{labelId:"server-type-label",value:v.server_type||"streamable",label:"Server Type",onChange:I("server_type"),children:(0,W.jsx)(de.A,{value:"streamable",children:"Streamable HTTP"})})]})}),"streamable"===v.server_type&&(0,W.jsx)(ue.Ay,{item:!0,xs:12,md:6,children:(0,W.jsxs)(re.A,{fullWidth:!0,children:[(0,W.jsx)(le.A,{id:"auth-type-label",children:"Authentication Type"}),(0,W.jsxs)(ce.A,{labelId:"auth-type-label",value:v.auth_type||"api_key",label:"Authentication Type",onChange:I("auth_type"),children:[(0,W.jsx)(de.A,{value:"api_key",children:"API Key"}),(0,W.jsx)(de.A,{value:"databricks_obo",children:"Databricks OBO"})]})]})}),"streamable"===v.server_type&&"databricks_obo"!==v.auth_type&&(0,W.jsx)(ue.Ay,{item:!0,xs:12,md:"databricks_obo"===v.auth_type?12:6,children:(0,W.jsx)(U.A,{label:y("configuration.mcp.apiKey",{defaultValue:"API Key"}),value:v.api_key,onChange:E("api_key"),fullWidth:!0,type:"password",required:!0,helperText:y("configuration.mcp.apiKeyHelp",{defaultValue:"Authentication key for the MCP server"}),sx:{"& .MuiOutlinedInput-root":{borderRadius:1.5}}})}),"streamable"===v.server_type&&(0,W.jsx)(ue.Ay,{item:!0,xs:12,children:(0,W.jsx)(U.A,{label:y("configuration.mcp.sessionId",{defaultValue:"Session ID (Optional)"}),value:v.session_id||"",onChange:E("session_id"),fullWidth:!0,helperText:y("configuration.mcp.sessionIdHelp",{defaultValue:"Optional session ID for maintaining state across requests. Leave empty for stateless connections."}),sx:{"& .MuiOutlinedInput-root":{borderRadius:1.5}}})}),(0,W.jsx)(ue.Ay,{item:!0,xs:12,children:(0,W.jsx)(c.A,{variant:"subtitle2",gutterBottom:!0,children:y("configuration.mcp.advanced",{defaultValue:"Advanced Settings"})})}),(0,W.jsxs)(ue.Ay,{item:!0,xs:12,md:6,children:[(0,W.jsxs)(i.A,{sx:{display:"flex",alignItems:"center",mb:1},children:[(0,W.jsx)(c.A,{variant:"body2",children:y("configuration.mcp.timeout",{defaultValue:"Timeout (seconds)"})}),(0,W.jsx)(M.A,{title:y("configuration.mcp.timeoutHelp",{defaultValue:"Maximum time to wait for server response"}),children:(0,W.jsx)(ze.A,{fontSize:"small",sx:{ml:1,color:"text.secondary",fontSize:"0.9rem"}})})]}),(0,W.jsx)(ma.Ay,{value:v.timeout_seconds,onChange:T("timeout_seconds"),min:5,max:120,step:5,marks:[{value:5,label:"5s"},{value:30,label:"30s"},{value:60,label:"60s"},{value:120,label:"120s"}],valueLabelDisplay:"auto"})]}),(0,W.jsxs)(ue.Ay,{item:!0,xs:12,md:6,children:[(0,W.jsxs)(i.A,{sx:{display:"flex",alignItems:"center",mb:1},children:[(0,W.jsx)(c.A,{variant:"body2",children:y("configuration.mcp.maxRetries",{defaultValue:"Max Retries"})}),(0,W.jsx)(M.A,{title:y("configuration.mcp.maxRetriesHelp",{defaultValue:"Number of retry attempts on failure"}),children:(0,W.jsx)(ze.A,{fontSize:"small",sx:{ml:1,color:"text.secondary",fontSize:"0.9rem"}})})]}),(0,W.jsx)(ma.Ay,{value:v.max_retries,onChange:T("max_retries"),min:0,max:10,step:1,marks:[{value:0,label:"0"},{value:3,label:"3"},{value:5,label:"5"},{value:10,label:"10"}],valueLabelDisplay:"auto"})]}),(0,W.jsxs)(ue.Ay,{item:!0,xs:12,md:6,children:[(0,W.jsxs)(i.A,{sx:{display:"flex",alignItems:"center",mb:1},children:[(0,W.jsx)(c.A,{variant:"body2",children:y("configuration.mcp.rateLimit",{defaultValue:"Rate Limit (RPM)"})}),(0,W.jsx)(M.A,{title:y("configuration.mcp.rateLimitHelp",{defaultValue:"Maximum requests per minute to the MCP server"}),children:(0,W.jsx)(ze.A,{fontSize:"small",sx:{ml:1,color:"text.secondary",fontSize:"0.9rem"}})})]}),(0,W.jsx)(ma.Ay,{value:v.rate_limit,onChange:T("rate_limit"),min:10,max:600,step:10,marks:[{value:10,label:"10"},{value:60,label:"60"},{value:300,label:"300"},{value:600,label:"600"}],valueLabelDisplay:"auto"})]})]}),S.tested&&(0,W.jsx)(i.A,{sx:{mt:2},children:(0,W.jsx)(h.A,{severity:S.success?"success":"error",icon:S.success?(0,W.jsx)(rt.A,{}):(0,W.jsx)(wt.A,{}),children:S.message})})]}),(0,W.jsxs)(H.A,{sx:{p:3,pt:1,display:"flex",justifyContent:"space-between"},children:[(0,W.jsx)(g.A,{onClick:async()=>{if(v){C(!0),_({tested:!1,success:!1,message:""});try{const e=tt.getInstance(),t=await e.testConnection(v);_({tested:!0,success:t.success,message:t.message})}catch(e){_({tested:!0,success:!1,message:e instanceof Error?e.message:"Connection test failed"})}finally{C(!1)}}},disabled:k||!(null!=(t=v.server_url)&&t.trim())||"streamable"===v.server_type&&"databricks_obo"!==v.auth_type&&!(null!=(n=v.api_key)&&n.trim()),startIcon:k?(0,W.jsx)(Y.A,{size:16}):(0,W.jsx)(ha.A,{}),children:k?y("configuration.mcp.testingConnection",{defaultValue:"Testing..."}):y("configuration.mcp.testConnection",{defaultValue:"Test Connection"})}),(0,W.jsxs)(i.A,{children:[(0,W.jsx)(g.A,{onClick:m,color:"inherit",sx:{mr:1},children:y("common.cancel",{defaultValue:"Cancel"})}),(0,W.jsx)(g.A,{onClick:()=>{if(v){const e=Object.assign({},v);if(!f&&v.api_key===j){const t=(0,a.A)(e,ga);Object.assign(e,t)}x(e),m()}},variant:"contained",color:"primary",children:y("common.save",{defaultValue:"Save"})})]})]})]})},ya=()=>{const{t:e}=(0,b.Bd)(),[t,n]=(0,s.useState)(xa),[a,o]=(0,s.useState)(!1),[r,l]=(0,s.useState)(null),[m,p]=(0,s.useState)(!1),[x,f]=(0,s.useState)({message:"",open:!1,severity:"success"}),[y,v]=(0,s.useState)(!1),A=((0,Nn.o)(e=>e.userRole),async()=>{v(!0);try{const t=tt.getInstance(),a=await t.getMcpServers();n(e=>Object.assign({},e,{servers:a.servers||[]}));try{const e=await t.getGlobalSettings();n(t=>Object.assign({},t,{global_enabled:e.global_enabled}))}catch(e){}}catch(e){f({open:!0,message:e instanceof Error?e.message:"Failed to load MCP servers",severity:"error"})}finally{v(!1)}});(0,s.useEffect)(()=>{A()},[]);const j=e=>async t=>{try{const t=tt.getInstance();await t.toggleMcpServerGlobalEnabled(e),await A(),f({open:!0,message:"MCP server global setting updated successfully",severity:"success"})}catch(n){f({open:!0,message:n instanceof Error?n.message:"Failed to toggle server global setting",severity:"error"})}};return(0,W.jsxs)(i.A,{children:[(0,W.jsxs)(i.A,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",mb:3},children:[(0,W.jsxs)(i.A,{sx:{display:"flex",alignItems:"center"},children:[(0,W.jsx)(ha.A,{sx:{mr:1.5,color:"primary.main",fontSize:"1.4rem"}}),(0,W.jsx)(c.A,{variant:"h6",children:e("configuration.mcp.title",{defaultValue:"MCP Server Configuration"})}),y&&(0,W.jsx)(Y.A,{size:20,sx:{ml:2}})]}),(0,W.jsx)(he.A,{control:(0,W.jsx)(me.A,{checked:t.global_enabled,onChange:async e=>{const t=e.target.checked;n(e=>Object.assign({},e,{global_enabled:t}));try{const e=tt.getInstance();await e.updateGlobalSettings({global_enabled:t})}catch(a){n(e=>Object.assign({},e,{global_enabled:!t})),f({open:!0,message:a instanceof Error?a.message:"Failed to update global MCP settings",severity:"error"})}},color:"primary"}),label:e("configuration.mcp.globalEnable",{defaultValue:"Enable MCP Servers"})})]}),t.global_enabled&&(0,W.jsx)(h.A,{severity:"info",sx:{mb:3},children:(0,W.jsxs)(c.A,{variant:"body2",children:[(0,W.jsx)("strong",{children:"Three-Tier MCP Configuration:"}),(0,W.jsx)("br",{}),"\u2022 ",(0,W.jsx)("strong",{children:"Global servers"})," (marked with GLOBAL chip) are available to all agents and tasks",(0,W.jsx)("br",{}),"\u2022 ",(0,W.jsx)("strong",{children:"Agent-level servers"})," can be selected in Agent Forms for specific agents",(0,W.jsx)("br",{}),"\u2022 ",(0,W.jsx)("strong",{children:"Task-level servers"})," can be selected in Task Forms for specific tasks (highest priority)"]})}),(0,W.jsxs)(_e.A,{variant:"outlined",sx:{p:3,mb:3,bgcolor:"background.paper",borderRadius:2},children:[(0,W.jsxs)(i.A,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2},children:[(0,W.jsx)(c.A,{variant:"subtitle1",fontWeight:"medium",children:e("configuration.mcp.servers",{defaultValue:"MCP Servers"})}),(0,W.jsx)(g.A,{variant:"contained",size:"small",startIcon:(0,W.jsx)($t.A,{}),onClick:()=>{l(Object.assign({},pa,{id:(new Date).getTime().toString(),enabled:!0,auth_type:"api_key"})),p(!0),o(!0)},children:e("configuration.mcp.addServer",{defaultValue:"Add Server"})})]}),(0,W.jsx)(i.A,{sx:{mt:2},children:0===t.servers.length?(0,W.jsx)(c.A,{variant:"body2",color:"text.secondary",align:"center",sx:{py:3},children:e("configuration.mcp.noServers",{defaultValue:"No MCP servers configured yet."})}):(0,W.jsx)(i.A,{sx:{display:"flex",flexDirection:"column",gap:2},children:t.servers.slice().sort((e,t)=>e.name.localeCompare(t.name)).map(n=>{return(0,W.jsx)(_e.A,{variant:"outlined",sx:{p:2,borderRadius:1.5,transition:"all 0.2s","&:hover":{boxShadow:"0 4px 12px rgba(0,0,0,0.08)",borderColor:"primary.main"}},children:(0,W.jsxs)(i.A,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,W.jsxs)(i.A,{sx:{display:"flex",flexDirection:"column"},children:[(0,W.jsxs)(i.A,{sx:{display:"flex",alignItems:"center",mb:.5},children:[(0,W.jsx)(c.A,{variant:"subtitle1",fontWeight:"medium",children:n.name}),(0,W.jsx)(V.A,{label:"STREAMABLE",size:"small",color:"secondary",variant:"outlined",sx:{ml:1.5,fontSize:"0.7rem",height:20}}),n.global_enabled&&(0,W.jsx)(V.A,{label:"GLOBAL",size:"small",color:"primary",sx:{ml:1,fontSize:"0.7rem",height:20}})]}),(0,W.jsx)(c.A,{variant:"body2",color:"text.secondary",children:n.server_url})]}),(0,W.jsxs)(i.A,{sx:{display:"flex",alignItems:"center",gap:1},children:[(0,W.jsxs)(i.A,{sx:{display:"flex",flexDirection:"column",alignItems:"flex-end",mr:1},children:[(0,W.jsx)(he.A,{control:(0,W.jsx)(me.A,{size:"small",checked:n.enabled,onChange:(a=n.id,async e=>{try{const e=tt.getInstance();await e.toggleMcpServerEnabled(a),await A()}catch(t){f({open:!0,message:t instanceof Error?t.message:"Failed to toggle server state",severity:"error"})}}),disabled:!t.global_enabled}),label:(0,W.jsx)(c.A,{variant:"caption",sx:{fontSize:"0.75rem"},children:n.enabled?e("common.enabled",{defaultValue:"Enabled"}):e("common.disabled",{defaultValue:"Disabled"})})}),(0,W.jsx)(he.A,{control:(0,W.jsx)(me.A,{size:"small",checked:n.global_enabled||!1,onChange:j(n.id),disabled:!t.global_enabled||!n.enabled,color:"primary"}),label:(0,W.jsx)(c.A,{variant:"caption",sx:{fontSize:"0.75rem"},children:n.global_enabled?e("configuration.mcp.globalEnabled",{defaultValue:"Global"}):e("configuration.mcp.globalDisabled",{defaultValue:"Not Global"})})})]}),(0,W.jsxs)(i.A,{sx:{display:"flex",flexDirection:"column"},children:[(0,W.jsx)(d.A,{size:"small",onClick:()=>(async e=>{try{const t=tt.getInstance(),n=await t.getMcpServer(e.id);n&&(l(n),p(!1),o(!0))}catch(t){f({open:!0,message:t instanceof Error?t.message:"Failed to load server details",severity:"error"})}})(n),children:(0,W.jsx)(Z.A,{fontSize:"small"})}),(0,W.jsx)(d.A,{size:"small",onClick:()=>(async e=>{try{const t=tt.getInstance();await t.deleteMcpServer(e),await A(),f({open:!0,message:"MCP Server deleted successfully",severity:"success"})}catch(t){f({open:!0,message:t instanceof Error?t.message:"Failed to delete MCP server",severity:"error"})}})(n.id),children:(0,W.jsx)(Q.A,{fontSize:"small"})})]})]})]})},n.id);var a})})})]}),(0,W.jsx)(fa,{open:a,onClose:()=>o(!1),server:r,onSave:async e=>{try{const t=tt.getInstance();m?await t.createMcpServer(e):await t.updateMcpServer(e.id,e),await A(),f({open:!0,message:"MCP Server "+(m?"created":"updated")+" successfully",severity:"success"}),o(!1)}catch(t){f({open:!0,message:t instanceof Error?t.message:"Failed to save MCP server",severity:"error"})}},isNew:m}),(0,W.jsx)(u.A,{open:x.open,autoHideDuration:6e3,onClose:()=>f(e=>Object.assign({},e,{open:!1})),anchorOrigin:{vertical:"bottom",horizontal:"right"},children:(0,W.jsx)(h.A,{severity:x.severity,onClose:()=>f(e=>Object.assign({},e,{open:!1})),children:x.message})})]})},ba=e=>{let{open:t,onClose:n}=e;return(0,W.jsxs)(o.A,{open:t,onClose:n,fullWidth:!0,maxWidth:"lg",PaperProps:{sx:{borderRadius:2,boxShadow:"0 8px 32px rgba(0,0,0,0.12)"}},children:[(0,W.jsxs)(l.A,{sx:{borderBottom:"1px solid",borderColor:"divider",p:3,display:"flex",alignItems:"center",justifyContent:"space-between"},children:[(0,W.jsxs)(i.A,{sx:{display:"flex",alignItems:"center"},children:[(0,W.jsx)(ha.A,{sx:{mr:1.5,color:"primary.main",fontSize:"1.5rem"}}),(0,W.jsx)(c.A,{variant:"h5",children:"MCP Configuration"})]}),(0,W.jsx)(d.A,{onClick:n,"aria-label":"close",children:(0,W.jsx)(N.A,{})})]}),(0,W.jsx)(r.A,{sx:{p:3},children:(0,W.jsx)(ya,{})}),(0,W.jsx)(H.A,{sx:{p:2,borderTop:"1px solid",borderColor:"divider"},children:(0,W.jsx)(g.A,{onClick:n,color:"primary",children:"Close"})})]})},va=dn,Aa=un,ja=e=>{let{nodes:t,edges:n,setNodes:a,setEdges:o,onNodesChange:r,onEdgesChange:l,onConnect:c,onSelectionChange:d,onPaneContextMenu:m,onInit:p,handleUIAwareFitView:x,planningEnabled:b,setPlanningEnabled:A,reasoningEnabled:j,setReasoningEnabled:w,schemaDetectionEnabled:k,setSchemaDetectionEnabled:C,selectedModel:S,setSelectedModel:E,onOpenLogsDialog:I,onToggleChat:T,isChatOpen:D,setIsAgentDialogOpen:O,setIsTaskDialogOpen:N,setIsFlowDialogOpen:P,showRunHistory:M,executionHistoryHeight:z=200,onOpenTutorial:L,onOpenConfiguration:R}=e;const[F,B]=(0,s.useState)(!0),V=(0,s.useRef)(null),U=(0,s.useRef)(null),{isDarkMode:H}=f();(0,s.useEffect)(()=>{const e="reactflow-stacking-order-fix",t=document.getElementById(e);t&&t.remove();const n=document.createElement("style");return n.id=e,n.textContent="\n      /* Ensure proper edge rendering without z-index conflicts */\n      .react-flow__edge-path {\n        pointer-events: stroke;\n      }\n      .react-flow__edge {\n        pointer-events: all;\n      }\n    ",document.head.appendChild(n),()=>{const t=document.getElementById(e);t&&t.remove()}},[]);const K=fn(),G=((0,_.a)(),(0,s.useCallback)(async()=>{try{ye([])}catch(e){}},[])),[q,Y]=(0,s.useState)(!1),[X,Q]=(0,s.useState)(""),[Z,$]=(0,s.useState)(!1),[ee,te]=(0,s.useState)(!1),[ne,ae]=(0,s.useState)(!1),[se,ie]=(0,s.useState)(!1),[oe,re]=(0,s.useState)(!1),[le,ce]=(0,s.useState)(!1),[de,ue]=(0,s.useState)(!1),[he,me]=(0,s.useState)(!1),[ge,pe]=(0,s.useState)(!1),[xe,ye]=(0,s.useState)([]),[be,ve]=(0,s.useState)([]),{selectedTools:Ae,setSelectedTools:je,selectedTools:we,setSelectedTools:ke}=pn(),{selectedModel:Ce,processType:Se,setProcessType:_e}=(0,v.E)(),{handleExecuteCrew:Ee,isExecuting:Ie}=(()=>{const e=fn(),t=(0,_.a)(),{isExecuting:n,setJobId:a,setIsExecuting:i,executeCrew:o}=(0,v.E)();return{handleExecuteCrew:(0,s.useCallback)(async(n,s)=>{try{"function"===typeof i&&i(!0);const e=n.map(e=>Object.assign({},e)),r=s.map(e=>Object.assign({},e)),l=await o(e,r);return l&&l.job_id?("function"===typeof a&&a(l.job_id),t.startPolling(),l):void 0}catch(r){return void e.showErrorMessage("Failed to execute crew workflow")}finally{"function"===typeof i&&i(!1)}},[i,o,a,t,e]),isExecuting:n}})(),{handleEdgesChange:Te,handleNodesChange:De,handleClear:Oe}=(e=>{let{nodes:t,edges:n=[],onNodesChange:a,onEdgesChange:i}=e;return{handleEdgesChange:(0,s.useCallback)(e=>{const t=e.filter((t,n)=>"add"!==t.type||!e.slice(0,n).some(e=>{var n,a;return"add"===e.type&&(null==(n=e.item)?void 0:n.id)===(null==(a=t.item)?void 0:a.id)}));i(t)},[i]),handleNodesChange:(0,s.useCallback)(e=>{a(e)},[a]),handleClear:(0,s.useCallback)(()=>{n.length>0&&i(n.map(e=>({type:"remove",id:e.id}))),t.length>0&&a(t.map(e=>({type:"remove",id:e.id}))),setTimeout(()=>{i([]),a([])},0)},[t,n,a,i])}})({nodes:t,edges:n,onNodesChange:r,onEdgesChange:l}),{handleAgentGenerated:Ne,handleUpdateAllAgentsLLM:Pe,handleUpdateAllAgentsMaxRPM:Me}=(e=>{let{nodes:t,onNodesChange:n,reactFlowInstanceRef:a,setSuccessMessage:i,setShowSuccess:o,fetchAgents:r}=e;const l=fn(),c=(0,s.useCallback)(async e=>{try{const s=await fe.AgentService.createAgent(e);if(!s)throw new Error("Failed to create agent in backend");await new Promise(e=>setTimeout(e,100));const l=t,c={x:100,y:100};if(l.length>0){const e=Math.max(...l.map(e=>e.position.y+(e.height||80)));c.y=e+100,c.x=Math.min(Math.max(c.x,50),500),c.y=Math.min(Math.max(c.y,50),800)}const d={id:"agent-"+s.id,type:"agentNode",position:c,width:180,height:180,data:{label:s.name,role:s.role,goal:s.goal,backstory:s.backstory,tools:s.tools||[],llm:s.llm,agentId:s.id,isActive:!1,isCompleted:!1},selected:!0};n([{type:"add",item:d}]),setTimeout(()=>{var e;null==(e=a.current)||e.fitView({duration:800,padding:.2})},100),i('Agent "'+s.name+'" generated successfully and added to canvas'),o(!0),r&&await r()}catch(s){l.setErrorMessage("Failed to create agent: "+(s instanceof Error?s.message:"Unknown error"))}},[t,n,a,i,o,r,l]),d=(0,s.useCallback)(async e=>{if(a.current)try{const t=a.current.getNodes().filter(e=>"agentNode"===e.type);if(0===t.length)return l.setErrorMessage("No agent nodes found on the canvas"),void l.setShowError(!0);const s=t.map(async t=>{var n;const a=null==(n=t.data)?void 0:n.agentId;if(a)try{const t=await fe.AgentService.getAgent(a);if(!t)return null;const n=Object.assign({},t,{llm:e});return await fe.AgentService.updateAgentFull(a,n)}catch(s){return null}}),r=(await Promise.all(s)).filter(Boolean).length;if(a.current){const t=a.current.getNodes().map(t=>"agentNode"===t.type?Object.assign({},t,{data:Object.assign({},t.data,{llm:e})}):t);a.current.setNodes(t),n(t.map(e=>({type:"reset",item:e})))}i("Updated "+r+" out of "+t.length+" agents to use "+e),o(!0)}catch(t){l.setErrorMessage("Failed to update agents: "+(t instanceof Error?t.message:"Unknown error"))}},[a,i,o,l,n]),u=(0,s.useCallback)(async e=>{if(a.current)try{const t=a.current.getNodes().filter(e=>"agentNode"===e.type);if(0===t.length)return l.setErrorMessage("No agent nodes found on the canvas"),void l.setShowError(!0);const s=t.map(async t=>{var n;const a=null==(n=t.data)?void 0:n.agentId;if(a)try{const t=await fe.AgentService.getAgent(a);if(!t)return null;const n=Object.assign({},t,{max_rpm:e});return await fe.AgentService.updateAgentFull(a,n)}catch(s){return null}}),r=(await Promise.all(s)).filter(Boolean).length;if(a.current){const t=a.current.getNodes().map(t=>"agentNode"===t.type?Object.assign({},t,{data:Object.assign({},t.data,{max_rpm:e})}):t);a.current.setNodes(t),n(t.map(e=>({type:"reset",item:e})))}i("Updated "+r+" out of "+t.length+" agents to use "+e+" RPM"),o(!0)}catch(t){l.setErrorMessage("Failed to update agents: "+(t instanceof Error?t.message:"Unknown error"))}},[a,i,o,l,n]);return{handleAgentGenerated:c,handleUpdateAllAgentsLLM:d,handleUpdateAllAgentsMaxRPM:u}})({nodes:t,onNodesChange:r,reactFlowInstanceRef:U,setSuccessMessage:Q,setShowSuccess:Y,fetchAgents:G}),{handleTaskGenerated:ze}=yn({nodes:t,onNodesChange:r,reactFlowInstanceRef:U,setSuccessMessage:Q,setShowSuccess:Y}),{handleCrewSelect:Le,handleFlowSelect:We}=(e=>{let{onNodesChange:t,onEdgesChange:n,setSuccessMessage:a,setShowSuccess:i}=e;return{handleCrewSelect:(0,s.useCallback)((e,s)=>{t(e.map(e=>({type:"add",item:e}))),n(s.map(e=>({type:"add",item:e}))),a("Crew loaded successfully"),i(!0)},[t,n,a,i]),handleFlowSelect:(0,s.useCallback)((e,s,o)=>{t(e.map(e=>({type:"add",item:e}))),n(s.map(e=>({type:"add",item:e}))),a("Flow loaded successfully"),i(!0)},[t,n,a,i])}})({onNodesChange:r,onEdgesChange:l,setSuccessMessage:Q,setShowSuccess:Y}),{handleChangeToolsForAllAgents:Re}=(e=>{let{reactFlowInstanceRef:t,setSuccessMessage:n,setShowSuccess:a}=e;const i=fn(),o=(0,s.useCallback)(async e=>{if(t.current)try{const s=t.current.getNodes().filter(e=>"agentNode"===e.type);if(0===s.length)return i.setErrorMessage("No agent nodes found on the canvas"),void i.setShowError(!0);const o=s.map(async t=>{var n;const a=null==(n=t.data)?void 0:n.agentId;if(a)try{const t=await fe.AgentService.getAgent(a);if(!t)return null;const n=Object.assign({},t,{tools:e});return await fe.AgentService.updateAgentFull(a,n)}catch(s){return null}}),r=(await Promise.all(o)).filter(Boolean).length;if(t.current){const n=t.current.getNodes().map(t=>"agentNode"===t.type?Object.assign({},t,{data:Object.assign({},t.data,{tools:e})}):t);t.current.setNodes(n)}n("Updated "+r+" out of "+s.length+" agents with "+e.length+" tools"),a(!0)}catch(s){i.setErrorMessage("Failed to update agents: "+(s instanceof Error?s.message:"Unknown error"))}},[t,i,n,a]);return{handleChangeToolsForAllAgents:o}})({reactFlowInstanceRef:U,setSuccessMessage:Q,setShowSuccess:Y}),{handleChangeLLM:Fe,handleChangeMaxRPM:Be,handleChangeTools:Ve,handleExecuteCrewButtonClick:Ue}=(e=>{let{nodes:t,edges:n,setIsLLMSelectionDialogOpen:a,setIsMaxRPMSelectionDialogOpen:i,setIsToolDialogOpen:o,handleExecuteCrew:r,setSuccessMessage:l,setShowSuccess:c}=e;const d=fn();return{handleChangeLLM:(0,s.useCallback)(()=>{if(0===t.filter(e=>"agentNode"===e.type).length){const e="This operation requires at least one agent node. Currently have 0 agents.";return void d.setErrorMessage(e)}a(!0)},[t,d,a]),handleChangeMaxRPM:(0,s.useCallback)(()=>{if(0===t.filter(e=>"agentNode"===e.type).length){const e="This operation requires at least one agent node. Currently have 0 agents.";return void d.setErrorMessage(e)}i(!0)},[t,d,i]),handleChangeTools:(0,s.useCallback)(()=>{if(0===t.filter(e=>"agentNode"===e.type).length){const e="This operation requires at least one agent node. Currently have 0 agents.";return void d.setErrorMessage(e)}o(!0)},[t,d,o]),handleExecuteCrewButtonClick:(0,s.useCallback)(async()=>{try{const e=t.map(e=>Object.assign({},e)),a=n.map(e=>Object.assign({},e)),s=await r(e,a);null!=s&&s.job_id&&(l(s.job_id),c(!0),setTimeout(()=>{c(!1)},3e3))}catch(e){d.showErrorMessage("Failed to execute crew workflow")}},[r,d,t,n,l,c])}})({nodes:t,edges:n,setIsLLMSelectionDialogOpen:re,setIsMaxRPMSelectionDialogOpen:ce,setIsToolDialogOpen:ue,handleExecuteCrew:Ee,setSuccessMessage:Q,setShowSuccess:Y}),{isGeneratingConnections:He,handleGenerateConnections:Ke}=(e=>{let{reactFlowInstanceRef:t,onConnect:n,setSuccessMessage:a,setShowSuccess:i}=e;const[o,r]=(0,s.useState)(!1);return{isGeneratingConnections:o,handleGenerateConnections:(0,s.useCallback)(async()=>{if(!t.current)return!1;r(!0);try{const e=t.current.getNodes();if(t.current.getEdges().length>0)return a("Cannot generate connections: existing edges found on canvas. Please clear existing connections first."),i(!0),!1;const s=e.filter(e=>"agentNode"===e.type),o=e.filter(e=>"taskNode"===e.type);if(0===s.length||0===o.length)return a("Cannot generate connections: need both agent and task nodes on canvas"),i(!0),!1;let r=0;for(const t of s)for(const e of o){const a={source:t.id,target:e.id,sourceHandle:null,targetHandle:null};n(a),r++}return r>0?(a("Successfully generated "+r+" connections"),i(!0),!0):(a("No new connections were generated"),i(!0),!1)}catch(e){return a("Failed to generate connections"),i(!0),!1}finally{r(!1)}},[t,n,a,i])}})({reactFlowInstanceRef:U,onConnect:c,setSuccessMessage:Q,setShowSuccess:Y}),Ge=(0,s.useCallback)(async()=>(await Ke(),Promise.resolve()),[Ke]);(0,s.useEffect)(()=>{(t.length>0||n.length>0)&&0===t.length&&0===n.length&&(r(t.map(e=>({type:"add",item:e}))),l(n.map(e=>({type:"add",item:e}))))},[t,n,r,l]),(0,s.useEffect)(()=>{const e=console.error;return console.error=function(t){if("string"!==typeof t||!(t.includes("ResizeObserver loop")||t.includes("ResizeObserver Loop")||t.includes("ResizeObserver")||t.includes("undelivered notifications"))){for(var n=arguments.length,a=new Array(n>1?n-1:0),s=1;s<n;s++)a[s-1]=arguments[s];e(t,...a)}},()=>{console.error=e}},[]),(0,s.useEffect)(()=>{const e=e=>{e.message&&(e.message.includes("react-flow")||e.message.includes("ReactFlow")||e.message.includes("Uncaught")&&e.message.includes("rendering"))&&K.setErrorMessage(e.message)};return window.addEventListener("error",e),()=>{window.removeEventListener("error",e)}},[K]),(0,s.useLayoutEffect)(()=>{B(!0);const e=setTimeout(()=>{B(!1)},50);return()=>clearTimeout(e)},[]),(0,s.useEffect)(()=>{K.showError&&K.clearError()},[K]);const qe=s.useMemo(()=>t.filter(e=>{var t;if(!e||"object"!==typeof e)return!1;const n=(null==(t=e.type)?void 0:t.toLowerCase())||"",a="agentnode"===n||"tasknode"===n||"managernode"===n;return e.type,a}).map(e=>{var t,n;const a="agentNode"===e.type?170:"managerNode"===e.type?200:270,s="agentNode"===e.type?170:"managerNode"===e.type?150:135;var i,o,r,l;return e.style&&(e.style.width||e.style.height)?Object.assign({},e,{width:"number"===typeof e.width?e.width:"number"===typeof(null==(t=e.style)?void 0:t.width)?e.style.width:a,height:"number"===typeof e.height?e.height:"number"===typeof(null==(n=e.style)?void 0:n.height)?e.style.height:s}):Object.assign({},e,{width:"number"===typeof(null==(i=e.style)?void 0:i.width)?e.style.width:a,height:"number"===typeof(null==(o=e.style)?void 0:o.height)?e.style.height:s,style:Object.assign({},e.style,{width:(null==(r=e.style)?void 0:r.width)||a,height:(null==(l=e.style)?void 0:l.height)||s})})}),[t]),Je=(0,s.useCallback)(e=>{U.current=e;try{setTimeout(()=>{window.dispatchEvent(new Event("crewFlowInitialized")),window.dispatchEvent(new Event("fitViewToNodesInternal"))},150),p&&p(e)}catch(t){}},[p]),Ye=s.useMemo(()=>{try{const e=new Set(t.map(e=>e.id)),a=new Map;n.forEach(t=>{"manager-node"===t.source||t.target;if(t&&"object"===typeof t&&t.source&&t.target&&e.has(t.source)&&e.has(t.target)){const e=t.source+"-"+t.target+"-"+(t.sourceHandle||"default")+"-"+(t.targetHandle||"default");if(!a.has(e)){const n=t.source.startsWith("task-")&&t.target.startsWith("task-"),s=t.source.startsWith("agent-")&&t.target.startsWith("task-"),i=Object.assign({},t,{animated:!(!n&&!s)||(t.animated||!1)});a.set(e,i)}}});const s=Array.from(a.values());return s.map(e=>Object.assign({},e,{id:e.id,type:e.type||"default"}))}catch(e){return[]}},[n,t]);(0,s.useEffect)(()=>{},[qe,Ye]);const Xe=(0,s.useCallback)((e,t)=>{r(e.map(e=>({type:"remove",id:e.id})));const a=(0,y.AX)(e,n),s=new Set([...t.map(e=>e.id),...a.map(e=>e.id)]);l(Array.from(s).map(e=>({type:"remove",id:e})))},[r,l,n]);(0,hn.h)({flowInstance:U.current,onDeleteSelected:Xe,onClearCanvas:Oe,onZoomIn:()=>{var e;return null==(e=U.current)?void 0:e.zoomIn()},onZoomOut:()=>{var e;return null==(e=U.current)?void 0:e.zoomOut()},onFitView:x,onExecuteFlow:()=>{if(t.length>0||n.length>0){const e=t.map(e=>Object.assign({},e)),a=n.map(e=>Object.assign({},e));return Ee(e,a)}},onGenerateConnections:Ge,onOpenSaveCrew:()=>{const e=new CustomEvent("openSaveCrewDialog");window.dispatchEvent(e)},onOpenCrewFlowDialog:()=>ie(!0),onChangeLLMForAllAgents:Fe,onChangeMaxRPMForAllAgents:Be,onChangeToolsForAllAgents:Ve,onOpenLLMDialog:()=>re(!0),onOpenToolDialog:()=>ue(!0),onOpenMaxRPMDialog:()=>ce(!0),onOpenMCPConfigDialog:()=>me(!0),disabled:!1,useWorkflowStore:!0,instanceId:"crew-canvas",priority:10}),(0,s.useEffect)(()=>{const e=new MutationObserver(()=>{document.querySelector(".MuiDialog-root")});return e.observe(document.body,{childList:!0,subtree:!0}),()=>e.disconnect()},[]),(0,s.useEffect)(()=>{Qe()},[]);const Qe=async()=>{pe(!0);try{const e=(await xt.m.listEnabledTools()).map(e=>({id:e.id.toString(),title:e.title,description:e.description,icon:e.icon||"",enabled:e.enabled}));ve(e)}catch(e){}finally{pe(!1)}};(0,s.useEffect)(()=>{const e=()=>{window.dispatchEvent(new Event("fitViewToNodesInternal"))},t=()=>{$(!0)},n=()=>{te(!0)},a=e=>{const{id:t}=e.detail;l([{type:"remove",id:t}])};return window.addEventListener("fitViewToNodes",e),window.addEventListener("openAgentGenerationDialog",t),window.addEventListener("openTaskGenerationDialog",n),window.addEventListener("edge:delete",a),()=>{window.removeEventListener("fitViewToNodes",e),window.removeEventListener("openAgentGenerationDialog",t),window.removeEventListener("openTaskGenerationDialog",n),window.removeEventListener("edge:delete",a)}},[t,r,l,K]);const Ze=(0,s.useCallback)(async e=>{const t=parseInt(e,10);isNaN(t)||await Me(t)},[Me]);return(0,W.jsxs)(i.A,{ref:V,sx:{width:"100%",height:"100%",display:"flex",flexDirection:"column",position:"relative",backgroundColor:H?"#1a1a1a":"#f5f5f5"},children:[K.showError?(0,W.jsxs)(i.A,{sx:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",backgroundColor:"rgba(255, 255, 255, 0.9)",padding:2,borderRadius:1,maxWidth:"80%",textAlign:"center",zIndex:1e3,border:"1px solid #f44336",color:"#f44336"},children:[(0,W.jsxs)("div",{children:["Error in ReactFlow component: ",K.errorMessage]}),(0,W.jsx)(g.A,{onClick:()=>K.clearError(),children:"Dismiss"})]}):null,F?(0,W.jsx)(i.A,{sx:{display:"flex",justifyContent:"center",alignItems:"center",height:"100%",color:H?"#fff":"#333"},children:"Loading..."}):(0,W.jsxs)(y.Gc,{"data-tour":"canvas-area",nodes:qe,edges:Ye,onNodesChange:De,onEdgesChange:Te,edgeUpdaterRadius:10,reconnectRadius:10,onConnect:c,onSelectionChange:d,onPaneContextMenu:m,onInit:Je,nodeTypes:va,edgeTypes:Aa,connectionMode:y.WZ.Loose,attributionPosition:"bottom-left",minZoom:.1,maxZoom:4,defaultViewport:{x:0,y:0,zoom:1},proOptions:{hideAttribution:!0},style:{background:H?"#1a1a1a":"#f8f8f8"},nodesDraggable:!0,nodesConnectable:!0,elementsSelectable:!0,edgesFocusable:!1,selectNodesOnDrag:!0,selectionOnDrag:!0,panOnDrag:[1,2],translateExtent:[[-1e4,-1e4],[1e4,1e4]],nodeExtent:[[-1e4,-1e4],[1e4,1e4]],snapToGrid:!1,snapGrid:[15,15],multiSelectionKeyCode:"Shift",selectionKeyCode:"Shift",deleteKeyCode:"Delete",elevateEdgesOnSelect:!1,elevateNodesOnSelect:!0,children:[(0,W.jsx)(J.V,{color:H?"#333":"#aaa",gap:16,size:1,variant:J._.Dots}),(0,W.jsx)(wn,{nodes:t,edges:n,setNodes:a,setEdges:o}),(0,W.jsx)(Pn,{onOpenLogsDialog:I,onToggleChat:T,isChatOpen:D,setIsAgentDialogOpen:O,setIsTaskDialogOpen:N,setIsFlowDialogOpen:P,showRunHistory:M,executionHistoryHeight:z})]},"crew-canvas"),(0,W.jsx)(u.A,{open:q,autoHideDuration:4e3,onClose:()=>Y(!1),anchorOrigin:{vertical:"bottom",horizontal:"left"},children:(0,W.jsx)(h.A,{onClose:()=>Y(!1),severity:"success",sx:{width:"100%"},children:X})}),(0,W.jsx)(Wn,{open:Z,onClose:()=>$(!1),onAgentGenerated:Ne,tools:be,selectedTools:Ae,onToolsChange:je}),(0,W.jsx)(Rn,{open:ee,onClose:()=>te(!1),onTaskGenerated:ze}),(0,W.jsx)(Un,{open:ne,onClose:()=>ae(!1),onGenerateCrew:(e,t)=>{const n=[],a=[];e.agents.forEach((e,t)=>{const a="agent-"+e.id;n.push({id:a,type:"agentNode",position:{x:80,y:100+150*t},data:{label:e.name,agentId:e.id,role:e.role||"",goal:e.goal||"",backstory:e.backstory||"",llm:e.llm||Ce,tools:e.tools||[],agent:e}})}),e.tasks.forEach((e,t)=>{const a="task-"+e.id;n.push({id:a,type:"taskNode",position:{x:360,y:100+150*t},data:{label:e.name,taskId:e.id,description:e.description||e.name,expected_output:e.expected_output||"",human_input:e.human_input||!1,tools:e.tools||[],async_execution:void 0!==e.async_execution&&Boolean(e.async_execution),context:e.context||[],config:{markdown:e.markdown||!1},task:e}})}),e.tasks.forEach(e=>{const t="task-"+e.id;if(e.agent_id){const n="agent-"+e.agent_id;a.push({id:"edge-"+e.id,source:n,target:t,type:"default",animated:!0,sourceHandle:"right",targetHandle:"left"})}}),r(n.map(e=>({type:"add",item:e}))),l(a.map(e=>({type:"add",item:e}))),t&&Ue()},selectedModel:Ce,tools:be.map(e=>Object.assign({},e,{icon:e.icon||""})),selectedTools:Ae,onToolsChange:je}),(0,W.jsx)(oa,{open:se,onClose:()=>ie(!1),onCrewSelect:Le,onFlowSelect:We}),(0,W.jsx)(la,{open:oe,onClose:()=>re(!1),onSelectLLM:Pe}),(0,W.jsx)(da,{open:le,onClose:()=>ce(!1),onSelectMaxRPM:Ze}),(0,W.jsx)(ua,{open:de,onClose:()=>ue(!1),onSelectTools:Re}),(0,W.jsx)(ba,{open:he,onClose:()=>me(!1)})]})},wa=(0,s.memo)(ja);var ka=n(37630),Ca=n(71722),Sa=n(35867),_a=n(77106),Ea=n(79724),Ia=n(26350),Ta=n(14857);const Da=e=>{let{onClearCanvas:t,onZoomIn:n,onZoomOut:a,onFitView:i,onToggleInteractivity:o,isHorizontal:r=!0,isLeftToRight:l=!0,children:c}=e;const[d,u]=(0,s.useState)(null),h=(0,Ta.A)(),m={width:"24px",height:"24px",padding:"4px",fontSize:"12px",opacity:.8,backgroundColor:h.palette.background.paper,border:"1px solid "+h.palette.divider,cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",transition:"all 0.2s ease-in-out"},g=e=>Object.assign({},m,{backgroundColor:d===e?h.palette.action.hover:h.palette.background.paper,border:"1px solid "+h.palette.divider,color:h.palette.text.primary});return(0,W.jsxs)(ka.H,{style:{position:"absolute",top:0,left:0,zIndex:10,pointerEvents:"all",padding:"4px",backgroundColor:"dark"===h.palette.mode?"rgba(0, 0, 0, 0.8)":"rgba(255, 255, 255, 0.9)",borderRadius:"4px",boxShadow:h.shadows[1],width:"fit-content",height:"fit-content",display:"flex",flexDirection:"column",gap:"4px"},children:[n&&(0,W.jsx)(ka.a,{onClick:n,title:"Zoom In",style:g("zoomIn"),onMouseEnter:()=>u("zoomIn"),onMouseLeave:()=>u(null),children:(0,W.jsx)(Sa.A,{sx:{fontSize:16,color:h.palette.text.primary}})}),a&&(0,W.jsx)(ka.a,{onClick:a,title:"Zoom Out",style:g("zoomOut"),onMouseEnter:()=>u("zoomOut"),onMouseLeave:()=>u(null),children:(0,W.jsx)(_a.A,{sx:{fontSize:16,color:h.palette.text.primary}})}),i&&(0,W.jsx)(ka.a,{onClick:i,title:"Fit View",style:g("fitView"),onMouseEnter:()=>u("fitView"),onMouseLeave:()=>u(null),children:(0,W.jsx)(Ea.A,{sx:{fontSize:16,color:h.palette.text.primary}})}),o&&(0,W.jsx)(ka.a,{onClick:o,title:"Toggle Interactivity",style:g("interactivity"),onMouseEnter:()=>u("interactivity"),onMouseLeave:()=>u(null),children:(0,W.jsx)(Ia.A,{sx:{fontSize:16,color:h.palette.text.primary}})}),(0,W.jsx)(ka.a,{onClick:t,title:"Clear Canvas",style:g("clear"),onMouseEnter:()=>u("clear"),onMouseLeave:()=>u(null),children:(0,W.jsx)(Ca.A,{sx:{fontSize:16,color:h.palette.text.primary}})}),c]})},Oa=e=>(0,W.jsx)(Da,Object.assign({},e)),Na={crewNode:on},Pa={default:cn,crewEdge:ln};if("undefined"!==typeof window){const e=e=>{e.message&&(e.message.includes("ResizeObserver loop")||e.message.includes("ResizeObserver Loop"))&&(e.stopImmediatePropagation(),e.preventDefault())};window.addEventListener("error",e),window.addEventListener("unhandledrejection",e=>{e.reason&&e.reason.message&&(e.reason.message.includes("ResizeObserver loop")||e.reason.message.includes("ResizeObserver Loop"))&&e.preventDefault()})}const Ma=e=>{let{nodes:t,edges:n,onNodesChange:a,onEdgesChange:o,onConnect:r,onSelectionChange:l,onPaneContextMenu:c,onInit:d}=e;const{isDarkMode:m}=f(),[g,p]=(0,s.useState)(!1),x=(0,s.useRef)(null),b=(0,s.useRef)(null),[v,A]=(0,s.useState)(!0),[j,w]=(0,s.useState)(!1),[k,C]=(0,s.useState)(!1),[S,_]=(0,s.useState)(!1),[E,I]=(0,s.useState)(""),T=(0,s.useCallback)(e=>{I(e),_(!0),setTimeout(()=>{_(!1)},3e3)},[]),D=(0,s.useCallback)(()=>{const e=t.filter(e=>"crewNode"===e.type).map(e=>e.id);if(e.length>0){const t=e.map(e=>({id:e,type:"remove"}));a(t)}const s=n.filter(t=>e.includes(t.source)||e.includes(t.target)).map(e=>({id:e.id,type:"remove"}));s.length>0&&o(s),T("Canvas cleared: removed "+e.length+" nodes and "+s.length+" edges")},[t,n,a,o,T]),O=(0,s.useCallback)((e,t)=>{if(e.length>0){const t=e.map(e=>({id:e.id,type:"remove"}));a(t)}const s=e.length>0?(0,y.AX)(e,n):[],i=new Set([...t.map(e=>e.id),...s.map(e=>e.id)]);if(i.size>0){const e=Array.from(i).map(e=>({id:e,type:"remove"}));o(e)}(e.length>0||i.size>0)&&T("Deleted "+e.length+" nodes and "+i.size+" edges")},[a,o,T,n]),{shortcuts:N}=(0,hn.h)({flowInstance:x.current,onDeleteSelected:O,onClearCanvas:D,onFitView:()=>{x.current&&(x.current.fitView({padding:.2}),T("Fit view to all nodes"))},onOpenFlowDialog:()=>{const e=new CustomEvent("openFlowDialog");window.dispatchEvent(e),T("Opening Flow selection dialog (press lf)")},disabled:v||k,instanceId:"flow-canvas",priority:5}),P=s.useMemo(()=>{try{return t.filter(e=>{var t,n;if(!e||"object"!==typeof e)return!1;const a=(null==(t=e.data)||null==(t=t.label)?void 0:t.toLowerCase())||"",s=(null==(n=e.type)?void 0:n.toLowerCase())||"";return a.includes("flow")||s.includes("flow")||"crewnode"===s||e.data&&e.data.flowConfig})}catch(e){return[]}},[t]),M=(0,s.useRef)(P.length),z=(0,s.useRef)(!1);(0,s.useEffect)(()=>{const e=M.current,t=P.length;if(!v&&x.current&&t>0){if(!z.current||Math.abs(t-e)>0){z.current||(z.current=!0),M.current=t;const e=setTimeout(()=>{x.current&&window.requestAnimationFrame(()=>{var e;null==(e=x.current)||e.fitView({padding:.2,includeHiddenNodes:!1,duration:800})})},300);return()=>clearTimeout(e)}}},[P.length,v]);const L=s.useMemo(()=>P.map(e=>{var t,n;return e.style&&(e.style.width||e.style.height)?e:Object.assign({},e,{style:Object.assign({},e.style,{width:(null==(t=e.style)?void 0:t.width)||180,height:(null==(n=e.style)?void 0:n.height)||80})})}),[P]);(0,s.useLayoutEffect)(()=>{A(!0);const e=setTimeout(()=>{j||w(!0)},0),t=setTimeout(()=>{A(!1)},100);return()=>{clearTimeout(e),clearTimeout(t)}},[j,P.length]),(0,s.useEffect)(()=>{k&&C(!1)},[t,n,k]);const R=(0,s.useCallback)(e=>{x.current=e,setTimeout(()=>{if(e)try{if(P.length>0){const t=new Map,n=[];P.forEach(e=>{const n=Math.round(e.position.x)+","+Math.round(e.position.y);t.has(n)||t.set(n,[]),t.get(n).push(e)});let a=!1;if(t.forEach((e,t)=>{e.length>1?(a=!0,e.forEach((t,a)=>{if(0===a)n.push(t);else{const s=Math.ceil(Math.sqrt(e.length)),i=300*(a%s),o=200*Math.floor(a/s);n.push(Object.assign({},t,{position:{x:t.position.x+i,y:t.position.y+o}}))}})):n.push(e[0])}),n.length>0&&a){e.setNodes(n);const t=e.getEdges();if(t.filter(e=>!e.type||"default"===e.type).length>0){const n=t.map(e=>e.type&&"default"!==e.type?e:Object.assign({},e,{type:"crewEdge",animated:!0}));e.setEdges(n)}new Map(n.map(e=>[e.id,e]));const a=new Set(t.map(e=>e.source+"-"+e.target)),s=[];n.forEach(e=>{var t;if(null!=(t=e.data)&&null!=(t=t.flowConfig)&&t.listeners){e.data.flowConfig.listeners.forEach(e=>{if(e.crewId){const t=n.filter(t=>{var n;return(null==(n=t.data)?void 0:n.crewId)===e.crewId});e.listenToTaskIds&&e.listenToTaskIds.length>0&&e.listenToTaskIds.forEach(i=>{let o=null;if(i.includes(":")&&([o]=i.split(":")),o){const i=n.filter(e=>{var t,n;return(null==(t=e.data)?void 0:t.crewId)===Number(o)||(null==(n=e.data)?void 0:n.crewId)===o});t.forEach(t=>{i.forEach(n=>{const i=t.id+"-"+n.id;if(!a.has(i)&&t.id!==n.id){const o=e.tasks&&Array.isArray(e.tasks)?e.tasks.map(e=>e.name).join(", "):"Task",r=t.position.x,l=t.position.y,c=n.position.x,d=n.position.y;let u,h;c>r+200?(u="right",h="left-target"):c<r-200?(u="left",h="right-target"):d>l+100?(u="bottom",h="top-target"):(u="top",h="bottom-target"),s.push({id:"edge-"+t.id+"-"+n.id+"-"+Date.now(),source:t.id,target:n.id,sourceHandle:u,targetHandle:h,type:"crewEdge",animated:!0,data:{label:o}}),a.add(i)}})})}})}})}}),s.length>0&&e.setEdges([...t,...s])}e.fitView({padding:.2,includeHiddenNodes:!1})}}catch(t){}},200),d&&d(e)},[d,P]),F=s.useMemo(()=>{try{const e=new Set(P.map(e=>e.id));return n.filter(t=>t&&"object"===typeof t&&t.source&&t.target&&e.has(t.source)&&e.has(t.target))}catch(e){return[]}},[n,P]),B=(0,s.useCallback)(e=>{const t=new Set(P.map(e=>e.id)),n=e.filter(e=>{switch(e.type){case"position":case"dimensions":case"remove":case"select":return t.has(e.id);case"add":return e.item&&t.has(e.item.id);default:return!0}});n.length>0&&a(n)},[P,a]);return(0,s.useEffect)(()=>{const e=e=>{e.detail&&e.detail.message&&T(e.detail.message)};return window.addEventListener("showNotification",e),()=>{window.removeEventListener("showNotification",e)}},[T]),(0,W.jsxs)(i.A,{ref:b,sx:{width:"100%",height:"100%",display:"flex",flexDirection:"column",position:"relative",backgroundColor:m?"#1a1a1a":"#f5f5f5"},children:[v?(0,W.jsx)(i.A,{sx:{display:"flex",justifyContent:"center",alignItems:"center",height:"100%",color:"text.secondary",fontSize:"0.875rem"},children:k?"Error rendering canvas":"Loading flow canvas..."}):(0,W.jsxs)(y.Gc,{nodes:L,edges:F,onNodesChange:B,onEdgesChange:o,onConnect:r,onInit:R,nodeTypes:Na,edgeTypes:Pa,onSelectionChange:l,onPaneContextMenu:c,proOptions:{hideAttribution:!0},connectionMode:y.WZ.Loose,snapToGrid:!0,minZoom:.1,maxZoom:4,style:{background:m?"#1a1a1a":"#f5f5f5"},children:[(0,W.jsx)(J.V,{color:m?"#333":"#aaa",gap:16,size:1,variant:J._.Dots}),g&&(0,W.jsx)(Oa,{onClearCanvas:D})]}),(0,W.jsx)(i.A,{sx:{position:"absolute",bottom:10,left:10,fontSize:"0.75rem",color:"text.secondary",opacity:.7,pointerEvents:"none"},children:'Tip: Press "del" to delete selected items, dd to clear canvas'}),(0,W.jsx)(u.A,{open:S,autoHideDuration:3e3,onClose:()=>_(!1),anchorOrigin:{vertical:"bottom",horizontal:"right"},children:(0,W.jsx)(h.A,{severity:"info",sx:{width:"100%"},children:E})})]})},za=(0,s.memo)(Ma),La=e=>{let{areFlowsVisible:t,showRunHistory:n,panelPosition:a,isDraggingPanel:s,isDarkMode:o,nodes:r,edges:l,setNodes:c,setEdges:d,onNodesChange:u,onEdgesChange:h,onConnect:m,onSelectionChange:g,onPaneContextMenu:p,onCrewFlowInit:x,onFlowFlowInit:f,onPanelDragStart:y,handleUIAwareFitView:b,planningEnabled:v,setPlanningEnabled:A,reasoningEnabled:j,setReasoningEnabled:w,schemaDetectionEnabled:k,setSchemaDetectionEnabled:S,selectedModel:_,setSelectedModel:E,onOpenLogsDialog:I,onToggleChat:T,isChatOpen:D,setIsAgentDialogOpen:O,setIsTaskDialogOpen:N,setIsFlowDialogOpen:P,onOpenTutorial:M,onOpenConfiguration:z}=e;const{crewAIFlowEnabled:L}=(0,C.d)();return t&&L?(0,W.jsxs)(i.A,{sx:{height:"100%",position:"relative",mt:0,mb:0,borderBottom:"1px solid",borderColor:o?"rgba(255,255,255,0.1)":"rgba(0,0,0,0.1)",display:"grid",gridTemplateColumns:a+"% "+(100-a)+"%",overflow:"hidden",width:"100%",maxWidth:"100%",transition:s?"none":"grid-template-columns 0.3s ease-in-out"},children:[(0,W.jsx)(i.A,{sx:{position:"relative",width:"100%",height:"100%",borderRight:"1px solid "+(o?"rgba(255,255,255,0.1)":"rgba(0,0,0,0.1)")},"data-crew-container":!0,children:(0,W.jsx)(wa,{nodes:r,edges:l,setNodes:c,setEdges:d,onNodesChange:u,onEdgesChange:h,onConnect:m,onSelectionChange:g,onPaneContextMenu:p,onInit:x,handleUIAwareFitView:b,planningEnabled:v,setPlanningEnabled:A,reasoningEnabled:j,setReasoningEnabled:w,schemaDetectionEnabled:k,setSchemaDetectionEnabled:S,selectedModel:_,setSelectedModel:E,onOpenLogsDialog:I,onToggleChat:T,isChatOpen:D,setIsAgentDialogOpen:O,setIsTaskDialogOpen:N,setIsFlowDialogOpen:P,showRunHistory:n,onOpenTutorial:M,onOpenConfiguration:z})}),(0,W.jsx)(i.A,{sx:{position:"absolute",top:0,left:a+"%",width:"8px",height:"100%",transform:"translateX(-50%)",cursor:"col-resize",zIndex:100,background:o?"rgba(255,255,255,0.05)":"rgba(0,0,0,0.05)","&::after":{content:'""',position:"absolute",top:0,left:"50%",width:"2px",height:"100%",transform:"translateX(-50%)",backgroundColor:o?"rgba(255,255,255,0.2)":"rgba(0,0,0,0.15)"},"&:hover":{background:o?"rgba(255,255,255,0.1)":"rgba(0,0,0,0.08)","&::after":{backgroundColor:o?"rgba(255,255,255,0.4)":"rgba(0,0,0,0.3)"}},"&:active":{background:o?"rgba(255,255,255,0.15)":"rgba(0,0,0,0.12)","&::after":{backgroundColor:o?"rgba(255,255,255,0.5)":"rgba(0,0,0,0.4)"}}},onMouseDown:y}),(0,W.jsx)(i.A,{sx:{position:"relative",width:"100%",height:"100%"},children:(0,W.jsx)(za,{nodes:r,edges:l,onNodesChange:u,onEdgesChange:h,onConnect:m,onSelectionChange:g,onPaneContextMenu:p,onInit:f})})]}):(0,W.jsx)(i.A,{sx:{height:"100%",position:"relative",mt:0,mb:0,borderBottom:"1px solid",borderColor:o?"rgba(255,255,255,0.1)":"rgba(0,0,0,0.1)",display:"block",overflow:"hidden",width:"100%",maxWidth:"100%"},children:(0,W.jsx)(i.A,{sx:{width:"100%",height:"100%",position:"relative"},"data-crew-container":!0,children:(0,W.jsx)(wa,{nodes:r,edges:l,setNodes:c,setEdges:d,onNodesChange:u,onEdgesChange:h,onConnect:m,onSelectionChange:g,onPaneContextMenu:p,onInit:x,handleUIAwareFitView:b,planningEnabled:v,setPlanningEnabled:A,reasoningEnabled:j,setReasoningEnabled:w,schemaDetectionEnabled:k,setSchemaDetectionEnabled:S,selectedModel:_,setSelectedModel:E,onOpenLogsDialog:I,onToggleChat:T,isChatOpen:D,setIsAgentDialogOpen:O,setIsTaskDialogOpen:N,setIsFlowDialogOpen:P,showRunHistory:n,onOpenTutorial:M,onOpenConfiguration:z})})})};var Wa=n(99699),Ra=n(3124),Fa=n(55379),Ba=n(66592),Va=n(27898),Ua=n(40379),Ha=n(49939),Ka=n(16724),Ga=n(31902),qa=n(95699),Ja=n(41413),Ya=n(73998),Xa=n(16983),Qa=n(18617),Za=n(45679),$a=n(21690),es=n(44193);const ts=()=>{const[e,t]=(0,s.useState)(null),n=(0,es.Q)(e=>e.groups),a=(0,es.Q)(e=>e.isLoading),o=(0,es.Q)(e=>e.getCurrentGroup()),r=(0,es.Q)(e=>e.fetchMyGroups),l=(0,es.Q)(e=>e.setCurrentGroup),[u,h]=(0,s.useState)(!1),g=(0,_.a)(e=>e.clearRunHistory),{currentUser:p,isLoadingUser:x,fetchCurrentUser:f}=(0,$a.k)(e=>({currentUser:e.currentUser,isLoadingUser:e.isLoading,fetchCurrentUser:e.fetchCurrentUser})),y=Boolean(e);(0,s.useEffect)(()=>{p||f()},[p,f]),(0,s.useEffect)(()=>{null!=p&&p.email&&r()},[null==p?void 0:p.email,r]);const b=()=>{t(null)},v=e=>{switch(e){case"ADMIN":return"error";case"EDITOR":return"success";default:return"default"}},A=(0,s.useMemo)(()=>o?o.id.startsWith("user_")?(0,W.jsx)(Ya.A,{fontSize:"small",sx:{color:"primary.main"}}):(0,W.jsx)(Xa.A,{fontSize:"small",sx:{color:"text.secondary"}}):null,[null==o?void 0:o.id,null==o?void 0:o.name,null==p?void 0:p.email,o]);return a||u||x?(0,W.jsx)(i.A,{sx:{display:"flex",alignItems:"center",p:.5},children:(0,W.jsx)(Y.A,{size:24})}):o?(0,W.jsxs)(W.Fragment,{children:[(0,W.jsx)(M.A,{title:o.id.startsWith("user_")?"My Workspace ("+(null==p?void 0:p.email)+")":o.name+" - Shared Workspace",enterDelay:500,leaveDelay:200,disableInteractive:!0,placement:"bottom",children:(0,W.jsx)(d.A,{id:"group-selector-button","aria-controls":y?"group-menu":void 0,"aria-haspopup":"true","aria-expanded":y?"true":void 0,onClick:e=>{t(e.currentTarget)},size:"small",sx:{p:.5,transition:"background-color 0.2s","&:hover":{backgroundColor:"action.hover"}},children:A})}),(0,W.jsxs)(m.A,{id:"group-menu",anchorEl:e,open:y,onClose:b,disableScrollLock:!0,keepMounted:!1,TransitionProps:{timeout:350},anchorOrigin:{vertical:"bottom",horizontal:"right"},transformOrigin:{vertical:"top",horizontal:"right"},slotProps:{paper:{elevation:2,sx:{minWidth:280,maxHeight:400,mt:.5,overflow:"auto",filter:"drop-shadow(0px 2px 8px rgba(0,0,0,0.08))"}}},MenuListProps:{"aria-labelledby":"group-selector-button",sx:{py:0}},children:[(0,W.jsx)(i.A,{sx:{px:2,py:1,borderBottom:1,borderColor:"divider"},children:(0,W.jsx)(c.A,{variant:"subtitle2",color:"text.secondary",children:"Switch Workspace"})}),n.length>0&&(0,W.jsx)(ne.A,{}),n.map(e=>{const t=e.id.startsWith("user_"),n=(null==o?void 0:o.id)===e.id;return(0,W.jsxs)(de.A,{onClick:()=>(async e=>{try{if((null==o?void 0:o.id)===e.id)return void b();h(!0),g(),l(e.id),b();const t=e.id.startsWith("user_")?"My Workspace":e.name+" workspace";Za.Ay.success("Switched to "+t),setTimeout(()=>{window.location.reload()},300)}catch(t){Za.Ay.error("Failed to switch group")}})(e),selected:n,sx:{minHeight:48,px:2,py:1,"&.Mui-selected":{backgroundColor:"action.selected","&:hover":{backgroundColor:"action.selected"}}},children:[(0,W.jsx)(it.A,{sx:{minWidth:36},children:t?(0,W.jsx)(Ya.A,{fontSize:"small",sx:{color:n?"primary.main":"text.secondary"}}):(0,W.jsx)(Qa.A,{fontSize:"small",sx:{color:n?"primary.main":"text.secondary"}})}),(0,W.jsx)(ot.A,{primary:(0,W.jsxs)(i.A,{sx:{display:"flex",alignItems:"center",gap:1},children:[(0,W.jsx)(c.A,{variant:"body2",sx:{fontWeight:n?600:400},children:t?"My Workspace":e.name}),n&&(0,W.jsx)(V.A,{label:"Active",size:"small",color:"primary",sx:{height:20}})]}),secondary:(0,W.jsx)(c.A,{variant:"caption",color:"text.secondary",children:t?"Personal - "+(null==p?void 0:p.email):"Shared workspace"}),sx:{my:0}}),e.user_role&&!t&&(0,W.jsx)(V.A,{label:e.user_role,size:"small",color:v(e.user_role),sx:{ml:1}})]},e.id)}),0===n.length&&(0,W.jsx)(de.A,{disabled:!0,children:(0,W.jsx)(c.A,{variant:"body2",color:"text.secondary",children:"No groups available"})})]})]}):(0,W.jsx)(i.A,{sx:{display:"flex",alignItems:"center",p:.5},children:(0,W.jsx)(Ja.A,{sx:{width:24,height:24,fontSize:"0.75rem",bgcolor:"grey.400"},children:"?"})})},ns=e=>{let{onRunTab:t,isRunning:n=!1,runningTabId:a=null,onLoadCrew:u,onLoadAgents:h,onLoadTasks:p,disabled:x=!1}=e;const{isDarkMode:y}=f(),{tabs:b,activeTabId:v,createTab:A,closeTab:j,setActiveTab:w,updateTabName:C,duplicateTab:S,clearAllTabs:_,clearTabExecutionStatus:E}=k(),[I,T]=(0,s.useState)(null),[D,O]=(0,s.useState)({anchorEl:null}),[N,P]=(0,s.useState)({open:!1,tabId:"",currentName:""}),[z,L]=(0,s.useState)({open:!1,tabId:"",tabName:""}),[R,F]=(0,s.useState)(!1),B=()=>{O({anchorEl:null})},q=e=>{if("save"===e){const e=b.find(e=>e.id===z.tabId);if(e&&e.savedCrewId)if("loaded"===e.savedCrewId){var t,n;const a=e.nodes.find(e=>{var t;return"agentNode"===e.type&&(null==(t=e.data)?void 0:t.agentId)});null!=a&&null!=(t=a.data)&&t.agentId;const s=e.nodes.find(e=>{var t;return"taskNode"===e.type&&(null==(t=e.data)?void 0:t.taskId)});if(null!=s&&null!=(n=s.data)&&n.taskId,e.name&&(a||s)){const t=new CustomEvent("updateExistingCrewByName",{detail:{tabId:z.tabId,crewName:e.name}});window.dispatchEvent(t);const n=()=>{j(z.tabId),window.removeEventListener("updateCrewComplete",n)};window.addEventListener("updateCrewComplete",n)}else{const e=new CustomEvent("openSaveCrewDialog");window.dispatchEvent(e);const t=()=>{j(z.tabId),window.removeEventListener("saveCrewComplete",t)};window.addEventListener("saveCrewComplete",t)}}else{const t=new CustomEvent("updateExistingCrew",{detail:{tabId:z.tabId,crewId:e.savedCrewId}});window.dispatchEvent(t);const n=()=>{j(z.tabId),window.removeEventListener("updateCrewComplete",n)};window.addEventListener("updateCrewComplete",n)}else{const e=new CustomEvent("openSaveCrewDialog");window.dispatchEvent(e);const t=()=>{j(z.tabId),window.removeEventListener("saveCrewComplete",t)};window.addEventListener("saveCrewComplete",t)}}else"discard"===e&&j(z.tabId);L({open:!1,tabId:"",tabName:""})},J=()=>{T(null)},Y=()=>{N.currentName.trim()&&C(N.tabId,N.currentName.trim()),P({open:!1,tabId:"",currentName:""})};return s.useEffect(()=>{0===b.length&&A("Main Canvas")},[b.length,A]),s.useEffect(()=>{const e=[];return b.forEach(t=>{if(t.executionStatus&&"running"!==t.executionStatus&&t.lastExecutionTime){const n=3e5-(Date.now()-new Date(t.lastExecutionTime).getTime());if(n>0){const a=setTimeout(()=>{E(t.id)},n);e.push(a)}else E(t.id)}}),()=>{e.forEach(e=>clearTimeout(e))}},[b,E]),(0,W.jsxs)(W.Fragment,{children:[(0,W.jsxs)(i.A,{sx:{borderBottom:1,borderColor:"divider",backgroundColor:y?"#1a1a1a":"#ffffff",display:"flex",alignItems:"center",minHeight:"48px",height:"48px",paddingLeft:1,paddingRight:1,position:"relative",zIndex:1001,overflow:"hidden"},children:[(0,W.jsxs)(i.A,{sx:{display:"flex",alignItems:"center",flex:1},children:[(0,W.jsx)(Hn.A,{value:v||!1,onChange:(e,t)=>{x||w(t)},variant:"scrollable",scrollButtons:"auto",sx:{minWidth:0,opacity:x?.6:1,pointerEvents:x?"none":"auto","& .MuiTab-root":{minHeight:"40px",textTransform:"none",fontSize:"0.875rem",fontWeight:500,padding:"8px 12px",minWidth:"auto",maxWidth:"200px",cursor:x?"not-allowed":"pointer","&.Mui-selected":{color:y?"#90caf9":"#1976d2"}},"& .MuiTabs-indicator":{backgroundColor:y?"#90caf9":"#1976d2"}},children:b.map(e=>(0,W.jsx)(Kn.A,{value:e.id,onContextMenu:t=>{return n=t,a=e.id,void(x||(n.preventDefault(),T({mouseX:n.clientX-2,mouseY:n.clientY-4,tabId:a})));var n,a},label:(0,W.jsxs)(i.A,{sx:{display:"flex",alignItems:"center",gap:1,maxWidth:"180px"},children:[(0,W.jsx)(c.A,{variant:"body2",sx:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",flex:1},children:e.name}),(0,W.jsxs)(i.A,{sx:{display:"flex",alignItems:"center",gap:.5},children:[e.isDirty&&(0,W.jsx)(M.A,{title:"Unsaved changes",children:(0,W.jsx)(i.A,{sx:{width:6,height:6,borderRadius:"50%",backgroundColor:y?"#ff9800":"#f57c00"}})}),e.savedCrewId&&!e.isDirty&&(0,W.jsx)(M.A,{title:"Saved as: "+e.savedCrewName,children:(0,W.jsx)(_n.A,{sx:{fontSize:12,color:"success.main"}})}),a===e.id&&n||"running"===e.executionStatus?(0,W.jsx)(V.A,{size:"small",label:"Running",color:"success",sx:{height:16,fontSize:"0.6rem","& .MuiChip-label":{px:.5}}}):null,"completed"===e.executionStatus&&(0,W.jsx)(M.A,{title:e.lastExecutionTime?"Completed at "+new Date(e.lastExecutionTime).toLocaleTimeString():"Completed",children:(0,W.jsx)(V.A,{size:"small",label:"Completed",color:"success",variant:"outlined",sx:{height:16,fontSize:"0.6rem","& .MuiChip-label":{px:.5}}})}),"failed"===e.executionStatus&&(0,W.jsx)(M.A,{title:e.lastExecutionTime?"Failed at "+new Date(e.lastExecutionTime).toLocaleTimeString():"Failed",children:(0,W.jsx)(V.A,{size:"small",label:"Failed",color:"error",variant:"outlined",sx:{height:16,fontSize:"0.6rem","& .MuiChip-label":{px:.5}}})}),b.length>1&&(0,W.jsx)(d.A,{size:"small",onClick:t=>((e,t)=>{if(x)return;t.stopPropagation();const n=b.find(t=>t.id===e);n&&n.isDirty?L({open:!0,tabId:e,tabName:n.name}):j(e)})(e.id,t),sx:{width:16,height:16,padding:0,"&:hover":{backgroundColor:y?"rgba(255,255,255,0.1)":"rgba(0,0,0,0.1)"}},children:(0,W.jsx)(K.A,{sx:{fontSize:12}})})]})]})},e.id))}),(0,W.jsx)(M.A,{title:x?"Tab operations disabled during processing":"New Tab Options",children:(0,W.jsx)("span",{children:(0,W.jsx)(d.A,{onClick:e=>{O({anchorEl:e.currentTarget})},disabled:x,size:"small",sx:{marginLeft:1,padding:"6px",color:y?"rgba(255,255,255,0.7)":"rgba(0,0,0,0.6)","&:hover":{backgroundColor:y?"rgba(255,255,255,0.1)":"rgba(0,0,0,0.1)",color:y?"rgba(255,255,255,0.9)":"rgba(0,0,0,0.8)"},"&.Mui-disabled":{color:y?"rgba(255,255,255,0.3)":"rgba(0,0,0,0.3)"}},children:(0,W.jsxs)(i.A,{sx:{display:"flex",alignItems:"center",gap:.5},children:[(0,W.jsx)(G.A,{sx:{fontSize:18}}),(0,W.jsx)(Wa.A,{sx:{fontSize:14}})]})})})})]}),(0,W.jsx)(i.A,{sx:{display:"flex",alignItems:"center",pl:.25,pr:.75,flexShrink:0,width:"auto",transition:"none"},children:(0,W.jsx)(ts,{})})]}),(0,W.jsxs)(m.A,{open:Boolean(D.anchorEl),onClose:B,anchorEl:D.anchorEl,anchorOrigin:{vertical:"bottom",horizontal:"center"},transformOrigin:{vertical:"top",horizontal:"center"},children:[(0,W.jsxs)(de.A,{onClick:()=>{x||(A(),B())},children:[(0,W.jsx)(it.A,{children:(0,W.jsx)(Ra.A,{sx:{fontSize:18}})}),(0,W.jsx)(ot.A,{primary:"New Empty Canvas",secondary:"Start with a blank canvas"})]}),(0,W.jsxs)(de.A,{onClick:()=>{u&&u(),B()},children:[(0,W.jsx)(it.A,{children:(0,W.jsx)(Fa.A,{sx:{fontSize:18}})}),(0,W.jsx)(ot.A,{primary:"Load Existing Plans",secondary:"Opens in a new tab"})]}),(0,W.jsxs)(de.A,{onClick:()=>{h&&h(),B()},children:[(0,W.jsx)(it.A,{children:(0,W.jsx)(Ba.A,{sx:{fontSize:18}})}),(0,W.jsx)(ot.A,{primary:"Load Existing Agents",secondary:"Adds to current tab"})]}),(0,W.jsxs)(de.A,{onClick:()=>{p&&p(),B()},children:[(0,W.jsx)(it.A,{children:(0,W.jsx)(Va.A,{sx:{fontSize:18}})}),(0,W.jsx)(ot.A,{primary:"Load Existing Tasks",secondary:"Adds to current tab"})]})]}),(0,W.jsxs)(m.A,{open:null!==I,onClose:J,anchorReference:"anchorPosition",anchorPosition:null!==I?{top:I.mouseY,left:I.mouseX}:void 0,children:[(0,W.jsxs)(de.A,{onClick:()=>(e=>{const t=b.find(t=>t.id===e);t&&P({open:!0,tabId:e,currentName:t.name}),J()})((null==I?void 0:I.tabId)||""),children:[(0,W.jsx)(Ua.A,{sx:{mr:1,fontSize:18}}),"Rename"]}),(0,W.jsxs)(de.A,{onClick:()=>{return e=(null==I?void 0:I.tabId)||"",S(e),void J();var e},children:[(0,W.jsx)(Ha.A,{sx:{mr:1,fontSize:18}}),"Duplicate"]}),(0,W.jsxs)(de.A,{onClick:()=>{return e=(null==I?void 0:I.tabId)||"",w(e),setTimeout(()=>{const e=new CustomEvent("openSaveCrewDialog");window.dispatchEvent(e)},100),void J();var e},children:[(0,W.jsx)(_n.A,{sx:{mr:1,fontSize:18}}),"Save Crew"]}),(0,W.jsxs)(de.A,{onClick:()=>{return e=(null==I?void 0:I.tabId)||"",t&&t(e),void J();var e},disabled:n,children:[(0,W.jsx)(Ka.A,{sx:{mr:1,fontSize:18}}),"Run This Tab"]}),(()=>{const e=b.find(e=>e.id===(null==I?void 0:I.tabId));return null!=e&&e.executionStatus&&"running"!==e.executionStatus?(0,W.jsxs)(de.A,{onClick:()=>{E((null==I?void 0:I.tabId)||""),J()},children:[(0,W.jsx)(K.A,{sx:{mr:1,fontSize:18}}),"Clear Execution Status"]}):null})(),b.length>1&&(0,W.jsxs)(de.A,{onClick:()=>{const e=b.find(e=>e.id===(null==I?void 0:I.tabId));e&&e.isDirty?L({open:!0,tabId:(null==I?void 0:I.tabId)||"",tabName:e.name}):j((null==I?void 0:I.tabId)||""),J()},children:[(0,W.jsx)(K.A,{sx:{mr:1,fontSize:18}}),"Close Tab"]}),b.length>0&&(0,W.jsxs)(W.Fragment,{children:[(0,W.jsx)(ne.A,{}),(0,W.jsxs)(de.A,{onClick:()=>{b.some(e=>e.isDirty)?F(!0):(_(),A()),J()},children:[(0,W.jsx)(Ga.A,{sx:{mr:1,fontSize:18}}),"Close All Tabs"]})]})]}),(0,W.jsxs)(o.A,{open:N.open,onClose:()=>P({open:!1,tabId:"",currentName:""}),maxWidth:"sm",fullWidth:!0,children:[(0,W.jsx)(l.A,{children:"Rename Tab"}),(0,W.jsx)(r.A,{children:(0,W.jsx)(U.A,{autoFocus:!0,margin:"dense",label:"Tab Name",fullWidth:!0,variant:"outlined",value:N.currentName,onChange:e=>P(t=>Object.assign({},t,{currentName:e.target.value})),onKeyPress:e=>{"Enter"===e.key&&Y()}})}),(0,W.jsxs)(H.A,{children:[(0,W.jsx)(g.A,{onClick:()=>P({open:!1,tabId:"",currentName:""}),children:"Cancel"}),(0,W.jsx)(g.A,{onClick:Y,variant:"contained",children:"Rename"})]})]}),(0,W.jsxs)(o.A,{open:z.open,onClose:()=>L({open:!1,tabId:"",tabName:""}),maxWidth:"sm",fullWidth:!0,children:[(0,W.jsxs)(l.A,{sx:{display:"flex",alignItems:"center",gap:1},children:[(0,W.jsx)(qa.A,{color:"warning"}),"Unsaved Changes"]}),(0,W.jsx)(r.A,{children:(0,W.jsxs)(c.A,{children:['The tab "',z.tabName,'" has unsaved changes. Do you want to save your changes before closing?']})}),(0,W.jsxs)(H.A,{children:[(0,W.jsx)(g.A,{onClick:()=>q("cancel"),color:"inherit",children:"Cancel"}),(0,W.jsx)(g.A,{onClick:()=>q("discard"),color:"error",children:"Discard Changes"}),(0,W.jsx)(g.A,{onClick:()=>q("save"),variant:"contained",color:"primary",children:"Save & Close"})]})]}),(0,W.jsxs)(o.A,{open:R,onClose:()=>F(!1),maxWidth:"sm",fullWidth:!0,children:[(0,W.jsx)(l.A,{children:(0,W.jsxs)(i.A,{sx:{display:"flex",alignItems:"center",gap:1},children:[(0,W.jsx)(qa.A,{color:"warning"}),"Close All Tabs"]})}),(0,W.jsxs)(r.A,{children:[(0,W.jsx)(c.A,{children:"Some tabs have unsaved changes. Do you want to save all changes before closing?"}),b.filter(e=>e.isDirty).length>0&&(0,W.jsxs)(i.A,{sx:{mt:2},children:[(0,W.jsx)(c.A,{variant:"body2",color:"text.secondary",children:"Tabs with unsaved changes:"}),(0,W.jsx)(i.A,{sx:{mt:1},children:b.filter(e=>e.isDirty).map(e=>(0,W.jsx)(V.A,{label:e.name,size:"small",sx:{mr:1,mb:1}},e.id))})]})]}),(0,W.jsxs)(H.A,{children:[(0,W.jsx)(g.A,{onClick:()=>F(!1),color:"inherit",children:"Cancel"}),(0,W.jsx)(g.A,{onClick:()=>{_(),A(),F(!1)},color:"error",children:"Discard All Changes"}),(0,W.jsx)(g.A,{onClick:()=>{F(!1)},variant:"contained",color:"primary",children:"Save All & Close"})]})]})]})};var as=n(4477),ss=n(68476),is=n(29044),os=n(90037),rs=n(52853),ls=n(4804),cs=n(85970),ds=n(19076);const us=new class{async dispatch(e){try{return(await ve.uE.post("/dispatcher/dispatch",e)).data}catch(t){throw t}}async detectIntent(e){try{return(await ve.uE.post("/dispatcher/detect-intent",e)).data}catch(t){throw t}}},hs=(0,A.vt)()((0,j.eh)((e,t)=>({messagesBySession:{},currentSessionId:null,setCurrentSession:t=>{e({currentSessionId:t})},addMessage:(t,n)=>{e(e=>{const a=e.messagesBySession[t]||[];if(a.some(e=>e.id===n.id))return e;const s=[...a,n];return{messagesBySession:Object.assign({},e.messagesBySession,{[t]:s})}})},addMessages:(t,n)=>{e(e=>{const a=e.messagesBySession[t]||[],s=new Set(a.map(e=>e.id)),i=n.filter(e=>!s.has(e.id));if(0===i.length)return e;const o=[...a,...i];return{messagesBySession:Object.assign({},e.messagesBySession,{[t]:o})}})},setMessages:(t,n)=>{e(e=>({messagesBySession:Object.assign({},e.messagesBySession,{[t]:n})}))},removeMessage:(t,n)=>{e(e=>{const a=(e.messagesBySession[t]||[]).filter(e=>e.id!==n);return{messagesBySession:Object.assign({},e.messagesBySession,{[t]:a})}})},clearSession:t=>{e(e=>{const n=Object.assign({},e.messagesBySession);return delete n[t],{messagesBySession:n,currentSessionId:e.currentSessionId===t?null:e.currentSessionId}})},clearAllSessions:()=>{e({messagesBySession:{},currentSessionId:null})},getMessages:e=>t().messagesBySession[e]||[],getDeduplicatedMessages:e=>(e=>{const t=new Set,n=new Map;return e.filter(e=>{if(t.has(e.id))return!1;const a=e.type+":"+e.content+":"+e.timestamp.getTime(),s=e.type+"-"+e.content.substring(0,100),i=Array.from(n.entries());for(const[t,n]of i){const a=Math.abs(e.timestamp.getTime()-n.timestamp.getTime());if(t.includes(s)&&a<1e3&&n.type===e.type)return!1}return t.add(e.id),n.set(a,e),!0})})(t().messagesBySession[e]||[])})));class ms{static async validateConfig(e){try{return(await ve.uE.post("/memory-backend/validate",e)).data}catch(n){var t;return{valid:!1,errors:[n instanceof Le.pe?null==(t=n.response)||null==(t=t.data)?void 0:t.detail:"Failed to validate configuration"]}}}static async testDatabricksConnection(e){try{return(await ve.uE.post("/memory-backend/databricks/test-connection",e)).data}catch(n){var t;const e=n instanceof Le.pe?null==(t=n.response)||null==(t=t.data)?void 0:t.detail:n instanceof Error?n.message:"Failed to test connection";return{success:!1,message:e||"Failed to test connection",details:{error:e}}}}static async getAvailableDatabricksIndexes(e,t){try{return(await ve.uE.post("/memory-backend/databricks/indexes",Object.assign({endpoint_name:e},t))).data}catch(a){var n;const e=a instanceof Le.pe?null==(n=a.response)||null==(n=n.data)?void 0:n.detail:"Failed to fetch indexes";throw new Error(e||"Failed to fetch indexes")}}static async saveConfig(e){try{return(await ve.uE.post("/memory-backend/config",e)).data}catch(n){var t;return{success:!1,message:(n instanceof Le.pe?null==(t=n.response)||null==(t=t.data)?void 0:t.detail:"Failed to save configuration")||"Failed to save configuration"}}}static async getConfig(){try{const e=(await ve.uE.get("/memory-backend/configs")).data;if(!e||0===e.length)return null;const t=e.find(e=>e.is_default&&e.is_active);return t||null}catch(e){return null}}static async getMemoryStats(e){try{return(await ve.uE.get("/memory-backend/stats/"+e)).data}catch(t){return{}}}static async clearMemory(e,t){try{return(await ve.uE.post("/memory-backend/clear/"+e,{memory_types:t})).data}catch(a){var n;return{success:!1,message:(a instanceof Le.pe?null==(n=a.response)||null==(n=n.data)?void 0:n.detail:"Failed to clear memory")||"Failed to clear memory"}}}static async createDatabricksIndex(e,t,n,a,s,i){void 0===i&&(i="id");try{return(await ve.uE.post("/memory-backend/databricks/create-index",{config:e,index_type:t,catalog:n,schema:a,table_name:s,primary_key:i})).data}catch(r){var o;const e=r instanceof Le.pe?null==(o=r.response)||null==(o=o.data)?void 0:o.detail:"Failed to create index";return{success:!1,message:e||"Failed to create index",details:{error:e}}}}static async oneClickDatabricksSetup(e,t,n){void 0===t&&(t="ml"),void 0===n&&(n="agents");try{return(await ve.uE.post("/memory-backend/databricks/one-click-setup",{workspace_url:e,catalog:t,schema:n})).data}catch(s){var a;const e=s instanceof Le.pe?null==(a=s.response)||null==(a=a.data)?void 0:a.detail:"Failed to complete setup";return{success:!1,message:e||"Failed to complete setup",error:e}}}}let gs=function(e){return e.DEFAULT="default",e.DATABRICKS="databricks",e}({});const ps={backend_type:gs.DEFAULT,enable_short_term:!0,enable_long_term:!0,enable_entity:!0,enable_relationship_retrieval:!1},xs={endpoint_name:"",short_term_index:"",embedding_dimension:768,auth_type:"default"},fs=e=>{if(!e||"object"!==typeof e||null===e)return!1;const t=e;if(!Object.values(gs).includes(t.backend_type))return!1;if(t.backend_type===gs.DATABRICKS){const e=t.databricks_config;if(!e)return!1;if(!e.endpoint_name||!e.short_term_index)return!1}return!0},ys=(0,A.vt)()((0,j.eh)((e,t)=>({isMemoryBackendConfigured:!1,isKnowledgeSourceEnabled:!1,isLoading:!1,lastChecked:0,hasCheckedOnce:!1,lastNotFoundTime:0,setMemoryBackendConfigured:t=>{e({isMemoryBackendConfigured:t})},setKnowledgeSourceEnabled:t=>{e({isKnowledgeSourceEnabled:t})},checkConfiguration:async()=>{const n=Date.now(),a=t();if(!(a.hasCheckedOnce&&a.lastNotFoundTime>0&&n-a.lastNotFoundTime<3e5)&&(!(n-a.lastChecked<1e3)||a.isLoading)){e({isLoading:!0,lastChecked:n});try{var s,i;const t=await ms.getConfig(),a=!((null==t?void 0:t.backend_type)!==gs.DATABRICKS||null==(s=t.databricks_config)||!s.endpoint_name||null==(i=t.databricks_config)||!i.short_term_index),o=await ke.O.getConfiguration(),r=!(null==o||!o.knowledge_volume_enabled||null==o||!o.knowledge_volume_path);e(t||o?{isMemoryBackendConfigured:a,isKnowledgeSourceEnabled:r,isLoading:!1,hasCheckedOnce:!0,lastNotFoundTime:0}:{isMemoryBackendConfigured:!1,isKnowledgeSourceEnabled:!1,isLoading:!1,hasCheckedOnce:!0,lastNotFoundTime:n})}catch(o){e({isMemoryBackendConfigured:!1,isKnowledgeSourceEnabled:!1,isLoading:!1,hasCheckedOnce:!0,lastNotFoundTime:n})}}},refreshConfiguration:async()=>{e({lastChecked:0,lastNotFoundTime:0}),await t().checkConfiguration()}})));let bs=null;ys.subscribe(e=>e.isMemoryBackendConfigured,()=>{bs||(ys.getState().checkConfiguration(),bs=setInterval(()=>{ys.getState().checkConfiguration()},3e4))}),"undefined"!==typeof window&&(window.addEventListener("databricks-config-updated",()=>{ys.getState().refreshConfiguration()}),window.addEventListener("memory-backend-updated",()=>{ys.getState().refreshConfiguration()}),window.addEventListener("focus",()=>{ys.getState().checkConfiguration()}));class vs{static async saveMessage(e){return(await ve.uE.post("/chat-history/messages",e)).data}static async getSessionMessages(e,t,n){void 0===t&&(t=0),void 0===n&&(n=50);return(await ve.uE.get("/chat-history/sessions/"+e+"/messages",{params:{page:t,per_page:n}})).data}static async getUserSessions(e,t){void 0===e&&(e=0),void 0===t&&(t=20);return(await ve.uE.get("/chat-history/users/sessions",{params:{page:e,per_page:t}})).data}static async getGroupSessions(e,t,n){void 0===e&&(e=0),void 0===t&&(t=20);const a={page:e,per_page:t};n&&(a.user_id=n);return(await ve.uE.get("/chat-history/sessions",{params:a})).data}static async deleteSession(e){await ve.uE.delete("/chat-history/sessions/"+e)}static async createNewSession(){return(await ve.uE.post("/chat-history/sessions/new")).data}static generateSessionId(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){const t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)})}}var As=n(9030);const js=ve.uE,ws=e=>{if(!e.response)return!0;const t=e.response.status;return t>=500||408===t||429===t},ks=e=>1e3*Math.pow(2,e-1)+1e3*Math.random();async function Cs(e,t){let n;for(let s=1;s<=3;s++)try{return await e()}catch(a){if(n=a,3===s||!ws(a))throw a;const e=ks(s);await new Promise(t=>setTimeout(t,e))}throw n}class Ss{static async saveMessage(e){return Cs(async()=>(await js.post("/chat-history/messages",e,{timeout:3e4})).data)}static async getSessionMessages(e,t,n){return void 0===t&&(t=0),void 0===n&&(n=50),Cs(async()=>(await js.get("/chat-history/sessions/"+e+"/messages",{params:{page:t,per_page:n},timeout:3e4})).data)}static async getUserSessions(e,t){return void 0===e&&(e=0),void 0===t&&(t=20),Cs(async()=>(await js.get("/chat-history/users/sessions",{params:{page:e,per_page:t},timeout:3e4})).data)}static async getGroupSessions(e,t,n){return void 0===e&&(e=0),void 0===t&&(t=20),Cs(async()=>{const a={page:e,per_page:t};n&&(a.user_id=n);return(await js.get("/chat-history/sessions",{params:a,timeout:3e4})).data})}static async deleteSession(e){return Cs(async()=>{await js.delete("/chat-history/sessions/"+e,{timeout:3e4})})}static async createNewSession(){return Cs(async()=>(await js.post("/chat-history/sessions/new",void 0,{timeout:3e4})).data)}static generateSessionId(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){const t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)})}}const _s=["jobId","agentName","taskName","isIntermediate"],Es=e=>{if(!e)return"";const t=String.fromCharCode(27),n=String.fromCharCode(7);return e.replace(new RegExp(t+"\\[[0-9;]*[ABCDEFGHJKLMSTfminsulh]","g"),"").replace(new RegExp(t+"\\][^"+n+"]*"+n,"g"),"").replace(new RegExp(t+"[NOPGKabcdfghinqrstuABCDHIJMOPRTl]","g"),"").replace(new RegExp(t+"[\\[\\]\\?\\(\\)#;0-9]*[0-9A-Za-z]","g"),"").replace(new RegExp(t,"g"),"")},Is=/(https?:\/\/[^\s]+)/g;var Ts=n(75737);var Ds=n(57191),Os=n(38614),Ns=n(44564),Ps=n(8808),Ms=n(36080),zs=n(5064),Ls=n(52180);const Ws=["children","className"],Rs=e=>e.split(Is).map((e,t)=>e.match(Is)?(0,W.jsxs)(Ms.A,{href:e,target:"_blank",rel:"noopener noreferrer",sx:{display:"inline-flex",alignItems:"center",gap:.5,color:"primary.main",textDecoration:"none","&:hover":{textDecoration:"underline"}},children:[e,(0,W.jsx)(Ps.A,{sx:{fontSize:16}})]},t):e),Fs=e=>{let{content:t}=e;return n=t,[/^#+ /m,/\*\*.+\*\*/,/_.+_/,/\[.+\]\(.+\)/,/^\s*[-*+]\s/m,/^\s*\d+\.\s/m,/```[\s\S]*```/,/^\s*>/m].some(e=>e.test(n))?(0,W.jsx)(zs.oz,{remarkPlugins:[Ls.A],components:{a:e=>{let{href:t,children:n}=e;return(0,W.jsxs)(Ms.A,{href:t,target:"_blank",rel:"noopener noreferrer",sx:{display:"inline-flex",alignItems:"center",gap:.5,color:"primary.main",textDecoration:"none","&:hover":{textDecoration:"underline"}},children:[n,(0,W.jsx)(Ps.A,{sx:{fontSize:16}})]})},code:e=>{let{children:t,className:n}=e,s=(0,a.A)(e,Ws);return!n||!n.includes("language-")?(0,W.jsx)("code",Object.assign({style:{backgroundColor:"rgba(0, 0, 0, 0.08)",padding:"2px 4px",borderRadius:4,fontFamily:"monospace",fontSize:"0.9em"}},s,{children:t})):(0,W.jsx)("pre",{style:{backgroundColor:"rgba(0, 0, 0, 0.05)",padding:12,borderRadius:8,overflow:"auto",fontFamily:"monospace",fontSize:"0.875em",margin:"8px 0",maxWidth:"100%",maxHeight:"400px"},children:(0,W.jsx)("code",Object.assign({className:n},s,{children:t}))})}},children:t}):(0,W.jsx)(W.Fragment,{children:Rs(t)});var n},Bs=e=>{let{message:t,onOpenLogs:n}=e;return(0,W.jsx)(Ds.A,{in:!0,timeout:300,children:(0,W.jsxs)(st.Ay,{alignItems:"flex-start",sx:{flexDirection:"row",gap:1,py:1.5,width:"100%",maxWidth:"100%",overflow:"hidden",minWidth:0,"& > *":{minWidth:0}},children:[(0,W.jsx)(Os.A,{sx:{minWidth:"auto"},children:(0,W.jsx)(Ja.A,{sx:{bgcolor:"user"===t.type?"primary.main":"execution"===t.type||"trace"===t.type?"warning.main":"result"===t.type?"success.main":"secondary.main",width:32,height:32},children:"user"===t.type?(0,W.jsx)(X.A,{sx:{fontSize:20}}):("execution"===t.type||"trace"===t.type||t.type,(0,W.jsx)(Ns.A,{sx:{fontSize:20}}))})}),(0,W.jsx)(ot.A,{sx:{flex:1,maxWidth:"calc(100% - 40px)",mx:0,overflow:"hidden"},primary:(0,W.jsxs)(is.A,{direction:"column",spacing:1,children:[t.intent&&"assistant"===t.type&&(0,W.jsxs)(is.A,{direction:"row",spacing:1,alignItems:"center",children:[(0,W.jsx)(V.A,{icon:(e=>{switch(e){case"generate_agent":return(0,W.jsx)(Ns.A,{});case"generate_task":return(0,W.jsx)(na.A,{});case"generate_crew":return(0,W.jsx)(ta.A,{});case"configure_crew":return(0,W.jsx)(ht.A,{});default:return(0,W.jsx)(qn.A,{})}})(t.intent),label:t.intent.replace(/_/g," ").replace(/\b\w/g,e=>e.toUpperCase()),size:"small",color:(e=>{switch(e){case"generate_agent":return"primary";case"generate_task":return"secondary";case"generate_crew":return"success";default:return"default"}})(t.intent),variant:"outlined"}),void 0!==t.confidence&&(0,W.jsxs)(c.A,{variant:"caption",color:"text.secondary",children:[Math.round(100*t.confidence),"% confidence"]})]}),("execution"===t.type||"trace"===t.type)&&(0,W.jsxs)(is.A,{direction:"row",spacing:1,alignItems:"center",children:[(0,W.jsxs)(c.A,{variant:"caption",color:"text.secondary",children:["execution"===t.type?"Execution":"Trace"," Output"]}),t.eventSource&&(0,W.jsx)(V.A,{label:t.eventSource,size:"small",variant:"outlined",color:"primary"}),t.eventContext&&(0,W.jsx)(V.A,{label:t.eventContext,size:"small",variant:"outlined",color:"secondary"}),t.jobId&&n&&(0,W.jsx)(M.A,{title:"View execution logs",children:(0,W.jsx)(d.A,{size:"small",onClick:()=>t.jobId&&n(t.jobId),sx:{ml:1},children:(0,W.jsx)(Ps.A,{fontSize:"small"})})})]}),(0,W.jsx)(i.A,{sx:{color:"user"===t.type?"primary.main":(t.type,"text.primary"),wordBreak:"break-word",whiteSpace:"pre-wrap",maxWidth:"100%",overflow:"visible",fontWeight:"result"===t.type?500:"normal"},children:(()=>{const e=Es(t.content);if("result"===t.type)try{const t=JSON.parse(e);if(t.value&&"string"===typeof t.value){const e=t.value.split("\n").map(e=>e.trim()),n=[];for(let t=0;t<e.length;t++){const a=e[t],s=e[t+1]||"";if(""===a)continue;const i=a.match(/^[-*\u2022]\s/)||a.match(/^\d+\.\s/),o=s.match(/^[-*\u2022]\s/)||s.match(/^\d+\.\s/),r=a.match(/^#+\s/);n.push(a),r&&t<e.length-1||i&&!o&&""!==s?n.push(""):i||r||""===s||o||n.push("")}const a=n.join("\n").trim();return(0,W.jsx)(i.A,{sx:{backgroundColor:"rgba(0, 0, 0, 0.05)",p:2,borderRadius:1,border:"1px solid rgba(0, 0, 0, 0.1)",maxWidth:"100%",width:"100%",boxSizing:"border-box",color:"text.primary","& h1, & h2, & h3":{marginTop:"0.75em",marginBottom:"0.5em",fontSize:"1.1em",fontWeight:600},"& h4, & h5, & h6":{marginTop:"0.5em",marginBottom:"0.25em",fontSize:"1em",fontWeight:600},"& p":{margin:"0.4em 0",lineHeight:1.4},"& ul, & ol":{margin:"0.4em 0",paddingLeft:"1.5em"},"& li":{margin:"0.2em 0",lineHeight:1.4},"& li p":{margin:0,display:"inline"},"& > *:first-of-type":{marginTop:0},"& > *:last-child":{marginBottom:0},"& p:empty":{display:"none"},lineHeight:1.5},children:(0,W.jsx)(Fs,{content:a})})}return(0,W.jsx)(i.A,{component:"pre",sx:{fontFamily:"monospace",fontSize:"0.875rem",overflow:"auto",maxHeight:"600px",backgroundColor:"rgba(0, 0, 0, 0.05)",p:2,borderRadius:1,border:"1px solid rgba(0, 0, 0, 0.1)",m:0,maxWidth:"100%",width:"100%",boxSizing:"border-box",minWidth:0,overflowX:"auto",overflowY:"auto","& code":{display:"block",whiteSpace:"pre",wordBreak:"normal",overflowWrap:"normal"}},children:(0,W.jsx)("code",{children:JSON.stringify(t,null,2)})})}catch(n){const t=e.split("\n").map(e=>e.trim()),a=[];for(let e=0;e<t.length;e++){const n=t[e],s=t[e+1]||"";if(""===n)continue;const i=n.match(/^[-*\u2022]\s/)||n.match(/^\d+\.\s/),o=s.match(/^[-*\u2022]\s/)||s.match(/^\d+\.\s/),r=n.match(/^#+\s/);a.push(n),r&&e<t.length-1||i&&!o&&""!==s?a.push(""):i||r||""===s||o||a.push("")}const s=a.join("\n").trim();return(0,W.jsx)(i.A,{sx:{backgroundColor:"rgba(0, 0, 0, 0.05)",p:2,borderRadius:1,border:"1px solid rgba(0, 0, 0, 0.1)",maxWidth:"100%",width:"100%",boxSizing:"border-box",color:"text.primary","& h1, & h2, & h3, & h4, & h5, & h6":{marginTop:"1em",marginBottom:"0.5em"},"& p":{margin:0,lineHeight:1.4},"& p + p":{marginTop:"0.75em"},"& ul, & ol":{margin:"0.5em 0",paddingLeft:"1.5em"},"& li":{margin:"0.25em 0",lineHeight:1.4,"& p":{margin:0,display:"inline"}},"& > *:first-of-type":{marginTop:0},"& > *:last-child":{marginBottom:0},"& p:empty, & br":{display:"none"},lineHeight:1.5},children:(0,W.jsx)(Fs,{content:s})})}if("trace"===t.type){let t=e;const a=e.match(/^```(?:json)?\s*\n([\s\S]*?)\n```$/);a&&(t=a[1].trim());try{const e=JSON.parse(t);return(0,W.jsx)(i.A,{component:"pre",sx:{fontFamily:"monospace",fontSize:"0.875rem",overflow:"auto",maxHeight:"400px",backgroundColor:"rgba(0, 0, 0, 0.05)",p:1,borderRadius:1,m:0,maxWidth:"100%",width:"100%",boxSizing:"border-box",minWidth:0,overflowX:"auto",overflowY:"auto","& code":{display:"block",whiteSpace:"pre",wordBreak:"normal",overflowWrap:"normal",minWidth:"max-content"}},children:(0,W.jsx)("code",{children:JSON.stringify(e,null,2)})})}catch(n){}}if("assistant"===t.type&&t.result){const e=t.result;if("generate_agent"===t.intent&&e.agent){const t=e.agent;return(0,W.jsxs)(i.A,{children:[(0,W.jsx)(c.A,{variant:"body1",sx:{mb:1},children:"I've created an agent for you:"}),(0,W.jsxs)(i.A,{sx:{bgcolor:"background.paper",p:2,borderRadius:1},children:[(0,W.jsx)(c.A,{variant:"h6",sx:{mb:1},children:t.name}),(0,W.jsxs)(c.A,{variant:"body2",color:"text.secondary",children:["Role: ",t.role]})]})]})}if("generate_task"===t.intent&&e.task){const t=e.task;return(0,W.jsxs)(i.A,{children:[(0,W.jsx)(c.A,{variant:"body1",sx:{mb:1},children:"I've created a task for you:"}),(0,W.jsxs)(i.A,{sx:{bgcolor:"background.paper",p:2,borderRadius:1},children:[(0,W.jsx)(c.A,{variant:"h6",sx:{mb:1},children:t.name}),(0,W.jsx)(c.A,{variant:"body2",color:"text.secondary",children:t.description})]})]})}if("generate_crew"===t.intent&&e.crew){const t=e.crew;return(0,W.jsxs)(i.A,{children:[(0,W.jsx)(c.A,{variant:"body1",sx:{mb:1},children:"I've created a complete plan for you:"}),(0,W.jsxs)(i.A,{sx:{bgcolor:"background.paper",p:2,borderRadius:1},children:[t.agents&&t.agents.length>0&&(0,W.jsxs)(i.A,{sx:{mb:2},children:[(0,W.jsx)(c.A,{variant:"subtitle1",sx:{fontWeight:"bold",mb:1},children:"Agents:"}),t.agents.map((e,t)=>(0,W.jsxs)(c.A,{variant:"body2",sx:{ml:2},children:["\u2022 ",e.name]},t))]}),t.tasks&&t.tasks.length>0&&(0,W.jsxs)(i.A,{children:[(0,W.jsx)(c.A,{variant:"subtitle1",sx:{fontWeight:"bold",mb:1},children:"Tasks:"}),t.tasks.map((e,t)=>(0,W.jsxs)(c.A,{variant:"body2",sx:{ml:2},children:["\u2022 ",e.name]},t))]})]})]})}}return(0,W.jsx)(Fs,{content:e})})()}),(0,W.jsx)(c.A,{variant:"caption",color:"text.secondary",sx:{ml:1},children:t.timestamp.toLocaleTimeString()})]})})]})})},Vs=e=>{let{messages:t,onOpenLogs:n}=e;if(0===t.length)return null;const a=t[0],s=a.jobId;return(0,W.jsx)(Ds.A,{in:!0,timeout:300,children:(0,W.jsxs)(st.Ay,{alignItems:"flex-start",sx:{flexDirection:"row",gap:1,py:1.5,width:"100%",maxWidth:"100%",overflow:"hidden",minWidth:0,"& > *":{minWidth:0}},children:[(0,W.jsx)(Os.A,{sx:{minWidth:"auto"},children:(0,W.jsx)(Ja.A,{sx:{bgcolor:"warning.main",width:32,height:32},children:(0,W.jsx)(Ns.A,{sx:{fontSize:20}})})}),(0,W.jsx)(i.A,{sx:{flex:1,minWidth:0},children:(0,W.jsxs)(is.A,{direction:"column",spacing:1,children:[(0,W.jsxs)(is.A,{direction:"row",spacing:1,alignItems:"center",children:[(0,W.jsx)(c.A,{variant:"caption",color:"text.secondary",children:"Trace Output"}),a.eventSource&&(0,W.jsx)(V.A,{label:a.eventSource,size:"small",variant:"outlined",color:"primary"}),a.eventContext&&(0,W.jsx)(V.A,{label:a.eventContext,size:"small",variant:"outlined",color:"secondary"}),s&&n&&(0,W.jsx)(M.A,{title:"View execution logs",children:(0,W.jsx)(d.A,{size:"small",onClick:()=>n(s),sx:{ml:1},children:(0,W.jsx)(Ps.A,{fontSize:"small"})})})]}),(0,W.jsx)(i.A,{sx:{color:"text.primary",wordBreak:"break-word",whiteSpace:"pre-wrap",maxWidth:"100%",overflow:"visible",fontFamily:"monospace",fontSize:"0.875rem"},children:t.map((e,n)=>{const a=Es(e.content),s=a.match(/^```(?:json)?\s*\n([\s\S]*?)\n```$/);let o=a;s&&(o=s[1].trim());const r=[e.eventType||e.eventSource||"trace",e.eventContext,e.timestamp.toLocaleString("en-GB",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:!1})].filter(Boolean).join("\n");let l;try{const e=JSON.parse(o);l=e.suggestions||e.quality||e.entities?(0,W.jsx)(i.A,{component:"pre",sx:{overflow:"auto",maxHeight:"400px",backgroundColor:"rgba(0, 0, 0, 0.05)",p:1,borderRadius:1,border:"1px solid rgba(0, 0, 0, 0.1)",mt:.5,maxWidth:"100%",width:"100%",boxSizing:"border-box",minWidth:0,overflowX:"auto",overflowY:"auto",color:"rgba(0, 0, 0, 0.4)"},children:(0,W.jsx)("code",{children:JSON.stringify(e,null,2)})}):(0,W.jsx)(i.A,{sx:{whiteSpace:"pre-wrap",color:"rgba(0, 0, 0, 0.4)"},children:JSON.stringify(e,null,2)})}catch(c){l=(0,W.jsx)(i.A,{sx:{whiteSpace:"pre-wrap",color:"rgba(0, 0, 0, 0.4)"},children:a})}return(0,W.jsxs)(i.A,{sx:{mb:n<t.length-1?3:0},children:[(0,W.jsx)(i.A,{sx:{color:"rgba(0, 0, 0, 0.4)",fontSize:"0.813rem",mb:.5},children:r}),l]},e.id)})})]})})]})})};var Us=n(66699),Hs=n(71378),Ks=n(34200),Gs=n(42647),qs=n(98650),Js=n(11227),Ys=n(99905),Xs=n(20760);const Qs=e=>{let{executionId:t,groupId:a,onFilesUploaded:u,onAgentsUpdated:m,onTasksUpdated:p,disabled:x=!1,compact:f=!1,availableAgents:y,hasAgents:b=!1,hasTasks:v=!1}=e;const[A,j]=(0,s.useState)([]),[w,k]=(0,s.useState)(!1),[C,S]=(0,s.useState)(!1),[_,E]=(0,s.useState)(null),[I,T]=(0,s.useState)(null),[D,O]=(0,s.useState)(y||[]),[N,P]=(0,s.useState)([]),z=(0,s.useRef)(null);s.useEffect(()=>{if(y&&y.length>0){if(O(y),0===N.length){const e=y[0],t=e.id||"agent-"+e.name;P([t])}}else if(C&&0===D.length){const e=async()=>{try{const{AgentService:e}=await Promise.resolve().then(n.bind(n,39582)),t=await e.listAgents();if(O(t),0===N.length&&t.length>0){const e=t[0],n=e.id||"agent-"+e.name;P([n])}}catch(e){}};e()}},[C,y,D.length,N.length]),s.useEffect(()=>{(async()=>{try{const e=ke.O.getInstance(),t=await e.getDatabricksConfig();E(t),t&&!t.knowledge_volume_enabled&&T("Knowledge volume is not enabled in Databricks configuration")}catch(e){T("Failed to load Databricks configuration")}})()},[]);const L=async(e,n)=>{if(!_||!_.knowledge_volume_enabled)return void T("Knowledge volume is not configured");k(!0),T(null);const a={volume_path:_.knowledge_volume_path||"main.default.knowledge",workspace_url:_.workspace_url,token:void 0,file_format:"auto",chunk_size:_.knowledge_chunk_size||1e3,chunk_overlap:_.knowledge_chunk_overlap||200,create_date_dirs:!0,max_file_size_mb:50};for(let i=0;i<e.length;i++){const o=e[i],r=n[i];try{const e=new FormData;e.append("file",o),e.append("volume_config",JSON.stringify(a)),e.append("agent_ids",JSON.stringify(N));const n=await ve.uE.post("/databricks/knowledge/upload/"+t,e,{headers:{"Content-Type":"multipart/form-data"},onUploadProgress:e=>{const t=e.total?Math.round(100*e.loaded/e.total):0;j(e=>e.map(e=>e.id===r.id?Object.assign({},e,{progress:t}):e))}});n.data&&n.data.path&&p&&p(n.data.path),N.length>0&&n.data&&await F(n.data),j(e=>e.map(e=>e.id===r.id?Object.assign({},e,{status:"success",path:n.data.path,progress:100}):e))}catch(s){j(e=>e.map(e=>e.id===r.id?Object.assign({},e,{status:"error",error:s instanceof Error?s.message:"Upload failed"}):e))}}k(!1),u&&u(A)},{updateAgent:R}=(0,Ce.useAgentStore)(),F=async e=>{try{const{path:h,filename:g,size:p,execution_id:x,uploaded_at:f,volume_info:y,upload_method:b,simulated:v}=e||{},{AgentService:A}=await Promise.resolve().then(n.bind(n,39582)),j={type:"databricks_volume",source:h,metadata:{filename:g,uploaded_at:f||(new Date).toISOString(),execution_id:x,upload_method:b,simulated:Boolean(v)},fileInfo:{filename:g,path:h,full_path:y&&y.full_path||h,file_size_bytes:p,is_uploaded:!0,exists:!0,success:!0}},w=[];for(const e of N){const n=D.find(t=>(t.id||"agent-"+t.name)===e);if(n){let e=Object.assign({},n);if(n.id){var t,a,s,i,o,r,l,c,d,u;const m=await A.getAgent(n.id),g=(null==m?void 0:m.knowledge_sources)||[],p=g.some(e=>e.source===h)?g:[...g,j],x=Object.assign({},m,{name:(null==m?void 0:m.name)||n.name,role:(null==m?void 0:m.role)||n.role,goal:(null==m?void 0:m.goal)||n.goal,backstory:(null==m?void 0:m.backstory)||n.backstory,llm:(null==m?void 0:m.llm)||n.llm,tools:(null==m?void 0:m.tools)||n.tools||[],max_iter:null!=(t=null!=(a=null==m?void 0:m.max_iter)?a:n.max_iter)?t:25,verbose:null!=(s=null!=(i=null==m?void 0:m.verbose)?i:n.verbose)&&s,allow_delegation:null!=(o=null!=(r=null==m?void 0:m.allow_delegation)?r:n.allow_delegation)&&o,cache:null==(l=null!=(c=null==m?void 0:m.cache)?c:n.cache)||l,allow_code_execution:null!=(d=null!=(u=null==m?void 0:m.allow_code_execution)?u:n.allow_code_execution)&&d,code_execution_mode:(null==m?void 0:m.code_execution_mode)||n.code_execution_mode||"safe",knowledge_sources:p,function_calling_llm:null==m?void 0:m.function_calling_llm,max_rpm:null==m?void 0:m.max_rpm,max_execution_time:null==m?void 0:m.max_execution_time,memory:null==m?void 0:m.memory,embedder_config:null==m?void 0:m.embedder_config,tool_configs:null==m?void 0:m.tool_configs}),f=await A.updateAgentFull(n.id,x);f&&(e=f,f.id&&R(f.id,f))}else{const t=e.knowledge_sources||[],n=t.some(e=>e.source===h);e.knowledge_sources=n?t:[...t,j]}w.push(e)}}m&&w.length>0&&m(w)}catch(h){}},B=()=>{S(!1)},U=e=>{if(0===e)return"0 Bytes";const t=Math.floor(Math.log(e)/Math.log(1024));return Math.round(e/Math.pow(1024,t)*100)/100+" "+["Bytes","KB","MB","GB"][t]},{isMemoryBackendConfigured:K,isKnowledgeSourceEnabled:G,refreshConfiguration:q}=ys(),J=K&&G;return s.useEffect(()=>{},[K,G,J]),s.useEffect(()=>{q()},[q]),(0,W.jsxs)(W.Fragment,{children:[(0,W.jsx)(M.A,{title:J?b?v?"Upload knowledge files for tasks to search and reference":"Add at least one task to the canvas before uploading knowledge files":"Add at least one agent to the canvas before uploading knowledge files":K?"Knowledge volume is not enabled in Databricks configuration":"Knowledge sources require Databricks Vector Search memory backend configuration",children:(0,W.jsx)("span",{children:(0,W.jsx)(d.A,{onClick:()=>{if(S(!0),0===N.length&&D.length>0){const e=D[0],t=e.id||"agent-"+e.name;P([t])}},disabled:x||!J,color:"primary",size:f?"small":"medium",sx:f?{padding:"4px",color:"text.secondary","&:hover":{backgroundColor:"action.hover",color:"primary.main"}}:{},children:(0,W.jsx)(Ks.A,{sx:f?{fontSize:18}:{}})})})}),(0,W.jsxs)(o.A,{open:C,onClose:B,maxWidth:"sm",fullWidth:!0,children:[(0,W.jsx)(l.A,{sx:{pb:1},children:(0,W.jsx)(i.A,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:(0,W.jsxs)(i.A,{sx:{display:"flex",alignItems:"center",gap:1.5},children:[(0,W.jsx)(Gs.A,{color:"primary"}),(0,W.jsxs)(i.A,{children:[(0,W.jsx)(c.A,{variant:"h6",sx:{fontWeight:600},children:"Upload Knowledge Files"}),(0,W.jsx)(c.A,{variant:"caption",color:"text.secondary",sx:{display:"block",mt:.5},children:"Add files for tasks to search and reference"})]})]})})}),(0,W.jsxs)(r.A,{sx:{pt:2},children:[I&&(0,W.jsx)(h.A,{severity:"error",sx:{mb:2},children:I}),!J&&(0,W.jsx)(h.A,{severity:"warning",sx:{mb:2},children:K?"Knowledge volume is not enabled. Please configure it in the Databricks settings.":"Knowledge sources require Databricks Vector Search memory backend configuration. Please configure memory backend in Settings."}),J&&(0,W.jsx)(W.Fragment,{children:D.length>0?(0,W.jsxs)(i.A,{children:[(0,W.jsx)("input",{ref:z,type:"file",multiple:!0,onChange:e=>{const t=e.target.files;if(!t||0===t.length)return;const n=Array.from(t).map(e=>({id:Date.now()+"-"+Math.random(),filename:e.name,path:"",size:e.size,status:"uploading",progress:0}));j(e=>[...e,...n]),L(Array.from(t),n),z.current&&(z.current.value="")},style:{display:"none"},accept:".pdf,.txt,.json,.csv,.doc,.docx,.md"}),(0,W.jsx)(g.A,{variant:"contained",startIcon:(0,W.jsx)(Gs.A,{}),onClick:()=>{var e;return null==(e=z.current)?void 0:e.click()},disabled:w,fullWidth:!0,size:"large",sx:{mb:2,py:1.5,borderRadius:2,textTransform:"none",fontWeight:500},children:"Choose Files"}),A.length>0&&(0,W.jsx)(_e.A,{variant:"outlined",sx:{borderRadius:2,overflow:"hidden",border:"1px solid",borderColor:"grey.200"},children:(0,W.jsx)(at.A,{disablePadding:!0,children:A.map(e=>(0,W.jsxs)(st.Ay,{sx:{borderBottom:"1px solid",borderColor:"grey.100","&:last-child":{borderBottom:"none"}},children:[(0,W.jsx)(ot.A,{primary:(0,W.jsxs)(i.A,{sx:{display:"flex",alignItems:"center",gap:1.5},children:[(0,W.jsx)(qs.A,{fontSize:"small",color:"primary"}),(0,W.jsx)(c.A,{variant:"body2",fontWeight:500,children:e.filename}),(0,W.jsx)(V.A,{label:U(e.size),size:"small",variant:"outlined",sx:{fontSize:"0.75rem"}})]}),secondary:"uploading"===e.status?(0,W.jsx)(Us.A,{variant:"determinate",value:e.progress,sx:{mt:1}}):"success"===e.status?(0,W.jsxs)(i.A,{sx:{display:"flex",alignItems:"center",gap:.5,mt:.5},children:[(0,W.jsx)(Js.A,{color:"success",fontSize:"small"}),(0,W.jsx)(c.A,{variant:"caption",color:"success.main",children:"Uploaded successfully"})]}):"error"===e.status?(0,W.jsxs)(i.A,{sx:{display:"flex",alignItems:"center",gap:.5,mt:.5},children:[(0,W.jsx)(Ys.A,{color:"error",fontSize:"small"}),(0,W.jsx)(c.A,{variant:"caption",color:"error",children:e.error||"Upload failed"})]}):null}),(0,W.jsx)(Hs.A,{children:(0,W.jsx)(d.A,{edge:"end","aria-label":"delete",onClick:()=>(async e=>{j(t=>{const n=t.filter(t=>t.id!==e);return 0===n.length&&N.forEach(async e=>{const t=D.find(t=>(t.id||"agent-"+t.name)===e);if(t){const e=(t.tools||[]).filter(e=>"36"!==String(e)&&"DatabricksKnowledgeSearchTool"!==String(e));if(t.id){const a=Object.assign({},t,{tools:e});try{const e=await fe.AgentService.updateAgentFull(t.id,a);e&&e.id&&R(e.id,e)}catch(n){}}}}),n})})(e.id),disabled:"uploading"===e.status,size:"small",children:(0,W.jsx)(Xs.A,{})})})]},e.id))})})]}):(0,W.jsx)(h.A,{severity:"info",children:"No agents available on the canvas. Please add at least one agent before uploading knowledge files."})})]}),(0,W.jsx)(H.A,{children:(0,W.jsx)(g.A,{onClick:B,disabled:w,children:"Close"})})]})]})},Zs=e=>{let{onNodesGenerated:t,onLoadingStateChange:o,selectedModel:r="databricks-llama-4-maverick",selectedTools:l=[],isVisible:u=!0,setSelectedModel:h,nodes:g=[],edges:x=[],onExecuteCrew:f,onToggleCollapse:y,chatSessionId:b,onOpenLogs:A}=e;const[j,k]=(0,s.useState)(""),[C,S]=(0,s.useState)(!1),[_,I]=(0,s.useState)(!1),[T,O]=(0,s.useState)({}),[P,L]=(0,s.useState)(!1),[R,F]=(0,s.useState)(null),[B,V]=(0,s.useState)(!1),[H,K]=(0,s.useState)([]),[G,q]=(0,s.useState)({}),[J,X]=(0,s.useState)(0),[Z,$]=(0,s.useState)("crew"),{isMemoryBackendConfigured:ee,isKnowledgeSourceEnabled:te,checkConfiguration:ae}=ys(),{refreshKey:se}=Bn(),ie=(0,s.useRef)(null),oe=(0,s.useRef)(null),{setNodes:re,setEdges:le}=(0,p.Y)(),{setInputMode:ce,inputMode:ue,setInputVariables:he,executeCrew:me,executeFlow:ge}=(0,v.E)(),pe=(0,E.B)(),{chatPanelSide:xe,setChatPanelSide:be}=(0,E.z)(),ve=(0,s.useRef)(null),Ae=(0,s.useRef)(!0),je=(0,s.useRef)(new An({margin:20,minNodeSpacing:50,defaultUIState:{chatPanelVisible:u,chatPanelCollapsed:!1,chatPanelWidth:450}})),{setMessages:we,getDeduplicatedMessages:ke,setCurrentSession:Ce}=hs(),{sessionId:Se,setSessionId:Ee,chatSessions:Ie,setChatSessions:Te,isLoadingSessions:De,currentSessionName:Oe,setCurrentSessionName:Ne,saveMessageToBackend:Pe,loadChatSessions:Me,loadSessionMessages:ze,startNewChat:Le}=(e=>{const[t,n]=(0,s.useState)(e||(0,w.A)()),{setMessages:i,addMessage:o}=hs(),[r,l]=(0,s.useState)([]),[c,d]=(0,s.useState)(!1),[u,h]=(0,s.useState)("New Chat"),[m,g]=(0,s.useState)(!1),p=(0,s.useRef)(0);(0,s.useEffect)(()=>{(()=>{if(e)n(e);else{const e=Ss.generateSessionId();n(e)}})()},[e]);const x=e=>{const t={id:e.id,type:e.message_type,content:e.content,timestamp:new Date(e.timestamp),intent:e.intent,confidence:e.confidence?parseFloat(e.confidence):void 0,result:e.generation_result};if(("execution"===e.message_type||"trace"===e.message_type)&&e.generation_result){const n=e.generation_result;if(t.jobId=n.jobId,t.eventSource=n.agentName,t.eventContext=n.taskName,t.isIntermediate=n.isIntermediate,void 0!==n.jobId||void 0!==n.agentName||void 0!==n.taskName||void 0!==n.isIntermediate){const e=(0,a.A)(n,_s);t.result=Object.keys(e).length>0?e:void 0}}return t};(0,s.useEffect)(()=>{(async()=>{if(t)try{i(t,[]);try{const e=await Ss.getSessionMessages(t);if(e.messages&&e.messages.length>0){const n=e.messages.map(x);i(t,n)}}catch(e){}}catch(n){}})()},[t,i]);const f=(0,s.useCallback)(async e=>{if(t&&!m)try{let n=e.result;"execution"!==e.type&&"trace"!==e.type||(n=Object.assign({},e.result||{},{jobId:e.jobId,agentName:e.eventSource,taskName:e.eventContext,isIntermediate:e.isIntermediate}));const a={session_id:t,message_type:e.type,content:e.content,intent:e.intent,confidence:e.confidence,generation_result:n};await Ss.saveMessage(a),p.current=0,m&&g(!1)}catch(n){if(p.current+=1,p.current>=3&&!m){g(!0);const e={id:"error-"+Date.now(),type:"assistant",content:"\u26a0\ufe0f Chat history is temporarily disabled due to service issues. Your messages will not be saved.",timestamp:new Date};o(t,e)}}},[t,m,3,o]);return{sessionId:t,setSessionId:n,chatSessions:r,setChatSessions:l,isLoadingSessions:c,currentSessionName:u,setCurrentSessionName:h,saveMessageToBackend:f,loadChatSessions:async()=>{d(!0);try{const e=await Ss.getGroupSessions();l(e.sessions||[])}catch(e){const n={id:"error-"+Date.now(),type:"assistant",content:"\u274c Failed to load chat history. Please try again.",timestamp:new Date};o(t,n)}finally{d(!1)}},loadSessionMessages:async e=>{d(!0);try{var t;const a=await Ss.getSessionMessages(e),s=JSON.parse(localStorage.getItem("chatSessionJobNames")||"{}")[e];h(s||"New Chat");const o=a.messages.map(x);i(e,o),n(e),h("Session from "+new Date((null==(t=a.messages[0])?void 0:t.timestamp)||Date.now()).toLocaleDateString())}catch(a){const t={id:"error-"+Date.now(),type:"assistant",content:"\u274c Failed to load session messages. Please try again.",timestamp:new Date};o(e,t)}finally{d(!1)}},startNewChat:()=>{const e=Ss.generateSessionId();n(e),i(e,[]),h("New Chat")}}})(b),We=ke(Se);(0,s.useEffect)(()=>{Se&&Ce(Se)},[Se,Ce]);const Re=e=>{if("function"===typeof e){const t=e(ke(Se));we(Se,t)}else we(Se,e)},{executingJobId:Be,setExecutingJobId:Ve,lastExecutionJobId:Ue,setLastExecutionJobId:He,executionStartTime:Ke}=((e,t)=>{const[n,a]=(0,s.useState)(null),[i,o]=(0,s.useState)(null),[r,l]=(0,s.useState)(new Set),[c,d]=(0,s.useState)(null),{setTaskState:u,clearTaskStates:h}=(0,zt.useTaskExecutionStore)(),{addMessage:m}=hs(),g=(0,s.useCallback)(async n=>{try{const a=await As.A.getTraces(n);a&&Array.isArray(a)&&a.filter(e=>{const t=e.id+"-"+e.created_at;return!r.has(t)}).forEach(a=>{var s,i;if(a.event_type){const e="task_started"===a.event_type||"task_completed"===a.event_type||"task_failed"===a.event_type||"task_status"===a.event_type;if(a.event_type,e&&a.event_context){let e=a.event_context;if("starting_task"===e||"completing_task"===e){if(a.trace_metadata&&"object"===typeof a.trace_metadata){const t=a.trace_metadata;t.task_name&&(e=String(t.task_name))}}else if(e.includes("task:")){var o;e=(null==(o=e.split("task:")[1])?void 0:o.trim())||e}let t=!1;if(!e||"task_completion"===e||"starting_task"===e||"completing_task"===e||e.length<5)if("object"===typeof a.output&&null!==a.output&&"extra_data"in a.output){const n=a.output.extra_data;null!=n&&n.task_name?e=String(n.task_name):t=!0}else t=!0;if(!t){const t=[];if(t.push(e),a.trace_metadata&&"object"===typeof a.trace_metadata){const e=a.trace_metadata;e.task_id&&"string"===typeof e.task_id&&t.push(e.task_id),e.frontend_task_id&&"string"===typeof e.frontend_task_id&&t.push(e.frontend_task_id)}const n=e.split(/\s+/).filter(e=>e.length>0);for(let e=1;e<=Math.min(5,n.length);e++){const a=n.slice(0,e).join(" ");t.push(a),t.push(a.toLowerCase())}if(n.length>5)for(let e=1;e<=3;e++){const a=n.slice(-e).join(" ");t.push(a),t.push(a.toLowerCase())}const s=n.filter(e=>{const t=e.toLowerCase();return["research","analyze","compare","recommend","create","update","delete","fetch","process","validate","generate","build","test","deploy","configure","setup","install","check"].includes(t)});if(s.length>0){const e=n.indexOf(s[0]);if(t.push(s[0]),t.push(s[0].toLowerCase()),e<n.length-1){const a=n.slice(e,Math.min(e+3,n.length)).join(" ");t.push(a),t.push(a.toLowerCase())}}const i="task_"+e.replace(/\s+/g,"_").toLowerCase();t.push(i);const o=e.toLowerCase();o!==e&&t.push(o);const r=e.replace(/_/g," ");r!==e&&t.push(r);const l=Array.from(new Set(t));let c="running";if("task_completed"===a.event_type)c="completed";else if("task_failed"===a.event_type)c="failed";else if("task_started"===a.event_type)c="running";else if("agent_execution"===a.event_type)if(c="running","object"===typeof a.output&&null!==a.output){let e="";e="content"in a.output?String(a.output.content):"agent_execution"in a.output?String(a.output.agent_execution):"raw"in a.output?String(a.output.raw):JSON.stringify(a.output),(e.includes("Final Answer:")||e.includes("## Final Answer"))&&(c="completed")}else"string"===typeof a.output&&(a.output.includes("Final Answer:")||a.output.includes("## Final Answer"))&&(c="completed");l.forEach(t=>{const n=zt.useTaskExecutionStore.getState().getTaskStatus(t);n&&n.status===c||u(t,Object.assign({status:c,task_name:e},"running"===c&&{started_at:a.created_at},"completed"===c&&{completed_at:a.created_at},"failed"===c&&{failed_at:a.created_at},n&&Object.assign({},n.started_at&&{started_at:n.started_at},n.completed_at&&"running"!==c&&{completed_at:n.completed_at})))})}}if("object"===typeof a.output&&null!==a.output&&"extra_data"in a.output){const e=a.output.extra_data;if(null!=e&&e.task_name){const t=String(e.task_name),n=e.task_id?String(e.task_id):"task_"+t.replace(/\s+/g,"_").toLowerCase(),s=[n,t];e.frontend_task_id&&"string"===typeof e.frontend_task_id&&s.push(String(e.frontend_task_id));const i=t.toLowerCase();i!==t&&s.push(i);const o=t.replace(/_/g," ");o!==t&&s.push(o),n.startsWith("task-")||n.startsWith("task_")||s.push("task-"+n);let r="running";"task_completed"===a.event_type||"completed"===(null==e?void 0:e.status)?r="completed":"task_failed"===a.event_type||"failed"===(null==e?void 0:e.status)?r="failed":"task_started"!==a.event_type&&"running"!==(null==e?void 0:e.status)||(r="running"),s.forEach(e=>{const n=zt.useTaskExecutionStore.getState().getTaskStatus(e);n&&n.status===r||u(e,Object.assign({status:r,task_name:t},"running"===r&&{started_at:a.created_at},"completed"===r&&{completed_at:a.created_at},"failed"===r&&{failed_at:a.created_at},n&&Object.assign({},n.started_at&&{started_at:n.started_at},n.completed_at&&"running"!==r&&{completed_at:n.completed_at})))})}}}let r="";if("string"===typeof a.output?r=Es(a.output):null!=(s=a.output)&&s.agent_execution&&"string"===typeof a.output.agent_execution?r=Es(a.output.agent_execution):null!=(i=a.output)&&i.content&&"string"===typeof a.output.content?r=Es(a.output.content):a.output&&(r=JSON.stringify(a.output,null,2)),!r.trim())return;const c=a.id+"-"+a.created_at,d={id:"trace-"+c,type:"trace",content:r,timestamp:new Date(a.created_at||Date.now()),isIntermediate:!0,eventSource:a.event_source,eventContext:a.event_context,eventType:a.event_type,jobId:n};m(e,d),t(d),l(e=>{const t=new Set(e);return t.add(c),t})})}catch(a){Error}},[r,t,m,e,u]);return(0,s.useEffect)(()=>{const s=t=>{const{jobId:n,jobName:s}=t.detail;a(n),o(n),l(new Set),d(new Date);const i=JSON.parse(localStorage.getItem("chatSessionJobNames")||"{}");i[e]=s,localStorage.setItem("chatSessionJobNames",JSON.stringify(i))},c=s=>{const{jobId:o}=s.detail;(n||o===i)&&(setTimeout(()=>{Ts.Pp.getRuns(100).then(n=>{var a;const s=n.runs.find(e=>e.job_id===o);if(null!=s&&null!=(a=s.result)&&a.output){let n=s.result.output;try{const e=JSON.parse(s.result.output);n=JSON.stringify(e,null,2)}catch(i){n=s.result.output}const a={id:"exec-result-"+Date.now(),type:"result",content:n,timestamp:new Date,jobId:o};m(e,a),t(a)}else if(null!=s&&s.result){let n="string"===typeof s.result?s.result:JSON.stringify(s.result,null,2);if("string"===typeof s.result)try{const e=JSON.parse(s.result);n=JSON.stringify(e,null,2)}catch(i){}const a={id:"exec-result-"+Date.now(),type:"result",content:n,timestamp:new Date,jobId:o};m(e,a),t(a)}}).catch(e=>{})},2e3),a(null),d(null),l(new Set),window.dispatchEvent(new CustomEvent("forceClearExecution")))},u=s=>{const{jobId:o,error:r}=s.detail;if(n||o===i){const n={id:"exec-failed-"+Date.now(),type:"execution",content:"\u274c Execution failed: "+r,timestamp:new Date,jobId:o};m(e,n),t(n),a(null),d(null),l(new Set),window.dispatchEvent(new CustomEvent("forceClearExecution"))}},h=a=>{const{jobId:s,trace:i}=a.detail;if(s===n&&i){const n=i.id+"-"+i.created_at;if(r.has(n))return;const a={id:"trace-"+n,type:"trace",content:"string"===typeof i.output?i.output:JSON.stringify(i.output,null,2),timestamp:new Date(i.created_at||Date.now()),isIntermediate:!0,eventSource:i.event_source,eventContext:i.event_context,eventType:i.event_type,jobId:s};m(e,a),t(a),l(e=>{const t=new Set(e);return t.add(n),t})}},g=t=>{const{message:n}=t.detail;a(null);const s={id:"exec-error-"+Date.now(),type:"execution",content:"\u274c "+n,timestamp:new Date};m(e,s)},p=()=>{a(null),d(null),l(new Set)},x=s=>{const{jobId:o,partialResults:r}=s.detail;if(n===o||o===i){const n={id:"exec-stopped-"+Date.now(),type:"execution",content:"\u23f9\ufe0f Execution stopped by user"+(r?" (partial results saved)":""),timestamp:new Date,jobId:o};m(e,n),t(n),a(null),d(null),l(new Set),window.dispatchEvent(new CustomEvent("forceClearExecution"))}};return window.addEventListener("jobCreated",s),window.addEventListener("jobCompleted",c),window.addEventListener("jobFailed",u),window.addEventListener("jobStopped",x),window.addEventListener("traceUpdate",h),window.addEventListener("executionError",g),window.addEventListener("forceClearExecution",p),()=>{window.removeEventListener("jobCreated",s),window.removeEventListener("jobCompleted",c),window.removeEventListener("jobFailed",u),window.removeEventListener("jobStopped",x),window.removeEventListener("traceUpdate",h),window.removeEventListener("executionError",g),window.removeEventListener("forceClearExecution",p)}},[n,i,r,c,t,e,m,h]),(0,s.useEffect)(()=>{let e=null;if(n){const t=setTimeout(()=>g(n),2e3);return e=setInterval(()=>g(n),2e3),()=>{clearTimeout(t),e&&clearInterval(e)}}return()=>{e&&clearInterval(e)}},[n,g]),{executingJobId:n,setExecutingJobId:a,lastExecutionJobId:i,setLastExecutionJobId:o,executionStartTime:c}})(Se,Pe),Ge=e=>{const t=/\{([^}]+)\}/g,n=new Set;return e.forEach(e=>{if("agentNode"===e.type||"taskNode"===e.type){const a=e.data;[a.role,a.goal,a.backstory,a.description,a.expected_output,a.label].forEach(e=>{if(e&&"string"===typeof e){let a;for(t.lastIndex=0;null!==(a=t.exec(e));)n.add(a[1])}})}}),Array.from(n)};s.useEffect(()=>{je.current.updateUIState(Object.assign({},pe,{chatPanelVisible:u}))},[u,pe]),s.useEffect(()=>{const e=()=>{"undefined"!==typeof window&&je.current.updateScreenDimensions(window.innerWidth,window.innerHeight)};if("undefined"!==typeof window)return window.addEventListener("resize",e),window.debugCanvasLayout=()=>je.current.getLayoutDebugInfo(),()=>{window.removeEventListener("resize",e),delete window.debugCanvasLayout}},[]),(0,s.useEffect)(()=>{Ae.current&&(()=>{var e;null==(e=ie.current)||e.scrollIntoView({behavior:"smooth"})})()},[We]),(0,s.useEffect)(()=>{o&&o(C)},[C,o]),(0,s.useEffect)(()=>{const e=[];return[0,100,300,500,1e3].forEach(t=>{const n=setTimeout(()=>{var e;null==(e=oe.current)||e.focus()},t);e.push(n)}),()=>{e.forEach(clearTimeout)}},[]),(0,s.useEffect)(()=>{if(!C){const e=setTimeout(()=>{var e;null==(e=oe.current)||e.focus()},100);return()=>clearTimeout(e)}},[C]),(0,s.useEffect)(()=>{if(u){const e=setTimeout(()=>{var e;null==(e=oe.current)||e.focus()},100);return()=>clearTimeout(e)}},[u]),(0,s.useEffect)(()=>{(async()=>{L(!0);try{const e=ye.J.getInstance(),t=await e.getEnabledModels();O(t)}catch(e){O({"databricks-llama-4-maverick":{name:"databricks-llama-4-maverick",temperature:.7,context_window:128e3,max_output_tokens:4096,enabled:!0}})}finally{L(!1)}})()},[se]),(0,s.useEffect)(()=>{ae()},[ae]);const qe=((e,t,n,a,s,i)=>async o=>{try{var r,l,c,d,u,h,m,g,x,f,y,b,v,A,j,w,k,C,S,_,E,I,T,D;const t={name:o.name,role:o.role,goal:o.goal,backstory:o.backstory,llm:(null==(r=o.advanced_config)?void 0:r.llm)||n,tools:o.tools||[],max_iter:(null==(l=o.advanced_config)?void 0:l.max_iter)||25,max_rpm:(null==(c=o.advanced_config)?void 0:c.max_rpm)||3,max_execution_time:(null==(d=o.advanced_config)?void 0:d.max_execution_time)||void 0,verbose:(null==(u=o.advanced_config)?void 0:u.verbose)||!1,allow_delegation:(null==(h=o.advanced_config)?void 0:h.allow_delegation)||!1,cache:null==(m=null==(g=o.advanced_config)?void 0:g.cache)||m,system_template:(null==(x=o.advanced_config)?void 0:x.system_template)||void 0,prompt_template:(null==(f=o.advanced_config)?void 0:f.prompt_template)||void 0,response_template:(null==(y=o.advanced_config)?void 0:y.response_template)||void 0,allow_code_execution:(null==(b=o.advanced_config)?void 0:b.allow_code_execution)||!1,code_execution_mode:(null==(v=o.advanced_config)?void 0:v.code_execution_mode)||"safe",max_retry_limit:(null==(A=o.advanced_config)?void 0:A.max_retry_limit)||2,use_system_prompt:null==(j=null==(w=o.advanced_config)?void 0:w.use_system_prompt)||j,respect_context_window:null==(k=null==(C=o.advanced_config)?void 0:C.respect_context_window)||k,memory:null==(S=null==(_=o.advanced_config)?void 0:_.memory)||S,embedder_config:null!=(E=o.advanced_config)&&E.embedder_config?{provider:o.advanced_config.embedder_config.provider||"databricks",config:Object.assign({model:(null==(I=o.advanced_config.embedder_config.config)?void 0:I.model)||"databricks-gte-large-en"},o.advanced_config.embedder_config.config||{})}:void 0,knowledge_sources:(null==(T=o.advanced_config)?void 0:T.knowledge_sources)||[],function_calling_llm:(null==(D=o.advanced_config)?void 0:D.function_calling_llm)||void 0},O=await fe.AgentService.createAgent(t);if(!O)throw new Error("Failed to save agent");{const t=p.Y.getState().nodes,n=(null==s?void 0:s.current.getAgentNodePosition(t,"crew"))||{x:100,y:100},o={id:"agent-"+O.id,type:"agentNode",position:n,data:{label:O.name,agentId:O.id,role:O.role,goal:O.goal,backstory:O.backstory,llm:O.llm,tools:O.tools||[],agent:O}};setTimeout(()=>{window.dispatchEvent(new Event("fitViewToNodesInternal"))},100),a?a([o],[]):e(e=>[...e,o]),[100,300,500,800,1200].forEach(e=>{setTimeout(()=>{var e;null==i||null==(e=i.current)||e.focus()},e)})}}catch(M){var O;let r="";if(M instanceof Error)r=": "+M.message;else if("object"===typeof M&&null!==M){var N,P;const e=M;null!=(N=e.response)&&null!=(N=N.data)&&N.detail?r=": "+e.response.data.detail:null!=(P=e.response)&&null!=(P=P.data)&&P.message&&(r=": "+e.response.data.message)}const l={id:"error-"+Date.now(),type:"assistant",content:'\u274c Failed to save agent "'+o.name+'"'+r+". The agent will be created locally but won't be persisted.",timestamp:new Date};t(e=>[...e,l]),[100,300,500,800].forEach(e=>{setTimeout(()=>{var e;null==i||null==(e=i.current)||e.focus()},e)});const c=p.Y.getState().nodes,d=(null==s?void 0:s.current.getAgentNodePosition(c,"crew"))||{x:100,y:100},u={id:"agent-"+Date.now(),type:"agentNode",position:d,data:{label:o.name,role:o.role,goal:o.goal,backstory:o.backstory,llm:(null==(O=o.advanced_config)?void 0:O.llm)||n,tools:o.tools||[],agent:o}};setTimeout(()=>{window.dispatchEvent(new Event("fitViewToNodesInternal"))},100),a?a([u],[]):e(e=>[...e,u])}})(re,Re,r,t,je,oe),Je=((e,t,n,a,s,i)=>async o=>{try{var r,l,c,d,u,h,m,g;const{nodes:n,edges:f}=p.Y.getState(),y=n.filter(e=>"agentNode"===e.type);let b="";if(y.length>0){const e=y.filter(e=>!f.some(t=>{var a;return t.source===e.id&&"taskNode"===(null==(a=n.find(e=>e.id===t.target))?void 0:a.type)}));e.length>0?b=e[0].data.agentId||"":y.length>0&&(b=y[0].data.agentId||"")}const v=(o.tools||[]).map(e=>"string"===typeof e?e:e&&"object"===typeof e&&"name"in e?e.name:"").filter(Boolean),A={name:o.name,description:o.description,expected_output:o.expected_output,tools:v,agent_id:b,async_execution:Boolean(null==(r=o.advanced_config)?void 0:r.async_execution)||!1,markdown:Boolean(null==(l=o.advanced_config)?void 0:l.markdown)||!1,context:[],config:{cache_response:!1,cache_ttl:3600,retry_on_fail:!0,max_retries:3,timeout:null,priority:1,error_handling:"default",output_file:(null==(c=o.advanced_config)?void 0:c.output_file)||null,output_json:null!=(d=o.advanced_config)&&d.output_json?"string"===typeof o.advanced_config.output_json?o.advanced_config.output_json:JSON.stringify(o.advanced_config.output_json):null,output_pydantic:(null==(u=o.advanced_config)?void 0:u.output_pydantic)||null,callback:(null==(h=o.advanced_config)?void 0:h.callback)||null,human_input:Boolean(null==(m=o.advanced_config)?void 0:m.human_input)||!1,markdown:Boolean(null==(g=o.advanced_config)?void 0:g.markdown)||!1}},j=await Fe.TaskService.createTask(A);if(!j)throw new Error("Failed to save task");{var x;const n=p.Y.getState().nodes,o=(null==s?void 0:s.current.getTaskNodePosition(n,"crew"))||{x:400,y:100},r={id:"task-"+j.id,type:"taskNode",position:o,data:{label:j.name,taskId:j.id,description:j.description,expected_output:j.expected_output,tools:j.tools||[],human_input:(null==(x=j.config)?void 0:x.human_input)||!1,async_execution:j.async_execution||!1,task:j}};setTimeout(()=>{window.dispatchEvent(new Event("fitViewToNodesInternal"))},100);let l=null;if(b){const e="agent-"+b,t="task-"+j.id,{layoutOrientation:n}=E.z.getState();l={id:"edge-"+e+"-"+t,source:e,target:t,type:"default",animated:!1,sourceHandle:"vertical"===n?"bottom":"right",targetHandle:"vertical"===n?"top":"left",style:(0,rn.RU)(rn.Gs.AGENT_TO_TASK,!1)}}if(a)a([r],l?[l]:[]);else if(e(e=>[...e,r]),null!==l){const e=l;t(t=>[...t,e])}[100,300,500,800,1200].forEach(e=>{setTimeout(()=>{var e;null==i||null==(e=i.current)||e.focus()},e)})}}catch(A){var f,y;let t="";if(A instanceof Error)t=": "+A.message;else if("object"===typeof A&&null!==A){var b,v;const e=A;null!=(b=e.response)&&null!=(b=b.data)&&b.detail?t=": "+e.response.data.detail:null!=(v=e.response)&&null!=(v=v.data)&&v.message&&(t=": "+e.response.data.message)}const r={id:"error-"+Date.now(),type:"assistant",content:'\u274c Failed to save task "'+o.name+'"'+t+". The task will be created locally but won't be persisted.",timestamp:new Date};n(e=>[...e,r]),[100,300,500,800].forEach(e=>{setTimeout(()=>{var e;null==i||null==(e=i.current)||e.focus()},e)});const l=p.Y.getState().nodes,c=(null==s?void 0:s.current.getTaskNodePosition(l,"crew"))||{x:400,y:100},d={id:"task-"+Date.now(),type:"taskNode",position:c,data:{label:o.name,description:o.description,expected_output:o.expected_output,tools:o.tools||[],human_input:(null==(f=o.advanced_config)?void 0:f.human_input)||!1,async_execution:(null==(y=o.advanced_config)?void 0:y.async_execution)||!1,task:o}};setTimeout(()=>{window.dispatchEvent(new Event("fitViewToNodesInternal"))},100),a?a([d],[]):e(e=>[...e,d])}})(re,le,Re,t,je,oe),Ye=((e,t,n,a,s,i,o,r)=>l=>{var c,d;e([]),t([]);const u=[],h=[],m=new Map;n(null),a(null);const g=(null==(c=l.agents)?void 0:c.length)||0,p=(null==(d=l.tasks)?void 0:d.length)||0,x=(null==o?void 0:o.current.getCrewLayoutPositions(g,p,"crew"))||{agentPositions:[],taskPositions:[],layoutBounds:null,shouldAutoFit:!1},{agentPositions:f,taskPositions:y}=x;l.agents&&l.agents.forEach((e,t)=>{var n;const a="agent-"+(e.id||Date.now()+t);m.set((null==(n=e.id)?void 0:n.toString())||e.name,a),u.push({id:a,type:"agentNode",position:f[t]||{x:100,y:100+150*t},data:{label:e.name,agentId:e.id,role:e.role,goal:e.goal,backstory:e.backstory,llm:e.llm||s,tools:e.tools||[],agent:e}})}),l.tasks&&l.tasks.forEach((e,t)=>{var n;const a="task-"+(e.id||Date.now()+t);if(u.push({id:a,type:"taskNode",position:y[t]||{x:400,y:100+150*t},data:{label:e.name,taskId:e.id,description:e.description,expected_output:e.expected_output,tools:e.tools||[],human_input:(null==(n=e.config)?void 0:n.human_input)||!1,async_execution:e.async_execution||!1,context:e.context||[],task:e}}),e.agent_id){const t=m.get(e.agent_id.toString());if(t){const{layoutOrientation:e}=E.z.getState(),n="vertical"===e?"bottom":"right",s="vertical"===e?"top":"left",i=(0,rn.RU)(rn.Gs.AGENT_TO_TASK,!1);h.push({id:"edge-"+t+"-"+a,source:t,target:a,type:"default",animated:!1,sourceHandle:n,targetHandle:s,style:i})}}e.context&&Array.isArray(e.context)&&e.context.forEach(e=>{const t="task-"+e;if(u.some(e=>e.id===t)){const e=(0,rn.RU)(rn.Gs.TASK_TO_TASK,!0);h.push({id:"edge-"+t+"-"+a,source:t,target:a,sourceHandle:"right",targetHandle:"left",type:"default",animated:!0,style:e})}})}),i?i(u,h):(e(e=>[...e,...u]),t(e=>[...e,...h])),setTimeout(()=>{window.dispatchEvent(new Event("fitViewToNodesInternal"))},500),[300,500,800,1200].forEach(e=>{setTimeout(()=>{var e;null==r||null==(e=r.current)||e.focus()},e)})})(re,le,He,Ve,r,t,je,oe),Xe=async()=>{if(!j.trim()||C)return;if(B&&H.length>0&&J<H.length){const e=H[J],t=j.trim(),n={id:"msg-"+Date.now(),type:"user",content:j,timestamp:new Date};Re(e=>[...e,n]),k(""),Pe(n);const a=Object.assign({},G,{[e]:t});if(q(a),J+1<H.length){X(J+1);const e=H[J+1],t={id:"msg-"+(Date.now()+1),type:"assistant",content:"Please provide a value for **{"+e+"}**:",timestamp:new Date};Re(e=>[...e,t]),Pe(t)}else{V(!1),he(a);const e={id:"msg-"+(Date.now()+1),type:"assistant",content:"\u2705 All variables collected! Executing "+Z+" with:\n"+Object.entries(a).map(e=>{let[t,n]=e;return"- **{"+t+"}**: "+n}).join("\n"),timestamp:new Date};Re(t=>[...t,e]),Pe(e);const t={id:"exec-pending-"+Date.now(),type:"execution",content:"\u23f3 Preparing to execute "+Z+"...",timestamp:new Date};Re(e=>[...e,t]),"crew"===Z?await me(g,x):await ge(g,x),K([]),q({}),X(0)}return}const e=We[We.length-1];if("assistant"===(null==e?void 0:e.type)&&(null==e?void 0:e.content.includes("Would you like to execute this crew now?"))){const e=j.trim().toLowerCase(),t={id:"msg-"+Date.now(),type:"user",content:j,timestamp:new Date};if(Re(e=>[...e,t]),k(""),Pe(t),"yes"===e||"y"===e||"yeah"===e||"sure"===e||"ok"===e||"okay"===e){if(D(g)){const e=Ge(g);if(e.length>0&&"chat"===ue){V(!0),K(e),q({}),X(0),$("crew");const t={id:"msg-"+(Date.now()+1),type:"assistant",content:"I need to collect values for "+e.length+" variable"+(e.length>1?"s":"")+" in your workflow.\n\nPlease provide a value for **{"+e[0]+"}**:",timestamp:new Date};Re(e=>[...e,t]),Pe(t)}else if(f){const e={id:"exec-pending-"+Date.now(),type:"execution",content:"\u23f3 Preparing to execute crew...",timestamp:new Date};Re(t=>[...t,e]),f()}}}else{const e={id:"msg-"+(Date.now()+1),type:"assistant",content:'No problem! The crew is ready whenever you want to execute it. Just type "execute crew" or "ec" when you\'re ready.',timestamp:new Date};Re(t=>[...t,e]),Pe(e)}return}const t=j.trim().toLowerCase();if("input mode dialog"===t||"input dialog"===t){const e={id:"msg-"+Date.now(),type:"user",content:j,timestamp:new Date};Re(t=>[...t,e]),k(""),Pe(e),ce("dialog");const t={id:"msg-"+(Date.now()+1),type:"assistant",content:"\u2705 Input mode changed to Dialog. When executing workflows with variables, a popup dialog will appear to collect all values at once.",timestamp:new Date};return Re(e=>[...e,t]),void Pe(t)}if("input mode chat"===t||"input chat"===t){const e={id:"msg-"+Date.now(),type:"user",content:j,timestamp:new Date};Re(t=>[...t,e]),k(""),Pe(e),ce("chat");const t={id:"msg-"+(Date.now()+1),type:"assistant",content:"\u2705 Input mode changed to Chat. When executing workflows with variables, I will guide you through providing values one by one in the chat.",timestamp:new Date};return Re(e=>[...e,t]),void Pe(t)}if((e=>{const t=e.trim().toLowerCase();return"execute crew"===t||"ec"===t||"run"===t||"execute"===t||t.startsWith("ec ")||t.startsWith("execute crew ")})(j)){const e={id:"msg-"+Date.now(),type:"user",content:j,timestamp:new Date};Re(t=>[...t,e]),k(""),Pe(e);const t=(e=>{const t=e.trim().toLowerCase();return t.startsWith("ec ")?e.trim().substring(3).trim():t.startsWith("execute crew ")?e.trim().substring(13).trim():null})(j);if(t){S(!0);try{const e=await As.A.getTraces(t);if(e&&e.length>0){const n={id:"msg-"+(Date.now()+1),type:"assistant",content:"Showing "+e.length+" execution traces for job "+t+":",timestamp:new Date};Re(e=>[...e,n]),e.forEach((e,n)=>{var a,s;let i="";if("string"===typeof e.output?i=e.output:null!=(a=e.output)&&a.agent_execution&&"string"===typeof e.output.agent_execution?i=e.output.agent_execution:null!=(s=e.output)&&s.content&&"string"===typeof e.output.content?i=e.output.content:e.output&&(i=JSON.stringify(e.output,null,2)),!i.trim())return;const o={id:"trace-display-"+e.id+"-"+n,type:"trace",content:i,timestamp:new Date(e.created_at||Date.now()),isIntermediate:!1,eventSource:e.event_source,eventContext:e.event_context,eventType:e.event_type,jobId:t||void 0};Re(e=>[...e,o]),Pe(o)})}else{const e={id:"msg-"+(Date.now()+1),type:"assistant",content:"No execution traces found for job "+t+".",timestamp:new Date};Re(t=>[...t,e])}}catch(h){const e={id:"msg-"+(Date.now()+1),type:"assistant",content:"Failed to fetch execution traces. Please try again.",timestamp:new Date};Re(t=>[...t,e])}finally{S(!1)}return}if(D(g)){const e=Ge(g);if(e.length>0&&"chat"===ue){V(!0),K(e),q({}),X(0),$("crew");const t={id:"msg-"+(Date.now()+1),type:"assistant",content:"I need to collect values for "+e.length+" variable"+(e.length>1?"s":"")+" in your workflow.\n\nPlease provide a value for **{"+e[0]+"}**:",timestamp:new Date};Re(e=>[...e,t]),Pe(t)}else if(f){const e={id:"exec-pending-"+Date.now(),type:"execution",content:"\u23f3 Preparing to execute crew...",timestamp:new Date};Re(t=>[...t,e]),f()}return}const n={id:"msg-"+(Date.now()+1),type:"assistant",content:"No crew found. Please create a crew first using natural language.",timestamp:new Date};return void Re(e=>[...e,n])}const n={id:"msg-"+Date.now(),type:"user",content:j,timestamp:new Date};Re(e=>[...e,n]),k(""),S(!0),Pe(n);let a=null;const s=n.content.trim().toLowerCase();let i=null;const o=/\b(create|build|make|generate|draft|compose|design)\b.*\b(plan|crew|workflow)\b/.test(s)||/\b(plan|crew|workflow)\b.*\b(create|build|make|generate|draft|compose|design)\b/.test(s)||s.includes("create a plan")||s.includes("create plan"),c=/\b(create|add|new|make|generate)\b.*\b(agent)\b/.test(s)||s.includes("create an agent")||s.includes("create agent"),d=/\b(create|add|new|make|generate)\b.*\b(task)\b/.test(s)||s.includes("create a task")||s.includes("create task"),u=e=>{const t={id:"progress-"+Date.now(),type:"assistant",content:e,timestamp:new Date,isIntermediate:!0};return Re(e=>[...e,t]),()=>Re(e=>e.filter(e=>e.id!==t.id))};try{if(o){i=u("\u23f3 Generating plan/crew\u2026");const e=[],t=[],n=i;n&&e.push(n);const s=(n,a)=>{const s=window.setTimeout(()=>{const t=u(a);e.push(t)},n);t.push(s)};s(1e3,"\u{1f9e0} Analyzing request\u2026"),s(3e3,"\u{1f916} Drafting agent\u2026"),s(4500,"\u{1f4dd} Drafting task\u2026"),i=()=>{t.forEach(e=>window.clearTimeout(e)),e.forEach(e=>e())};const o=Date.now(),r="agent-temp-"+o,l="task-temp-"+o;re(e=>{const t=je.current.getAgentNodePosition(e,"crew")||{x:100,y:100},n={id:r,type:"agentNode",position:t,data:{label:"Creating agent\u2026",loading:!0}};return[...e,n]}),setTimeout(()=>{re(e=>{const t=je.current.getTaskNodePosition(e,"crew")||{x:380,y:100},n={id:l,type:"taskNode",position:t,data:{label:"Creating task\u2026",taskId:l,loading:!0}};return[...e,n]}),le(e=>[...e,{id:"edge-"+r+"-"+l,source:r,target:l,type:"default",animated:!0,sourceHandle:"right",targetHandle:"left"}])},5e3),a=()=>{le(e=>e.filter(e=>e.id!=="edge-"+r+"-"+l)),re(e=>e.filter(e=>e.id!==r&&e.id!==l))}}else if(c){i=u("\u23f3 Creating agent\u2026");const e="agent-temp-"+Date.now();re(t=>{const n=je.current.getAgentNodePosition(t,"crew")||{x:100,y:100},a={id:e,type:"agentNode",position:n,data:{label:"Creating agent\u2026",loading:!0}};return[...t,a]}),a=()=>{re(t=>t.filter(t=>t.id!==e))}}else if(d){i=u("\u23f3 Creating task\u2026");const e="task-temp-"+Date.now();re(t=>{const n=je.current.getTaskNodePosition(t,"crew")||{x:380,y:100},a={id:e,type:"taskNode",position:n,data:{label:"Creating task\u2026",taskId:e,loading:!0}};return[...t,a]}),a=()=>{re(t=>t.filter(t=>t.id!==e))}}const e=await us.dispatch({message:n.content,model:r,tools:l});i&&(i(),i=null);const t={id:"msg-"+(Date.now()+1),type:"assistant",content:Qe(e),timestamp:new Date,intent:e.dispatcher.intent,confidence:e.dispatcher.confidence,result:e.generation_result};if(Re(e=>[...e,t]),Pe(t),a&&(a(),a=null),e.generation_result)switch(e.dispatcher.intent){case"generate_agent":await qe(e.generation_result);break;case"generate_task":await Je(e.generation_result);break;case"generate_crew":case"generate_plan":Ye(e.generation_result);break;case"configure_crew":((e,t)=>{const{config_type:n,actions:a}=e;null!=a&&a.open_llm_dialog&&setTimeout(()=>{const e=new CustomEvent("openLLMDialog");window.dispatchEvent(e)},100),null!=a&&a.open_maxr_dialog&&setTimeout(()=>{const e=new CustomEvent("openMaxRPMDialog");window.dispatchEvent(e)},200),null!=a&&a.open_tools_dialog&&setTimeout(()=>{const e=new CustomEvent("openToolDialog");window.dispatchEvent(e)},300),setTimeout(()=>{var e;null==t||null==(e=t.current)||e.focus()},500)})(e.generation_result,oe)}}catch(h){const e={id:"msg-"+(Date.now()+1),type:"assistant",content:"\u274c Failed to process your request. Please try again or rephrase your message.",timestamp:new Date};Re(t=>[...t,e]),Pe(e)}finally{a&&(a(),a=null),i&&(i(),i=null),S(!1);[0,50,100,200,300,500,800,1200].forEach(e=>{setTimeout(()=>{var e;null==(e=oe.current)||e.focus()},e)})}},Qe=e=>{const{dispatcher:t,generation_result:n}=e;if("unknown"===t.intent)return"I'm not sure what you want to create. Please specify if you want to create an agent, a task, or a complete crew.";if(!n)return"I understood your request but couldn't generate the result. Please try again.";switch(t.intent){case"generate_agent":{const e=n;return"I've created an agent: **"+e.name+"** ("+e.role+")\n- Goal: "+e.goal+"\n- Backstory: "+e.backstory}case"generate_task":{const e=n;return"I've created a task: **"+e.name+"**\n- Description: "+e.description+"\n- Expected Output: "+e.expected_output}case"generate_crew":{const e=n;let t="I've created a crew with:\n";if(e.agents&&e.agents.length>0){var a;t+="\n**Agents & Tasks:**\n",e.agents.forEach((n,a)=>{var s;t+=a+1+". **"+n.name+"** ("+n.role+") - "+n.goal+"\n";const i=(null==(s=e.tasks)?void 0:s.filter(e=>{var t,a;return e.agent_id===n.id||(null==(t=e.agent_id)?void 0:t.toString())===(null==(a=n.id)?void 0:a.toString())}))||[];i.length>0&&i.forEach(e=>{t+="   \u2192 "+e.name+": "+e.description+"\n"})});const n=(null==(a=e.tasks)?void 0:a.filter(e=>!e.agent_id))||[];n.length>0&&(t+="\n**Unassigned Tasks:**\n",n.forEach((e,n)=>{t+=n+1+". **"+e.name+"** - "+e.description+"\n"}))}return t+="\nTo execute plan type either **execute crew** or **ec**",t}case"generate_plan":{const e=n;let t="I've created a plan with:\n";if(e.agents&&e.agents.length>0){var s;t+="\n**Agents & Tasks:**\n",e.agents.forEach((n,a)=>{var s;t+=a+1+". **"+n.name+"** ("+n.role+") - "+n.goal+"\n";const i=(null==(s=e.tasks)?void 0:s.filter(e=>{var t,a;return e.agent_id===n.id||(null==(t=e.agent_id)?void 0:t.toString())===(null==(a=n.id)?void 0:a.toString())}))||[];i.length>0&&i.forEach(e=>{t+="   \u2192 "+e.name+": "+e.description+"\n"})});const n=(null==(s=e.tasks)?void 0:s.filter(e=>!e.agent_id))||[];n.length>0&&(t+="\n**Unassigned Tasks:**\n",n.forEach((e,n)=>{t+=n+1+". **"+e.name+"** - "+e.description+"\n"}))}return t+="\nTo execute plan type either **execute crew** or **ec**",t}default:return"Your request has been processed successfully."}},Ze=j.trim().length>0,$e=D(g),et=C||!!Be||!Ze&&!$e;return(0,W.jsxs)(i.A,{sx:{height:"100%",display:"flex",flexDirection:"column",position:"relative",overflow:"hidden",maxWidth:"100%",width:"100%"},children:[(0,W.jsxs)(i.A,{sx:{p:1,borderBottom:1,borderColor:"divider",display:"flex",alignItems:"center",justifyContent:"space-between",backgroundColor:e=>"dark"===e.palette.mode?"grey.900":"grey.50",flexShrink:0},children:[(0,W.jsxs)(i.A,{sx:{display:"flex",flexDirection:"column"},children:[(0,W.jsxs)(c.A,{variant:"subtitle2",sx:{display:"flex",alignItems:"center",gap:1,fontWeight:600},children:[(0,W.jsx)(i.A,{component:"img",src:"/kasal-icon-16.png",alt:"Kasal",sx:{width:16,height:16,borderRadius:.5}}),"Kasal"]}),"New Chat"!==Oe&&(0,W.jsx)(c.A,{variant:"caption",sx:{color:"text.secondary",ml:3},children:Oe})]}),(0,W.jsxs)(is.A,{direction:"row",spacing:1,children:[(0,W.jsx)(M.A,{title:"New Chat",children:(0,W.jsx)(d.A,{size:"small",onClick:Le,children:(0,W.jsx)($t.A,{fontSize:"small"})})}),(0,W.jsx)(M.A,{title:"Chat History",children:(0,W.jsx)(d.A,{size:"small",onClick:()=>{I(!0),Me()},children:(0,W.jsx)(rs.A,{fontSize:"small"})})}),(0,W.jsx)(M.A,{title:"right"===xe?"Move Chat to Left":"Move Chat to Right",children:(0,W.jsx)(d.A,{size:"small",onClick:()=>be("right"===xe?"left":"right"),children:(0,W.jsx)(ds.A,{fontSize:"small"})})}),(0,W.jsx)(M.A,{title:"Collapse Chat",children:(0,W.jsx)(d.A,{size:"small",onClick:y,children:(0,W.jsx)(z.A,{fontSize:"small"})})})]})]}),(0,W.jsxs)(i.A,{sx:{position:"absolute",top:0,right:_?0:"-450px",width:450,height:"100%",backgroundColor:e=>e.palette.background.paper,boxShadow:e=>_?e.shadows[8]:"none",transition:"right 0.3s ease-in-out",zIndex:10,display:"flex",flexDirection:"column"},children:[(0,W.jsxs)(i.A,{sx:{p:1.5,borderBottom:1,borderColor:"divider",backgroundColor:e=>"dark"===e.palette.mode?"grey.900":"grey.50",display:"flex",alignItems:"center",justifyContent:"space-between"},children:[(0,W.jsx)(c.A,{variant:"subtitle2",sx:{fontWeight:600},children:"Chat History"}),(0,W.jsxs)(is.A,{direction:"row",spacing:.5,children:[(0,W.jsx)(M.A,{title:"Refresh",children:(0,W.jsx)(d.A,{size:"small",onClick:Me,disabled:De,children:De?(0,W.jsx)(Y.A,{size:20}):(0,W.jsx)(ls.A,{})})}),(0,W.jsx)(M.A,{title:"Close",children:(0,W.jsx)(d.A,{size:"small",onClick:()=>I(!1),children:(0,W.jsx)(N.A,{fontSize:"small"})})})]})]}),(0,W.jsx)(i.A,{sx:{flex:1,overflow:"auto",p:2},children:0===Ie.length?(0,W.jsx)(c.A,{variant:"body2",color:"text.secondary",sx:{textAlign:"center",mt:4},children:"No previous chat sessions found"}):(0,W.jsx)(at.A,{sx:{p:0},children:Ie.map(e=>(0,W.jsxs)(aa.A,{onClick:()=>ze(e.session_id),selected:e.session_id===Se,sx:{borderRadius:1,mb:1,border:1,borderColor:"divider"},children:[(0,W.jsx)(ot.A,{primary:JSON.parse(localStorage.getItem("chatSessionJobNames")||"{}")[e.session_id]||"Session "+new Date(e.latest_timestamp).toLocaleDateString(),secondary:new Date(e.latest_timestamp).toLocaleTimeString()+" \u2022 "+(e.message_count||0)+" messages"}),(0,W.jsx)(M.A,{title:"Delete Session",children:(0,W.jsx)(d.A,{edge:"end",size:"small",onClick:async t=>{t.stopPropagation();try{await vs.deleteSession(e.session_id);const t=JSON.parse(localStorage.getItem("chatSessionJobNames")||"{}");delete t[e.session_id],localStorage.setItem("chatSessionJobNames",JSON.stringify(t)),Me()}catch(n){const e={id:"error-"+Date.now(),type:"assistant",content:"\u274c Failed to delete session. Please try again.",timestamp:new Date};Re(t=>[...t,e])}},children:(0,W.jsx)(Q.A,{fontSize:"small"})})})]},e.session_id))})})]}),_&&(0,W.jsx)(i.A,{onClick:()=>I(!1),sx:{position:"absolute",top:0,left:-1e3,right:450,bottom:0,zIndex:9}}),(0,W.jsxs)(i.A,{ref:ve,onScroll:()=>{const e=ve.current;if(!e)return;const t=e.scrollHeight-e.scrollTop-e.clientHeight<=80;Ae.current=t},sx:{flex:1,overflow:"auto",px:1,py:2,width:"100%",maxWidth:"100%",position:"relative",minWidth:0,display:"flex",flexDirection:"column"},children:[0===We.length?(0,W.jsxs)(i.A,{sx:{textAlign:"center",mt:4},children:[(0,W.jsx)(c.A,{variant:"body2",color:"text.secondary",paragraph:!0,children:"Try saying something like:"}),(0,W.jsxs)(at.A,{dense:!0,children:[(0,W.jsx)(st.Ay,{children:(0,W.jsx)(ot.A,{primary:"Create an agent that can analyze financial data",secondary:"Creates a single agent"})}),(0,W.jsx)(st.Ay,{children:(0,W.jsx)(ot.A,{primary:"I need a task to summarize documents",secondary:"Creates a single task"})}),(0,W.jsx)(st.Ay,{children:(0,W.jsx)(ot.A,{primary:"Build a research team with a researcher and writer",secondary:"Complete a plan"})})]})]}):(0,W.jsx)(at.A,{sx:{width:"100%",maxWidth:"100%",pt:0,pb:0},children:(()=>{const e=We.filter(e=>"execution"!==e.type||!e.content.includes("\u{1f680} Started execution:")&&!e.content.includes("\u2705 Execution completed successfully")),t=[];let n=[];return e.forEach((e,a)=>{"trace"===e.type?n.push(e):(n.length>0&&(t.push([...n]),n=[]),t.push(e))}),n.length>0&&t.push(n),t.map((e,n)=>{if(Array.isArray(e)){const a="trace-group-"+e[0].id+"-"+e[e.length-1].id+"-"+n;return(0,W.jsxs)(s.Fragment,{children:[(0,W.jsx)(Vs,{messages:e,onOpenLogs:A}),n<t.length-1&&(0,W.jsx)(ne.A,{component:"li",sx:{ml:0}})]},a)}return(0,W.jsxs)(s.Fragment,{children:[(0,W.jsx)(Bs,{message:e,onOpenLogs:A}),n<t.length-1&&(0,W.jsx)(ne.A,{component:"li",sx:{ml:0}})]},e.id)})})()}),(0,W.jsx)("div",{ref:ie})]}),(0,W.jsx)(_e.A,{elevation:3,sx:{p:2,borderTop:1,borderColor:"divider",borderRadius:0,flexShrink:0},children:(0,W.jsxs)(i.A,{sx:{position:"relative"},children:[(0,W.jsx)(U.A,{ref:oe,fullWidth:!0,variant:"outlined",placeholder:Be?"Execution in progress...":"Describe what you want to create...",value:j,onChange:e=>k(e.target.value),onKeyDown:e=>{(e=>{e.stopPropagation(),"Enter"!==e.key||e.shiftKey||(e.preventDefault(),Xe())})(e),e.stopPropagation()},disabled:C||!!Be,multiline:!0,maxRows:6,size:"small",sx:{"& .MuiOutlinedInput-root":{paddingRight:"120px",borderColor:D(g)?"primary.main":void 0,borderRadius:1,"&:hover":{borderColor:D(g)?"primary.main":void 0}}},InputProps:{endAdornment:(0,W.jsxs)(i.A,{sx:{position:"absolute",right:35,bottom:8,display:"flex",alignItems:"center",gap:.25},children:[(0,W.jsx)(i.A,{sx:{display:"flex",alignItems:"center"},children:(0,W.jsx)(Qs,{executionId:Se||"default",groupId:localStorage.getItem("groupId")||"default",hasAgents:g.some(e=>"agentNode"===e.type),hasTasks:g.some(e=>"taskNode"===e.type),disabled:C||!!Be||!ee||!te||!g.some(e=>"agentNode"===e.type)||!g.some(e=>"taskNode"===e.type),onFilesUploaded:e=>{},onTasksUpdated:async e=>{var t;const a=g.find(e=>"agentNode"===e.type),s=(null==a||null==(t=a.data)?void 0:t.agentId)||(null==a?void 0:a.id),i=g.map(t=>{if("taskNode"===t.type){var a;const i=t.data.tools||[],o=t.data.tool_configs||{},r=i.includes("DatabricksKnowledgeSearchTool")||i.includes("36")?i:[...i,"DatabricksKnowledgeSearchTool"],l=(null==(a=o.DatabricksKnowledgeSearchTool)?void 0:a.file_paths)||[],c=Object.assign({},o,{DatabricksKnowledgeSearchTool:Object.assign({},o.DatabricksKnowledgeSearchTool,{file_paths:l.includes(e)?l:[...l,e],agent_id:s})});return t.data.taskId&&Promise.resolve().then(n.bind(n,31076)).then(e=>{let{TaskService:n}=e;n.updateTask(t.data.taskId,{tools:r,tool_configs:c}).catch(e=>{})}),Object.assign({},t,{data:Object.assign({},t.data,{tools:r,tool_configs:c})})}return t});re(i)},onAgentsUpdated:e=>{const t=e.some(e=>e.knowledge_sources&&e.knowledge_sources.length>0),n=g.map(n=>{if("agentNode"===n.type){const t=e.find(e=>e.id===n.data.agentId||e.id===n.data.id||e.id&&"agent-"+e.id===n.id||"agent-"+e.name===n.id);if(t)return Object.assign({},n,{data:Object.assign({},n.data,t,{agentId:t.id,tools:t.tools,knowledge_sources:t.knowledge_sources})})}if("taskNode"===n.type&&t){const e=n.data.tools||[];if(!(e.includes("DatabricksKnowledgeSearchTool")||e.includes("36")))return Object.assign({},n,{data:Object.assign({},n.data,{tools:[...e,"DatabricksKnowledgeSearchTool"]})})}return n});re(n)},availableAgents:g.filter(e=>"agentNode"===e.type).map(e=>Object.assign({},e.data,{id:e.data.agentId||e.data.id})),compact:!0})}),h&&(0,W.jsxs)(i.A,{onClick:e=>F(e.currentTarget),sx:{display:"flex",alignItems:"center",gap:.25,cursor:"pointer",padding:"2px 6px",borderRadius:.5,fontSize:"0.75rem",color:"text.secondary",transition:"all 0.2s",backgroundColor:"rgba(255, 255, 255, 0.8)",maxWidth:"110px","&:hover":{backgroundColor:"action.hover",color:"text.primary"}},children:[(0,W.jsx)(c.A,{variant:"caption",sx:{fontSize:"0.75rem",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",maxWidth:"90px"},children:(e=>{const t=((null==(e=T[r])?void 0:e.name)||r).replace(/^databricks-/,"");return t.includes("gpt-oss-120b")?"GPT OSS 120B":t.includes("gpt-oss-20b")?"GPT OSS 20B":t.includes("llama-4-maverick")?"Llama 4":t.includes("meta-llama-3-1-405b")?"Llama 3.1 405B":t.includes("meta-llama-3-3-70b")?"Llama 3.3 70B":t.includes("gpt-5-mini")?"GPT-5 Mini":t.includes("gpt-5-nano")?"GPT-5 Nano":t.includes("gpt-5")?"GPT-5":t.includes("gemini-2-5-pro")?"Gemini 2.5 Pro":t.includes("gemini-2-5-flash")?"Gemini 2.5 Flash":t.includes("claude-sonnet-4-5")?"Claude 4.5":t.includes("claude-sonnet-4")?"Claude 4":t.includes("qwen3-next-80b")?"Qwen3 80B":t.includes("gemma-3-12b")?"Gemma 3 12B":t.length>15?t.substring(0,15)+"...":t})()}),(0,W.jsx)(cs.A,{sx:{fontSize:14}})]}),(0,W.jsx)(m.A,{anchorEl:R,open:Boolean(R),onClose:()=>F(null),anchorOrigin:{vertical:"top",horizontal:"right"},transformOrigin:{vertical:"bottom",horizontal:"right"},slotProps:{paper:{sx:{mt:-1,minWidth:250,maxHeight:400}}},children:P?(0,W.jsxs)(de.A,{disabled:!0,children:[(0,W.jsx)(Y.A,{size:16,sx:{mr:1}}),"Loading models..."]}):0===Object.keys(T).length?(0,W.jsx)(de.A,{disabled:!0,children:"No models available"}):Object.entries(T).map(e=>{let[t,n]=e;return(0,W.jsx)(de.A,{onClick:()=>{h&&h(t),F(null)},selected:t===r,sx:{fontSize:"0.813rem",py:.75,"&.Mui-selected":{backgroundColor:"action.selected"}},children:(0,W.jsxs)(i.A,{sx:{width:"100%"},children:[(0,W.jsx)(c.A,{variant:"body2",sx:{fontSize:"0.813rem"},children:(()=>{const e=n.name.replace(/^databricks-/,"");return e.includes("gpt-oss-120b")?"GPT OSS 120B":e.includes("gpt-oss-20b")?"GPT OSS 20B":e.includes("llama-4-maverick")?"Llama 4":e.includes("meta-llama-3-1-405b")?"Llama 3.1 405B":e.includes("meta-llama-3-3-70b")?"Llama 3.3 70B":e.includes("gpt-5-mini")?"GPT-5 Mini":e.includes("gpt-5-nano")?"GPT-5 Nano":e.includes("gpt-5")?"GPT-5":e.includes("gemini-2-5-pro")?"Gemini 2.5 Pro":e.includes("gemini-2-5-flash")?"Gemini 2.5 Flash":e.includes("claude-sonnet-4-5")?"Claude Sonnet 4.5":e.includes("claude-3-7-sonnet")?"Claude 3.7 Sonnet":e.includes("claude-sonnet-4")?"Claude Sonnet 4":e.includes("qwen3-next-80b")?"Qwen3 Next 80B":e.includes("gemma-3-12b")?"Gemma 3 12B":e})()}),n.provider&&(0,W.jsx)(c.A,{variant:"caption",sx:{fontSize:"0.688rem",color:"text.secondary",display:"block"},children:n.provider})]})},t)})})]})}}),(0,W.jsx)(d.A,{color:"primary",onClick:Ze?Xe:()=>{$e&&f&&f()},disabled:et,sx:{position:"absolute",right:8,bottom:8,padding:"6px",backgroundColor:"primary.main",color:"primary.contrastText",borderRadius:"50%",width:28,height:28,"&:hover":{backgroundColor:"primary.dark"},"&.Mui-disabled":{backgroundColor:"action.disabledBackground",color:"action.disabled"}},children:C||Be?(0,W.jsx)(Y.A,{size:16,sx:{color:"inherit"}}):Ze?(0,W.jsx)(os.A,{sx:{fontSize:16}}):(0,W.jsx)(Xn.A,{sx:{fontSize:16}})})]})})]})},$s=Zs,ei=e=>{let{onNodesGenerated:t,onLoadingStateChange:n,isVisible:a=!0,nodes:s=[],edges:o=[],onExecuteCrew:r,isCollapsed:l=!1,onToggleCollapse:c,chatSessionId:u,onOpenLogs:h,chatSide:m="right"}=e;const{selectedModel:g,setSelectedModel:p}=(0,v.E)(),{selectedTools:x}=pn();return l?(0,W.jsx)(_e.A,{"data-tour":"chat-toggle",sx:Object.assign({width:60,height:"100%",display:"flex",flexDirection:"column",alignItems:"center"},"right"===m?{borderLeft:1}:{borderRight:1},{borderColor:"divider",borderRadius:0,boxShadow:"none",backgroundColor:"background.paper",overflow:"hidden",contain:"layout size"}),children:(0,W.jsxs)(i.A,{sx:{p:1.5,borderBottom:1,borderColor:"divider",backgroundColor:e=>"dark"===e.palette.mode?"grey.900":"grey.50",width:"100%",display:"flex",flexDirection:"column",alignItems:"center",gap:1},children:[(0,W.jsx)(i.A,{component:"img",src:"/kasal-icon-24.png",alt:"Kasal",sx:{width:24,height:24,borderRadius:.5}}),(0,W.jsx)(M.A,{title:"Expand Kasal Chat",placement:"right"===m?"left":"right",children:(0,W.jsx)(d.A,{size:"small",onClick:c,sx:{backgroundColor:"primary.main",color:"primary.contrastText","&:hover":{backgroundColor:"primary.dark"}},children:"right"===m?(0,W.jsx)(as.A,{fontSize:"small"}):(0,W.jsx)(ss.A,{fontSize:"small"})})})]})}):(0,W.jsx)(_e.A,{"data-tour":"chat-panel",sx:Object.assign({height:"100%",width:"100%",display:"flex",flexDirection:"column"},"right"===m?{borderLeft:1}:{borderRight:1},{borderColor:"divider",borderRadius:0,boxShadow:"none",transition:"all 0.3s ease-in-out",overflow:"hidden",position:"relative",minWidth:0,isolation:"isolate",contain:"layout size"}),children:(0,W.jsx)(i.A,{sx:{flex:1,overflow:"hidden",display:"flex",flexDirection:"column",position:"relative",width:"100%",minWidth:0,"& > *":{minWidth:0,maxWidth:"100%"}},children:(0,W.jsx)($s,{onNodesGenerated:t,onLoadingStateChange:n,selectedModel:g,selectedTools:x,isVisible:a,setSelectedModel:p,nodes:s,edges:o,onExecuteCrew:r,onToggleCollapse:c,chatSessionId:u,onOpenLogs:h})})})};var ti=n(97497),ni=n(28810),ai=n(59086),si=n(63364),ii=n(37921),oi=n(13413),ri=n(24350),li=n(23240),ci=n(5127),di=n(4160),ui=n(91311),hi=n(11361),mi=n(22906);const gi={"databricks-llama-4-maverick":{name:"databricks-llama-4-maverick",temperature:.7,context_window:128e3,max_output_tokens:4096,enabled:!0}},pi=e=>{var t;let{onClearCanvas:n,onGenerateConnections:a,onZoomIn:o,onZoomOut:r,onFitView:l,onToggleInteractivity:u,isGeneratingConnections:h,planningEnabled:m,setPlanningEnabled:g,reasoningEnabled:x,setReasoningEnabled:f,schemaDetectionEnabled:y,setSchemaDetectionEnabled:b,processType:A="sequential",setProcessType:j,setIsConfigurationDialogOpen:w,onOpenLogsDialog:k,showRunHistory:C,executionHistoryHeight:S=200,onOpenTutorial:_}=e;const I=(0,Ta.A)(),[T,D]=(0,s.useState)(null),[O,N]=(0,s.useState)(gi),[P,z]=(0,s.useState)(!0),[L,R]=(0,s.useState)(""),[F,B]=(0,s.useState)(""),{layoutOrientation:V,setLayoutOrientation:U}=(0,E.z)(),H=(0,s.useCallback)(()=>{U("horizontal"===V?"vertical":"horizontal"),setTimeout(()=>{window.dispatchEvent(new CustomEvent("recalculateNodePositions",{detail:{reason:"layout-orientation-toggle"}}))},50)},[V,U]),[K,G]=(0,s.useState)(""),{setLeftSidebarExpanded:q}=(0,E.z)();(0,s.useEffect)(()=>{q(!!T)},[T,q]);const{setPlanningLLM:J,setReasoningLLM:X,setProcessType:Q,setManagerLLM:Z,processType:$,managerLLM:ee}=(0,v.E)(),{shortcuts:te}=(0,mi._)(),{userRole:ae}=(0,Nn.o)(),se="operator"===ae,{hasSeenTutorial:ie}=(0,p.Y)();(0,s.useEffect)(()=>{(async()=>{z(!0);try{const e=ye.J.getInstance(),t=await e.getEnabledModels();if(N(t),t&&Object.keys(t).length>0&&!L){const e=Object.keys(t)[0];R(e),J(e)}if(t&&Object.keys(t).length>0&&!F){const e=Object.keys(t)[0];B(e),X(e)}if(t&&Object.keys(t).length>0)if(ee&&t[ee])G(ee);else if(!K){const e=Object.keys(t)[0];G(e),Z(e)}}catch(e){}finally{z(!1)}})()},[L,J,F,X,K,Z,ee]);const oe=(0,s.useCallback)(e=>{const t=e.target.value;R(t),J(t)},[J]),ue=(0,s.useCallback)(e=>{const t=e.target.value;B(t),X(t)},[X]),he=(0,s.useCallback)(e=>{const t=e.target.value;G(t),Z(t)},[Z]),ge=(0,s.useCallback)(e=>{const t=e.target.value;Q(t),j&&j(t)},[j,Q]),pe=(0,s.useMemo)(()=>{const e=new Set(["undo","redo","selectAll","copy","paste","toggleFullscreen","openAgentDialog","openTaskDialog","openCrewPlanningDialog"]),t={Canvas:[],Creation:[],Execution:[],Management:[]};return te.forEach(n=>{const a=n.action;e.has(a)||(a.includes("zoom")||a.includes("fit")||a.includes("clear")||a.includes("delete")?t.Canvas.push(n):a.includes("open")||a.includes("generate")?t.Creation.push(n):a.includes("execute")?t.Execution.push(n):t.Management.push(n))}),t},[te]),xe=[{id:"configuration",icon:(0,W.jsx)(ai.A,{}),tooltip:"Configuration",content:null,dataTour:"configuration-button"},{id:"help",icon:(0,W.jsx)(si.A,{}),tooltip:"Start Tutorial / Help",content:null,dataTour:"help-button"},...se?[]:[{id:"runtime-features",icon:(0,W.jsx)(ii.A,{}),tooltip:"Runtime Features",dataTour:"runtime-features",content:(0,W.jsxs)(i.A,{sx:{maxHeight:C?"calc(100vh - 48px - "+S+"px - 20px)":"calc(100vh - 48px - 20px)",overflowY:"auto",p:1},children:[(0,W.jsxs)(i.A,{sx:{mb:2},children:[(0,W.jsxs)(i.A,{sx:{display:"flex",alignItems:"center",mb:1},children:[(0,W.jsx)(c.A,{variant:"subtitle2",sx:{color:I.palette.primary.main,fontWeight:600,textTransform:"uppercase",letterSpacing:"0.5px",fontSize:"0.7rem"},children:"Process Type"}),(0,W.jsx)(M.A,{title:"Determines how agents collaborate. Sequential: agents work one after another in a fixed order. Hierarchical: a manager agent dynamically delegates tasks to specialized agents. Use Hierarchical for complex workflows requiring adaptive task distribution and parallel execution.",placement:"right",children:(0,W.jsx)(oi.A,{sx:{ml:.5,fontSize:14,color:I.palette.primary.main,cursor:"help"}})})]}),(0,W.jsx)(ne.A,{sx:{mb:1}}),(0,W.jsxs)(i.A,{sx:{display:"flex",flexDirection:"column",gap:1,py:.5,px:.5,borderRadius:1},children:[(0,W.jsxs)(re.A,{size:"small",fullWidth:!0,children:[(0,W.jsx)(le.A,{sx:{fontSize:"0.75rem"},children:"Execution Process"}),(0,W.jsxs)(ce.A,{value:$,onChange:ge,label:"Execution Process",sx:{fontSize:"0.75rem"},children:[(0,W.jsx)(de.A,{value:"sequential",sx:{fontSize:"0.75rem"},children:"Sequential - Linear task execution"}),(0,W.jsx)(de.A,{value:"hierarchical",sx:{fontSize:"0.75rem"},children:"Hierarchical - Manager-based delegation"})]})]}),"hierarchical"===($||A)&&(0,W.jsxs)(re.A,{size:"small",fullWidth:!0,sx:{mt:1},children:[(0,W.jsx)(le.A,{sx:{fontSize:"0.75rem"},children:"Manager LLM"}),(0,W.jsx)(ce.A,{value:K,onChange:he,label:"Manager LLM",disabled:P,sx:{fontSize:"0.75rem"},renderValue:e=>{const t=O[e];return t?t.name:e},children:P?(0,W.jsx)(de.A,{value:"",children:(0,W.jsx)(Y.A,{size:16})}):0===Object.keys(O).length?(0,W.jsx)(de.A,{value:"",children:"No models available"}):Object.entries(O).map(e=>{let[t,n]=e;return(0,W.jsx)(de.A,{value:t,sx:{fontSize:"0.75rem"},children:(0,W.jsx)("span",{children:n.name})},t)})})]}),"hierarchical"===($||A)&&(0,W.jsx)(c.A,{variant:"caption",sx:{color:"text.secondary",fontSize:"0.65rem",mt:.5},children:"Manager coordinates task delegation to agents"})]})]}),(0,W.jsxs)(i.A,{sx:{mb:2},children:[(0,W.jsxs)(i.A,{sx:{display:"flex",alignItems:"center",mb:1},children:[(0,W.jsx)(c.A,{variant:"subtitle2",sx:{color:I.palette.primary.main,fontWeight:600,textTransform:"uppercase",letterSpacing:"0.5px",fontSize:"0.7rem"},children:"Planning"}),(0,W.jsx)(M.A,{title:"Crew-level strategic planning before task execution. ENABLE for: complex multi-step workflows, task dependencies requiring orchestration, projects needing autonomous task decomposition. DISABLE for: simple well-defined tasks, speed-critical operations, deterministic workflows with fixed sequences. Adds 5-10min overhead but improves task coordination.",placement:"right",children:(0,W.jsx)(oi.A,{sx:{ml:.5,fontSize:14,color:I.palette.primary.main,cursor:"help"}})})]}),(0,W.jsx)(ne.A,{sx:{mb:1}}),(0,W.jsxs)(i.A,{sx:{display:"flex",flexDirection:"column",gap:1,py:.5,px:.5,borderRadius:1},children:[(0,W.jsxs)(i.A,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[(0,W.jsx)(c.A,{variant:"caption",sx:{color:"text.primary",fontSize:"0.75rem"},children:"Crew Level Planning"}),(0,W.jsx)(me.A,{checked:m,onChange:e=>g(e.target.checked),size:"small"})]}),m&&(0,W.jsxs)(re.A,{size:"small",fullWidth:!0,sx:{mt:1},children:[(0,W.jsx)(le.A,{sx:{fontSize:"0.75rem"},children:"Planning LLM"}),(0,W.jsx)(ce.A,{value:L,onChange:oe,label:"Planning LLM",disabled:P,sx:{fontSize:"0.75rem"},renderValue:e=>{const t=O[e];return t?t.name:e},children:P?(0,W.jsx)(de.A,{value:"",children:(0,W.jsx)(Y.A,{size:16})}):0===Object.keys(O).length?(0,W.jsx)(de.A,{value:"",children:"No models available"}):Object.entries(O).map(e=>{let[t,n]=e;return(0,W.jsx)(de.A,{value:t,sx:{fontSize:"0.75rem"},children:(0,W.jsx)("span",{children:n.name})},t)})})]})]})]}),(0,W.jsxs)(i.A,{sx:{mb:2},children:[(0,W.jsxs)(i.A,{sx:{display:"flex",alignItems:"center",mb:1},children:[(0,W.jsx)(c.A,{variant:"subtitle2",sx:{color:I.palette.primary.main,fontWeight:600,textTransform:"uppercase",letterSpacing:"0.5px",fontSize:"0.7rem"},children:"Reasoning"}),(0,W.jsx)(M.A,{title:"Agent-level reflection and planning before each task. ENABLE for: complex tasks needing breakdown, problems requiring methodical analysis, identifying challenges upfront, quality over speed. DISABLE for: simple straightforward tasks, time-critical operations, well-defined procedures, repetitive tasks. Each reasoning iteration adds overhead and potential error risk. Max attempts limits refinement cycles.",placement:"right",children:(0,W.jsx)(oi.A,{sx:{ml:.5,fontSize:14,color:I.palette.primary.main,cursor:"help"}})})]}),(0,W.jsx)(ne.A,{sx:{mb:1}}),(0,W.jsxs)(i.A,{sx:{display:"flex",flexDirection:"column",gap:1,py:.5,px:.5,borderRadius:1},children:[(0,W.jsxs)(i.A,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[(0,W.jsx)(c.A,{variant:"caption",sx:{color:"text.primary",fontSize:"0.75rem"},children:"Agent Level Reasoning"}),(0,W.jsx)(me.A,{checked:x,onChange:e=>f(e.target.checked),size:"small"})]}),x&&(0,W.jsxs)(re.A,{size:"small",fullWidth:!0,sx:{mt:1},children:[(0,W.jsx)(le.A,{sx:{fontSize:"0.75rem"},children:"Reasoning LLM"}),(0,W.jsx)(ce.A,{value:F,onChange:ue,label:"Reasoning LLM",disabled:P,sx:{fontSize:"0.75rem"},renderValue:e=>{const t=O[e];return t?t.name:e},children:P?(0,W.jsx)(de.A,{value:"",children:(0,W.jsx)(Y.A,{size:16})}):0===Object.keys(O).length?(0,W.jsx)(de.A,{value:"",children:"No models available"}):Object.entries(O).map(e=>{let[t,n]=e;return(0,W.jsx)(de.A,{value:t,sx:{fontSize:"0.75rem"},children:(0,W.jsx)("span",{children:n.name})},t)})})]})]})]}),(0,W.jsxs)(i.A,{sx:{mb:2},children:[(0,W.jsx)(c.A,{variant:"subtitle2",sx:{color:I.palette.primary.main,mb:1,fontWeight:600,textTransform:"uppercase",letterSpacing:"0.5px",fontSize:"0.7rem"},children:"Schema Detection"}),(0,W.jsx)(ne.A,{sx:{mb:1}}),(0,W.jsx)(i.A,{sx:{display:"flex",flexDirection:"column",gap:1,py:.5,px:.5,borderRadius:1},children:(0,W.jsxs)(i.A,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[(0,W.jsx)(c.A,{variant:"caption",sx:{color:"text.primary",fontSize:"0.75rem"},children:"Auto Schema Detection"}),(0,W.jsx)(me.A,{checked:y,onChange:e=>b(e.target.checked),size:"small"})]})})]})]})}],{id:"shortcuts",icon:(0,W.jsx)(ri.A,{}),tooltip:"Keyboard Shortcuts",content:(0,W.jsx)(i.A,{sx:{maxHeight:C?"calc(100vh - 48px - "+S+"px - 20px)":"calc(100vh - 48px - 20px)",overflowY:"auto",p:1},children:Object.entries(pe).map(e=>{let[t,n]=e;return 0===n.length?null:(0,W.jsxs)(i.A,{sx:{mb:2},children:[(0,W.jsx)(c.A,{variant:"subtitle2",sx:{color:I.palette.primary.main,mb:1,fontWeight:600,textTransform:"uppercase",letterSpacing:"0.5px",fontSize:"0.7rem"},children:t}),(0,W.jsx)(ne.A,{sx:{mb:1}}),n.map((e,t)=>(0,W.jsxs)(i.A,{sx:{display:"flex",flexDirection:"column",gap:.5,mb:1,py:.5,px:.5,borderRadius:1,"&:hover":{backgroundColor:"action.hover"}},children:[(0,W.jsx)(c.A,{variant:"caption",sx:{color:"text.primary",fontSize:"0.65rem",lineHeight:1.2},children:e.description}),(0,W.jsx)(i.A,{sx:{display:"flex",gap:.25,flexWrap:"wrap"},children:e.keys.map((e,t)=>(0,W.jsx)(c.A,{variant:"caption",component:"span",sx:{fontFamily:"monospace",backgroundColor:(0,ti.X4)(I.palette.primary.main,.1),color:I.palette.primary.main,px:.4,py:.2,borderRadius:.5,fontWeight:500,border:"1px solid "+(0,ti.X4)(I.palette.primary.main,.2),fontSize:"0.6rem",minWidth:"1rem",textAlign:"center",display:"inline-block"},children:"Control"===e?"Ctrl":" "===e?"Space":e},e+"-"+t))})]},e.action+"-"+t))]},t)})})}],fe=xe.filter(e=>"help"!==e.id),be=xe.find(e=>"help"===e.id),ve=e=>{"configuration"!==e?"help"!==e?D(T===e?null:e):_&&_():w&&w(!0)};return(0,W.jsxs)(i.A,{"data-tour":"left-sidebar",sx:{position:"absolute",top:"48px",left:0,height:C?"calc(100% - 48px - "+S+"px)":"calc(100% - 48px)",zIndex:20,display:"flex",flexDirection:"row"},onMouseLeave:()=>D(null),children:[(0,W.jsxs)(_e.A,{elevation:0,sx:{width:48,height:"100%",bgcolor:"background.paper",borderRadius:0,borderRight:"1px solid",borderColor:"divider",boxShadow:"2px 0 4px rgba(0,0,0,0.1)",display:"flex",flexDirection:"column",alignItems:"center",py:1},children:[fe.map(e=>(0,W.jsxs)(s.Fragment,{children:[(0,W.jsx)(M.A,{title:"help"!==e.id||ie?e.tooltip:"\u{1f3af} Click to start your personalized tutorial!",placement:"right",arrow:"help"===e.id&&!ie,children:(0,W.jsx)(ni.A,{badgeContent:"help"!==e.id||ie?null:"!",color:"primary",variant:"dot",invisible:"help"!==e.id||ie,sx:{"& .MuiBadge-dot":{animation:"pulse 2s infinite","@keyframes pulse":{"0%":{transform:"scale(1)"},"50%":{transform:"scale(1.2)"},"100%":{transform:"scale(1)"}}}},children:(0,W.jsx)(d.A,{"data-tour":e.dataTour,onMouseEnter:()=>{"configuration"!==e.id&&"help"!==e.id&&D(e.id)},onClick:()=>ve(e.id),sx:{width:40,height:40,mb:1,color:"help"===e.id?ie?I.palette.info.main:I.palette.primary.main:"text.secondary",animation:"help"!==e.id||ie?"none":"pulse 2s infinite","@keyframes pulse":{"0%":{boxShadow:"0 0 0 0 rgba(25, 118, 210, 0.4)"},"70%":{boxShadow:"0 0 0 8px rgba(25, 118, 210, 0)"},"100%":{boxShadow:"0 0 0 0 rgba(25, 118, 210, 0)"}},backgroundColor:T===e.id?"action.selected":"transparent",borderLeft:T===e.id?"2px solid "+I.palette.primary.main:"2px solid transparent",borderRadius:0,transition:"all 0.2s ease-in-out","&:hover":{backgroundColor:"action.hover",color:"help"===e.id?I.palette.info.dark:"text.primary",transform:"help"===e.id?"scale(1.1)":"none"}},children:e.icon})})}),"runtime-features"===e.id&&(0,W.jsxs)(W.Fragment,{children:[(0,W.jsx)(i.A,{sx:{width:"80%",height:"1px",backgroundColor:"divider",mb:1,alignSelf:"center"}}),(0,W.jsx)(M.A,{title:"Clear Canvas",placement:"right",children:(0,W.jsx)(d.A,{onClick:n,sx:{width:40,height:40,mb:1,color:"text.secondary",borderRadius:0,transition:"all 0.2s ease-in-out","&:hover":{backgroundColor:"action.hover",color:"text.primary"}},children:(0,W.jsx)(li.A,{fontSize:"small"})})}),(0,W.jsx)(M.A,{title:"Fit View",placement:"right",children:(0,W.jsx)(d.A,{onClick:l,sx:{width:40,height:40,mb:1,color:"text.secondary",borderRadius:0,transition:"all 0.2s ease-in-out","&:hover":{backgroundColor:"action.hover",color:"text.primary"}},children:(0,W.jsx)(ci.A,{fontSize:"small"})})}),(0,W.jsx)(M.A,{title:"Current: "+("horizontal"===V?"Horizontal":"Vertical")+" Layout (Click to toggle)",placement:"right",children:(0,W.jsx)(d.A,{onClick:H,sx:{width:40,height:40,mb:1,color:"text.secondary",borderRadius:0,transition:"all 0.2s ease-in-out","&:hover":{backgroundColor:"action.hover",color:"text.primary"}},children:(0,W.jsx)(di.A,{fontSize:"small"})})}),(0,W.jsx)(M.A,{title:"Zoom In",placement:"right",children:(0,W.jsx)(d.A,{onClick:o,sx:{width:40,height:40,mb:1,color:"text.secondary",borderRadius:0,transition:"all 0.2s ease-in-out","&:hover":{backgroundColor:"action.hover",color:"text.primary"}},children:(0,W.jsx)(ui.A,{fontSize:"small"})})}),(0,W.jsx)(M.A,{title:"Zoom Out",placement:"right",children:(0,W.jsx)(d.A,{onClick:r,sx:{width:40,height:40,mb:1,color:"text.secondary",borderRadius:0,transition:"all 0.2s ease-in-out","&:hover":{backgroundColor:"action.hover",color:"text.primary"}},children:(0,W.jsx)(hi.A,{fontSize:"small"})})}),(0,W.jsx)(M.A,{title:"Generate Connections",placement:"right",children:(0,W.jsx)(d.A,{onClick:a,disabled:h,sx:{width:40,height:40,mb:1,color:"text.secondary",borderRadius:0,transition:"all 0.2s ease-in-out","&:hover":{backgroundColor:"action.hover",color:"text.primary"}},children:(0,W.jsx)(In.A,{fontSize:"small"})})})]})]},e.id)),(0,W.jsx)(i.A,{sx:{flexGrow:1}}),be&&(0,W.jsx)(W.Fragment,{children:(0,W.jsx)(M.A,{title:ie?be.tooltip:"\u{1f3af} Click to start your personalized tutorial!",placement:"right",arrow:!ie,children:(0,W.jsx)(ni.A,{badgeContent:ie?null:"!",color:"primary",variant:"dot",invisible:ie,sx:{"& .MuiBadge-dot":{animation:"pulse 2s infinite","@keyframes pulse":{"0%":{transform:"scale(1)"},"50%":{transform:"scale(1.2)"},"100%":{transform:"scale(1)"}}}},children:(0,W.jsx)(d.A,{"data-tour":be.dataTour,onMouseEnter:()=>{},onClick:()=>ve(be.id),sx:{width:40,height:40,mb:1,color:ie?I.palette.info.main:I.palette.primary.main,animation:ie?"none":"pulse 2s infinite","@keyframes pulse":{"0%":{boxShadow:"0 0 0 0 rgba(25, 118, 210, 0.4)"},"70%":{boxShadow:"0 0 0 8px rgba(25, 118, 210, 0)"},"100%":{boxShadow:"0 0 0 0 rgba(25, 118, 210, 0)"}},backgroundColor:T===be.id?"action.selected":"transparent",borderLeft:T===be.id?"2px solid "+I.palette.primary.main:"2px solid transparent",borderRadius:0,transition:"all 0.2s ease-in-out","&:hover":{backgroundColor:"action.hover",color:I.palette.info.dark,transform:"scale(1.1)"}},children:be.icon})})})})]}),T&&(0,W.jsx)(_e.A,{elevation:0,sx:{width:280,height:"100%",bgcolor:"background.paper",borderRadius:0,borderRight:"1px solid",borderColor:"divider",overflow:"hidden",transition:"all 0.2s ease-in-out"},children:null==(t=xe.find(e=>e.id===T))?void 0:t.content})]})};function xi(e){const{nodes:t,crewFlowInstanceRef:n,flowFlowInstanceRef:a}=e,i=s.useCallback(()=>{if(!n.current||0===t.length)return;const e=new An,a=E.z.getState().getUILayoutState();a.screenWidth=window.innerWidth,a.screenHeight=window.innerHeight,e.updateUIState(a);const s=e.getAvailableCanvasArea("crew");let i=1/0,o=1/0,r=-1/0,l=-1/0;if(t.forEach(e=>{if(e.position){const t=e.width||200,n=e.height||150;i=Math.min(i,e.position.x),o=Math.min(o,e.position.y),r=Math.max(r,e.position.x+t),l=Math.max(l,e.position.y+n)}}),i===1/0||o===1/0)return;const c=r-i,d=l-o,u=(s.width-100)/c,h=(s.height-100)/d,m=Math.min(u,h,1.5),g=a.chatPanelVisible&&!a.chatPanelCollapsed?"right"===a.chatPanelSide?.15*a.chatPanelWidth:.55*-a.chatPanelWidth:0,p=a.executionHistoryVisible?.2*a.executionHistoryHeight:0,x=s.x+s.width/2+g,f=s.y+s.height/2-p,y=x-(i+c/2)*m,b=f-(o+d/2)*m;n.current.setViewport({x:y,y:b,zoom:m},{duration:800})},[t,n]),o=s.useCallback(()=>{if(i(),a.current)try{setTimeout(()=>{var e;null==(e=a.current)||e.fitView({padding:.2,includeHiddenNodes:!1,duration:800})},100)}catch(e){}},[i,a]);return{handleUIAwareFitView:i,handleFitViewToNodesInternal:o}}function fi(e){const{nodes:t,edges:n,setNodes:a,setEdges:i,crewFlowInstanceRef:o,flowFlowInstanceRef:r,handleUIAwareFitView:l,handleFitViewToNodesInternal:c}=e,d=s.useCallback(e=>{const{layoutBounds:t}=e.detail||{};if(t&&o.current)try{const e=new An,n=E.z.getState().getUILayoutState();e.updateUIState(n);const a=e.getAvailableCanvasArea("crew"),s=20,i=(a.width-2*s)/t.width,r=(a.height-2*s)/t.height,l=Math.min(i,r,2),c=a.x+(a.width-t.width*l)/2-t.x*l,d=a.y+(a.height-t.height*l)/2-t.y*l;o.current.setViewport({x:c,y:d,zoom:l}),setTimeout(()=>{var e;null==(e=o.current)||e.fitView({padding:.1,includeHiddenNodes:!1,duration:1e3,maxZoom:l})},100)}catch(n){c()}},[o,c]),u=s.useCallback(e=>{var s;if(0===t.length)return;const o=null==e||null==(s=e.detail)?void 0:s.reason;if("chat-panel-resize"!==o&&"execution-history-resize"!==o&&"layout-orientation-toggle"!==o)return;if("chat-panel-resize"===o||"execution-history-resize"===o)return void setTimeout(()=>{l()},100);const r=new An({margin:20,minNodeSpacing:50}),c=E.z.getState().getUILayoutState();c.screenWidth=window.innerWidth,c.screenHeight=window.innerHeight,r.updateUIState(c);const d=r.reorganizeNodes(t,"crew",n);if(a(d),"layout-orientation-toggle"===o){const e=E.z.getState().layoutOrientation;i(t=>t.map(t=>{const n=d.find(e=>e.id===t.source),a=d.find(e=>e.id===t.target);if("agentNode"===(null==n?void 0:n.type)&&"taskNode"===(null==a?void 0:a.type)){const n="vertical"===e?"bottom":"right",a="vertical"===e?"top":"left";return Object.assign({},t,{sourceHandle:n,targetHandle:a})}return"taskNode"===(null==n?void 0:n.type)&&"taskNode"===(null==a?void 0:a.type)?Object.assign({},t,{sourceHandle:"right",targetHandle:"left"}):t}))}setTimeout(()=>{l()},100)},[t,a,i,l]);return s.useEffect(()=>{const e=()=>c(),t=e=>d(e),n=e=>u(e);return window.addEventListener("fitViewToNodesInternal",e),window.addEventListener("autoFitCrewNodes",t),window.addEventListener("recalculateNodePositions",n),()=>{window.removeEventListener("fitViewToNodesInternal",e),window.removeEventListener("autoFitCrewNodes",t),window.removeEventListener("recalculateNodePositions",n)}},[c,d,u]),s.useEffect(()=>{let e=!1;const n=()=>{!e&&o.current&&t.length>0&&(e=!0,l())},a=()=>{setTimeout(n,200)};if(window.addEventListener("crewFlowInitialized",a),t.length>0&&o.current){const e=setTimeout(n,500);return()=>{clearTimeout(e),window.removeEventListener("crewFlowInitialized",a)}}return()=>{window.removeEventListener("crewFlowInitialized",a)}},[t.length,l,o]),{handleAutoFitCrewNodes:d,handleRecalculateNodePositions:u}}const yi=e=>{let{open:t,onClose:n,onAgentSelect:a,agents:u,onShowAgentForm:h,fetchAgents:m,showErrorMessage:p,openInCreateMode:x=!1}=e;const[f,y]=(0,s.useState)(!1),[b,v]=(0,s.useState)(x),[A,j]=(0,s.useState)([]),[w,k]=(0,s.useState)([]),[C,S]=(0,s.useState)(!1),[_,E]=(0,s.useState)(!1),I=(0,s.useCallback)(async()=>{try{const e=await xt.m.listEnabledTools();k(e.map(e=>Object.assign({},e,{id:String(e.id)})))}catch(e){}},[]);(0,s.useEffect)(()=>{t&&!_&&(Promise.all([m(),I()]),E(!0),x&&v(!0))},[t,_,m,I,x]),(0,s.useEffect)(()=>{t||(E(!1),j([]),v(!1))},[t]);const T=async e=>{v(!1),await m(),x&&e&&(a([e]),n())};return x?(0,W.jsxs)(W.Fragment,{children:[(0,W.jsxs)(o.A,{open:t,onClose:n,maxWidth:"md",fullWidth:!0,children:[(0,W.jsxs)(l.A,{children:[(0,W.jsxs)(i.A,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",pr:5},children:[(0,W.jsx)(c.A,{variant:"h6",children:"Create Agent"}),(0,W.jsx)(g.A,{startIcon:(0,W.jsx)(pe.A,{}),onClick:()=>S(!0),variant:"outlined",size:"small",sx:{ml:2},children:"Best Practices"})]}),(0,W.jsx)(d.A,{"aria-label":"close",onClick:n,sx:{position:"absolute",right:8,top:8},children:(0,W.jsx)(N.A,{})})]}),(0,W.jsx)(r.A,{children:(0,W.jsx)(pt,{tools:w,onCancel:n,onAgentSaved:T,isCreateMode:!0})})]}),(0,W.jsx)(mt,{open:C,onClose:()=>S(!1)})]}):(0,W.jsxs)(W.Fragment,{children:[(0,W.jsxs)(o.A,{open:t,onClose:n,maxWidth:"sm",fullWidth:!0,children:[(0,W.jsxs)(l.A,{children:[(0,W.jsx)(i.A,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",pr:5},children:(0,W.jsxs)(i.A,{sx:{display:"flex",alignItems:"center",gap:1},children:["Manage Agents",(0,W.jsx)(M.A,{title:"Learn about agent best practices",children:(0,W.jsx)(d.A,{size:"small",onClick:()=>window.open("https://docs.crewai.com/core-concepts/Agents/","_blank"),sx:{ml:1},children:(0,W.jsx)(pe.A,{fontSize:"small"})})})]})}),(0,W.jsx)(d.A,{"aria-label":"close",onClick:n,sx:{position:"absolute",right:8,top:8},children:(0,W.jsx)(N.A,{})})]}),(0,W.jsxs)(r.A,{sx:{pb:1},children:[(0,W.jsxs)(i.A,{sx:{mb:2,display:"flex",gap:1},children:[(0,W.jsx)(g.A,{variant:"contained",startIcon:(0,W.jsx)($t.A,{}),onClick:()=>{v(!0)},children:"Create Agent"}),(0,W.jsx)(g.A,{variant:"outlined",onClick:()=>{A.length===u.length?j([]):j([...u])},children:A.length===u.length?"Deselect All":"Select All"}),(0,W.jsx)(g.A,{variant:"outlined",color:"error",startIcon:(0,W.jsx)(Q.A,{}),onClick:async()=>{try{await fe.AgentService.deleteAllAgents(),j([]),await m()}catch(n){if(n&&"object"===typeof n&&"response"in n){var e;const a=n;if(409===(null==(e=a.response)?void 0:e.status))p(a.response.data.detail||"Cannot delete agents due to dependencies.","warning");else{var t;const e=(null==(t=a.response)||null==(t=t.data)?void 0:t.detail)||"An unknown error occurred";p("Error deleting agents: "+e,"error")}}else p("An unknown error occurred while deleting agents.","error")}},children:"Delete All"})]}),(0,W.jsx)(ne.A,{sx:{my:2}}),(0,W.jsx)(at.A,{sx:{maxHeight:"50vh",overflow:"auto"},children:u.map(e=>(0,W.jsxs)(aa.A,{onClick:()=>(e=>{j(t=>t.some(t=>t.id===e.id)?t.filter(t=>t.id!==e.id):[...t,e])})(e),selected:A.some(t=>t.id===e.id),children:[(0,W.jsx)(it.A,{children:(0,W.jsx)(X.A,{})}),(0,W.jsx)(ot.A,{primary:e.name,secondary:e.role}),(0,W.jsx)(M.A,{title:"Delete Agent",children:(0,W.jsx)(d.A,{onClick:t=>{t.stopPropagation(),(async e=>{if(e.id)try{y(!0),await fe.AgentService.deleteAgent(e.id)&&await m()}catch(t){}finally{y(!1)}})(e)},size:"small",color:"error",disabled:f,children:(0,W.jsx)(Q.A,{fontSize:"small"})})})]},e.id))})]}),(0,W.jsx)(H.A,{sx:{px:3,py:2},children:(0,W.jsxs)(g.A,{variant:"contained",onClick:()=>{a(A),j([]),n()},disabled:0===A.length,children:["Place Selected (",A.length,")"]})})]}),b&&(0,W.jsx)(o.A,{open:b,onClose:()=>v(!1),maxWidth:"md",fullWidth:!0,children:(0,W.jsx)(r.A,{children:(0,W.jsx)(pt,{tools:w,onCancel:()=>v(!1),onAgentSaved:T})})})]})},bi=e=>{let{open:t,onClose:n,onTaskSelect:a,tasks:u,onShowTaskForm:h,fetchTasks:m,openInCreateMode:p=!1}=e;const[x,f]=(0,s.useState)(void 0),[y,b]=(0,s.useState)(p),[v,A]=(0,s.useState)([]),[j,w]=(0,s.useState)([]),[k,C]=(0,s.useState)(!1),[S,_]=(0,s.useState)(!1);(0,s.useEffect)(()=>{let e=!0;return(async()=>{try{if(t){const[t,n]=await Promise.all([m(),xt.m.listEnabledTools()]);e&&(w(n),p&&b(!0))}}catch(n){}})(),()=>{e=!1,t||b(!1)}},[t,m,p]);return p?(0,W.jsxs)(W.Fragment,{children:[(0,W.jsxs)(o.A,{open:t,onClose:n,maxWidth:"md",fullWidth:!0,children:[(0,W.jsxs)(l.A,{children:[(0,W.jsxs)(i.A,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",pr:5},children:[(0,W.jsx)(c.A,{variant:"h6",children:"Create Task"}),(0,W.jsx)(g.A,{startIcon:(0,W.jsx)(pe.A,{}),onClick:()=>_(!0),variant:"outlined",size:"small",sx:{ml:2},children:"Best Practices"})]}),(0,W.jsx)(d.A,{"aria-label":"close",onClick:n,sx:{position:"absolute",right:8,top:8},children:(0,W.jsx)(N.A,{})})]}),(0,W.jsx)(r.A,{children:(0,W.jsx)(Mt,{tools:j,onCancel:n,isCreateMode:!0,hideTitle:!0,onTaskSaved:async e=>{await m(),e&&(a([e]),n())}})})]}),(0,W.jsx)(Pt,{open:S,onClose:()=>_(!1)})]}):(0,W.jsxs)(W.Fragment,{children:[(0,W.jsxs)(o.A,{open:t,onClose:n,maxWidth:"md",fullWidth:!0,children:[(0,W.jsxs)(l.A,{children:["Manage Tasks",(0,W.jsx)(d.A,{"aria-label":"close",onClick:n,sx:{position:"absolute",right:8,top:8},children:(0,W.jsx)(N.A,{})})]}),(0,W.jsxs)(r.A,{children:[(0,W.jsxs)(i.A,{sx:{mb:2,display:"flex",gap:1},children:[(0,W.jsx)(g.A,{variant:"contained",startIcon:(0,W.jsx)($t.A,{}),onClick:()=>{f(void 0),A([]),b(!0)},children:"Create Task"}),(0,W.jsx)(g.A,{variant:"outlined",onClick:()=>{v.length===u.length?A([]):A([...u])},children:v.length===u.length?"Deselect All":"Select All"}),(0,W.jsx)(g.A,{variant:"outlined",color:"error",startIcon:(0,W.jsx)(Q.A,{}),onClick:async()=>{try{await Fe.TaskService.deleteAllTasks(),A([]),await m()}catch(e){}},children:"Delete All"})]}),(0,W.jsx)(ne.A,{sx:{my:2}}),(0,W.jsx)(at.A,{sx:{maxHeight:"50vh",overflow:"auto"},children:[...u].reverse().map(e=>(0,W.jsxs)(aa.A,{onClick:()=>(e=>{const t=v.some(t=>t.id===e.id)?v.filter(t=>t.id!==e.id):[...v,e];A(t)})(e),selected:v.some(t=>t.id===e.id),children:[(0,W.jsx)(it.A,{children:(0,W.jsx)(na.A,{})}),(0,W.jsx)(ot.A,{primary:e.name||e.description,secondary:e.description}),(0,W.jsx)(M.A,{title:"Delete Task",children:(0,W.jsx)(d.A,{onClick:t=>{t.stopPropagation(),(async e=>{if(e.id)try{C(!0),await Fe.TaskService.deleteTask(e.id),await m()}catch(t){}finally{C(!1)}})(e)},size:"small",color:"error",disabled:k,children:(0,W.jsx)(Q.A,{fontSize:"small"})})})]},e.id))})]}),(0,W.jsx)(H.A,{sx:{px:3,py:2},children:(0,W.jsxs)(g.A,{variant:"contained",onClick:()=>{const e=v.map(e=>Object.assign({},e,{id:e.id,name:e.name,description:e.description,expected_output:e.expected_output,tools:e.tools,agent_id:e.agent_id,async_execution:e.async_execution,context:e.context,config:e.config}));a(e),n()},disabled:0===v.length,children:["Place Selected (",v.length,")"]})})]}),y&&(0,W.jsxs)(o.A,{open:y,onClose:()=>{b(!1),f(void 0)},maxWidth:"md",fullWidth:!0,PaperProps:{sx:{position:"relative"}},children:[(0,W.jsxs)(l.A,{children:[x?"Edit Task":"Create New Task",(0,W.jsx)(d.A,{"aria-label":"close",onClick:()=>{b(!1),f(void 0)},sx:{position:"absolute",right:8,top:8},children:(0,W.jsx)(N.A,{})})]}),(0,W.jsx)(r.A,{children:(0,W.jsx)(Mt,{initialData:x,onCancel:()=>{b(!1),f(void 0)},onTaskSaved:async e=>{await m(),v.some(t=>t.id===e.id)?A(t=>t.map(t=>t.id===e.id?e:t)):A(t=>[...t,e]),b(!1),f(void 0)},tools:j,hideTitle:!0},x?"edit":"create")})]})]})};var vi=n(96557),Ai=n(40038),ji=n(39919),wi=n(36060);const ki=e=>{let{open:t,onClose:n,schedule:a}=e;return a?(0,W.jsxs)(o.A,{open:t,onClose:n,maxWidth:"md",fullWidth:!0,children:[(0,W.jsxs)(l.A,{children:["Configuration for ",a.name]}),(0,W.jsx)(r.A,{children:(0,W.jsxs)(i.A,{sx:{mt:2},children:[(0,W.jsx)(c.A,{variant:"subtitle1",gutterBottom:!0,children:"Agents YAML"}),(0,W.jsx)(i.A,{sx:{whiteSpace:"pre-wrap",fontFamily:"monospace",bgcolor:"grey.100",p:2,borderRadius:1,maxHeight:"300px",overflow:"auto",mb:3},children:JSON.stringify(a.agents_yaml,null,2)}),(0,W.jsx)(c.A,{variant:"subtitle1",gutterBottom:!0,children:"Tasks YAML"}),(0,W.jsx)(i.A,{sx:{whiteSpace:"pre-wrap",fontFamily:"monospace",bgcolor:"grey.100",p:2,borderRadius:1,maxHeight:"300px",overflow:"auto",mb:3},children:JSON.stringify(a.tasks_yaml,null,2)}),a.inputs&&Object.keys(a.inputs).length>0&&(0,W.jsxs)(W.Fragment,{children:[(0,W.jsx)(c.A,{variant:"subtitle1",gutterBottom:!0,children:"Inputs"}),(0,W.jsx)(i.A,{sx:{whiteSpace:"pre-wrap",fontFamily:"monospace",bgcolor:"grey.100",p:2,borderRadius:1,maxHeight:"300px",overflow:"auto"},children:JSON.stringify(a.inputs,null,2)})]})]})}),(0,W.jsx)(H.A,{children:(0,W.jsx)(g.A,{onClick:n,children:"Close"})})]}):null},Ci=e=>{let{open:t,onClose:n,nodes:a,edges:m,planningEnabled:p,selectedModel:x}=e;const[f,y]=(0,s.useState)([]),[b,v]=(0,s.useState)(""),[A,j]=(0,s.useState)(""),[w,k]=(0,s.useState)(!1),[C,S]=(0,s.useState)("visual"),[_,E]=(0,s.useState)("create"),[I,T]=(0,s.useState)(null),[D,O]=(0,s.useState)("list"),[P,z]=(0,s.useState)("daily"),[L,R]=(0,s.useState)({hour:"0",minute:"0"}),[F,B]=(0,s.useState)([]),[K,G]=(0,s.useState)([]),[q,J]=(0,s.useState)([]),[Y,X]=(0,s.useState)(null),[$,ee]=(0,s.useState)(!1),[te,ne]=(0,s.useState)({}),[ae,se]=(0,s.useState)(null),ie=(0,s.useCallback)(()=>{v(""),j(""),z("daily"),R({hour:"0",minute:"0"}),B([]),G([]),J([]),S("visual"),E("create"),T(null),ne({}),O("list")},[]),oe=(0,s.useCallback)(async()=>{try{const e=await wi.l.listSchedules();y(e)}catch(ae){Za.oR.error("Failed to load schedules")}},[]);(0,s.useEffect)(()=>{t&&(oe(),I||ie())},[t,I,oe,ie]);const ge=e=>{E("edit"),T(e.id),v(e.name),j(e.cron_expression),ne(e.inputs||{}),(e=>{const t=e.split(" "),[n,a,s,i,o]=t;R({minute:"*"===n?"0":n,hour:"*"===a?"0":a}),"*"===a?z("hourly"):"*"===s&&"*"===i&&"*"===o?z("daily"):"*"===s&&"*"===i&&"*"!==o?(z("weekly"),B(o.split(","))):"*"!==s&&"*"===i?(z("monthly"),J(s.split(","))):"*"!==i&&(z("yearly"),G(i.split(",")))})(e.cron_expression),O("edit")},pe=(0,s.useCallback)(()=>{const{hour:e,minute:t}=L;let n="";const a=F.length>0?F.join(","):"*",s=q.length>0?q.join(","):"*",i=K.length>0?K.join(","):"*";switch(P){case"hourly":n=t+" * * * *";break;case"daily":n=t+" "+e+" * * *";break;case"weekly":n=t+" "+e+" * * "+a;break;case"monthly":n=t+" "+e+" "+s+" * *";break;case"yearly":n=t+" "+e+" * "+i+" *";break;default:n="0 0 * * *"}j(n)},[P,L,F,K,q]);(0,s.useEffect)(()=>{"visual"===C&&pe()},[C,pe]);const xe=()=>{se(null)};return(0,W.jsxs)(W.Fragment,{children:[(0,W.jsxs)(o.A,{open:t,onClose:n,maxWidth:"md",fullWidth:!0,children:[(0,W.jsxs)(l.A,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",pb:1.5,borderBottom:"1px solid",borderColor:"divider"},children:[(0,W.jsx)(c.A,{variant:"h6",children:"Schedules"}),(0,W.jsx)(d.A,{onClick:n,size:"small",sx:{color:"text.secondary","&:hover":{color:"text.primary"}},children:(0,W.jsx)(N.A,{})})]}),(0,W.jsx)(r.A,{children:"list"===D?(0,W.jsxs)(i.A,{children:[(0,W.jsx)(i.A,{sx:{mb:3,mt:2},children:(0,W.jsxs)(c.A,{variant:"subtitle1",sx:{fontWeight:600},children:["Active Schedules (",f.length,")"]})}),0===f.length?(0,W.jsxs)(i.A,{sx:{textAlign:"center",py:8,px:2,backgroundColor:"background.default",borderRadius:2,border:"1px dashed",borderColor:"divider"},children:[(0,W.jsx)(c.A,{variant:"h6",color:"text.secondary",gutterBottom:!0,children:"No schedules found"}),(0,W.jsx)(c.A,{variant:"body2",color:"text.secondary",children:"Schedule jobs from the Execution History table"})]}):(0,W.jsx)(at.A,{sx:{p:0},children:f.map(e=>(0,W.jsxs)(st.Ay,{sx:{mb:1.5,p:2,borderRadius:2,border:"1px solid",borderColor:"divider",backgroundColor:"background.paper","&:hover":{backgroundColor:"action.hover",borderColor:"primary.light"},transition:"all 0.2s ease"},children:[(0,W.jsx)(ot.A,{primary:(0,W.jsxs)(i.A,{sx:{display:"flex",alignItems:"center",gap:1},children:[(0,W.jsx)(c.A,{variant:"h6",sx:{fontWeight:500,fontSize:"1.1rem"},children:e.name}),(0,W.jsx)(V.A,{label:e.is_active?"Active":"Inactive",size:"small",color:e.is_active?"success":"default",sx:{height:22}})]}),secondary:(0,W.jsxs)(i.A,{sx:{mt:.5},children:[(0,W.jsx)(c.A,{component:"span",variant:"body2",color:"text.secondary",sx:{fontFamily:"monospace"},children:e.cron_expression}),e.next_run_at&&(0,W.jsxs)(c.A,{component:"span",variant:"body2",color:"text.secondary",sx:{ml:2},children:["\u2022 Next run: ",new Date(e.next_run_at+"Z").toLocaleString()]})]})}),(0,W.jsx)(Hs.A,{children:(0,W.jsxs)(i.A,{sx:{display:"flex",alignItems:"center",gap:.5},children:[(0,W.jsx)(M.A,{title:"View Configuration",children:(0,W.jsx)(d.A,{size:"small",onClick:()=>(e=>{X(e),ee(!0)})(e),children:(0,W.jsx)(ze.A,{fontSize:"small"})})}),(0,W.jsx)(M.A,{title:"Toggle Schedule",children:(0,W.jsx)(me.A,{size:"small",checked:e.is_active,onChange:()=>(async e=>{try{await wi.l.toggleSchedule(e),oe()}catch(ae){Za.oR.error("Failed to toggle schedule")}})(e.id),sx:{"& .MuiSwitch-switchBase":{padding:"6px"},"& .MuiSwitch-thumb":{width:18,height:18}}})}),(0,W.jsx)(M.A,{title:"Edit Schedule",children:(0,W.jsx)(d.A,{size:"small",onClick:()=>ge(e),color:"primary",children:(0,W.jsx)(Z.A,{fontSize:"small"})})}),(0,W.jsx)(M.A,{title:"Delete Schedule",children:(0,W.jsx)(d.A,{size:"small",onClick:()=>(async e=>{try{await wi.l.deleteSchedule(e),Za.oR.success("Schedule deleted successfully"),oe()}catch(ae){Za.oR.error("Failed to delete schedule")}})(e.id),color:"error",children:(0,W.jsx)(Q.A,{fontSize:"small"})})})]})})]},e.id))})]}):(0,W.jsxs)(i.A,{children:[(0,W.jsxs)(i.A,{sx:{display:"flex",alignItems:"center",mb:3,mt:2},children:[(0,W.jsx)(d.A,{onClick:ie,size:"small",sx:{mr:1},children:(0,W.jsx)(N.A,{})}),(0,W.jsx)(c.A,{variant:"h6",children:"Edit Schedule"})]}),(0,W.jsx)(i.A,{sx:{mt:2,mb:2,p:2,bgcolor:"info.light",borderRadius:1},children:(0,W.jsx)(c.A,{variant:"body2",color:"info.dark",children:"Note: Only the schedule name and timing can be edited. To modify the workflow configuration, create a new schedule from the Execution History."})}),(0,W.jsx)(U.A,{fullWidth:!0,label:"Schedule Name",value:b,onChange:e=>v(e.target.value),margin:"normal",autoFocus:!0}),(0,W.jsxs)(i.A,{sx:{mb:2,mt:2},children:[(0,W.jsxs)(Ai.A,{value:C,exclusive:!0,onChange:(e,t)=>t&&S(t),sx:{mb:2},children:[(0,W.jsx)(ji.A,{value:"visual",children:"Simple Schedule"}),(0,W.jsx)(ji.A,{value:"manual",children:"Advanced (Cron)"})]}),"manual"===C?(0,W.jsx)(U.A,{fullWidth:!0,label:"Cron Expression",value:A,onChange:e=>j(e.target.value),helperText:"Example: '0 0 * * *' for daily at midnight"}):(()=>{const e=Array.from({length:24},(e,t)=>t.toString()),t=Array.from({length:60},(e,t)=>t.toString()),n=Array.from({length:31},(e,t)=>(t+1).toString());return(0,W.jsxs)(i.A,{sx:{mt:2},children:[(0,W.jsxs)(re.A,{fullWidth:!0,sx:{mb:2},children:[(0,W.jsx)(le.A,{children:"Frequency"}),(0,W.jsxs)(ce.A,{value:P,onChange:e=>z(e.target.value),label:"Frequency",children:[(0,W.jsx)(de.A,{value:"hourly",children:"Hourly"}),(0,W.jsx)(de.A,{value:"daily",children:"Daily"}),(0,W.jsx)(de.A,{value:"weekly",children:"Weekly"}),(0,W.jsx)(de.A,{value:"monthly",children:"Monthly"}),(0,W.jsx)(de.A,{value:"yearly",children:"Yearly"})]})]}),(0,W.jsxs)(ue.Ay,{container:!0,spacing:2,sx:{mb:2},children:[(0,W.jsx)(ue.Ay,{item:!0,xs:6,children:(0,W.jsxs)(re.A,{fullWidth:!0,children:[(0,W.jsx)(le.A,{children:"Hour"}),(0,W.jsx)(ce.A,{value:L.hour,onChange:e=>R(t=>Object.assign({},t,{hour:e.target.value})),label:"Hour",disabled:"hourly"===P,children:e.map(e=>(0,W.jsx)(de.A,{value:e,children:e.padStart(2,"0")},e))})]})}),(0,W.jsx)(ue.Ay,{item:!0,xs:6,children:(0,W.jsxs)(re.A,{fullWidth:!0,children:[(0,W.jsx)(le.A,{children:"Minute"}),(0,W.jsx)(ce.A,{value:L.minute,onChange:e=>R(t=>Object.assign({},t,{minute:e.target.value})),label:"Minute",children:t.map(e=>(0,W.jsx)(de.A,{value:e,children:e.padStart(2,"0")},e))})]})})]}),"weekly"===P&&(0,W.jsxs)(re.A,{component:"fieldset",fullWidth:!0,sx:{mb:2},children:[(0,W.jsx)(c.A,{variant:"subtitle2",gutterBottom:!0,children:"Select Days"}),(0,W.jsx)(vi.A,{row:!0,children:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"].map((e,t)=>(0,W.jsx)(he.A,{control:(0,W.jsx)(Kt.A,{checked:F.includes(t.toString()),onChange:e=>{e.target.checked?B([...F,t.toString()]):B(F.filter(e=>e!==t.toString()))}}),label:e},e))})]}),"monthly"===P&&(0,W.jsxs)(re.A,{component:"fieldset",fullWidth:!0,sx:{mb:2},children:[(0,W.jsx)(c.A,{variant:"subtitle2",gutterBottom:!0,children:"Select Days of Month"}),(0,W.jsx)(vi.A,{row:!0,children:n.map(e=>(0,W.jsx)(he.A,{control:(0,W.jsx)(Kt.A,{checked:q.includes(e),onChange:t=>{t.target.checked?J([...q,e]):J(q.filter(t=>t!==e))}}),label:e,sx:{width:"70px"}},e))})]}),"yearly"===P&&(0,W.jsxs)(re.A,{component:"fieldset",fullWidth:!0,sx:{mb:2},children:[(0,W.jsx)(c.A,{variant:"subtitle2",gutterBottom:!0,children:"Select Months"}),(0,W.jsx)(vi.A,{row:!0,children:["January","February","March","April","May","June","July","August","September","October","November","December"].map((e,t)=>(0,W.jsx)(he.A,{control:(0,W.jsx)(Kt.A,{checked:K.includes((t+1).toString()),onChange:e=>{e.target.checked?G([...K,(t+1).toString()]):G(K.filter(e=>e!==(t+1).toString()))}}),label:e},e))})]})]})})()]}),"visual"===C&&(0,W.jsx)(i.A,{sx:{mt:2,p:2,bgcolor:"grey.50",borderRadius:1},children:(0,W.jsxs)(c.A,{variant:"body2",color:"text.secondary",children:[(0,W.jsx)("strong",{children:"Generated Cron Expression:"})," ",A]})}),(0,W.jsxs)(i.A,{sx:{mt:3,display:"flex",gap:2},children:[(0,W.jsx)(g.A,{variant:"contained",onClick:async()=>{if(b&&A)try{if(k(!0),"edit"===_&&I){const e=f.find(e=>e.id===I);if(!e)return void Za.oR.error("Schedule not found");const t={name:b,cron_expression:A,agents_yaml:e.agents_yaml,tasks_yaml:e.tasks_yaml,inputs:e.inputs,is_active:e.is_active,planning:e.planning,model:e.model};await wi.l.updateSchedule(I,t)}ie(),oe()}catch(ae){se("Failed to save schedule")}finally{k(!1)}else se("Please fill in all required fields")},disabled:w||!b||!A,children:"Update Schedule"}),(0,W.jsx)(g.A,{variant:"outlined",onClick:ie,children:"Cancel"})]})]})}),(0,W.jsx)(H.A,{children:(0,W.jsx)(g.A,{onClick:n,children:"Close"})})]}),(0,W.jsx)(ki,{open:$,onClose:()=>{ee(!1),X(null)},schedule:Y}),(0,W.jsx)(u.A,{open:!!ae,autoHideDuration:6e3,onClose:xe,anchorOrigin:{vertical:"top",horizontal:"center"},children:(0,W.jsx)(h.A,{onClose:xe,severity:"error",variant:"filled",sx:{width:"100%",whiteSpace:"pre-line"},children:ae})})]})};var Si=n(69893);const _i=e=>{let{executionHistoryHeight:t=200,onExecutionCountChange:n}=e;const a=(0,s.useRef)(null);return(0,W.jsx)(_e.A,{sx:{height:"100%",display:"flex",flexDirection:"column"},children:(0,W.jsx)(i.A,{sx:{flex:1,overflow:"hidden"},children:(0,W.jsx)(Si.default,{ref:a,executionHistoryHeight:t,onExecutionCountChange:n})})})};var Ei=n(52028),Ii=n(6163);const Ti="finished",Di="skipped",Oi=e=>({options:{primaryColor:"#1976d2",textColor:e?"#fff":"#333",backgroundColor:e?"#1e1e1e":"#fff",overlayColor:"rgba(0, 0, 0, 0.5)",spotlightShadow:"0 0 15px rgba(25, 118, 210, 0.5)",beaconSize:36,arrowColor:e?"#1e1e1e":"#fff",zIndex:1e4},tooltip:{borderRadius:8,fontSize:14},tooltipContainer:{textAlign:"left"},tooltipTitle:{fontSize:18,marginBottom:8,fontWeight:"bold"},tooltipContent:{fontSize:14,lineHeight:1.6},buttonNext:{backgroundColor:"#1976d2",borderRadius:4,color:"#fff",fontSize:14,padding:"8px 16px"},buttonBack:{color:e?"#90caf9":"#1976d2",fontSize:14,marginRight:8},buttonSkip:{color:e?"#999":"#666",fontSize:13},beacon:{animation:"pulse 2s infinite"},spotlight:{borderRadius:8}}),Ni=e=>{let{isOpen:t,onClose:n}=e;const a="dark"===(0,Ta.A)().palette.mode,{userRole:u}=(0,Nn.o)(),{setHasSeenTutorial:h}=(0,p.Y)(),[m,x]=(0,s.useState)(!1),[f,y]=(0,s.useState)(null),[b,v]=(0,s.useState)(!1),[A,j]=(0,s.useState)(!1),w=[{id:"editor",title:"Content Creator Tutorial",icon:(0,W.jsx)(Ua.A,{}),color:"#2196f3",description:"Build AI content workflows + jumpstart with Catalog",features:["Create agents & tasks","Build workflows","Browse catalog templates","Execute & save templates"]}],k=e=>{y(e),v(!1),j(!1),setTimeout(()=>{x(!0)},300)},C=(0,s.useMemo)(()=>[{target:'[data-tour="workflow-designer"]',content:"Welcome Editor! This tutorial will teach you how to create AI agents and tasks, then execute them. You have two ways to build workflows: using the chat panel (AI-assisted) or the right sidebar (manual control).",placement:"center",disableBeacon:!0},{target:'[data-tour="chat-toggle"]',content:'Chat Panel - The Easy Way: This is your AI assistant for creating workflows. Use these commands:\n\u2022 "create agent: [name]" - Creates an AI agent\n\u2022 "create task: [description]" - Creates a task\n\u2022 "create plan" - Generates a complete workflow\n\u2022 "execute crew" or "ec" - Runs your workflow',placement:"left"},{target:'[data-tour="chat-panel"]',content:"Important Rule: Every agent MUST have at least one task assigned to it, otherwise the execution will fail. Think of it as: agents are workers, tasks are their assignments. No assignments = no work!",placement:"left"},{target:'[data-tour="right-sidebar"]',content:"Right Sidebar - Manual Control: If you prefer full control, use the right sidebar to:\n\u2022 Add agents manually\n\u2022 Add tasks manually\n\u2022 Configure each component in detail\n\u2022 Set up connections precisely",placement:"left"},{target:'[data-tour="canvas-area"]',content:"Canvas Area: This is where your workflow appears. Add agents via the Chat panel (AI-assisted) or manually in the Right Sidebar. You can also import existing Plans, Agents, and Tasks from the Catalog. Drag to connect agents to tasks and double-click items to edit.",placement:"center"},{target:'[data-nodetype="agent"]',content:"Agents: These are your AI workers. Each agent needs:\n\u2022 A role (what they are)\n\u2022 A goal (what they achieve)\n\u2022 Tools (what they can use)\n\u2022 At least ONE task (critical!)",placement:"auto"},{target:'[data-nodetype="task"]',content:"Tasks: These define the work. Each task needs:\n\u2022 A clear description\n\u2022 Expected output\n\u2022 An assigned agent\nRemember: Unassigned tasks will cause execution to fail!",placement:"auto"},{target:'[data-tour="execute-button"]',content:'Execute Button: Once all agents have tasks, click here OR type "execute crew" in chat. The execution will fail if any agent lacks a task!',placement:"bottom"},{target:'[data-tour="open-workflow"]',content:"Catalog: Click here to browse and import existing Plans, Agents, and Tasks you can customize.",placement:"bottom"},{target:'[data-tour="catalog-dialog"]',content:"Catalog Browser: Search and filter, then import Plans, Agents, or Tasks. Imported items will appear on the canvas, ready to connect and run.",placement:"center"},{target:'[data-tour="canvas-area"]',content:"Imported Template: The selected template appears here. Tweak agents and tasks, then run.",placement:"center"},{target:'[data-tour="save-button"]',content:"Save Workflow: Once your workflow runs successfully, save it as a template for reuse. Give it a clear name and description.",placement:"bottom"}],[]),S=(0,s.useMemo)(()=>C,[C]);(0,s.useEffect)(()=>{t?b?j(!0):setTimeout(()=>{x(!0)},500):(j(!1),x(!1))},[t,u,S.length,b]);return t?(0,W.jsxs)(W.Fragment,{children:[(0,W.jsxs)(o.A,{open:A,onClose:()=>{j(!1),n()},maxWidth:"md",fullWidth:!0,PaperProps:{sx:{borderRadius:3,background:a?"linear-gradient(135deg, #1e1e1e 0%, #2d2d2d 100%)":"linear-gradient(135deg, #ffffff 0%, #f5f5f5 100%)"}},children:[(0,W.jsxs)(l.A,{sx:{display:"flex",alignItems:"center",gap:2,borderBottom:1,borderColor:"divider",pb:2},children:[(0,W.jsx)(Ja.A,{sx:{bgcolor:"primary.main",width:48,height:48},children:(0,W.jsx)(Ii.A,{})}),(0,W.jsxs)(i.A,{flex:1,children:[(0,W.jsx)(c.A,{variant:"h5",fontWeight:"bold",children:"Choose Your Learning Path"}),(0,W.jsx)(c.A,{variant:"body2",color:"text.secondary",children:"Select the tutorial that matches your role and learning goals"})]}),(0,W.jsx)(d.A,{onClick:()=>{j(!1),n()},sx:{alignSelf:"flex-start"},children:(0,W.jsx)(K.A,{})})]}),(0,W.jsxs)(r.A,{sx:{p:3},children:[(0,W.jsx)(is.A,{spacing:3,children:w.map(e=>(0,W.jsx)(Ds.A,{in:!0,timeout:500,children:(0,W.jsx)(te.A,{sx:{cursor:"pointer",transition:"all 0.3s ease",border:2,borderColor:f===e.id?e.color:"transparent","&:hover":{transform:"translateY(-4px)",boxShadow:6,borderColor:e.color}},onClick:()=>k(e.id),children:(0,W.jsx)(Qt.A,{sx:{p:3},children:(0,W.jsxs)(is.A,{direction:"row",spacing:3,alignItems:"center",children:[(0,W.jsx)(Ja.A,{sx:{bgcolor:e.color+"20",color:e.color,width:64,height:64},children:e.icon}),(0,W.jsxs)(i.A,{flex:1,children:[(0,W.jsxs)(is.A,{direction:"row",alignItems:"center",gap:2,mb:1,children:[(0,W.jsx)(c.A,{variant:"h6",fontWeight:"bold",children:e.title}),u===e.id&&(0,W.jsx)(V.A,{label:"Your Role",size:"small",color:"primary",variant:"filled"})]}),(0,W.jsx)(c.A,{variant:"body2",color:"text.secondary",mb:2,children:e.description}),(0,W.jsx)(is.A,{direction:"row",flexWrap:"wrap",gap:1,children:e.features.map((t,n)=>(0,W.jsx)(V.A,{label:t,size:"small",variant:"outlined",sx:{borderColor:e.color+"40",color:e.color,fontSize:"0.75rem"}},n))})]}),(0,W.jsx)(g.A,{variant:"contained",size:"large",sx:{bgcolor:e.color,minWidth:120,"&:hover":{bgcolor:e.color,filter:"brightness(0.9)"}},onClick:t=>{t.stopPropagation(),k(e.id)},children:"Start"})]})})})},e.id))}),(0,W.jsx)(i.A,{mt:3,p:2,bgcolor:"action.hover",borderRadius:2,children:(0,W.jsxs)(c.A,{variant:"body2",color:"text.secondary",align:"center",children:[(0,W.jsx)("strong",{children:"Tip:"})," You can restart the tutorial anytime by clicking the help button in the sidebar"]})})]})]}),!A&&(0,W.jsx)(Ei.Ay,{steps:S,run:m,continuous:!0,showProgress:!0,showSkipButton:!0,styles:Oi(a),callback:e=>{const{status:t,action:a}=e;t!==Ti&&t!==Di||(x(!1),h(!0),y(null),v(!0),n()),"prev"===a&&0===e.index&&f&&(v(!0),y(null))},disableCloseOnEsc:!1,disableOverlayClose:!1,hideCloseButton:!1})]}):null};var Pi=n(1320),Mi=n(15769),zi=n(69780),Li=n(9213),Wi=n(21671),Ri=n(34075),Fi=n(88688),Bi=n(62462);const Vi=function(){const{secrets:e,loading:t,error:n,updateSecrets:a}=(()=>{const{secrets:e,loading:t,error:n,fetchAPIKeys:a,updateSecrets:i}=Ve();return(0,s.useEffect)(()=>{a()},[a]),{secrets:e,loading:t,error:n,updateSecrets:e=>{i(e)}}})(),{editDialogOpen:m,providerToEdit:p,closeApiKeyEditor:x}=Ve(),[f,y]=(0,s.useState)(!1),[b,v]=(0,s.useState)(null),[A,j]=(0,s.useState)({open:!1,message:"",severity:"success"}),[w,k]=(0,s.useState)(!1),[C,S]=(0,s.useState)({name:"",value:"",description:""}),[_,E]=(0,s.useState)(0);(0,s.useEffect)(()=>{const e=e=>{try{var t,n;const a=e;"local"===(null==(t=a.detail)?void 0:t.tab)&&E(1),"models"===(null==(n=a.detail)?void 0:n.tab)&&E(0)}catch(a){}},t=e=>{try{var t;const n=null==(t=e.detail)?void 0:t.name;if(!n)return;const a=I.includes(n);E(a?0:1),S({name:n,value:"",description:"API Key for "+n}),k(!0)}catch(n){}};return window.addEventListener("kasal:api-keys:set-tab",e),window.addEventListener("kasal:api-keys:focus-key",t),()=>{window.removeEventListener("kasal:api-keys:set-tab",e),window.removeEventListener("kasal:api-keys:focus-key",t)}},[]);const I=["OPENAI_API_KEY","DATABRICKS_API_KEY","ANTHROPIC_API_KEY","QWEN_API_KEY","DEEPSEEK_API_KEY","GROK_API_KEY","GEMINI_API_KEY"],T=(0,s.useMemo)(()=>({openai:"OPENAI_API_KEY",anthropic:"ANTHROPIC_API_KEY",databricks:"DATABRICKS_API_KEY",qwen:"QWEN_API_KEY",deepseek:"DEEPSEEK_API_KEY",grok:"GROK_API_KEY",gemini:"GEMINI_API_KEY"}),[]);(0,s.useEffect)(()=>{if(m&&p&&!t&&e.length>0){const t=T[p.toLowerCase()];if(t){const n=e.find(e=>e.name===t);n&&(v(n),y(!0),E(0),x())}}},[m,p,e,t,x,T]);const D=(0,s.useCallback)(function(e,t){void 0===t&&(t="success"),j({open:!0,message:e,severity:t})},[]),O=(0,s.useCallback)(async()=>{try{const e=We.getInstance(),t=await e.getAPIKeys();a(t)}catch(n){D(n instanceof Error?n.message:"Error fetching API keys","error")}},[D,a]),N=e.filter(e=>!I.includes(e.name));if(t)return(0,W.jsx)(i.A,{sx:{display:"flex",justifyContent:"center",p:3},children:(0,W.jsx)(Y.A,{})});if(n)return(0,W.jsx)(te.A,{sx:{mt:8},children:(0,W.jsxs)(Qt.A,{children:[(0,W.jsxs)(i.A,{sx:{display:"flex",alignItems:"center",mb:3},children:[(0,W.jsx)(Fi.A,{sx:{mr:1,color:"error.main"}}),(0,W.jsx)(c.A,{variant:"h5",children:"API Keys & Secrets"})]}),(0,W.jsx)(h.A,{severity:"error",sx:{mb:2},children:n})]})});const P=e=>{if(e.id<0)return S({name:e.name,value:"",description:e.description||""}),void k(!0);const t=Object.assign({},e,{value:"",maskedValue:"Set"===e.value?"\u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022 (hidden for security)":"Not configured"});v(t),y(!0)},z=e=>{const t="Set"===e,n="Not set"===e||!e||""===e.trim();return t?(0,W.jsxs)(i.A,{sx:{display:"flex",alignItems:"center",gap:1},children:[(0,W.jsx)(rt.A,{sx:{color:"success.main",fontSize:20}}),(0,W.jsxs)(i.A,{sx:{display:"flex",alignItems:"center",gap:.5},children:[(0,W.jsx)(Bi.A,{sx:{color:"text.secondary",fontSize:16}}),(0,W.jsx)(c.A,{variant:"body2",sx:{color:"text.secondary",fontStyle:"italic"},children:"Hidden"})]})]}):n?(0,W.jsxs)(i.A,{sx:{display:"flex",alignItems:"center",gap:1},children:[(0,W.jsx)(wt.A,{sx:{color:"warning.main",fontSize:20}}),(0,W.jsx)(c.A,{variant:"body2",sx:{color:"text.secondary"},children:"Not configured"})]}):(0,W.jsxs)(i.A,{sx:{display:"flex",alignItems:"center",gap:1},children:[(0,W.jsx)(rt.A,{sx:{color:"success.main",fontSize:20}}),(0,W.jsx)(c.A,{variant:"body2",sx:{color:"text.secondary"},children:"Configured"})]})},L=e=>(0,W.jsx)(Pi.A,{component:_e.A,sx:{mt:2},children:(0,W.jsxs)(Mi.A,{children:[(0,W.jsx)(zi.A,{children:(0,W.jsxs)(Li.A,{children:[(0,W.jsx)(Wi.A,{children:"Key Name"}),(0,W.jsx)(Wi.A,{children:"Value"}),(0,W.jsx)(Wi.A,{children:"Description"}),(0,W.jsx)(Wi.A,{children:"Actions"})]})}),(0,W.jsx)(Ri.A,{children:0===e.length?(0,W.jsx)(Li.A,{children:(0,W.jsx)(Wi.A,{colSpan:4,align:"center",children:"No API keys found"})}):e.map(e=>(0,W.jsxs)(Li.A,{children:[(0,W.jsx)(Wi.A,{children:e.name}),(0,W.jsx)(Wi.A,{children:z(e.value)}),(0,W.jsx)(Wi.A,{children:e.description}),(0,W.jsx)(Wi.A,{children:(0,W.jsxs)(i.A,{sx:{display:"flex",gap:1},children:[(0,W.jsx)(M.A,{title:"Edit",children:(0,W.jsx)(d.A,{onClick:()=>P(e),children:(0,W.jsx)(Z.A,{})})}),e.id>=0&&(0,W.jsx)(M.A,{title:"Delete",children:(0,W.jsx)(d.A,{onClick:()=>(async e=>{if(window.confirm('Are you sure you want to delete the key "'+e+'"?'))try{const t=We.getInstance(),n=await t.deleteAPIKey(e);await O(),D(n.message)}catch(n){D(n instanceof Error?n.message:"Error deleting API key","error")}})(e.name),color:"error",children:(0,W.jsx)(Q.A,{})})})]})})]},e.id))})]})});return(0,W.jsx)(te.A,{sx:{mt:8},children:(0,W.jsxs)(Qt.A,{children:[(0,W.jsxs)(i.A,{sx:{display:"flex",alignItems:"center",mb:3},children:[(0,W.jsx)(Fi.A,{sx:{mr:1}}),(0,W.jsx)(c.A,{variant:"h5",children:"API Keys & Secrets"})]}),(()=>{const e=localStorage.getItem("selectedGroupId");return e&&!e.startsWith("user_")?(0,W.jsxs)(h.A,{severity:"warning",sx:{mb:2},children:[(0,W.jsx)(c.A,{variant:"subtitle2",gutterBottom:!0,children:(0,W.jsx)("strong",{children:"\u26a0\ufe0f Shared Workspace Notice"})}),(0,W.jsx)(c.A,{variant:"body2",children:"You are currently in a shared workspace. API keys added here will be accessible to all members of this workspace. If you need private API keys, please switch to your personal workspace."})]}):null})(),(0,W.jsxs)(Hn.A,{value:_,onChange:(e,t)=>{E(t)},sx:{mb:2},children:[(0,W.jsx)(Kn.A,{label:"Model API Keys"}),(0,W.jsx)(Kn.A,{label:"Local Keystore"})]}),0===_&&(0,W.jsxs)(W.Fragment,{children:[(0,W.jsxs)(i.A,{sx:{display:"flex",alignItems:"center",mb:2},children:[(0,W.jsx)(Fi.A,{sx:{mr:1}}),(0,W.jsx)(c.A,{variant:"subtitle1",children:"Model API Keys"})]}),(0,W.jsx)(Pi.A,{component:_e.A,children:(0,W.jsxs)(Mi.A,{children:[(0,W.jsx)(zi.A,{children:(0,W.jsxs)(Li.A,{children:[(0,W.jsx)(Wi.A,{children:"Key Name"}),(0,W.jsx)(Wi.A,{children:"Value"}),(0,W.jsx)(Wi.A,{children:"Description"}),(0,W.jsx)(Wi.A,{children:"Actions"})]})}),(0,W.jsx)(Ri.A,{children:I.map(t=>{const n=e.find(e=>e.name===t);return(0,W.jsxs)(Li.A,{children:[(0,W.jsx)(Wi.A,{children:t}),(0,W.jsx)(Wi.A,{children:n?z(n.value):(0,W.jsxs)(i.A,{sx:{display:"flex",alignItems:"center",gap:1},children:[(0,W.jsx)(wt.A,{sx:{color:"warning.main",fontSize:20}}),(0,W.jsx)(c.A,{variant:"body2",sx:{color:"text.secondary"},children:"Not configured"})]})}),(0,W.jsx)(Wi.A,{children:(null==n?void 0:n.description)||""}),(0,W.jsx)(Wi.A,{children:(0,W.jsx)(M.A,{title:n?"Edit":"Set Key",children:(0,W.jsx)(d.A,{onClick:()=>{n?P(n):(S({name:t,value:"",description:"API Key for "+t}),k(!0))},children:(0,W.jsx)(Z.A,{})})})})]},t)})})]})})]}),1===_&&(0,W.jsxs)(W.Fragment,{children:[(0,W.jsx)(i.A,{sx:{display:"flex",justifyContent:"flex-end",mb:2},children:(0,W.jsx)(g.A,{variant:"contained",startIcon:(0,W.jsx)($t.A,{}),onClick:()=>{S({name:"",value:"",description:""}),k(!0)},children:"Add New Key"})}),(()=>{const e=N.map(e=>e.name),t=["SERPER_API_KEY","PERPLEXITY_API_KEY","FIRECRAWL_API_KEY","EXA_API_KEY","LINKUP_API_KEY","COMPOSIO_API_KEY"].filter(t=>!e.includes(t)).map((e,t)=>({id:-1e3-t,name:e,value:"Not set",description:"API Key for "+e.replace(/_/g," ").toLowerCase(),created_at:"",updated_at:""})),n=[...N,...t];return L(n)})()]}),(0,W.jsxs)(o.A,{open:w,onClose:()=>k(!1),maxWidth:"sm",fullWidth:!0,children:[(0,W.jsx)(l.A,{children:I.includes(C.name)?"Set Model API Key":"Create New API Key"}),(0,W.jsx)(r.A,{children:(0,W.jsxs)(i.A,{sx:{mt:2,display:"flex",flexDirection:"column",gap:2},children:[(0,W.jsx)(U.A,{label:"Name",value:C.name,onChange:e=>S(Object.assign({},C,{name:e.target.value})),disabled:I.includes(C.name),fullWidth:!0}),(0,W.jsx)(U.A,{label:"Value",value:C.value,onChange:e=>S(Object.assign({},C,{value:e.target.value})),fullWidth:!0}),(0,W.jsx)(U.A,{label:"Description",value:C.description,onChange:e=>S(Object.assign({},C,{description:e.target.value})),fullWidth:!0,multiline:!0,rows:2})]})}),(0,W.jsxs)(H.A,{children:[(0,W.jsx)(g.A,{onClick:()=>k(!1),children:"Cancel"}),(0,W.jsx)(g.A,{onClick:async()=>{try{if(!C.name||!C.value)return void D("Name and value are required","error");const e=We.getInstance(),t=await e.createAPIKey({name:C.name.trim(),value:C.value,description:C.description||""});k(!1),S({name:"",value:"",description:""}),await O(),D(t.message)}catch(n){D(n instanceof Error?n.message:"Error creating API key","error")}},variant:"contained",children:I.includes(C.name)?"Set Key":"Create"})]})]}),(0,W.jsxs)(o.A,{open:f,onClose:()=>y(!1),children:[(0,W.jsx)(l.A,{children:"Edit API Key"}),(0,W.jsx)(r.A,{children:(0,W.jsxs)(i.A,{sx:{pt:2,display:"flex",flexDirection:"column",gap:2},children:[(0,W.jsx)(U.A,{label:"Name",value:(null==b?void 0:b.name)||"",disabled:!0,fullWidth:!0}),(0,W.jsx)(U.A,{label:"Value",placeholder:null!=b&&b.maskedValue?"Current: "+(null==b?void 0:b.maskedValue):"Enter new value",value:(null==b?void 0:b.value)||"",onChange:e=>{b&&v(Object.assign({},b,{value:e.target.value}))},fullWidth:!0,required:!0,helperText:"Current value is masked for security. Enter a new value to update."}),(0,W.jsx)(U.A,{label:"Description",value:(null==b?void 0:b.description)||"",onChange:e=>{b&&v(Object.assign({},b,{description:e.target.value}))},fullWidth:!0})]})}),(0,W.jsxs)(H.A,{children:[(0,W.jsx)(g.A,{onClick:()=>y(!1),children:"Cancel"}),(0,W.jsx)(g.A,{onClick:async()=>{try{const e=We.getInstance();if(b){if(!b.value)return void D("Value is required","error");const t={value:b.value,description:b.description||""},n=await e.updateAPIKey(b.name,t);await O(),D(n.message)}y(!1)}catch(n){D(n instanceof Error?n.message:"Error updating key/secret","error")}},variant:"contained",children:"Save"})]})]}),(0,W.jsx)(u.A,{open:A.open,autoHideDuration:6e3,onClose:()=>j(e=>Object.assign({},e,{open:!1})),anchorOrigin:{vertical:"bottom",horizontal:"center"},children:(0,W.jsx)(h.A,{onClose:()=>j(e=>Object.assign({},e,{open:!1})),severity:A.severity,sx:{width:"100%"},children:A.message})})]})})};var Ui=n(33738),Hi=n(91434),Ki=n(47644);const Gi=new class{constructor(){this.apiUrl=void 0,this.apiUrl=ve.$W.apiUrl}async getLLMLogs(e){const{page:t,per_page:n,endpoint:a}=e;return(await ve.Ay.get("/llm-logs",{params:Object.assign({page:t,per_page:n},"all"!==a&&{endpoint:a})})).data}},qi=e=>{let{log:t}=e;const[n,a]=(0,s.useState)(!1),{t:o}=(0,b.Bd)();return(0,W.jsxs)(W.Fragment,{children:[(0,W.jsxs)(Li.A,{sx:{"& > *":{borderBottom:"unset"}},children:[(0,W.jsx)(Wi.A,{padding:"checkbox",children:(0,W.jsx)(d.A,{"aria-label":"expand row",size:"small",onClick:()=>a(!n),children:n?(0,W.jsx)(Ki.A,{}):(0,W.jsx)(cs.A,{})})}),(0,W.jsx)(Wi.A,{children:(u=t.created_at,new Date(u).toLocaleString())}),(0,W.jsx)(Wi.A,{children:t.endpoint}),(0,W.jsx)(Wi.A,{children:t.model}),(0,W.jsx)(Wi.A,{align:"right",children:(l=t.tokens_used,l?l.toLocaleString():"N/A")}),(0,W.jsx)(Wi.A,{align:"right",children:(r=t.duration_ms,(r/1e3).toFixed(2)+"s")}),(0,W.jsx)(Wi.A,{children:(0,W.jsx)(V.A,{label:t.status,color:"success"===t.status?"success":"error",size:"small",variant:"outlined"})})]}),(0,W.jsx)(Li.A,{children:(0,W.jsx)(Wi.A,{style:{paddingBottom:0,paddingTop:0},colSpan:7,children:(0,W.jsx)(Ui.A,{in:n,timeout:"auto",unmountOnExit:!0,children:(0,W.jsxs)(i.A,{sx:{margin:2},children:[(0,W.jsx)(c.A,{variant:"h6",gutterBottom:!0,component:"div",color:"primary",children:o("logs.details.title")}),(0,W.jsx)(c.A,{variant:"subtitle2",gutterBottom:!0,children:o("logs.details.prompt")}),(0,W.jsx)(_e.A,{sx:{p:2,mb:2,bgcolor:"#f5f5f5",maxHeight:"200px",overflow:"auto"},children:(0,W.jsx)("pre",{style:{margin:0,whiteSpace:"pre-wrap",fontSize:"0.875rem"},children:t.prompt})}),(0,W.jsx)(c.A,{variant:"subtitle2",gutterBottom:!0,children:o("logs.details.response")}),(0,W.jsx)(_e.A,{sx:{p:2,mb:2,bgcolor:"#f5f5f5",maxHeight:"400px",overflow:"auto"},children:(0,W.jsx)("pre",{style:{margin:0,whiteSpace:"pre-wrap",fontSize:"0.875rem"},children:t.response})}),t.extra_data&&(0,W.jsxs)(W.Fragment,{children:[(0,W.jsx)(c.A,{variant:"subtitle2",gutterBottom:!0,children:o("logs.details.additionalData")}),(0,W.jsx)(_e.A,{sx:{p:2,bgcolor:"#f5f5f5",maxHeight:"200px",overflow:"auto"},children:(0,W.jsx)("pre",{style:{margin:0,whiteSpace:"pre-wrap",fontSize:"0.875rem"},children:JSON.stringify(t.extra_data,null,2)})})]}),t.error_message&&(0,W.jsxs)(W.Fragment,{children:[(0,W.jsx)(c.A,{variant:"subtitle2",gutterBottom:!0,color:"error",children:o("logs.details.error")}),(0,W.jsx)(_e.A,{sx:{p:2,bgcolor:"#fff3f3",maxHeight:"200px",overflow:"auto"},children:(0,W.jsx)("pre",{style:{margin:0,whiteSpace:"pre-wrap",color:"#d32f2f",fontSize:"0.875rem"},children:t.error_message})})]})]})})})})]});var r,l,u},Ji=()=>{const[e,t]=(0,s.useState)([]),[n,a]=(0,s.useState)(!0),[o,r]=(0,s.useState)(0),[l,d]=(0,s.useState)(10),[u,h]=(0,s.useState)("all"),{t:m}=(0,b.Bd)(),g=(0,s.useCallback)(async()=>{try{a(!0);const e=await Gi.getLLMLogs({page:o,per_page:l,endpoint:"all"!==u?u:void 0});t(e)}catch(e){}finally{a(!1)}},[o,l,u]);(0,s.useEffect)(()=>{g();const e=setInterval(g,3e4);return()=>clearInterval(e)},[g]);return n?(0,W.jsx)(i.A,{sx:{display:"flex",justifyContent:"center",p:3},children:(0,W.jsx)(Y.A,{})}):(0,W.jsx)(te.A,{sx:{mt:8},children:(0,W.jsxs)(Qt.A,{children:[(0,W.jsxs)(i.A,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:3},children:[(0,W.jsx)(c.A,{variant:"h5",children:m("logs.title")}),(0,W.jsxs)(re.A,{sx:{minWidth:200},children:[(0,W.jsx)(le.A,{children:m("logs.filterByEndpoint")}),(0,W.jsxs)(ce.A,{value:u,onChange:e=>{h(e.target.value),r(0)},label:m("logs.filterByEndpoint"),children:[(0,W.jsx)(de.A,{value:"all",children:m("logs.allEndpoints")}),(0,W.jsx)(de.A,{value:"generate-crew",children:"Generate Crew"}),(0,W.jsx)(de.A,{value:"generate-task",children:"Generate Task"}),(0,W.jsx)(de.A,{value:"generate-agent",children:"Generate Agent"})]})]})]}),(0,W.jsx)(Pi.A,{component:_e.A,sx:{maxHeight:"calc(100vh - 250px)",overflow:"auto"},children:(0,W.jsxs)(Mi.A,{stickyHeader:!0,children:[(0,W.jsx)(zi.A,{children:(0,W.jsxs)(Li.A,{children:[(0,W.jsx)(Wi.A,{padding:"checkbox"}),(0,W.jsx)(Wi.A,{children:m("logs.columns.timestamp")}),(0,W.jsx)(Wi.A,{children:m("logs.columns.endpoint")}),(0,W.jsx)(Wi.A,{children:m("logs.columns.model")}),(0,W.jsx)(Wi.A,{align:"right",children:m("logs.columns.tokens")}),(0,W.jsx)(Wi.A,{align:"right",children:m("logs.columns.duration")}),(0,W.jsx)(Wi.A,{children:m("logs.columns.status")})]})}),(0,W.jsx)(Ri.A,{children:0===e.length?(0,W.jsx)(Li.A,{children:(0,W.jsx)(Wi.A,{colSpan:7,align:"center",children:m("logs.noLogs")})}):e.map(e=>(0,W.jsx)(qi,{log:e},e.id))})]})}),(0,W.jsx)(Hi.A,{component:"div",count:-1,rowsPerPage:l,page:o,onPageChange:(e,t)=>{r(t)},onRowsPerPageChange:e=>{d(parseInt(e.target.value,10)),r(0)},rowsPerPageOptions:[10,25,50,100],labelDisplayedRows:e=>{let{from:t,to:n}=e;return t+"-"+n}})]})})};var Yi=n(43833),Xi=n(24397),Qi=n(31285),Zi=n(41232),$i=n(3683),eo=n(17923),to=n(37524),no=n(4145),ao=n(43841),so=n(6493),io=n(90158),oo=n(92098),ro=n(39497),lo=n(87949);var co=n(72814);const uo=["temperature"],ho=["key"],mo=e=>{let{open:t,onClose:n,model:u,onSave:h,isNew:m=!1}=e;const{t:p}=(0,b.Bd)(),[x,f]=s.useState(u),[y,v]=s.useState({});if((0,s.useEffect)(()=>{f(m&&!u?{key:"",name:"",provider:"",temperature:.7,context_window:4096,max_output_tokens:1024,extended_thinking:!1,enabled:!0}:u),v({})},[u,m]),!x)return null;const A=e=>t=>{let n=t.target.value;"temperature"===e&&""!==n?(n=parseFloat(n),isNaN(n)||n<0||n>2?v(e=>Object.assign({},e,{temperature:"Must be between 0 and 2"})):v(e=>(0,a.A)(e,uo))):"context_window"!==e&&"max_output_tokens"!==e||""===n?"key"!==e&&"name"!==e||v(n?t=>{const n=Object.assign({},t);return delete n[e],n}:t=>Object.assign({},t,{[e]:"This field is required"})):(n=parseInt(n,10),isNaN(n)||n<=0?v(t=>Object.assign({},t,{[e]:"Must be a positive number"})):v(t=>{const n=Object.assign({},t);return delete n[e],n})),f(t=>t?Object.assign({},t,{[e]:n}):null)};return(0,W.jsxs)(o.A,{open:t,onClose:n,maxWidth:"md",fullWidth:!0,PaperProps:{sx:{overflowY:"visible",borderRadius:2,boxShadow:"0 8px 32px rgba(0,0,0,0.12)"}},children:[(0,W.jsxs)(l.A,{sx:{borderBottom:"1px solid",borderColor:"divider",p:3},children:[(0,W.jsxs)(i.A,{sx:{display:"flex",alignItems:"center"},children:[(0,W.jsx)(dt.A,{sx:{mr:1.5,color:"primary.main",fontSize:"1.5rem"}}),m?(0,W.jsx)(c.A,{variant:"h5",children:p("configuration.models.add",{defaultValue:"Add New Model"})}):(0,W.jsx)(c.A,{variant:"h5",children:p("configuration.models.edit",{defaultValue:"Edit Model"})})]}),(0,W.jsx)(d.A,{onClick:n,sx:{position:"absolute",right:16,top:16,color:"text.secondary","&:hover":{bgcolor:"action.hover",color:"primary.main"}},children:(0,W.jsx)(N.A,{})})]}),(0,W.jsx)(r.A,{sx:{p:3},children:(0,W.jsxs)(is.A,{spacing:3,sx:{mt:1},children:[(0,W.jsx)(U.A,{label:p("configuration.models.key",{defaultValue:"Model Key"}),value:x.key||"",onChange:A("key"),fullWidth:!0,required:!0,disabled:!m,error:!!y.key,size:"medium",sx:{"& .MuiOutlinedInput-root":{borderRadius:1.5}},helperText:y.key||p("configuration.models.keyHelp",{defaultValue:"Unique identifier for this model"})}),(0,W.jsx)(U.A,{label:p("configuration.models.name",{defaultValue:"Model Name"}),value:x.name||"",onChange:A("name"),fullWidth:!0,required:!0,error:!!y.name,size:"medium",sx:{"& .MuiOutlinedInput-root":{borderRadius:1.5}},helperText:y.name||p("configuration.models.nameHelp",{defaultValue:'Full name of the model (e.g., "gpt-4-turbo-preview")'})}),(0,W.jsxs)(re.A,{fullWidth:!0,size:"medium",sx:{"& .MuiOutlinedInput-root":{borderRadius:1.5}},children:[(0,W.jsx)(le.A,{children:p("configuration.models.provider",{defaultValue:"Provider"})}),(0,W.jsxs)(ce.A,{value:x.provider||"",onChange:(j="provider",e=>{const t=e.target.value;f(e=>e?Object.assign({},e,{[j]:t}):null)}),label:p("configuration.models.provider",{defaultValue:"Provider"}),children:[(0,W.jsx)(de.A,{value:"",children:(0,W.jsx)("em",{children:p("common.none",{defaultValue:"None"})})}),(0,W.jsx)(de.A,{value:"openai",children:"OpenAI"}),(0,W.jsx)(de.A,{value:"anthropic",children:"Anthropic"}),(0,W.jsx)(de.A,{value:"gemini",children:"Gemini"}),(0,W.jsx)(de.A,{value:"mistral",children:"Mistral"}),(0,W.jsx)(de.A,{value:"ollama",children:"Ollama"}),(0,W.jsx)(de.A,{value:"cohere",children:"Cohere"}),(0,W.jsx)(de.A,{value:"databricks",children:"Databricks"}),(0,W.jsx)(de.A,{value:"local",children:"Local"})]})]}),(0,W.jsx)(ne.A,{sx:{my:1.5}}),(0,W.jsx)(c.A,{variant:"subtitle1",color:"text.primary",fontWeight:"medium",sx:{pt:1.5},children:p("configuration.models.parameters",{defaultValue:"Model Parameters"})}),(0,W.jsx)(U.A,{label:p("configuration.models.temperature",{defaultValue:"Temperature"}),value:void 0===x.temperature?"":x.temperature,onChange:A("temperature"),type:"number",fullWidth:!0,inputProps:{step:.1,min:0,max:2},error:!!y.temperature,size:"medium",sx:{"& .MuiOutlinedInput-root":{borderRadius:1.5}},helperText:y.temperature||p("configuration.models.temperatureHelp",{defaultValue:"Controls randomness (0.0 to 2.0)"})}),(0,W.jsx)(U.A,{label:p("configuration.models.contextWindow",{defaultValue:"Context Window"}),value:void 0===x.context_window?"":x.context_window,onChange:A("context_window"),type:"number",fullWidth:!0,inputProps:{min:1},error:!!y.context_window,size:"medium",sx:{"& .MuiOutlinedInput-root":{borderRadius:1.5}},helperText:y.context_window||p("configuration.models.contextWindowHelp",{defaultValue:"Maximum token context length"})}),(0,W.jsx)(U.A,{label:p("configuration.models.maxOutputTokens",{defaultValue:"Max Output Tokens"}),value:void 0===x.max_output_tokens?"":x.max_output_tokens,onChange:A("max_output_tokens"),type:"number",fullWidth:!0,inputProps:{min:1},error:!!y.max_output_tokens,size:"medium",sx:{"& .MuiOutlinedInput-root":{borderRadius:1.5}},helperText:y.max_output_tokens||p("configuration.models.maxOutputTokensHelp",{defaultValue:"Maximum tokens to generate"})}),(0,W.jsx)(he.A,{sx:{mt:1},control:(0,W.jsx)(me.A,{checked:!!x.extended_thinking,onChange:(e=>t=>{f(n=>n?Object.assign({},n,{[e]:t.target.checked}):null)})("extended_thinking"),color:"primary"}),label:p("configuration.models.extendedThinking",{defaultValue:"Extended Thinking"})})]})}),(0,W.jsxs)(H.A,{sx:{px:3,py:2.5,borderTop:"1px solid",borderColor:"divider"},children:[(0,W.jsx)(g.A,{onClick:n,children:p("common.cancel",{defaultValue:"Cancel"})}),(0,W.jsx)(g.A,{onClick:()=>{const e={};if(x.key||(e.key="Key is required"),x.name||(e.name="Name is required"),Object.keys(e).length>0||Object.keys(y).length>0)return void v(Object.assign({},y,e));const{key:t}=x,s=(0,a.A)(x,ho);h(t,s),n()},variant:"contained",startIcon:(0,W.jsx)(oo.A,{}),disabled:Object.keys(y).length>0,sx:{px:3},children:p("common.save",{defaultValue:"Save"})})]})]});var j},go=e=>{let{open:t,modelKey:n,onClose:a,onConfirm:s}=e;const{t:i}=(0,b.Bd)();return(0,W.jsxs)(o.A,{open:t,onClose:a,"aria-labelledby":"alert-dialog-title","aria-describedby":"alert-dialog-description",children:[(0,W.jsx)(l.A,{id:"alert-dialog-title",children:i("configuration.models.confirmDeleteTitle",{defaultValue:"Delete Model?"})}),(0,W.jsx)(r.A,{children:(0,W.jsx)(so.A,{id:"alert-dialog-description",children:i("configuration.models.confirmDeleteMessage",{defaultValue:"Are you sure you want to delete the model {{modelKey}}? This action cannot be undone.",modelKey:n})})}),(0,W.jsxs)(H.A,{children:[(0,W.jsx)(g.A,{onClick:a,color:"primary",children:i("common.cancel",{defaultValue:"Cancel"})}),(0,W.jsx)(g.A,{onClick:s,color:"error",variant:"contained",autoFocus:!0,children:i("common.delete",{defaultValue:"Delete"})})]})]})},po=e=>{let{mode:t="auto"}=e;const{t:n}=(0,b.Bd)(),a="system"===t,{models:o,currentEditModel:r,editDialogOpen:l,isNewModel:u,loading:m,saving:p,searchTerm:x,error:f,setModels:y,setCurrentEditModel:v,setEditDialogOpen:A,setIsNewModel:j,setLoading:w,setSaving:k,setSearchTerm:C,setError:S,incrementRefreshKey:_}=(()=>{const{models:e,currentEditModel:t,editDialogOpen:n,isNewModel:a,loading:i,saving:o,modelsChanged:r,searchTerm:l,databricksEnabled:c,error:d,refreshKey:u,activeTab:h,setModels:m,setCurrentEditModel:g,setEditDialogOpen:p,setIsNewModel:x,setLoading:f,setSaving:y,setModelsChanged:b,setSearchTerm:v,setDatabricksEnabled:A,setError:j,incrementRefreshKey:w,setActiveTab:k,resetModelConfig:C}=Bn(),S=(0,s.useCallback)(e=>{m(e)},[m]),_=(0,s.useCallback)(e=>{g(e)},[g]),E=(0,s.useCallback)(e=>{p(e)},[p]),I=(0,s.useCallback)(e=>{x(e)},[x]),T=(0,s.useCallback)(e=>{f(e)},[f]),D=(0,s.useCallback)(e=>{y(e)},[y]),O=(0,s.useCallback)(e=>{b(e)},[b]),N=(0,s.useCallback)(e=>{v(e)},[v]),P=(0,s.useCallback)(e=>{A(e)},[A]),M=(0,s.useCallback)(e=>{j(e)},[j]);return{models:e,currentEditModel:t,editDialogOpen:n,isNewModel:a,loading:i,saving:o,modelsChanged:r,searchTerm:l,databricksEnabled:c,error:d,refreshKey:u,activeTab:h,setModels:S,setCurrentEditModel:_,setEditDialogOpen:E,setIsNewModel:I,setLoading:T,setSaving:D,setModelsChanged:O,setSearchTerm:N,setDatabricksEnabled:P,setError:M,incrementRefreshKey:(0,s.useCallback)(()=>{w()},[w]),setActiveTab:(0,s.useCallback)(e=>{k(e)},[k]),resetModelConfig:(0,s.useCallback)(()=>{C()},[C])}})(),{enqueueSnackbar:E}=(0,co.dh)(),[I,T]=s.useState(null),[D,O]=s.useState("all"),P=s.useMemo(()=>{const e=new Set;return Object.values(o).forEach(t=>{t.provider&&e.add(String(t.provider))}),Array.from(e).sort()},[o]);(0,s.useEffect)(()=>{if(a){const e=localStorage.getItem("models_global_providerFilter");e&&O(e)}},[a]),(0,s.useEffect)(()=>{a&&localStorage.setItem("models_global_providerFilter",D)},[a,D]),(0,s.useEffect)(()=>{(async()=>{try{w(!0);const e=ye.J.getInstance();if(a){const t=await e.getGlobalModels();y(t)}else{const[t,n]=await Promise.all([e.getModels(!0),e.getGlobalModels()]),a=new Set(Object.entries(n).filter(e=>{let[t,n]=e;return n.enabled}).map(e=>{let[t]=e;return t})),s={};for(const[e,i]of Object.entries(t))a.has(e)&&(s[e]=i);y(s)}}catch(e){S(e instanceof Error?e.message:"Failed to fetch models")}finally{w(!1)}})()},[w,y,S,a]);const z=Object.entries(o).filter(e=>{let[t,n]=e;return t.toLowerCase().includes(x.toLowerCase())||n.name.toLowerCase().includes(x.toLowerCase())}).filter(e=>{let[t,n]=e;return!a||"all"===D||(n.provider||"")===D}).sort((e,t)=>e[1].name.localeCompare(t[1].name));return m?(0,W.jsx)(i.A,{sx:{display:"flex",justifyContent:"center",alignItems:"center",height:"100%"},children:(0,W.jsx)(Y.A,{})}):(0,W.jsxs)(i.A,{sx:{p:3},children:[(0,W.jsxs)(is.A,{spacing:3,children:[(0,W.jsxs)(i.A,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,W.jsx)(c.A,{variant:"h4",component:"h1",children:a?n("configuration.models.globalTitle",{defaultValue:"Global Models (System Admin)"}):n("configuration.models.workspaceTitle",{defaultValue:"Workspace Models"})}),a&&(0,W.jsx)(g.A,{variant:"contained",startIcon:(0,W.jsx)($t.A,{}),onClick:()=>{j(!0),v(null),A(!0)},disabled:p,children:n("configuration.models.add",{defaultValue:"Add Model"})})]}),f&&(0,W.jsx)(h.A,{severity:"error",onClose:()=>S(null),children:f}),(0,W.jsx)(_e.A,{sx:{p:2},children:(0,W.jsxs)(is.A,{direction:{xs:"column",sm:"row"},spacing:2,alignItems:{xs:"stretch",sm:"center"},children:[(0,W.jsx)(U.A,{fullWidth:!0,variant:"outlined",placeholder:n("configuration.models.search",{defaultValue:"Search models..."}),value:x,onChange:e=>C(e.target.value),InputProps:{startAdornment:(0,W.jsx)(ae.A,{position:"start",children:(0,W.jsx)(Ee.A,{})})}}),a&&(0,W.jsxs)(W.Fragment,{children:[(0,W.jsxs)(re.A,{sx:{minWidth:220},size:"small",children:[(0,W.jsx)(le.A,{children:n("configuration.models.provider",{defaultValue:"Provider"})}),(0,W.jsxs)(ce.A,{label:n("configuration.models.provider",{defaultValue:"Provider"}),value:D,onChange:e=>O(e.target.value),children:[(0,W.jsx)(de.A,{value:"all",children:n("common.all",{defaultValue:"All"})}),P.map(e=>(0,W.jsx)(de.A,{value:e,children:e},e))]})]}),(0,W.jsx)(g.A,{variant:"text",size:"small",onClick:()=>{C(""),O("all")},sx:{whiteSpace:"nowrap"},children:n("common.clearFilters",{defaultValue:"Clear filters"})})]})]})}),a&&(0,W.jsx)(i.A,{sx:{display:"flex",justifyContent:"flex-end",mt:2},children:(0,W.jsxs)(io.A,{variant:"outlined",size:"small",children:[(0,W.jsx)(g.A,{startIcon:(0,W.jsx)(ro.A,{}),onClick:async()=>{try{k(!0);const e=ye.J.getInstance(),t=await e.enableAllModels();y(t),S(null),E(n("configuration.models.allModelsEnabled",{defaultValue:"All models have been enabled"}),{variant:"success"}),_()}catch(e){S(e instanceof Error?e.message:"Failed to enable all models"),E(n("configuration.models.enableAllFailed",{defaultValue:"Failed to enable all models"}),{variant:"error"})}finally{k(!1)}},disabled:p,color:"success",children:n("configuration.models.enableAll")}),(0,W.jsx)(g.A,{startIcon:(0,W.jsx)(lo.A,{}),onClick:async()=>{try{k(!0);const e=ye.J.getInstance(),t=await e.disableAllModels();y(t),S(null),E(n("configuration.models.allModelsDisabled",{defaultValue:"All models have been disabled"}),{variant:"success"}),_()}catch(e){S(e instanceof Error?e.message:"Failed to disable all models"),E(n("configuration.models.disableAllFailed",{defaultValue:"Failed to disable all models"}),{variant:"error"})}finally{k(!1)}},disabled:p,color:"error",children:n("configuration.models.disableAll")})]})}),(0,W.jsx)(Pi.A,{component:_e.A,children:(0,W.jsxs)(Mi.A,{children:[(0,W.jsx)(zi.A,{children:(0,W.jsxs)(Li.A,{children:[(0,W.jsx)(Wi.A,{children:n("configuration.models.key",{defaultValue:"Key"})}),(0,W.jsx)(Wi.A,{children:n("configuration.models.name",{defaultValue:"Name"})}),(0,W.jsx)(Wi.A,{children:n("configuration.models.provider",{defaultValue:"Provider"})}),(0,W.jsx)(Wi.A,{children:n("configuration.models.status",{defaultValue:"Status"})}),(0,W.jsx)(Wi.A,{children:n("configuration.models.actions",{defaultValue:"Actions"})})]})}),(0,W.jsx)(Ri.A,{children:z.map(e=>{let[t,s]=e;return(0,W.jsxs)(Li.A,{children:[(0,W.jsx)(Wi.A,{children:t}),(0,W.jsx)(Wi.A,{children:s.name}),(0,W.jsx)(Wi.A,{children:s.provider}),(0,W.jsx)(Wi.A,{children:(0,W.jsx)(he.A,{control:(0,W.jsx)(me.A,{checked:s.enabled,onChange:e=>(async(e,t)=>{try{k(!0);const s=ye.J.getInstance();if(a){await s.enableGlobalModel(e,t);const n=await s.getGlobalModels();y(n)}else{await s.enableModel(e,t);const[n,a]=await Promise.all([s.getModels(!0),s.getGlobalModels()]),i=new Set(Object.entries(a).filter(e=>{let[t,n]=e;return n.enabled}).map(e=>{let[t]=e;return t})),o={};for(const[e,t]of Object.entries(n))i.has(e)&&(o[e]=t);y(o)}E(t?n("configuration.models.modelEnabled",{defaultValue:"Model enabled successfully"}):n("configuration.models.modelDisabled",{defaultValue:"Model disabled successfully"}),{variant:"success"}),_()}catch(s){S(s instanceof Error?s.message:"Failed to update model status"),E(n("configuration.models.toggleFailed",{defaultValue:"Failed to toggle model status"}),{variant:"error"})}finally{k(!1)}})(t,e.target.checked),disabled:p}),label:s.enabled?n("configuration.models.enabled",{defaultValue:"Enabled"}):n("configuration.models.disabled",{defaultValue:"Disabled"})})}),(0,W.jsx)(Wi.A,{children:a?(0,W.jsxs)(is.A,{direction:"row",spacing:1,children:[(0,W.jsx)(M.A,{title:n("common.edit",{defaultValue:"Edit"}),children:(0,W.jsx)(d.A,{onClick:()=>(e=>{j(!1),v(e),A(!0)})(Object.assign({},s,{key:t})),disabled:p,children:(0,W.jsx)(Z.A,{})})}),(0,W.jsx)(M.A,{title:n("common.delete",{defaultValue:"Delete"}),children:(0,W.jsx)(d.A,{onClick:()=>(e=>{T(e)})(t),disabled:p,children:(0,W.jsx)(N.A,{})})})]}):(0,W.jsx)(c.A,{variant:"body2",color:"text.secondary",children:n("configuration.models.workspaceActionsHelp",{defaultValue:"Enable/disable only"})})})]},t)})})]})})]}),(0,W.jsx)(mo,{open:l,onClose:()=>{A(!1),v(null)},model:r,onSave:async(e,t)=>{try{k(!0);const n=ye.J.getInstance();u?await n.createModel(e,t):await n.saveModels({[e]:t});const s=a?await n.getGlobalModels():await n.getModels(!0);y(s),v(null),A(!1),_()}catch(n){S(n instanceof Error?n.message:"Failed to save model")}finally{k(!1)}},isNew:u}),(0,W.jsx)(go,{open:null!==I,modelKey:I||"",onClose:()=>{T(null)},onConfirm:()=>{(async e=>{try{k(!0);const t=ye.J.getInstance();await t.deleteModel(e);const a=await t.getGlobalModels();y(a),E(n("configuration.models.modelDeleted",{defaultValue:"Model deleted successfully"}),{variant:"success"}),_(),setTimeout(()=>{t.getGlobalModels().then(e=>{y(e),_()}).catch(e=>{})},2e3)}catch(t){S(t instanceof Error?t.message:"Failed to delete model"),E(n("configuration.models.deleteFailed",{defaultValue:"Failed to delete model"}),{variant:"error"})}finally{k(!1)}})(I||""),T(null)}})]})},xo=po;const fo=function(){var e,t,n,a;const[m,p]=(0,s.useState)([]),[x,f]=(0,s.useState)(!0),[y,b]=(0,s.useState)(null),[v,A]=(0,s.useState)(!1),[j,w]=(0,s.useState)(!1),[k,C]=(0,s.useState)(!1),[S,_]=(0,s.useState)(null),[E,I]=(0,s.useState)({open:!1,message:"",severity:"success"}),[T,D]=(0,s.useState)(0),[O,N]=(0,s.useState)([]),[P,z]=(0,s.useState)({name:"",description:"",schema_type:"",schema_definition:{}}),[L,R]=(0,s.useState)({}),F=(0,s.useCallback)(function(e,t){void 0===t&&(t="success"),I({open:!0,message:e,severity:t})},[]),B=(0,s.useCallback)(async()=>{f(!0);try{const e=St.getInstance(),t=await e.getSchemas();p(t);const n=Array.from(new Set(t.map(e=>e.schema_type)));N(n),b(null)}catch(y){b(y instanceof Error?y.message:"Error fetching schemas"),F("Failed to load schemas","error")}finally{f(!1)}},[F]);(0,s.useEffect)(()=>{B()},[B]);const K=()=>{I(Object.assign({},E,{open:!1}))},G=e=>e?Object.keys(e):[],q=e=>{try{if(void 0===e||null===e)return"{}";if("string"===typeof e)try{if(e.startsWith('"')&&e.endsWith('"'))try{const t=JSON.parse(e);if("string"===typeof t){const e=JSON.parse(t);return JSON.stringify(e,null,2)}}catch(t){}const n=JSON.parse(e);return JSON.stringify(n,null,2)}catch(t){return e}return JSON.stringify(e,null,2)}catch(y){return"string"===typeof e?e:JSON.stringify(e||{},null,2)}},J=e=>{try{const t=e.trim();if(!t)return{};let n=t;const a=(n.match(/{/g)||[]).length,s=(n.match(/}/g)||[]).length;return a>s&&(n+="}".repeat(a-s)),n=n.replace(/([{,]\s*)([a-zA-Z0-9_]+)(\s*:)/g,'$1"$2"$3'),n=n.replace(/,\s*([}\]])/g,"$1"),JSON.parse(n)}catch(y){return}},X=()=>{if(0===T)return m;const e=O[T-1];return m.filter(t=>t.schema_type===e)},ee=(e,t)=>{if(!e)return null;if("schema_definition"===t){const t=e.schema_definition;if(!t)return{};if("string"===typeof t)try{return JSON.parse(t)}catch(y){return t}return t}const n=e[t];if(!n)return null;if("string"===typeof n&&"name"!==t&&"description"!==t&&"schema_type"!==t)try{return JSON.parse(n)}catch(a){return n}return n},ne=(e,t)=>{try{const n=J(t);void 0!==n?(R(t=>Object.assign({},t,{[e]:""})),_(t=>t?Object.assign({},t,{[e]:n}):null)):(R(t=>Object.assign({},t,{[e]:"Invalid JSON format"})),_(n=>n?Object.assign({},n,{[e]:t}):null))}catch(y){R(n=>Object.assign({},n,{[e]:y instanceof Error?y.message:"Invalid JSON"}))}},ae=(e,t)=>{try{const n={[e]:t};z(e=>Object.assign({},e,n));const a=J(t);void 0!==a?(R(t=>Object.assign({},t,{[e]:""})),z(t=>Object.assign({},t,{[e]:a}))):R(t=>Object.assign({},t,{[e]:"Invalid JSON format"}))}catch(y){R(n=>Object.assign({},n,{[e]:y instanceof Error?y.message:"Invalid JSON"}))}};return x&&0===m.length?(0,W.jsx)(i.A,{sx:{display:"flex",justifyContent:"center",p:3},children:(0,W.jsx)(Y.A,{})}):(0,W.jsxs)(te.A,{sx:{mt:2},children:[(0,W.jsxs)(Qt.A,{children:[(0,W.jsxs)(i.A,{sx:{display:"flex",alignItems:"center",mb:3,justifyContent:"space-between"},children:[(0,W.jsxs)(i.A,{sx:{display:"flex",alignItems:"center"},children:[(0,W.jsx)($.A,{sx:{mr:1}}),(0,W.jsx)(c.A,{variant:"h5",children:"Object Management"}),(0,W.jsx)(M.A,{title:(0,W.jsxs)(i.A,{sx:{p:1},children:[(0,W.jsx)(c.A,{variant:"body2",children:"Object Management allows you to create, edit, and manage Pydantic schemas used throughout the system."}),(0,W.jsx)(c.A,{variant:"body2",sx:{mt:1},children:"Pydantic schemas define the structure and validation rules for data objects, ensuring consistent data formats for inputs and outputs across the application."}),(0,W.jsx)(c.A,{variant:"body2",sx:{mt:1},children:"These schemas are used for standardizing outputs from AI operations, validating API requests/responses, and enforcing type safety in your data workflows."})]}),arrow:!0,children:(0,W.jsx)(d.A,{size:"small",color:"primary",sx:{ml:1},children:(0,W.jsx)(ze.A,{fontSize:"small"})})})]}),(0,W.jsx)(g.A,{variant:"contained",color:"primary",startIcon:(0,W.jsx)($t.A,{}),onClick:()=>{w(!0)},children:"Add Schema"})]}),y&&(0,W.jsx)(h.A,{severity:"error",sx:{mb:2},children:y}),(0,W.jsx)(i.A,{sx:{borderBottom:1,borderColor:"divider",mb:2},children:(0,W.jsxs)(Hn.A,{value:T,onChange:(e,t)=>{D(t)},variant:"scrollable",scrollButtons:"auto",children:[(0,W.jsx)(Kn.A,{label:"All Schemas"}),O.map((e,t)=>(0,W.jsx)(Kn.A,{label:e},e))]})}),(0,W.jsx)(Pi.A,{component:_e.A,children:(0,W.jsxs)(Mi.A,{children:[(0,W.jsx)(zi.A,{children:(0,W.jsxs)(Li.A,{children:[(0,W.jsx)(Wi.A,{children:"Name"}),(0,W.jsx)(Wi.A,{children:"Type"}),(0,W.jsx)(Wi.A,{children:"Description"}),(0,W.jsx)(Wi.A,{children:"Keywords"}),(0,W.jsx)(Wi.A,{children:"Last Updated"}),(0,W.jsx)(Wi.A,{children:"Actions"})]})}),(0,W.jsx)(Ri.A,{children:0===X().length?(0,W.jsx)(Li.A,{children:(0,W.jsx)(Wi.A,{colSpan:6,align:"center",children:"No schemas found"})}):X().map(e=>{var t;return(0,W.jsxs)(Li.A,{children:[(0,W.jsx)(Wi.A,{children:e.name}),(0,W.jsx)(Wi.A,{children:e.schema_type}),(0,W.jsx)(Wi.A,{children:e.description}),(0,W.jsx)(Wi.A,{children:(0,W.jsx)(i.A,{sx:{display:"flex",flexWrap:"wrap",gap:.5},children:null==(t=e.keywords)?void 0:t.map((e,t)=>(0,W.jsx)(V.A,{label:e,size:"small"},t))})}),(0,W.jsx)(Wi.A,{children:new Date(e.updated_at).toLocaleString()}),(0,W.jsx)(Wi.A,{children:(0,W.jsxs)(i.A,{sx:{display:"flex"},children:[(0,W.jsx)(M.A,{title:"View & Edit Schema",children:(0,W.jsx)(d.A,{size:"small",onClick:()=>(e=>{_(e),C(!0)})(e),color:"primary",children:(0,W.jsx)($.A,{fontSize:"small"})})}),(0,W.jsx)(M.A,{title:"Delete",children:(0,W.jsx)(d.A,{size:"small",onClick:()=>(async e=>{if(window.confirm('Are you sure you want to delete the schema "'+e+'"?'))try{const t=St.getInstance();await t.deleteSchema(e)?(await B(),F('Schema "'+e+'" deleted successfully')):F('Failed to delete schema "'+e+'"',"error")}catch(y){F(y instanceof Error?y.message:"Error deleting schema","error")}})(e.name),color:"error",children:(0,W.jsx)(Q.A,{fontSize:"small"})})})]})})]},e.id)})})]})})]}),(0,W.jsxs)(o.A,{open:k,onClose:()=>C(!1),maxWidth:"md",fullWidth:!0,children:[(0,W.jsxs)(l.A,{children:["Schema: ",null==S?void 0:S.name]}),(0,W.jsx)(r.A,{children:(0,W.jsxs)(i.A,{sx:{mt:2},children:[(0,W.jsx)(c.A,{variant:"subtitle1",children:"Schema JSON:"}),S&&(0,W.jsx)(_e.A,{variant:"outlined",sx:{p:2,maxHeight:"400px",overflow:"auto",fontFamily:"monospace",whiteSpace:"pre-wrap",backgroundColor:"#f5f5f5"},children:"CustomToolOutput"===S.name&&S.schema_definition&&"string"===typeof S.schema_definition?S.schema_definition:q(ee(S,"schema_definition"))}),ee(S,"field_descriptions")&&G(ee(S,"field_descriptions")).length>0&&(0,W.jsxs)(i.A,{sx:{mt:2},children:[(0,W.jsx)(c.A,{variant:"subtitle1",children:"Field Descriptions:"}),(0,W.jsx)(_e.A,{variant:"outlined",sx:{p:2,maxHeight:"200px",overflow:"auto",fontFamily:"monospace",whiteSpace:"pre-wrap",backgroundColor:"#f5f5f5"},children:q(ee(S,"field_descriptions")||{})})]}),ee(S,"example_data")&&G(ee(S,"example_data")).length>0&&(0,W.jsxs)(i.A,{sx:{mt:2},children:[(0,W.jsx)(c.A,{variant:"subtitle1",children:"Example Data:"}),(0,W.jsx)(_e.A,{variant:"outlined",sx:{p:2,maxHeight:"200px",overflow:"auto",fontFamily:"monospace",whiteSpace:"pre-wrap",backgroundColor:"#f5f5f5"},children:q(ee(S,"example_data")||{})})]})]})}),(0,W.jsxs)(H.A,{children:[(0,W.jsx)(g.A,{onClick:()=>C(!1),children:"Close"}),(0,W.jsx)(g.A,{onClick:()=>{C(!1),_(S),A(!0)},variant:"contained",color:"primary",startIcon:(0,W.jsx)(Z.A,{}),children:"Edit"})]})]}),(0,W.jsxs)(o.A,{open:v,onClose:()=>A(!1),maxWidth:"md",fullWidth:!0,children:[(0,W.jsx)(l.A,{children:"Edit Schema"}),(0,W.jsxs)(r.A,{children:[(0,W.jsx)(U.A,{label:"Name",value:(null==S?void 0:S.name)||"",onChange:e=>_(t=>t?Object.assign({},t,{name:e.target.value}):null),fullWidth:!0,margin:"normal",disabled:!0}),(0,W.jsx)(U.A,{label:"Description",value:(null==S?void 0:S.description)||"",onChange:e=>_(t=>t?Object.assign({},t,{description:e.target.value}):null),fullWidth:!0,margin:"normal"}),(0,W.jsx)(U.A,{label:"Schema Type",value:(null==S?void 0:S.schema_type)||"",onChange:e=>_(t=>t?Object.assign({},t,{schema_type:e.target.value}):null),fullWidth:!0,margin:"normal"}),(0,W.jsxs)(i.A,{sx:{mt:2,mb:2},children:[(0,W.jsx)(c.A,{variant:"subtitle1",gutterBottom:!0,children:"Schema JSON:"}),(0,W.jsx)(U.A,{value:"string"===typeof(null==S?void 0:S.schema_definition)?S.schema_definition:q(null==S?void 0:S.schema_definition),onChange:e=>ne("schema_definition",e.target.value),fullWidth:!0,multiline:!0,rows:10,variant:"outlined",error:!!L.schema_definition,helperText:L.schema_definition||"",InputProps:{style:{fontFamily:"monospace"}}})]}),(0,W.jsxs)(i.A,{sx:{mt:2,mb:2},children:[(0,W.jsx)(c.A,{variant:"subtitle1",gutterBottom:!0,children:"Field Descriptions:"}),(0,W.jsx)(U.A,{value:"string"===typeof(null==S?void 0:S.field_descriptions)?S.field_descriptions:q(ee(S,"field_descriptions")||{}),onChange:e=>ne("field_descriptions",e.target.value),fullWidth:!0,multiline:!0,rows:6,variant:"outlined",error:!!L.field_descriptions,helperText:L.field_descriptions||"",InputProps:{style:{fontFamily:"monospace"}}})]}),(0,W.jsxs)(i.A,{sx:{mt:2,mb:2},children:[(0,W.jsx)(c.A,{variant:"subtitle1",gutterBottom:!0,children:"Example Data:"}),(0,W.jsx)(U.A,{value:"string"===typeof(null==S?void 0:S.example_data)?S.example_data:q(ee(S,"example_data")||{}),onChange:e=>ne("example_data",e.target.value),fullWidth:!0,multiline:!0,rows:10,variant:"outlined",error:!!L.example_data,helperText:L.example_data||"",InputProps:{style:{fontFamily:"monospace"}}})]}),(0,W.jsx)(U.A,{label:"Keywords (comma separated)",value:(null==S||null==(e=S.keywords)?void 0:e.join(", "))||"",onChange:e=>{const t=e.target.value.split(",").map(e=>e.trim()).filter(e=>e);_(e=>e?Object.assign({},e,{keywords:t}):null)},fullWidth:!0,margin:"normal"}),(0,W.jsx)(U.A,{label:"Tools (comma separated)",value:(null==S||null==(t=S.tools)?void 0:t.join(", "))||"",onChange:e=>{const t=e.target.value.split(",").map(e=>e.trim()).filter(e=>e);_(e=>e?Object.assign({},e,{tools:t}):null)},fullWidth:!0,margin:"normal"})]}),(0,W.jsxs)(H.A,{children:[(0,W.jsx)(g.A,{onClick:()=>A(!1),children:"Cancel"}),(0,W.jsx)(g.A,{onClick:async()=>{if(!S)return;R({});let e="";e="string"===typeof S.schema_definition?S.schema_definition:q(S.schema_definition);const t=J(e);if(!t)return void R(e=>Object.assign({},e,{schema_definition:"Invalid JSON format"}));let n,a;if(S.field_descriptions){let e="";if(e="string"===typeof S.field_descriptions?S.field_descriptions:q(S.field_descriptions),n=J(e),!n)return void R(e=>Object.assign({},e,{field_descriptions:"Invalid JSON format"}))}if(S.example_data){let e="";if(e="string"===typeof S.example_data?S.example_data:q(S.example_data),a=J(e),!a)return void R(e=>Object.assign({},e,{example_data:"Invalid JSON format"}))}try{const e={name:S.name,description:S.description,schema_type:S.schema_type,schema_definition:t,field_descriptions:n,example_data:a,keywords:S.keywords||[],tools:S.tools||[]},s=St.getInstance();await s.updateSchema(S.name,e)?(A(!1),await B(),F('Schema "'+S.name+'" updated successfully')):F('Failed to update schema "'+S.name+'"',"error")}catch(y){F(y instanceof Error?y.message:"An unknown error occurred","error")}},variant:"contained",color:"primary",children:"Save"})]})]}),(0,W.jsxs)(o.A,{open:j,onClose:()=>w(!1),maxWidth:"md",fullWidth:!0,children:[(0,W.jsx)(l.A,{children:"Create New Schema"}),(0,W.jsxs)(r.A,{children:[(0,W.jsx)(U.A,{label:"Name",value:P.name,onChange:e=>z(t=>Object.assign({},t,{name:e.target.value})),fullWidth:!0,margin:"normal",required:!0}),(0,W.jsx)(U.A,{label:"Description",value:P.description,onChange:e=>z(t=>Object.assign({},t,{description:e.target.value})),fullWidth:!0,margin:"normal"}),(0,W.jsx)(U.A,{label:"Schema Type",value:P.schema_type,onChange:e=>z(t=>Object.assign({},t,{schema_type:e.target.value})),fullWidth:!0,margin:"normal",required:!0}),(0,W.jsxs)(i.A,{sx:{mt:2,mb:2},children:[(0,W.jsx)(c.A,{variant:"subtitle1",gutterBottom:!0,children:"Schema JSON:"}),(0,W.jsx)(U.A,{value:"string"===typeof P.schema_definition?P.schema_definition:q(P.schema_definition||{}),onChange:e=>ae("schema_definition",e.target.value),fullWidth:!0,multiline:!0,rows:12,variant:"outlined",required:!0,error:!!L.schema_definition,helperText:L.schema_definition||"",InputProps:{style:{fontFamily:"monospace"}}})]}),(0,W.jsxs)(i.A,{sx:{mt:2,mb:2},children:[(0,W.jsx)(c.A,{variant:"subtitle1",gutterBottom:!0,children:"Field Descriptions (Optional):"}),(0,W.jsx)(U.A,{value:"string"===typeof P.field_descriptions?P.field_descriptions:q(P.field_descriptions||{}),onChange:e=>ae("field_descriptions",e.target.value),fullWidth:!0,multiline:!0,rows:6,variant:"outlined",error:!!L.field_descriptions,helperText:L.field_descriptions||"",InputProps:{style:{fontFamily:"monospace"}}})]}),(0,W.jsxs)(i.A,{sx:{mt:2,mb:2},children:[(0,W.jsx)(c.A,{variant:"subtitle1",gutterBottom:!0,children:"Example Data (Optional):"}),(0,W.jsx)(U.A,{value:"string"===typeof P.example_data?P.example_data:q(P.example_data||{}),onChange:e=>ae("example_data",e.target.value),fullWidth:!0,multiline:!0,rows:10,variant:"outlined",error:!!L.example_data,helperText:L.example_data||"",InputProps:{style:{fontFamily:"monospace"}}})]}),(0,W.jsx)(U.A,{label:"Keywords (comma separated)",value:(null==(n=P.keywords)?void 0:n.join(", "))||"",onChange:e=>{const t=e.target.value.split(",").map(e=>e.trim()).filter(e=>e);z(e=>Object.assign({},e,{keywords:t}))},fullWidth:!0,margin:"normal"}),(0,W.jsx)(U.A,{label:"Tools (comma separated)",value:(null==(a=P.tools)?void 0:a.join(", "))||"",onChange:e=>{const t=e.target.value.split(",").map(e=>e.trim()).filter(e=>e);z(e=>Object.assign({},e,{tools:t}))},fullWidth:!0,margin:"normal"})]}),(0,W.jsxs)(H.A,{children:[(0,W.jsx)(g.A,{onClick:()=>w(!1),children:"Cancel"}),(0,W.jsx)(g.A,{onClick:async()=>{if(R({}),!P.name||!P.schema_type||!P.description)return void F("Name, description, and schema type are required","error");let e,t,n;if("string"===typeof P.schema_definition){const t=J(P.schema_definition);if(!t)return void R(e=>Object.assign({},e,{schema_definition:"Invalid JSON format"}));e=t}else e=P.schema_definition||{};if(0!==Object.keys(e).length){if(P.field_descriptions)if("string"===typeof P.field_descriptions){const e=J(P.field_descriptions);if(!e)return void R(e=>Object.assign({},e,{field_descriptions:"Invalid JSON format"}));t=e}else t=P.field_descriptions;if(P.example_data)if("string"===typeof P.example_data){const e=J(P.example_data);if(!e)return void R(e=>Object.assign({},e,{example_data:"Invalid JSON format"}));n=e}else n=P.example_data;try{const a={name:P.name,description:P.description,schema_type:P.schema_type,schema_definition:e||{},field_descriptions:t||{},example_data:n||void 0,keywords:Array.isArray(P.keywords)?P.keywords:[],tools:Array.isArray(P.tools)?P.tools:[]};a.schema_definition&&"string"!==typeof a.schema_definition&&0!==Object.keys(a.schema_definition).length||(a.schema_definition={type:"object",properties:{},required:[]});const s=St.getInstance(),i=await s.createSchema(a);i?(w(!1),z({name:"",description:"",schema_type:"",schema_definition:{}}),await B(),F('Schema "'+i.name+'" created successfully')):F("Failed to create schema","error")}catch(y){let t="Error creating schema";if(y instanceof Error)if(y.message.includes("Validation error:"))try{const n=y.message.indexOf("{");if(n>=0){const a=y.message.substring(n),s=JSON.parse(a);t=Array.isArray(s)?s.map(e=>e.loc&&e.msg?"Field '"+e.loc.join(".")+"': "+e.msg:e.msg||String(e)).join(", "):"object"===typeof s?Object.entries(s).map(e=>{let[t,n]=e;return t+": "+n}).join(", "):JSON.stringify(s)}else t=y.message}catch(a){t=y.message}else t=y.message;else"string"===typeof y&&(t=y);F("Failed to create schema: "+t,"error")}}else R(e=>Object.assign({},e,{schema_definition:"Schema cannot be empty"}))},variant:"contained",color:"primary",children:"Create"})]})]}),(0,W.jsx)(u.A,{open:E.open,autoHideDuration:6e3,onClose:K,children:(0,W.jsx)(h.A,{onClose:K,severity:E.severity,children:E.message})})]})};var yo=n(58699),bo=n(55484);class vo{static async listAvailable(){try{var e,t;return null!=(e=null==(t=(await ve.uE.get("/group-tools/available")).data)?void 0:t.tools)?e:[]}catch(a){var n;throw new Error((null==(n=a.response)||null==(n=n.data)?void 0:n.detail)||"Error loading available tools")}}static async listAdded(){try{var e,t;return null!=(e=null==(t=(await ve.uE.get("/group-tools")).data)?void 0:t.items)?e:[]}catch(a){var n;throw new Error((null==(n=a.response)||null==(n=n.data)?void 0:n.detail)||"Error loading added tools")}}static async addTool(e){try{return(await ve.uE.post("/group-tools/"+e)).data}catch(n){var t;throw new Error((null==(t=n.response)||null==(t=t.data)?void 0:t.detail)||"Error adding tool to workspace")}}static async setEnabled(e,t){try{return(await ve.uE.patch("/group-tools/"+e+"/enabled",{enabled:t})).data}catch(a){var n;throw new Error((null==(n=a.response)||null==(n=n.data)?void 0:n.detail)||"Error updating enabled state")}}static async updateConfig(e,t){try{return(await ve.uE.patch("/group-tools/"+e+"/config",t)).data}catch(a){var n;throw new Error((null==(n=a.response)||null==(n=n.data)?void 0:n.detail)||"Error updating tool configuration")}}static async remove(e){try{await ve.uE.delete("/group-tools/"+e)}catch(n){var t;throw new Error((null==(t=n.response)||null==(t=t.data)?void 0:t.detail)||"Error removing tool from workspace")}}}var Ao=n(11625);function jo(e){let{ready:t,onClick:n}=e;return t?(0,W.jsx)(V.A,{size:"small",color:"success",icon:(0,W.jsx)(rt.A,{}),label:"Validated",variant:"outlined"}):(0,W.jsx)(V.A,{size:"small",color:"warning",icon:(0,W.jsx)(yo.A,{}),label:"Missing API key",onClick:n,clickable:!0,variant:"outlined"})}function wo(e){let{mode:t="auto"}=e;const{isSystemAdmin:n,userRole:a}=(0,Nn.o)(e=>({isSystemAdmin:e.isSystemAdmin,userRole:e.userRole})),u=(0,s.useMemo)(()=>n||"admin"===a,[n,a]),[m,p]=(0,s.useState)(!1),[x,f]=(0,s.useState)(""),[y,b]=(0,s.useState)(null),[v,A]=(0,s.useState)(null),[j,w]=(0,s.useState)(null),[k,C]=(0,s.useState)(!1),[S,_]=(0,s.useState)(null),E=()=>{p(!1),A(null),w(null),b(null)},[I,T]=(0,s.useState)(!0),[D,O]=(0,s.useState)([]),[N,P]=(0,s.useState)([]),[z,L]=(0,s.useState)([]),[R,F]=(0,s.useState)({}),[B,V]=(0,s.useState)([]),K=async()=>{T(!0);try{const[e,t,n]=await Promise.all([vo.listAvailable(),vo.listAdded(),We.getInstance().getAPIKeys()]);O(e),P(t),V(n),F(t=>{const n=Object.assign({},t);return e.forEach(e=>{n[e.id]=e}),n})}finally{T(!1)}},G=async()=>{T(!0);try{const e=await xt.m.listGlobal();L(e),F(t=>{const n=Object.assign({},t);return e.forEach(e=>{n[e.id]=e}),n})}finally{T(!1)}};(0,s.useEffect)(()=>{n&&G(),u&&K()},[n,u]),(0,s.useEffect)(()=>{const e=N.map(e=>e.tool_id).filter((e,t,n)=>n.indexOf(e)===t).filter(e=>!R[e]);0!==e.length&&(async()=>{const t=await Promise.all(e.map(e=>xt.m.getTool(e)));F(e=>{const n=Object.assign({},e);return t.forEach(e=>{e&&(n[e.id]=e)}),n})})()},[N,R]);const q=async(e,t)=>{const n=z.find(t=>t.id===e);if(n)return t?(_((e=>({id:String(e.id),title:e.title,description:e.description,icon:e.icon,config:e.config,category:"PreBuilt",enabled:e.enabled,group_id:e.group_id}))(n)),void C(!0)):void await J(e,t)},J=async(e,t)=>{await xt.m.setGlobalAvailability(e,t),await G()},X={4:"COMPOSIO_API_KEY",10:"EXA_API_KEY",12:"FIRECRAWL_API_KEY",13:"FIRECRAWL_API_KEY",14:"FIRECRAWL_API_KEY",16:"SERPER_API_KEY",31:"PERPLEXITY_API_KEY",45:"LINKUP_API_KEY"},Z=(0,s.useMemo)(()=>{const e={};return(B||[]).forEach(t=>{e[t.name]=t.value}),e},[B]);return I?(0,W.jsxs)(i.A,{sx:{display:"flex",alignItems:"center",justifyContent:"center",py:6},children:[(0,W.jsx)(Y.A,{size:24}),(0,W.jsx)(c.A,{variant:"body2",sx:{ml:1.5},children:"Loading tools\u2026"})]}):(0,W.jsxs)(is.A,{spacing:2,children:[n&&("auto"===t||"system"===t)&&(0,W.jsxs)(_e.A,{variant:"outlined",sx:{p:2},children:[(0,W.jsxs)(is.A,{direction:"row",alignItems:"center",spacing:1,mb:1,children:[(0,W.jsx)($i.A,{color:"primary",fontSize:"small"}),(0,W.jsx)(c.A,{variant:"subtitle1",children:"Global Tools (System Admin)"})]}),(0,W.jsx)(c.A,{variant:"body2",color:"text.secondary",sx:{mb:1},children:"These are the list of tools that will be allowed to be used within Kasal."}),(0,W.jsxs)(ue.Ay,{container:!0,spacing:2,children:[z.map(e=>(0,W.jsx)(ue.Ay,{item:!0,xs:12,md:6,lg:4,children:(0,W.jsx)(_e.A,{variant:"outlined",sx:{p:1.5},children:(0,W.jsxs)(is.A,{spacing:1,children:[(0,W.jsx)(c.A,{variant:"subtitle2",noWrap:!0,children:e.title}),(0,W.jsxs)(is.A,{direction:"row",spacing:1,alignItems:"center",sx:{flexWrap:"wrap"},children:[(0,W.jsx)(g.A,{size:"small",onClick:()=>(e=>{var t;w(e),f(JSON.stringify(null!=(t=e.config)?t:{},null,2)),b(null),p(!0)})(e),children:"Configure"}),(0,W.jsx)(he.A,{sx:{m:0},control:(0,W.jsx)(me.A,{size:"small",checked:!!e.enabled,onChange:t=>{q(e.id,t.target.checked)},inputProps:{"aria-label":"toggle-global-"+e.title}}),label:"Published"})]})]})})},e.id)),0===z.length&&(0,W.jsx)(ue.Ay,{item:!0,xs:12,children:(0,W.jsx)(c.A,{variant:"body2",color:"text.secondary",children:"No global tools defined."})})]})]}),u&&("auto"===t||"workspace"===t)&&(0,W.jsxs)(_e.A,{variant:"outlined",sx:{p:2},children:[(0,W.jsxs)(is.A,{direction:"row",alignItems:"center",spacing:1,mb:1,children:[(0,W.jsx)(bo.A,{color:"primary",fontSize:"small"}),(0,W.jsx)(c.A,{variant:"subtitle1",children:"Workspace Tools"})]}),(0,W.jsxs)(ue.Ay,{container:!0,spacing:2,children:[(0,W.jsxs)(ue.Ay,{item:!0,xs:12,md:6,children:[(0,W.jsx)(c.A,{variant:"subtitle2",sx:{mb:1},children:"Available to Add"}),(0,W.jsxs)(is.A,{spacing:1,children:[D.map(e=>(0,W.jsxs)(_e.A,{variant:"outlined",sx:{p:1.5,display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,W.jsx)(i.A,{children:(0,W.jsx)(c.A,{variant:"body2",children:e.title})}),(0,W.jsx)(g.A,{size:"small",startIcon:(0,W.jsx)($t.A,{}),onClick:()=>{(async e=>{await vo.addTool(e),await K()})(e.id)},children:"Add"})]},e.id)),0===D.length&&(0,W.jsx)(c.A,{variant:"body2",color:"text.secondary",children:"All globally published tools are already added."})]})]}),(0,W.jsxs)(ue.Ay,{item:!0,xs:12,md:6,children:[(0,W.jsx)(c.A,{variant:"subtitle2",sx:{mb:1},children:"Added in this Workspace"}),(0,W.jsxs)(is.A,{spacing:1,children:[N.map(e=>{var t,n;const a=(e=>{const t=X[e.tool_id];if(!t)return{ready:!0};const n=Z[t];return{ready:!!n&&"Not set"!==n&&""!==n.trim(),keyName:t}})(e);return(0,W.jsxs)(_e.A,{variant:"outlined",sx:{p:1.5,display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,W.jsxs)(i.A,{children:[(0,W.jsx)(c.A,{variant:"body2",children:null!=(t=null==(n=R[e.tool_id])?void 0:n.title)?t:"Tool #"+e.tool_id}),(0,W.jsx)(i.A,{sx:{mt:.5},children:(0,W.jsx)(jo,{ready:a.ready,onClick:a.ready?void 0:()=>(e=>{try{window.dispatchEvent(new CustomEvent("kasal:navigate-config",{detail:{section:"API Keys"}})),window.dispatchEvent(new CustomEvent("kasal:api-keys:set-tab",{detail:{tab:"local"}})),e&&window.dispatchEvent(new CustomEvent("kasal:api-keys:focus-key",{detail:{name:e}}))}catch(t){}})(a.keyName)})}),(0,W.jsxs)(c.A,{variant:"caption",color:"text.secondary",children:["Enabled: ",e.enabled?"Yes":"No"]})]}),(0,W.jsxs)(is.A,{direction:"row",spacing:1,alignItems:"center",children:[(0,W.jsx)(g.A,{size:"small",onClick:()=>(e=>{var t;A(e),f(JSON.stringify(null!=(t=e.config)?t:{},null,2)),b(null),p(!0)})(e),children:"Configure"}),(0,W.jsx)(M.A,{title:e.enabled?"Disable":"Enable",children:(0,W.jsx)(me.A,{checked:!!e.enabled,onChange:t=>{(async(e,t)=>{await vo.setEnabled(e,t),await K()})(e.tool_id,t.target.checked)}})}),(0,W.jsx)(M.A,{title:"Remove from workspace",children:(0,W.jsx)(d.A,{size:"small",onClick:()=>{(async e=>{await vo.remove(e),await K()})(e.tool_id)},children:(0,W.jsx)(Q.A,{fontSize:"small"})})})]})]},e.id)}),0===N.length&&(0,W.jsx)(c.A,{variant:"body2",color:"text.secondary",children:"No tools added to this workspace yet."})]})]})]})]}),!n&&!u&&(0,W.jsx)(c.A,{variant:"body2",color:"text.secondary",children:"You don\u2019t have permissions to manage tools."}),(0,W.jsx)(Ao.A,{open:k,onClose:()=>{C(!1),_(null)},onConfirm:async()=>{S&&await J(Number(S.id),!0),C(!1),_(null)},tool:S}),(0,W.jsxs)(o.A,{open:m,onClose:E,maxWidth:"md",fullWidth:!0,children:[(0,W.jsxs)(l.A,{children:["Configure Tool ",j?"#"+j.id+" ("+j.title+")":v?"#"+v.tool_id:""]}),(0,W.jsxs)(r.A,{children:[y&&(0,W.jsx)(i.A,{sx:{mb:1},children:(0,W.jsx)(h.A,{severity:"error",children:y})}),(0,W.jsx)(U.A,{label:"Workspace Configuration (JSON)",value:x,onChange:e=>f(e.target.value),multiline:!0,minRows:10,fullWidth:!0,placeholder:'{\n  "apiKey": "..." \n}',sx:{mt:2}})]}),(0,W.jsxs)(H.A,{children:[(0,W.jsx)(g.A,{onClick:E,children:"Cancel"}),(0,W.jsx)(g.A,{variant:"contained",onClick:()=>{(async()=>{try{const e=x.trim()?JSON.parse(x):{};if(j)await xt.m.updateTool(j.id,{config:e}),await G();else{if(!v)return;await vo.updateConfig(v.tool_id,e),await K()}E()}catch(t){var e;b(null!=(e=null==t?void 0:t.message)?e:"Invalid JSON")}})()},children:"Save"})]})]})]})}var ko=n(50971);class Co{constructor(){this.baseUrl="/templates"}static getInstance(){return Co.instance||(Co.instance=new Co),Co.instance}async getAllPrompts(){try{return(await ve.Ay.get(this.baseUrl)).data}catch(e){throw e}}async getPromptById(e){try{return(await ve.Ay.get(this.baseUrl+"/"+e)).data}catch(t){throw t}}async getPromptByName(e){try{return(await ve.Ay.get(this.baseUrl+"/by-name/"+e)).data}catch(t){throw t}}async updatePrompt(e,t){try{return(await ve.Ay.put(this.baseUrl+"/"+e,t)).data}catch(n){throw n}}async resetPromptTemplates(){try{return(await ve.Ay.post(this.baseUrl+"/reset")).data}catch(e){throw e}}}Co.instance=void 0;const So=()=>{const{t:e}=(0,b.Bd)(),[t,n]=(0,s.useState)([]),[a,m]=(0,s.useState)(!0),[p,x]=(0,s.useState)(!1),[f,y]=(0,s.useState)(null),[v,A]=(0,s.useState)(""),[j,w]=(0,s.useState)(!1),[k,C]=(0,s.useState)({open:!1,message:"",severity:"success"});(0,s.useEffect)(()=>{S()},[]);const S=async()=>{m(!0);try{const e=Co.getInstance(),t=await e.getAllPrompts();n(t)}catch(e){C({open:!0,message:"Failed to load prompt instructions",severity:"error"})}finally{m(!1)}},_=()=>{x(!1),y(null),A("")},E=()=>{C(Object.assign({},k,{open:!1}))};return a?(0,W.jsx)(i.A,{display:"flex",justifyContent:"center",alignItems:"center",height:"300px",children:(0,W.jsx)(Y.A,{})}):(0,W.jsxs)(i.A,{children:[(0,W.jsx)(c.A,{variant:"h6",gutterBottom:!0,children:e("configuration.prompts.title",{defaultValue:"Prompt Instructions"})}),(0,W.jsx)(c.A,{variant:"body2",color:"textSecondary",paragraph:!0,children:e("configuration.prompts.description",{defaultValue:"Edit the system prompt instructions used by Kasal agents."})}),(0,W.jsx)(i.A,{display:"flex",justifyContent:"flex-end",mb:2,children:(0,W.jsx)(g.A,{startIcon:(0,W.jsx)(ko.A,{}),variant:"outlined",color:"primary",onClick:()=>w(!0),children:e("configuration.prompts.resetToDefault",{defaultValue:"Reset to Default"})})}),(0,W.jsx)(_e.A,{elevation:2,sx:{mt:2},children:(0,W.jsxs)(at.A,{children:[t.map(e=>(0,W.jsxs)(s.Fragment,{children:[(0,W.jsx)(st.Ay,{secondaryAction:(0,W.jsx)(d.A,{edge:"end",onClick:()=>(e=>{y(e),A(e.template),x(!0)})(e),children:(0,W.jsx)(Z.A,{})}),children:(0,W.jsx)(ot.A,{primary:e.name,secondary:e.description||"No description"})}),(0,W.jsx)(ne.A,{})]},e.id)),0===t.length&&(0,W.jsx)(st.Ay,{children:(0,W.jsx)(ot.A,{primary:"No prompt instructions found"})})]})}),(0,W.jsxs)(o.A,{open:p,onClose:_,fullWidth:!0,maxWidth:"md",children:[(0,W.jsx)(l.A,{children:e("configuration.prompts.editTitle",{defaultValue:"Edit Prompt Template"})}),(0,W.jsx)(r.A,{children:f&&(0,W.jsxs)(W.Fragment,{children:[(0,W.jsxs)(i.A,{sx:{mb:2,mt:1},children:[(0,W.jsx)(c.A,{variant:"subtitle1",fontWeight:"bold",children:f.name}),f.description&&(0,W.jsx)(c.A,{variant:"body2",color:"textSecondary",children:f.description})]}),(0,W.jsx)(U.A,{label:e("configuration.prompts.template",{defaultValue:"Template"}),multiline:!0,rows:15,fullWidth:!0,value:v,onChange:e=>A(e.target.value),variant:"outlined"})]})}),(0,W.jsxs)(H.A,{children:[(0,W.jsx)(g.A,{onClick:_,children:e("common.cancel",{defaultValue:"Cancel"})}),(0,W.jsx)(g.A,{onClick:async()=>{if(f)try{const e=Co.getInstance();await e.updatePrompt(f.id,Object.assign({},f,{template:v})),n(t.map(e=>e.id===f.id?Object.assign({},e,{template:v,updated_at:(new Date).toISOString()}):e)),C({open:!0,message:"Prompt template updated successfully",severity:"success"}),_()}catch(e){C({open:!0,message:"Failed to update prompt template",severity:"error"})}},variant:"contained",color:"primary",children:e("common.save",{defaultValue:"Save"})})]})]}),(0,W.jsx)(u.A,{open:k.open,autoHideDuration:6e3,onClose:E,anchorOrigin:{vertical:"bottom",horizontal:"center"},children:(0,W.jsx)(h.A,{onClose:E,severity:k.severity,variant:"filled",children:k.message})}),(0,W.jsxs)(o.A,{open:j,onClose:()=>w(!1),children:[(0,W.jsx)(l.A,{children:e("configuration.prompts.resetConfirmTitle",{defaultValue:"Reset Prompt Instructions"})}),(0,W.jsx)(r.A,{children:(0,W.jsx)(c.A,{children:e("configuration.prompts.resetConfirmMessage",{defaultValue:"Are you sure you want to reset all prompt instructions to their default values? This action cannot be undone."})})}),(0,W.jsxs)(H.A,{children:[(0,W.jsx)(g.A,{onClick:()=>w(!1),children:e("common.cancel",{defaultValue:"Cancel"})}),(0,W.jsx)(g.A,{onClick:async()=>{w(!1),m(!0);try{const e=Co.getInstance(),t=await e.resetPromptTemplates();C({open:!0,message:"Successfully reset "+t.reset_count+" prompt instructions to default values",severity:"success"}),await S()}catch(e){C({open:!0,message:"Failed to reset prompt instructions",severity:"error"}),m(!1)}},variant:"contained",color:"primary",autoFocus:!0,children:e("configuration.prompts.confirmReset",{defaultValue:"Reset"})})]})]})]})};var _o=n(93153);const Eo=e=>{let{onSaved:t}=e;const{t:n}=(0,b.Bd)(),[a,o]=(0,s.useState)({workspace_url:"",warehouse_id:"",catalog:"",schema:"",enabled:!1,mlflow_enabled:!1,mlflow_experiment_name:"kasal-crew-execution-traces",evaluation_enabled:!1,evaluation_judge_model:"",volume_enabled:!1,volume_path:"main.default.task_outputs",volume_file_format:"json",volume_create_date_dirs:!0,knowledge_volume_enabled:!1,knowledge_volume_path:"main.default.knowledge",knowledge_chunk_size:1e3,knowledge_chunk_overlap:200}),[r,l]=(0,s.useState)(!1),[d,m]=(0,s.useState)(null),[p,x]=(0,s.useState)({open:!1,message:"",severity:"success"}),[f,y]=(0,s.useState)(null),[v,A]=(0,s.useState)(!1),[j,w]=(0,s.useState)(!1),[k,C]=(0,s.useState)(null),[S,_]=(0,s.useState)("");(0,s.useEffect)(()=>{(async()=>{try{const s=ke.O.getInstance();try{const e=await s.getDatabricksEnvironment();e.databricks_host&&_(e.databricks_host)}catch(n){}const i=await s.getDatabricksConfig();if(i){if(o(i),i.enabled){const e=await s.checkPersonalTokenRequired();m(e)}const n=36;try{const a=(await xt.m.listTools()).find(e=>e.id===n);if(a){var e,t;const s=await ms.getConfig(),o=s&&fs(s)&&s.backend_type===gs.DATABRICKS&&(null==(e=s.databricks_config)?void 0:e.endpoint_name)&&(null==(t=s.databricks_config)?void 0:t.short_term_index),r=i.enabled&&i.knowledge_volume_enabled&&o;a.enabled!==r&&await xt.m.toggleToolEnabled(n)}}catch(a){}}}catch(n){}})(),(async()=>{try{const n=await ms.getConfig();if(n&&fs(n)){var e,t;const a=n.backend_type===gs.DATABRICKS&&(null==(e=n.databricks_config)?void 0:e.endpoint_name)&&(null==(t=n.databricks_config)?void 0:t.short_term_index);w(!!a),C(n.backend_type)}else w(!1),C(null)}catch(n){w(!1),C(null)}})()},[]);const E=e=>t=>{o(n=>Object.assign({},n,{[e]:t.target.value}))},I=()=>{x(Object.assign({},p,{open:!1}))};return(0,W.jsxs)(i.A,{children:[(0,W.jsxs)(i.A,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",mb:2},children:[(0,W.jsx)(c.A,{variant:"subtitle1",fontWeight:"medium",children:n("configuration.databricks.title")}),(0,W.jsx)(he.A,{control:(0,W.jsx)(me.A,{checked:a.enabled,onChange:async e=>{const t=e.target.checked;if(o(e=>Object.assign({},e,{enabled:t})),t)try{const e=ke.O.getInstance(),t=await e.checkPersonalTokenRequired();m(t)}catch(n){}else m(null)},color:"primary"}),label:a.enabled?n("common.enabled"):n("common.disabled")})]}),d&&d.personal_token_required&&(0,W.jsx)(h.A,{severity:"warning",sx:{mb:2},children:d.message}),(0,W.jsxs)(is.A,{spacing:2,sx:{mb:3},children:[(0,W.jsx)(ne.A,{sx:{my:2}}),(0,W.jsxs)(i.A,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[(0,W.jsx)(c.A,{variant:"subtitle2",color:"text.secondary",children:n("configuration.databricks.mlflow.title",{defaultValue:"MLflow Tracking"})}),(0,W.jsx)(he.A,{control:(0,W.jsx)(me.A,{checked:!!a.mlflow_enabled,onChange:async e=>{const t=e.target.checked;o(e=>Object.assign({},e,{mlflow_enabled:t}));try{await ve.Ay.post("/mlflow/status",{enabled:t})}catch(s){var a;404===(null==s||null==(a=s.response)?void 0:a.status)&&x({open:!0,message:n("configuration.databricks.mlflow.saveFirst",{defaultValue:"Please save Databricks settings first to persist MLflow."}),severity:"error"})}},color:"primary",disabled:!a.enabled}),label:a.mlflow_enabled?n("common.enabled"):n("common.disabled")})]}),a.mlflow_enabled&&(0,W.jsx)(U.A,{label:n("configuration.databricks.mlflow.experimentName",{defaultValue:"MLflow Experiment Name"}),value:a.mlflow_experiment_name||"kasal-crew-execution-traces",onChange:E("mlflow_experiment_name"),fullWidth:!0,disabled:r||!a.enabled||!a.mlflow_enabled,size:"small",placeholder:"kasal-crew-execution-traces",helperText:n("configuration.databricks.mlflow.experimentNameHelp",{defaultValue:"Name of the MLflow experiment for crew execution traces"})}),a.mlflow_enabled&&(0,W.jsxs)(i.A,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",mt:1},children:[(0,W.jsx)(c.A,{variant:"subtitle2",color:"text.secondary",children:n("configuration.databricks.evaluation.title",{defaultValue:"MLflow Evaluation"})}),(0,W.jsx)(he.A,{control:(0,W.jsx)(me.A,{checked:!!a.evaluation_enabled,onChange:async e=>{const t=e.target.checked;o(e=>Object.assign({},e,{evaluation_enabled:t}));try{await ve.Ay.post("/mlflow/evaluation-status",{enabled:t})}catch(s){var a;404===(null==s||null==(a=s.response)?void 0:a.status)&&x({open:!0,message:n("configuration.databricks.mlflow.saveFirst",{defaultValue:"Please save Databricks settings first to persist MLflow Evaluation."}),severity:"error"})}},color:"primary",disabled:!a.enabled||!a.mlflow_enabled}),label:a.evaluation_enabled?n("common.enabled"):n("common.disabled")}),a.mlflow_enabled&&a.evaluation_enabled&&(0,W.jsx)(U.A,{sx:{mt:1},label:n("configuration.databricks.evaluation.judgeModel",{defaultValue:"Databricks Judge Endpoint (databricks:/...)"}),value:a.evaluation_judge_model||"",onChange:E("evaluation_judge_model"),fullWidth:!0,disabled:r||!a.enabled,size:"small",placeholder:"databricks:/your-judge-endpoint",helperText:n("configuration.databricks.evaluation.judgeModelHelp",{defaultValue:"Route for the judge model served on Databricks. Must start with databricks:/. Used to score evaluations."})})]}),(0,W.jsx)(ne.A,{sx:{my:2}}),(0,W.jsx)(U.A,{label:n("configuration.databricks.workspaceUrl"),value:S||a.workspace_url,onChange:E("workspace_url"),fullWidth:!0,disabled:!0,size:"small",helperText:n("configuration.databricks.workspaceUrl.info",{defaultValue:"Workspace URL is automatically configured from backend (DATABRICKS_HOST environment variable)"})}),(0,W.jsx)(U.A,{label:n("configuration.databricks.warehouseId"),value:a.warehouse_id,onChange:E("warehouse_id"),fullWidth:!0,disabled:r||!a.enabled,size:"small",required:!0}),(0,W.jsx)(U.A,{label:n("configuration.databricks.catalog"),value:a.catalog,onChange:E("catalog"),fullWidth:!0,disabled:r||!a.enabled,size:"small",required:!0}),(0,W.jsx)(U.A,{label:n("configuration.databricks.schema"),value:a.schema,onChange:E("schema"),fullWidth:!0,disabled:r||!a.enabled,size:"small",required:!0})]}),(0,W.jsx)(ne.A,{sx:{my:3}}),(0,W.jsxs)(i.A,{sx:{mb:3},children:[(0,W.jsxs)(i.A,{sx:{display:"flex",alignItems:"center",mb:2},children:[(0,W.jsx)(et.A,{sx:{mr:1,color:"primary.main"}}),(0,W.jsx)(c.A,{variant:"subtitle1",fontWeight:"medium",children:n("configuration.databricks.volume.title",{defaultValue:"Volume Uploads Configuration"})})]}),(0,W.jsx)(h.A,{severity:"info",sx:{mb:2},children:n("configuration.databricks.volume.description",{defaultValue:"Configure Databricks Volume settings for task outputs. When enabled, all task outputs will be automatically uploaded to the specified volume path. Tasks can override these settings individually."})}),(0,W.jsxs)(is.A,{spacing:2,children:[(0,W.jsx)(he.A,{control:(0,W.jsx)(me.A,{checked:a.volume_enabled||!1,onChange:e=>o(t=>Object.assign({},t,{volume_enabled:e.target.checked})),color:"primary",disabled:!a.enabled}),label:(0,W.jsxs)(i.A,{children:[(0,W.jsx)(c.A,{variant:"body1",children:n("configuration.databricks.volume.enable",{defaultValue:"Enable Volume Uploads for All Tasks"})}),(0,W.jsx)(c.A,{variant:"caption",color:"text.secondary",children:n("configuration.databricks.volume.enableDescription",{defaultValue:"Automatically upload task outputs to Databricks Volumes"})})]})}),(0,W.jsx)(U.A,{label:n("configuration.databricks.volume.path",{defaultValue:"Volume Path"}),value:a.volume_path||"main.default.task_outputs",onChange:e=>o(t=>Object.assign({},t,{volume_path:e.target.value})),fullWidth:!0,disabled:r||!a.enabled||!a.volume_enabled,size:"small",helperText:n("configuration.databricks.volume.pathHelp",{defaultValue:"Format: catalog.schema.volume (e.g., main.default.task_outputs)"}),placeholder:"catalog.schema.volume"}),(0,W.jsxs)(re.A,{fullWidth:!0,size:"small",disabled:r||!a.enabled||!a.volume_enabled,children:[(0,W.jsx)(le.A,{children:n("configuration.databricks.volume.format",{defaultValue:"Default File Format"})}),(0,W.jsxs)(ce.A,{value:a.volume_file_format||"json",onChange:e=>o(t=>Object.assign({},t,{volume_file_format:e.target.value})),label:n("configuration.databricks.volume.format",{defaultValue:"Default File Format"}),children:[(0,W.jsx)(de.A,{value:"json",children:"JSON"}),(0,W.jsx)(de.A,{value:"csv",children:"CSV"}),(0,W.jsx)(de.A,{value:"txt",children:"Text"})]})]}),(0,W.jsx)(he.A,{control:(0,W.jsx)(me.A,{checked:!1!==a.volume_create_date_dirs,onChange:e=>o(t=>Object.assign({},t,{volume_create_date_dirs:e.target.checked})),color:"primary",disabled:!a.enabled||!a.volume_enabled}),label:(0,W.jsxs)(i.A,{children:[(0,W.jsx)(c.A,{variant:"body1",children:n("configuration.databricks.volume.dateDirs",{defaultValue:"Create Date-based Directories"})}),(0,W.jsx)(c.A,{variant:"caption",color:"text.secondary",children:n("configuration.databricks.volume.dateDirsDescription",{defaultValue:"Organize outputs in YYYY/MM/DD folder structure"})})]})}),a.volume_enabled&&a.enabled&&(0,W.jsxs)(h.A,{severity:"info",children:[(0,W.jsx)(c.A,{variant:"body2",sx:{mb:1},children:(0,W.jsx)("strong",{children:n("configuration.databricks.volume.example",{defaultValue:"Example output path:"})})}),(0,W.jsxs)(c.A,{variant:"body2",component:"code",sx:{display:"block",p:1,bgcolor:"grey.100",borderRadius:1,fontFamily:"monospace",fontSize:"0.875rem"},children:["/Volumes/",(a.volume_path||"main.default.task_outputs").replace(/\./g,"/"),"/[execution_name]",a.volume_create_date_dirs&&"/YYYY/MM/DD","/task_output.",a.volume_file_format||"json"]}),(0,W.jsx)(c.A,{variant:"caption",color:"text.secondary",sx:{mt:1,display:"block"},children:n("configuration.databricks.volume.executionNote",{defaultValue:"Note: [execution_name] will be replaced with the actual execution or run name"})})]})]})]}),(0,W.jsx)(ne.A,{sx:{my:3}}),(0,W.jsxs)(i.A,{sx:{mb:3},children:[(0,W.jsxs)(i.A,{sx:{display:"flex",alignItems:"center",mb:2},children:[(0,W.jsx)(et.A,{sx:{mr:1,color:"secondary.main"}}),(0,W.jsx)(c.A,{variant:"subtitle1",fontWeight:"medium",children:n("configuration.databricks.knowledge.title",{defaultValue:"Knowledge Source Volume Configuration"})})]}),(0,W.jsx)(h.A,{severity:"info",sx:{mb:2},children:n("configuration.databricks.knowledge.description",{defaultValue:"Configure Databricks Volume settings for knowledge sources (RAG). When enabled, uploaded knowledge files will be stored in the specified volume and made available to AI agents during execution."})}),(0,W.jsxs)(is.A,{spacing:2,children:[(0,W.jsx)(M.A,{title:j?"":"Knowledge sources require Databricks Vector Search memory backend configuration. "+(k===gs.DEFAULT?"ChromaDB backend does not support knowledge sources.":"Vector Search backend is not properly configured."),placement:"right",arrow:!0,children:(0,W.jsx)(he.A,{control:(0,W.jsx)(me.A,{checked:a.knowledge_volume_enabled||!1,onChange:e=>o(t=>Object.assign({},t,{knowledge_volume_enabled:e.target.checked})),color:"secondary",disabled:!a.enabled||!j}),label:(0,W.jsxs)(i.A,{children:[(0,W.jsx)(c.A,{variant:"body1",color:j?"inherit":"text.disabled",children:n("configuration.databricks.knowledge.enable",{defaultValue:"Enable Knowledge Source Volume"})}),(0,W.jsx)(c.A,{variant:"caption",color:j?"text.secondary":"text.disabled",children:n("configuration.databricks.knowledge.enableDescription",{defaultValue:"Store and retrieve knowledge files from Databricks Volumes for RAG"})}),!j&&(0,W.jsx)(c.A,{variant:"caption",color:"warning.main",sx:{display:"block",mt:.5},children:"\u26a0\ufe0f Requires memory backend configuration (Vector Search or default ChromaDB)"})]})})}),(0,W.jsx)(U.A,{label:n("configuration.databricks.knowledge.path",{defaultValue:"Knowledge Volume Path"}),value:a.knowledge_volume_path||"main.default.knowledge",onChange:e=>o(t=>Object.assign({},t,{knowledge_volume_path:e.target.value})),fullWidth:!0,disabled:r||!a.enabled||!a.knowledge_volume_enabled||!j,size:"small",helperText:n("configuration.databricks.knowledge.pathHelp",{defaultValue:"Format: catalog.schema.volume (e.g., main.default.knowledge)"}),placeholder:"catalog.schema.volume"}),(0,W.jsx)(U.A,{label:n("configuration.databricks.knowledge.chunkSize",{defaultValue:"Chunk Size"}),value:a.knowledge_chunk_size||1e3,onChange:e=>o(t=>Object.assign({},t,{knowledge_chunk_size:parseInt(e.target.value)||1e3})),fullWidth:!0,disabled:r||!a.enabled||!a.knowledge_volume_enabled||!j,size:"small",type:"number",helperText:n("configuration.databricks.knowledge.chunkSizeHelp",{defaultValue:"Size of text chunks for knowledge processing (default: 1000 characters)"})}),(0,W.jsx)(U.A,{label:n("configuration.databricks.knowledge.chunkOverlap",{defaultValue:"Chunk Overlap"}),value:a.knowledge_chunk_overlap||200,onChange:e=>o(t=>Object.assign({},t,{knowledge_chunk_overlap:parseInt(e.target.value)||200})),fullWidth:!0,disabled:r||!a.enabled||!a.knowledge_volume_enabled||!j,size:"small",type:"number",helperText:n("configuration.databricks.knowledge.chunkOverlapHelp",{defaultValue:"Overlap between chunks to maintain context (default: 200 characters)"})}),a.knowledge_volume_enabled&&a.enabled&&(0,W.jsxs)(_e.A,{elevation:0,sx:{p:2,bgcolor:"grey.50"},children:[(0,W.jsx)(c.A,{variant:"body2",sx:{mb:1},children:(0,W.jsx)("strong",{children:n("configuration.databricks.knowledge.structure",{defaultValue:"Knowledge files will be organized as:"})})}),(0,W.jsxs)(c.A,{variant:"body2",component:"code",sx:{display:"block",p:1,bgcolor:"white",border:"1px solid",borderColor:"grey.300",borderRadius:1,fontFamily:"monospace",fontSize:"0.875rem"},children:["/Volumes/",(a.knowledge_volume_path||"main.default.knowledge").replace(/\./g,"/"),"/[group_id]/[execution_id]/[files]"]}),(0,W.jsx)(c.A,{variant:"caption",color:"text.secondary",sx:{mt:1,display:"block"},children:n("configuration.databricks.knowledge.structureNote",{defaultValue:"Files are organized by group and execution ID for proper isolation and access control"})})]})]})]}),(0,W.jsxs)(i.A,{sx:{display:"flex",justifyContent:"space-between",mt:2,mb:2},children:[(0,W.jsx)(g.A,{variant:"outlined",startIcon:v?(0,W.jsx)(Y.A,{size:18}):null,onClick:async()=>{A(!0);try{const e=ke.O.getInstance(),t=await e.checkDatabricksConnection();y(t)}catch(e){x({open:!0,message:e instanceof Error?e.message:"Failed to check Databricks connection",severity:"error"})}finally{A(!1)}},disabled:v||!a.enabled,size:"medium",children:v?n("common.checking"):n("configuration.databricks.checkConnection",{defaultValue:"Check Connection"})}),(0,W.jsx)(g.A,{variant:"contained",startIcon:r?(0,W.jsx)(Y.A,{size:18}):(0,W.jsx)(oo.A,{fontSize:"small"}),onClick:async()=>{if(a.enabled){var e,s,i;const t={"Warehouse ID":null==(e=a.warehouse_id)?void 0:e.trim(),Catalog:null==(s=a.catalog)?void 0:s.trim(),Schema:null==(i=a.schema)?void 0:i.trim()},n=Object.entries(t).filter(e=>{let[t,n]=e;return!n}).map(e=>{let[t]=e;return t});if(n.length>0)return void x({open:!0,message:"Please fill in all required fields: "+n.join(", "),severity:"error"})}l(!0);try{const e=ke.O.getInstance(),s=Object.assign({},a,{workspace_url:S||a.workspace_url}),i=await e.setDatabricksConfig(s);o(i);const l=36;try{const e=(await xt.m.listTools()).find(e=>e.id===l);if(e){const t=i.enabled&&i.knowledge_volume_enabled&&j;e.enabled!==t&&await xt.m.toggleToolEnabled(l)}}catch(r){}const{refreshConfiguration:c}=ys.getState();if(c(),window.dispatchEvent(new CustomEvent("databricks-config-updated",{detail:{config:i}})),i.enabled){const t=await e.checkPersonalTokenRequired();m(t)}else m(null);x({open:!0,message:n("configuration.databricks.saved",{defaultValue:"Databricks configuration saved successfully"}),severity:"success"}),t&&t()}catch(c){x({open:!0,message:c instanceof Error?c.message:"Failed to save Databricks configuration",severity:"error"})}finally{l(!1)}},disabled:r,size:"medium",children:n(r?"common.loading":"common.save")})]}),f&&(0,W.jsx)(h.A,{severity:f.connected?"success":"error",sx:{mb:2},icon:f.connected?(0,W.jsx)(_o.A,{}):void 0,children:f.message}),(0,W.jsx)(u.A,{open:p.open,autoHideDuration:6e3,onClose:I,anchorOrigin:{vertical:"bottom",horizontal:"center"},children:(0,W.jsx)(h.A,{onClose:I,severity:p.severity,sx:{width:"100%"},children:p.message})})]})};var Io=n(23647);class To{static async getEngineConfigs(){return(await ve.uE.get(""+this.baseUrl)).data}static async getEnabledEngineConfigs(){return(await ve.uE.get(this.baseUrl+"/enabled")).data}static async getEngineConfig(e){return(await ve.uE.get(this.baseUrl+"/engine/"+e)).data}static async getEngineConfigByKey(e,t){return(await ve.uE.get(this.baseUrl+"/engine/"+e+"/config/"+t)).data}static async getCrewAIFlowEnabled(){return(await ve.uE.get(this.baseUrl+"/crewai/flow-enabled")).data}static async setCrewAIFlowEnabled(e){return(await ve.uE.patch(this.baseUrl+"/crewai/flow-enabled",{flow_enabled:e})).data}static async getCrewAIDebugTracing(){return(await ve.uE.get(this.baseUrl+"/crewai/debug-tracing")).data}static async setCrewAIDebugTracing(e){return(await ve.uE.patch(this.baseUrl+"/crewai/debug-tracing",{debug_tracing:e})).data}static async toggleEngineEnabled(e,t){return(await ve.uE.patch(this.baseUrl+"/engine/"+e+"/toggle",{enabled:t})).data}static async updateConfigValue(e,t,n){return(await ve.uE.patch(this.baseUrl+"/engine/"+e+"/config/"+t+"/value",{config_value:n})).data}}To.baseUrl="/engine-config";const Do=()=>{const{crewAIFlowEnabled:e,setCrewAIFlowEnabled:t}=(0,C.d)(),{inputMode:n,setInputMode:a}=(0,v.E)(),[o,r]=(0,s.useState)(!1),[l,d]=(0,s.useState)(null),[u,m]=(0,s.useState)(!1),[g,p]=(0,s.useState)(!1),[x,f]=(0,s.useState)(!1);(0,s.useEffect)(()=>{(async()=>{try{r(!0);const[e,n]=await Promise.all([To.getCrewAIFlowEnabled(),To.getCrewAIDebugTracing()]);t(e.flow_enabled),f(n.debug_tracing)}catch(e){d("Failed to load configuration from server")}finally{r(!1)}})()},[t]);return o?(0,W.jsxs)(i.A,{sx:{display:"flex",justifyContent:"center",alignItems:"center",minHeight:200},children:[(0,W.jsx)(Y.A,{}),(0,W.jsx)(c.A,{variant:"body2",sx:{ml:2},children:"Loading engine configuration..."})]}):(0,W.jsxs)(i.A,{children:[(0,W.jsxs)(i.A,{sx:{display:"flex",alignItems:"center",mb:3},children:[(0,W.jsx)(to.A,{sx:{mr:1,color:"primary.main",fontSize:"1.2rem"}}),(0,W.jsx)(c.A,{variant:"h6",fontWeight:"medium",children:"Engines Configuration"})]}),l&&(0,W.jsx)(h.A,{severity:"error",sx:{mb:3},children:l}),(0,W.jsx)(h.A,{severity:"info",sx:{mb:3},children:"Configure execution engines and their features. Disabling features will hide related UI components."}),(0,W.jsxs)(_e.A,{sx:{p:2,mb:2},elevation:1,children:[(0,W.jsxs)(i.A,{sx:{display:"flex",alignItems:"center",mb:2},children:[(0,W.jsx)(Ns.A,{sx:{mr:1,color:"primary.main",fontSize:"1.1rem"}}),(0,W.jsx)(c.A,{variant:"subtitle1",fontWeight:"medium",children:"CrewAI Engine"})]}),(0,W.jsx)(ne.A,{sx:{mb:2}}),(0,W.jsxs)(is.A,{spacing:2,children:[(0,W.jsx)(i.A,{children:(0,W.jsx)(he.A,{control:(0,W.jsxs)(i.A,{sx:{display:"flex",alignItems:"center"},children:[(0,W.jsx)(me.A,{checked:e,onChange:async e=>{const n=e.target.checked;try{m(!0),d(null),await To.setCrewAIFlowEnabled(n),t(n)}catch(a){d("Failed to save configuration to server"),e.target.checked=!n}finally{m(!1)}},color:"primary",disabled:u}),u&&(0,W.jsx)(Y.A,{size:16,sx:{ml:1}})]}),label:(0,W.jsxs)(i.A,{children:[(0,W.jsx)(c.A,{variant:"body2",fontWeight:"medium",children:"Enable Flow Feature"}),(0,W.jsx)(c.A,{variant:"caption",color:"text.secondary",children:"Toggle flow execution capabilities, flow panels, and flow-related UI components"})]})})}),!e&&(0,W.jsxs)(h.A,{severity:"warning",sx:{mt:1},children:["Flow feature is disabled. The following UI components will be hidden:",(0,W.jsxs)("ul",{style:{margin:"8px 0 0 16px",paddingLeft:"16px"},children:[(0,W.jsx)("li",{children:"Execute Flow button"}),(0,W.jsx)("li",{children:"Flow Panel"}),(0,W.jsx)("li",{children:"Add Flow button"})]})]}),(0,W.jsx)(i.A,{children:(0,W.jsx)(he.A,{control:(0,W.jsxs)(i.A,{sx:{display:"flex",alignItems:"center"},children:[(0,W.jsx)(me.A,{checked:x,onChange:async e=>{const t=e.target.checked;try{p(!0),d(null),await To.setCrewAIDebugTracing(t),f(t)}catch(n){d("Failed to save configuration to server"),e.target.checked=!t}finally{p(!1)}},color:"primary",disabled:g}),g&&(0,W.jsx)(Y.A,{size:16,sx:{ml:1}})]}),label:(0,W.jsxs)(i.A,{children:[(0,W.jsx)(c.A,{variant:"body2",fontWeight:"medium",children:"Enable Debug Tracing"}),(0,W.jsx)(c.A,{variant:"caption",color:"text.secondary",children:"When enabled, store detailed trace events (memory, knowledge, reasoning, guardrails). When disabled, only essential events are stored."})]})})})]})]}),(0,W.jsx)(_e.A,{elevation:1,sx:{p:3,mt:3},children:(0,W.jsxs)(is.A,{spacing:2,children:[(0,W.jsxs)(i.A,{sx:{display:"flex",alignItems:"center",mb:2},children:[(0,W.jsx)(Ns.A,{sx:{mr:1,color:"primary.main",fontSize:"1.2rem"}}),(0,W.jsx)(c.A,{variant:"subtitle1",fontWeight:"medium",children:"Input Variables Collection"})]}),(0,W.jsxs)(re.A,{component:"fieldset",children:[(0,W.jsx)(qt.A,{component:"legend",children:(0,W.jsx)(c.A,{variant:"body2",color:"text.secondary",sx:{mb:1},children:"Choose how to collect input variables when executing workflows with variables"})}),(0,W.jsxs)(Jt.A,{value:n,onChange:e=>a(e.target.value),children:[(0,W.jsx)(he.A,{value:"dialog",control:(0,W.jsx)(Yt.A,{color:"primary"}),label:(0,W.jsxs)(i.A,{sx:{display:"flex",alignItems:"center"},children:[(0,W.jsx)(Io.A,{sx:{mr:1,fontSize:"1rem"}}),(0,W.jsxs)(i.A,{children:[(0,W.jsx)(c.A,{variant:"body2",fontWeight:"medium",children:"Dialog Mode"}),(0,W.jsx)(c.A,{variant:"caption",color:"text.secondary",children:"Show a popup dialog to collect all variable values before execution"})]})]})}),(0,W.jsx)(he.A,{value:"chat",control:(0,W.jsx)(Yt.A,{color:"primary"}),label:(0,W.jsxs)(i.A,{sx:{display:"flex",alignItems:"center"},children:[(0,W.jsx)(rs.A,{sx:{mr:1,fontSize:"1rem"}}),(0,W.jsxs)(i.A,{children:[(0,W.jsx)(c.A,{variant:"body2",fontWeight:"medium",children:"Chat Mode"}),(0,W.jsx)(c.A,{variant:"caption",color:"text.secondary",children:"Collect variable values through conversational prompts in the chat (Coming Soon)"})]})]})})]})]}),(0,W.jsx)(h.A,{severity:"info",sx:{mt:2},children:"dialog"===n?"When variables are detected in your workflow, a dialog will appear to collect all values at once.":"When variables are detected, the chat will guide you through providing values one by one."})]})})]})},Oo=(0,A.vt)((e,t)=>({config:ps,isLoading:!1,error:null,connectionTestResult:null,isTestingConnection:!1,availableIndexes:[],isLoadingIndexes:!1,validationErrors:[],visualizationOpen:!1,visualizationIndex:null,setConfig:t=>e({config:t,error:null}),updateConfig:t=>e(e=>({config:Object.assign({},e.config,t),error:null})),updateDatabricksConfig:t=>e(e=>({config:Object.assign({},e.config,{databricks_config:Object.assign({},e.config.databricks_config||xs,t)}),error:null})),validateConfig:async()=>{const{config:n}=t();e({isLoading:!0,error:null,validationErrors:[]});try{const t=await ms.validateConfig(n);return e({validationErrors:t.errors||[],isLoading:!1}),t.valid}catch(a){const t=(a instanceof Error?a.message:String(a))||"Failed to validate configuration";return e({error:t,validationErrors:[t],isLoading:!1}),!1}},testDatabricksConnection:async()=>{const{config:n}=t();if(n.backend_type!==gs.DATABRICKS||!n.databricks_config){const t={success:!1,message:"Databricks configuration not set"};return e({connectionTestResult:t}),t}e({isTestingConnection:!0,connectionTestResult:null,error:null});try{const t=await ms.testDatabricksConnection(n.databricks_config);return e({connectionTestResult:t,isTestingConnection:!1}),t}catch(a){const t={success:!1,message:(a instanceof Error?a.message:String(a))||"Connection test failed"};return e({connectionTestResult:t,isTestingConnection:!1,error:t.message}),t}},loadAvailableIndexes:async()=>{var n;const{config:a}=t();if(a.backend_type===gs.DATABRICKS&&null!=(n=a.databricks_config)&&n.endpoint_name){e({isLoadingIndexes:!0,error:null});try{const t=await ms.getAvailableDatabricksIndexes(a.databricks_config.endpoint_name,a.databricks_config);e({availableIndexes:t.indexes,isLoadingIndexes:!1})}catch(s){e({error:(s instanceof Error?s.message:String(s))||"Failed to load indexes",availableIndexes:[],isLoadingIndexes:!1})}}},saveConfig:async()=>{const{config:n,validateConfig:a}=t();if(!await a())return!1;e({isLoading:!0,error:null});try{const t=await ms.saveConfig(n);return e({isLoading:!1}),t.success}catch(s){return e({error:(s instanceof Error?s.message:String(s))||"Failed to save configuration",isLoading:!1}),!1}},loadConfig:async()=>{e({isLoading:!0,error:null});try{const t=await ms.getConfig();e(t?{config:t,isLoading:!1}:{isLoading:!1})}catch(t){e({error:(t instanceof Error?t.message:String(t))||"Failed to load configuration",isLoading:!1})}},openVisualization:(t,n)=>e({visualizationOpen:!0,visualizationIndex:{name:t,type:n}}),closeVisualization:()=>e({visualizationOpen:!1,visualizationIndex:null}),resetConfig:()=>e({config:ps,error:null,connectionTestResult:null,validationErrors:[],availableIndexes:[],visualizationOpen:!1,visualizationIndex:null}),clearError:()=>e({error:null}),setError:t=>e({error:t})}));var No=n(21584),Po=n(61713),Mo=n(52325),zo=n(95050),Lo=n(35834);const Wo=class{static async performOneClickSetup(e){return(await ve.uE.post("/memory-backend/databricks/one-click-setup",e)).data}static async deleteAllConfigurations(){const e=await ve.uE.get("/memory-backend/configs");for(const t of e.data||[])await ve.uE.delete("/memory-backend/configs/"+t.id)}static async cleanupDisabledConfigurations(){try{await ve.uE.delete("/memory-backend/configs/disabled/cleanup")}catch(e){}}static async switchToDisabledMode(){return await ve.uE.post("/memory-backend/configs/switch-to-disabled")}static async updateBackendConfiguration(e,t){return(await ve.uE.put("/memory-backend/configs/"+e,t)).data}static async verifyResources(e,t){return(await ve.uE.get("/memory-backend/databricks/verify-resources",{params:{workspace_url:e,backend_id:t}})).data}static async deleteIndex(e){return(await ve.uE.delete("/memory-backend/databricks/index",{data:e})).data}static async getIndexInfo(e,t,n){return(await ve.uE.get("/memory-backend/databricks/index-info",{params:{workspace_url:e,index_name:t,endpoint_name:n}})).data}static async emptyIndex(e){return(await ve.uE.post("/memory-backend/databricks/empty-index",e)).data}static async reseedDocumentation(e){return(await ve.uE.post("/memory-backend/databricks/reseed-documentation",{workspace_url:e})).data}static async deleteEndpoint(e){return(await ve.uE.delete("/memory-backend/databricks/endpoint",{data:e})).data}static async saveManualConfiguration(e,t){return t?await ve.uE.put("/memory-backend/configs/"+t,e):await ve.uE.post("/memory-backend/configs",e)}},Ro=[{name:"Databricks BGE Large (English)",value:"databricks-bge-large-en",dimension:1024,description:"High quality embeddings optimized for English text"},{name:"Databricks GTE Large (English)",value:"databricks-gte-large-en",dimension:768,description:"General purpose embeddings for English text"},{name:"OpenAI text-embedding-3-small",value:"text-embedding-3-small",dimension:1536,description:"Cost-effective OpenAI embeddings"}],Fo={short_term:{brief:"Recent agent interactions",detailed:"The short-term memory index stores recent conversations and interactions between agents during task execution. It captures immediate context, task progress, decisions made, and intermediate results. This memory is typically retained for the duration of a crew's execution and helps agents maintain context awareness, avoid repeating actions, and build upon previous exchanges. It's essential for coherent multi-agent collaboration within a single session."},long_term:{brief:"Persistent knowledge across sessions",detailed:"The long-term memory index preserves important information, learned patterns, and key insights across multiple crew executions. It stores successful strategies, common solutions, domain knowledge, and historical outcomes that agents can reference in future tasks. This persistent memory enables agents to improve over time, apply lessons learned, and maintain institutional knowledge. It's crucial for building intelligent systems that evolve and adapt based on accumulated experience."},entity:{brief:"Information about entities and relationships",detailed:"The entity memory index maintains a knowledge graph of entities, their attributes, and relationships discovered during agent operations. It stores information about people, organizations, systems, concepts, and their interconnections. This structured memory helps agents understand context, make informed decisions based on entity relationships, and maintain consistency when referring to specific entities across different tasks. It's vital for complex scenarios involving multiple stakeholders or domain-specific entities."},document:{brief:"Uploaded documents and embeddings",detailed:"The document index stores embeddings of uploaded documents, files, and reference materials that agents can search and retrieve during task execution. It includes technical documentation, policies, guidelines, knowledge bases, and any other textual content provided to the system. This semantic search capability allows agents to find relevant information quickly, answer questions based on documented knowledge, and ground their responses in authoritative sources. It's essential for RAG (Retrieval Augmented Generation) workflows."}},Bo=(e,t)=>{const n=e.match(/\?o=(\d+)/),a=n?n[1]:"",s=e.replace(/\?o=\d+/,"");return(s.endsWith("/")?s.slice(0,-1):s)+"/compute/vector-search/"+t+(a?"?o="+a:"")},Vo=(e,t)=>{const n=e.match(/\?o=(\d+)/),a=n?n[1]:"",s=e.replace(/\?o=\d+/,""),i=s.endsWith("/")?s.slice(0,-1):s,o=t.split(".");if(o.length>=3){return i+"/explore/data/"+o[0]+"/"+o[1]+"/"+o.slice(2).join(".")+(a?"?o="+a:"")}return i+"/explore/data"+(a?"?o="+a:"")},Uo=e=>{const t=e.split(".");return t.length>=3&&t.every(e=>e.length>0)},Ho=(e,t)=>!(null==e||!e.indexes)&&("memory"===t?!!(e.indexes.short_term||e.indexes.long_term||e.indexes.entity):!!e.indexes.document),Ko=e=>{let{open:t,onClose:n,setupResult:a,workspaceUrl:s,savedConfigWorkspaceUrl:d}=e;const u=e=>{const t=(e=>"created"===e||"already_exists"===e?"success":"error")(e);return"success"===t?(0,W.jsx)(Js.A,{color:"success"}):(0,W.jsx)(Ys.A,{color:"error"})},m=()=>s||d||"";return(0,W.jsxs)(o.A,{open:t,onClose:n,maxWidth:"sm",fullWidth:!0,children:[(0,W.jsx)(l.A,{children:null!=a&&a.success?"Setup Complete!":"Setup Failed"}),(0,W.jsx)(r.A,{children:a&&(0,W.jsxs)(i.A,{children:[(0,W.jsx)(h.A,{severity:a.success?"success":"error",sx:{mb:2},children:a.message}),a.warning&&(0,W.jsx)(h.A,{severity:"warning",sx:{mb:2},children:a.warning}),a.info&&(0,W.jsx)(h.A,{severity:"info",sx:{mb:2},children:a.info}),a.endpoints&&(0,W.jsxs)(i.A,{sx:{mb:3},children:[(0,W.jsx)(c.A,{variant:"subtitle2",sx:{mb:1},children:"Endpoints Created:"}),(0,W.jsxs)(at.A,{dense:!0,children:[a.endpoints.memory&&(0,W.jsxs)(st.Ay,{children:[(0,W.jsx)(it.A,{children:u(a.endpoints.memory.status)}),(0,W.jsx)(ot.A,{primary:(0,W.jsx)(Ms.A,{href:Bo(m(),a.endpoints.memory.name),target:"_blank",rel:"noopener noreferrer",children:a.endpoints.memory.name}),secondary:"Memory Endpoint (Direct Access)"})]}),a.endpoints.document&&(0,W.jsxs)(st.Ay,{children:[(0,W.jsx)(it.A,{children:u(a.endpoints.document.status)}),(0,W.jsx)(ot.A,{primary:(0,W.jsx)(Ms.A,{href:Bo(m(),a.endpoints.document.name),target:"_blank",rel:"noopener noreferrer",children:a.endpoints.document.name}),secondary:"Document Endpoint (Direct Access)"})]})]})]}),a.indexes&&(0,W.jsxs)(i.A,{children:[(0,W.jsx)(c.A,{variant:"subtitle2",sx:{mb:1},children:"Indexes Created:"}),(0,W.jsxs)(at.A,{dense:!0,children:[a.indexes.short_term&&(0,W.jsxs)(st.Ay,{children:[(0,W.jsx)(it.A,{children:u(a.indexes.short_term.status)}),(0,W.jsx)(ot.A,{primary:(0,W.jsx)(Ms.A,{href:Vo(m(),a.indexes.short_term.name),target:"_blank",rel:"noopener noreferrer",children:a.indexes.short_term.name}),secondary:"Short-term Memory Index"})]}),a.indexes.long_term&&(0,W.jsxs)(st.Ay,{children:[(0,W.jsx)(it.A,{children:u(a.indexes.long_term.status)}),(0,W.jsx)(ot.A,{primary:(0,W.jsx)(Ms.A,{href:Vo(m(),a.indexes.long_term.name),target:"_blank",rel:"noopener noreferrer",children:a.indexes.long_term.name}),secondary:"Long-term Memory Index"})]}),a.indexes.entity&&(0,W.jsxs)(st.Ay,{children:[(0,W.jsx)(it.A,{children:u(a.indexes.entity.status)}),(0,W.jsx)(ot.A,{primary:(0,W.jsx)(Ms.A,{href:Vo(m(),a.indexes.entity.name),target:"_blank",rel:"noopener noreferrer",children:a.indexes.entity.name}),secondary:"Entity Memory Index"})]}),a.indexes.document&&(0,W.jsxs)(st.Ay,{children:[(0,W.jsx)(it.A,{children:u(a.indexes.document.status)}),(0,W.jsx)(ot.A,{primary:(0,W.jsx)(Ms.A,{href:Vo(m(),a.indexes.document.name),target:"_blank",rel:"noopener noreferrer",children:a.indexes.document.name}),secondary:"Document Embeddings Index"})]})]})]})]})}),(0,W.jsx)(H.A,{children:(0,W.jsx)(g.A,{onClick:n,children:"Close"})})]})};var Go=n(89299),qo=n(58629),Jo=n(29240),Yo=n(46321);const Xo=e=>{let{title:t,subtitle:n,savedConfig:a,endpointName:s,endpointType:o,indexes:r,indexInfoMap:l,endpointStatuses:u,isSettingUp:h,onRefresh:m,onEmpty:g,onDelete:p,onVisualize:x,onViewDocuments:f,showEndpointLink:y=!0}=e;const b=e=>{const t=l[e];return t?t.loading?(0,W.jsx)(Y.A,{size:16}):(0,W.jsx)(c.A,{variant:"body2",sx:{fontSize:"0.875rem",color:"DELETED"===t.index_type?"error.main":"inherit"},children:"DELETED"===t.index_type?"NOT FOUND":t.index_type||"UNKNOWN"}):"UNKNOWN"},v=e=>{const t=l[e];return!t||t.loading?(0,W.jsx)(Y.A,{size:16}):t.doc_count||0},A=e=>{const t=l[e],n=u[o];return h||!1===(null==n?void 0:n.can_delete_indexes)||"DELETED"===(null==t?void 0:t.index_type)};return(0,W.jsxs)(i.A,{sx:{mb:4,backgroundColor:"transparent"},children:[(0,W.jsxs)(i.A,{sx:{display:"flex",alignItems:"center",mb:2},children:[(0,W.jsx)(c.A,{variant:"subtitle1",sx:{fontWeight:"medium"},children:t}),n&&(0,W.jsx)(M.A,{title:n,placement:"top",arrow:!0,children:(0,W.jsx)(d.A,{size:"small",sx:{ml:1,p:.5},children:(0,W.jsx)(Go.A,{fontSize:"small",sx:{fontSize:18}})})})]}),y&&s&&(0,W.jsxs)(c.A,{variant:"body2",color:"text.secondary",sx:{mb:2},children:["Endpoint:",(0,W.jsx)(Ms.A,{href:Bo(a.workspace_url||"",s),target:"_blank",rel:"noopener noreferrer",sx:{ml:1},children:s})]}),(0,W.jsx)(Pi.A,{component:_e.A,variant:"outlined",sx:{backgroundColor:"#fff"},children:(0,W.jsxs)(Mi.A,{size:"small",sx:{minWidth:650,backgroundColor:"#fff"},children:[(0,W.jsx)(zi.A,{sx:{backgroundColor:"#f5f5f5"},children:(0,W.jsxs)(Li.A,{children:[(0,W.jsx)(Wi.A,{sx:{width:"25%"},children:"Name"}),(0,W.jsx)(Wi.A,{align:"center",sx:{width:"10%"},children:"Type"}),(0,W.jsx)(Wi.A,{align:"center",sx:{width:"10%"},children:"Documents"}),(0,W.jsx)(Wi.A,{sx:{width:"35%"},children:"Description"}),(0,W.jsx)(Wi.A,{align:"center",sx:{width:"20%"},children:"Actions"})]})}),(0,W.jsx)(Ri.A,{children:r.map(e=>{let{type:t,name:n}=e;if(!n)return null;const s=Fo[t]||{brief:"",detailed:""};return(0,W.jsxs)(Li.A,{sx:{backgroundColor:"#fff","&:hover":{backgroundColor:"#fafafa"}},children:[(0,W.jsx)(Wi.A,{children:(0,W.jsx)(Ms.A,{href:Vo(a.workspace_url||"",n),target:"_blank",rel:"noopener noreferrer",sx:{fontSize:"0.875rem"},children:n.split(".").pop()})}),(0,W.jsx)(Wi.A,{align:"center",children:b(n)}),(0,W.jsx)(Wi.A,{align:"center",children:v(n)}),(0,W.jsx)(Wi.A,{children:(0,W.jsxs)(i.A,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[(0,W.jsx)(c.A,{variant:"body2",sx:{fontSize:"0.875rem",flex:1},children:s.brief}),(0,W.jsx)(M.A,{title:s.detailed,placement:"top",arrow:!0,sx:{maxWidth:400},children:(0,W.jsx)(d.A,{size:"small",sx:{p:.5,ml:1},children:(0,W.jsx)(Go.A,{fontSize:"small",sx:{fontSize:16}})})})]})}),(0,W.jsx)(Wi.A,{align:"center",children:(0,W.jsxs)(i.A,{sx:{display:"flex",alignItems:"center",justifyContent:"center",gap:.5},children:[f?(0,W.jsx)(M.A,{title:"View Documents",children:(0,W.jsx)(d.A,{size:"small",onClick:()=>f(t,n),disabled:h,children:(0,W.jsx)(qo.A,{fontSize:"small"})})}):(0,W.jsx)(i.A,{sx:{width:32}}),"entity"===t&&x?(0,W.jsx)(M.A,{title:"Visualize Entity Graph",children:(0,W.jsx)(d.A,{size:"small",onClick:()=>x(t,n),disabled:h,children:(0,W.jsx)(In.A,{fontSize:"small"})})}):"document"===t&&m?(0,W.jsx)(M.A,{title:"Re-seed Documentation",children:(0,W.jsx)(d.A,{size:"small",onClick:m,disabled:h,children:(0,W.jsx)(Jo.A,{fontSize:"small"})})}):(0,W.jsx)(i.A,{sx:{width:32}}),(0,W.jsx)(M.A,{title:"Reset Index (Delete & Recreate)",children:(0,W.jsx)(d.A,{size:"small",onClick:()=>g(t),disabled:h,children:(0,W.jsx)(Yo.A,{fontSize:"small"})})}),(0,W.jsx)(M.A,{title:"Delete Index",children:(0,W.jsx)(d.A,{size:"small",onClick:()=>p(t),disabled:A(n),children:(0,W.jsx)(Xs.A,{fontSize:"small"})})})]})})]},t)})})]})})]})};var Qo=n(49885);const Zo=e=>{var t;let{savedConfig:n,isEditingConfig:a,isSettingUp:s,onStartEdit:o,onSaveEdit:r,onCancelEdit:l,onRefresh:d,children:u}=e;return(0,W.jsxs)(i.A,{sx:{mt:2,p:2,bgcolor:"#ffffff",borderRadius:2,border:"1px solid",borderColor:"#e0e0e0"},children:[(0,W.jsxs)(i.A,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",mb:1},children:[(0,W.jsxs)(i.A,{sx:{display:"flex",alignItems:"center"},children:[(0,W.jsx)(Js.A,{sx:{mr:.5,color:"success.main",fontSize:18}}),(0,W.jsx)(c.A,{variant:"subtitle2",color:"success.main",children:"Active Configuration"})]}),(0,W.jsxs)(i.A,{sx:{display:"flex",gap:.5},children:[!a&&(0,W.jsxs)(W.Fragment,{children:[(0,W.jsx)(g.A,{size:"small",startIcon:(0,W.jsx)(Ua.A,{}),onClick:o,disabled:s,sx:{minWidth:"auto",py:.5},children:"Edit"}),(0,W.jsx)(g.A,{size:"small",startIcon:(0,W.jsx)(Jo.A,{}),onClick:d,disabled:s,sx:{minWidth:"auto",py:.5},children:"Refresh"})]}),a&&(0,W.jsxs)(W.Fragment,{children:[(0,W.jsx)(g.A,{size:"small",startIcon:(0,W.jsx)(_n.A,{}),onClick:r,disabled:s,sx:{minWidth:"auto",py:.5},color:"primary",children:"Save"}),(0,W.jsx)(g.A,{size:"small",startIcon:(0,W.jsx)(Qo.A,{}),onClick:l,disabled:s,sx:{minWidth:"auto",py:.5},children:"Cancel"})]})]})]}),(0,W.jsxs)(i.A,{sx:{display:"flex",gap:1,mb:1,flexWrap:"wrap"},children:[(0,W.jsx)(V.A,{size:"small",label:"Workspace: "+(null==(t=n.workspace_url)?void 0:t.replace("https://","").split("?")[0])}),(0,W.jsx)(V.A,{size:"small",label:"Catalog: "+n.catalog}),(0,W.jsx)(V.A,{size:"small",label:"Schema: "+n.schema})]}),a&&(0,W.jsx)(h.A,{severity:"info",sx:{mb:1},children:"Enter the names of your existing Databricks Vector Search endpoints and indexes. Leave empty to remove."}),u]})},$o=e=>{let{manualConfig:t,isSettingUp:n,error:a,onConfigChange:s,onSave:o}=e;const r=e=>n=>{s(Object.assign({},t,{[e]:n.target.value}))},l=e=>""!==e&&!Uo(e);return(0,W.jsxs)(i.A,{children:[(0,W.jsxs)(h.A,{severity:"info",sx:{mb:3},children:[(0,W.jsx)(c.A,{variant:"body2",sx:{mb:1},children:"Enter your existing Databricks Vector Search configuration. This will connect to your existing endpoints and indexes."}),(0,W.jsxs)(c.A,{variant:"body2",children:[(0,W.jsx)("strong",{children:"Format for indexes:"})," catalog.schema.index_name (e.g., ml.agents.short_term_memory)"]})]}),a&&(0,W.jsx)(h.A,{severity:"error",sx:{mb:2},children:a}),(0,W.jsxs)(i.A,{sx:{display:"flex",flexDirection:"column",gap:2},children:[(0,W.jsx)(U.A,{fullWidth:!0,label:"Databricks Workspace URL",value:t.workspace_url,onChange:r("workspace_url"),placeholder:"https://your-workspace.databricks.com",required:!0,disabled:n}),(0,W.jsx)(c.A,{variant:"subtitle2",sx:{mt:2},children:"Vector Search Endpoints"}),(0,W.jsx)(U.A,{fullWidth:!0,label:"Memory Endpoint Name",value:t.endpoint_name,onChange:r("endpoint_name"),placeholder:"kasal_memory_endpoint",required:!0,disabled:n}),(0,W.jsx)(U.A,{fullWidth:!0,label:"Document Endpoint Name",value:t.document_endpoint_name,onChange:r("document_endpoint_name"),placeholder:"kasal_docs_endpoint",required:!0,disabled:n}),(0,W.jsxs)(re.A,{fullWidth:!0,children:[(0,W.jsx)(le.A,{children:"Embedding Model"}),(0,W.jsx)(ce.A,{value:t.embedding_model,onChange:e=>r("embedding_model")(e),label:"Embedding Model",disabled:n,children:Ro.map(e=>(0,W.jsxs)(de.A,{value:e.value,children:[e.name," (",e.dimension," dimensions)"]},e.value))})]}),(0,W.jsx)(c.A,{variant:"subtitle2",sx:{mt:2},children:"Memory Indexes (catalog.schema.index_name)"}),(0,W.jsx)(U.A,{fullWidth:!0,label:"Short-term Memory Index",value:t.short_term_index,onChange:r("short_term_index"),placeholder:"ml.agents.short_term_memory",required:!0,error:l(t.short_term_index),helperText:l(t.short_term_index)?"Invalid format. Use: catalog.schema.index_name":"",disabled:n}),(0,W.jsx)(U.A,{fullWidth:!0,label:"Long-term Memory Index",value:t.long_term_index,onChange:r("long_term_index"),placeholder:"ml.agents.long_term_memory",required:!0,error:l(t.long_term_index),helperText:l(t.long_term_index)?"Invalid format. Use: catalog.schema.index_name":"",disabled:n}),(0,W.jsx)(U.A,{fullWidth:!0,label:"Entity Memory Index",value:t.entity_index,onChange:r("entity_index"),placeholder:"ml.agents.entity_memory",required:!0,error:l(t.entity_index),helperText:l(t.entity_index)?"Invalid format. Use: catalog.schema.index_name":"",disabled:n}),(0,W.jsx)(U.A,{fullWidth:!0,label:"Document Embeddings Index",value:t.document_index,onChange:r("document_index"),placeholder:"ml.agents.document_embeddings",required:!0,error:l(t.document_index),helperText:l(t.document_index)?"Invalid format. Use: catalog.schema.index_name":"",disabled:n}),(0,W.jsx)(g.A,{variant:"contained",color:"primary",startIcon:n?(0,W.jsx)(Y.A,{size:20}):(0,W.jsx)(_n.A,{}),onClick:o,disabled:n||!t.workspace_url||!t.endpoint_name||!t.document_endpoint_name||!t.short_term_index||!t.long_term_index||!t.entity_index||!t.document_index||l(t.short_term_index)||l(t.long_term_index)||l(t.entity_index)||l(t.document_index),sx:{mt:3},fullWidth:!0,children:n?"Saving Configuration...":"Save Configuration"})]})]})},er=e=>{let{detectedWorkspaceUrl:t,catalog:n,schema:a,embeddingModel:s,isSettingUp:o,error:r,onCatalogChange:l,onSchemaChange:d,onEmbeddingModelChange:u,onSetup:m}=e;return(0,W.jsxs)(i.A,{children:[(0,W.jsxs)(h.A,{severity:"info",sx:{mb:3},children:[(0,W.jsx)(c.A,{variant:"body2",sx:{mb:1},children:(0,W.jsx)("strong",{children:"One-click setup will automatically:"})}),(0,W.jsxs)(c.A,{variant:"body2",component:"ul",sx:{m:0,pl:2},children:[(0,W.jsx)("li",{children:"Create two Vector Search endpoints (one for memory, one for documents)"}),(0,W.jsx)("li",{children:"Create four indexes (short-term, long-term, entity memory, and documents)"}),(0,W.jsx)("li",{children:"Configure optimal settings for agent memory persistence"}),(0,W.jsx)("li",{children:"Enable Databricks as the default memory backend"})]})]}),t&&(0,W.jsxs)(h.A,{severity:"success",sx:{mb:2},children:["Workspace detected: ",t]}),!t&&(0,W.jsx)(h.A,{severity:"warning",sx:{mb:2},children:"No Databricks workspace detected. Please configure your Databricks workspace in the Databricks section first."}),r&&(0,W.jsx)(h.A,{severity:"error",sx:{mb:2},children:r}),(0,W.jsxs)(i.A,{sx:{display:"flex",flexDirection:"column",gap:2},children:[(0,W.jsxs)(ue.Ay,{container:!0,spacing:2,children:[(0,W.jsx)(ue.Ay,{item:!0,xs:6,children:(0,W.jsx)(U.A,{fullWidth:!0,label:"Catalog",value:n,onChange:e=>l(e.target.value),placeholder:"ml",required:!0,disabled:o,helperText:"Unity Catalog name for indexes"})}),(0,W.jsx)(ue.Ay,{item:!0,xs:6,children:(0,W.jsx)(U.A,{fullWidth:!0,label:"Schema",value:a,onChange:e=>d(e.target.value),placeholder:"agents",required:!0,disabled:o,helperText:"Schema name for indexes"})})]}),(0,W.jsxs)(re.A,{fullWidth:!0,children:[(0,W.jsx)(le.A,{children:"Embedding Model"}),(0,W.jsx)(ce.A,{value:s,onChange:e=>u(e.target.value),label:"Embedding Model",disabled:o,children:Ro.map(e=>(0,W.jsxs)(de.A,{value:e.value,children:[e.name," (",e.dimension," dimensions)"]},e.value))}),(0,W.jsx)(c.A,{variant:"caption",color:"text.secondary",sx:{mt:1},children:"Choose the embedding model for document and memory vectorization"})]}),(0,W.jsx)(h.A,{severity:"warning",sx:{mt:2},children:(0,W.jsxs)(c.A,{variant:"body2",children:[(0,W.jsx)("strong",{children:"Important:"})," This will create resources in your Databricks workspace. Ensure you have the necessary permissions to create endpoints and indexes."]})}),(0,W.jsx)(g.A,{variant:"contained",color:"primary",size:"large",startIcon:o?(0,W.jsx)(Y.A,{size:20}):(0,W.jsx)(Po.A,{}),onClick:m,disabled:!t||!n||!a||o,fullWidth:!0,sx:{mt:3,py:1.5},children:o?"Setting up Databricks Vector Search...":"Setup Databricks Vector Search"})]})]})},tr=e=>{var t,n,a,s,o,r;let{editedConfig:l,onEditChange:d}=e;return(0,W.jsxs)(i.A,{children:[(0,W.jsxs)(i.A,{sx:{mb:1.5},children:[(0,W.jsx)(c.A,{variant:"caption",color:"text.secondary",sx:{display:"block",mb:.5},children:"Endpoints:"}),(0,W.jsxs)(i.A,{sx:{display:"flex",gap:.5,flexWrap:"wrap",alignItems:"center"},children:[(0,W.jsx)(U.A,{size:"small",label:"Memory Endpoint",value:(null==l||null==(t=l.endpoints)||null==(t=t.memory)?void 0:t.name)||"",onChange:e=>d("endpoints.memory.name",e.target.value||void 0),placeholder:"kasal_memory_endpoint",sx:{width:250}}),(0,W.jsx)(U.A,{size:"small",label:"Document Endpoint",value:(null==l||null==(n=l.endpoints)||null==(n=n.document)?void 0:n.name)||"",onChange:e=>d("endpoints.document.name",e.target.value||void 0),placeholder:"kasal_docs_endpoint",sx:{width:250}})]})]}),(0,W.jsxs)(i.A,{children:[(0,W.jsx)(c.A,{variant:"caption",color:"text.secondary",sx:{display:"block",mb:.5},children:"Indexes:"}),(0,W.jsxs)(ue.Ay,{container:!0,spacing:1,children:[(0,W.jsx)(ue.Ay,{item:!0,xs:12,sm:6,children:(0,W.jsx)(U.A,{size:"small",label:"Short-term Index",value:(null==l||null==(a=l.indexes)||null==(a=a.short_term)?void 0:a.name)||"",onChange:e=>d("indexes.short_term.name",e.target.value||void 0),placeholder:"catalog.schema.short_term_memory",fullWidth:!0})}),(0,W.jsx)(ue.Ay,{item:!0,xs:12,sm:6,children:(0,W.jsx)(U.A,{size:"small",label:"Long-term Index",value:(null==l||null==(s=l.indexes)||null==(s=s.long_term)?void 0:s.name)||"",onChange:e=>d("indexes.long_term.name",e.target.value||void 0),placeholder:"catalog.schema.long_term_memory",fullWidth:!0})}),(0,W.jsx)(ue.Ay,{item:!0,xs:12,sm:6,children:(0,W.jsx)(U.A,{size:"small",label:"Entity Index",value:(null==l||null==(o=l.indexes)||null==(o=o.entity)?void 0:o.name)||"",onChange:e=>d("indexes.entity.name",e.target.value||void 0),placeholder:"catalog.schema.entity_memory",fullWidth:!0})}),(0,W.jsx)(ue.Ay,{item:!0,xs:12,sm:6,children:(0,W.jsx)(U.A,{size:"small",label:"Document Index",value:(null==l||null==(r=l.indexes)||null==(r=r.document)?void 0:r.name)||"",onChange:e=>d("indexes.document.name",e.target.value||void 0),placeholder:"catalog.schema.document_embeddings",fullWidth:!0})})]})]})]})};var nr=n(99530);const ar=e=>{var t,n,a,s,o,r,l,d,u,h,m,g;let{savedConfig:p,endpointStatuses:x,onDeleteEndpoint:f}=e;return(0,W.jsxs)(i.A,{sx:{mb:1.5},children:[(0,W.jsx)(c.A,{variant:"caption",color:"text.secondary",sx:{display:"block",mb:.5},children:"Endpoints:"}),(0,W.jsxs)(i.A,{sx:{display:"flex",gap:.5,flexWrap:"wrap",alignItems:"center"},children:[(null==(t=p.endpoints)?void 0:t.memory)&&(0,W.jsx)(V.A,{size:"small",label:"Memory Endpoint"+(null!=(n=x.memory)&&n.state?" ("+x.memory.state+")":""),clickable:!0,icon:(0,W.jsx)(No.A,{}),color:"ONLINE"===(null==(a=x.memory)?void 0:a.state)?"success":"PROVISIONING"===(null==(s=x.memory)?void 0:s.state)?"warning":"NOT_FOUND"===(null==(o=x.memory)?void 0:o.state)?"error":"default",onClick:()=>{var e;return window.open(Bo(p.workspace_url||"",(null==(e=p.endpoints)||null==(e=e.memory)?void 0:e.name)||""),"_blank")},onDelete:Ho(p,"memory")&&"NOT_FOUND"!==(null==(r=x.memory)?void 0:r.state)?void 0:()=>f("memory"),deleteIcon:(0,W.jsx)(Xs.A,{})}),(null==(l=p.endpoints)?void 0:l.document)&&(0,W.jsx)(V.A,{size:"small",label:"Document Endpoint"+(null!=(d=x.document)&&d.state?" ("+x.document.state+")":""),clickable:!0,icon:(0,W.jsx)(nr.A,{}),color:"ONLINE"===(null==(u=x.document)?void 0:u.state)?"success":"PROVISIONING"===(null==(h=x.document)?void 0:h.state)?"warning":"NOT_FOUND"===(null==(m=x.document)?void 0:m.state)?"error":"default",onClick:()=>{var e;return window.open(Bo(p.workspace_url||"",(null==(e=p.endpoints)||null==(e=e.document)?void 0:e.name)||""),"_blank")},onDelete:Ho(p,"document")&&"NOT_FOUND"!==(null==(g=x.document)?void 0:g.state)?void 0:()=>f("document"),deleteIcon:(0,W.jsx)(Xs.A,{})})]})]})};var sr=n(64873),ir=n(958),or=n(10877);const rr=(0,A.vt)((e,t)=>({graphInstance:null,graphData:{nodes:[],links:[]},filteredGraphData:{nodes:[],links:[]},loading:!1,error:null,focusedNodeId:null,selectedNode:null,showInferredNodes:!0,deduplicateNodes:!1,showOrphanedNodes:!1,forceStrength:-300,linkDistance:100,linkCurvature:0,centerForce:.3,initializeGraph:n=>{const a=t();a.graphInstance&&a.cleanupGraph();try{var s,i,o,r;const l=(0,sr.A)()(n).backgroundColor("#fafafa").nodeId("id").nodeLabel(e=>'\n          <div style="background: rgba(0,0,0,0.8); color: white; padding: 8px; border-radius: 4px; max-width: 200px;">\n            <div style="font-weight: bold; margin-bottom: 4px;">'+e.name+'</div>\n            <div style="font-size: 12px; color: #ccc; margin-bottom: 4px;">Type: '+e.type+"</div>\n            "+(Object.entries(e.attributes||{}).length>0?'<div style="font-size: 11px;">'+Object.entries(e.attributes||{}).slice(0,3).map(e=>{let[t,n]=e;return t+": "+String(n)}).join("<br/>")+"</div>":"")+"\n          </div>\n        ").nodeCanvasObject((e,t,n)=>{var a,s;const i=e.size||5,o=null!=(a=e.x)?a:0,r=null!=(s=e.y)?s:0;t.beginPath(),t.arc(o,r,i,0,2*Math.PI,!1),t.fillStyle=e.color||"#999",t.fill(),t.strokeStyle="rgba(0,0,0,0.3)",t.lineWidth=2,t.stroke();const l=e.name||e.id||"Unknown";t.font="bold 14px Arial",t.textAlign="center",t.textBaseline="top";const c=t.measureText(l).width,d=r+i+3;t.fillStyle="rgba(255, 255, 255, 0.95)",t.fillRect(o-(c+4)/2,d,c+4,16.8),t.strokeStyle="rgba(0,0,0,0.1)",t.lineWidth=1,t.strokeRect(o-(c+4)/2,d,c+4,16.8),t.fillStyle="#333",t.fillText(l,o,d+2)}).linkWidth(2).linkColor(()=>"rgba(100, 100, 100, 0.4)").linkDirectionalArrowLength(6).linkDirectionalArrowRelPos(1).linkCurvature(a.linkCurvature).onNodeClick(t=>{e({selectedNode:t})}).onBackgroundClick(()=>{e({selectedNode:null,focusedNodeId:null})});null==(s=l.d3Force("charge"))||s.strength(a.forceStrength),null==(i=l.d3Force("link"))||i.distance(a.linkDistance),null==(o=l.d3Force("center"))||o.strength(a.centerForce),null==(r=l.d3Force("collide"))||r.radius(25).strength(1.2);const c=n.offsetWidth,d=n.offsetHeight,u=c/2,h=d/2;a.centerForce<.3?(l.d3Force("x",null),l.d3Force("y",null)):a.centerForce<.7?(l.d3Force("x",ir.A(u).strength(.1)),l.d3Force("y",or.A(h).strength(.1))):(l.d3Force("x",ir.A(u).strength(.5)),l.d3Force("y",or.A(h).strength(.5))),e({graphInstance:l});const{filteredGraphData:m}=t();m.nodes.length>0?(l.graphData(m),setTimeout(()=>{l.zoomToFit(400,50)},500)):l.graphData({nodes:[],links:[]})}catch(l){e({error:"Failed to initialize graph visualization"})}},cleanupGraph:()=>{const{graphInstance:n}=t();if(n){try{"function"===typeof n._destructor&&n._destructor()}catch(a){}e({graphInstance:null})}},setGraphData:t=>{e({graphData:t})},setFilteredGraphData:n=>{const{graphInstance:a}=t();e({filteredGraphData:n}),a&&n.nodes.length>0&&a.graphData(n)},setLoading:t=>{e({loading:t})},setError:t=>{e({error:t})},setFocusedNode:t=>{e({focusedNodeId:t})},setSelectedNode:t=>{e({selectedNode:t})},updateForceParameters:(n,a,s)=>{const{graphInstance:i}=t(),o=t().centerForce,r=void 0!==s?s:o;var l,c;if(e({forceStrength:n,linkDistance:a,centerForce:r}),i)if(null==(l=i.d3Force("charge"))||l.strength(n),null==(c=i.d3Force("link"))||c.distance(a),void 0!==s){var d;const e=i.width()/2,t=i.height()/2;var u;if(null==(d=i.d3Force("center"))||d.strength(r),r<.3)i.d3Force("x",null),i.d3Force("y",null),null==(u=i.d3Force("center"))||u.strength(.01);else if(r<.7)i.d3Force("x",ir.A(e).strength(.1)),i.d3Force("y",or.A(t).strength(.1));else{var h;i.d3Force("x",ir.A(e).strength(.5)),i.d3Force("y",or.A(t).strength(.5)),null==(h=i.d3Force("charge"))||h.strength(-100)}const a=r>.7?1:.8;var m;if(i.d3ReheatSimulation(a),r<.7)null==(m=i.d3Force("charge"))||m.strength(n)}else i.d3ReheatSimulation(.3)},setLinkCurvature:n=>{const{graphInstance:a}=t();e({linkCurvature:n}),a&&a.linkCurvature(n)},resetFilters:()=>{e({focusedNodeId:null,selectedNode:null,showInferredNodes:!0,deduplicateNodes:!1})},toggleInferredNodes:()=>{e(e=>({showInferredNodes:!e.showInferredNodes}))},toggleDeduplication:()=>{e(e=>({deduplicateNodes:!e.deduplicateNodes}))},toggleOrphanedNodes:()=>{e(e=>({showOrphanedNodes:!e.showOrphanedNodes}))},zoomToFit:()=>{const{graphInstance:e}=t();e&&e.zoomToFit(400,50)},zoomIn:()=>{const{graphInstance:e}=t();if(e){const t=e.zoom();e.zoom(1.2*t,300)}},zoomOut:()=>{const{graphInstance:e}=t();if(e){const t=e.zoom();e.zoom(.8*t,300)}}})),lr=e=>{let{open:t,onClose:n,indexName:a,workspaceUrl:u,endpointName:m}=e;const p=(0,s.useRef)(null),{graphData:x,filteredGraphData:f,loading:y,error:b,selectedNode:v,focusedNodeId:A,showInferredNodes:j,deduplicateNodes:w,showOrphanedNodes:k,forceStrength:C,linkDistance:S,linkCurvature:_,centerForce:E,initializeGraph:I,cleanupGraph:T,setGraphData:D,setFilteredGraphData:O,setLoading:N,setError:P,setFocusedNode:z,setSelectedNode:L,updateForceParameters:R,setLinkCurvature:F,resetFilters:B,toggleInferredNodes:H,toggleDeduplication:G,toggleOrphanedNodes:q,zoomToFit:J,zoomIn:X,zoomOut:Q}=rr(),Z=e=>{const t={person:"#68CCE5",organization:"#94D82D",system:"#FCC940",concept:"#F25A29",location:"#AD4BAC",event:"#D62728",conference:"#E91E63",meetup:"#FF5722",document:"#8FBC8F",project:"#FFB366",technology:"#00BCD4",tool:"#9C27B0",framework:"#3F51B5",unknown:"#C5C5C5"};return t[e.toLowerCase()]||t.unknown},$=(0,s.useCallback)(async()=>{if(a&&u&&m){N(!0),P(null);try{const e=await ve.uE.get("/memory-backend/databricks/entity-data",{params:{index_name:a,workspace_url:u,endpoint_name:m}}),{entities:t,relationships:n}=e.data,s=new Map,i=t.map(e=>{const t={id:e.id||e.name,name:e.name||e.id,type:e.type||"unknown",attributes:e.attributes||{},color:Z(e.type||"unknown"),size:5};return s.set(t.id,t),t}),o={nodes:i,links:n.filter(e=>s.has(e.source)&&s.has(e.target)).map(e=>({source:e.source,target:e.target,relationship:e.type||e.label||"related_to"}))};D(o),O(o)}catch(t){var e;const n=t instanceof Error?t.message:(null==t||null==(e=t.response)||null==(e=e.data)?void 0:e.detail)||"Failed to fetch entity data";P(n)}finally{N(!1)}}},[a,u,m,D,O,N,P]);(0,s.useEffect)(()=>{t&&$()},[t,$]),(0,s.useEffect)(()=>{if(!t||y||b||!p.current)return;if(0===x.nodes.length)return;const e=setTimeout(()=>{p.current&&I(p.current)},100);return()=>{clearTimeout(e)}},[t,y,b,x,I]),(0,s.useEffect)(()=>{t||(T(),B())},[t,T,B]),(0,s.useEffect)(()=>{let e=[...x.nodes],t=[...x.links];const n=new Set;if(t.forEach(e=>{const t="object"===typeof e.source?e.source.id:e.source,a="object"===typeof e.target?e.target.id:e.target;n.add(t),n.add(a)}),!A&&!k&&n.size>0){e.filter(e=>!n.has(e.id)).length;e=e.filter(e=>n.has(e.id))}if(A){if(e.find(e=>e.id===A)){const n=new Set([A]);t.forEach(e=>{const t="object"===typeof e.source?e.source.id:e.source,a="object"===typeof e.target?e.target.id:e.target;t===A&&n.add(a),a===A&&n.add(t)}),e=e.filter(e=>n.has(e.id)),t=t.filter(e=>{const t="object"===typeof e.source?e.source.id:e.source,a="object"===typeof e.target?e.target.id:e.target;return n.has(t)&&n.has(a)})}}else if(w){const n=new Map,a=new Map;e.forEach(e=>{if(a.has(e.name)){const t=a.get(e.name);n.set(e.id,t.id)}else a.set(e.name,e),n.set(e.id,e.id)}),e=Array.from(a.values());const s=new Set(e.map(e=>e.id)),i=t.map(e=>{const t="object"===typeof e.source?e.source.id:e.source,a="object"===typeof e.target?e.target.id:e.target,s=n.get(t)||t,i=n.get(a)||a;return Object.assign({},e,{source:s,target:i})});t=i.filter(e=>{const t=e.source!==e.target&&s.has(e.source)&&s.has(e.target);return t});const o=new Map;t.forEach(e=>{const t=e.source+"-"+e.target+"-"+(e.relationship||"related");o.has(t)||o.set(t,e)}),t=Array.from(o.values())}O({nodes:e,links:t})},[x,A,w,k,O]);const ee=()=>{B(),n()};return(0,W.jsxs)(o.A,{open:t,onClose:ee,maxWidth:"xl",fullWidth:!0,PaperProps:{sx:{height:"90vh",display:"flex",flexDirection:"column"}},children:[(0,W.jsxs)(l.A,{sx:{m:0,p:2,display:"flex",alignItems:"center",gap:1},children:[(0,W.jsx)(In.A,{}),(0,W.jsx)(c.A,{variant:"h6",children:"Entity Graph Visualization"}),(0,W.jsx)(i.A,{sx:{flexGrow:1}}),(0,W.jsx)(Se.A,{options:x.nodes,getOptionLabel:e=>e.name,groupBy:e=>e.type,sx:{width:350},size:"small",value:x.nodes.find(e=>e.id===A)||null,onChange:(e,t)=>(e=>{if(e){z(e.id);const t=x.nodes.find(t=>t.id===e.id);t&&L(t)}})(t),renderInput:e=>(0,W.jsx)(U.A,Object.assign({},e,{label:A?"Focused Entity":"Search entities...",variant:"outlined",color:A?"secondary":"primary"})),renderOption:(e,t)=>(0,W.jsx)(i.A,Object.assign({component:"li"},e,{children:(0,W.jsxs)(is.A,{direction:"row",spacing:1,alignItems:"center",children:[(0,W.jsx)(i.A,{sx:{width:10,height:10,borderRadius:"50%",backgroundColor:t.color,border:"1px solid rgba(0,0,0,0.2)"}}),(0,W.jsx)(c.A,{variant:"body2",children:t.name}),(0,W.jsxs)(c.A,{variant:"caption",color:"text.secondary",children:["(",t.type,")"]})]})}))}),(0,W.jsx)(M.A,{title:"Zoom In",children:(0,W.jsx)(d.A,{onClick:X,size:"small",children:(0,W.jsx)(ui.A,{})})}),(0,W.jsx)(M.A,{title:"Zoom Out",children:(0,W.jsx)(d.A,{onClick:Q,size:"small",children:(0,W.jsx)(hi.A,{})})}),(0,W.jsx)(M.A,{title:"Fit to Screen",children:(0,W.jsx)(d.A,{onClick:J,size:"small",children:(0,W.jsx)(ci.A,{})})}),(0,W.jsx)(M.A,{title:"Refresh",children:(0,W.jsx)(d.A,{onClick:$,size:"small",children:(0,W.jsx)(Jo.A,{})})}),(0,W.jsx)(d.A,{onClick:ee,sx:{ml:2},children:(0,W.jsx)(K.A,{})})]}),(0,W.jsx)(r.A,{sx:{p:0,position:"relative",flex:1,overflow:"hidden"},children:(0,W.jsxs)(i.A,{sx:{display:"flex",height:"100%"},children:[(0,W.jsxs)(i.A,{sx:{flex:1,position:"relative"},children:[(0,W.jsxs)(i.A,{sx:{position:"absolute",top:16,left:16,display:"flex",flexDirection:"column",gap:2,zIndex:10,maxHeight:"calc(100vh - 250px)"},children:[(0,W.jsx)(_e.A,{sx:{p:2,width:320,boxShadow:2},children:(0,W.jsxs)(is.A,{spacing:2,children:[(0,W.jsx)(he.A,{control:(0,W.jsx)(me.A,{checked:j,onChange:H}),label:"Show Inferred Nodes"}),(0,W.jsx)(he.A,{control:(0,W.jsx)(me.A,{checked:w,onChange:G,disabled:!!A}),label:A?"Deduplication disabled (focused)":"Deduplicate Nodes"}),(0,W.jsx)(he.A,{control:(0,W.jsx)(me.A,{checked:k,onChange:q,disabled:!!A}),label:"Show Unconnected Nodes"}),(0,W.jsx)(ne.A,{}),(0,W.jsx)(c.A,{variant:"subtitle2",children:"Line Style"}),(0,W.jsxs)(is.A,{direction:"row",spacing:1,sx:{mb:1},children:[(0,W.jsx)(g.A,{variant:0===_?"contained":"outlined",size:"small",onClick:()=>F(0),children:"Straight"}),(0,W.jsx)(g.A,{variant:.2===_?"contained":"outlined",size:"small",onClick:()=>F(.2),children:"Curved"}),(0,W.jsx)(g.A,{variant:.5===_?"contained":"outlined",size:"small",onClick:()=>F(.5),children:"Arc"})]}),(0,W.jsx)(c.A,{variant:"subtitle2",sx:{mb:1},children:"Cluster Spacing"}),(0,W.jsx)(i.A,{sx:{px:2,mb:2},children:(0,W.jsx)(ma.Ay,{value:E,onChange:(e,t)=>R(C,S,t),min:0,max:1,step:.1,valueLabelDisplay:"auto",marks:[{value:0,label:"Spread"},{value:.5,label:"Balanced"},{value:1,label:"Compact"}],sx:{"& .MuiSlider-markLabel":{fontSize:"0.7rem"},'& .MuiSlider-markLabel[data-index="2"]':{transform:"translateX(-70%)"}}})}),(0,W.jsx)(c.A,{variant:"subtitle2",children:"Force Strength"}),(0,W.jsx)(ma.Ay,{value:C,onChange:(e,t)=>R(t,S,E),min:-1e3,max:-100,valueLabelDisplay:"auto"}),(0,W.jsx)(c.A,{variant:"subtitle2",children:"Link Distance"}),(0,W.jsx)(ma.Ay,{value:S,onChange:(e,t)=>R(C,t,E),min:50,max:500,valueLabelDisplay:"auto"})]})}),(0,W.jsxs)(_e.A,{sx:{p:2,width:320,boxShadow:2},children:[(0,W.jsx)(c.A,{variant:"subtitle2",gutterBottom:!0,children:"Entity Types"}),(0,W.jsx)(is.A,{spacing:.5,children:Object.entries({Event:"#D62728",Conference:"#E91E63",Person:"#68CCE5",System:"#FCC940",Concept:"#F25A29",Unknown:"#C5C5C5"}).map(e=>{let[t,n]=e;return(0,W.jsxs)(i.A,{sx:{display:"flex",alignItems:"center",gap:1},children:[(0,W.jsx)(i.A,{sx:{width:12,height:12,borderRadius:"50%",backgroundColor:n,border:"1px solid rgba(0,0,0,0.2)"}}),(0,W.jsx)(c.A,{variant:"caption",children:t})]},t)})})]})]}),!y&&!b&&(0,W.jsx)(_e.A,{sx:{position:"absolute",top:16,right:16,p:2,zIndex:10,minWidth:150,boxShadow:2},children:(0,W.jsxs)(is.A,{spacing:1,children:[A&&(0,W.jsx)(V.A,{label:"Focused View",size:"small",color:"secondary",variant:"filled"}),(0,W.jsxs)(c.A,{variant:"caption",children:["Nodes: ",f.nodes.length,x.nodes.length!==f.nodes.length&&" / "+x.nodes.length]}),(0,W.jsxs)(c.A,{variant:"caption",children:["Links: ",f.links.length,x.links.length!==f.links.length&&" / "+x.links.length]}),w&&!A&&(0,W.jsx)(V.A,{label:"Deduplicated",size:"small",variant:"outlined"})]})}),y&&(0,W.jsxs)(i.A,{sx:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",zIndex:20,display:"flex",flexDirection:"column",alignItems:"center",gap:2,bgcolor:"rgba(255, 255, 255, 0.9)",p:3,borderRadius:2,boxShadow:3},children:[(0,W.jsx)(Y.A,{}),(0,W.jsx)(c.A,{children:"Loading entity data..."})]}),b&&!y&&(0,W.jsx)(h.A,{severity:"warning",sx:{m:2,position:"absolute",top:0,left:0,right:0,zIndex:20},children:b}),(0,W.jsx)("div",{ref:p,style:{width:"100%",height:"100%",minHeight:"600px",display:y||b?"none":"block",backgroundColor:"#fafafa"}})]}),v&&(0,W.jsx)(_e.A,{sx:{width:400,p:2,overflow:"auto",maxHeight:"100%"},children:(0,W.jsx)(te.A,{children:(0,W.jsxs)(Qt.A,{children:[(0,W.jsxs)(is.A,{direction:"row",justifyContent:"space-between",alignItems:"center",sx:{mb:2},children:[(0,W.jsx)(c.A,{variant:"h6",children:v.name}),(0,W.jsx)(d.A,{size:"small",onClick:()=>{L(null),z(null)},children:(0,W.jsx)(K.A,{fontSize:"small"})})]}),(0,W.jsxs)(is.A,{direction:"row",spacing:1,sx:{mb:2},children:[(0,W.jsx)(V.A,{label:v.type,size:"small",sx:{backgroundColor:v.color,color:"white"}}),A===v.id&&(0,W.jsx)(V.A,{label:"Focused",size:"small",color:"secondary",variant:"outlined"})]}),(0,W.jsxs)(i.A,{sx:{mb:2,p:1,bgcolor:"grey.100",borderRadius:1},children:[(0,W.jsx)(c.A,{variant:"caption",color:"textSecondary",children:"Connections"}),(0,W.jsxs)(c.A,{variant:"body2",children:[x.links.filter(e=>{const t="object"===typeof e.source?e.source.id:e.source,n="object"===typeof e.target?e.target.id:e.target;return t===v.id||n===v.id}).length," relationships"]})]}),Object.entries(v.attributes||{}).length>0&&(0,W.jsxs)(W.Fragment,{children:[(0,W.jsx)(c.A,{variant:"subtitle2",gutterBottom:!0,sx:{mt:2},children:"Attributes"}),(0,W.jsx)(is.A,{spacing:1,sx:{mb:2},children:Object.entries(v.attributes).map(e=>{let[t,n]=e;return(0,W.jsxs)(i.A,{children:[(0,W.jsx)(c.A,{variant:"caption",color:"textSecondary",children:t}),(0,W.jsx)(c.A,{variant:"body2",children:String(n)})]},t)})})]}),(0,W.jsx)(ne.A,{sx:{my:2}}),(0,W.jsx)(c.A,{variant:"subtitle2",gutterBottom:!0,children:"Connected Entities"}),(0,W.jsx)(is.A,{spacing:1,sx:{maxHeight:300,overflow:"auto",mb:2},children:(()=>{const e=new Map;return x.links.forEach(t=>{const n="object"===typeof t.source?t.source.id:t.source,a="object"===typeof t.target?t.target.id:t.target;if(n===v.id){const n=x.nodes.find(e=>e.id===a);n&&(e.has(n.id)||e.set(n.id,{node:n,relationships:[]}),e.get(n.id).relationships.push({type:t.relationship||"related_to",direction:"outgoing"}))}if(a===v.id){const a=x.nodes.find(e=>e.id===n);a&&(e.has(a.id)||e.set(a.id,{node:a,relationships:[]}),e.get(a.id).relationships.push({type:t.relationship||"related_to",direction:"incoming"}))}}),0===e.size?(0,W.jsx)(c.A,{variant:"body2",color:"textSecondary",children:"No connections found"}):Array.from(e.values()).map(e=>{let{node:t,relationships:n}=e;return(0,W.jsx)(te.A,{variant:"outlined",sx:{p:1,cursor:"pointer","&:hover":{bgcolor:"action.hover"}},onClick:()=>{L(t),z(t.id)},children:(0,W.jsxs)(is.A,{direction:"row",spacing:1,alignItems:"center",children:[(0,W.jsx)(i.A,{sx:{width:12,height:12,borderRadius:"50%",backgroundColor:t.color||Z(t.type),border:"1px solid rgba(0,0,0,0.2)",flexShrink:0}}),(0,W.jsxs)(i.A,{sx:{flex:1,minWidth:0},children:[(0,W.jsx)(c.A,{variant:"body2",noWrap:!0,children:t.name}),(0,W.jsxs)(is.A,{direction:"row",spacing:.5,flexWrap:"wrap",children:[(0,W.jsx)(c.A,{variant:"caption",color:"textSecondary",children:t.type}),n.map((e,t)=>(0,W.jsx)(V.A,{label:("incoming"===e.direction?"\u2190":"\u2192")+" "+e.type,size:"small",variant:"outlined",sx:{height:18,fontSize:"0.7rem"}},t))]})]})]})},t.id)})})()}),(0,W.jsxs)(is.A,{direction:"row",spacing:1,sx:{mt:2},children:[A!==v.id&&(0,W.jsx)(g.A,{variant:"contained",size:"small",onClick:()=>z(v.id),children:"Focus on Node"}),A===v.id&&(0,W.jsx)(g.A,{variant:"outlined",size:"small",onClick:()=>{z(null)},children:"Show All"})]})]})})})]})})]})};var cr=n(49715);const dr=e=>{let{open:t,onClose:n,indexName:a,indexType:u,workspaceUrl:m,endpointName:p,backendId:x}=e;const[f,y]=(0,s.useState)([]),[b,v]=(0,s.useState)(!1),[A,j]=(0,s.useState)(""),[w,k]=(0,s.useState)(""),[C,S]=(0,s.useState)([]),_=(0,s.useCallback)(async()=>{v(!0),j("");try{const e={index_name:a,workspace_url:m,endpoint_name:p,index_type:u,limit:30};x&&(e.backend_id=x);const t=await ve.uE.get("/memory-backend/databricks/index-documents",{params:e});t.data.success?y(t.data.documents||[]):j(t.data.message||"Failed to fetch documents")}catch(e){j("Failed to fetch documents. Please try again.")}finally{v(!1)}},[a,m,p,u,x]);(0,s.useEffect)(()=>{t&&a&&m&&p&&_()},[t,a,m,p,_]),(0,s.useEffect)(()=>{if(w){const e=w.toLowerCase(),t=f.filter(t=>{var n,a,s;return(null==(n=t.text)?void 0:n.toLowerCase().includes(e))||(null==(a=t.id)?void 0:a.toLowerCase().includes(e))||(null==(s=JSON.stringify(t.metadata))?void 0:s.toLowerCase().includes(e))});S(t)}else S(f)},[w,f]);const E=e=>{if(!e)return null;try{return"string"===typeof e?JSON.stringify(JSON.parse(e),null,2):JSON.stringify(e,null,2)}catch(t){return String(e)}};return(0,W.jsxs)(o.A,{open:t,onClose:n,maxWidth:"lg",fullWidth:!0,PaperProps:{sx:{height:"80vh",display:"flex",flexDirection:"column"}},children:[(0,W.jsxs)(l.A,{children:[(0,W.jsxs)(i.A,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[(0,W.jsxs)(i.A,{sx:{display:"flex",alignItems:"center",gap:2},children:[(0,W.jsx)(c.A,{variant:"h6",children:"Index Documents"}),(0,W.jsx)(V.A,{label:{short_term:"Short-term Memory",long_term:"Long-term Memory",entity:"Entity Memory",document:"Document Embeddings"}[u]||u,color:{short_term:"primary",long_term:"secondary",entity:"success",document:"info"}[u]||"default",size:"small"})]}),(0,W.jsxs)(i.A,{sx:{display:"flex",alignItems:"center",gap:1},children:[(0,W.jsx)(M.A,{title:"Refresh",children:(0,W.jsx)(d.A,{onClick:_,disabled:b,children:(0,W.jsx)(Jo.A,{})})}),(0,W.jsx)(d.A,{onClick:n,children:(0,W.jsx)(K.A,{})})]})]}),(0,W.jsxs)(c.A,{variant:"caption",color:"text.secondary",sx:{mt:1,display:"block"},children:[a," (",C.length," of ",f.length," documents)"]})]}),(0,W.jsxs)(r.A,{dividers:!0,sx:{flex:1,overflow:"auto"},children:[(0,W.jsx)(i.A,{sx:{mb:2},children:(0,W.jsx)(U.A,{fullWidth:!0,size:"small",placeholder:"Search documents...",value:w,onChange:e=>k(e.target.value),InputProps:{startAdornment:(0,W.jsx)(ae.A,{position:"start",children:(0,W.jsx)(cr.A,{})})}})}),b&&(0,W.jsx)(i.A,{sx:{display:"flex",justifyContent:"center",py:4},children:(0,W.jsx)(Y.A,{})}),A&&(0,W.jsx)(h.A,{severity:"error",sx:{mb:2},children:A}),!b&&!A&&0===C.length&&(0,W.jsx)(h.A,{severity:"info",children:w?"No documents match your search.":"No documents found in this index."}),!b&&!A&&C.length>0&&(0,W.jsx)(i.A,{sx:{display:"flex",flexDirection:"column",gap:2},children:C.map((e,t)=>(0,W.jsxs)(_e.A,{variant:"outlined",sx:{p:2},children:[(0,W.jsxs)(i.A,{sx:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",mb:1},children:[(0,W.jsxs)(c.A,{variant:"subtitle2",color:"primary",children:["Document #",t+1]}),(0,W.jsx)(M.A,{title:"Copy document text",children:(0,W.jsx)(d.A,{size:"small",onClick:()=>{return t=e.text,void navigator.clipboard.writeText(t);var t},children:(0,W.jsx)(Ha.A,{fontSize:"small"})})})]}),e.id&&(0,W.jsxs)(c.A,{variant:"caption",color:"text.secondary",sx:{display:"block",mb:1},children:["ID: ",e.id]}),(0,W.jsx)(ne.A,{sx:{my:1}}),(0,W.jsx)(c.A,{variant:"body2",sx:{whiteSpace:"pre-wrap",wordBreak:"break-word",mb:e.metadata?1:0},children:e.text}),e.metadata&&Object.keys(e.metadata).length>0&&(0,W.jsxs)(W.Fragment,{children:[(0,W.jsx)(ne.A,{sx:{my:1}}),(0,W.jsxs)(i.A,{children:[(0,W.jsx)(c.A,{variant:"caption",color:"text.secondary",sx:{fontWeight:"bold"},children:"Metadata:"}),(0,W.jsx)(i.A,{component:"pre",sx:{backgroundColor:"grey.50",p:1,borderRadius:1,overflow:"auto",fontSize:"0.75rem",mt:.5,fontFamily:"monospace"},children:E(e.metadata)})]})]})]},e.id||t))})]}),(0,W.jsx)(H.A,{children:(0,W.jsx)(g.A,{onClick:n,children:"Close"})})]})},ur=()=>{var e,t,n,a,o,r,l,u;const[m,g]=(0,s.useState)("disabled"),[p,x]=(0,s.useState)("auto"),[f,y]=(0,s.useState)(null),[b,v]=(0,s.useState)("ml"),[A,j]=(0,s.useState)("agents"),[w,k]=(0,s.useState)("databricks-bge-large-en"),[C,S]=(0,s.useState)(!1),[_,E]=(0,s.useState)(null),[I,T]=(0,s.useState)(!1),[D,O]=(0,s.useState)(""),[N,P]=(0,s.useState)(null),[M,z]=(0,s.useState)({}),[L,R]=(0,s.useState)(null),[F,B]=(0,s.useState)(!1),[V,U]=(0,s.useState)(null),[H,K]=(0,s.useState)({}),[G,q]=(0,s.useState)(!1),[J,X]=(0,s.useState)(!1),[Q,Z]=(0,s.useState)(!1),[$,ee]=(0,s.useState)({workspace_url:"",endpoint_name:"",document_endpoint_name:"",short_term_index:"",long_term_index:"",entity_index:"",document_index:"",embedding_model:"databricks-bge-large-en"}),[te,ae]=(0,s.useState)(!1),[se,ie]=(0,s.useState)(null),{updateConfig:oe,visualizationOpen:re,visualizationIndex:le,openVisualization:ce,closeVisualization:de}=Oo();(0,s.useEffect)(()=>{ge(),ue()},[]),(0,s.useEffect)(()=>{if(null!=N&&N.workspace_url&&N.backend_id){const e=setTimeout(()=>{fe()},500);return()=>clearTimeout(e)}},[null==N?void 0:N.backend_id]),(0,s.useEffect)(()=>{},[N]),(0,s.useEffect)(()=>{(async()=>{null!=N&&N.workspace_url&&await fe()})()},[N]),(0,s.useEffect)(()=>{if(L&&null!=N&&N.endpoints){var e,t;const n={};if(null!=(e=N.endpoints.memory)&&e.name)if(L.endpoints[N.endpoints.memory.name]){const e=L.endpoints[N.endpoints.memory.name];n.memory={name:e.name,state:e.state||"UNKNOWN",ready:e.ready||!1,can_delete_indexes:"ONLINE"===e.state}}else n.memory={name:N.endpoints.memory.name,state:"NOT_FOUND",ready:!1,can_delete_indexes:!1};if(null!=(t=N.endpoints.document)&&t.name)if(L.endpoints[N.endpoints.document.name]){const e=L.endpoints[N.endpoints.document.name];n.document={name:e.name,state:e.state||"UNKNOWN",ready:e.ready||!1,can_delete_indexes:"ONLINE"===e.state}}else n.document={name:N.endpoints.document.name,state:"NOT_FOUND",ready:!1,can_delete_indexes:!1};z(n)}},[L,N]);const ue=async()=>{try{var e;const t=await ve.uE.get("/databricks/environment");null!=(e=t.data)&&e.databricks_host&&y(t.data.databricks_host)}catch(D){}},ge=async()=>{try{const e=await ve.uE.get("/memory-backend/configs/default");if(!e.data||0===Object.keys(e.data).length){try{const e=await ve.uE.get("/memory-backend/configs");if(e.data&&e.data.length>0){const t=e.data[0];return pe(t),void q(!0)}}catch(t){}return g("disabled"),void q(!0)}pe(e.data),q(!0)}catch(D){var e;if(D instanceof Le.pe&&404===(null==(e=D.response)?void 0:e.status))try{const e=await ve.uE.get("/memory-backend/configs");if(e.data&&e.data.length>0){const t=e.data[0];return pe(t),void q(!0)}}catch(t){g("disabled")}g("disabled"),q(!0)}},pe=e=>{if(e&&e.backend_type===gs.DATABRICKS&&e.databricks_config){const t=e.databricks_config,n={backend_id:e.id,workspace_url:t.workspace_url,catalog:t.catalog||"ml",schema:t.schema||"agents",endpoints:{memory:t.endpoint_name?{name:t.endpoint_name}:void 0,document:t.document_endpoint_name?{name:t.document_endpoint_name}:void 0},indexes:{short_term:t.short_term_index?{name:t.short_term_index}:void 0,long_term:t.long_term_index?{name:t.long_term_index}:void 0,entity:t.entity_index?{name:t.entity_index}:void 0,document:t.document_index?{name:t.document_index}:void 0}};P(n),g("databricks"),Z(e.enable_relationship_retrieval||!1)}else e&&e.backend_type===gs.DEFAULT&&(P({backend_id:e.id}),g("disabled"))},xe=async e=>{if(e.backend_id)try{var t,n,a,s,i,o;const r={databricks_config:{workspace_url:e.workspace_url,catalog:e.catalog,schema:e.schema,endpoint_name:(null==(t=e.endpoints)||null==(t=t.memory)?void 0:t.name)||null,document_endpoint_name:(null==(n=e.endpoints)||null==(n=n.document)?void 0:n.name)||null,short_term_index:(null==(a=e.indexes)||null==(a=a.short_term)?void 0:a.name)||null,long_term_index:(null==(s=e.indexes)||null==(s=s.long_term)?void 0:s.name)||null,entity_index:(null==(i=e.indexes)||null==(i=i.entity)?void 0:i.name)||null,document_index:(null==(o=e.indexes)||null==(o=o.document)?void 0:o.name)||null,auth_type:"default",embedding_dimension:768}},l=await ve.uE.put("/memory-backend/configs/"+e.backend_id,r);window.dispatchEvent(new CustomEvent("memory-backend-updated",{detail:{config:l.data}})),l.data}catch(D){}},fe=async()=>{if(null!=N&&N.workspace_url)try{const o=await ve.uE.get("/memory-backend/databricks/verify-resources",{params:{workspace_url:N.workspace_url,backend_id:N.backend_id}});if(o.data.success){var e,t,n,a,s,i;R(o.data.resources);const r=Object.assign({},N);let l=!1;null!=(e=N.endpoints)&&e.memory&&(o.data.resources.endpoints[N.endpoints.memory.name]||(r.endpoints=Object.assign({},r.endpoints,{memory:void 0}),l=!0)),null!=(t=N.endpoints)&&t.document&&(o.data.resources.endpoints[N.endpoints.document.name]||(r.endpoints=Object.assign({},r.endpoints,{document:void 0}),l=!0)),null!=(n=N.indexes)&&n.short_term&&(o.data.resources.indexes[N.indexes.short_term.name]||(r.indexes=Object.assign({},r.indexes,{short_term:void 0}),l=!0)),null!=(a=N.indexes)&&a.long_term&&(o.data.resources.indexes[N.indexes.long_term.name]||(r.indexes=Object.assign({},r.indexes,{long_term:void 0}),l=!0)),null!=(s=N.indexes)&&s.entity&&(o.data.resources.indexes[N.indexes.entity.name]||(r.indexes=Object.assign({},r.indexes,{entity:void 0}),l=!0)),null!=(i=N.indexes)&&i.document&&(o.data.resources.indexes[N.indexes.document.name]||(r.indexes=Object.assign({},r.indexes,{document:void 0}),l=!0)),l&&(P(r),await xe(r))}}catch(D){}},ye=async e=>{var t,n;if(null==N||null==(t=N.indexes)||!t[e])return;const a=null==(n=N.indexes[e])?void 0:n.name;if(!a)return;const s=H[a];if("NOT_FOUND"===(null==s?void 0:s.status)||"DELETED"===(null==s?void 0:s.index_type))return void O("Cannot delete index: "+e.replace("_"," ")+" index has already been deleted from Databricks.");const i=M["document"===e?"document":"memory"];if(i&&!i.can_delete_indexes)return void O("Cannot delete index: Endpoint is "+i.state+". Indexes can only be deleted when the endpoint is ONLINE.");if(window.confirm("Are you sure you want to delete the "+e.replace("_"," ")+" index?")){S(!0),O("");try{var o,r,l;const t=await ve.uE.delete("/memory-backend/databricks/index",{data:{workspace_url:N.workspace_url,index_name:null==(o=N.indexes[e])?void 0:o.name,endpoint_name:"document"===e?null==(r=N.endpoints)||null==(r=r.document)?void 0:r.name:null==(l=N.endpoints)||null==(l=l.memory)?void 0:l.name}});if(t.data.success){const t=Object.assign({},N,{indexes:Object.assign({},N.indexes,{[e]:void 0})});P(t),await xe(t)}else O(t.data.message||"Failed to delete index")}catch(D){O("Failed to delete index. Please try again.")}finally{S(!1)}}},be=async(e,t)=>{if(null!=N&&N.workspace_url){K(t=>Object.assign({},t,{[e]:{doc_count:0,loading:!0}}));try{const s=await ve.uE.get("/memory-backend/databricks/index-info",{params:{workspace_url:N.workspace_url,index_name:e,endpoint_name:t}});if(s.data.success)K(t=>Object.assign({},t,{[e]:{doc_count:s.data.doc_count||0,loading:!1,status:s.data.status||"UNKNOWN",ready:s.data.ready||!1,index_type:s.data.index_type||"UNKNOWN"}}));else{var n,a;const t=(null==(n=s.data.message)?void 0:n.toLowerCase().includes("not found"))||(null==(a=s.data.message)?void 0:a.toLowerCase().includes("does not exist"));K(n=>Object.assign({},n,{[e]:{doc_count:0,loading:!1,error:s.data.message,status:t?"NOT_FOUND":"ERROR",ready:!1,index_type:"DELETED"}}))}}catch(D){var s,i;const n=D instanceof Le.pe&&404===(null==(s=D.response)?void 0:s.status),a=D instanceof Le.pe?(null==(i=D.response)||null==(i=i.data)?void 0:i.detail)||D.message:"Failed to fetch index info";K(t=>Object.assign({},t,{[e]:{doc_count:0,loading:!1,error:a,status:n?"NOT_FOUND":"ERROR",ready:!1,index_type:n?"DELETED":"UNKNOWN"}}))}}};(0,s.useEffect)(()=>{if(null!=N&&N.indexes&&null!=N&&N.workspace_url){var e,t,n,a,s,i,o,r;const l=N.indexes;null!=(e=l.short_term)&&e.name&&null!=(t=N.endpoints)&&null!=(t=t.memory)&&t.name&&be(l.short_term.name,N.endpoints.memory.name),null!=(n=l.long_term)&&n.name&&null!=(a=N.endpoints)&&null!=(a=a.memory)&&a.name&&be(l.long_term.name,N.endpoints.memory.name),null!=(s=l.entity)&&s.name&&null!=(i=N.endpoints)&&null!=(i=i.memory)&&i.name&&be(l.entity.name,N.endpoints.memory.name),null!=(o=l.document)&&o.name&&null!=(r=N.endpoints)&&null!=(r=r.document)&&r.name&&be(l.document.name,N.endpoints.document.name)}},[null==N?void 0:N.indexes,null==N?void 0:N.workspace_url]);const Ae=async e=>{var t,n;if(null==N||null==(t=N.indexes)||!t[e]||null==N||!N.workspace_url||null==N||!N.backend_id)return;const a=null==(n=N.indexes[e])?void 0:n.name;if(!a)return;if(window.confirm("Are you sure you want to empty the "+e.replace("_"," ")+" index? This will delete all documents but keep the index structure.")){S(!0),O("");try{var s,i,o;const t=(null==(s=(await ve.uE.get("/memory-backend/configs/"+N.backend_id)).data)||null==(s=s.databricks_config)?void 0:s.embedding_dimension)||768,n="document"===e?null==(i=N.endpoints)||null==(i=i.document)?void 0:i.name:null==(o=N.endpoints)||null==(o=o.memory)?void 0:o.name;if(!n)return void O("Could not determine endpoint for this index");const l=await ve.uE.post("/memory-backend/databricks/empty-index",{workspace_url:N.workspace_url,index_name:a,endpoint_name:n,index_type:e,embedding_dimension:t});if(l.data.success){setTimeout(()=>{be(a,n)},3e3);const t=l.data.deleted_count||0;O(""),l.data.message&&l.data.message.includes("created new index")?alert("Index "+e.replace("_"," ")+" was not found, so a new one was created successfully."):alert("Successfully emptied "+e.replace("_"," ")+" index. "+t+" documents removed.\n\nNote: The index was deleted and recreated to clear all documents.")}else{var r;const e=l.data.message||"Failed to empty index";O(e),null!=(r=l.data.error)&&r.includes("not supported")&&alert(e)}}catch(D){O("Failed to empty index. Please try again.")}finally{S(!1)}}},je=(e,t)=>{var n,a;const s="document"===e?null==N||null==(n=N.endpoints)||null==(n=n.document)?void 0:n.name:null==N||null==(a=N.endpoints)||null==(a=a.memory)?void 0:a.name;s?(ie({name:t,type:e,endpointName:s}),ae(!0)):O("Cannot view documents: endpoint not configured")};return G?(0,W.jsxs)(i.A,{children:[(0,W.jsx)(i.A,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",mb:3},children:(0,W.jsxs)(i.A,{sx:{display:"flex",alignItems:"center"},children:[(0,W.jsx)(No.A,{sx:{mr:1.5,color:"primary.main",fontSize:"1.4rem"}}),(0,W.jsx)(c.A,{variant:"h6",children:"Memory Configuration"})]})}),(0,W.jsxs)(_e.A,{variant:"outlined",sx:{p:3,borderRadius:2,bgcolor:"background.paper"},children:[(0,W.jsxs)(Jt.A,{value:m,onChange:async e=>{const t=e.target.value;if(g(t),"disabled"===t){oe({backend_type:gs.DEFAULT,enable_short_term:!1,enable_long_term:!1,enable_entity:!1});try{await Wo.switchToDisabledMode();P(null),O("")}catch(D){O("Failed to save disabled mode. Please try again.")}}},row:!0,sx:{mb:2},children:[(0,W.jsx)(he.A,{value:"databricks",control:(0,W.jsx)(Yt.A,{size:"small"}),label:(0,W.jsxs)(i.A,{sx:{display:"flex",alignItems:"center"},children:[(0,W.jsx)(Po.A,{sx:{fontSize:18,mr:.5}}),"Databricks Vector Search"]}),sx:{mr:3}}),(0,W.jsx)(he.A,{value:"disabled",control:(0,W.jsx)(Yt.A,{size:"small"}),label:(0,W.jsxs)(i.A,{sx:{display:"flex",alignItems:"center"},children:[(0,W.jsx)(Mo.A,{sx:{fontSize:18,mr:.5}}),"Disabled"]})})]}),(0,W.jsx)(Ui.A,{in:"databricks"===m,children:(0,W.jsxs)(i.A,{children:[(!N||!N.workspace_url)&&(0,W.jsxs)(W.Fragment,{children:[(0,W.jsx)(h.A,{severity:"info",sx:{mb:2},children:"Choose how to configure Databricks Vector Search"}),(0,W.jsxs)(Jt.A,{value:p,onChange:e=>x(e.target.value),row:!0,sx:{mb:2},children:[(0,W.jsx)(he.A,{value:"auto",control:(0,W.jsx)(Yt.A,{size:"small"}),label:(0,W.jsxs)(i.A,{children:[(0,W.jsx)(c.A,{variant:"body2",fontWeight:"medium",children:"Auto-create"}),(0,W.jsx)(c.A,{variant:"caption",color:"text.secondary",children:"Automatically creates endpoints and indexes"})]}),sx:{mr:4}}),(0,W.jsx)(he.A,{value:"manual",control:(0,W.jsx)(Yt.A,{size:"small"}),label:(0,W.jsxs)(i.A,{children:[(0,W.jsx)(c.A,{variant:"body2",fontWeight:"medium",children:"Manual setup"}),(0,W.jsx)(c.A,{variant:"caption",color:"text.secondary",children:"Use existing endpoints and indexes"})]})})]})]}),D&&(0,W.jsx)(h.A,{severity:"error",sx:{mb:2},onClose:()=>O(""),children:D}),"auto"===p&&(!N||!N.workspace_url)&&(0,W.jsx)(er,{detectedWorkspaceUrl:f,catalog:b,schema:A,embeddingModel:w,isSettingUp:C,error:D,onCatalogChange:v,onSchemaChange:j,onEmbeddingModelChange:k,onSetup:async()=>{const e=f;if(e){S(!0),O(""),E(null);try{var t;try{await Wo.deleteAllConfigurations()}catch(D){}await Wo.cleanupDisabledConfigurations();const n=await Wo.performOneClickSetup({workspace_url:e,catalog:b,schema:A,embedding_dimension:(null==(t=Ro.find(e=>e.value===w))?void 0:t.dimension)||768});E(n),T(!0),n.success&&(P({workspace_url:e,catalog:n.catalog||b,schema:n.schema||A,endpoints:n.endpoints,indexes:n.indexes}),oe({backend_type:gs.DATABRICKS,enable_short_term:!0,enable_long_term:!0,enable_entity:!0}),setTimeout(()=>{ge()},1500))}catch(D){var n;const t=D instanceof Le.pe?null==(n=D.response)||null==(n=n.data)?void 0:n.detail:D instanceof Error?D.message:"Failed to complete setup";O(t||"Failed to complete setup. Please check your configuration and try again.")}finally{S(!1)}}else O("No Databricks workspace detected. Please configure your Databricks workspace in the Databricks section first.")}}),"manual"===p&&(!N||!N.workspace_url)&&(0,W.jsx)($o,{manualConfig:$,isSettingUp:C,error:D,onConfigChange:ee,onSave:async()=>{if(!$.workspace_url||!$.endpoint_name||!$.document_endpoint_name||!$.short_term_index||!$.long_term_index||!$.entity_index||!$.document_index)return void O("All fields are required. Please provide workspace URL, both endpoints, and all four indexes.");const e=[{name:"Short-term index",value:$.short_term_index},{name:"Long-term index",value:$.long_term_index},{name:"Entity index",value:$.entity_index},{name:"Document index",value:$.document_index}];for(const a of e)if(!Uo(a.value))return void O(a.name+" must be in the format: catalog.schema.indexname (e.g., ml.agents.short_term_memory)");S(!0),O("");try{var t;try{await ve.uE.delete("/memory-backend/configs/disabled/cleanup")}catch(n){}let e=b,a=A;const s=$.short_term_index.split(".");s.length>=3&&(e=s[0],a=s[1]);let i=null==N?void 0:N.backend_id;if(!i)try{const e=await ve.uE.get("/memory-backend/configs/default");e.data&&e.data.id&&(i=e.data.id)}catch(D){}const o={name:"Databricks Vector Search Configuration",description:"Manually configured Databricks Vector Search",backend_type:gs.DATABRICKS,enable_short_term:!0,enable_long_term:!0,enable_entity:!0,databricks_config:{workspace_url:$.workspace_url,endpoint_name:$.endpoint_name,document_endpoint_name:$.document_endpoint_name,short_term_index:$.short_term_index,long_term_index:$.long_term_index,entity_index:$.entity_index,document_index:$.document_index,auth_type:"default",embedding_dimension:(null==(t=Ro.find(e=>e.value===$.embedding_model))?void 0:t.dimension)||768,catalog:e,schema:a}};let r;i?r=await ve.uE.put("/memory-backend/configs/"+i,o):(r=await ve.uE.post("/memory-backend/configs",o),r.data&&await ve.uE.post("/memory-backend/configs/"+r.data.id+"/set-default")),window.dispatchEvent(new CustomEvent("memory-backend-updated",{detail:{config:r.data}})),r.data&&(oe({backend_type:gs.DATABRICKS,enable_short_term:!0,enable_long_term:!0,enable_entity:!0}),await ge(),ee({workspace_url:"",endpoint_name:"",document_endpoint_name:"",short_term_index:"",long_term_index:"",entity_index:"",document_index:"",embedding_model:"databricks-bge-large-en"}))}catch(D){O("Failed to save configuration. Please try again.")}finally{S(!1)}}}),null,N&&N.workspace_url&&(0,W.jsx)(Zo,{savedConfig:N,isEditingConfig:F,isSettingUp:C,onStartEdit:()=>{U(JSON.parse(JSON.stringify(N))),B(!0)},onSaveEdit:async()=>{if(V&&V.backend_id){S(!0),O("");try{await xe(V),P(V),B(!1),U(null),setTimeout(()=>{fe()},500)}catch(D){O("Failed to save configuration. Please try again.")}finally{S(!1)}}},onCancelEdit:()=>{U(null),B(!1)},onRefresh:fe,children:(0,W.jsx)(i.A,{sx:{mt:1.5},children:F?(0,W.jsx)(tr,{editedConfig:V,onEditChange:(e,t)=>{if(!V)return;const n=e.split("."),a=Object.assign({},V);"endpoints"===n[0]&&n[1]&&"name"===n[2]?(a.endpoints||(a.endpoints={}),a.endpoints[n[1]]=t?{name:t}:void 0):"indexes"===n[0]&&n[1]&&"name"===n[2]&&(a.indexes||(a.indexes={}),a.indexes[n[1]]=t?{name:t}:void 0),U(a)}}):(0,W.jsxs)(W.Fragment,{children:[(0,W.jsx)(ar,{savedConfig:N,endpointStatuses:M,onDeleteEndpoint:async e=>{var t;if(null==N||null==(t=N.endpoints)||!t[e])return;const n=M[e],a="NOT_FOUND"===(null==n?void 0:n.state),s=0===Object.entries(N.endpoints||{}).filter(t=>{let[n,a]=t;return n!==e&&void 0!==a}).length,i=a?"The "+e+" endpoint no longer exists in Databricks. Remove it from configuration?":s?"This is the last endpoint. Deleting it will disable memory backend entirely. Continue?":"Are you sure you want to delete the "+e+" endpoint?";if(window.confirm(i)){S(!0),O("");try{if(s){await Wo.switchToDisabledMode();return g("disabled"),P(null),void oe({backend_type:gs.DEFAULT,enable_short_term:!1,enable_long_term:!1,enable_entity:!1})}if(a){const t=Object.assign({},N,{endpoints:Object.assign({},N.endpoints,{[e]:void 0})});P(t),await xe(t)}else{var o;const t=await ve.uE.delete("/memory-backend/databricks/endpoint",{data:{workspace_url:N.workspace_url,endpoint_name:null==(o=N.endpoints[e])?void 0:o.name}});if(t.data.success){const t=Object.assign({},N,{endpoints:Object.assign({},N.endpoints,{[e]:void 0})});P(t),await xe(t)}else O(t.data.message||"Failed to delete endpoint")}}catch(D){O("Failed to delete endpoint. Please try again.")}finally{S(!1)}}}}),(0,W.jsxs)(i.A,{sx:{mt:2,mb:2},children:[(0,W.jsx)(ne.A,{sx:{mb:1}}),(0,W.jsxs)(i.A,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",cursor:"pointer",py:.5},onClick:()=>X(!J),children:[(0,W.jsx)(c.A,{variant:"subtitle2",color:"text.secondary",children:"Advanced Settings"}),(0,W.jsx)(d.A,{size:"small",children:J?(0,W.jsx)(zo.A,{}):(0,W.jsx)(Lo.A,{})})]}),(0,W.jsx)(Ui.A,{in:J,children:(0,W.jsx)(i.A,{sx:{mt:1,pl:1},children:(0,W.jsx)(he.A,{control:(0,W.jsx)(me.A,{checked:Q,onChange:e=>(async e=>{if(Z(e),null!=N&&N.backend_id)try{await ve.uE.put("/memory-backend/configs/"+N.backend_id,{enable_relationship_retrieval:e})}catch(D){O("Failed to save advanced settings")}})(e.target.checked),color:"primary"}),label:(0,W.jsxs)(i.A,{children:[(0,W.jsx)(c.A,{variant:"body2",children:"Enable Relationship-Based Entity Retrieval"}),(0,W.jsx)(c.A,{variant:"caption",color:"text.secondary",children:"Experimental: Use graph-based relationships for smarter entity search instead of just semantic similarity."})]})})})}),(0,W.jsx)(ne.A,{sx:{mt:1}})]}),(0,W.jsxs)(i.A,{children:[(0,W.jsx)(c.A,{variant:"caption",color:"text.secondary",sx:{display:"block",mb:.5},children:"Indexes:"}),(0,W.jsxs)(i.A,{children:[(null==(e=N.indexes)?void 0:e.document)&&(0,W.jsx)(Xo,{title:"Knowledge Base",subtitle:"The knowledge base contains documentation embeddings used to provide context when creating crews, agents, and tasks. This helps the AI understand available tools, patterns, and best practices.",savedConfig:N,endpointName:null==(t=N.endpoints)||null==(t=t.document)?void 0:t.name,endpointType:"document",indexes:[{type:"document",name:null==(n=N.indexes.document)?void 0:n.name}],indexInfoMap:H,endpointStatuses:M,isSettingUp:C,onRefresh:async()=>{var e;if(null==N||null==(e=N.indexes)||!e.document||null==N||!N.workspace_url||null==N||!N.backend_id)return;if(window.confirm("Are you sure you want to re-seed the documentation? This will empty the index and reload all documentation.")){S(!0),O("");try{var t,n;const e=N.indexes.document.name,a=null==(t=N.endpoints)||null==(t=t.document)?void 0:t.name;if(!a)return void O("Could not determine document endpoint");const s=(null==(n=(await ve.uE.get("/memory-backend/configs/"+N.backend_id)).data)||null==(n=n.databricks_config)?void 0:n.embedding_dimension)||768,i=await ve.uE.post("/memory-backend/databricks/empty-index",{workspace_url:N.workspace_url,index_name:e,endpoint_name:a,index_type:"document",embedding_dimension:s});if(!i.data.success)throw new Error(i.data.message||"Failed to empty document index");const o=await ve.uE.post("/documentation-embeddings/seed-all");o.data.success?(E({success:!0,message:"Documentation re-seeding initiated successfully. This may take a few minutes to complete.",info:"The document index has been emptied and re-seeding has started. Documents will be processed in the background."}),T(!0),setTimeout(()=>{be(e,a)},5e3)):O(o.data.message||"Failed to initiate documentation re-seeding")}catch(D){const t=D instanceof Error?D.message:"Failed to re-seed documentation";if(D&&"object"===typeof D&&"response"in D){var a;O((null==(a=D.response)||null==(a=a.data)?void 0:a.detail)||t)}else O(t)}finally{S(!1)}}},onEmpty:e=>Ae(e),onDelete:e=>ye(e),onViewDocuments:je}),((null==(a=N.indexes)?void 0:a.short_term)||(null==(o=N.indexes)?void 0:o.long_term)||(null==(r=N.indexes)?void 0:r.entity))&&(0,W.jsx)(Xo,{title:"Memory Indexes",subtitle:"Memory indexes store agent conversations and interactions during runtime. Short-term memory holds recent context, long-term memory persists important information across sessions, and entity memory tracks relationships and facts about people, organizations, and concepts.",savedConfig:N,endpointName:null==(l=N.endpoints)||null==(l=l.memory)?void 0:l.name,endpointType:"memory",indexes:[N.indexes.short_term&&{type:"short_term",name:N.indexes.short_term.name},N.indexes.long_term&&{type:"long_term",name:N.indexes.long_term.name},N.indexes.entity&&{type:"entity",name:N.indexes.entity.name}].filter(e=>Boolean(e)),indexInfoMap:H,endpointStatuses:M,isSettingUp:C,onEmpty:e=>Ae(e),onDelete:e=>ye(e),onVisualize:(e,t)=>ce(t,e),onViewDocuments:je})]})]})]})})})]})}),(0,W.jsx)(Ui.A,{in:"disabled"===m,children:(0,W.jsx)(h.A,{severity:"info",sx:{mt:2},children:"Memory storage is disabled. Agents will not persist information between conversations."})}),(0,W.jsx)(Ko,{open:I,onClose:()=>T(!1),setupResult:_,workspaceUrl:f||"",savedConfigWorkspaceUrl:null==N?void 0:N.workspace_url}),(0,W.jsx)(lr,{open:re,onClose:de,indexName:null==le?void 0:le.name,workspaceUrl:null==N?void 0:N.workspace_url,endpointName:null==N||null==(u=N.endpoints)||null==(u=u.memory)?void 0:u.name}),se&&(0,W.jsx)(dr,{open:te,onClose:()=>{ae(!1),ie(null)},indexName:se.name,indexType:se.type,workspaceUrl:(null==N?void 0:N.workspace_url)||"",endpointName:se.endpointName,backendId:null==N?void 0:N.backend_id})]})]}):(0,W.jsxs)(i.A,{children:[(0,W.jsx)(i.A,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",mb:3},children:(0,W.jsxs)(i.A,{sx:{display:"flex",alignItems:"center"},children:[(0,W.jsx)(No.A,{sx:{mr:1.5,color:"primary.main",fontSize:"1.4rem"}}),(0,W.jsx)(c.A,{variant:"h6",children:"Memory Configuration"})]})}),(0,W.jsx)(_e.A,{variant:"outlined",sx:{p:3,borderRadius:2,bgcolor:"background.paper",display:"flex",justifyContent:"center",alignItems:"center",minHeight:200},children:(0,W.jsxs)(i.A,{sx:{textAlign:"center"},children:[(0,W.jsx)(Y.A,{size:40,sx:{mb:2}}),(0,W.jsx)(c.A,{variant:"body2",color:"text.secondary",children:"Loading memory configuration..."})]})})]})};var hr=n(51275),mr=n(74748),gr=n(62246),pr=n(57516);const xr={enabled:!1,instance_name:"kasal-lakebase",capacity:"CU_1",retention_days:14,node_count:1,instance_status:"NOT_CREATED"},fr=(0,A.vt)(e=>({databaseInfo:null,currentBackend:null,lakebaseConfig:xr,lakebaseMode:"connect",schemaExists:!1,showMigrationDialog:!1,migrationOption:"use",loading:!1,checkingInstance:!1,creatingInstance:!1,expandedSections:{lakebaseConfig:!1},error:null,success:null,setDatabaseInfo:t=>e({databaseInfo:t}),setCurrentBackend:t=>e({currentBackend:t}),setLakebaseConfig:t=>e(e=>({lakebaseConfig:Object.assign({},e.lakebaseConfig,t)})),setLakebaseMode:t=>e({lakebaseMode:t}),setSchemaExists:t=>e({schemaExists:t}),setShowMigrationDialog:t=>e({showMigrationDialog:t}),setMigrationOption:t=>e({migrationOption:t}),setLoading:t=>e({loading:t}),setCheckingInstance:t=>e({checkingInstance:t}),setCreatingInstance:t=>e({creatingInstance:t}),setExpandedSection:(t,n)=>e(e=>({expandedSections:Object.assign({},e.expandedSections,{[t]:n})})),setError:t=>e({error:t}),setSuccess:t=>e({success:t}),reset:()=>e({databaseInfo:null,currentBackend:null,lakebaseConfig:xr,lakebaseMode:"connect",schemaExists:!1,showMigrationDialog:!1,migrationOption:"use",loading:!1,checkingInstance:!1,creatingInstance:!1,expandedSections:{lakebaseConfig:!1},error:null,success:null})})),yr=["children","value","index"];function br(e){return"object"===typeof e&&null!==e&&"response"in e}function vr(e){const{children:t,value:n,index:s}=e,o=(0,a.A)(e,yr);return(0,W.jsx)("div",Object.assign({role:"tabpanel",hidden:n!==s,id:"database-tabpanel-"+s},o,{children:n===s&&(0,W.jsx)(i.A,{sx:{py:2},children:t})}))}const Ar=()=>{var e,t;const{databaseInfo:n,setDatabaseInfo:a,lakebaseConfig:u,setLakebaseConfig:m,lakebaseMode:p,setLakebaseMode:x,schemaExists:f,setSchemaExists:y,showMigrationDialog:b,setShowMigrationDialog:v,migrationOption:A,setMigrationOption:j,loading:w,setLoading:k,checkingInstance:C,setCheckingInstance:S,creatingInstance:_,setCreatingInstance:E,error:I,setError:T,success:D,setSuccess:O}=fr(),[N,P]=(0,s.useState)("disabled"),[M]=(0,s.useState)(!1),[z,L]=(0,s.useState)(!1),[R,F]=(0,s.useState)(null),[B,K]=(0,s.useState)(!1),[G,q]=(0,s.useState)(!1),[J,X]=(0,s.useState)(null),[Q,Z]=(0,s.useState)(null),[$,ee]=(0,s.useState)(0),[ne,ae]=(0,s.useState)(!1),[se,ie]=(0,s.useState)([]),[oe,le]=(0,s.useState)("users"),[ce,de]=(0,s.useState)("default"),[me,ge]=(0,s.useState)("kasal_backups"),[pe,xe]=(0,s.useState)(!1),fe=!1;(0,s.useEffect)(()=>{ye(),je(),be()},[]);const ye=async()=>{try{k(!0);const e=await ve.uE.get("/database-management/info");a(e.data)}catch(e){T("Failed to load database information")}finally{k(!1)}},be=async()=>{try{const e=We.getInstance(),t=(await e.getAPIKeys()).find(e=>"DATABRICKS_API_KEY"===e.name);xe(!!t&&!!t.value)}catch(I){xe(!1)}},Ae=(0,s.useCallback)(async e=>{try{var t;S(!0);const n=await ve.uE.get("/database-management/lakebase/instance/"+e);let a;const s=null==(t=n.data.state)?void 0:t.toUpperCase();a="READY"===s||"AVAILABLE"===s||"RUNNING"===s?"READY":"STOPPED"===s||"STOPPING"===s?"STOPPED":"CREATING"===s||"STARTING"===s?"CREATING":"ERROR"===s||"FAILED"===s?"ERROR":"NOT_FOUND"===s?"NOT_FOUND":n.data.read_write_dns?"READY":"STOPPED",m({instance_status:a,endpoint:n.data.read_write_dns,created_at:n.data.created_at})}catch(a){var n;br(a)&&404===(null==(n=a.response)?void 0:n.status)&&m({instance_status:"NOT_CREATED"})}finally{S(!1)}},[S,m]),je=(0,s.useCallback)(async()=>{try{S(!0);const e=await ve.uE.get("/database-management/lakebase/config");e.data&&(m(e.data),P(e.data.enabled?"lakebase":"disabled"),e.data.enabled&&e.data.instance_name&&await Ae(e.data.instance_name))}catch(t){var e;!br(t)||null==(e=t.response)||e.status}finally{S(!1)}},[m,S,Ae]),we=e=>new Date(e).toLocaleString(),ke=e=>e<1?(1024*e).toFixed(2)+" KB":e>1024?(e/1024).toFixed(2)+" GB":e.toFixed(2)+" MB",Ce=async()=>{try{k(!0);const e=await ve.uE.post("/database-management/list-backups",{catalog:oe,schema:ce,volume_name:me});F(e.data)}catch(t){var e;const n=br(t)&&(null==(e=t.response)||null==(e=e.data)?void 0:e.error)||"Failed to load backups";T(n)}finally{k(!1)}},Se=async function(e,t){var n;void 0===e&&(e=!1),void 0===t&&(t=!0);try{var a;k(!0),T(null),O(""),ie([]),ae(!0);const i={"Content-Type":"application/json"},o=localStorage.getItem("token");o&&(i.Authorization="Bearer "+o);const r=localStorage.getItem("selectedGroupId");r&&(i.group_id=r);const l=await fetch(ve.$W.apiUrl+"/database-management/lakebase/migrate/stream",{method:"POST",headers:i,body:JSON.stringify({instance_name:u.instance_name,endpoint:u.endpoint,recreate_schema:e,migrate_data:t})});if(!l.ok)throw new Error("Migration failed: "+l.statusText);const c=null==(a=l.body)?void 0:a.getReader(),d=new TextDecoder;let h="";const m=[];for(;c;){const{done:e,value:t}=await c.read();if(e)break;h+=d.decode(t,{stream:!0});const a=h.split("\n");h=a.pop()||"";for(const i of a)if(i.startsWith("data: "))try{const e=JSON.parse(i.substring(6));let t="";switch(e.type){case"start":case"info":case"progress":case"success":case"warning":t=e.message,m.push(t),ie([...m]),O(m.slice(-5).join("\n"));break;case"table_start":case"table_complete":t="["+e.progress+"/"+e.total+"] "+e.message,m.push(t),ie([...m]),O(m.slice(-5).join("\n"));break;case"table_error":t="["+(e.progress||"?")+"/"+(e.total||"?")+"] "+e.message,m.push(t),ie([...m]);break;case"complete":m.push(""),m.push(e.message),ie([...m]),O(m.slice(-5).join("\n"));break;case"result":m.push(""),m.push("\u{1f4ca} Migration Summary:"),m.push("  \u2022 Tables migrated: "+e.total_tables),m.push("  \u2022 Total rows: "+e.total_rows.toLocaleString()),m.push("  \u2022 Duration: "+e.duration.toFixed(2)+" seconds"),!e.success&&(null==(n=e.failed_tables_details)?void 0:n.length)>0&&(m.push(""),m.push("\u26a0\ufe0f Failed tables:"),e.failed_tables_details.forEach(e=>{m.push("  \u2022 "+e.table+": "+e.error_type+" - "+e.error_message)})),ie([...m]),O(m.slice(-10).join("\n"));break;case"error":return T(e.message),void k(!1)}}catch(s){}}await je()}catch(i){const e=i instanceof Error?i.message:"Failed to start migration";T(e)}finally{k(!1)}};return(0,W.jsxs)(i.A,{children:[(0,W.jsx)(c.A,{variant:"h6",sx:{mb:3},children:"Database Management"}),(0,W.jsx)(_e.A,{sx:{mb:3},children:(0,W.jsxs)(Hn.A,{value:$,onChange:(e,t)=>{ee(t)},children:[(0,W.jsx)(Kn.A,{label:"General",icon:(0,W.jsx)(nr.A,{})}),(0,W.jsx)(Kn.A,{label:"Databricks Import/Export",icon:(0,W.jsx)(hr.A,{})}),fe]})}),(0,W.jsx)(vr,{value:$,index:0,children:n&&(0,W.jsx)(te.A,{sx:{mb:3},children:(0,W.jsxs)(Qt.A,{children:[(0,W.jsx)(c.A,{variant:"h6",gutterBottom:!0,children:"Database Information"}),(0,W.jsxs)(ue.Ay,{container:!0,spacing:2,children:[(0,W.jsx)(ue.Ay,{item:!0,xs:12,children:(0,W.jsxs)(h.A,{severity:"lakebase"===n.database_type?"success":"info",children:[(0,W.jsxs)(c.A,{variant:"body2",fontWeight:"bold",children:["Current Database Backend: ",null==(e=n.database_type)?void 0:e.toUpperCase()]}),"lakebase"===n.database_type&&n.lakebase_instance&&(0,W.jsxs)(c.A,{variant:"caption",children:["Connected to Lakebase instance: ",n.lakebase_instance]})]})}),(0,W.jsxs)(ue.Ay,{item:!0,xs:12,md:6,children:[(0,W.jsx)(c.A,{variant:"body2",color:"text.secondary",children:"Type"}),(0,W.jsx)(c.A,{variant:"body1",children:n.database_type})]}),"lakebase"===n.database_type&&n.lakebase_endpoint&&(0,W.jsxs)(ue.Ay,{item:!0,xs:12,children:[(0,W.jsx)(c.A,{variant:"body2",color:"text.secondary",children:"Endpoint"}),(0,W.jsx)(c.A,{variant:"body1",sx:{wordBreak:"break-all"},children:n.lakebase_endpoint})]}),"lakebase"!==n.database_type&&(0,W.jsxs)(W.Fragment,{children:[(0,W.jsxs)(ue.Ay,{item:!0,xs:12,md:6,children:[(0,W.jsx)(c.A,{variant:"body2",color:"text.secondary",children:"Size"}),(0,W.jsx)(c.A,{variant:"body1",children:ke(n.size_mb||0)})]}),n.database_path&&(0,W.jsxs)(ue.Ay,{item:!0,xs:12,children:[(0,W.jsx)(c.A,{variant:"body2",color:"text.secondary",children:"Path"}),(0,W.jsx)(c.A,{variant:"body1",sx:{wordBreak:"break-all"},children:n.database_path})]}),(0,W.jsxs)(ue.Ay,{item:!0,xs:12,md:6,children:[(0,W.jsx)(c.A,{variant:"body2",color:"text.secondary",children:"Created"}),(0,W.jsx)(c.A,{variant:"body1",children:we(n.created_at||"")})]}),(0,W.jsxs)(ue.Ay,{item:!0,xs:12,md:6,children:[(0,W.jsx)(c.A,{variant:"body2",color:"text.secondary",children:"Modified"}),(0,W.jsx)(c.A,{variant:"body1",children:we(n.modified_at||"")})]})]}),n.tables&&(0,W.jsxs)(ue.Ay,{item:!0,xs:12,children:[(0,W.jsxs)(c.A,{variant:"body2",color:"text.secondary",children:["Tables (",n.total_tables,")"]}),(0,W.jsx)(i.A,{sx:{mt:1},children:Object.entries(n.tables).map(e=>{let[t,n]=e;return(0,W.jsx)(V.A,{label:t+" ("+n+" rows)",size:"small",sx:{m:.5}},t)})})]})]})]})})}),(0,W.jsx)(vr,{value:$,index:1,children:(0,W.jsx)(te.A,{children:(0,W.jsxs)(Qt.A,{children:[(0,W.jsx)(c.A,{variant:"h6",gutterBottom:!0,children:"Databricks Volume Settings"}),(0,W.jsxs)(ue.Ay,{container:!0,spacing:2,sx:{mb:3},children:[(0,W.jsx)(ue.Ay,{item:!0,xs:12,md:4,children:(0,W.jsx)(U.A,{fullWidth:!0,label:"Catalog",value:oe,onChange:e=>le(e.target.value)})}),(0,W.jsx)(ue.Ay,{item:!0,xs:12,md:4,children:(0,W.jsx)(U.A,{fullWidth:!0,label:"Schema",value:ce,onChange:e=>de(e.target.value)})}),(0,W.jsx)(ue.Ay,{item:!0,xs:12,md:4,children:(0,W.jsx)(U.A,{fullWidth:!0,label:"Volume Name",value:me,onChange:e=>ge(e.target.value)})})]}),(0,W.jsxs)(i.A,{sx:{display:"flex",gap:2,mb:3,flexDirection:"row",alignItems:"flex-start"},children:[(0,W.jsxs)(i.A,{sx:{display:"flex",flexDirection:"column"},children:[(0,W.jsx)(g.A,{variant:"contained",startIcon:(0,W.jsx)(Gs.A,{}),onClick:()=>K(!0),disabled:!pe,children:"Export to Volume"}),!pe&&(0,W.jsx)($e.A,{error:!0,sx:{ml:1,mt:.5},children:"Please set DATABRICKS_API_KEY in API Keys before exporting"})]}),(0,W.jsxs)(i.A,{sx:{display:"flex",flexDirection:"column"},children:[(0,W.jsx)(g.A,{variant:"outlined",startIcon:(0,W.jsx)(gr.A,{}),onClick:()=>{Ce(),q(!0)},disabled:!pe,children:"Import from Volume"}),!pe&&(0,W.jsx)($e.A,{error:!0,sx:{ml:1,mt:.5},children:"Please set DATABRICKS_API_KEY in API Keys before importing"})]}),(0,W.jsx)(g.A,{variant:"outlined",startIcon:(0,W.jsx)(Jo.A,{}),onClick:Ce,children:"List Backups"})]}),R&&R.backups&&R.backups.length>0&&(0,W.jsxs)(i.A,{children:[(0,W.jsxs)(c.A,{variant:"subtitle1",gutterBottom:!0,children:["Available Backups (",R.total_backups,")"]}),R.volume_path&&(0,W.jsxs)(c.A,{variant:"body2",color:"text.secondary",sx:{mb:2},children:["Volume Path: ",R.volume_path]}),(0,W.jsx)(at.A,{children:R.backups.map(e=>(0,W.jsxs)(st.Ay,{divider:!0,children:[(0,W.jsx)(ot.A,{primary:e.filename,secondary:ke(e.size_mb)+" \u2022 "+we(e.created_at)}),(0,W.jsx)(Hs.A,{children:e.databricks_url&&(0,W.jsx)(d.A,{edge:"end",onClick:()=>window.open(e.databricks_url,"_blank"),title:"View in Databricks",children:(0,W.jsx)(pr.A,{})})})]},e.filename))})]})]})})}),fe,(0,W.jsxs)(o.A,{open:B,onClose:()=>K(!1),maxWidth:"sm",fullWidth:!0,children:[(0,W.jsx)(l.A,{children:"Export Database to Databricks Volume"}),(0,W.jsx)(r.A,{children:(0,W.jsx)(i.A,{sx:{pt:2},children:(0,W.jsxs)(h.A,{severity:"info",children:["Database will be exported as a .db file to: /Volumes/",oe,"/",ce,"/",me,"/"]})})}),(0,W.jsxs)(H.A,{children:[(0,W.jsx)(g.A,{onClick:()=>K(!1),children:"Cancel"}),(0,W.jsx)(g.A,{onClick:async()=>{try{k(!0),T(null);const e=await ve.uE.post("/database-management/export",{catalog:oe,schema:ce,volume_name:me,export_format:"sqlite"});Z(e.data),e.data.success?(O("Database exported successfully!"),K(!1),Ce()):T(e.data.error||"Export failed")}catch(t){var e;const n=br(t)&&(null==(e=t.response)||null==(e=e.data)?void 0:e.error)||"Failed to export database";T(n)}finally{k(!1)}},variant:"contained",disabled:w,children:w?(0,W.jsx)(Y.A,{size:20}):"Export"})]})]}),(0,W.jsxs)(o.A,{open:G,onClose:()=>q(!1),maxWidth:"md",fullWidth:!0,children:[(0,W.jsx)(l.A,{children:"Import Database from Databricks Volume"}),(0,W.jsx)(r.A,{children:R&&R.backups&&R.backups.length>0?(0,W.jsxs)(i.A,{sx:{pt:2},children:[(0,W.jsx)(c.A,{variant:"body2",sx:{mb:2},children:"Select a backup to import:"}),(0,W.jsx)(at.A,{children:R.backups.map(e=>(0,W.jsx)(st.Ay,{sx:{cursor:"pointer",backgroundColor:J===e.filename?"action.selected":"transparent","&:hover":{backgroundColor:"action.hover"}},onClick:()=>X(e.filename),children:(0,W.jsx)(ot.A,{primary:e.filename,secondary:ke(e.size_mb)+" \u2022 "+we(e.created_at)})},e.filename))}),(0,W.jsx)(h.A,{severity:"info",sx:{mt:2},children:"The selected backup will be added to the current database (data will be merged, not replaced)."})]}):(0,W.jsx)(i.A,{sx:{pt:2},children:(0,W.jsx)(h.A,{severity:"info",children:"No backups found in the specified volume."})})}),(0,W.jsxs)(H.A,{children:[(0,W.jsx)(g.A,{onClick:()=>q(!1),children:"Cancel"}),(0,W.jsx)(g.A,{onClick:async()=>{if(J)try{k(!0),T(null);const e=await ve.uE.post("/database-management/import",{catalog:oe,schema:ce,volume_name:me,backup_filename:J});e.data.success?(O("Database imported successfully from "+e.data.backup_filename+"!"),q(!1),ye()):T(e.data.error||"Import failed")}catch(t){var e;const n=br(t)&&(null==(e=t.response)||null==(e=e.data)?void 0:e.error)||"Failed to import database";T(n)}finally{k(!1)}else T("Please select a backup file to import")},variant:"contained",color:"warning",disabled:w||!J,children:w?(0,W.jsx)(Y.A,{size:20}):"Import"})]})]}),Q&&(0,W.jsxs)(o.A,{open:!0,onClose:()=>Z(null),maxWidth:"md",fullWidth:!0,children:[(0,W.jsx)(l.A,{children:"Export Complete"}),(0,W.jsx)(r.A,{children:(0,W.jsxs)(i.A,{sx:{pt:2},children:[(0,W.jsx)(h.A,{severity:"success",sx:{mb:2},children:"Database exported successfully!"}),(0,W.jsxs)(c.A,{variant:"body2",sx:{mb:1},children:[(0,W.jsx)("strong",{children:"Backup Path:"})," ",Q.volume_path]}),Q.backup_filename&&(0,W.jsxs)(c.A,{variant:"body2",sx:{mb:1},children:[(0,W.jsx)("strong",{children:"Filename:"})," ",Q.backup_filename]}),Q.size_mb&&(0,W.jsxs)(c.A,{variant:"body2",sx:{mb:1},children:[(0,W.jsx)("strong",{children:"Size:"})," ",ke(Q.size_mb)]}),Q.volume_browse_url&&(0,W.jsx)(g.A,{variant:"outlined",startIcon:(0,W.jsx)(pr.A,{}),onClick:()=>window.open(Q.volume_browse_url,"_blank"),sx:{mt:2},children:"View in Databricks"})]})}),(0,W.jsx)(H.A,{children:(0,W.jsx)(g.A,{onClick:()=>Z(null),children:"Close"})})]}),D&&(0,W.jsx)(h.A,{severity:"success",onClose:()=>O(null),sx:{mt:2},children:D}),I&&(0,W.jsx)(h.A,{severity:"error",onClose:()=>T(null),sx:{mt:2},children:I}),(0,W.jsxs)(o.A,{open:b,onClose:()=>v(!1),maxWidth:"md",fullWidth:!0,children:[(0,W.jsx)(l.A,{children:(0,W.jsxs)(i.A,{sx:{display:"flex",alignItems:"center",gap:1},children:[(0,W.jsx)(mr.A,{color:"primary"}),"Lakebase Migration Options"]})}),(0,W.jsxs)(r.A,{children:[f?(0,W.jsxs)(h.A,{severity:"info",sx:{mb:3},children:["Found existing ",(0,W.jsx)("strong",{children:"kasal"})," schema with ",(null==(t=u.migration_result)?void 0:t.total_tables)||"data"," in Lakebase."]}):(0,W.jsxs)(h.A,{severity:"warning",sx:{mb:3},children:["No ",(0,W.jsx)("strong",{children:"kasal"})," schema found in Lakebase. A new schema will be created."]}),(0,W.jsxs)(re.A,{component:"fieldset",children:[(0,W.jsx)(qt.A,{component:"legend",children:"Choose migration strategy:"}),(0,W.jsxs)(Jt.A,{value:A,onChange:e=>j(e.target.value),children:[f&&(0,W.jsx)(he.A,{value:"use",control:(0,W.jsx)(Yt.A,{}),label:(0,W.jsxs)(i.A,{children:[(0,W.jsx)(c.A,{variant:"body1",fontWeight:"bold",children:"Use Existing Schema"}),(0,W.jsx)(c.A,{variant:"body2",color:"text.secondary",children:"Connect to existing kasal schema without modification. Use this if data is already migrated."})]})}),(0,W.jsx)(he.A,{value:"schema_only",control:(0,W.jsx)(Yt.A,{}),label:(0,W.jsxs)(i.A,{children:[(0,W.jsx)(c.A,{variant:"body1",fontWeight:"bold",children:f?"Recreate Schema (No Data)":"Create Schema (No Data)"}),(0,W.jsx)(c.A,{variant:"body2",color:"text.secondary",children:f?"Drop existing kasal schema and create empty table structure. No data will be migrated.":"Create empty table structure in kasal schema. No data will be migrated."}),f&&(0,W.jsxs)(h.A,{severity:"warning",sx:{mt:1},children:[(0,W.jsx)("strong",{children:"Warning:"})," Existing data in kasal schema will be permanently deleted!"]})]})}),(0,W.jsx)(he.A,{value:"recreate",control:(0,W.jsx)(Yt.A,{}),label:(0,W.jsxs)(i.A,{children:[(0,W.jsx)(c.A,{variant:"body1",fontWeight:"bold",children:f?"Recreate Schema and Migrate Data":"Create Schema and Migrate Data"}),(0,W.jsx)(c.A,{variant:"body2",color:"text.secondary",children:f?"Drop existing kasal schema, recreate it, and migrate all data from source database.":"Create new kasal schema and migrate all data from source database."}),f&&(0,W.jsxs)(h.A,{severity:"warning",sx:{mt:1},children:[(0,W.jsx)("strong",{children:"Warning:"})," Existing data in kasal schema will be permanently deleted!"]})]})})]})]})]}),(0,W.jsxs)(H.A,{children:[(0,W.jsx)(g.A,{onClick:()=>v(!1),children:"Cancel"}),!f&&(0,W.jsx)(g.A,{onClick:async()=>{v(!1);try{k(!0);(await ve.uE.post("/database-management/lakebase/enable",{instance_name:u.instance_name,endpoint:u.endpoint})).data.success&&(O("Connected to Lakebase without migration. Schema will be created on first use."),await je(),await ye())}catch(t){var e;const n=br(t)&&(null==(e=t.response)||null==(e=e.data)?void 0:e.detail)||"Failed to connect to Lakebase";T(n)}finally{k(!1)}},variant:"outlined",startIcon:(0,W.jsx)(Js.A,{}),children:"Connect without Migration"}),(0,W.jsx)(g.A,{onClick:async()=>{v(!1),"recreate"===A?await Se(!0,!0):"schema_only"===A?await Se(!0,!1):O("Connected to Lakebase successfully. Using existing schema.")},variant:"contained",color:"primary",startIcon:"recreate"===A||"schema_only"===A?(0,W.jsx)(Gs.A,{}):(0,W.jsx)(Js.A,{}),children:"recreate"===A?"Migrate Data":"schema_only"===A?"Create Schema":"Connect"})]})]}),(0,W.jsxs)(o.A,{open:z,onClose:()=>L(!1),maxWidth:"sm",fullWidth:!0,children:[(0,W.jsx)(l.A,{children:(0,W.jsxs)(i.A,{sx:{display:"flex",alignItems:"center",gap:1},children:[(0,W.jsx)(qa.A,{color:"warning"}),"Disable Databricks Lakebase"]})}),(0,W.jsxs)(r.A,{children:[(0,W.jsx)(c.A,{variant:"body1",sx:{mb:2},children:"Are you sure you want to disable Databricks Lakebase?"}),(0,W.jsx)(h.A,{severity:"info",sx:{mb:2},children:(0,W.jsxs)(c.A,{variant:"body2",component:"div",children:["This action will:",(0,W.jsxs)("ul",{style:{margin:"8px 0",paddingLeft:"20px"},children:[(0,W.jsx)("li",{children:"Delete the Lakebase configuration from your database"}),(0,W.jsxs)("li",{children:["Revert all database operations to ",(0,W.jsx)("strong",{children:"SQLite"})," (in Databricks Apps) or ",(0,W.jsx)("strong",{children:"PostgreSQL"})," (in local development)"]}),(0,W.jsx)("li",{children:"Keep your Lakebase instance running (if created) - you can re-enable it later"}),(0,W.jsx)("li",{children:"Preserve any data already migrated to Lakebase"})]})]})}),(0,W.jsx)(c.A,{variant:"body2",color:"text.secondary",children:"Note: You can re-enable Lakebase at any time by selecting it again."})]}),(0,W.jsxs)(H.A,{children:[(0,W.jsx)(g.A,{onClick:()=>L(!1),children:"Cancel"}),(0,W.jsx)(g.A,{onClick:async()=>{L(!1),P("disabled"),m({enabled:!1});try{k(!0),T(null);const e=Object.assign({},u,{enabled:!1});await ve.uE.post("/database-management/lakebase/config",e),O("Lakebase disabled and configuration deleted. System now using SQLite (or PostgreSQL in local development).")}catch(t){var e;const n=br(t)&&(null==(e=t.response)||null==(e=e.data)?void 0:e.detail)||"Failed to disable Lakebase";T(n),P("lakebase"),m({enabled:!0})}finally{k(!1)}},color:"warning",variant:"contained",startIcon:(0,W.jsx)(nr.A,{}),children:"Disable and Use SQLite/PostgreSQL"})]})]}),(0,W.jsxs)(o.A,{open:ne,onClose:()=>ae(!1),maxWidth:"lg",fullWidth:!0,PaperProps:{sx:{height:"80vh"}},children:[(0,W.jsx)(l.A,{children:(0,W.jsxs)(i.A,{sx:{display:"flex",alignItems:"center",gap:1},children:[(0,W.jsx)(mr.A,{}),"Migration Logs",w&&(0,W.jsx)(Y.A,{size:20,sx:{ml:1}})]})}),(0,W.jsx)(r.A,{dividers:!0,children:(0,W.jsx)(i.A,{sx:{fontFamily:"monospace",fontSize:"0.875rem",whiteSpace:"pre-wrap",bgcolor:"grey.900",color:"grey.100",p:2,borderRadius:1,height:"100%",overflow:"auto","&::-webkit-scrollbar":{width:"8px"},"&::-webkit-scrollbar-track":{bgcolor:"grey.800"},"&::-webkit-scrollbar-thumb":{bgcolor:"grey.600",borderRadius:"4px","&:hover":{bgcolor:"grey.500"}}},children:0===se.length?(0,W.jsx)(c.A,{color:"grey.400",children:"Waiting for migration to start..."}):se.map((e,t)=>(0,W.jsx)(i.A,{sx:{mb:.5},children:e},t))})}),(0,W.jsxs)(H.A,{children:[(0,W.jsx)(g.A,{onClick:()=>{const e=se.join("\n"),t=new Blob([e],{type:"text/plain"}),n=URL.createObjectURL(t),a=document.createElement("a");a.href=n,a.download="migration-logs-"+(new Date).toISOString()+".txt",a.click(),URL.revokeObjectURL(n)},disabled:0===se.length,children:"Download Logs"}),(0,W.jsx)(g.A,{onClick:()=>ae(!1),children:"Close"})]})]})]})};var jr=n(19489),wr=n(52472),kr=n(49380);class Cr{static getInstance(){return Cr.instance||(Cr.instance=new Cr),Cr.instance}async getUsers(){return(await ve.uE.get("/users")).data}async getCurrentUser(){return(await ve.uE.get("/users/me")).data}async updateUserPermissions(e,t){return(await ve.uE.put("/users/"+e+"/permissions",t)).data}async getUser(e){return(await ve.uE.get("/users/"+e)).data}async deleteUser(e){await ve.uE.delete("/users/"+e)}}Cr.instance=void 0;var Sr=n(79893),_r=n(50294),Er=n(82092),Ir=n(66141),Tr=n(93553),Dr=n(45919),Or=n(76281);const Nr=()=>{const{userRole:e,isLoading:t}=(0,Nn.o)(e=>({userRole:e.userRole,isLoading:e.isLoading})),[n,a]=(0,s.useState)([]),[p,x]=(0,s.useState)(null),[f,y]=(0,s.useState)([]),[b,v]=(0,s.useState)(!1),[A,j]=(0,s.useState)(!1),[w,k]=(0,s.useState)(!1),[C,S]=(0,s.useState)(null),[_,E]=(0,s.useState)(!1),[I,T]=(0,s.useState)(""),[D,O]=(0,s.useState)("groups"),[N,P]=(0,s.useState)(null),[z,L]=(0,s.useState)(null),[R,F]=(0,s.useState)(null),[B,K]=(0,s.useState)(null),[q,J]=(0,s.useState)(!1),[Y,X]=(0,s.useState)(null),[Q,Z]=(0,s.useState)({open:!1,message:"",severity:"success"}),[$,ee]=(0,s.useState)(null),[ae,se]=(0,s.useState)("operator"),[ie,oe]=(0,s.useState)([]),[he,me]=(0,s.useState)(!1),ge=(0,es.Q)(e=>e.refresh),[pe,xe]=(0,s.useState)({name:"",description:""}),[fe,ye]=(0,s.useState)({user_email:"",role:"operator"}),[be,ve]=(0,s.useState)([]),Ae=n.reduce((e,t)=>e+(t.user_count||0),0),je=n.filter(e=>e.name.toLowerCase().includes(I.toLowerCase())),we=(0,s.useCallback)(async()=>{E(!0);try{const e=Be.B.getInstance(),t=await e.getGroups();a(t)}catch(e){Te("Failed to load workspaces","error")}finally{E(!1)}},[]);(0,s.useEffect)(()=>{we()},[we]);const ke=(0,s.useCallback)(async()=>{me(!0);try{const e=Cr.getInstance(),t=await e.getUsers();oe(t)}catch(e){Te("Failed to load users","error")}finally{me(!1)}},[]);(0,s.useEffect)(()=>{A&&ke()},[A,ke]);const Ce=async e=>{E(!0);try{const t=Be.B.getInstance(),n=await t.getGroupUsers(e);y(n)}catch(t){Te("Failed to load team members","error")}finally{E(!1)}},Se=()=>{P(null),L(null)},Ee=()=>{F(null),K(null)},Ie=()=>{ee(null)},Te=(e,t)=>{Z({open:!0,message:e,severity:t})},De=e=>{switch(e){case"admin":return"error";case"manager":return"warning";case"user":return"primary";default:return"default"}},Oe=e=>{switch(e){case"admin":return(0,W.jsx)(Sr.A,{fontSize:"small"});case"editor":return(0,W.jsx)(Ua.A,{fontSize:"small"});default:return(0,W.jsx)(_r.A,{fontSize:"small"})}},Ne=e=>{switch(e){case"admin":return"Full system control";case"editor":return"Can build and modify workflows";case"operator":return"Can execute workflows and monitor";default:return"Standard access"}};return t?(0,W.jsxs)(i.A,{sx:{p:3,textAlign:"center"},children:[(0,W.jsx)(Us.A,{sx:{mb:2}}),(0,W.jsx)(c.A,{color:"text.secondary",children:"Checking permissions..."})]}):"admin"!==e?(0,W.jsxs)(i.A,{sx:{p:3,textAlign:"center"},children:[(0,W.jsx)(Ja.A,{sx:{bgcolor:"error.light",mx:"auto",mb:2,width:60,height:60},children:(0,W.jsx)(Er.A,{fontSize:"large"})}),(0,W.jsx)(c.A,{variant:"h6",gutterBottom:!0,children:"Access Denied"}),(0,W.jsx)(c.A,{variant:"body2",color:"text.secondary",children:"You do not have permission to manage workspaces."}),(0,W.jsx)(c.A,{variant:"body2",color:"text.secondary",sx:{mt:1},children:"Only administrators can manage workspaces and team members."})]}):(0,W.jsx)(W.Fragment,{children:(0,W.jsxs)(i.A,{children:[(0,W.jsxs)(i.A,{sx:{mb:4},children:[(0,W.jsxs)(i.A,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",mb:2},children:[(0,W.jsxs)(i.A,{sx:{display:"flex",alignItems:"center"},children:[(0,W.jsx)(Ja.A,{sx:{bgcolor:"primary.main",mr:2},children:(0,W.jsx)(Ir.A,{})}),(0,W.jsxs)(i.A,{children:[(0,W.jsx)(c.A,{variant:"h5",fontWeight:"600",color:"text.primary",children:"Workspaces"}),(0,W.jsxs)(c.A,{variant:"body2",color:"text.secondary",children:["Create team workspaces for collaboration \u2022 ",n.length," workspaces \u2022 ",Ae," members"]})]})]}),(0,W.jsx)(jr.A,{in:!_,children:(0,W.jsx)(wr.A,{color:"primary",size:"medium",onClick:()=>v(!0),disabled:_,sx:{boxShadow:3},children:(0,W.jsx)(G.A,{})})})]}),_&&(0,W.jsx)(Us.A,{sx:{mb:2}})]}),(0,W.jsx)(te.A,{sx:{mb:3},children:(0,W.jsx)(Qt.A,{children:(0,W.jsxs)(ue.Ay,{container:!0,spacing:2,alignItems:"center",children:[(0,W.jsx)(ue.Ay,{item:!0,xs:12,md:6,children:(0,W.jsx)(U.A,{fullWidth:!0,size:"small",placeholder:"Search workspaces by name...",value:I,onChange:e=>T(e.target.value),InputProps:{startAdornment:(0,W.jsx)(cr.A,{sx:{mr:1,color:"text.secondary"}})}})}),(0,W.jsx)(ue.Ay,{item:!0,xs:12,md:6})]})})}),(0,W.jsx)(h.A,{severity:"info",icon:(0,W.jsx)(Tr.A,{}),sx:{mb:3,borderRadius:2},children:(0,W.jsxs)(c.A,{variant:"body2",children:[(0,W.jsx)("strong",{children:"Secure Workspaces:"})," Each workspace provides isolated data and workflows. Users can belong to multiple workspaces and switch between them easily."]})}),(0,W.jsxs)(ue.Ay,{container:!0,spacing:3,children:[(0,W.jsx)(ue.Ay,{item:!0,xs:12,lg:8,children:(0,W.jsxs)(te.A,{children:[(0,W.jsx)(Xt.A,{title:(0,W.jsxs)(i.A,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[(0,W.jsxs)(c.A,{variant:"h6",children:["Workspaces (",je.length,")"]}),(0,W.jsx)(g.A,{variant:"outlined",size:"small",startIcon:(0,W.jsx)(G.A,{}),onClick:()=>v(!0),children:"New Workspace"})]})}),(0,W.jsx)(ne.A,{}),(0,W.jsx)(at.A,{children:0===je.length?(0,W.jsxs)(i.A,{sx:{textAlign:"center",py:6},children:[(0,W.jsx)(Dr.A,{sx:{fontSize:64,color:"text.secondary",mb:2}}),(0,W.jsx)(c.A,{variant:"h6",color:"text.secondary",gutterBottom:!0,children:I?"No groups found":"No groups yet"}),(0,W.jsx)(c.A,{variant:"body2",color:"text.secondary",sx:{mb:3},children:I?"Try adjusting your search terms":"Create your first group to get started"}),!I&&(0,W.jsx)(g.A,{variant:"contained",startIcon:(0,W.jsx)(G.A,{}),onClick:()=>v(!0),children:"Create First Workspace"})]}):je.map((e,t)=>(0,W.jsxs)(s.Fragment,{children:[(0,W.jsxs)(st.Ay,{sx:{py:2,cursor:"pointer","&:hover":{bgcolor:"action.hover"},borderRadius:1,mx:1},onClick:()=>{x(e),Ce(e.id)},children:[(0,W.jsx)(Os.A,{children:(0,W.jsx)(Ja.A,{sx:{bgcolor:"active"===e.status?"success.main":"grey.400"},children:(0,W.jsx)(Ba.A,{})})}),(0,W.jsx)(ot.A,{primary:(0,W.jsxs)(i.A,{sx:{display:"flex",alignItems:"center",gap:1},children:[(0,W.jsx)(c.A,{variant:"subtitle1",fontWeight:"medium",children:e.name}),e.auto_created&&(0,W.jsx)(V.A,{label:"Auto-created",size:"small",variant:"outlined",sx:{height:20}})]}),secondary:(0,W.jsxs)(c.A,{variant:"body2",color:"text.secondary",children:[e.user_count||0," users \u2022 Created ",new Date(e.created_at||Date.now()).toLocaleDateString()]})}),(0,W.jsx)(Hs.A,{children:(0,W.jsxs)(i.A,{sx:{display:"flex",gap:1},children:[(0,W.jsx)(M.A,{title:"Manage Users",children:(0,W.jsx)(d.A,{onClick:t=>{t.stopPropagation(),x(e),Ce(e.id)},children:(0,W.jsx)(_r.A,{})})}),(0,W.jsx)(M.A,{title:"Group Actions",children:(0,W.jsx)(d.A,{onClick:t=>((e,t)=>{e.stopPropagation(),P(e.currentTarget),L(t)})(t,e),children:(0,W.jsx)(Or.A,{})})})]})})]}),t<je.length-1&&(0,W.jsx)(ne.A,{variant:"inset",component:"li"})]},e.id))})]})}),(0,W.jsx)(ue.Ay,{item:!0,xs:12,lg:4,children:(0,W.jsxs)(te.A,{sx:{height:"fit-content",position:"sticky",top:16},children:[(0,W.jsx)(Xt.A,{title:(0,W.jsxs)(i.A,{sx:{display:"flex",alignItems:"center",gap:1},children:[(0,W.jsx)(_r.A,{}),(0,W.jsx)(c.A,{variant:"h6",children:p?p.name+" Members":"Select a Workspace"})]}),action:p&&(0,W.jsx)(g.A,{variant:"contained",size:"small",startIcon:(0,W.jsx)(Cn.A,{}),onClick:()=>j(!0),disabled:_,children:"Add User"})}),(0,W.jsx)(ne.A,{}),p?(0,W.jsxs)(i.A,{children:[(0,W.jsxs)(i.A,{sx:{p:2,bgcolor:"grey.50"},children:[(0,W.jsx)(c.A,{variant:"subtitle2",color:"primary",gutterBottom:!0,children:"Group Information"}),(0,W.jsxs)(c.A,{variant:"body2",color:"text.secondary",children:[(0,W.jsx)("strong",{children:"Total Users:"})," ",p.user_count||0]})]}),(0,W.jsx)(at.A,{children:0===f.length?(0,W.jsxs)(i.A,{sx:{textAlign:"center",py:4},children:[(0,W.jsx)(_r.A,{sx:{fontSize:48,color:"text.secondary",mb:1}}),(0,W.jsx)(c.A,{variant:"body2",color:"text.secondary",gutterBottom:!0,children:"No users in this group yet"}),(0,W.jsx)(g.A,{variant:"outlined",size:"small",startIcon:(0,W.jsx)(Cn.A,{}),onClick:()=>j(!0),children:"Add First User"})]}):f.map((e,t)=>(0,W.jsxs)(s.Fragment,{children:[(0,W.jsxs)(st.Ay,{children:[(0,W.jsx)(Os.A,{children:(0,W.jsx)(Ja.A,{sx:{bgcolor:De(e.role)+".main"},children:Oe(e.role)})}),(0,W.jsx)(ot.A,{primary:(0,W.jsx)(c.A,{variant:"subtitle2",children:e.email}),secondary:(0,W.jsxs)(i.A,{children:[(0,W.jsx)(i.A,{sx:{display:"flex",alignItems:"center",gap:.5,mt:.5},children:$===(e.user_id||e.id)?(0,W.jsxs)(i.A,{sx:{display:"flex",alignItems:"center",gap:1},children:[(0,W.jsx)(re.A,{size:"small",sx:{minWidth:120},children:(0,W.jsxs)(ce.A,{value:ae,onChange:e=>se(e.target.value),sx:{height:28},children:[(0,W.jsx)(de.A,{value:"admin",children:"Admin"}),(0,W.jsx)(de.A,{value:"editor",children:"Editor"}),(0,W.jsx)(de.A,{value:"operator",children:"Operator"})]})}),(0,W.jsx)(g.A,{size:"small",variant:"contained",onClick:()=>(async(e,t)=>{if(p){E(!0);try{const n=Be.B.getInstance();await n.updateGroupUser(p.id,e,{role:t}),Te("Member role updated to "+t,"success"),ee(null),await Ce(p.id)}catch(n){Te("Failed to update member role","error")}finally{E(!1)}}})(e.user_id||e.id,ae),disabled:_,sx:{height:28,minWidth:50},children:"Save"}),(0,W.jsx)(g.A,{size:"small",variant:"outlined",onClick:Ie,disabled:_,sx:{height:28,minWidth:50},children:"Cancel"})]}):(0,W.jsxs)(i.A,{sx:{display:"flex",alignItems:"center",gap:.5},children:[(0,W.jsx)(V.A,{icon:Oe(e.role),label:e.role,size:"small",color:De(e.role),sx:{height:20}}),(0,W.jsx)(M.A,{title:"Edit Role",children:(0,W.jsx)(d.A,{size:"small",onClick:()=>{return t=e.user_id||e.id,n=e.role,ee(t),void se(n);var t,n},sx:{padding:"2px"},children:(0,W.jsx)(Ua.A,{sx:{fontSize:16}})})})]})}),(0,W.jsxs)(c.A,{variant:"caption",color:"text.secondary",sx:{display:"block",mt:.5},children:[Ne(e.role),e.auto_created&&" \u2022 Auto-assigned"]})]})}),(0,W.jsx)(Hs.A,{children:(0,W.jsx)(M.A,{title:"User Actions",children:(0,W.jsx)(d.A,{size:"small",onClick:t=>((e,t)=>{e.stopPropagation(),F(e.currentTarget),K(t)})(t,e),children:(0,W.jsx)(Or.A,{fontSize:"small"})})})})]}),t<f.length-1&&(0,W.jsx)(ne.A,{variant:"inset",component:"li"})]},e.id))})]}):(0,W.jsxs)(i.A,{sx:{textAlign:"center",py:6},children:[(0,W.jsx)(Ir.A,{sx:{fontSize:64,color:"text.secondary",mb:2}}),(0,W.jsx)(c.A,{variant:"h6",color:"text.secondary",gutterBottom:!0,children:"Select a Workspace"}),(0,W.jsx)(c.A,{variant:"body2",color:"text.secondary",children:"Click on a workspace to view and manage team members"})]})]})})]}),(0,W.jsx)(m.A,{anchorEl:N,open:Boolean(N),onClose:Se,anchorOrigin:{vertical:"bottom",horizontal:"right"},transformOrigin:{vertical:"top",horizontal:"right"},children:(0,W.jsx)(kr.A,{children:(0,W.jsxs)(de.A,{onClick:()=>z&&(S(z),k(!0),void Se()),sx:{color:"error.main"},children:[(0,W.jsx)(Xs.A,{sx:{mr:1},fontSize:"small"}),"Delete Workspace"]})})}),(0,W.jsx)(m.A,{anchorEl:R,open:Boolean(R),onClose:Ee,anchorOrigin:{vertical:"bottom",horizontal:"right"},transformOrigin:{vertical:"top",horizontal:"right"},children:(0,W.jsx)(kr.A,{children:(0,W.jsxs)(de.A,{onClick:()=>B&&(e=>{X(e),J(!0),Ee()})(B),sx:{color:"error.main"},children:[(0,W.jsx)(_r.A,{sx:{mr:1},fontSize:"small"}),"Remove from Workspace"]})})}),(0,W.jsxs)(o.A,{open:q,onClose:()=>J(!1),maxWidth:"sm",fullWidth:!0,PaperProps:{sx:{borderRadius:2}},children:[(0,W.jsx)(l.A,{children:(0,W.jsxs)(i.A,{sx:{display:"flex",alignItems:"center",gap:1},children:[(0,W.jsx)(Ja.A,{sx:{bgcolor:"warning.main"},children:(0,W.jsx)(qa.A,{})}),(0,W.jsxs)(i.A,{children:[(0,W.jsx)(c.A,{variant:"h6",children:"Remove User from Group"}),(0,W.jsx)(c.A,{variant:"body2",color:"text.secondary",children:"This will revoke the user's access to this group"})]})]})}),(0,W.jsxs)(r.A,{children:[(0,W.jsx)(h.A,{severity:"warning",sx:{mb:2},children:(0,W.jsxs)(c.A,{variant:"body2",children:[(0,W.jsx)("strong",{children:"Warning:"})," Removing this user will immediately revoke their access to all data and workflows in this group."]})}),(0,W.jsxs)(so.A,{children:["Are you sure you want to remove ",(0,W.jsx)("strong",{children:null==Y?void 0:Y.email})," from the group ",(0,W.jsxs)("strong",{children:["\u201c",null==p?void 0:p.name,"\u201d"]}),"?",(0,W.jsx)("br",{}),(0,W.jsx)("br",{}),"They will no longer be able to access any data or workflows within this group."]})]}),(0,W.jsxs)(H.A,{sx:{p:2.5,gap:1},children:[(0,W.jsx)(g.A,{onClick:()=>J(!1),variant:"outlined",disabled:_,children:"Cancel"}),(0,W.jsx)(g.A,{onClick:async()=>{if(Y&&p){E(!0);try{const e=Be.B.getInstance();await e.removeUserFromGroup(p.id,Y.user_id||Y.id),J(!1),X(null),Te("Member removed successfully","success"),Ce(p.id)}catch(e){Te("Failed to remove member","error")}finally{E(!1)}}},variant:"contained",color:"warning",disabled:_,startIcon:_?void 0:(0,W.jsx)(_r.A,{}),children:_?"Removing...":"Remove User"})]})]}),(0,W.jsxs)(o.A,{open:w,onClose:()=>k(!1),maxWidth:"sm",fullWidth:!0,PaperProps:{sx:{borderRadius:2}},children:[(0,W.jsx)(l.A,{children:(0,W.jsxs)(i.A,{sx:{display:"flex",alignItems:"center",gap:1},children:[(0,W.jsx)(Ja.A,{sx:{bgcolor:"error.main"},children:(0,W.jsx)(qa.A,{})}),(0,W.jsxs)(i.A,{children:[(0,W.jsx)(c.A,{variant:"h6",children:"Delete Group"}),(0,W.jsx)(c.A,{variant:"body2",color:"text.secondary",children:"This action cannot be undone"})]})]})}),(0,W.jsxs)(r.A,{children:[(0,W.jsx)(h.A,{severity:"warning",sx:{mb:2},children:(0,W.jsxs)(c.A,{variant:"body2",children:[(0,W.jsx)("strong",{children:"Warning:"})," Deleting this group will permanently remove all associated data and user access."]})}),(0,W.jsxs)(so.A,{children:["Are you sure you want to delete the group ",(0,W.jsxs)("strong",{children:["\u201c",null==C?void 0:C.name,"\u201d"]}),"?",(null==C?void 0:C.user_count)&&C.user_count>0&&(0,W.jsxs)(W.Fragment,{children:[(0,W.jsx)("br",{}),(0,W.jsx)("br",{}),"This group currently has ",(0,W.jsxs)("strong",{children:[C.user_count," user(s)"]})," assigned to it."]})]})]}),(0,W.jsxs)(H.A,{sx:{p:2.5,gap:1},children:[(0,W.jsx)(g.A,{onClick:()=>k(!1),variant:"outlined",disabled:_,children:"Cancel"}),(0,W.jsx)(g.A,{onClick:async()=>{if(C){E(!0);try{const e=Be.B.getInstance();await e.deleteGroup(C.id),k(!1),S(null),(null==p?void 0:p.id)===C.id&&(x(null),y([])),Te("Workspace deleted successfully","success"),we()}catch(e){Te("Failed to delete workspace","error")}finally{E(!1)}}},variant:"contained",color:"error",disabled:_,startIcon:_?void 0:(0,W.jsx)(Xs.A,{}),children:_?"Deleting...":"Delete Group"})]})]}),(0,W.jsxs)(o.A,{open:b,onClose:()=>v(!1),maxWidth:"md",fullWidth:!0,PaperProps:{sx:{borderRadius:2}},children:[(0,W.jsx)(l.A,{children:(0,W.jsxs)(i.A,{sx:{display:"flex",alignItems:"center",gap:1},children:[(0,W.jsx)(Ja.A,{sx:{bgcolor:"primary.main"},children:(0,W.jsx)(Ir.A,{})}),(0,W.jsxs)(i.A,{children:[(0,W.jsx)(c.A,{variant:"h6",children:"Create New Workspace"}),(0,W.jsx)(c.A,{variant:"body2",color:"text.secondary",children:"Set up a collaborative workspace for your team"})]})]})}),(0,W.jsxs)(r.A,{children:[(0,W.jsx)(h.A,{severity:"info",sx:{mb:3,mt:1},children:"Workspaces provide secure, isolated environments for teams. Members can belong to multiple workspaces."}),(0,W.jsxs)(ue.Ay,{container:!0,spacing:3,children:[(0,W.jsx)(ue.Ay,{item:!0,xs:12,children:(0,W.jsx)(U.A,{fullWidth:!0,label:"Workspace Name",value:pe.name,onChange:e=>xe(Object.assign({},pe,{name:e.target.value})),placeholder:"e.g., Product Team, Marketing, Engineering",required:!0,InputProps:{startAdornment:(0,W.jsx)(Ba.A,{sx:{mr:1,color:"text.secondary"}})}})}),(0,W.jsx)(ue.Ay,{item:!0,xs:12,children:(0,W.jsx)(U.A,{fullWidth:!0,label:"Description (Optional)",value:pe.description,onChange:e=>xe(Object.assign({},pe,{description:e.target.value})),multiline:!0,rows:3,placeholder:"Describe the purpose of this workspace...",helperText:"Help others understand this workspace's purpose"})})]})]}),(0,W.jsxs)(H.A,{sx:{p:2.5,gap:1},children:[(0,W.jsx)(g.A,{onClick:()=>v(!1),variant:"outlined",disabled:_,children:"Cancel"}),(0,W.jsx)(g.A,{onClick:async()=>{if(pe.name){E(!0);try{const e=Be.B.getInstance();await e.createGroup(pe),v(!1),xe({name:"",description:""}),Te("Workspace created successfully","success"),we()}catch(e){Te("Failed to create workspace","error")}finally{E(!1)}}else Te("Please fill in all required fields","warning")},variant:"contained",disabled:_||!pe.name,startIcon:_?void 0:(0,W.jsx)(G.A,{}),children:_?"Creating...":"Create Workspace"})]})]}),(0,W.jsxs)(o.A,{open:A,onClose:()=>j(!1),maxWidth:"md",fullWidth:!0,PaperProps:{sx:{borderRadius:2}},children:[(0,W.jsx)(l.A,{children:(0,W.jsxs)(i.A,{sx:{display:"flex",alignItems:"center",gap:1},children:[(0,W.jsx)(Ja.A,{sx:{bgcolor:"secondary.main"},children:(0,W.jsx)(Cn.A,{})}),(0,W.jsxs)(i.A,{children:[(0,W.jsxs)(c.A,{variant:"h6",children:["Add Members to ",null==p?void 0:p.name]}),(0,W.jsx)(c.A,{variant:"body2",color:"text.secondary",children:"Select multiple team members and set their permissions"})]})]})}),(0,W.jsxs)(r.A,{children:[(0,W.jsx)(h.A,{severity:"info",sx:{mb:3,mt:1},children:"Team members will gain access to this workspace's data and workflows based on their role."}),(0,W.jsx)(h.A,{severity:"warning",sx:{mb:3},children:(0,W.jsxs)(c.A,{variant:"body2",children:[(0,W.jsx)("strong",{children:"Note:"})," Users must log in to Kasal at least once to appear in this list. If you don't see the user you're looking for, ask them to visit the application first."]})}),(0,W.jsxs)(ue.Ay,{container:!0,spacing:3,children:[(0,W.jsx)(ue.Ay,{item:!0,xs:12,children:(0,W.jsxs)(re.A,{fullWidth:!0,required:!0,children:[(0,W.jsx)(le.A,{children:"Select Users"}),(0,W.jsx)(ce.A,{multiple:!0,value:be,label:"Select Users",onChange:e=>ve("string"===typeof e.target.value?e.target.value.split(","):e.target.value),disabled:he,renderValue:e=>(0,W.jsx)(i.A,{sx:{display:"flex",flexWrap:"wrap",gap:.5},children:e.map(e=>{const t=ie.find(t=>t.id===e);return(0,W.jsx)(V.A,{label:(null==t?void 0:t.email)||e,size:"small",onDelete:()=>{ve(be.filter(t=>t!==e))},deleteIcon:(0,W.jsx)(Xs.A,{})},e)})}),children:he?(0,W.jsx)(de.A,{disabled:!0,children:(0,W.jsx)(c.A,{color:"text.secondary",children:"Loading users..."})}):0===ie.length?(0,W.jsx)(de.A,{disabled:!0,children:(0,W.jsx)(c.A,{color:"text.secondary",children:"No users found - ask team members to log in first"})}):ie.filter(e=>!f.some(t=>t.email===e.email)).map(e=>(0,W.jsx)(de.A,{value:e.id,children:(0,W.jsxs)(i.A,{sx:{display:"flex",alignItems:"center",gap:1,width:"100%"},children:[(0,W.jsx)(_r.A,{fontSize:"small"}),(0,W.jsxs)(i.A,{children:[(0,W.jsx)(c.A,{variant:"body2",children:e.email}),(0,W.jsxs)(c.A,{variant:"caption",color:"text.secondary",children:["Last login: ",e.last_login?new Date(e.last_login).toLocaleDateString():"Never"]})]})]})},e.id))}),(0,W.jsx)(c.A,{variant:"caption",color:"text.secondary",sx:{mt:1,display:"block"},children:"Hold Ctrl/Cmd to select multiple users. Only users who have logged in to Kasal will appear in this list."})]})}),(0,W.jsx)(ue.Ay,{item:!0,xs:12,children:(0,W.jsxs)(re.A,{fullWidth:!0,required:!0,children:[(0,W.jsx)(le.A,{children:"Role & Permissions"}),(0,W.jsxs)(ce.A,{value:fe.role,label:"Role & Permissions",onChange:e=>ye(Object.assign({},fe,{role:e.target.value})),startAdornment:Oe(fe.role),children:[(0,W.jsx)(de.A,{value:"operator",children:(0,W.jsxs)(i.A,{sx:{display:"flex",alignItems:"center",gap:1,width:"100%"},children:[(0,W.jsx)(_r.A,{fontSize:"small"}),(0,W.jsxs)(i.A,{children:[(0,W.jsx)(c.A,{variant:"body2",fontWeight:"medium",children:"Operator"}),(0,W.jsx)(c.A,{variant:"caption",color:"text.secondary",children:"Execute workflows and monitor execution"})]})]})}),(0,W.jsx)(de.A,{value:"editor",children:(0,W.jsxs)(i.A,{sx:{display:"flex",alignItems:"center",gap:1,width:"100%"},children:[(0,W.jsx)(Ua.A,{fontSize:"small"}),(0,W.jsxs)(i.A,{children:[(0,W.jsx)(c.A,{variant:"body2",fontWeight:"medium",children:"Editor"}),(0,W.jsx)(c.A,{variant:"caption",color:"text.secondary",children:"Build and modify AI agent workflows"})]})]})}),(0,W.jsx)(de.A,{value:"admin",children:(0,W.jsxs)(i.A,{sx:{display:"flex",alignItems:"center",gap:1,width:"100%"},children:[(0,W.jsx)(Sr.A,{fontSize:"small"}),(0,W.jsxs)(i.A,{children:[(0,W.jsx)(c.A,{variant:"body2",fontWeight:"medium",children:"Admin"}),(0,W.jsx)(c.A,{variant:"caption",color:"text.secondary",children:"Full system control and configuration"})]})]})})]})]})})]}),(0,W.jsxs)(_e.A,{sx:{p:2,mt:2,bgcolor:"grey.50"},children:[(0,W.jsxs)(c.A,{variant:"subtitle2",color:"primary",gutterBottom:!0,children:["Selected Role: ",fe.role.charAt(0).toUpperCase()+fe.role.slice(1)]}),(0,W.jsx)(c.A,{variant:"body2",color:"text.secondary",children:Ne(fe.role)})]})]}),(0,W.jsxs)(H.A,{sx:{p:2.5,gap:1},children:[(0,W.jsx)(g.A,{onClick:()=>j(!1),variant:"outlined",disabled:_,children:"Cancel"}),(0,W.jsx)(g.A,{onClick:async()=>{if(be.length&&p){E(!0);try{const t=Be.B.getInstance();let n=0,a=0;for(const s of be)try{const e=ie.find(e=>e.id===s);if(!e){a++;continue}const i={user_email:e.email,role:fe.role};await t.assignUserToGroup(p.id,i),n++}catch(e){a++}j(!1),ye({user_email:"",role:"operator"}),ve([]),0===a?Te(n+" member"+(n>1?"s":"")+" added successfully","success"):0===n?Te("Failed to add any members","error"):Te(n+" member"+(n>1?"s":"")+" added, "+a+" failed","warning"),Ce(p.id),await ge()}catch(e){Te("Failed to add members","error")}finally{E(!1)}}else Te("Please select at least one user and role","warning")},variant:"contained",disabled:_||!be.length,startIcon:_?void 0:(0,W.jsx)(Cn.A,{}),children:_?"Adding...":"Add "+be.length+" Member"+(1!==be.length?"s":"")})]})]}),(0,W.jsx)(u.A,{open:Q.open,autoHideDuration:6e3,onClose:()=>Z(Object.assign({},Q,{open:!1})),children:(0,W.jsx)(h.A,{onClose:()=>Z(Object.assign({},Q,{open:!1})),severity:Q.severity,sx:{width:"100%"},children:Q.message})})]})})};var Pr=n(13801);const Mr=function(e){var t,n;let{onConfigureSection:a}=e;const[o,r]=(0,s.useState)(!0),[l,d]=(0,s.useState)(null),[u,m]=(0,s.useState)(null),[p,x]=(0,s.useState)(null),[f,y]=(0,s.useState)([]),[b,v]=(0,s.useState)([]),[A,j]=(0,s.useState)(null),w=localStorage.getItem("selectedGroupId"),k=null==w?void 0:w.startsWith("user_"),C=(0,Nn.o)(e=>e.userRole);(0,s.useEffect)(()=>{(async()=>{await S()})()},[w]);const S=async()=>{try{if(r(!0),j(null),w&&!k){const e=(await Be.B.getInstance().getMyGroups()).find(e=>e.id===w);e&&d({name:e.name,description:e.description,member_count:e.user_count,created_at:e.created_at})}else d({name:"Personal Workspace",description:"Your personal workspace",is_default:!0,member_count:1});try{const e=await ke.O.getInstance().getDatabricksConfig();m(e)}catch(e){}try{const e=await ms.getConfig();x(e)}catch(e){}try{const e=await xt.m.listEnabledTools();y(e)}catch(e){}try{const e=await tt.getInstance().getMcpServers();v(e.servers||[])}catch(e){}}catch(e){j("Failed to load workspace information")}finally{r(!1)}},_=e=>e?(0,W.jsx)(rt.A,{color:"success",fontSize:"small"}):(0,W.jsx)(ct.A,{color:"warning",fontSize:"small"}),E=e=>e?(0,W.jsx)(V.A,{label:"Configured",size:"small",color:"success",variant:"outlined"}):(0,W.jsx)(V.A,{label:"Not Configured",size:"small",color:"warning",variant:"outlined"}),I=f,T=(()=>{const e=new Map;for(const t of b){const n=e.get(t.name);n?!n.group_id&&t.group_id&&e.set(t.name,t):e.set(t.name,t)}return Array.from(e.values())})().filter(e=>!1!==e.enabled);return o?(0,W.jsx)(i.A,{sx:{p:3},children:(0,W.jsx)(c.A,{children:"Loading workspace information..."})}):A?(0,W.jsx)(i.A,{sx:{p:3},children:(0,W.jsx)(h.A,{severity:"error",children:A})}):(0,W.jsxs)(i.A,{children:[(0,W.jsxs)(i.A,{sx:{mb:3},children:[(0,W.jsx)(c.A,{variant:"h5",gutterBottom:!0,children:"Workspace Configuration Overview"}),(0,W.jsx)(c.A,{variant:"body2",color:"text.secondary",children:"Manage your workspace settings and configurations"})]}),(0,W.jsx)(te.A,{sx:{mb:3},children:(0,W.jsxs)(Qt.A,{children:[(0,W.jsxs)(i.A,{sx:{display:"flex",alignItems:"center",mb:2},children:[(0,W.jsx)(ta.A,{sx:{mr:1,color:"primary.main"}}),(0,W.jsx)(c.A,{variant:"h6",children:(null==l?void 0:l.name)||"Workspace"})]}),(0,W.jsxs)(ue.Ay,{container:!0,spacing:2,children:[(0,W.jsxs)(ue.Ay,{item:!0,xs:12,md:6,children:[(0,W.jsx)(c.A,{variant:"body2",color:"text.secondary",gutterBottom:!0,children:"Workspace Type"}),(0,W.jsx)(c.A,{variant:"body1",children:k?"Personal":"Team"})]}),(0,W.jsxs)(ue.Ay,{item:!0,xs:12,md:6,children:[(0,W.jsx)(c.A,{variant:"body2",color:"text.secondary",gutterBottom:!0,children:"Your Role"}),(0,W.jsx)(V.A,{label:C||"Unknown",size:"small",color:"admin"===C?"primary":"default",icon:"admin"===C?(0,W.jsx)(Pr.A,{}):void 0})]}),!k&&(0,W.jsxs)(W.Fragment,{children:[(0,W.jsxs)(ue.Ay,{item:!0,xs:12,md:6,children:[(0,W.jsx)(c.A,{variant:"body2",color:"text.secondary",gutterBottom:!0,children:"Members"}),(0,W.jsxs)(c.A,{variant:"body1",children:[(null==l?void 0:l.member_count)||0," members"]})]}),(0,W.jsxs)(ue.Ay,{item:!0,xs:12,md:6,children:[(0,W.jsx)(c.A,{variant:"body2",color:"text.secondary",gutterBottom:!0,children:"Created"}),(0,W.jsx)(c.A,{variant:"body1",children:null!=l&&l.created_at?new Date(l.created_at).toLocaleDateString():"N/A"})]})]})]})]})}),(0,W.jsx)(c.A,{variant:"h6",sx:{mb:2},children:"Configuration Status"}),(0,W.jsxs)(ue.Ay,{container:!0,spacing:2,children:[(0,W.jsx)(ue.Ay,{item:!0,xs:12,md:6,children:(0,W.jsxs)(_e.A,{sx:{p:2,height:"100%"},children:[(0,W.jsxs)(i.A,{sx:{display:"flex",alignItems:"center",mb:2},children:[(0,W.jsx)(ha.A,{sx:{mr:1,color:"primary.main"}}),(0,W.jsx)(c.A,{variant:"subtitle1",sx:{flexGrow:1},children:"Databricks Integration"}),E(!!u)]}),u?(0,W.jsxs)(at.A,{dense:!0,children:[(0,W.jsxs)(st.Ay,{children:[(0,W.jsx)(it.A,{sx:{minWidth:36},children:_(!!u.warehouse_id)}),(0,W.jsx)(ot.A,{primary:"SQL Warehouse",secondary:u.warehouse_id||"Not configured"})]}),(0,W.jsxs)(st.Ay,{children:[(0,W.jsx)(it.A,{sx:{minWidth:36},children:_(!!u.catalog)}),(0,W.jsx)(ot.A,{primary:"Catalog",secondary:u.catalog||"Not configured"})]}),(0,W.jsxs)(st.Ay,{children:[(0,W.jsx)(it.A,{sx:{minWidth:36},children:_(u.enabled)}),(0,W.jsx)(ot.A,{primary:"Status",secondary:u.enabled?"Enabled":"Disabled"})]}),(0,W.jsxs)(st.Ay,{children:[(0,W.jsx)(it.A,{sx:{minWidth:36},children:_(!!u.mlflow_enabled)}),(0,W.jsx)(ot.A,{primary:"MLflow Tracing",secondary:u.mlflow_enabled?"Enabled":"Disabled"})]}),(0,W.jsxs)(st.Ay,{children:[(0,W.jsx)(it.A,{sx:{minWidth:36},children:_(!!u.evaluation_enabled)}),(0,W.jsx)(ot.A,{primary:"MLflow Evaluation",secondary:u.evaluation_enabled?"Enabled":"Disabled"})]})]}):(0,W.jsx)(c.A,{variant:"body2",color:"text.secondary",children:"Databricks is not configured for this workspace"})]})}),(0,W.jsx)(ue.Ay,{item:!0,xs:12,md:6,children:(0,W.jsxs)(_e.A,{sx:{p:2,height:"100%"},children:[(0,W.jsxs)(i.A,{sx:{display:"flex",alignItems:"center",mb:2},children:[(0,W.jsx)(ee.A,{sx:{mr:1,color:"primary.main"}}),(0,W.jsx)(c.A,{variant:"subtitle1",sx:{flexGrow:1},children:"Memory Backend"}),E(!!p)]}),p?(0,W.jsxs)(at.A,{dense:!0,children:[(0,W.jsxs)(st.Ay,{children:[(0,W.jsx)(it.A,{sx:{minWidth:36},children:_(!0)}),(0,W.jsx)(ot.A,{primary:"Backend Type",secondary:p.backend_type||"Default"})]}),(0,W.jsxs)(st.Ay,{children:[(0,W.jsx)(it.A,{sx:{minWidth:36},children:_(p.is_default||!1)}),(0,W.jsx)(ot.A,{primary:"Default Configuration",secondary:p.is_default?"Yes":"No"})]}),"databricks"===p.backend_type&&(0,W.jsxs)(st.Ay,{children:[(0,W.jsx)(it.A,{sx:{minWidth:36},children:_(!(null==(t=p.databricks_config)||!t.endpoint_name))}),(0,W.jsx)(ot.A,{primary:"Vector Endpoint",secondary:(null==(n=p.databricks_config)?void 0:n.endpoint_name)||"Not configured"})]})]}):(0,W.jsx)(c.A,{variant:"body2",color:"text.secondary",children:"Memory backend is not configured for this workspace"})]})}),(0,W.jsx)(ue.Ay,{item:!0,xs:12,md:6,children:(0,W.jsxs)(_e.A,{sx:{p:2,height:"100%"},children:[(0,W.jsxs)(i.A,{sx:{display:"flex",alignItems:"center",mb:2},children:[(0,W.jsx)(et.A,{sx:{mr:1,color:"primary.main"}}),(0,W.jsx)(c.A,{variant:"subtitle1",sx:{flexGrow:1},children:"Volume Storage"}),E((null==u?void 0:u.volume_enabled)||!1)]}),null!=u&&u.volume_enabled?(0,W.jsxs)(at.A,{dense:!0,children:[(0,W.jsxs)(st.Ay,{children:[(0,W.jsx)(it.A,{sx:{minWidth:36},children:_(!!u.volume_path)}),(0,W.jsx)(ot.A,{primary:"Volume Path",secondary:u.volume_path||"Not configured"})]}),(0,W.jsxs)(st.Ay,{children:[(0,W.jsx)(it.A,{sx:{minWidth:36},children:_(!0)}),(0,W.jsx)(ot.A,{primary:"File Format",secondary:u.volume_file_format||"json"})]})]}):(0,W.jsx)(c.A,{variant:"body2",color:"text.secondary",children:"Volume storage is not configured for this workspace"})]})}),(0,W.jsx)(ue.Ay,{item:!0,xs:12,md:6,children:(0,W.jsxs)(_e.A,{sx:{p:2,height:"100%"},children:[(0,W.jsxs)(i.A,{sx:{display:"flex",alignItems:"center",mb:2},children:[(0,W.jsx)(et.A,{sx:{mr:1,color:"primary.main"}}),(0,W.jsx)(c.A,{variant:"subtitle1",sx:{flexGrow:1},children:"Knowledge Base"}),E((null==u?void 0:u.knowledge_volume_enabled)||!1)]}),null!=u&&u.knowledge_volume_enabled?(0,W.jsxs)(at.A,{dense:!0,children:[(0,W.jsxs)(st.Ay,{children:[(0,W.jsx)(it.A,{sx:{minWidth:36},children:_(!!u.knowledge_volume_path)}),(0,W.jsx)(ot.A,{primary:"Knowledge Path",secondary:u.knowledge_volume_path||"Not configured"})]}),(0,W.jsxs)(st.Ay,{children:[(0,W.jsx)(it.A,{sx:{minWidth:36},children:_(!0)}),(0,W.jsx)(ot.A,{primary:"Chunk Size",secondary:(u.knowledge_chunk_size||1e3)+" tokens"})]})]}):(0,W.jsx)(c.A,{variant:"body2",color:"text.secondary",children:"Knowledge base is not configured for this workspace"})]})}),(0,W.jsx)(ue.Ay,{item:!0,xs:12,md:6,children:(0,W.jsxs)(_e.A,{sx:{p:2,height:"100%"},children:[(0,W.jsxs)(i.A,{sx:{display:"flex",alignItems:"center",mb:2},children:[(0,W.jsx)($i.A,{sx:{mr:1,color:"primary.main"}}),(0,W.jsx)(c.A,{variant:"subtitle1",sx:{flexGrow:1},children:"Tools"}),(0,W.jsx)(V.A,{label:I.length+" enabled",size:"small",color:I.length>0?"success":"warning",variant:"outlined"})]}),I.length>0?(0,W.jsx)(at.A,{dense:!0,children:I.map(e=>(0,W.jsxs)(st.Ay,{children:[(0,W.jsx)(it.A,{sx:{minWidth:36},children:_(!0)}),(0,W.jsx)(ot.A,{primary:e.title,secondary:e.group_id?"Workspace override":"Base"}),e.group_id&&(0,W.jsx)(V.A,{label:"Workspace",size:"small",color:"primary",variant:"outlined"})]},e.title+"-"+e.id))}):(0,W.jsx)(c.A,{variant:"body2",color:"text.secondary",children:"No tools enabled for this workspace"})]})}),(0,W.jsx)(ue.Ay,{item:!0,xs:12,md:6,children:(0,W.jsxs)(_e.A,{sx:{p:2,height:"100%"},children:[(0,W.jsxs)(i.A,{sx:{display:"flex",alignItems:"center",mb:2},children:[(0,W.jsx)($i.A,{sx:{mr:1,color:"primary.main"}}),(0,W.jsx)(c.A,{variant:"subtitle1",sx:{flexGrow:1},children:"MCP Servers"}),(0,W.jsx)(V.A,{label:T.length+" enabled",size:"small",color:T.length>0?"success":"warning",variant:"outlined"}),a&&(0,W.jsx)(g.A,{size:"small",sx:{ml:1},onClick:()=>a("mcp"),children:"Configure"})]}),T.length>0?(0,W.jsx)(at.A,{dense:!0,children:T.map(e=>(0,W.jsxs)(st.Ay,{children:[(0,W.jsx)(it.A,{sx:{minWidth:36},children:_(!0)}),(0,W.jsx)(ot.A,{primary:e.name,secondary:e.group_id?"Workspace override":"Base"}),e.group_id&&(0,W.jsx)(V.A,{label:"Workspace",size:"small",color:"primary",variant:"outlined"})]},e.name+"-"+e.id))}):(0,W.jsx)(c.A,{variant:"body2",color:"text.secondary",children:"No MCP servers enabled for this workspace"})]})})]}),"admin"===C&&(0,W.jsx)(h.A,{severity:"info",sx:{mt:3},children:(0,W.jsx)(c.A,{variant:"body2",children:"As a workspace admin, you can configure all workspace-specific settings including Databricks integration, memory backend, and storage volumes. Use the navigation menu to access each configuration section."})})]})};const zr=function(){const[e,t]=(0,s.useState)([]),[n,a]=(0,s.useState)(!0),[m,p]=(0,s.useState)(null),[x,f]=(0,s.useState)(null),[y,b]=(0,s.useState)(!1),[v,A]=(0,s.useState)(null),[j,w]=(0,s.useState)({open:!1,message:"",severity:"info"}),k=Cr.getInstance();(0,s.useEffect)(()=>{C()},[]);const C=async()=>{try{a(!0);const e=await k.getUsers();t(e)}catch(e){S("Failed to load users","error")}finally{a(!1)}},S=(e,t)=>{w({open:!0,message:e,severity:t})},_=async(n,a,s)=>{try{p(n);const i={[a]:s},o=await k.updateUserPermissions(n,i);t(e.map(e=>e.id===n?o:e));S(("is_system_admin"===a?"System Admin":"Personal Workspace Manager")+" permission "+(s?"granted":"revoked")+" for "+o.email,"success")}catch(i){S("Failed to update user permissions","error")}finally{p(null)}},E=e=>{const t=[];return e.is_system_admin&&t.push((0,W.jsx)(V.A,{label:"System Admin",color:"error",size:"small",icon:(0,W.jsx)(Pr.A,{})},"sys")),e.is_personal_workspace_manager&&t.push((0,W.jsx)(V.A,{label:"Personal Workspace Manager",color:"primary",size:"small",icon:(0,W.jsx)(no.A,{})},"pw")),0===t.length&&t.push((0,W.jsx)(V.A,{label:"Standard User",color:"default",size:"small",icon:(0,W.jsx)(X.A,{})},"std")),(0,W.jsx)(i.A,{sx:{display:"flex",gap:1,flexWrap:"wrap"},children:t})};return n?(0,W.jsxs)(i.A,{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"400px",children:[(0,W.jsx)(Y.A,{}),(0,W.jsx)(c.A,{variant:"body1",sx:{ml:2},children:"Loading users..."})]}):(0,W.jsxs)(i.A,{children:[(0,W.jsxs)(te.A,{children:[(0,W.jsx)(Xt.A,{title:(0,W.jsxs)(i.A,{sx:{display:"flex",alignItems:"center"},children:[(0,W.jsx)(Ja.A,{sx:{bgcolor:"error.main",mr:2},children:(0,W.jsx)(Pr.A,{})}),(0,W.jsxs)(i.A,{children:[(0,W.jsx)(c.A,{variant:"h5",fontWeight:"600",color:"text.primary",children:"User Permission Management"}),(0,W.jsx)(c.A,{variant:"body2",color:"text.secondary",children:"Grant system-wide and personal workspace permissions to users"})]})]})}),(0,W.jsxs)(Qt.A,{children:[(0,W.jsx)(h.A,{severity:"warning",sx:{mb:3},children:(0,W.jsxs)(c.A,{variant:"body2",children:[(0,W.jsx)("strong",{children:"System Admin Only:"})," Only you can manage these permissions. Use carefully as these grant significant access rights."]})}),(0,W.jsx)(c.A,{variant:"h6",gutterBottom:!0,sx:{mt:2,mb:2},children:"Permission Overview"}),(0,W.jsxs)(i.A,{sx:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(300px, 1fr))",gap:2,mb:3},children:[(0,W.jsxs)(_e.A,{sx:{p:2,border:"1px solid",borderColor:"error.light"},children:[(0,W.jsx)(c.A,{variant:"subtitle1",color:"error.main",fontWeight:"600",children:"System Admin"}),(0,W.jsx)(c.A,{variant:"body2",color:"text.secondary",children:"Full platform control, can manage all workspaces and grant permissions"})]}),(0,W.jsxs)(_e.A,{sx:{p:2,border:"1px solid",borderColor:"primary.light"},children:[(0,W.jsx)(c.A,{variant:"subtitle1",color:"primary.main",fontWeight:"600",children:"Personal Workspace Manager"}),(0,W.jsx)(c.A,{variant:"body2",color:"text.secondary",children:"Can configure Databricks, Memory, and Volumes in their personal workspace"})]})]}),(0,W.jsx)(Pi.A,{component:_e.A,sx:{mt:2},children:(0,W.jsxs)(Mi.A,{children:[(0,W.jsx)(zi.A,{children:(0,W.jsxs)(Li.A,{children:[(0,W.jsx)(Wi.A,{children:"User"}),(0,W.jsx)(Wi.A,{children:"Current Permissions"}),(0,W.jsx)(Wi.A,{align:"center",children:"System Admin"}),(0,W.jsx)(Wi.A,{align:"center",children:"Personal Workspace Manager"}),(0,W.jsx)(Wi.A,{children:"Last Login"}),(0,W.jsx)(Wi.A,{align:"center",children:"Actions"})]})}),(0,W.jsx)(Ri.A,{children:e.map(e=>(0,W.jsxs)(Li.A,{hover:!0,children:[(0,W.jsx)(Wi.A,{children:(0,W.jsxs)(i.A,{children:[(0,W.jsx)(c.A,{variant:"body1",fontWeight:"500",children:e.email}),(0,W.jsxs)(c.A,{variant:"caption",color:"text.secondary",children:["ID: ",e.id]})]})}),(0,W.jsx)(Wi.A,{children:E(e)}),(0,W.jsx)(Wi.A,{align:"center",children:(0,W.jsx)(M.A,{title:"Grant/revoke system-wide administrative access",children:(0,W.jsx)(he.A,{control:(0,W.jsx)(me.A,{checked:e.is_system_admin,onChange:t=>_(e.id,"is_system_admin",t.target.checked),disabled:m===e.id,color:"error"}),label:""})})}),(0,W.jsx)(Wi.A,{align:"center",children:(0,W.jsx)(M.A,{title:"Allow user to configure their personal workspace",children:(0,W.jsx)(he.A,{control:(0,W.jsx)(me.A,{checked:e.is_personal_workspace_manager,onChange:t=>_(e.id,"is_personal_workspace_manager",t.target.checked),disabled:m===e.id,color:"primary"}),label:""})})}),(0,W.jsx)(Wi.A,{children:(0,W.jsx)(c.A,{variant:"body2",color:"text.secondary",children:e.last_login?new Date(e.last_login).toLocaleDateString():"Never"})}),(0,W.jsx)(Wi.A,{align:"center",children:(0,W.jsx)(M.A,{title:"Delete user permanently",children:(0,W.jsx)(d.A,{color:"error",onClick:()=>(e=>{A(e),b(!0)})(e),disabled:x===e.id,size:"small",children:x===e.id?(0,W.jsx)(Y.A,{size:20}):(0,W.jsx)(Q.A,{})})})})]},e.id))})]})}),0===e.length&&(0,W.jsxs)(i.A,{textAlign:"center",py:4,children:[(0,W.jsx)(c.A,{variant:"h6",color:"text.secondary",children:"No users found"}),(0,W.jsx)(c.A,{variant:"body2",color:"text.secondary",children:"Users will appear here once they log in to the system"})]})]})]}),(0,W.jsxs)(o.A,{open:y,onClose:()=>b(!1),maxWidth:"sm",fullWidth:!0,PaperProps:{sx:{borderRadius:2}},children:[(0,W.jsx)(l.A,{children:(0,W.jsxs)(i.A,{sx:{display:"flex",alignItems:"center",gap:1},children:[(0,W.jsx)(Ja.A,{sx:{bgcolor:"error.main"},children:(0,W.jsx)(ct.A,{})}),(0,W.jsxs)(i.A,{children:[(0,W.jsx)(c.A,{variant:"h6",children:"Delete User"}),(0,W.jsx)(c.A,{variant:"body2",color:"text.secondary",children:"This action cannot be undone"})]})]})}),(0,W.jsxs)(r.A,{children:[(0,W.jsx)(h.A,{severity:"error",sx:{mb:2},children:(0,W.jsxs)(c.A,{variant:"body2",children:[(0,W.jsx)("strong",{children:"Warning:"})," This will permanently delete the user and all their data. This action cannot be undone."]})}),(0,W.jsxs)(so.A,{children:["Are you sure you want to delete the user ",(0,W.jsx)("strong",{children:null==v?void 0:v.email}),"?",(0,W.jsx)("br",{}),(0,W.jsx)("br",{}),"This will permanently remove: \u2022 User account and authentication \u2022 All workspace memberships \u2022 User permissions and settings \u2022 Any associated data"]})]}),(0,W.jsxs)(H.A,{sx:{p:2.5,gap:1},children:[(0,W.jsx)(g.A,{onClick:()=>b(!1),variant:"outlined",disabled:null!==x,children:"Cancel"}),(0,W.jsx)(g.A,{onClick:async()=>{if(v)try{f(v.id),await k.deleteUser(v.id),t(e.filter(e=>e.id!==v.id)),b(!1),A(null),S("User "+v.email+" has been deleted successfully","success")}catch(n){S("Failed to delete user","error")}finally{f(null)}},variant:"contained",color:"error",disabled:null!==x,startIcon:x?(0,W.jsx)(Y.A,{size:16}):(0,W.jsx)(Q.A,{}),children:x?"Deleting...":"Delete User"})]})]}),(0,W.jsx)(u.A,{open:j.open,autoHideDuration:6e3,onClose:()=>w(Object.assign({},j,{open:!1})),message:j.message})]})};var Lr=n(15642);const Wr=["children","value","index"];function Rr(e){const{children:t,value:n,index:s}=e,o=(0,a.A)(e,Wr);return(0,W.jsx)("div",Object.assign({role:"tabpanel",hidden:n!==s,id:"config-panel-"+s,"aria-labelledby":"config-nav-"+s},o,{children:n===s&&(0,W.jsx)(i.A,{sx:{py:2},children:t})}))}const Fr=function(e){let{onClose:t}=e;const{t:n}=(0,b.Bd)(),[a,o]=(0,s.useState)("en"),{currentTheme:r,changeTheme:l}=(0,x.C)(),{userRole:m,isLoading:g,loadPermissions:p,isSystemAdmin:f,isPersonalWorkspaceManager:y}=(0,Nn.o)(e=>({userRole:e.userRole,isLoading:e.isLoading,loadPermissions:e.loadPermissions,isSystemAdmin:e.isSystemAdmin,isPersonalWorkspaceManager:e.isPersonalWorkspaceManager})),v=(0,$a.k)(e=>e.currentUser),A=localStorage.getItem("selectedGroupId"),j=A&&A.startsWith("user_"),w=!g&&(f||y||null!==m),k=f||w&&("admin"===m||j&&y),C=f,S=w&&"admin"===m,_=w&&"operator"===m,E=w&&"editor"===m;(0,s.useEffect)(()=>{},[w,m,S,_,E,k,C,j,A,g,f,y]);const[I,T]=(0,s.useState)({open:!1,message:"",severity:"success"}),[D,O]=(0,s.useState)(0),[P,M]=(0,s.useState)(!0),z=s.useMemo(()=>{let e=0;const t=[];return t.push({label:n("configuration.general.title",{defaultValue:"General"}),icon:(0,W.jsx)(Qi.A,{fontSize:"small"}),index:e++,group:"general"}),C&&(t.push({label:n("configuration.workspaces.tab",{defaultValue:"Workspaces"}),icon:(0,W.jsx)(no.A,{fontSize:"small"}),index:e++,group:"system"}),t.push({label:n("configuration.engines.tab",{defaultValue:"Engines"}),icon:(0,W.jsx)(to.A,{fontSize:"small"}),index:e++,group:"system"}),t.push({label:n("configuration.models.global",{defaultValue:"Models (Global)"}),icon:(0,W.jsx)(dt.A,{fontSize:"small"}),index:e++,group:"system"}),t.push({label:n("configuration.tools.global",{defaultValue:"Tools (Global)"}),icon:(0,W.jsx)($i.A,{fontSize:"small"}),index:e++,group:"system"}),t.push({label:n("configuration.userPermissions.tab",{defaultValue:"User Permissions"}),icon:(0,W.jsx)(ht.A,{fontSize:"small"}),index:e++,group:"system"}),P&&t.push({label:n("configuration.database.tab",{defaultValue:"Database Management"}),icon:(0,W.jsx)(et.A,{fontSize:"small"}),index:e++,group:"system"})),k&&(t.push({label:n("configuration.workspaceOverview.tab",{defaultValue:"Workspace Overview"}),icon:(0,W.jsx)(no.A,{fontSize:"small"}),index:e++,group:"workspace"}),t.push({label:n("configuration.databricks.tab",{defaultValue:"Databricks"}),icon:(0,W.jsx)(ha.A,{fontSize:"small"}),index:e++,group:"workspace"}),t.push({label:n("configuration.memoryBackend.tab",{defaultValue:"Memory Backend"}),icon:(0,W.jsx)(ee.A,{fontSize:"small"}),index:e++,group:"workspace"}),t.push({label:n("configuration.mcpServers.tab",{defaultValue:"MCP Servers"}),icon:(0,W.jsx)(ha.A,{fontSize:"small"}),index:e++,group:"workspace"}),t.push({label:n("configuration.models.workspace",{defaultValue:"Models (Workspace)"}),icon:(0,W.jsx)(dt.A,{fontSize:"small"}),index:e++,group:"workspace"}),t.push({label:n("configuration.tools.workspace",{defaultValue:"Tools (Workspace)"}),icon:(0,W.jsx)($i.A,{fontSize:"small"}),index:e++,group:"workspace"})),_||(t.push({label:n("configuration.apiKeys.tab",{defaultValue:"API Keys"}),icon:(0,W.jsx)(Fi.A,{fontSize:"small"}),index:e++,group:"workspace"}),t.push({label:n("configuration.objects.tab",{defaultValue:"Object Management"}),icon:(0,W.jsx)($.A,{fontSize:"small"}),index:e++,group:"workspace"}),t.push({label:n("configuration.prompts.tab",{defaultValue:"Prompt Instructions"}),icon:(0,W.jsx)(eo.A,{fontSize:"small"}),index:e++,group:"workspace"})),t},[P,n,C,k,_]);(0,s.useEffect)(()=>{w||g||p()},[w,g,p]),(0,s.useEffect)(()=>{v&&v.email&&p()},[v,p]),(0,s.useEffect)(()=>{(async()=>{try{const e=ao.g.getInstance(),t=await e.getCurrentLanguage();o(t),M(!0)}catch(e){}})()},[]);const L=e=>{O(e)},R=async e=>{const t=e.target.value;try{const e=ao.g.getInstance();await e.setLanguage(t),o(t),T({open:!0,message:n("configuration.language.saved",{defaultValue:"Language changed successfully"}),severity:"success"})}catch(a){T({open:!0,message:a instanceof Error?a.message:"Failed to change language",severity:"error"})}},F=e=>{const t=e.target.value;l(t),T({open:!0,message:n("configuration.theme.saved",{defaultValue:"Theme changed successfully"}),severity:"success"})},B=()=>{T(Object.assign({},I,{open:!1}))};(0,s.useEffect)(()=>{const e=e=>{try{const e=z.find(e=>e.label===n("configuration.apiKeys.tab",{defaultValue:"API Keys"}));e&&O(e.index)}catch(t){}};return window.addEventListener("kasal:navigate-config",e),()=>window.removeEventListener("kasal:navigate-config",e)},[z,n]);const V=s.useMemo(()=>z.filter(e=>"general"===e.group),[z]),U=s.useMemo(()=>z.filter(e=>"system"===e.group),[z]),H=s.useMemo(()=>z.filter(e=>"workspace"===e.group),[z]);return(0,W.jsxs)(i.A,{sx:{width:"80vw",height:"80vh",mx:"auto",px:2,py:1.5},children:[(0,W.jsxs)(i.A,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",mb:3,pb:1.5,borderBottom:"1px solid",borderColor:"divider"},children:[(0,W.jsxs)(i.A,{sx:{display:"flex",alignItems:"center"},children:[(0,W.jsx)(ht.A,{sx:{mr:1.5,color:"primary.main",fontSize:"1.4rem"}}),(0,W.jsx)(c.A,{variant:"h5",children:n("configuration.title")})]}),t&&(0,W.jsx)(d.A,{onClick:t,size:"small",sx:{color:"text.secondary","&:hover":{color:"text.primary"}},children:(0,W.jsx)(N.A,{})})]}),w?(0,W.jsxs)(i.A,{sx:{display:"flex",flexDirection:"row",gap:2,height:"calc(100% - 60px)",overflow:"hidden"},children:[(0,W.jsx)(_e.A,{sx:{width:240,flexShrink:0,borderRadius:1,height:"100%",overflow:"auto"},elevation:1,children:(0,W.jsxs)(at.A,{sx:{py:1},children:[V.map(e=>(0,W.jsxs)(aa.A,{selected:D===e.index,onClick:()=>L(e.index),sx:{mb:.5,borderRadius:1,mx:.5,"&.Mui-selected":{backgroundColor:"action.selected","&:hover":{backgroundColor:"action.hover"}}},children:[(0,W.jsx)(it.A,{sx:{minWidth:40},children:e.icon}),(0,W.jsx)(ot.A,{primary:e.label})]},e.index)),U.length>0&&(0,W.jsx)(i.A,{sx:{px:2,pt:1,pb:.5},children:(0,W.jsx)(c.A,{variant:"overline",color:"text.secondary",children:"System Administration"})}),U.map(e=>(0,W.jsxs)(aa.A,{selected:D===e.index,onClick:()=>L(e.index),sx:{mb:.5,borderRadius:1,mx:.5,"&.Mui-selected":{backgroundColor:"action.selected","&:hover":{backgroundColor:"action.hover"}}},children:[(0,W.jsx)(it.A,{sx:{minWidth:40},children:e.icon}),(0,W.jsx)(ot.A,{primary:e.label})]},e.index)),H.length>0&&(0,W.jsx)(i.A,{sx:{px:2,pt:1,pb:.5},children:(0,W.jsx)(c.A,{variant:"overline",color:"text.secondary",children:"Workspace Settings"})}),H.map(e=>(0,W.jsxs)(aa.A,{selected:D===e.index,onClick:()=>L(e.index),sx:{mb:.5,borderRadius:1,mx:.5,"&.Mui-selected":{backgroundColor:"action.selected","&:hover":{backgroundColor:"action.hover"}}},children:[(0,W.jsx)(it.A,{sx:{minWidth:40},children:e.icon}),(0,W.jsx)(ot.A,{primary:e.label})]},e.index))]})}),(0,W.jsx)(i.A,{sx:{flex:1,bgcolor:"background.paper",borderRadius:1,p:2,overflow:"auto",height:"100%"},children:z.map(e=>e.label===n("configuration.general.title",{defaultValue:"General"})?(0,W.jsxs)(Rr,{value:D,index:e.index,children:[(0,W.jsxs)(i.A,{sx:{mb:3},children:[(0,W.jsxs)(i.A,{sx:{display:"flex",alignItems:"center",mb:1.5},children:[(0,W.jsx)(Qi.A,{sx:{mr:1,color:"primary.main",fontSize:"1.2rem"}}),(0,W.jsx)(c.A,{variant:"subtitle1",fontWeight:"medium",children:n("configuration.language.title")})]}),(0,W.jsxs)(re.A,{fullWidth:!0,size:"small",children:[(0,W.jsx)(le.A,{id:"language-select-label",children:n("configuration.language.select")}),(0,W.jsx)(ce.A,{labelId:"language-select-label",value:a,onChange:R,label:n("configuration.language.select"),size:"small",children:Object.entries(Lr.Y).map(e=>{let[t,{nativeName:n}]=e;return(0,W.jsx)(de.A,{value:t,children:n},t)})})]})]}),(0,W.jsxs)(i.A,{sx:{mb:3},children:[(0,W.jsxs)(i.A,{sx:{display:"flex",alignItems:"center",mb:1.5},children:[(0,W.jsx)(Zi.A,{sx:{mr:1,color:"primary.main",fontSize:"1.2rem"}}),(0,W.jsx)(c.A,{variant:"subtitle1",fontWeight:"medium",children:n("configuration.theme.title")})]}),(0,W.jsxs)(re.A,{fullWidth:!0,size:"small",children:[(0,W.jsx)(le.A,{children:n("configuration.theme.select")}),(0,W.jsxs)(ce.A,{value:r,onChange:F,label:n("configuration.theme.select"),children:[(0,W.jsx)(de.A,{value:"professional",children:"Professional (Blue)"}),(0,W.jsx)(de.A,{value:"calmEarth",children:"Calm Earth (Green)"}),(0,W.jsx)(de.A,{value:"deepOcean",children:"Deep Ocean (Dark)"}),(0,W.jsx)(de.A,{value:"vibrantCreative",children:"Vibrant Creative (Purple)"})]})]})]})]},e.index):e.label===n("configuration.workspaceOverview.tab",{defaultValue:"Workspace Overview"})?(0,W.jsx)(Rr,{value:D,index:e.index,children:(0,W.jsx)(Mr,{})},e.index):e.label===n("configuration.workspaces.tab",{defaultValue:"Workspaces"})?(0,W.jsx)(Rr,{value:D,index:e.index,children:(0,W.jsx)(Nr,{})},e.index):e.label===n("configuration.engines.tab",{defaultValue:"Engines"})?(0,W.jsx)(Rr,{value:D,index:e.index,children:(0,W.jsx)(Do,{})},e.index):e.label===n("configuration.models.global",{defaultValue:"Models (Global)"})?(0,W.jsx)(Rr,{value:D,index:e.index,children:(0,W.jsx)(xo,{mode:"system"})},e.index):e.label===n("configuration.models.workspace",{defaultValue:"Models (Workspace)"})?(0,W.jsx)(Rr,{value:D,index:e.index,children:(0,W.jsx)(xo,{mode:"workspace"})},e.index):e.label===n("configuration.tools.global",{defaultValue:"Tools (Global)"})?(0,W.jsx)(Rr,{value:D,index:e.index,children:(0,W.jsx)(wo,{mode:"system"})},e.index):e.label===n("configuration.tools.workspace",{defaultValue:"Tools (Workspace)"})?(0,W.jsx)(Rr,{value:D,index:e.index,children:(0,W.jsx)(wo,{mode:"workspace"})},e.index):e.label===n("configuration.userPermissions.tab",{defaultValue:"User Permissions"})?(0,W.jsx)(Rr,{value:D,index:e.index,children:(0,W.jsx)(zr,{})},e.index):e.label===n("configuration.database.tab",{defaultValue:"Database Management"})?(0,W.jsx)(Rr,{value:D,index:e.index,children:(0,W.jsx)(Ar,{})},e.index):e.label===n("configuration.mcpServers.tab",{defaultValue:"MCP Servers"})?(0,W.jsx)(Rr,{value:D,index:e.index,children:(0,W.jsx)(ya,{})},e.index):e.label===n("configuration.memoryBackend.tab",{defaultValue:"Memory Backend"})?(0,W.jsx)(Rr,{value:D,index:e.index,children:(0,W.jsx)(ur,{})},e.index):e.label===n("configuration.databricks.tab",{defaultValue:"Databricks"})?(0,W.jsx)(Rr,{value:D,index:e.index,children:(0,W.jsx)(Eo,{onSaved:t})},e.index):e.label===n("configuration.apiKeys.tab",{defaultValue:"API Keys"})?(0,W.jsx)(Rr,{value:D,index:e.index,children:(0,W.jsx)(Vi,{})},e.index):e.label===n("configuration.objects.tab",{defaultValue:"Object Management"})?(0,W.jsx)(Rr,{value:D,index:e.index,children:(0,W.jsx)(fo,{})},e.index):e.label===n("configuration.prompts.tab",{defaultValue:"Prompt Instructions"})?(0,W.jsx)(Rr,{value:D,index:e.index,children:(0,W.jsx)(So,{})},e.index):null)})]}):(0,W.jsx)(i.A,{sx:{display:"flex",justifyContent:"center",alignItems:"center",height:"calc(100% - 60px)"},children:(0,W.jsx)(c.A,{variant:"body1",color:"text.secondary",children:"Loading permissions..."})}),(0,W.jsx)(u.A,{open:I.open,autoHideDuration:6e3,onClose:B,anchorOrigin:{vertical:"bottom",horizontal:"center"},children:(0,W.jsx)(h.A,{onClose:B,severity:I.severity,sx:{width:"100%"},children:I.message})})]})};var Br=n(29722);const Vr=e=>{let{nodes:t,edges:n,trigger:a,disabled:i=!1}=e;const[c,d]=(0,s.useState)(!1),[u,h]=(0,s.useState)(""),[m,p]=(0,s.useState)(null),x=(0,s.useRef)(null),[f,y]=(0,s.useState)(!1),{activeTabId:b,updateTabCrewInfo:v}=k();(0,s.useEffect)(()=>{const e=()=>{i||d(!0)},t=async e=>{if(i)return;const t=e,{tabId:n,crewId:a}=t.detail;try{const e=k.getState().getTab(n);if(!e)return;y(!0);const t=e.nodes.reduce((e,t)=>(e.some(e=>e.id===t.id)||e.push(t),e),[]),s=e.edges.reduce((e,t)=>{const n=t.source+"-"+t.target;return e.some(e=>e.source+"-"+e.target===n)||e.push(t),e},[]),i=new Set(t.map(e=>e.id)),o=s.filter(e=>i.has(e.source)&&i.has(e.target)),r=await Re.updateCrew(a,{name:e.savedCrewName||e.name,agent_ids:[],task_ids:[],nodes:t,edges:o}),{updateTabCrewInfo:l,markTabClean:c}=k.getState();l(n,r.id,r.name),c(n),setTimeout(()=>{const e=new CustomEvent("updateCrewComplete",{detail:{crewId:r.id,crewName:r.name}});window.dispatchEvent(e)},100)}catch(m){}finally{y(!1)}},n=async e=>{if(i)return;const t=e,{tabId:n,crewName:a}=t.detail;try{const e=k.getState().getTab(n);if(!e)return;y(!0);const t=(await Re.getCrews()).find(e=>e.name===a);if(!t)return void d(!0);const s=e.nodes.reduce((e,t)=>(e.some(e=>e.id===t.id)||e.push(t),e),[]),i=e.edges.reduce((e,t)=>{const n=t.source+"-"+t.target;return e.some(e=>e.source+"-"+e.target===n)||e.push(t),e},[]),o=await Re.updateCrew(t.id.toString(),{name:a,agent_ids:[],task_ids:[],nodes:s,edges:i}),{updateTabCrewInfo:r,markTabClean:l}=k.getState();r(n,o.id,o.name),l(n),setTimeout(()=>{const e=new CustomEvent("updateCrewComplete",{detail:{crewId:o.id,crewName:o.name}});window.dispatchEvent(e)},100)}catch(m){d(!0)}finally{y(!1)}};return window.addEventListener("openSaveCrewDialog",e),window.addEventListener("updateExistingCrew",t),window.addEventListener("updateExistingCrewByName",n),()=>{window.removeEventListener("openSaveCrewDialog",e),window.removeEventListener("updateExistingCrew",t),window.removeEventListener("updateExistingCrewByName",n)}},[i]);const A=()=>{d(!1),h(""),p("")},j=async e=>{if(e&&e.preventDefault(),u.trim()){if(!f){y(!0);try{const e=t.reduce((e,t)=>(e.some(e=>e.id===t.id)||e.push(t),e),[]),a=n.reduce((e,t)=>{const n=t.source+"-"+t.target;return e.some(e=>e.source+"-"+e.target===n)||e.push(t),e},[]),s=e.filter(e=>"agentNode"===e.type).filter(e=>{var t;const n=null==(t=e.data)?void 0:t.agentId;if(void 0!==n&&null!==n&&!isNaN(Number(n)))return!0;const a=e.id.match(/^agent-(\d+)/);return a&&a[1]}).map(e=>{var t;const n=null==(t=e.data)?void 0:t.agentId;if(void 0!==n&&null!==n&&!isNaN(Number(n)))return String(Number(n));const a=e.id.match(/^agent-(\d+)/);return a?a[1]:null}).filter(Boolean),i=Array.from(new Set(s)),o=e.filter(e=>"taskNode"===e.type).filter(e=>{var t;const n=null==(t=e.data)?void 0:t.taskId;if(void 0!==n&&null!==n&&!isNaN(Number(n)))return!0;const a=e.id.match(/^task-(\d+)/);return a&&a[1]}).map(e=>{var t;const n=null==(t=e.data)?void 0:t.taskId;if(void 0!==n&&null!==n&&!isNaN(Number(n)))return String(Number(n));const a=e.id.match(/^task-(\d+)/);return a?a[1]:null}).filter(Boolean),r=Array.from(new Set(o)),l=new Set(e.map(e=>e.id)),c=a.filter(e=>l.has(e.source)&&l.has(e.target)),d=e.map(e=>{if("taskNode"===e.type){var t,n;const a=(null==(t=e.data)?void 0:t.config)||{};return Object.assign({},e,{data:Object.assign({},e.data,{config:Object.assign({},a,{markdown:void 0!==(null==(n=e.data)?void 0:n.markdown)?e.data.markdown:a.markdown||!1})})})}return e}),h=await Re.saveCrew({name:u,agent_ids:i,task_ids:r,nodes:d,edges:c});b&&h.id&&v(b,h.id,u),A(),setTimeout(()=>{const e=new CustomEvent("saveCrewComplete",{detail:{crewId:h.id,crewName:u}});window.dispatchEvent(e)},100)}catch(m){var a;if(be.A.isAxiosError(m)&&null!=(a=m.response)&&a.data){const t=m.response.data;let n="Failed to save crew";if("string"===typeof t)n=t;else if(t.detail&&Array.isArray(t.detail)){var s;n=(null==(s=t.detail[0])?void 0:s.msg)||t.detail[0]||"Validation error"}else t.detail?n=t.detail:t.message&&(n=t.message);p(n)}else p(m instanceof Error?m.message:"Failed to save crew")}finally{y(!1)}}}else p("Crew name is required")};return(0,W.jsxs)(W.Fragment,{children:[s.cloneElement(a,{onClick:()=>{i||d(!0)},disabled:i}),(0,W.jsxs)(o.A,{open:c,onClose:A,maxWidth:"sm",fullWidth:!0,component:"form",onSubmit:j,children:[(0,W.jsx)(l.A,{children:"Save Crew"}),(0,W.jsx)(r.A,{children:(0,W.jsx)(U.A,{inputRef:x,margin:"dense",label:"Crew Name",type:"text",fullWidth:!0,value:u,onChange:e=>h(e.target.value),error:!!m,helperText:m,onKeyDown:e=>{"Enter"===e.key&&(e.preventDefault(),e.stopPropagation(),j())},autoFocus:!0})}),(0,W.jsxs)(H.A,{children:[(0,W.jsx)(g.A,{onClick:A,children:"Cancel"}),(0,W.jsx)(g.A,{type:"submit",variant:"contained",color:"primary",children:"Save"})]})]})]})};var Ur=n(69203);const Hr=(e,t)=>{const n=new Set(t.map(e=>e.id)),a=new Set(t.map(e=>e.source+"-"+e.target));return e.filter(e=>{const t=e.source+"-"+e.target;return!n.has(e.id)&&!a.has(t)})},Kr="split",Gr="left-only",qr="right-only",Jr=["job_id","execution_id"];(()=>{if("undefined"!==typeof window&&!Object.prototype.hasOwnProperty.call(window,"_resizeObserverHandled")){Object.defineProperty(window,"_resizeObserverHandled",{value:!0,writable:!1,configurable:!1}),window.addEventListener("error",e=>{if(e.message&&(e.message.includes("ResizeObserver loop")||e.message.includes("ResizeObserver Loop")))return e.stopImmediatePropagation(),e.preventDefault(),!1}),window.addEventListener("unhandledrejection",e=>{if(e.reason&&"string"===typeof e.reason.message&&(e.reason.message.includes("ResizeObserver loop")||e.reason.message.includes("ResizeObserver Loop")))return e.preventDefault(),!1});const e=console.error;console.error=function(){for(var t=arguments.length,n=new Array(t),a=0;a<t;a++)n[a]=arguments[a];n.length>0&&"string"===typeof n[0]&&(n[0].includes("ResizeObserver loop")||n[0].includes("ResizeObserver Loop"))||e.apply(console,n)}}})();const Yr=()=>{var e,t;const{isDarkMode:x}=f(),{showError:A,errorMessage:j,handleCloseError:D,showErrorMessage:P}=(()=>{const[e,t]=(0,s.useState)(!1),[n,a]=(0,s.useState)("");return{showError:e,errorMessage:n,handleCloseError:(0,s.useCallback)(()=>{t(!1)},[]),showErrorMessage:(0,s.useCallback)(e=>{a(e),t(!0)},[])}})(),{hasSeenTutorial:M,hasSeenHandlebar:z,setHasSeenTutorial:L,setHasSeenHandlebar:R,uiState:{isMinimapVisible:F,controlsVisible:V},setUIState:U}=(0,p.Y)(),{tabs:H,getActiveTab:K,updateTabExecutionStatus:G}=k(),{crewAIFlowEnabled:J}=(0,C.d)(),{runHistory:Y,startPolling:X,stopPolling:Q}=(0,_.a)(),{nodes:Z,edges:$,setNodes:ee,setEdges:te,onNodesChange:ne,onEdgesChange:ae,onConnect:se,handleEdgeContextMenu:ie,selectedEdges:oe,setSelectedEdges:re,manuallyPositionedNodes:le}=(e=>{let{showErrorMessage:t}=e;const{t:n}=(0,b.Bd)(),{nodes:a,edges:i,setNodes:o,setEdges:r,selectedEdges:l,setSelectedEdges:c,contextMenu:d,setContextMenu:u,flowConfig:h,setFlowConfig:m,draggedNodeIds:g,setDraggedNodeIds:x,manuallyPositionedNodes:f,setManuallyPositionedNodes:v,clearCanvas:A,deleteEdge:j,addEdge:w}=(0,p.Y)(),k=(0,s.useMemo)(()=>new Set(g),[g]),C=(0,s.useMemo)(()=>new Set(f),[f]),S=(0,s.useCallback)(()=>{A()},[A]),_=(0,s.useCallback)(e=>{const t=e.filter(e=>"position"===e.type),n=e.filter(e=>"position"!==e.type||!("position"in e));if(t.length>0){const e=new Set(k),n=new Set(C);o(a.map(a=>{const s=t.find(e=>e.id===a.id);return s&&(s.dragging?(e.add(a.id),n.add(a.id)):e.has(a.id)&&e.delete(a.id),s.position&&isFinite(s.position.x)&&isFinite(s.position.y))?Object.assign({},a,{position:{x:s.position.x,y:s.position.y}}):a})),x(Array.from(e)),v(Array.from(n))}n.length>0&&o((0,y._0)(n,a))},[a,o,k,C,x,v]);(0,s.useEffect)(()=>{const e=new Set(a.map(e=>e.id));let t=!1;const n=new Set;C.forEach(a=>{e.has(a)?n.add(a):t=!0}),t&&v(Array.from(n))},[a,C,v]);const E=(0,s.useCallback)(e=>{r((0,y.zW)(e,i))},[i,r]),I=(0,s.useCallback)(e=>{if(e.source&&e.target){const s=a.find(t=>t.id===e.source),i=a.find(t=>t.id===e.target);if(!s||!i)return;if("agentNode"===s.type&&"agentNode"===i.type)return void t(n("nemo.errors.agentConnection"));let o=e;"agentNode"===s.type&&"taskNode"===i.type&&(o=Object.assign({},e,{sourceHandle:"right",targetHandle:"left"})),w(o)}},[a,w,n,t]),T=(0,s.useCallback)((e,t)=>{e.preventDefault(),u({mouseX:e.clientX,mouseY:e.clientY,edgeId:t.id})},[u]),D=(0,s.useCallback)(()=>{u(null)},[u]),O=(0,s.useCallback)(e=>{j(e)},[j]);return{nodes:a,setNodes:o,edges:i,setEdges:r,onNodesChange:_,onEdgesChange:E,onConnect:I,handleClearCanvas:S,handleEdgeContextMenu:T,handleContextMenuClose:D,handleDeleteEdge:O,selectedEdges:l,setSelectedEdges:c,contextMenu:d,flowConfig:h,setFlowConfig:m,manuallyPositionedNodes:Array.from(C),setManuallyPositionedNodes:e=>v(e)}})({showErrorMessage:P}),{activeTabId:ce}=S({nodes:Z,edges:$,setNodes:ee,setEdges:te}),{agents:de,addAgentNode:ue,isAgentDialogOpen:he,setIsAgentDialogOpen:me,handleAgentSelect:ge,handleShowAgentForm:pe,fetchAgents:xe,openInCreateMode:ye,openAgentDialog:be}=(e=>{let{nodes:t,setNodes:n}=e;const[a,i]=(0,s.useState)([]),[o,r]=(0,s.useState)(!1),[l,c]=(0,s.useState)(!1),d=(0,s.useCallback)(async()=>{try{const e=await fe.AgentService.listAgents();i(e)}catch(e){}},[]);(0,s.useEffect)(()=>{d()},[d]);const u=(0,s.useCallback)((e,t)=>{const a=t||{x:100,y:400*Math.random()},s={id:"agent-"+(e.id||"temp-"+Date.now()+"-"+Math.random().toString(36).substr(2,9)),type:"agentNode",position:a,data:Object.assign({},e,{agentId:e.id,id:e.id,label:e.name,type:"agent"})};n(e=>[...e,s])},[n]),h=(0,s.useCallback)(e=>{e.forEach((e,t)=>{u(e,{x:100,y:200+150*t})}),r(!1)},[u]),m=(0,s.useCallback)(()=>{},[]),g=(0,s.useCallback)(function(e){void 0===e&&(e=!1),c(e),r(!0)},[]);return{agents:a,addAgentNode:u,isAgentDialogOpen:o,setIsAgentDialogOpen:r,handleAgentSelect:h,handleShowAgentForm:m,fetchAgents:d,openInCreateMode:l,openAgentDialog:g}})({nodes:Z,setNodes:ee}),{tasks:ve,addTaskNode:Ae,isTaskDialogOpen:je,setIsTaskDialogOpen:we,handleTaskSelect:ke,handleShowTaskForm:Ce,fetchTasks:Se,openInCreateMode:_e,openTaskDialog:Ee}=(e=>{let{nodes:t,setNodes:n}=e;const[a,i]=(0,s.useState)([]),[o,r]=(0,s.useState)(!1),[l,c]=(0,s.useState)(!1),d=(0,s.useCallback)(async()=>{try{const e=await Fe.TaskService.listTasks();i(e)}catch(e){}},[]);(0,s.useEffect)(()=>{d()},[d]);const u=(0,s.useCallback)((e,t)=>{var a;const s=t||{x:100,y:400*Math.random()},i={id:"task-"+e.id,type:"taskNode",position:s,data:Object.assign({},e,{taskId:e.id,label:e.name,type:"task",config:Object.assign({},e.config,{markdown:(null==(a=e.config)?void 0:a.markdown)||!1})})};n(e=>[...e,i])},[n]),h=(0,s.useCallback)(e=>{e.forEach((e,t)=>{u(e,{x:400,y:200+150*t})}),r(!1)},[u]),m=(0,s.useCallback)(()=>{},[]),g=(0,s.useCallback)(function(e){void 0===e&&(e=!1),c(e),r(!0)},[]);return{tasks:a,addTaskNode:u,isTaskDialogOpen:o,setIsTaskDialogOpen:r,handleTaskSelect:h,handleShowTaskForm:m,fetchTasks:d,openInCreateMode:l,openTaskDialog:g}})({nodes:Z,setNodes:ee}),{updateScreenDimensions:Ie,setChatPanelWidth:Te,setChatPanelCollapsed:De,setChatPanelVisible:Oe,setExecutionHistoryHeight:Ne,setExecutionHistoryVisible:Pe,setPanelPosition:Me,setAreFlowsVisible:ze,chatPanelWidth:Le,chatPanelCollapsedWidth:We,chatPanelCollapsed:Re,chatPanelSide:Be,leftSidebarBaseWidth:Ue,rightSidebarWidth:He,executionHistoryHeight:Ke,chatPanelVisible:Ge,executionHistoryVisible:qe,panelPosition:Je,areFlowsVisible:Ye}=(0,E.z)(),{isDraggingPanel:Xe,setIsDraggingPanel:Qe,panelState:Ze,setPanelState:$e,handlePanelDragStart:et,handleSnapToLeft:tt,handleSnapToRight:nt,handleResetPanel:at}=(()=>{const[e,t]=(0,s.useState)(50),[n,a]=(0,s.useState)(!1),[i,o]=(0,s.useState)(Kr),[r,l]=(0,s.useState)(!1),[c,d]=(0,s.useState)(!0),[u,h]=(0,s.useState)(!0),m=(0,s.useCallback)(()=>{a(!0)},[]),g=(0,s.useCallback)(()=>{o(qr),t(5)},[]),p=(0,s.useCallback)(()=>{o(Gr),t(95)},[]),x=(0,s.useCallback)(()=>{o(Kr),t(50)},[]),f=(0,s.useCallback)(()=>{l(e=>(e?(t(50),setTimeout(()=>{var e;const t=null==(e=document.querySelector("[data-crew-container]"))?void 0:e.parentElement;t&&(t.style.gridTemplateColumns="1fr")},0)):setTimeout(()=>{var e;const t=null==(e=document.querySelector("[data-crew-container]"))?void 0:e.parentElement;t&&(t.style.gridTemplateColumns="50% 50%")},0),!e))},[]),y=(0,s.useCallback)(()=>{h(e=>!e)},[]);return(0,s.useEffect)(()=>{if(n){const e=e=>{const n=document.querySelector(".react-flow");if(!n)return;const a=n.getBoundingClientRect(),s=(e.clientX-a.left)/a.width*100,i=Math.max(10,Math.min(90,s));t(i)},n=()=>{a(!1)};return document.addEventListener("mousemove",e),document.addEventListener("mouseup",n),()=>{document.removeEventListener("mousemove",e),document.removeEventListener("mouseup",n)}}},[n]),{panelPosition:e,setPanelPosition:t,isDraggingPanel:n,setIsDraggingPanel:a,panelState:i,setPanelState:o,areFlowsVisible:r,setAreFlowsVisible:l,handlePanelDragStart:m,handleSnapToLeft:g,handleSnapToRight:p,handleResetPanel:x,toggleFlowsVisibility:f,showRunHistory:c,setShowRunHistory:d,showChatPanel:u,setShowChatPanel:h,toggleChatPanel:y}})(),st=s.useCallback(()=>{ze(!Ye)},[Ye,ze]),it=s.useCallback(()=>{Oe(!Ge),setTimeout(()=>{const e=new CustomEvent("recalculateNodePositions",{detail:{reason:"chat-panel-visibility-toggle"}});window.dispatchEvent(e)},350)},[Ge,Oe]),ot=s.useCallback(e=>{const t="function"===typeof e?e(Je):e;Me(t)},[Je,Me]),rt=s.useCallback(()=>{Pe(!qe)},[qe,Pe]);s.useEffect(()=>{const e=()=>{qe||Pe(!0)};return window.addEventListener("openExecutionHistory",e),()=>{window.removeEventListener("openExecutionHistory",e)}},[qe,Pe]);const lt=((e,t)=>{const[n,a]=(0,s.useState)(!1),[i,o]=(0,s.useState)(!1),[r,l]=(0,s.useState)(!1),[c,d]=(0,s.useState)(!1),[u,h]=(0,s.useState)(!1),[m,g]=(0,s.useState)(!1),[p,x]=(0,s.useState)(!1),[f,y]=(0,s.useState)(!1),[b,v]=(0,s.useState)(!1),[A,j]=(0,s.useState)(!1);(0,s.useEffect)(()=>{},[A]),(0,s.useEffect)(()=>{const e=new URLSearchParams(window.location.search),t=e.get("config"),n=e.get("provider");"apikeys"===t&&(h(!0),n&&Ve.getState().openApiKeyEditor(n),window.history.replaceState({},document.title,window.location.pathname))},[]),(0,s.useCallback)(()=>{g(!0)},[]);const w=(0,s.useCallback)(()=>{j(!1),t(!0)},[t]);return(0,s.useEffect)(()=>{const e=()=>{h(!0)};return window.addEventListener("openConfigAPIKeysInternal",e),()=>{window.removeEventListener("openConfigAPIKeysInternal",e)}},[]),{isAgentDialogOpen:n,setIsAgentDialogOpen:a,isTaskDialogOpen:i,setIsTaskDialogOpen:o,isCrewPlanningOpen:r,setCrewPlanningOpen:l,isScheduleDialogOpen:c,setScheduleDialogOpen:d,isAPIKeysDialogOpen:u,setIsAPIKeysDialogOpen:h,isToolsDialogOpen:m,setIsToolsDialogOpen:g,isLogsDialogOpen:p,setIsLogsDialogOpen:x,isConfigurationDialogOpen:f,setIsConfigurationDialogOpen:y,isFlowDialogOpen:b,setIsFlowDialogOpen:v,isTutorialOpen:A,setIsTutorialOpen:j,handleCloseTutorial:w}})(0,L),[ct,dt]=s.useState(!1),[ut,ht]=s.useState(!1),[mt,gt]=s.useState(!1),[pt,xt]=s.useState(0),[ft,yt]=s.useState(!1),[bt,vt]=s.useState([]),[At,jt]=s.useState(null),[wt,kt]=s.useState(!1),[Ct,St]=s.useState(null),[_t,Et]=s.useState(null),[It,Tt]=s.useState(null),{handleResizeStart:Dt}=I(Te);s.useEffect(()=>{const e=()=>{Ie(window.innerWidth,window.innerHeight)};return Ie(window.innerWidth,window.innerHeight),window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)},[Ie]);const{handleHistoryResizeStart:Ot}=T(Ne,gt);s.useEffect(()=>{if(!mt&&qe){const e=100,t=32,n=4;if(0===pt)Ne(e+t);else{const a=Math.min(pt,n);Ne(e+a*t)}}},[pt,mt,qe,Ne]);const{isExecuting:Nt,selectedModel:Pt,planningEnabled:Mt,reasoningEnabled:Lt,schemaDetectionEnabled:Wt,tools:Rt,selectedTools:Bt,setSelectedModel:Vt,setPlanningEnabled:Ut,setReasoningEnabled:Ht,setSchemaDetectionEnabled:Kt,setSelectedTools:Gt,handleRunClick:qt,handleGenerateCrew:Jt,executeTab:Yt,executeFlow:Xt,setNodes:Qt,setEdges:Zt,showInputVariablesDialog:$t,setShowInputVariablesDialog:en,executeWithVariables:tn}=(0,v.E)();s.useEffect(()=>{},[It,Nt]),s.useEffect(()=>("undefined"!==typeof window&&(window.clearStuckTabs=()=>{const e=k.getState();e.tabs.forEach(t=>{"running"===t.executionStatus&&e.updateTabExecutionStatus(t.id,"completed")})}),()=>{"undefined"!==typeof window&&delete window.clearStuckTabs}),[]),(0,s.useEffect)(()=>{Qt(Z)},[Z,Qt]),(0,s.useEffect)(()=>{Zt($)},[$,Zt]),(0,s.useEffect)(()=>{localStorage.getItem("hasSeenHandlebar")||(localStorage.setItem("hasSeenHandlebar","true"),R(!0))},[R]),(0,s.useEffect)(()=>{const e=e=>{const{jobId:t}=e.detail;Et(t)};return window.addEventListener("jobViewed",e),()=>{window.removeEventListener("jobViewed",e)}},[]);const[nn,an]=s.useState(null),on=s.useRef(null),rn=s.useRef(null),{loadTaskStates:ln,clearTaskStates:cn}=(0,zt.useTaskExecutionStore)();(0,s.useEffect)(()=>{const e=e=>{const{jobId:t}=e.detail;nn!==t&&cn(),an(t),rn.current&&clearInterval(rn.current),rn.current=setInterval(()=>{ln(t)},2e3),ln(t),X()};return window.addEventListener("jobCreated",e),()=>{window.removeEventListener("jobCreated",e)}},[X,ln,cn,nn]),(0,s.useEffect)(()=>{const e=()=>{rn.current&&(clearInterval(rn.current),rn.current=null),setTimeout(()=>{cn()},1e4);const e=K(),t=k.getState();It?(t.updateTabExecutionStatus(It,"completed"),Tt(null)):"running"===(null==e?void 0:e.executionStatus)?t.updateTabExecutionStatus(e.id,"completed"):t.tabs.forEach(e=>{"running"===e.executionStatus&&t.updateTabExecutionStatus(e.id,"completed")}),on.current&&(clearTimeout(on.current),on.current=null),an(null)},t=()=>{rn.current&&(clearInterval(rn.current),rn.current=null),setTimeout(()=>{cn()},1e4);const e=K(),t=k.getState();It?(t.updateTabExecutionStatus(It,"failed"),Tt(null)):"running"===(null==e?void 0:e.executionStatus)?t.updateTabExecutionStatus(e.id,"failed"):t.tabs.forEach(e=>{"running"===e.executionStatus&&t.updateTabExecutionStatus(e.id,"failed")}),on.current&&(clearTimeout(on.current),on.current=null),an(null)};return window.addEventListener("jobCompleted",e),window.addEventListener("jobFailed",t),()=>{window.removeEventListener("jobCompleted",e),window.removeEventListener("jobFailed",t),rn.current&&(clearInterval(rn.current),rn.current=null)}},[It,K,cn]),(0,s.useEffect)(()=>{if(nn&&Y.length>0){const e=Y.find(e=>e.job_id===nn);if(e&&("completed"===e.status.toLowerCase()||"failed"===e.status.toLowerCase())){It&&(G(It,e.status.toLowerCase()),Tt(null));const t=k.getState();t.tabs.forEach(n=>{"running"===n.executionStatus&&t.updateTabExecutionStatus(n.id,e.status.toLowerCase())}),an(null)}}},[nn,Y,It,G]),(0,s.useEffect)(()=>{const e=()=>{const e=k.getState();e.tabs.forEach(t=>{"running"===t.executionStatus&&e.updateTabExecutionStatus(t.id,"completed")}),It&&Tt(null),an(null),on.current&&(clearTimeout(on.current),on.current=null)};return window.addEventListener("forceClearExecution",e),()=>{window.removeEventListener("forceClearExecution",e)}},[It]);const{paneContextMenu:dn,handlePaneContextMenu:un,handlePaneContextMenuClose:hn}=(()=>{const[e,t]=(0,s.useState)(null);return{paneContextMenu:e,handlePaneContextMenu:(0,s.useCallback)(e=>{e.preventDefault(),t({mouseX:e.clientX,mouseY:e.clientY})},[]),handlePaneContextMenuClose:(0,s.useCallback)(()=>{t(null)},[])}})(),{crewFlowInstanceRef:mn,flowFlowInstanceRef:gn,handleCrewFlowInit:pn,handleFlowFlowInit:xn}=(()=>{const e=(0,s.useRef)(null),t=(0,s.useRef)(null),n=(0,s.useCallback)(t=>{e.current=t,setTimeout(()=>{window.dispatchEvent(new CustomEvent("crewFlowInitialized",{detail:{instance:t}}))},100)},[]),a=(0,s.useCallback)(e=>{t.current=e},[]);return{crewFlowInstanceRef:e,flowFlowInstanceRef:t,handleCrewFlowInit:n,handleFlowFlowInit:a}})(),fn=(0,s.useRef)(null),yn=(0,s.useRef)(!1);(0,s.useEffect)(()=>(yn.current=!1,()=>{yn.current=!0,Q()}),[Q]),(0,s.useEffect)(()=>{const e=setTimeout(async()=>{const{tabs:e}=k.getState(),{fetchRunHistory:t}=_.a.getState(),{loadTaskStates:n,clearTaskStates:a}=zt.useTaskExecutionStore.getState(),s=e.find(e=>"running"===e.executionStatus);s&&Tt(s.id),await t();const{runHistory:i}=_.a.getState();if(i.length>0){const e=i.filter(e=>"running"===e.status.toLowerCase()||"queued"===e.status.toLowerCase());if(e.length>0){const t=e[0];an(t.job_id),a(),rn.current&&clearInterval(rn.current),rn.current=setInterval(()=>{n(t.job_id)},2e3),n(t.job_id)}}},100);return()=>{clearTimeout(e),rn.current&&clearInterval(rn.current)}},[]),((e,t,n,a,i,o,r,l,c,d)=>{(0,s.useEffect)(()=>{if(!e.length)return;if(n)return;const s=new Set(o),u=Date.now(),h=new Set(e.filter(e=>{var t;return(null==(t=e.data)?void 0:t.addedTimestamp)&&u-e.data.addedTimestamp<1e3}).map(e=>e.id)),m=()=>a&&i!==Gr&&l.current?l.current:r.current?r.current:null;return m()?(c.current&&clearTimeout(c.current),c.current=setTimeout(()=>{if(d.current)return;let n=!1;const a=e.map(e=>s.has(e.id)||h.has(e.id)||e.position&&isFinite(e.position.x)&&isFinite(e.position.y)&&Math.abs(e.position.x)<1e4&&Math.abs(e.position.y)<1e4?e:(n=!0,Object.assign({},e,{position:{x:300*Math.random(),y:300*Math.random()}})));n&&(t(a),setTimeout(()=>{if(d.current)return;const e=m();e&&e.fitView({padding:.2,includeHiddenNodes:!1})},300))},200),()=>{c.current&&clearTimeout(c.current)}):void 0},[e,t,i,a,n,o,r,l,c,d])})(Z,ee,Xe,Ye,Ze,le,mn,gn,fn,yn);const bn=(e=>(0,s.useCallback)(t=>{e(t.edges||[])},[e]))(re),vn=((e,t)=>(0,s.useCallback)((n,a,s)=>{setTimeout(()=>{(()=>{const i=new Map,o=n.map(e=>{const t=e.id,n=(0,w.A)();return i.set(t,n),Object.assign({},e,{id:n,position:{x:e.position.x,y:e.position.y},data:Object.assign({},e.data)})}),r=a.map(e=>{const t={source:i.get(e.source)||e.source,target:i.get(e.target)||e.target,sourceHandle:null,targetHandle:null};return(0,Ur.Qd)(t,"animated",!0,{stroke:"#9c27b0"})});o.length>0&&e(e=>{const t=new Set(e.map(e=>{var t;return null==(t=e.data)?void 0:t.label})),n=o.filter(e=>{var n,a,s,i;return!(null!=(n=e.type)&&n.includes("crewNode")||null!=(a=e.type)&&a.includes("agentNode")||null!=(s=e.type)&&s.includes("taskNode"))||!t.has(null==(i=e.data)?void 0:i.label)});return[...e,...n]}),s&&s.listeners&&s.listeners.length>0&&o.forEach(e=>{var t;e.data&&e.data.listener&&(null==(t=s.listeners)||t.find(t=>t.crewId===String(e.data.crewRef)&&t.tasks&&Array.isArray(t.tasks)&&t.tasks.some(t=>e.data.listener.tasks.some(e=>e.id===t.id))))}),r.length>0&&t(e=>Hr(r,e)),setTimeout(()=>{window.dispatchEvent(new CustomEvent("fitViewToNodes"));const e=(null==s?void 0:s.name)||"Flow";window.dispatchEvent(new CustomEvent("showNotification",{detail:{message:e+" loaded successfully"}}))},300)})()},100)},[e,t]))(ee,te),{isCrewFlowDialogOpen:jn,setIsCrewFlowDialogOpen:wn,openCrewOrFlowDialog:kn}=(()=>{const[e,t]=(0,s.useState)(!1),n=(0,s.useCallback)(()=>{t(!0)},[]);return(0,s.useEffect)(()=>{const e=()=>{n()};return window.addEventListener("openCrewFlowDialog",e),()=>{window.removeEventListener("openCrewFlowDialog",e)}},[n]),{isCrewFlowDialogOpen:e,setIsCrewFlowDialogOpen:t,openCrewOrFlowDialog:n}})(),[Cn,Sn]=(0,s.useState)(0),[_n,En]=(0,s.useState)(void 0),{isFlowDialogOpen:In,setIsFlowDialogOpen:Tn,openFlowDialog:Dn}=(()=>{const[e,t]=(0,s.useState)(!1),n=(0,s.useCallback)(()=>{t(!0)},[]);return(0,s.useEffect)(()=>{const e=()=>{n()};return window.addEventListener("openFlowDialog",e),()=>{window.removeEventListener("openFlowDialog",e)}},[n]),{isFlowDialogOpen:e,setIsFlowDialogOpen:t,openFlowDialog:n}})(),On=((e,t,n)=>(0,s.useCallback)(function(a,s,i,o){void 0===o&&(o=!1);const r=a.map(e=>{const t=s[e.id.toString()];return{id:"crew-"+Date.now()+"-"+e.id,type:"crewNode",position:t,data:{id:e.id.toString(),label:e.name,crewName:e.name,crewId:e.id,flowConfig:i}}}),l=Qn(r);e(e=>[...e,...l]);const c=[];if(i&&i.listeners){const e=l.reduce((e,t)=>(e[t.data.crewId.toString()]=t.id,e),{});i.listeners.forEach(t=>{const n=e[t.crewId.toString()];n&&t.tasks&&t.tasks.forEach(t=>{const a=t,s=a.agent_id?Number(a.agent_id):null;if(s&&e[s.toString()]){const t=e[s.toString()],a={source:n,target:t,sourceHandle:null,targetHandle:null};c.push((0,Ur.Qd)(a,"animated",!0,{stroke:"#9c27b0"}))}})}),c.length>0&&t(e=>Hr(c,e))}if(o&&i){const e=a[0];if(!e||!e.id)return void n("No valid crew found to associate with the flow");const t=e.id,s={name:i.name,crew_id:String(t),nodes:l,edges:c,flowConfig:i};Ft.saveFlow(s).then(e=>{n("Flow saved successfully")}).catch(e=>{n("Failed to save flow: "+(e instanceof Error?e.message:"Unknown error"))})}},[e,t,n]))(ee,te,P),{handleRunClickWrapper:Nn,handleCrewSelectWrapper:Mn}=((e,t,n)=>{const a=(0,s.useCallback)(async t=>{t&&await e(t)},[e]),i=(0,s.useCallback)((e,a,s,i)=>{var o;window.dispatchEvent(new CustomEvent("crewLoadStarted"));const r=new An({margin:20,minNodeSpacing:50}),l=E.z.getState().getUILayoutState();l.screenWidth=window.innerWidth,l.screenHeight=window.innerHeight,r.updateUIState(l);const c=r.reorganizeNodes(e,"crew",a),{createTab:d,updateTabNodes:u,updateTabEdges:h,setActiveTab:m,getActiveTab:g,updateTabCrewInfo:p}=k.getState(),x=(null==(o=g())||o.id,d(s||"Loaded Crew")),f=l.layoutOrientation||"horizontal",y=a.map(e=>{const t=c.find(t=>t.id===e.source),n=c.find(t=>t.id===e.target);if("agentNode"===(null==t?void 0:t.type)&&"taskNode"===(null==n?void 0:n.type)){const t="vertical"===f?"bottom":"right",n="vertical"===f?"top":"left";return Object.assign({},e,{sourceHandle:t,targetHandle:n,style:Object.assign({},e.style,{stroke:"#2196f3",strokeWidth:2}),animated:!1})}return"taskNode"===(null==t?void 0:t.type)&&"taskNode"===(null==n?void 0:n.type)?Object.assign({},e,{sourceHandle:"right",targetHandle:"left",style:Object.assign({},e.style,{stroke:"#2196f3",strokeWidth:2,strokeDasharray:"12"}),animated:!0}):e});u(x,c),h(x,y),k.getState().getTab(x),s&&i&&p(x,i,s),setTimeout(()=>{m(x),setTimeout(()=>{t(c),n(y),setTimeout(()=>{window.dispatchEvent(new CustomEvent("fitViewToNodes"))},200),setTimeout(()=>{window.dispatchEvent(new CustomEvent("crewLoadCompleted"))},300)},50)},10)},[t,n]);return(0,s.useEffect)(()=>{const e=()=>{a("crew")},t=()=>{a("flow")};return window.addEventListener("executeCrewEvent",e),window.addEventListener("executeFlowEvent",t),()=>{window.removeEventListener("executeCrewEvent",e),window.removeEventListener("executeFlowEvent",t)}},[a]),(0,s.useEffect)(()=>{const e=()=>{window.dispatchEvent(new CustomEvent("fitViewToNodesInternal"))};return window.addEventListener("fitViewToNodes",e),()=>{window.removeEventListener("fitViewToNodes",e)}},[]),(0,s.useEffect)(()=>{const e=()=>{window.dispatchEvent(new CustomEvent("openConfigAPIKeysInternal"))};return window.addEventListener("openConfigAPIKeys",e),()=>{window.removeEventListener("openConfigAPIKeys",e)}},[]),{handleRunClickWrapper:a,handleCrewSelectWrapper:i}})(e=>e?qt(e):Promise.resolve(),ee,te),zn=(0,s.useRef)(null),Ln=(0,s.useCallback)(async e=>{const t=H.find(t=>t.id===e);if(t){Tt(e),G(e,"running");try{await Yt(e,t.nodes,t.edges,t.name)}catch(n){Tt(null),G(e,"failed")}}},[H,Yt,G]),Wn=(0,s.useCallback)(async e=>{try{const t=e||_t;if(!t){const e=new CustomEvent("executionError",{detail:{message:"No execution found. Please run a crew first or select an execution from the history.",type:"logs"}});return void window.dispatchEvent(e)}kt(!0),St(null),jt(t),yt(!0),Et(t);const n=await Xi.m.getHistoricalLogs(t);vt(n.map(e=>{let t=(0,a.A)(e,Jr);return Object.assign({},t,{output:t.output||t.content,id:t.id||Date.now()})})),Xi.m.connectToJobLogs(t);const s=Xi.m.onConnected(t,()=>{kt(!1)}),i=Xi.m.onJobLogs(t,e=>{vt(t=>[...t,{id:e.id||Date.now(),output:e.output||e.content,timestamp:e.timestamp}])}),o=Xi.m.onError(t,()=>{St("Failed to connect to log stream"),kt(!1)}),r=Xi.m.onClose(t,()=>{kt(!1)});return()=>{s(),i(),o(),r(),Xi.m.disconnectFromJobLogs(t)}}catch(t){St("Failed to load execution logs"),kt(!1)}},[_t]),{handleUIAwareFitView:Rn,handleFitViewToNodesInternal:Fn}=xi({nodes:Z,crewFlowInstanceRef:mn,flowFlowInstanceRef:gn});return fi({nodes:Z,edges:$,setNodes:ee,setEdges:te,crewFlowInstanceRef:mn,flowFlowInstanceRef:gn,handleUIAwareFitView:Rn,handleFitViewToNodesInternal:Fn}),(0,W.jsx)("div",{className:"workflow-designer",children:(0,W.jsxs)(i.A,{sx:{width:"100%",height:"100vh",position:"relative",display:"flex",flexDirection:"column",overflow:"hidden"},"data-tour":"workflow-designer",children:[(0,W.jsx)(Ni,{isOpen:lt.isTutorialOpen,onClose:lt.handleCloseTutorial}),(0,W.jsx)(ns,{onRunTab:Ln,isRunning:!!It,runningTabId:It,onLoadCrew:()=>{Sn(0),En(0),wn(!0)},onLoadAgents:()=>{Sn(1),En(1),wn(!0)},onLoadTasks:()=>{Sn(2),En(2),wn(!0)},disabled:ut||ct||!!It}),(0,W.jsxs)(i.A,{sx:{flex:1,display:"flex",flexDirection:"row",overflow:"hidden",position:"relative",marginLeft:Ue+"px"},children:[Ge&&"left"===Be&&(0,W.jsxs)(i.A,{onMouseEnter:()=>{window.postMessage({type:"chat-hover-state",isHovering:!0},"*")},onMouseLeave:()=>{window.postMessage({type:"chat-hover-state",isHovering:!1},"*")},sx:{width:Re?We+"px":Le+"px",height:qe?"calc(100% - "+Ke+"px)":"100%",display:"flex",flexDirection:"row",overflow:"hidden",backgroundColor:"background.paper",borderRight:1,borderColor:"divider",zIndex:15,transition:Re?"width 0.3s ease-in-out":"none"},children:[(0,W.jsx)(i.A,{sx:{flex:1,overflow:"hidden"},children:(0,W.jsx)(ei,{chatSide:Be,onNodesGenerated:(e,t)=>{O(e,t,ee,te)},onLoadingStateChange:ht,isVisible:Ge,nodes:Z,edges:$,onExecuteCrew:()=>{const e=K();if(e){Tt(e.id),G(e.id,"running"),on.current&&clearTimeout(on.current);const t=e.id;on.current=setTimeout(()=>{Tt(e=>e===t?null:e),G(t,"completed")},3e5)}Qt(Z),Zt($),setTimeout(()=>{qt("crew")},100)},isCollapsed:Re,onToggleCollapse:()=>{De(!Re),setTimeout(()=>{const e=new CustomEvent("recalculateNodePositions",{detail:{reason:"chat-panel-toggle"}});window.dispatchEvent(e)},350)},chatSessionId:null==(e=K())?void 0:e.chatSessionId,onOpenLogs:Wn})}),!Re&&(0,W.jsx)(i.A,{onMouseDown:Dt,sx:{width:4,height:"100%",backgroundColor:"divider",cursor:"ew-resize","&:hover":{backgroundColor:"primary.main"},transition:"background-color 0.2s ease",zIndex:7}})]}),(0,W.jsxs)(i.A,{sx:{flex:1,display:"flex",flexDirection:"column",overflow:"hidden",position:"relative"},children:[(0,W.jsx)(La,{areFlowsVisible:Ye,showRunHistory:!1,panelPosition:Je,isDraggingPanel:Xe,isDarkMode:x,nodes:Z,edges:$,setNodes:ee,setEdges:te,onNodesChange:ne,onEdgesChange:ae,onConnect:se,onSelectionChange:bn,onPaneContextMenu:un,onCrewFlowInit:pn,onFlowFlowInit:xn,handleUIAwareFitView:Rn,planningEnabled:Mt,setPlanningEnabled:Ut,reasoningEnabled:Lt,setReasoningEnabled:Ht,schemaDetectionEnabled:Wt,setSchemaDetectionEnabled:Kt,selectedModel:Pt,setSelectedModel:Vt,onOpenLogsDialog:()=>lt.setIsLogsDialogOpen(!0),onToggleChat:it,isChatOpen:Ge,setIsAgentDialogOpen:()=>be(!0),setIsTaskDialogOpen:()=>Ee(!0),setIsFlowDialogOpen:lt.setIsFlowDialogOpen,onOpenTutorial:()=>{lt.setIsTutorialOpen(!0)},onOpenConfiguration:()=>lt.setIsConfigurationDialogOpen(!0),onPanelDragStart:e=>{e.preventDefault();const t=e.currentTarget.parentElement;if(!t)return;const n=t.getBoundingClientRect(),a=e.currentTarget;let s=Je;const i=e=>{const i=(e.clientX-n.left)/n.width*100,o=Math.max(20,Math.min(80,i));Math.abs(o-s)<.1||(a.style.left=o+"%",t.style.gridTemplateColumns=o+"% "+(100-o)+"%",s=o)},o=()=>{Qe(!1),ot(s),document.removeEventListener("mousemove",i),document.removeEventListener("mouseup",o)};Qe(!0),document.addEventListener("mousemove",i),document.addEventListener("mouseup",o)}}),Ge&&"right"===Be&&(0,W.jsxs)(i.A,{onMouseEnter:()=>{window.postMessage({type:"chat-hover-state",isHovering:!0},"*")},onMouseLeave:()=>{window.postMessage({type:"chat-hover-state",isHovering:!1},"*")},sx:{position:"absolute",top:0,right:He,bottom:qe?Ke+"px":0,width:Re?We+"px":Le+"px",display:"flex",flexDirection:"row",overflow:"hidden",backgroundColor:"background.paper",zIndex:10,transition:Re?"width 0.3s ease-in-out":"none"},children:[!Re&&(0,W.jsx)(i.A,{onMouseDown:Dt,sx:{width:4,height:"100%",backgroundColor:"divider",cursor:"ew-resize","&:hover":{backgroundColor:"primary.main"},transition:"background-color 0.2s ease",zIndex:7}}),(0,W.jsx)(i.A,{sx:{flex:1,display:"flex",flexDirection:"column"},children:(0,W.jsx)(ei,{onNodesGenerated:(e,t)=>{O(e,t,ee,te)},onLoadingStateChange:ht,isVisible:Ge,nodes:Z,edges:$,onExecuteCrew:()=>{const e=K();if(e){Tt(e.id),G(e.id,"running"),on.current&&clearTimeout(on.current);const t=e.id;on.current=setTimeout(()=>{Tt(e=>e===t?null:e),G(t,"completed")},3e5)}Qt(Z),Zt($),setTimeout(()=>{qt("crew")},100)},isCollapsed:Re,onToggleCollapse:()=>{De(!Re),setTimeout(()=>{const e=new CustomEvent("recalculateNodePositions",{detail:{reason:"chat-panel-toggle"}});window.dispatchEvent(e)},350)},chatSessionId:null==(t=K())?void 0:t.chatSessionId,onOpenLogs:Wn,chatSide:Be})})]})]})]}),J&&(0,W.jsx)(B,{isVisible:Ye,togglePanel:st,position:"right",tooltip:Ye?"Hide Flows Panel":"Show Flows Panel"}),qe&&(0,W.jsxs)(i.A,{sx:{position:"absolute",bottom:0,left:0,right:0,height:Ke+"px",backgroundColor:x?"rgba(26, 26, 26, 0.95)":"rgba(255, 255, 255, 0.95)",backdropFilter:"blur(8px)",display:"flex",flexDirection:"column",borderTop:1,borderColor:"divider",zIndex:8},children:[(0,W.jsx)(i.A,{onMouseDown:Ot,sx:{position:"absolute",top:0,left:0,right:0,height:4,backgroundColor:"divider",cursor:"ns-resize","&:hover":{backgroundColor:"primary.main"},transition:"background-color 0.2s ease",zIndex:7}}),(0,W.jsx)(i.A,{sx:{flex:1,paddingTop:"4px",overflow:"hidden",display:"flex",flexDirection:"column"},children:(0,W.jsx)(_i,{executionHistoryHeight:Ke,onExecutionCountChange:xt})})]}),(0,W.jsx)(yi,{open:he,onClose:()=>me(!1),onAgentSelect:ge,agents:de,onShowAgentForm:pe,fetchAgents:xe,showErrorMessage:P,openInCreateMode:ye}),(0,W.jsx)(bi,{open:je,onClose:()=>we(!1),onTaskSelect:ke,tasks:ve,onShowTaskForm:Ce,fetchTasks:Se,openInCreateMode:_e}),(0,W.jsx)(Un,{open:lt.isCrewPlanningOpen,onClose:()=>lt.setCrewPlanningOpen(!1),onGenerateCrew:Jt,selectedModel:Pt,tools:Rt,selectedTools:Bt.map(e=>e.id||""),onToolsChange:e=>{const t=Rt.filter(t=>t.id&&e.includes(t.id));Gt(t)}}),(0,W.jsx)(oa,{open:jn,onClose:()=>{wn(!1),Sn(0),En(void 0)},onCrewSelect:Mn,onFlowSelect:vn,onAgentSelect:ge,onTaskSelect:ke,initialTab:Cn,showOnlyTab:_n}),(0,W.jsx)(oa,{open:In,onClose:()=>Tn(!1),onCrewSelect:Mn,onFlowSelect:vn,onAgentSelect:ge,onTaskSelect:ke,initialTab:1}),(0,W.jsx)(Ci,{open:lt.isScheduleDialogOpen,onClose:()=>lt.setScheduleDialogOpen(!1),nodes:Z,edges:$,planningEnabled:Mt,selectedModel:Pt}),(0,W.jsx)(o.A,{open:lt.isAPIKeysDialogOpen,onClose:()=>lt.setIsAPIKeysDialogOpen(!1),maxWidth:"lg",fullWidth:!0,children:(0,W.jsx)(r.A,{children:(0,W.jsx)(Vi,{})})}),(0,W.jsx)(o.A,{open:lt.isToolsDialogOpen,onClose:()=>lt.setIsToolsDialogOpen(!1),maxWidth:"lg",fullWidth:!0,children:(0,W.jsx)(r.A,{children:(0,W.jsx)(Br.default,{})})}),(0,W.jsxs)(o.A,{open:lt.isLogsDialogOpen,onClose:()=>lt.setIsLogsDialogOpen(!1),maxWidth:"lg",fullWidth:!0,children:[(0,W.jsxs)(l.A,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",pb:1.5,borderBottom:"1px solid",borderColor:"divider"},children:[(0,W.jsx)(c.A,{variant:"h6",children:"LLM Logs"}),(0,W.jsx)(d.A,{onClick:()=>lt.setIsLogsDialogOpen(!1),size:"small",sx:{color:"text.secondary","&:hover":{color:"text.primary"}},children:(0,W.jsx)(N.A,{})})]}),(0,W.jsx)(r.A,{children:(0,W.jsx)(Ji,{})})]}),(0,W.jsx)(o.A,{open:lt.isConfigurationDialogOpen,onClose:()=>lt.setIsConfigurationDialogOpen(!1),fullWidth:!0,maxWidth:"xl",PaperProps:{sx:{width:"80vw",maxWidth:"none",height:"80vh"}},children:(0,W.jsx)(r.A,{sx:{p:0},children:(0,W.jsx)(Fr,{onClose:()=>lt.setIsConfigurationDialogOpen(!1)})})}),(0,W.jsx)(sn,{open:lt.isFlowDialogOpen,onClose:()=>lt.setIsFlowDialogOpen(!1),onAddCrews:On}),(0,W.jsx)(q,{open:$t,onClose:()=>en(!1),onConfirm:tn,nodes:Z}),(0,W.jsx)(u.A,{open:A,autoHideDuration:6e3,onClose:D,anchorOrigin:{vertical:"top",horizontal:"center"},children:(0,W.jsx)(h.A,{onClose:D,severity:"error",variant:"filled",sx:{whiteSpace:"pre-line"},children:j})}),(0,W.jsx)(m.A,{open:null!==dn,onClose:hn,anchorReference:"anchorPosition",anchorPosition:null!==dn?{top:dn.mouseY,left:dn.mouseX}:void 0}),Z.length>0&&(0,W.jsx)(Vr,{nodes:Z,edges:$,trigger:(0,W.jsx)(g.A,{style:{display:"none"},ref:zn,children:"Save"})}),(0,W.jsx)(Yi.A,{open:ft,onClose:()=>{yt(!1),At&&Xi.m.disconnectFromJobLogs(At)},logs:bt,jobId:At||"",isConnecting:wt,connectionError:Ct}),(0,W.jsx)(Pn,{onOpenLogsDialog:()=>lt.setIsLogsDialogOpen(!0),onToggleChat:()=>Oe(!Ge),isChatOpen:Ge,setIsAgentDialogOpen:()=>be(!0),setIsTaskDialogOpen:()=>Ee(!0),setIsFlowDialogOpen:lt.setIsFlowDialogOpen,setIsCrewDialogOpen:()=>{Sn(0),En(void 0),wn(!0)},onSaveCrewClick:()=>{const e=new CustomEvent("openSaveCrewDialog");window.dispatchEvent(e)},showRunHistory:qe,executionHistoryHeight:Ke,onOpenSchedulesDialog:()=>{lt.setScheduleDialogOpen(!0)},onToggleExecutionHistory:rt}),(0,W.jsx)(pi,{onClearCanvas:()=>{ee([]),te([])},isGeneratingConnections:ct,onGenerateConnections:async()=>{dt(!0);try{var e;const{ConnectionService:t}=await n.e(531).then(n.bind(n,62531)),a=Z.filter(e=>"agentNode"===e.type),s=Z.filter(e=>"taskNode"===e.type);if(0===a.length)return void P("No agents found. Please add at least one agent to generate connections.");if(0===s.length)return void P("No tasks found. Please add at least one task to generate connections.");const i=a.map(e=>({name:e.data.label||e.data.name||"Agent "+e.id,role:e.data.role||"Assistant",goal:e.data.goal||"Complete assigned tasks effectively",backstory:e.data.backstory||"A dedicated AI agent designed to help with various tasks",tools:e.data.tools||[]})),o=s.map(e=>{var t,n,a,s;return{name:e.data.label||e.data.name||"Task "+e.id,description:e.data.description||e.data.label||"Task "+e.id,expected_output:e.data.expected_output||"Complete the task successfully",agent_id:e.data.agent_id||"",tools:e.data.tools||[],async_execution:e.data.async_execution||!1,human_input:(null==(t=e.data.config)?void 0:t.human_input)||!1,markdown:(null==(n=e.data.config)?void 0:n.markdown)||!1,context:{type:"general",priority:1===(null==(a=e.data.config)?void 0:a.priority)?"high":2===(null==(s=e.data.config)?void 0:s.priority)?"medium":"low",complexity:"medium",required_skills:[],metadata:{}}}}),r="llama-3.1-70b-instruct",l=await t.generateConnections(i,o,r),c=[];l.assignments.forEach(e=>{const t=a.find(t=>(t.data.label||t.data.name)===e.agent_name);t&&e.tasks.forEach(e=>{const n=s.find(t=>(t.data.label||t.data.name)===e.task_name);if(n){const a=t.id+"-"+n.id;c.push({id:a,source:t.id,target:n.id,type:"default",data:{reasoning:e.reasoning}})}})}),null==(e=l.dependencies)||e.forEach(e=>{const t=s.find(t=>(t.data.label||t.data.name)===e.task_name);t&&e.depends_on&&e.depends_on.forEach(n=>{const a=s.find(e=>(e.data.label||e.data.name)===n);if(a){const n="dep-"+a.id+"-"+t.id;c.push({id:n,source:a.id,target:t.id,type:"default",style:{stroke:"#ff6b6b",strokeDasharray:"5,5"},data:{reasoning:e.reasoning,isDependency:!0}})}})}),c.length>0?te(c):P("No connections could be generated. Please check that agent and task names are properly set.")}catch(t){P("Failed to generate connections: "+(t instanceof Error?t.message:"Unknown error"))}finally{dt(!1)}},onZoomIn:()=>{const e=mn.current||gn.current;e&&e.zoomIn({duration:200})},onZoomOut:()=>{const e=mn.current||gn.current;e&&e.zoomOut({duration:200})},onFitView:()=>{Rn()},onToggleInteractivity:()=>{},planningEnabled:Mt,setPlanningEnabled:Ut,reasoningEnabled:Lt,setReasoningEnabled:Ht,schemaDetectionEnabled:Wt,setSchemaDetectionEnabled:Kt,setIsConfigurationDialogOpen:lt.setIsConfigurationDialogOpen,onOpenLogsDialog:()=>lt.setIsLogsDialogOpen(!0),showRunHistory:qe,executionHistoryHeight:Ke,onOpenTutorial:()=>{lt.setIsTutorialOpen(!0)}})]})})},Xr=Yr},29722:(e,t,n)=>{n.r(t),n.d(t,{customTools:()=>G,default:()=>J});var a=n(98587),s=n(9950),i=n(16491),o=n(29044),r=n(82053),l=n(18216),c=n(8145),d=n(48089),u=n(50704),h=n(25333),m=n(11966),g=n(84142),p=n(1320),x=n(2235),f=n(15769),y=n(69780),b=n(9213),v=n(21671),A=n(34075),j=n(25277),w=n(37324),k=n(83274),C=n(63464),S=n(40033),_=n(28170),E=n(25979),I=n(19647),T=n(70006),D=n(23266),O=n(79739),N=n(4862),P=n(65429),M=n(57988),z=n(7999),L=n(99532),W=n(73929),R=n(95849),F=n(67818),B=n(11625),V=n(79741),U=n(44414);const H=["id","category"],K=[{value:"screwdriver-wrench",label:"Screwdriver Wrench"},{value:"search",label:"Search"},{value:"code",label:"Code"},{value:"database",label:"Database"},{value:"file",label:"File"},{value:"globe",label:"Web"},{value:"robot",label:"Robot"},{value:"cogs",label:"Settings"},{value:"development",label:"Development"}],G=["GenieTool","PerplexityTool","DatabricksJobsTool"],q=e=>{let t="PreBuilt";return G.includes(e.title)&&(t="Custom"),{id:String(e.id),title:e.title,description:e.description,icon:e.icon,config:e.config,category:t,enabled:void 0===e.enabled||e.enabled,group_id:e.group_id}},J=()=>{const{t:e}=(0,F.Bd)(),[t,n]=(0,s.useState)({id:"",title:"",description:"",icon:"",config:{},category:"PreBuilt"}),[G,J]=(0,s.useState)([]),[Y,X]=(0,s.useState)([]),[Q,Z]=(0,s.useState)(""),[$,ee]=(0,s.useState)(!1),[te,ne]=(0,s.useState)(!1),[ae,se]=(0,s.useState)(0),[ie,oe]=(0,s.useState)(!1),[re,le]=(0,s.useState)(null),[ce,de]=(0,s.useState)({open:!1,message:"",severity:"success"}),ue=(0,V.o)(e=>e.userRole);(0,s.useEffect)(()=>{he()},[]),(0,s.useEffect)(()=>{const e=G.filter(e=>e.title.toLowerCase().includes(Q.toLowerCase())||e.description.toLowerCase().includes(Q.toLowerCase()));X(e)},[G,Q]);const he=async()=>{try{const e=await R.m.listTools();J(e.map(q))}catch(e){de({open:!0,message:"Error loading tools",severity:"error"})}},me=e=>{const{name:t,value:a}=e.target;n(e=>Object.assign({},e,{[t]:a}))},ge=()=>{ee(!1),ne(!1),n({id:"",title:"",description:"",icon:"",config:{},category:"PreBuilt"})},pe=async e=>{n(e),ne(!0),ee(!0);try{const t=await R.m.getTool(Number(e.id));t?n(q(t)):de({open:!0,message:"Could not fetch latest tool data",severity:"error"})}catch(t){de({open:!0,message:t instanceof Error?t.message:"Error fetching tool data",severity:"error"})}},xe=async t=>{if(window.confirm(e("tools.regular.confirmations.delete")))try{await R.m.deleteTool(Number(t)),J(e=>e.filter(e=>e.id!==t)),de({open:!0,message:e("tools.regular.messages.deleteSuccess"),severity:"success"})}catch(n){de({open:!0,message:n instanceof Error?n.message:e("tools.regular.messages.errorDeleting"),severity:"error"})}},fe=async e=>{const t=G.find(t=>t.id===e);if(t)return t.enabled?void await ye(e):(le(t),void oe(!0))},ye=async e=>{try{const{enabled:t}=await R.m.toggleToolEnabled(Number(e));J(n=>n.map(n=>n.id===e?Object.assign({},n,{enabled:t}):n));de({open:!0,message:"Tool "+(t?"enabled":"disabled")+" successfully",severity:"success"});const n=(await R.m.listTools()).map(e=>q(e)),a=new CustomEvent("toolStateChanged",{detail:{toolId:e,enabled:t,tools:n}});window.dispatchEvent(a)}catch(t){de({open:!0,message:t instanceof Error?t.message:"Error toggling tool state",severity:"error"})}},be=async e=>{try{await R.m.updateToolConfigurationForGroup(e.title,e.config||{});const t=(await R.m.listTools()).map(q);J(t);const n=t.find(t=>t.title===e.title&&!!t.group_id);null!=n&&n.id&&!1===n.enabled&&(await R.m.toggleToolEnabled(Number(n.id)),J(e=>e.map(e=>e.id===n.id?Object.assign({},e,{enabled:!0}):e))),de({open:!0,message:"Workspace override created",severity:"success"})}catch(t){de({open:!0,message:t instanceof Error?t.message:"Error enabling tool for workspace",severity:"error"})}},ve=()=>{de(e=>Object.assign({},e,{open:!1}))},Ae=Y.filter(e=>"PreBuilt"===e.category||!e.category),je=Y.filter(e=>"Custom"===e.category);return(0,U.jsx)(i.A,{sx:{p:3},children:(0,U.jsxs)(o.A,{spacing:3,children:[(0,U.jsxs)(i.A,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,U.jsx)(r.A,{variant:"h4",children:e("tools.regular.title")}),(0,U.jsx)(l.A,{variant:"contained",startIcon:(0,U.jsx)(L.A,{}),onClick:()=>ee(!0),children:e("tools.regular.addTool")})]}),(0,U.jsx)(c.A,{fullWidth:!0,variant:"outlined",placeholder:e("tools.regular.searchPlaceholder"),value:Q,onChange:e=>{Z(e.target.value)},sx:{mb:2}}),(0,U.jsx)(d.A,{children:(0,U.jsxs)(u.A,{children:[(0,U.jsxs)(i.A,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2},children:[(0,U.jsx)(r.A,{variant:"h6",children:e("tools.regular.existingTools")}),(0,U.jsx)(i.A,{children:(0,U.jsx)(h.A,{color:"primary",onClick:()=>{ne(!1),n(e=>Object.assign({},e,{category:0===ae?"PreBuilt":"Custom"})),ee(!0)},size:"small",children:(0,U.jsx)(L.A,{})})})]}),(0,U.jsxs)(m.A,{value:ae,onChange:(e,t)=>{se(t)},sx:{mb:2},children:[(0,U.jsx)(g.A,{label:e("tools.regular.tabs.prebuilt")}),(0,U.jsx)(g.A,{label:e("tools.regular.tabs.custom")})]}),0===ae&&(0,U.jsx)(p.A,{component:x.A,sx:{mt:0},children:(0,U.jsxs)(f.A,{children:[(0,U.jsx)(y.A,{children:(0,U.jsxs)(b.A,{children:[(0,U.jsx)(v.A,{children:e("tools.regular.fields.name")}),(0,U.jsx)(v.A,{children:e("tools.regular.fields.description")}),(0,U.jsx)(v.A,{align:"center",children:e("common.status")}),(0,U.jsx)(v.A,{align:"center",children:e("common.actions")})]})}),(0,U.jsx)(A.A,{children:0===Ae.length?(0,U.jsx)(b.A,{children:(0,U.jsx)(v.A,{colSpan:4,align:"center",children:"No PreBuilt tools found"})}):Ae.map(t=>(0,U.jsxs)(b.A,{children:[(0,U.jsx)(v.A,{children:(0,U.jsxs)(o.A,{direction:"row",spacing:1,alignItems:"center",children:[(0,U.jsx)("span",{children:t.title}),t.group_id&&(0,U.jsx)(j.A,{size:"small",label:"Workspace",color:"primary",variant:"outlined"})]})}),(0,U.jsx)(v.A,{children:t.description.length>100?t.description.substring(0,100)+"...":t.description}),(0,U.jsx)(v.A,{align:"center",children:(0,U.jsx)(w.A,{checked:!1!==t.enabled,onChange:()=>t.id&&fe(t.id),color:"primary",inputProps:{"aria-label":"toggle tool enabled state"}})}),(0,U.jsxs)(v.A,{align:"center",children:[!t.group_id&&"admin"===ue&&(0,U.jsx)(k.A,{title:"Enable for this workspace (create override)",children:(0,U.jsx)(h.A,{size:"small",color:"primary",onClick:()=>be(t),sx:{mr:1},"aria-label":"Enable for this workspace",children:(0,U.jsx)(W.A,{fontSize:"small"})})}),(0,U.jsx)(h.A,{size:"small",onClick:()=>pe(t),"aria-label":e("common.edit"),children:(0,U.jsx)(z.A,{fontSize:"small"})}),(0,U.jsx)(h.A,{size:"small",onClick:()=>t.id&&xe(t.id),"aria-label":e("common.delete"),children:(0,U.jsx)(M.A,{fontSize:"small"})})]})]},t.id))})]})}),1===ae&&(0,U.jsx)(p.A,{component:x.A,sx:{mt:0},children:(0,U.jsxs)(f.A,{children:[(0,U.jsx)(y.A,{children:(0,U.jsxs)(b.A,{children:[(0,U.jsx)(v.A,{children:e("tools.regular.fields.name")}),(0,U.jsx)(v.A,{children:e("tools.regular.fields.description")}),(0,U.jsx)(v.A,{align:"center",children:e("common.status")}),(0,U.jsx)(v.A,{align:"center",children:e("common.actions")})]})}),(0,U.jsx)(A.A,{children:0===je.length?(0,U.jsx)(b.A,{children:(0,U.jsx)(v.A,{colSpan:4,align:"center",children:"No Custom tools found"})}):je.map(t=>(0,U.jsxs)(b.A,{children:[(0,U.jsx)(v.A,{children:(0,U.jsxs)(o.A,{direction:"row",spacing:1,alignItems:"center",children:[(0,U.jsx)("span",{children:t.title}),t.group_id&&(0,U.jsx)(j.A,{size:"small",label:"Workspace",color:"primary",variant:"outlined"})]})}),(0,U.jsx)(v.A,{children:t.description.length>100?t.description.substring(0,100)+"...":t.description}),(0,U.jsx)(v.A,{align:"center",children:(0,U.jsx)(w.A,{checked:!1!==t.enabled,onChange:()=>t.id&&fe(t.id),color:"primary",inputProps:{"aria-label":"toggle tool enabled state"}})}),(0,U.jsxs)(v.A,{align:"center",children:[!t.group_id&&"admin"===ue&&(0,U.jsx)(k.A,{title:"Enable for this workspace (create override)",children:(0,U.jsx)(h.A,{size:"small",color:"primary",onClick:()=>be(t),sx:{mr:1},"aria-label":"Enable for this workspace",children:(0,U.jsx)(W.A,{fontSize:"small"})})}),(0,U.jsx)(h.A,{size:"small",onClick:()=>pe(t),"aria-label":e("common.edit"),children:(0,U.jsx)(z.A,{fontSize:"small"})}),(0,U.jsx)(h.A,{size:"small",onClick:()=>t.id&&xe(t.id),"aria-label":e("common.delete"),children:(0,U.jsx)(M.A,{fontSize:"small"})})]})]},t.id))})]})})]})}),(0,U.jsxs)(C.A,{open:$,onClose:ge,maxWidth:"sm",fullWidth:!0,children:[(0,U.jsx)(S.A,{children:e(te?"tools.regular.editTool":"tools.regular.addTool")}),(0,U.jsxs)("form",{onSubmit:async n=>{n.preventDefault();try{const n=(0,a.A)(t,H),s=Object.assign({},n,{config:t.config?JSON.parse(JSON.stringify(t.config)):{}});if(te&&t.id){const n=await R.m.updateTool(Number(t.id),s);J(e=>e.map(e=>e.id===t.id?q(n):e)),de({open:!0,message:e("tools.regular.messages.updateSuccess"),severity:"success"}),ge()}else{const t=await R.m.createTool(s);de({open:!0,message:e("tools.regular.messages.createSuccess"),severity:"success"}),J(e=>[...e,q(t)]),ge()}}catch(s){de({open:!0,message:s instanceof Error?s.message:e("tools.regular.messages.errorSaving"),severity:"error"})}},children:[(0,U.jsx)(_.A,{children:(0,U.jsxs)(o.A,{spacing:2,children:[(0,U.jsx)(c.A,{fullWidth:!0,label:e("tools.regular.form.title"),name:"title",value:t.title,onChange:me,required:!0}),(0,U.jsx)(c.A,{fullWidth:!0,label:e("tools.regular.form.description"),name:"description",value:t.description,onChange:me,multiline:!0,rows:4,required:!0}),(0,U.jsxs)(E.A,{fullWidth:!0,children:[(0,U.jsx)(I.A,{children:e("tools.regular.form.icon")}),(0,U.jsx)(T.A,{name:"icon",value:t.icon,onChange:me,required:!0,children:K.map(e=>(0,U.jsx)(D.A,{value:e.value,children:e.label},e.value))})]}),(0,U.jsxs)(E.A,{fullWidth:!0,children:[(0,U.jsx)(I.A,{children:e("tools.regular.form.category")}),(0,U.jsxs)(T.A,{name:"category",value:t.category||"PreBuilt",onChange:me,required:!0,children:[(0,U.jsx)(D.A,{value:"PreBuilt",children:e("tools.regular.categories.prebuilt")}),(0,U.jsx)(D.A,{value:"Custom",children:e("tools.regular.categories.custom")})]})]}),(0,U.jsxs)(i.A,{children:[(0,U.jsxs)(r.A,{variant:"subtitle1",gutterBottom:!0,sx:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e("tools.regular.form.configuration"),(0,U.jsx)(l.A,{size:"small",onClick:()=>{n(e=>Object.assign({},e,{config:Object.assign({},e.config,{"":""})}))},children:e("tools.regular.form.addParameter")})]}),(0,U.jsx)(o.A,{spacing:2,children:Object.entries(t.config||{}).map((t,a)=>{let[s,i]=t;return(0,U.jsxs)(o.A,{direction:"row",spacing:2,alignItems:"center",children:[(0,U.jsx)(c.A,{label:e("tools.regular.form.parameterName"),value:s,onChange:e=>{const t=e.target.value;n(e=>{const n=Object.assign({},e.config);return delete n[s],n[t]=i,Object.assign({},e,{config:n})})},fullWidth:!0}),(0,U.jsx)(c.A,{label:e("tools.regular.form.value"),value:i,onChange:e=>{const t=e.target.value;n(e=>Object.assign({},e,{config:Object.assign({},e.config,{[s]:t})}))},fullWidth:!0}),(0,U.jsx)(h.A,{onClick:()=>{n(e=>{const t=Object.assign({},e.config);return delete t[s],Object.assign({},e,{config:t})})},color:"error",size:"small",children:(0,U.jsx)(M.A,{})})]},a)})})]})]})}),(0,U.jsxs)(O.A,{children:[(0,U.jsx)(l.A,{onClick:ge,children:e("common.cancel")}),(0,U.jsx)(l.A,{type:"submit",variant:"contained",color:"primary",children:e("common.save")})]})]})]}),(0,U.jsx)(N.A,{open:ce.open,autoHideDuration:6e3,onClose:ve,anchorOrigin:{vertical:"bottom",horizontal:"right"},children:(0,U.jsx)(P.A,{onClose:ve,severity:ce.severity,sx:{width:"100%"},children:ce.message})}),(0,U.jsx)(B.A,{open:ie,onClose:()=>{oe(!1),le(null)},onConfirm:async()=>{null!=re&&re.id&&await ye(re.id),oe(!1),le(null)},tool:re})]})})}},31076:(e,t,n)=>{n.r(t),n.d(t,{TaskService:()=>s});var a=n(27887);class s{static async getTask(e){try{var t;const n=await a.uE.get("/tasks/"+e);return null!=(t=n.data)&&null!=(t=t.tool_configs)&&t.GenieTool,n.data}catch(n){return null}}static async findOrCreateTask(e){try{const t=Object.assign({},e);t.tools||(t.tools=[]),t.context||(t.context=[]),t.async_execution||(t.async_execution=!1);return(await a.uE.post("/tasks/find-or-create",t)).data}catch(t){throw t}}static async createTask(e){try{var t,n,s,i,o,r,l,c,d,u,h,m,g,p,x,f,y,b,v;const A=e.assigned_agent,j=Object.assign({},e,{name:null==(t=e.name)?void 0:t.trim(),description:null==(n=e.description)?void 0:n.trim(),expected_output:null==(s=e.expected_output)?void 0:s.trim(),tools:e.tools||[],tool_configs:e.tool_configs||{},agent_id:e.agent_id||"",async_execution:void 0!==e.async_execution&&Boolean(e.async_execution),markdown:void 0!==e.markdown?Boolean(e.markdown):Boolean(null==(i=e.config)?void 0:i.markdown),context:e.context||[],config:Object.assign({},e.config,{cache_response:Boolean(null==(o=e.config)?void 0:o.cache_response),cache_ttl:Number((null==(r=e.config)?void 0:r.cache_ttl)||3600),retry_on_fail:Boolean(null==(l=e.config)?void 0:l.retry_on_fail),max_retries:Number((null==(c=e.config)?void 0:c.max_retries)||3),timeout:null!=(d=e.config)&&d.timeout?Number(e.config.timeout):null,priority:Number((null==(u=e.config)?void 0:u.priority)||1),error_handling:(null==(h=e.config)?void 0:h.error_handling)||"default",output_file:(null==(m=e.config)?void 0:m.output_file)||null,output_json:(null==(g=e.config)?void 0:g.output_json)||null,output_pydantic:(null==(p=e.config)?void 0:p.output_pydantic)||null,callback:(null==(x=e.config)?void 0:x.callback)||null,human_input:Boolean(null==(f=e.config)?void 0:f.human_input),condition:(null==(y=e.config)?void 0:y.condition)||void 0,guardrail:(null==(b=e.config)?void 0:b.guardrail)||void 0,markdown:Boolean(null==(v=e.config)?void 0:v.markdown)})}),w=A?Object.assign({},j,{assigned_agent:A}):j,k=(await a.uE.post("/tasks",w)).data;return k.agent_id&&""!==k.agent_id||!w.agent_id||(k.agent_id=w.agent_id),k}catch(j){var A;throw new Error((null==(A=j.response)||null==(A=A.data)?void 0:A.detail)||"Error creating task")}}static async updateTask(e,t){try{var n,s,i,o,r,l,c,d,u,h,m,g,p,x,f,y,b,v,A;t.tool_configs;const j=Object.assign({},t,{name:null==(n=t.name)?void 0:n.trim(),description:null==(s=t.description)?void 0:s.trim(),expected_output:null==(i=t.expected_output)?void 0:i.trim(),tools:t.tools||[],tool_configs:t.tool_configs||{},agent_id:t.agent_id||"",async_execution:void 0!==t.async_execution&&Boolean(t.async_execution),markdown:void 0!==t.markdown?Boolean(t.markdown):Boolean(null==(o=t.config)?void 0:o.markdown),context:t.context||[],config:Object.assign({},t.config,{cache_response:Boolean(null==(r=t.config)?void 0:r.cache_response),cache_ttl:Number((null==(l=t.config)?void 0:l.cache_ttl)||3600),retry_on_fail:Boolean(null==(c=t.config)?void 0:c.retry_on_fail),max_retries:Number((null==(d=t.config)?void 0:d.max_retries)||3),timeout:null!=(u=t.config)&&u.timeout?Number(t.config.timeout):null,priority:Number((null==(h=t.config)?void 0:h.priority)||1),error_handling:(null==(m=t.config)?void 0:m.error_handling)||"default",output_file:(null==(g=t.config)?void 0:g.output_file)||null,output_json:(null==(p=t.config)?void 0:p.output_json)||null,output_pydantic:(null==(x=t.config)?void 0:x.output_pydantic)||null,callback:(null==(f=t.config)?void 0:f.callback)||null,human_input:Boolean(null==(y=t.config)?void 0:y.human_input),condition:(null==(b=t.config)?void 0:b.condition)||void 0,guardrail:(null==(v=t.config)?void 0:v.guardrail)||void 0,markdown:Boolean(null==(A=t.config)?void 0:A.markdown)})});return(await a.uE.put("/tasks/"+e,j)).data}catch(w){var j;throw new Error((null==(j=w.response)||null==(j=j.data)?void 0:j.detail)||"Error updating task")}}static async updateTaskFull(e,t){try{var n,s;const i=Object.assign({},t,{config:Object.assign({},t.config,{condition:(null==(n=t.config)?void 0:n.condition)||void 0,guardrail:(null==(s=t.config)?void 0:s.guardrail)||void 0})});return(await a.uE.put("/tasks/"+e+"/full",i)).data}catch(o){var i;throw new Error((null==(i=o.response)||null==(i=i.data)?void 0:i.detail)||"Error updating task")}}static async deleteTask(e){try{await a.uE.delete("/tasks/"+e)}catch(t){}}static async deleteAllTasks(){try{await a.uE.delete("/tasks")}catch(e){}}static async listTasks(){try{return(await a.uE.get("/tasks")).data}catch(t){var e;throw new Error((null==(e=t.response)||null==(e=e.data)?void 0:e.detail)||"Error fetching tasks")}}static async generateTask(e){try{const t={text:e.trim()};return(await a.uE.post("/generate/generate-task",t,{headers:{"Content-Type":"application/json"}})).data}catch(n){var t;const e=n;throw e.response,new Error((null==(t=e.response)||null==(t=t.data)?void 0:t.detail)||"Error generating task")}}}},95849:(e,t,n)=>{n.d(t,{m:()=>s});var a=n(27887);class s{static async getTool(e){try{return(await a.uE.get("/tools/"+e)).data}catch(t){return null}}static async createTool(e){try{return(await a.uE.post("/tools",e)).data}catch(n){var t;throw new Error((null==(t=n.response)||null==(t=t.data)?void 0:t.detail)||"Error creating tool")}}static async updateTool(e,t){try{const n={title:t.title,description:t.description,icon:t.icon,config:t.config};return(await a.uE.put("/tools/"+e,n)).data}catch(s){var n;throw new Error((null==(n=s.response)||null==(n=n.data)?void 0:n.detail)||"Error updating tool")}}static async deleteTool(e){try{await a.uE.delete("/tools/"+e)}catch(n){var t;throw new Error((null==(t=n.response)||null==(t=t.data)?void 0:t.detail)||"Error deleting tool")}}static async listTools(){try{return(await a.uE.get("/tools")).data}catch(t){var e;throw new Error((null==(e=t.response)||null==(e=e.data)?void 0:e.detail)||"Error fetching tools")}}static async listEnabledTools(){try{var e,t;return null!=(e=null==(t=(await a.uE.get("/tools/enabled")).data)?void 0:t.tools)?e:[]}catch(s){var n;throw new Error((null==(n=s.response)||null==(n=n.data)?void 0:n.detail)||"Error fetching enabled tools")}}static async toggleToolEnabled(e){try{return{enabled:(await a.uE.patch("/tools/"+e+"/toggle-enabled")).data.enabled}}catch(n){var t;throw new Error((null==(t=n.response)||null==(t=t.data)?void 0:t.detail)||"Error toggling tool enabled state")}}static async getAllToolConfigurations(){try{return(await a.uE.get("/tools/configurations/all")).data||{}}catch(t){var e;throw new Error((null==(e=t.response)||null==(e=e.data)?void 0:e.detail)||"Error fetching tool configurations")}}static async getToolConfiguration(e){try{return(await a.uE.get("/tools/configurations/"+encodeURIComponent(e))).data||{}}catch(n){var t;throw new Error((null==(t=n.response)||null==(t=t.data)?void 0:t.detail)||"Error fetching tool configuration")}}static async updateToolConfigurationForGroup(e,t){try{return(await a.uE.put("/tools/configurations/"+encodeURIComponent(e),t)).data||{}}catch(s){var n;throw new Error((null==(n=s.response)||null==(n=n.data)?void 0:n.detail)||"Error updating tool configuration")}}static async updateToolConfigurationInMemory(e,t){try{return(await a.uE.patch("/tools/configurations/"+encodeURIComponent(e)+"/in-memory",t)).data||{}}catch(s){var n;throw new Error((null==(n=s.response)||null==(n=n.data)?void 0:n.detail)||"Error updating in-memory tool configuration")}}static async listGlobal(){try{var e,t;return null!=(e=null==(t=(await a.uE.get("/tools/global")).data)?void 0:t.tools)?e:[]}catch(s){var n;throw new Error((null==(n=s.response)||null==(n=n.data)?void 0:n.detail)||"Error loading global tools")}}static async setGlobalAvailability(e,t){try{return(await a.uE.patch("/tools/"+e+"/global-availability",{enabled:t})).data}catch(s){var n;throw new Error((null==(n=s.response)||null==(n=n.data)?void 0:n.detail)||"Error updating global availability")}}}}}]);