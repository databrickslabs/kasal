(self.webpackChunkfrontend=self.webpackChunkfrontend||[]).push([[665],{9030:(e,t,n)=>{"use strict";n.d(t,{A:()=>o});var r=n(27887);const s=[1],o={async checkRunExists(e){try{const t="string"===typeof e&&e.includes("-");t||isNaN(parseInt(e))||parseInt(e);0;const n="/traces/job/"+e;return 200===(await r.Ay.get(n)).status}catch(t){const n=t;if(n.response&&404===n.response.status){"string"===typeof e&&e.includes("-");return!1}return n.response&&n.response.status,!1}},async getRunDetails(e){try{const t="string"===typeof e&&e.includes("-");s.includes(Number(e));const n=t||isNaN(parseInt(e))?null:parseInt(e);let o;0,o=t||null===n?"/executions/"+e:"/executions/history/"+n;return(await r.Ay.get(o)).data}catch(t){const n=t;if(n.response&&404===n.response.status){"string"===typeof e&&e.includes("-");0}throw t}},async getTaskDetails(e){try{return(await r.Ay.get("/tasks/"+e)).data}catch(t){throw t}},async getTaskName(e){try{return(await r.Ay.get("/tasks/"+e+"/name")).data}catch(t){throw t}},async getTraces(e){try{const t="string"===typeof e&&e.includes("-"),n=t||isNaN(parseInt(e))?null:parseInt(e);let s;0,s=t||null===n?"/traces/job/"+e:"/traces/execution/"+n;const o=await r.Ay.get(s);return o.data&&o.data.traces&&Array.isArray(o.data.traces)?o.data.traces.map(e=>({id:e.id.toString(),event_source:e.event_source||"",event_context:e.event_context||"",event_type:e.event_type||"",task_id:e.task_id||void 0,created_at:e.created_at||e.timestamp||(new Date).toISOString(),output:e.output||e.output_data||"",extra_data:e.extra_data||void 0,trace_metadata:e.trace_metadata||void 0})):Array.isArray(o.data)?o.data.map(e=>({id:e.id.toString(),event_source:e.event_source||"",event_context:e.event_context||"",event_type:e.event_type||"",task_id:e.task_id||void 0,created_at:e.created_at||e.timestamp||(new Date).toISOString(),output:e.output||e.output_data||"",extra_data:e.extra_data||void 0,trace_metadata:e.trace_metadata||void 0})):[]}catch(t){const n=t;if(n.response&&404===n.response.status){"string"===typeof e&&e.includes("-");0}throw t}}}},24397:(e,t,n)=>{"use strict";n.d(t,{m:()=>o});var r=n(28981),s=n(27887);const o=new class{constructor(){this.connections={},this.reconnectTimers={},this.eventEmitter=void 0,this.apiUrl=void 0,this.wsUrl=void 0,this.isReconnecting={},this.eventEmitter=new r.EventEmitter,this.apiUrl=s.$W.apiUrl,this.wsUrl=this.apiUrl.replace(/^http/,"ws")}async getHistoricalLogs(e,t,n){void 0===t&&(t=1e3),void 0===n&&(n=0);try{const r=(await s.uE.get("/runs/"+e+"/outputs",{params:{limit:t,offset:n}})).data;return(r.logs||[]).map(t=>({id:t.id||Date.now(),job_id:e,execution_id:e,output:t.content,content:t.content,timestamp:t.timestamp,type:"historical"}))}catch(o){var r;if(o instanceof Error&&"response"in o&&404===(null==(r=o.response)?void 0:r.status))return[];throw o}}calculateBackoffDelay(e){return Math.min(3e3*Math.pow(2,e),48e3)}connectToJobLogs(e){if(!this.connections[e]&&!this.isReconnecting[e])try{const t=localStorage.getItem("mockUserEmail"),r=t?"?tenant_email="+encodeURIComponent(t):"",s=new WebSocket(this.wsUrl+"/logs/executions/"+e+"/stream"+r);let o=0;const a=5;s.onopen=()=>{o=0,this.isReconnecting[e]=!1,this.eventEmitter.emit("connected-"+e)},s.onmessage=t=>{try{const s=JSON.parse(t.data);let o=null;try{"string"===typeof s.content&&s.content.includes('"type":"task_status_update"')&&(o=JSON.parse(s.content))}catch(r){}if(o&&"task_status_update"===o.type)return Promise.resolve().then(n.bind(n,61031)).then(e=>{let{useTaskExecutionStore:t}=e;const{setTaskState:n}=t.getState();if(o){const e=o.task_id||"task_"+o.task_name,t="TASK_STARTED"===o.event_type?"running":"TASK_COMPLETED"===o.event_type?"completed":"failed";n(e,{status:t,task_name:o.task_name,[("running"===t?"started":t)+"_at"]:o.timestamp})}}),void this.eventEmitter.emit("task-status-"+e,o);const a={id:s.id||Date.now(),job_id:e,execution_id:s.execution_id||e,output:s.content,content:s.content,timestamp:s.timestamp||(new Date).toISOString(),type:s.type||"live"};this.eventEmitter.emit("logs-"+e,a)}catch(s){this.eventEmitter.emit("error-"+e,new Error("Failed to parse message"))}},s.onerror=t=>{this.eventEmitter.emit("error-"+e,t)},s.onclose=t=>{if(this.eventEmitter.emit("close-"+e,t),delete this.connections[e],this.reconnectTimers[e]&&(clearTimeout(this.reconnectTimers[e]),delete this.reconnectTimers[e]),!t.wasClean&&o<a&&!this.isReconnecting[e]){const t=this.calculateBackoffDelay(o);this.isReconnecting[e]=!0,this.reconnectTimers[e]=setTimeout(()=>{o++,this.connectToJobLogs(e)},t)}else o>=a&&(delete this.isReconnecting[e],this.eventEmitter.emit("error-"+e,new Error("Failed to establish WebSocket connection after multiple attempts")))},this.connections[e]=s}catch(t){this.eventEmitter.emit("error-"+e,t),delete this.isReconnecting[e]}}disconnectFromJobLogs(e){this.reconnectTimers[e]&&(clearTimeout(this.reconnectTimers[e]),delete this.reconnectTimers[e]),delete this.isReconnecting[e];const t=this.connections[e];t&&(t.close(1e3,"Client disconnected"),delete this.connections[e])}onConnected(e,t){const n="connected-"+e;return this.eventEmitter.on(n,t),()=>{this.eventEmitter.off(n,t)}}onJobLogs(e,t){const n="logs-"+e;return this.eventEmitter.on(n,t),()=>{this.eventEmitter.off(n,t)}}onError(e,t){const n="error-"+e;return this.eventEmitter.on(n,t),()=>{this.eventEmitter.off(n,t)}}onClose(e,t){const n="close-"+e;return this.eventEmitter.on(n,t),()=>{this.eventEmitter.off(n,t)}}onTaskStatus(e,t){const n="task-status-"+e;return this.eventEmitter.on(n,t),()=>{this.eventEmitter.off(n,t)}}cleanup(){Object.keys(this.reconnectTimers).forEach(e=>{clearTimeout(this.reconnectTimers[e]),delete this.reconnectTimers[e]}),this.isReconnecting={},Object.keys(this.connections).forEach(e=>{this.disconnectFromJobLogs(e)}),this.eventEmitter.removeAllListeners()}}},27721:(e,t,n)=>{"use strict";n.d(t,{O:()=>o});var r=n(27887),s=n(13062);class o{static getInstance(){return o.instance||(o.instance=new o),o.instance}async setDatabricksConfig(e){try{return(await r.Ay.post("/databricks/config",e)).data.config}catch(n){var t;if(n instanceof s.pe)throw new Error((null==(t=n.response)||null==(t=t.data)?void 0:t.detail)||"Failed to set Databricks configuration");throw new Error("Failed to connect to the server")}}async getDatabricksConfig(){try{return(await r.Ay.get("/databricks/config")).data}catch(n){if(n instanceof s.pe){var e,t;if(404===(null==(e=n.response)?void 0:e.status))return null;throw new Error((null==(t=n.response)||null==(t=t.data)?void 0:t.detail)||"Failed to get Databricks configuration")}throw new Error("Failed to connect to the server")}}async checkPersonalTokenRequired(){try{return(await r.Ay.get("/databricks/status/personal-token-required")).data}catch(t){var e;if(t instanceof s.pe)throw new Error((null==(e=t.response)||null==(e=e.data)?void 0:e.detail)||"Failed to check personal token status");throw new Error("Failed to connect to the server")}}async checkDatabricksConnection(){try{return(await r.Ay.get("/databricks/connection")).data}catch(t){var e;if(t instanceof s.pe)throw new Error((null==(e=t.response)||null==(e=e.data)?void 0:e.detail)||"Failed to check Databricks connection");throw new Error("Failed to connect to the server")}}async getDatabricksEnvironment(){try{return(await r.Ay.get("/databricks/environment")).data}catch(t){var e;if(t instanceof s.pe)throw new Error((null==(e=t.response)||null==(e=e.data)?void 0:e.detail)||"Failed to get Databricks environment");throw new Error("Failed to connect to the server")}}static async getConfiguration(){return o.getInstance().getDatabricksConfig()}static async updateConfiguration(e){return o.getInstance().setDatabricksConfig(e)}}o.instance=void 0},36060:(e,t,n)=>{"use strict";n.d(t,{l:()=>s});var r=n(27887);class s{static async createSchedule(e){return(await r.uE.post("/schedules",e)).data}static async listSchedules(){return(await r.uE.get("/schedules")).data}static async getSchedule(e){return(await r.uE.get("/schedules/"+e)).data}static async updateSchedule(e,t){return(await r.uE.put("/schedules/"+e,t)).data}static async deleteSchedule(e){await r.uE.delete("/schedules/"+e)}static async toggleSchedule(e){return(await r.uE.post("/schedules/"+e+"/toggle")).data}}new s},43833:(e,t,n)=>{"use strict";n.d(t,{A:()=>D});var r=n(98587),s=n(9950),o=n(2235),a=n(16491),i=n(25277),l=n(63464),c=n(40033),d=n(82053),u=n(83274),p=n(25333),h=n(28170),m=n(46639),g=n(65429),x=n(79739),f=n(18216),y=n(4804),b=n(24397),j=n(67818),v=n(44414);const A=["job_id","execution_id"],w=["job_id","execution_id"],k=e=>{if(!e)return{content:"",type:"INFO"};let t=(e=>{if(!e)return"";const t=String.fromCharCode(27),n=String.fromCharCode(7);return e.replace(new RegExp(t+"\\[[0-9;]*[ABCDEFGHJKLMSTfminsulh]","g"),"").replace(new RegExp(t+"\\][^"+n+"]*"+n,"g"),"").replace(new RegExp(t+"[NOPGKabcdfghinqrstuABCDHIJMOPRTl]","g"),"").replace(new RegExp(t+"[\\[\\]\\?\\(\\)#;0-9]*[0-9A-Za-z]","g"),"").replace(new RegExp(t,"g"),"").replace(/^[([{|]+/gm,"")})(e);if(t=t.replace(/^[([{|]+/gm,"").trim(),t.includes("INFO - CREW-STDOUT:")&&(t=t.replace(/INFO - CREW-STDOUT:\s*/,"").trim()),t.includes("INFO - CREWAI-LOG:")&&(t=t.replace(/INFO - CREWAI-LOG:\s*/,"").trim()),t.includes("INFO - EVENT-")&&(t=t.replace(/INFO - EVENT-/,"EVENT: ").trim()),t.includes("[CREW]")){const e=t.match(/\[CREW\]\s+\d{4}-\d{2}-\d{2}\s+\d{2}:\d{2}:\d{2},\d{3}\s*-\s*(.*)/);t=e&&e[1]?e[1].trim():t.replace(/\[CREW\]/g,"").trim()}t=t.replace(/[\u2502\u251c\u2514\u2500\u2551\u2554\u2557\u255a\u255d\u2560\u2563\u2566\u2569\u256c\u256d\u256e\u256f\u2570]/g," ").replace(/\s{2,}/g," ");let n="INFO";return e.includes("[LLM-CALL-START]")?n="LLM-CALL":e.includes("Error")||e.includes("ERROR")||e.includes("Failed")||e.includes("\u274c")?n="ERROR":e.includes("STDOUT")?n="INFO":e.includes("CREWAI-LOG:")?n="API":e.includes("EVENT-")?n="EVENT":(e.includes("[CREW]")||e.includes("\u{1f680} Crew:"))&&(n="CREW"),{content:t,type:n}},S=e=>{switch(e){case"ERROR":return"#ff5252";case"LLM-CALL":return"#ffab40";case"CREW":return"#42a5f5";case"STDOUT":return"#66bb6a";case"API":return"#7986cb";case"EVENT":return"#ba68c8";default:return"#e0e0e0"}},_={30:"#000000",31:"#ff5252",32:"#4caf50",33:"#ffeb3b",34:"#2196f3",35:"#e040fb",36:"#00bcd4",37:"#e0e0e0",90:"#9e9e9e",91:"#ff8a80",92:"#b9f6ca",93:"#ffff8d",94:"#82b1ff",95:"#ea80fc",96:"#84ffff",97:"#ffffff"},C=e=>{if(!e||!e.includes("["))return e;const t=e.split(/(\[\d+(?:;\d+)*m|\[0m)/);if(t.length<=1)return e;let n="",r=!1;return(0,v.jsx)(v.Fragment,{children:t.map((e,t)=>{if(e.match(/\[\d+(?:;\d+)*m/)){var s;if("[0m"===e)return n="",r=!1,null;return((null==(s=e.match(/\[(\d+(?:;\d+)*)m/))?void 0:s[1].split(";"))||[]).forEach(e=>{_[e]?n=_[e]:"1"===e&&(r=!0)}),null}return e?(0,v.jsx)("span",{style:{color:n||void 0,fontWeight:r?"bold":void 0},children:e},t):null})})},E=e=>{const t=e.includes("Error")||e.includes("Failure"),n=(e.includes("Completed")||e.includes("Success"),e.includes("Crew Execution Started"));let r="#4caf50",s="#66bb6a",i="rgba(102, 187, 106, 0.1)";t?(r="#ff5252",s="#ff5252",i="rgba(255, 82, 82, 0.1)"):n&&(r="#42a5f5",s="#42a5f5",i="rgba(66, 165, 245, 0.1)");const{title:l,lines:c}=(e=>{const t=(e=e.replace(/[\u2502\u251c\u2514\u2500\u2551\u2554\u2557\u255a\u255d\u2560\u2563\u2566\u2569\u256c\u256d\u256e\u256f\u2570]/g," ").replace(/\s{2,}/g," ")).split("\n").filter(e=>""!==e.trim());let n="";return t.length>0&&(n=t[0].trim()),{title:n,lines:t.slice(1).map(e=>e.trim()).filter(Boolean)}})(e);return(0,v.jsxs)(o.A,{elevation:0,sx:{border:"1px solid "+r,borderRadius:"4px",overflow:"hidden",backgroundColor:"rgba(33, 37, 43, 0.7)",mb:.5},children:[l&&(0,v.jsx)(a.A,{sx:{backgroundColor:i,color:s,fontWeight:"bold",px:1.5,py:.5,borderBottom:"1px solid "+r,fontSize:"0.9rem"},children:C(l)}),(0,v.jsx)(a.A,{sx:{p:1.5},children:c.map((e,t)=>{const n=(e=>{const t=e.match(/([^:]+):\s*(.*)/);return t?{key:t[1].trim(),value:t[2].trim()}:null})(e);return n?(0,v.jsxs)(a.A,{sx:{display:"flex",mb:.25},children:[(0,v.jsxs)(a.A,{sx:{color:"#e0e0e0",minWidth:"100px"},children:[n.key,":"]}),(0,v.jsx)(a.A,{sx:{color:r,fontWeight:"bold",ml:1},children:C(n.value)})]},t):(0,v.jsx)(a.A,{sx:{color:"white",mb:.25,fontSize:"0.85rem",lineHeight:"1.2"},children:C(e)},t)})})]})},T=e=>{if(!e)return null;const t=e.replace(/[\u2502\u251c\u2514\u2500\u2551\u2554\u2557\u255a\u255d\u2560\u2563\u2566\u2569\u256c\u256d\u256e\u256f\u2570]/g," ").replace(/\s{2,}/g," ");if(t.includes("Crew Execution Started")||t.includes("Completed")||t.includes("Error")||t.includes("Failure")){const e=t.replace(/[\u2502\u251c\u2514\u2500\u2551\u2554\u2557\u255a\u255d\u2560\u2563\u2566\u2569\u256c\u256d\u256e\u256f\u2570]/g," ");return E(e)}if(t.includes("\u{1f680} Crew:")||t.includes("\u{1f4cb} Task:")||t.includes("\u{1f916} Agent:")||t.includes("Assigned to:")||t.includes("Status:"))return R(t);const n=e=>{if((e=e.replace(/[\u2502\u251c\u2514\u2500\u2551\u2554\u2557\u255a\u255d\u2560\u2563\u2566\u2569\u256c\u256d\u256e\u256f\u2570]/g," ").replace(/\s{2,}/g," ")).match(/\[\d+(?:;\d+)*m/)||e.includes("[0m"))return C(e);if(e.includes("\u274c"))return(0,v.jsx)("span",{style:{color:"#ff5252",fontWeight:"bold"},children:e});if(e.includes("\u{1f680}"))return(0,v.jsx)("span",{style:{color:"#42a5f5",fontWeight:"bold"},children:e});if(e.includes("Agent:")){const t=e.match(/Agent:\s+(.+)$/);return t?(0,v.jsxs)(v.Fragment,{children:[(0,v.jsx)("span",{children:"Agent: "}),(0,v.jsx)("span",{style:{color:"#4caf50",fontWeight:"bold"},children:t[1]})]}):(0,v.jsx)("span",{style:{color:"#66bb6a",fontWeight:"bold"},children:e})}if(e.includes("Task:")){const t=e.match(/Task:\s+(.+)$/);return t?(0,v.jsxs)(v.Fragment,{children:[(0,v.jsx)("span",{children:"Task: "}),(0,v.jsx)("span",{style:{color:"#ffab40",fontWeight:"bold"},children:t[1]})]}):(0,v.jsx)("span",{style:{color:"#ffab40",fontWeight:"bold"},children:e})}if(e.includes("Status:")){const t=e.match(/Status:\s+(.+)$/);return t?(0,v.jsxs)(v.Fragment,{children:[(0,v.jsx)("span",{children:"Status: "}),(0,v.jsx)("span",{style:{color:"#ba68c8",fontWeight:"bold"},children:t[1]})]}):(0,v.jsx)("span",{style:{color:"#ba68c8",fontWeight:"bold"},children:e})}if(e.includes("Assigned to:")){const t=e.match(/Assigned to:\s+(.+)$/);if(t)return(0,v.jsxs)(v.Fragment,{children:[(0,v.jsx)("span",{children:"Assigned to: "}),(0,v.jsx)("span",{style:{color:"#4caf50",fontWeight:"bold"},children:t[1]})]})}return e.match(/HTTP Request:/)?(0,v.jsx)("span",{style:{color:"#7986cb"},children:e}):e.match(/^\d+\.\s+\*\*.+\*\*/)?(0,v.jsx)("span",{style:{color:"#81c784",fontWeight:"bold"},children:e}):(0,v.jsx)("span",{children:e})},r=t.split("\n");return(0,v.jsx)(v.Fragment,{children:r.map((e,t)=>(0,v.jsx)("div",{style:{lineHeight:"1.2"},children:n(e)},t))})},R=e=>{const t=(e=e.replace(/[\u2502\u251c\u2514\u2500\u2551\u2554\u2557\u255a\u255d\u2560\u2563\u2566\u2569\u256c\u256d\u256e\u256f\u2570]/g," ").replace(/\s{2,}/g," ")).split("\n").filter(e=>""!==e.trim());if(0===t.length)return null;const n=t.map((e,t)=>{const n={raw:e,type:"unknown",content:"",icon:"",label:"",value:"",isKeyValue:!1},r=e.trim().replace(/[\u2502\u251c\u2514\u2500\u2551\u2554\u2557\u255a\u255d\u2560\u2563\u2566\u2569\u256c\u256d\u256e\u256f\u2570]/g,"").replace(/^[([{|]+/,"").trim();if(r.startsWith("\u{1f680} Crew:"))n.type="crew",n.icon="\u{1f680}",n.content=r.replace("\u{1f680} Crew:","").trim();else if(r.startsWith("\u{1f4cb} Task:"))n.type="task",n.icon="\u{1f4cb}",n.content=r.replace("\u{1f4cb} Task:","").trim();else if(r.startsWith("\u{1f916} Agent:"))n.type="agent",n.icon="\u{1f916}",n.content=r.replace("\u{1f916} Agent:","").trim();else if(r.includes("Assigned to:")){n.type="assigned",n.isKeyValue=!0;const e=r.split("Assigned to:");n.label="Assigned to",n.value=e[1].trim()}else if(r.includes("Status:")){n.type="status",n.isKeyValue=!0;const e=r.split("Status:");n.label="Status",n.value=e[1].trim().replace(/[\u2502\u251c\u2514\u2500\u2551\u2554\u2557\u255a\u255d\u2560\u2563\u2566\u2569\u256c\u256d\u256e\u256f\u2570]/g,"").trim()}else n.type="text",n.content=r;return n});return(0,v.jsx)(a.A,{sx:{fontFamily:"monospace",my:.5,pl:1.5,pt:.5,pb:.25,borderLeft:"2px solid #42a5f5",backgroundColor:"rgba(66, 165, 245, 0.05)",borderRadius:"4px",fontSize:"0.85rem"},children:n.map((e,t)=>{switch(e.type){case"crew":return(0,v.jsxs)(a.A,{sx:{display:"flex",alignItems:"center",py:.25,color:"#42a5f5",fontWeight:"bold"},children:[(0,v.jsx)("span",{style:{marginRight:"4px"},children:e.icon}),(0,v.jsxs)("span",{children:["Crew: ",e.content]})]},t);case"task":return(0,v.jsxs)(a.A,{sx:{display:"flex",alignItems:"center",py:.25,color:"#ffab40",fontWeight:"bold"},children:[(0,v.jsx)("span",{style:{marginRight:"4px"},children:e.icon}),(0,v.jsxs)("span",{children:["Task: ",e.content]})]},t);case"agent":return(0,v.jsxs)(a.A,{sx:{display:"flex",alignItems:"center",py:.25,color:"#4caf50",fontWeight:"bold"},children:[(0,v.jsx)("span",{style:{marginRight:"4px"},children:e.icon}),(0,v.jsxs)("span",{children:["Agent: ",e.content]})]},t);case"assigned":return(0,v.jsxs)(a.A,{sx:{display:"flex",py:.25},children:[(0,v.jsx)("span",{style:{color:"#e0e0e0",minWidth:"100px"},children:"Assigned to:"}),(0,v.jsx)("span",{style:{color:"#4caf50",fontWeight:"bold",marginLeft:"4px"},children:e.value})]},t);case"status":{let n="#ba68c8";return e.value.includes("\u2705 Completed")?n="#66bb6a":e.value.includes("\u274c")?n="#ff5252":e.value.includes("Executing")&&(n="#ffab40"),(0,v.jsxs)(a.A,{sx:{display:"flex",py:.25},children:[(0,v.jsx)("span",{style:{color:"#e0e0e0",minWidth:"100px"},children:"Status:"}),(0,v.jsx)("span",{style:{color:n,fontWeight:"bold",marginLeft:"4px"},children:e.value})]},t)}default:return(0,v.jsx)(a.A,{sx:{py:.25,color:"#e0e0e0"},children:e.content},t)}})})},z=e=>e&&0!==e.length?e.map(e=>{const t=e.output||e.content||"",{content:n,type:r}=k(t);return Object.assign({},e,{output:n,content:n,logType:r})}):[],L=e=>{if(e.length<=1)return e;const t=[];let n=0;for(;n<e.length;){const r=e[n],s=r.content||"";if(s.match(/^\d{2}:\d{2}:\d{2}\s+[AP]M$/))n++;else if("API"===r.logType&&s.includes("HTTP Request:")){let o=s,a=n+1;for(;a<e.length;){const t=e[a],n=t.content||"";if(n.match(/^\d{2}:\d{2}:\d{2}\s+[AP]M$/))a++;else{if("API"!==t.logType||!n.includes("HTTP Request:"))break;o+="\n"+n,a++}}t.push(Object.assign({},r,{content:o,output:o})),n=a}else t.push(r),n++}return t},D=e=>{let{open:t,onClose:n,logs:o,jobId:k,isConnecting:_,connectionError:C}=e;const[E,R]=(0,s.useState)(o),[D,I]=(0,s.useState)([]),[O,W]=(0,s.useState)(!1),[F,N]=(0,s.useState)(0),[M,H]=(0,s.useState)(!0),[P,U]=(0,s.useState)(!1),[B,J]=(0,s.useState)(!0),Y=(0,s.useRef)(null),V=1e3,{t:K}=(0,j.Bd)(),q=e=>e.filter(e=>{const t=e.output||e.content;if(!t)return!1;return t.trim().length>0});(0,s.useEffect)(()=>{const e=[...o].sort((e,t)=>new Date(e.timestamp).getTime()-new Date(t.timestamp).getTime()),t=q(e);R(t);const n=z(t),r=L(n);I(r)},[o]),(0,s.useEffect)(()=>{B&&Y.current&&(Y.current.scrollTop=Y.current.scrollHeight)},[D,B]);return(0,v.jsxs)(l.A,{open:t,onClose:n,maxWidth:"lg",fullWidth:!0,PaperProps:{sx:{height:"80vh"}},children:[(0,v.jsx)(c.A,{children:(0,v.jsxs)(a.A,{display:"flex",justifyContent:"space-between",alignItems:"center",children:[(0,v.jsx)(d.A,{children:K("logs.executionLogs.title")}),(0,v.jsxs)(a.A,{children:[(0,v.jsx)(u.A,{title:K(B?"logs.executionLogs.autoScrollOn":"logs.executionLogs.autoScrollOff"),children:(0,v.jsx)(d.A,{variant:"caption",sx:{mr:2,color:B?"success.main":"text.secondary"},children:K(B?"logs.executionLogs.autoScrollOn":"logs.executionLogs.autoScrollOff")})}),(0,v.jsx)(u.A,{title:K("logs.executionLogs.refreshLogs"),children:(0,v.jsx)(p.A,{onClick:async()=>{try{U(!0);const e=await b.m.getHistoricalLogs(k,V,0),t=q(e.map(e=>{let t=(0,r.A)(e,w);return Object.assign({},t,{output:t.output||t.content})}).sort((e,t)=>new Date(e.timestamp).getTime()-new Date(t.timestamp).getTime())),n=new Set(E.map(e=>e.id));if(t.some(e=>!n.has(e.id))||t.length!==E.length){R(t);const e=z(t),n=L(e);I(n),N(0),H(!0),J(!0)}}catch(e){}finally{U(!1)}},disabled:P,children:(0,v.jsx)(y.A,{})})})]})]})}),(0,v.jsxs)(h.A,{children:[_&&(0,v.jsxs)(a.A,{display:"flex",justifyContent:"center",mb:2,children:[(0,v.jsx)(m.A,{size:20}),(0,v.jsx)(d.A,{variant:"body2",ml:1,children:K("logs.executionLogs.connecting")})]}),C&&(0,v.jsx)(g.A,{severity:"error",sx:{mb:2},children:K("logs.executionLogs.connectionError")}),O&&(0,v.jsx)(a.A,{display:"flex",justifyContent:"center",mt:2,children:(0,v.jsx)(m.A,{size:20})}),(0,v.jsx)(a.A,{ref:Y,onScroll:()=>{if(!Y.current)return;const{scrollTop:e,scrollHeight:t,clientHeight:n}=Y.current;J(t-e-n<50),e<50&&!O&&M&&(async()=>{if(!O&&M)try{W(!0);const e=F+V,t=await b.m.getHistoricalLogs(k,V,e);if(0===t.length)H(!1);else{const n=q(t.map(e=>{let t=(0,r.A)(e,A);return Object.assign({},t,{output:t.output||t.content})}).sort((e,t)=>new Date(e.timestamp).getTime()-new Date(t.timestamp).getTime())),s=[...E,...n];R(s);const o=z(s),a=L(o);I(a),N(e)}}catch(e){}finally{W(!1)}})()},sx:{height:"calc(100% - 20px)",overflowY:"auto",bgcolor:"#21252b",p:2,borderRadius:1,fontFamily:"monospace",fontSize:"0.875rem",whiteSpace:"pre-wrap",wordBreak:"break-word"},children:(()=>{let e=null;return D.map((t,n)=>{const r=t.output||t.content||"",s=t.logType||"INFO",o=((e,t)=>"INFO"!==e&&(null===t||e!==t))(s,e);return e=s,(0,v.jsxs)(a.A,{sx:{mb:.5,py:.25,px:.5,borderRadius:"4px",backgroundColor:"ERROR"===s?"rgba(255,82,82,0.1)":"transparent",borderLeft:"3px solid "+S(s),"&:hover":{bgcolor:"rgba(255,255,255,0.05)"}},children:[o&&(0,v.jsx)(i.A,{label:s,size:"small",sx:{height:"16px",fontSize:"0.7rem",backgroundColor:S(s),color:"#000","& .MuiChip-label":{px:.75},mb:.25}}),(0,v.jsx)(a.A,{sx:{color:"INFO"===s?"#e0e0e0":"ERROR"===s?"#ff8a80":"STDOUT"===s?"#b9f6ca":"API"===s?"#c5cae9":"EVENT"===s?"#e1bee7":"#e1f5fe",fontFamily:"monospace",fontSize:"0.85rem",mt:o?.25:0,lineHeight:"1.2"},children:T(r)})]},t.timestamp+"-"+n)})})()})]}),(0,v.jsx)(x.A,{children:(0,v.jsx)(f.A,{onClick:n,children:K("common.close")})})]})}},50477:()=>{},61031:(e,t,n)=>{"use strict";n.r(t),n.d(t,{useTaskExecutionStore:()=>o});var r=n(19458),s=n(27887);const o=(0,r.vt)((e,t)=>({taskStates:new Map,seenTasks:new Set,setTaskState:(t,n)=>{e(e=>{const r=new Map(e.taskStates);return r.set(t,n),{taskStates:r}})},hasSeenTask:e=>t().seenTasks.has(e),markTaskSeen:t=>{e(e=>{const n=new Set(e.seenTasks);return n.add(t),{seenTasks:n}})},loadTaskStates:async t=>{try{const n=await s.uE.get("/traces/job/"+t+"/task-states");e(e=>{const t=new Map(e.taskStates);return Object.entries(n.data).forEach(e=>{let[n,r]=e,s=n;s.startsWith("task_")&&(s=s.substring(5)),s.startsWith("task-")&&(s=s.substring(5)),t.set(s,r)}),{taskStates:t}})}catch(n){}},clearTaskStates:()=>{e({taskStates:new Map,seenTasks:new Set})},isTaskRunning:e=>{const n=t().taskStates.get(e);return"running"===(null==n?void 0:n.status)},getTaskStatus:e=>t().taskStates.get(e)}))},69893:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>xt});var r=n(98587),s=n(9950),o=n(25277),a=n(46639),i=n(16491),l=n(48089),c=n(50704),d=n(1320),u=n(15769),p=n(69780),h=n(9213),m=n(21671),g=n(34075),x=n(65429),f=n(83274),y=n(25333),b=n(72362),j=n(8145),v=n(2046),A=n(4753),w=n(57988),k=n(19223),S=n(51069),_=n(90037),C=n(86456),E=n(78287),T=n(62375),R=n(91602),z=n(38924),L=n(75737),D=n(36060),I=n(63464),O=n(40033),W=n(82053),F=n(74745),N=n(18216),M=n(28170),H=n(2235),P=n(33738),U=n(79739),B=n(96319),J=n(18726),Y=n(13246),V=n(4983),K=n(34593),q=n(69935),G=n(79084),$=n(40155),Q=n(4804),Z=n(41328),X=n(27887),ee=n(9030),te=n(19458),ne=n(11758);const re={useNewExecutionUI:!0},se=(0,te.vt)()((0,ne.Zr)(e=>Object.assign({},re,{setUseNewExecutionUI:t=>e({useNewExecutionUI:t}),resetPreferences:()=>e(re)}),{name:"user-preferences"}));var oe=n(67818),ae=n(43833),ie=n(24397),le=n(27575),ce=n(5064),de=n(52180),ue=n(44414);const pe=e=>{var t,n,r,l;let{open:c,onClose:d,runId:u,run:p,onViewResult:h,onShowLogs:m}=e;const{t:g}=(0,oe.Bd)(),{useNewExecutionUI:x}=se(),{showRunResult:b}=(0,le.K)(),[j,v]=(0,s.useState)([]),[A,w]=(0,s.useState)(null),[k,S]=(0,s.useState)(!0),[_,C]=(0,s.useState)(null),[T,R]=(0,s.useState)(new Set),[L,D]=(0,s.useState)(new Set),[te,ne]=(0,s.useState)(null),[re,pe]=(0,s.useState)(!1),[he,me]=(0,s.useState)([]),[ge,xe]=(0,s.useState)(!1),[fe,ye]=(0,s.useState)(null),[be,je]=(0,s.useState)(!1),[ve,Ae]=(0,s.useState)(!1),[we,ke]=(0,s.useState)(!1),Se=async()=>{try{let o,a,i="";try{var e,t;const n=await X.Ay.get("/databricks/environment");o=(null==n||null==(e=n.data)?void 0:e.workspace_id)||void 0;const r=null==n||null==(t=n.data)?void 0:t.databricks_host;!i&&r&&(i=r.startsWith("http")?r:"https://"+r)}catch(s){}if(!i||"compute"===i||!i.includes("."))if("undefined"!==typeof window&&window.location.hostname.includes("databricks"))i="https://"+window.location.hostname;else try{var n;i=(null==(n=(await X.Ay.get("/databricks/workspace-url")).data)?void 0:n.workspace_url)||""}catch(s){}if(!i)return"#";i.endsWith("/")&&(i=i.slice(0,-1)),i.startsWith("http")||(i="https://"+i);try{var r;const e=await X.Ay.get("/mlflow/experiment-info");a=(null==e||null==(r=e.data)?void 0:r.experiment_id)||void 0}catch(s){}if(a){const e=o?"?o="+encodeURIComponent(o):"";return i+"/ml/experiments/"+encodeURIComponent(a)+"/traces"+e}return i+"/mlflow/experiments"}catch(o){return"#"}},_e=(0,s.useCallback)(e=>{const t=[...e.filter(e=>"Task Orchestrator"!==e.event_source&&"task_management"!==e.event_context)].sort((e,t)=>new Date(e.created_at).getTime()-new Date(t.created_at).getTime());if(0===t.length)return{agents:[],globalEvents:{start:[],end:[]}};const n=new Date(t[0].created_at),r=new Date(t[t.length-1].created_at),s=r.getTime()-n.getTime(),o={start:t.filter(e=>"crew"===e.event_source&&("crew_started"===e.event_type||"execution_started"===e.event_type)),end:t.filter(e=>"crew"===e.event_source&&("crew_completed"===e.event_type||"execution_completed"===e.event_type))},a=new Map,i=new Map,l=new Map;let c=null;t.forEach(e=>{if("task"===e.event_source&&"task_completed"===e.event_type&&e.event_context&&(i.set(e.event_context,e.event_context),c=e.event_context),e.event_source&&"crew"!==e.event_source&&"task"!==e.event_source&&"Unknown Agent"!==e.event_source&&c&&l.set(c,e.event_source),"agent_execution"===e.event_type&&e.extra_data&&"object"===typeof e.extra_data){const t=e.extra_data.agent_role;t&&"UnknownAgent-str"!==t&&"Unknown Agent"!==t&&c&&l.set(c,t)}}),t.forEach(e=>{if("crew"===e.event_source||"task"===e.event_source||"Task Orchestrator"===e.event_source||"task_management"===e.event_context)return;let t=e.event_source||"Unknown Agent";if("llm_call"===e.event_type&&e.extra_data&&"object"===typeof e.extra_data){const n=e.extra_data.agent_role;n&&"UnknownAgent-str"!==n&&"Unknown Agent"!==n&&(t=n)}if(("Unknown Agent"===t||t.startsWith("Unknown"))&&c){const e=l.get(c);e&&(t=e)}a.has(t)||a.set(t,[]);const n=a.get(t);n&&n.push(e)});const d=[];return a.forEach((e,n)=>{if(0===e.length)return;const r=new Date(e[0].created_at),s=new Date(e[e.length-1].created_at),o=new Map;let a=null,c=0;e.forEach(e=>{if("task_started"===e.event_type){let t=null;if(e.trace_metadata){const n=e.trace_metadata.task_name;n&&(t=n)}if(!t&&e.extra_data){const n=e.extra_data.task_name;n&&(t=n)}if(t){let e=t;o.has(t)&&(c++,e=t+" ("+c+")"),a=e}}if(!a){const r=new Date(e.created_at).getTime(),s=Array.from(i.entries());for(const[e,o]of s){const s=t.find(t=>"task"===t.event_source&&"task_completed"===t.event_type&&t.event_context===e);if(s){if(r<=new Date(s.created_at).getTime()+1e3){const t=l.get(e);if(!t||t===n){a=o;break}}}}}a||(a="Processing Task"),o.has(a)||o.set(a,[]);const r=o.get(a);r&&r.push(e)});const u=Array.from(o.entries()).map(e=>{let[t,n]=e;const r=new Date(n[0].created_at),s=new Date(n[n.length-1].created_at),o=n.map((e,t)=>{const r=new Date(e.created_at),s=n[t+1],o=s?new Date(s.created_at).getTime()-r.getTime():void 0;let a="info",i="";if("llm_call"===e.event_type){a="llm";let t="",n="";if(e.extra_data&&"object"===typeof e.extra_data){const r=e.extra_data;t=r.agent_role||"",n=r.model||""}if(i=t&&"Unknown Agent"!==t?"LLM call ("+t+")":"LLM call",n){const e=n.split("/");i+=" - "+e[e.length-1]}}else if("tool_usage"===e.event_type){a="tool";i=e.event_context||"Tool"}else if("agent_execution"===e.event_type||"agent_step"===e.event_type){let t="";e.output&&("string"===typeof e.output?t=e.output:"object"===typeof e.output&&"content"in e.output&&(t=String(e.output.content||"")));const n=t;let r="";if(e.extra_data&&"object"===typeof e.extra_data){r=e.extra_data.step_type||""}if(n.includes("Tool:")){const e=n.match(/Tool: ([^|]+)/);a="tool",i=e?e[1].trim():"Tool Usage"}else n.includes("ToolResult")?(a="tool_result",i="Tool Result"):n.toLowerCase().includes("llm")?(a="llm",i="LLM call"):"AgentFinish"===r?(a="agent_complete",i="Final Answer"):"AgentStart"===r?(a="agent_start",i="Task Started"):n&&n.length>100?(a="agent_output",i="Task Output"):(a="agent_processing",i="Processing")}else if("task_started"===e.event_type){a="task_start";let t="Task Started";if(e.trace_metadata&&"object"===typeof e.trace_metadata){const n=e.trace_metadata.task_name;n&&(t=n.length>50?n.substring(0,47)+"...":n)}else if(e.extra_data&&"object"===typeof e.extra_data){const n=e.extra_data.task_name;n&&(t=n.length>50?n.substring(0,47)+"...":n)}i="Starting: "+t}else if("task_completed"===e.event_type){a="task_complete";let t="Task Completed";if(e.trace_metadata&&"object"===typeof e.trace_metadata){const n=e.trace_metadata.task_name;n&&(t=n.length>50?n.substring(0,47)+"...":n)}else if(e.extra_data&&"object"===typeof e.extra_data){const n=e.extra_data.task_name;n&&(t=n.length>50?n.substring(0,47)+"...":n)}i="Completed: "+t}else if("memory_operation"===e.event_type)a="memory_operation",i=e.event_context?e.event_context.includes("query")?"Memory Query":e.event_context.includes("sav")?"Memory Save":"Memory Operation":"Memory Operation";else if("knowledge_operation"===e.event_type)a="knowledge_operation",i="Knowledge Operation";else if("agent_reasoning"===e.event_type||"agent_reasoning_error"===e.event_type)a="reasoning","agent_reasoning_error"===e.event_type?i="Reasoning Failed":(i="Agent Reasoning",e.output&&"string"===typeof e.output&&e.output.includes("plan")&&(i="Agent Planning"));else if("llm_guardrail"===e.event_type){if(a="guardrail",i="LLM Guardrail Check",e.extra_data&&"object"===typeof e.extra_data){const t=e.extra_data;!0===t.success?i="Guardrail Passed":!1===t.success&&(i="Guardrail Failed")}}else{a=e.event_type;i=e.event_type.replace(/_/g," ").replace(/\b\w/g,e=>e.toUpperCase())}let l=e.output;if(e.output&&"object"===typeof e.output&&"content"in e.output){const t=e.output.content;("string"===typeof t||"object"===typeof t&&null!==t)&&(l=t)}return{type:a,description:i,timestamp:r,duration:o,output:l}});return{taskName:t,taskId:n[0].task_id,startTime:r,endTime:s,duration:s.getTime()-r.getTime(),events:o}});d.push({agent:n,startTime:r,endTime:s,duration:s.getTime()-r.getTime(),tasks:u})}),{globalStart:n,globalEnd:r,totalDuration:s,agents:d,globalEvents:o}},[]),Ce=(0,s.useCallback)(async function(e){if(void 0===e&&(e=!0),u)try{e?S(!0):je(!0);if(!await ee.A.checkRunExists(u))return C("Run ID "+u+" does not exist or is no longer available."),S(!1),void je(!1);const t=await ee.A.getRunDetails(u),n=t.job_id&&t.job_id.includes("-")?t.job_id:u,r=await ee.A.getTraces(n);if(r&&Array.isArray(r)&&0!==r.length){v(r);const t=_e(r);w(t),R(e?new Set(t.agents.map((e,t)=>t)):e=>e),C(null)}else C("No trace data is available for this run."),v([])}catch(t){const e=t instanceof Error?t.message:"Unknown error";C("Failed to load traces: "+e),v([])}finally{S(!1),je(!1)}},[u,_e]);(0,s.useEffect)(()=>{c&&Ce(!0)},[c,Ce]),(0,s.useEffect)(()=>{c&&(async()=>{try{var e;const t=await X.Ay.get("/mlflow/evaluation-status");Ae(!(null==t||null==(e=t.data)||!e.enabled))}catch(t){Ae(!1)}})()},[c]);(0,s.useEffect)(()=>{A&&be&&D(e=>{const t=new Set(e);return T.forEach(e=>{A.agents[e]&&A.agents[e].tasks.forEach((n,r)=>{const s=e+"-"+r;t.add(s)})}),t})},[A,T,be]),(0,s.useEffect)(()=>{if(!c)return;if((null==p?void 0:p.status)&&["completed","failed","cancelled","stopped","error"].includes(p.status.toLowerCase()))return;const e=setInterval(()=>{Ce(!1)},5e3);return()=>{clearInterval(e)}},[c,null==p?void 0:p.status,Ce]);const Ee=e=>{if(e<1e3)return e+"ms";const t=e/1e3;if(t<60)return t.toFixed(1)+"s";return(t/60).toFixed(1)+"m"},Te=(e,t)=>{const n=t.getTime()-e.getTime();return"+"+Ee(n)},Re=e=>{switch(e){case"tool":case"tool_result":case"tool_usage":return"\u{1f527}";case"llm":return"\u{1f916}";case"agent_start":case"task_start":case"started":return"\u25b6\ufe0f";case"agent_complete":case"task_complete":case"completed":return"\u2705";case"agent_output":case"agent_execution":return"\u{1f4dd}";case"agent_processing":return"\u2699\ufe0f";case"memory_operation":return"\u{1f4be}";case"knowledge_operation":return"\u{1f4da}";case"crew_started":return"\u{1f680}";case"crew_completed":return"\u{1f3c1}";default:return"\u2022"}},ze=e=>{if(!e)return"No output available";if("string"===typeof e){if(e.includes("ToolResult")){const n=e.match(/result="([^"]+)"/);if(n)try{const e=JSON.parse(n[1].replace(/'/g,'"'));return JSON.stringify(e,null,2)}catch(t){return e}}return e}return JSON.stringify(e,null,2)};return c?(0,ue.jsxs)(ue.Fragment,{children:[(0,ue.jsxs)(I.A,{open:c,onClose:d,maxWidth:"lg",fullWidth:!0,PaperProps:{sx:{minHeight:"80vh",maxHeight:"90vh"}},children:[(0,ue.jsx)(O.A,{sx:{m:0,p:2},children:(0,ue.jsxs)(i.A,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,ue.jsxs)(i.A,{sx:{display:"flex",alignItems:"center",gap:1},children:[(0,ue.jsx)(W.A,{variant:"h6",children:"Execution Trace Timeline"}),be&&(0,ue.jsx)(f.A,{title:"Refreshing...",children:(0,ue.jsx)(Q.A,{sx:{fontSize:20,color:"primary.main",animation:"spin 1s linear infinite","@keyframes spin":{"0%":{transform:"rotate(0deg)"},"100%":{transform:"rotate(360deg)"}}}})}),(0,ue.jsx)(f.A,{title:null!=p&&p.status&&["completed","failed","cancelled","stopped","error"].includes(p.status.toLowerCase())?"Refresh now (auto-refresh disabled - execution completed)":"Refresh now (auto-refreshes every 5s)",children:(0,ue.jsx)(y.A,{size:"small",onClick:()=>Ce(!1),disabled:be||k,sx:{ml:.5},children:(0,ue.jsx)(Q.A,{fontSize:"small"})})})]}),(0,ue.jsxs)(i.A,{sx:{display:"flex",gap:1,alignItems:"center"},children:[x&&p&&(0,ue.jsxs)(ue.Fragment,{children:[(0,ue.jsx)(f.A,{title:g("runHistory.actions.viewResult"),children:(0,ue.jsx)("span",{children:(0,ue.jsx)(y.A,{size:"small",onClick:()=>{h&&p&&b(p)},color:"primary",disabled:["running","pending","queued","in_progress"].includes((null==p||null==(t=p.status)?void 0:t.toLowerCase())||""),children:(0,ue.jsx)(E.A,{fontSize:"small"})})})}),(0,ue.jsx)(f.A,{title:"MLflow Trace",children:(0,ue.jsx)("span",{children:(0,ue.jsx)(y.A,{size:"small",onClick:async()=>{const e=await(async()=>{if(!p)return"#";try{var e;const t=await X.Ay.get("/mlflow/trace-link",{params:{job_id:p.job_id}}),n=null==t||null==(e=t.data)?void 0:e.url;if(n)return n}catch(o){}try{let e,a,i,l="";try{var t,n;const r=await X.Ay.get("/databricks/environment");e=(null==r||null==(t=r.data)?void 0:t.workspace_id)||void 0;const s=null==r||null==(n=r.data)?void 0:n.databricks_host;!l&&s&&(l=s.startsWith("http")?s:"https://"+s)}catch(o){}if(!l||"compute"===l||!l.includes("."))if("undefined"!==typeof window&&window.location.hostname.includes("databricks"))l="https://"+window.location.hostname;else try{var r;l=(null==(r=(await X.Ay.get("/databricks/workspace-url")).data)?void 0:r.workspace_url)||""}catch(o){}if(!l)return"#";l.endsWith("/")&&(l=l.slice(0,-1)),l.startsWith("http")||(l="https://"+l);try{var s;const e=await X.Ay.get("/mlflow/experiment-info");a=(null==e||null==(s=e.data)?void 0:s.experiment_id)||void 0}catch(o){}if(!a)return Se();if(p.mlflow_trace_id&&(i=p.mlflow_trace_id),i){const t=e?"?o="+encodeURIComponent(e):"",n="&selectedEvaluationId="+encodeURIComponent(i);return l+"/ml/experiments/"+encodeURIComponent(a)+"/traces"+t+n}return Se()}catch(a){return Se()}})();e&&"#"!==e&&window.open(e,"_blank","noopener")},color:"primary",disabled:["running","pending","queued","in_progress"].includes((null==p||null==(n=p.status)?void 0:n.toLowerCase())||""),children:(0,ue.jsx)(G.A,{fontSize:"small"})})})}),(0,ue.jsx)(f.A,{title:g("runHistory.actions.viewLogs"),children:(0,ue.jsx)("span",{children:(0,ue.jsx)(y.A,{size:"small",onClick:async()=>{if(p){pe(!0),xe(!0),ye(null);try{const e=(await ie.m.getHistoricalLogs(p.job_id)).map(e=>({id:e.id,output:e.output,content:e.content,timestamp:e.timestamp,logType:e.type}));me(e)}catch(_){ye("Failed to fetch logs")}finally{xe(!1)}}},color:"primary",disabled:["running","pending","queued","in_progress"].includes((null==p||null==(r=p.status)?void 0:r.toLowerCase())||""),children:(0,ue.jsx)($.A,{fontSize:"small"})})})}),(0,ue.jsx)(F.A,{orientation:"vertical",flexItem:!0,sx:{mx:1}}),(0,ue.jsx)(N.A,{size:"small",variant:"outlined",startIcon:we?(0,ue.jsx)(a.A,{size:16}):(0,ue.jsx)(Z.A,{fontSize:"small"}),onClick:async()=>{if(p&&!we){ke(!0);try{var e,t;const a=await X.Ay.post("/mlflow/evaluate",{job_id:p.job_id}),i=null==a||null==(e=a.data)?void 0:e.run_id,l=null==a||null==(t=a.data)?void 0:t.experiment_id;if(!i||!l)return void C("MLflow evaluation did not start or returned no run information. Please check backend logs.");let c,d="";try{var n,r;const e=await X.Ay.get("/databricks/environment");c=(null==e||null==(n=e.data)?void 0:n.workspace_id)||void 0;const t=null==e||null==(r=e.data)?void 0:r.databricks_host;!d&&t&&(d=t.startsWith("http")?t:"https://"+t)}catch(o){}if(!d||"compute"===d||!d.includes("."))if("undefined"!==typeof window&&window.location.hostname.includes("databricks"))d="https://"+window.location.hostname;else try{var s;d=(null==(s=(await X.Ay.get("/databricks/workspace-url")).data)?void 0:s.workspace_url)||""}catch(o){}if(!d)return void C("Could not determine Databricks workspace URL to open evaluation run.");d.endsWith("/")&&(d=d.slice(0,-1)),d.startsWith("http")||(d="https://"+d);const u=c?"?o="+encodeURIComponent(c):"",h=d+"/ml/experiments/"+encodeURIComponent(l)+"/runs/"+encodeURIComponent(i)+u;window.open(h,"_blank","noopener")}catch(o){C("Failed to trigger MLflow evaluation. Please check backend logs.")}finally{ke(!1)}}},color:"primary",disabled:we||!ve||["running","pending","queued","in_progress"].includes((null==p||null==(l=p.status)?void 0:l.toLowerCase())||""),children:we?"Running Evaluation...":"Run MLflow Evaluation"}),(0,ue.jsx)(F.A,{orientation:"vertical",flexItem:!0,sx:{mx:1}})]}),(0,ue.jsx)(y.A,{"aria-label":"close",onClick:d,sx:{color:e=>e.palette.grey[500]},children:(0,ue.jsx)(B.A,{})})]})]})}),(0,ue.jsx)(M.A,{dividers:!0,sx:{p:0},children:k?(0,ue.jsx)(i.A,{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"400px",children:(0,ue.jsx)(a.A,{})}):_?(0,ue.jsx)(i.A,{sx:{p:3,textAlign:"center"},children:(0,ue.jsx)(W.A,{color:"error",children:_})}):A&&A.agents.length>0?(0,ue.jsxs)(i.A,{sx:{p:2},children:[A.globalEvents.start.map((e,t)=>(0,ue.jsxs)(i.A,{sx:{mb:2,display:"flex",alignItems:"center",gap:1},children:[(0,ue.jsx)(K.A,{color:"primary"}),(0,ue.jsx)(W.A,{variant:"body2",color:"text.secondary",children:e.event_type.replace(/_/g," ").toUpperCase()}),(0,ue.jsx)(W.A,{variant:"caption",color:"text.secondary",children:new Date(e.created_at).toLocaleTimeString()})]},t)),A.agents.map((e,t)=>(0,ue.jsxs)(H.A,{sx:{mb:2,overflow:"hidden"},children:[(0,ue.jsxs)(i.A,{sx:{p:2,bgcolor:"grey.100",display:"flex",alignItems:"center",justifyContent:"space-between",cursor:"pointer","&:hover":{bgcolor:"grey.200"}},onClick:()=>(e=>{const t=new Set(T);t.has(e)?t.delete(e):t.add(e),R(t)})(t),children:[(0,ue.jsxs)(i.A,{sx:{display:"flex",alignItems:"center",gap:2},children:[(0,ue.jsx)(y.A,{size:"small",children:T.has(t)?(0,ue.jsx)(Y.A,{}):(0,ue.jsx)(J.A,{})}),(0,ue.jsx)(W.A,{variant:"subtitle1",fontWeight:"bold",children:e.agent}),(0,ue.jsx)(o.A,{size:"small",label:Ee(e.duration),icon:(0,ue.jsx)(z.A,{})}),A.globalStart&&(0,ue.jsxs)(W.A,{variant:"caption",color:"text.secondary",children:["(",Te(A.globalStart,e.endTime),")"]})]}),(0,ue.jsxs)(W.A,{variant:"body2",color:"text.secondary",children:[e.tasks.length," task",1!==e.tasks.length?"s":""]})]}),(0,ue.jsx)(P.A,{in:T.has(t),children:(0,ue.jsx)(i.A,{sx:{pl:6,pr:2,py:1},children:e.tasks.map((e,n)=>{const r=t+"-"+n;return(0,ue.jsxs)(i.A,{sx:{mb:2},children:[(0,ue.jsxs)(i.A,{sx:{display:"flex",alignItems:"center",gap:1,p:1,bgcolor:"grey.50",borderRadius:1,cursor:"pointer","&:hover":{bgcolor:"grey.100"}},onClick:()=>(e=>{const t=new Set(L);t.has(e)?t.delete(e):t.add(e),D(t)})(r),children:[(0,ue.jsx)(y.A,{size:"small",children:L.has(r)?(0,ue.jsx)(Y.A,{}):(0,ue.jsx)(J.A,{})}),(0,ue.jsx)(W.A,{variant:"body2",fontWeight:"medium",children:e.taskName}),(0,ue.jsx)(o.A,{size:"small",label:Ee(e.duration),variant:"outlined"})]}),(0,ue.jsx)(P.A,{in:L.has(r),children:(0,ue.jsx)(i.A,{sx:{pl:4,mt:1},children:e.events.map((e,t)=>{const n=!!e.output&&("llm"===e.type||"agent_complete"===e.type||"agent_output"===e.type||"tool_result"===e.type||"task_complete"===e.type||"memory_operation"===e.type||"tool_usage"===e.type||"knowledge_operation"===e.type||"agent_execution"===e.type||e.type.includes("memory")||e.type.includes("tool")||e.type.includes("knowledge"));return(0,ue.jsxs)(i.A,{sx:{display:"flex",alignItems:"center",gap:1,py:.5,borderLeft:"2px solid",borderColor:"grey.300",pl:2,ml:1,position:"relative",cursor:n?"pointer":"default","&:hover":{bgcolor:n?"action.hover":"transparent","& .output-hint":{opacity:1},"& .click-hint":{visibility:"visible"}}},onClick:()=>n&&(e=>{ne(e)})(e),children:[(0,ue.jsx)(W.A,{variant:"caption",sx:{minWidth:60},children:A.globalStart&&Te(A.globalStart,e.timestamp)}),(0,ue.jsx)(W.A,{variant:"body2",sx:{minWidth:20},children:Re(e.type)}),(0,ue.jsx)(W.A,{variant:"body2",sx:{flex:1,color:n?"primary.main":"text.primary",textDecoration:n?"underline dotted":"none",textUnderlineOffset:"3px"},children:e.description}),e.duration&&(0,ue.jsx)(o.A,{size:"small",label:Ee(e.duration),sx:{height:20}}),n&&(0,ue.jsxs)(ue.Fragment,{children:[(0,ue.jsx)(o.A,{className:"output-hint",size:"small",label:"View",sx:{height:18,fontSize:"0.65rem",bgcolor:"primary.main",color:"white",opacity:.7,transition:"opacity 0.2s","& .MuiChip-label":{px:.5}}}),(0,ue.jsx)(W.A,{className:"click-hint",variant:"caption",sx:{position:"absolute",right:-10,top:"50%",transform:"translateY(-50%)",bgcolor:"grey.900",color:"white",px:1,py:.5,borderRadius:1,fontSize:"0.7rem",visibility:"hidden",zIndex:1e3,whiteSpace:"nowrap","&::before":{content:'""',position:"absolute",left:-4,top:"50%",transform:"translateY(-50%)",width:0,height:0,borderTop:"4px solid transparent",borderBottom:"4px solid transparent",borderRight:"4px solid",borderRightColor:"grey.900"}},children:"Click to view output"})]})]},t)})})})]},n)})})})]},t)),A.globalEvents.end.map((e,t)=>(0,ue.jsxs)(i.A,{sx:{mt:2,display:"flex",alignItems:"center",gap:1},children:[(0,ue.jsx)(V.A,{color:"success"}),(0,ue.jsx)(W.A,{variant:"body2",color:"text.secondary",children:e.event_type.replace(/_/g," ").toUpperCase()}),(0,ue.jsx)(W.A,{variant:"caption",color:"text.secondary",children:new Date(e.created_at).toLocaleTimeString()}),A.totalDuration&&(0,ue.jsx)(o.A,{size:"small",label:"Total: "+Ee(A.totalDuration),color:"primary"})]},t))]}):(0,ue.jsx)(i.A,{sx:{p:3,textAlign:"center"},children:(0,ue.jsx)(W.A,{children:"No trace data available"})})}),(0,ue.jsx)(I.A,{open:!!te,onClose:()=>ne(null),maxWidth:"md",fullWidth:!0,children:te&&(0,ue.jsxs)(ue.Fragment,{children:[(0,ue.jsxs)(O.A,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,ue.jsxs)(i.A,{children:[(0,ue.jsx)(W.A,{variant:"h6",children:te.description}),(0,ue.jsxs)(W.A,{variant:"caption",color:"text.secondary",children:["Event Type: ",te.type]})]}),(0,ue.jsx)(y.A,{onClick:()=>ne(null),size:"small",children:(0,ue.jsx)(B.A,{})})]}),(0,ue.jsx)(M.A,{dividers:!0,children:(0,ue.jsxs)(i.A,{sx:{position:"relative"},children:["memory_operation"===te.type||te.type.includes("memory")?(0,ue.jsxs)(i.A,{children:[(0,ue.jsx)(W.A,{variant:"subtitle2",gutterBottom:!0,children:"Memory Operation Details"}),"object"===typeof te.output&&te.output&&(0,ue.jsxs)(i.A,{sx:{mb:2},children:["operation"in te.output&&(0,ue.jsx)(o.A,{label:"Operation: "+te.output.operation,sx:{mr:1,mb:1},size:"small",color:"primary"}),"memory_type"in te.output&&(0,ue.jsx)(o.A,{label:"Type: "+te.output.memory_type,sx:{mr:1,mb:1},size:"small",color:"secondary"})]})]}):null,"tool_usage"===te.type||"tool_result"===te.type?(0,ue.jsxs)(i.A,{children:[(0,ue.jsx)(W.A,{variant:"subtitle2",gutterBottom:!0,children:"Tool Usage Details"}),"object"===typeof te.output&&te.output&&(0,ue.jsx)(i.A,{sx:{mb:2},children:"tool_name"in te.output&&(0,ue.jsx)(o.A,{label:"Tool: "+te.output.tool_name,sx:{mr:1,mb:1},size:"small",color:"info"})})]}):null,(0,ue.jsx)(H.A,{sx:{p:2,mt:1,backgroundColor:e=>"dark"===e.palette.mode?"grey.900":"grey.50",maxHeight:"60vh",overflow:"auto","& pre":{overflowX:"auto",padding:1,borderRadius:1,backgroundColor:e=>"dark"===e.palette.mode?"grey.800":"grey.100",fontFamily:"monospace",fontSize:"0.875rem"},"& code":{fontFamily:"monospace",fontSize:"0.875rem",backgroundColor:e=>"dark"===e.palette.mode?"grey.800":"grey.200",padding:"2px 4px",borderRadius:"3px"},"& p":{marginTop:1,marginBottom:1},"& ul, & ol":{paddingLeft:3,marginTop:1,marginBottom:1},"& li":{marginTop:.5,marginBottom:.5},"& blockquote":{borderLeft:"4px solid",borderColor:"primary.main",paddingLeft:2,marginLeft:0,marginTop:1,marginBottom:1,fontStyle:"italic",color:"text.secondary"},"& h1, & h2, & h3, & h4, & h5, & h6":{marginTop:2,marginBottom:1,fontWeight:"bold"},"& h1":{fontSize:"1.5rem"},"& h2":{fontSize:"1.3rem"},"& h3":{fontSize:"1.1rem"},"& h4":{fontSize:"1rem"},"& h5":{fontSize:"0.9rem"},"& h6":{fontSize:"0.85rem"},"& table":{width:"100%",borderCollapse:"collapse",marginTop:1,marginBottom:1},"& th, & td":{border:"1px solid",borderColor:"divider",padding:1,textAlign:"left"},"& th":{backgroundColor:e=>"dark"===e.palette.mode?"grey.800":"grey.200",fontWeight:"bold"},"& hr":{marginTop:2,marginBottom:2,border:"none",borderTop:"1px solid",borderColor:"divider"},"& a":{color:"primary.main",textDecoration:"none","&:hover":{textDecoration:"underline"}}},children:(0,ue.jsx)(ce.oz,{remarkPlugins:[de.A],children:ze(te.output)})})]})}),(0,ue.jsxs)(U.A,{children:[(0,ue.jsx)(N.A,{onClick:()=>{navigator.clipboard.writeText(ze(te.output))},startIcon:(0,ue.jsx)(q.A,{}),size:"small",children:"Copy Output"}),(0,ue.jsx)(N.A,{onClick:()=>ne(null),size:"small",children:"Close"})]})]})})]}),x&&p&&re&&(0,ue.jsx)(ae.A,{open:re,onClose:()=>pe(!1),logs:he,jobId:p.job_id,isConnecting:ge,connectionError:fe})]}):null};var he=n(14857),me=n(36080),ge=n(40038),xe=n(39919),fe=n(8808),ye=n(87899),be=n(7626),je=n(19221),ve=n(16702),Ae=n(2334),we=n(18655),ke=n(36314),Se=n(60783),_e=n(29201);_e.KQ.register({family:"Inter",fonts:[{src:"https://fonts.gstatic.com/s/inter/v12/UcCO3FwrK3iLTeHuS_fvQtMwCp50KnMw2boKoduKmMEVuLyfAZ9hjp-Ek-_EeA.woff"},{src:"https://fonts.gstatic.com/s/inter/v12/UcCO3FwrK3iLTeHuS_fvQtMwCp50KnMw2boKoduKmMEVuGKYAZ9hjp-Ek-_EeA.woff",fontWeight:600},{src:"https://fonts.gstatic.com/s/inter/v12/UcCO3FwrK3iLTeHuS_fvQtMwCp50KnMw2boKoduKmMEVuFuYAZ9hjp-Ek-_EeA.woff",fontWeight:700}]}),_e.KQ.register({family:"JetBrainsMono",src:"https://fonts.gstatic.com/s/jetbrainsmono/v13/tDbY2o-flEEny0FZhsfKu5WU4zr3E_BX0PnT8RD8yKxjPVmUsaaDhw.ttf"});const Ce=_e.vv.create({page:{padding:50,backgroundColor:"#ffffff",fontFamily:"Inter"},header:{backgroundColor:"#f8fafb",borderLeft:4,borderLeftColor:"#3b82f6",padding:25,marginBottom:30,borderRadius:8},headerTop:{flexDirection:"row",justifyContent:"space-between",alignItems:"center",marginBottom:15},logo:{width:40,height:40},title:{fontSize:28,marginBottom:12,color:"#111827",fontFamily:"Inter",fontWeight:700,letterSpacing:-.5},subtitle:{fontSize:14,marginBottom:6,color:"#6b7280",fontFamily:"Inter",fontWeight:400},statusBadge:{flexDirection:"row",alignItems:"center",backgroundColor:"#10b981",paddingHorizontal:12,paddingVertical:4,borderRadius:12,alignSelf:"flex-start"},statusText:{color:"#ffffff",fontSize:11,fontWeight:600,fontFamily:"Inter"},text:{fontSize:11,marginBottom:12,color:"#374151",fontFamily:"Inter",lineHeight:1.7},section:{marginBottom:25,paddingBottom:20,borderBottom:1,borderBottomColor:"#e5e7eb"},sectionTitle:{fontSize:16,marginBottom:12,color:"#111827",fontFamily:"Inter",fontWeight:600,borderLeft:3,borderLeftColor:"#3b82f6",paddingLeft:12},codeBlock:{backgroundColor:"#1e293b",color:"#e2e8f0",padding:15,borderRadius:6,marginBottom:12,fontFamily:"JetBrainsMono",fontSize:9,lineHeight:1.6},inlineCode:{backgroundColor:"#f3f4f6",color:"#dc2626",paddingHorizontal:4,paddingVertical:1,borderRadius:3,fontFamily:"JetBrainsMono",fontSize:10},list:{marginLeft:24,marginBottom:12},listItem:{fontSize:11,marginBottom:6,color:"#374151",fontFamily:"Inter",flexDirection:"row"},listBullet:{width:20,fontSize:11,color:"#3b82f6"},link:{color:"#2563eb",textDecoration:"underline"},strong:{fontWeight:600,color:"#111827"},emphasis:{fontStyle:"italic",color:"#4b5563"},blockquote:{borderLeft:3,borderLeftColor:"#d1d5db",paddingLeft:15,marginLeft:0,marginBottom:12,fontStyle:"italic",color:"#6b7280"},table:{marginBottom:15},tableRow:{flexDirection:"row",borderBottom:1,borderBottomColor:"#e5e7eb"},tableHeader:{backgroundColor:"#f9fafb",paddingVertical:8,paddingHorizontal:10,fontWeight:600,fontSize:10,color:"#111827"},tableCell:{paddingVertical:8,paddingHorizontal:10,fontSize:10,color:"#374151"},footer:{position:"absolute",bottom:30,left:50,right:50,paddingTop:15,borderTop:1,borderTopColor:"#e5e7eb",flexDirection:"row",justifyContent:"space-between"},footerText:{fontSize:9,color:"#9ca3af",fontFamily:"Inter"},pageNumber:{fontSize:9,color:"#9ca3af",fontFamily:"Inter"}}),Ee=e=>{const t=e.split("\n"),n=[];let r=[];const s=()=>{if(r.length>0){const e=r.join(" ").trim();e&&n.push((0,ue.jsx)(_e.EY,{style:Ce.text,children:Te(e)},n.length)),r=[]}};let o=0;for(;o<t.length;){const e=t[o],a=e.trim();if(a){if(a.startsWith("#")){s();const e=a.replace(/^#+\s*/,"").trim(),t=(a.match(/^#+/)||[""])[0].length;let r;r=1===t?Object.assign({},Ce.sectionTitle,{fontSize:16,marginTop:20,marginBottom:10}):2===t?Object.assign({},Ce.sectionTitle,{fontSize:14,marginTop:15,marginBottom:8}):Object.assign({},Ce.text,{fontWeight:600,marginTop:10,marginBottom:5}),n.push((0,ue.jsx)(_e.EY,{style:r,children:Te(e)},n.length)),o++;continue}if(a.match(/^\d+\.\s+/)){s();const e=o,r=[];for(;o<t.length;){const n=t[o].trim(),s=n.match(/^(\d+)\.\s+(.+)/);if(s)r.push({number:s[1],content:Te(s[2])}),o++;else{if(!(n&&o>e&&t[o].startsWith("  ")))break;r.length>0&&(r[r.length-1].content+=" "+Te(n)),o++}}r.length>0&&n.push((0,ue.jsx)(_e.Ss,{style:Ce.list,children:r.map((e,t)=>(0,ue.jsxs)(_e.Ss,{style:Ce.listItem,children:[(0,ue.jsxs)(_e.EY,{style:Object.assign({},Ce.listBullet,{minWidth:25}),children:[e.number,"."]}),(0,ue.jsx)(_e.EY,{style:Object.assign({},Ce.text,{flex:1}),children:e.content})]},t))},n.length));continue}if(a.match(/^[-*+]\s+/)){s();const e=[];for(;o<t.length;){const n=t[o].trim(),r=n.match(/^[-*+]\s+(.+)/);if(r)e.push(Te(r[1])),o++;else{if(!n||!t[o].startsWith("  "))break;e.length>0&&(e[e.length-1]+=" "+Te(n)),o++}}e.length>0&&n.push((0,ue.jsx)(_e.Ss,{style:Ce.list,children:e.map((e,t)=>(0,ue.jsxs)(_e.Ss,{style:Ce.listItem,children:[(0,ue.jsx)(_e.EY,{style:Ce.listBullet,children:"\u2022"}),(0,ue.jsx)(_e.EY,{style:Object.assign({},Ce.text,{flex:1}),children:e})]},t))},n.length));continue}if(e.startsWith("  ")||e.startsWith("\t")){s();const e=[];for(;o<t.length&&(t[o].startsWith("  ")||t[o].startsWith("\t"));)e.push(t[o].replace(/^( {2}|\t)/,"")),o++;e.length>0&&n.push((0,ue.jsx)(_e.Ss,{style:Ce.codeBlock,children:(0,ue.jsx)(_e.EY,{style:{color:"#e2e8f0",fontFamily:"JetBrainsMono",fontSize:9},children:e.join("\n")})},n.length));continue}if(a.startsWith(">")){s();const e=[];for(;o<t.length&&t[o].trim().startsWith(">");)e.push(t[o].trim().substring(1).trim()),o++;n.push((0,ue.jsx)(_e.Ss,{style:Ce.blockquote,children:(0,ue.jsx)(_e.EY,{style:Object.assign({},Ce.text,{color:"#6b7280",fontStyle:"italic"}),children:e.join(" ")})},n.length));continue}a.match(/^(-{3,}|\*{3,}|_{3,})$/)?(s(),n.push((0,ue.jsx)(_e.Ss,{style:{borderBottom:1,borderBottomColor:"#e5e7eb",marginVertical:15}},n.length)),o++):(r.push(a),o++)}else s(),o++}return s(),(0,ue.jsx)(_e.Ss,{children:n})},Te=e=>e=(e=(e=(e=(e=(e=(e=e.replace(/\*\*([^*]+)\*\*/g,"$1")).replace(/__([^_]+)__/g,"$1")).replace(/(?<!\*)\*(?!\*)([^*]+)(?<!\*)\*(?!\*)/g,"$1")).replace(/(?<!_)_(?!_)([^_]+)(?<!_)_(?!_)/g,"$1")).replace(/`([^`]+)`/g,"$1")).replace(/\[([^\]]+)\]\([^)]+\)/g,"$1")).replace(/\\([*_`[\]()])/g,"$1"),Re=e=>e.replace(/_/g," ").replace(/([A-Z])/g," $1").trim().split(" ").map(e=>e.charAt(0).toUpperCase()+e.slice(1).toLowerCase()).join(" "),ze=function(e,t){if(void 0===t&&(t=0),!e)return(0,ue.jsx)(_e.Ss,{style:{padding:20,backgroundColor:"#f9fafb",borderRadius:6},children:(0,ue.jsx)(_e.EY,{style:Object.assign({},Ce.text,{color:"#9ca3af",textAlign:"center"}),children:"No results available"})});if("string"===typeof e)try{const n=JSON.parse(e);return ze(n,t)}catch(n){return Ee(e)}if(Array.isArray(e))return(0,ue.jsx)(_e.Ss,{children:e.map((e,n)=>(0,ue.jsxs)(_e.Ss,{style:{marginBottom:10},children:[(0,ue.jsx)(_e.Ss,{style:{flexDirection:"row",alignItems:"center",marginBottom:5},children:(0,ue.jsx)(_e.Ss,{style:{width:24,height:24,backgroundColor:"#3b82f6",borderRadius:12,alignItems:"center",justifyContent:"center",marginRight:8},children:(0,ue.jsx)(_e.EY,{style:{color:"#ffffff",fontSize:10,fontWeight:600},children:n+1})})}),ze(e,t+1)]},n))});if("object"===typeof e&&null!==e){if("data"in e&&e.data)return ze(e.data,t);const n=Object.entries(e).filter(e=>{let[t]=e;return!["_id","__v","createdAt","updatedAt"].includes(t)});return 0===n.length?(0,ue.jsx)(_e.EY,{style:Ce.text,children:"Empty object"}):(0,ue.jsx)(_e.Ss,{children:n.map(e=>{let[n,r]=e;const s="object"===typeof r&&null!==r;return(0,ue.jsxs)(_e.Ss,{style:{marginBottom:15},children:[0===t?(0,ue.jsx)(_e.EY,{style:Ce.sectionTitle,children:Re(n)}):(0,ue.jsxs)(_e.EY,{style:Object.assign({},Ce.text,{fontWeight:600,marginBottom:5}),children:[Re(n),":"]}),"string"===typeof r?Ee(r):s?(0,ue.jsx)(_e.Ss,{style:{paddingLeft:t>0?15:0},children:ze(r,t+1)}):(0,ue.jsx)(_e.EY,{style:Ce.text,children:String(r)})]},n)})})}return(0,ue.jsx)(_e.EY,{style:Ce.text,children:String(e)})},Le=e=>{var t,n;let{run:r}=e;const s=(e=>{switch(null==e?void 0:e.toLowerCase()){case"completed":case"success":return"#10b981";case"failed":case"error":return"#ef4444";case"running":case"in_progress":return"#3b82f6";case"pending":case"queued":return"#f59e0b";default:return"#6b7280"}})(r.status),o=(new Date).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"});return(0,ue.jsx)(_e.yo,{children:(0,ue.jsxs)(_e.YW,{size:"A4",style:Ce.page,children:[(0,ue.jsxs)(_e.Ss,{style:Ce.header,children:[(0,ue.jsxs)(_e.Ss,{style:Ce.headerTop,children:[(0,ue.jsx)(_e.Ss,{style:{flex:1},children:(0,ue.jsx)(_e.EY,{style:Ce.title,children:r.run_name})}),(0,ue.jsxs)(_e.BS,{width:"40",height:"40",viewBox:"0 0 40 40",children:[(0,ue.jsx)(_e.wA,{d:"M20 5 L35 15 L35 25 L20 35 L5 25 L5 15 Z",fill:"#3b82f6",opacity:"0.1"}),(0,ue.jsx)(_e.wA,{d:"M20 10 L30 17 L30 23 L20 30 L10 23 L10 17 Z",fill:"#3b82f6"})]})]}),(0,ue.jsxs)(_e.Ss,{style:{marginTop:12},children:[(0,ue.jsx)(_e.EY,{style:Ce.subtitle,children:new Date(r.created_at).toLocaleDateString("en-US",{weekday:"long",year:"numeric",month:"long",day:"numeric"})}),r.completed_at&&"completed"!==(null==(t=r.status)?void 0:t.toLowerCase())&&(0,ue.jsx)(_e.Ss,{style:{flexDirection:"row",alignItems:"center",marginTop:8},children:(0,ue.jsx)(_e.Ss,{style:Object.assign({},Ce.statusBadge,{backgroundColor:s}),children:(0,ue.jsx)(_e.EY,{style:Ce.statusText,children:(null==(n=r.status)?void 0:n.toUpperCase())||"UNKNOWN"})})})]})]}),(0,ue.jsx)(_e.Ss,{style:{marginTop:20,flex:1},children:ze(r.result)}),(0,ue.jsxs)(_e.Ss,{style:Ce.footer,children:[(0,ue.jsxs)(_e.EY,{style:Ce.footerText,children:["Generated on ",o]}),(0,ue.jsx)(_e.EY,{style:Ce.pageNumber,children:"Page 1"})]})]})})},De=async e=>{try{const t=await(0,_e.x8)((0,ue.jsx)(Le,{run:e})).toBlob(),n=URL.createObjectURL(t),r=document.createElement("a");r.href=n;const s=e.run_name.replace(/[^a-z0-9]/gi,"_").toLowerCase(),o=(new Date).toISOString().split("T")[0];r.download=s+"_"+o+"_"+e.job_id+".pdf",document.body.appendChild(r),r.click(),document.body.removeChild(r),URL.revokeObjectURL(n)}catch(t){throw t}};var Ie=n(27721);const Oe=["node","children","href"],We=["node","children","href"],Fe=(0,s.memo)(e=>{let{open:t,onClose:n,result:o,run:a}=e;const l=(0,he.A)(),[c,d]=(0,s.useState)(!1),[u,p]=(0,s.useState)("code"),[h,m]=(0,s.useState)(!1),[g,x]=(0,s.useState)(null),b=(0,s.useRef)(null),j=(0,s.useRef)(!1),v=(0,s.useCallback)(async e=>{try{if(!a)return;const e=Ie.O.getInstance(),n=await e.getDatabricksConfig();if(!n)return;let r;try{const t=await e.getDatabricksEnvironment();t.databricks_host&&(r=t.databricks_host)}catch(t){}let s=null,o=!1;if(null!=a&&a.tasks_yaml)try{const e=null==a?void 0:a.tasks_yaml;if(/callback_config:\s*["']?DatabricksVolumeCallback/.test(e)){const t=/volume_path:\s*["']?([^"'\n]+)["']?/.exec(e);t&&t[1]?(s=t[1],o=!0):n.volume_enabled&&n.volume_path&&(s=n.volume_path,o=!0)}}catch(t){}if(!o&&n.volume_enabled&&n.volume_path&&(s=n.volume_path,o=!0),o&&s){const e=(null==a?void 0:a.run_name)||(null==a?void 0:a.job_id)||"unknown",t="/Volumes/"+s.replace(/\./g,"/")+"/"+e;x({path:t,workspaceUrl:r})}}catch(t){}},[a]);(0,s.useEffect)(()=>{if(t&&(j.current=!0,o)){const e=JSON.stringify(o);/<[^>]*>/.test(e)||e.includes("<!DOCTYPE")||e.includes("<html")?p("html"):p("code"),v(o)}},[t,o,v]);const A=/(https?:\/\/[^\s]+)/g,w=(0,s.useMemo)(()=>{if(!o)return!1;const e=JSON.stringify(o);return/<[^>]*>/.test(e)||e.includes("<!DOCTYPE")||e.includes("<html")},[o]),k=(0,s.useMemo)(()=>o||{},[o]);(0,s.useEffect)(()=>{const e=()=>{m(!!document.fullscreenElement)};return document.addEventListener("fullscreenchange",e),document.addEventListener("webkitfullscreenchange",e),document.addEventListener("mozfullscreenchange",e),document.addEventListener("MSFullscreenChange",e),()=>{document.removeEventListener("fullscreenchange",e),document.removeEventListener("webkitfullscreenchange",e),document.removeEventListener("mozfullscreenchange",e),document.removeEventListener("MSFullscreenChange",e)}},[]);const S=e=>"object"===typeof e&&null!==e?JSON.stringify(e,null,2):String(null!=e?e:""),_=e=>e.split(A).map((e,t)=>e.match(A)?(0,ue.jsx)(i.A,{sx:{display:"inline-flex",alignItems:"center",gap:.5},children:(0,ue.jsxs)(me.A,{href:e,target:"_blank",rel:"noopener noreferrer",sx:{display:"inline-flex",alignItems:"center",gap:.5,color:"primary.main",textDecoration:"none","&:hover":{textDecoration:"underline"}},children:[e,(0,ue.jsx)(fe.A,{sx:{fontSize:16}})]})},t):e),C=e=>[/^#+ /m,/\*\*.+\*\*/,/_.+_/,/\[.+\]\(.+\)/,/^\s*[-*+]\s/m,/^\s*\d+\.\s/m,/```[\s\S]*```/,/^\s*>/m].some(t=>t.test(e)),E=e=>{if(e.match(/^```(html|HTML)\s*\n[\s\S]*\n```\s*$/))return!0;return[/<\/?[a-z][\s\S]*>/i,/<!DOCTYPE\s+html/i,/<html[^>]*>/i,/<body[^>]*>/i,/<div[^>]*>/i,/<p[^>]*>/i,/<h[1-6][^>]*>/i,/<table[^>]*>/i].some(t=>t.test(e))},T=(0,s.memo)(function(e){let{html:t,isFullscreen:n=!1}=e;const r=(0,s.useRef)(null),o=(0,s.useRef)(!1),a=(0,s.useRef)(""),c=(0,s.useRef)(""),d=(e=>{let t=e;return t.match(/^```(html|HTML)\s*\n/)&&(t=t.replace(/^```(html|HTML)\s*\n/,""),t=t.replace(/\n```\s*$/,"")),t})(t),u=(e=>{const t=e.substring(0,100);let n=0;for(let r=0;r<t.length;r++)n=(n<<5)-n+t.charCodeAt(r),n&=n;return n.toString()})(d),p=a.current!==u;return p&&(a.current=u,o.current=!1),(0,s.useEffect)(()=>{if(!r.current)return;const e=r.current;if(!p&&o.current)return;if(c.current===d&&o.current)return;o.current=!0,c.current=d;let t=d;const n="\n        <script>\n          // Polyfill for History API in sandboxed iframe\n          (function() {\n            // Store the original methods if they exist\n            const originalPushState = window.history.pushState;\n            const originalReplaceState = window.history.replaceState;\n\n            // Override history methods to prevent errors in sandboxed context\n            try {\n              window.history.pushState = function(state, title, url) {\n                try {\n                  // Try to call the original method\n                  return originalPushState.apply(window.history, arguments);\n                } catch (e) {\n                  // Silently fail if not allowed in sandbox\n                  console.debug('pushState blocked in sandbox:', e.message);\n                }\n              };\n\n              window.history.replaceState = function(state, title, url) {\n                try {\n                  // Try to call the original method\n                  return originalReplaceState.apply(window.history, arguments);\n                } catch (e) {\n                  // Silently fail if not allowed in sandbox\n                  console.debug('replaceState blocked in sandbox:', e.message);\n                }\n              };\n\n              // Also handle popstate events that might cause issues\n              window.addEventListener('error', function(e) {\n                if (e.message && e.message.includes('history')) {\n                  e.preventDefault();\n                  console.debug('History-related error prevented:', e.message);\n                }\n              }, true);\n            } catch (e) {\n              // Even the override might fail in some strict contexts\n              console.debug('Could not override history methods:', e.message);\n            }\n\n            // For libraries that check for history API support\n            if (!window.history.state) {\n              try {\n                Object.defineProperty(window.history, 'state', {\n                  get: function() { return null; },\n                  configurable: true\n                });\n              } catch (e) {\n                // Ignore if we can't define the property\n              }\n            }\n\n            // Handle location.hash for navigation-based libraries\n            let virtualHash = '';\n            try {\n              Object.defineProperty(window.location, 'hash', {\n                get: function() { return virtualHash; },\n                set: function(value) {\n                  virtualHash = value;\n                  // Trigger hashchange event for libraries that listen to it\n                  window.dispatchEvent(new HashChangeEvent('hashchange'));\n                },\n                configurable: true\n              });\n            } catch (e) {\n              // If we can't override location.hash, that's okay\n            }\n          })();\n        <\/script>\n        <style>\n          /* Responsive scaling for iframe content */\n          html, body {\n            margin: 0 !important;\n            padding: 0 !important;\n            width: 100% !important;\n            height: 100% !important;\n            overflow: auto !important;\n          }\n\n          /* Ensure content fits viewport */\n          body > *:first-child:not(script):not(style) {\n            max-width: 100% !important;\n            max-height: 100vh !important;\n          }\n        </style>\n        <script>\n          // Basic iframe initialization - no library-specific code\n          (function() {\n            // Ensure iframe content is properly sized\n            if (document.readyState === 'complete' || document.readyState === 'interactive') {\n              // Content already loaded\n              if (document.body) {\n                document.body.style.margin = '0';\n                document.body.style.padding = '0';\n              }\n            } else {\n              // Wait for content to load\n              window.addEventListener('DOMContentLoaded', function() {\n                if (document.body) {\n                  document.body.style.margin = '0';\n                  document.body.style.padding = '0';\n                }\n              });\n            }\n          })();\n        <\/script>\n      ";t=t.includes("<head>")?t.replace("<head>","<head>"+n):t.includes("<html>")?t.replace("<html>","<html><head>"+n+"</head>"):n+t,e.srcdoc=t},[p,d]),(0,s.useEffect)(()=>{const e=r.current;if(!e)return;const t=()=>{try{var t;e.focus(),null==(t=e.contentWindow)||t.focus()}catch(n){}},n=window.setTimeout(t,0);return e.addEventListener("load",t),()=>{window.clearTimeout(n),e.removeEventListener("load",t)}},[p,d]),(0,ue.jsx)(i.A,{sx:{width:"100%",height:n?"calc(100vh - 80px)":"calc(80vh - 100px)",minHeight:"400px",maxHeight:n?"calc(100vh - 80px)":"calc(95vh - 120px)",border:"1px solid "+l.palette.divider,borderRadius:1,overflow:"hidden",display:"flex",flexDirection:"column"},children:(0,ue.jsx)("iframe",{ref:r,tabIndex:-1,onLoad:()=>{try{var e,t;null==(e=r.current)||e.focus(),null==(t=r.current)||null==(t=t.contentWindow)||t.focus()}catch(n){}},sandbox:"allow-scripts allow-forms allow-modals allow-popups allow-presentation allow-pointer-lock allow-downloads",allow:"accelerometer; camera; encrypted-media; fullscreen; gyroscope; magnetometer; microphone; midi; payment; usb; xr-spatial-tracking",style:{width:"100%",height:"100%",border:"none",backgroundColor:l.palette.background.paper},title:"Sandboxed HTML/JS Content"})})},(e,t)=>e.html.replace(/^```(html|HTML)\s*\n/,"").replace(/\n```\s*$/,"").trim()===t.html.replace(/^```(html|HTML)\s*\n/,"").replace(/\n```\s*$/,"").trim()&&e.isFullscreen===t.isFullscreen),R=e=>(0,ue.jsx)(H.A,{elevation:0,sx:{bgcolor:"light"===l.palette.mode?"grey.50":"grey.900",p:2.5,borderRadius:1.5,border:"1px solid",borderColor:"light"===l.palette.mode?"grey.200":"grey.800",transition:"all 0.2s ease-in-out","&:hover":{bgcolor:"light"===l.palette.mode?"grey.100":"grey.800",borderColor:"light"===l.palette.mode?"grey.300":"grey.700"}},children:"string"===typeof e&&E(e)&&"html"===u?(0,ue.jsx)(T,{html:e,isFullscreen:h}):"string"===typeof e&&C(e)&&!E(e)?(0,ue.jsx)(i.A,{sx:{"& .markdown-body":{fontFamily:l.typography.fontFamily,fontSize:"0.9rem",lineHeight:1.6,color:"light"===l.palette.mode?"rgba(0, 0, 0, 0.87)":"rgba(255, 255, 255, 0.87)","& h1, & h2, & h3, & h4, & h5, & h6":{color:l.palette.primary.main,fontWeight:600,marginTop:l.spacing(2),marginBottom:l.spacing(1)},"& p":{marginBottom:l.spacing(1.5)},"& ul, & ol":{paddingLeft:l.spacing(2.5),marginBottom:l.spacing(1.5)},"& li":{marginBottom:l.spacing(.5)},"& code":{backgroundColor:"light"===l.palette.mode?"rgba(0, 0, 0, 0.04)":"rgba(255, 255, 255, 0.1)",padding:l.spacing(.25,.5),borderRadius:4,fontSize:"0.85em"},"& pre":{backgroundColor:"light"===l.palette.mode?"rgba(0, 0, 0, 0.04)":"rgba(255, 255, 255, 0.1)",padding:l.spacing(1.5),borderRadius:4,overflow:"auto","& code":{backgroundColor:"transparent",padding:0}},"& blockquote":{borderLeft:"4px solid "+l.palette.primary.main,margin:0,padding:l.spacing(.5,2),backgroundColor:"light"===l.palette.mode?"rgba(0, 0, 0, 0.04)":"rgba(255, 255, 255, 0.1)"},"& a":{color:l.palette.primary.main,textDecoration:"none","&:hover":{textDecoration:"underline"}},"& table":{borderCollapse:"collapse",width:"100%",marginBottom:l.spacing(2)},"& th, & td":{border:"1px solid "+l.palette.divider,padding:l.spacing(.75,1)},"& th":{backgroundColor:"light"===l.palette.mode?"rgba(0, 0, 0, 0.04)":"rgba(255, 255, 255, 0.1)",fontWeight:600}}},children:(0,ue.jsx)(ce.oz,{className:"markdown-body",remarkPlugins:[de.A],components:{a:e=>{let{children:t,href:n}=e,s=(0,r.A)(e,We);return(0,ue.jsxs)("a",Object.assign({href:n,target:"_blank",rel:"noopener noreferrer",style:{display:"inline-flex",alignItems:"center",gap:"4px",color:l.palette.primary.main,textDecoration:"none"},onMouseEnter:e=>{e.currentTarget.style.textDecoration="underline"},onMouseLeave:e=>{e.currentTarget.style.textDecoration="none"}},s,{children:[t,(0,ue.jsx)(fe.A,{sx:{fontSize:16}})]}))}},children:e})}):(0,ue.jsx)("pre",{style:{margin:0,whiteSpace:"pre-wrap",wordWrap:"break-word",fontFamily:'"Roboto Mono", monospace',fontSize:"0.9rem",lineHeight:1.6,color:"light"===l.palette.mode?"rgba(0, 0, 0, 0.87)":"rgba(255, 255, 255, 0.87)"},children:"string"===typeof e?_(e):S(e)})});return(0,ue.jsxs)(I.A,{ref:b,open:t,onClose:n,keepMounted:j.current,maxWidth:"html"===u&&Object.values(k||{}).some(e=>"string"===typeof e&&E(e))?"xl":"lg",fullWidth:!0,sx:{zIndex:e=>e.zIndex.modal+100},PaperProps:{sx:{maxHeight:h?"100vh":"95vh",borderRadius:h?0:2,width:"html"===u&&Object.values(k||{}).some(e=>"string"===typeof e&&E(e))?h?"100vw":"95vw":void 0,margin:h?0:void 0}},children:[(0,ue.jsxs)(O.A,{sx:{px:3,py:2,display:"flex",justifyContent:"space-between",alignItems:"center"},children:[Object.values(k||{}).some(e=>"string"===typeof e&&E(e))?(0,ue.jsxs)(ge.A,{value:u,exclusive:!0,onChange:(e,t)=>t&&p(t),size:"small",sx:{height:32},children:[(0,ue.jsxs)(xe.A,{value:"code","aria-label":"code view",children:[(0,ue.jsx)(be.A,{sx:{mr:.5,fontSize:18}}),"Code"]}),(0,ue.jsxs)(xe.A,{value:"html","aria-label":"html view",children:[(0,ue.jsx)(je.A,{sx:{mr:.5,fontSize:18}}),"HTML"]})]}):(0,ue.jsx)(i.A,{}),(0,ue.jsxs)(i.A,{sx:{display:"flex",gap:1},children:[(0,ue.jsx)(f.A,{title:h?"Exit fullscreen":"Fullscreen",children:(0,ue.jsx)(y.A,{onClick:async()=>{if(document.fullscreenElement)try{await document.exitFullscreen(),m(!1)}catch(t){}else try{var e;const t=null==(e=b.current)?void 0:e.querySelector(".MuiDialog-paper");t&&(await t.requestFullscreen(),m(!0))}catch(t){}},size:"small",sx:{color:"text.secondary",transition:"all 0.2s","&:hover":{color:"primary.main",backgroundColor:"action.hover"}},children:h?(0,ue.jsx)(Ae.A,{}):(0,ue.jsx)(ve.A,{})})}),(0,ue.jsx)(f.A,{title:c?"Copied!":"Copy to clipboard",children:(0,ue.jsx)(y.A,{onClick:async()=>{try{let e="";if("string"===typeof k)e=k;else if("object"===typeof k&&null!==k){const t=Object.entries(k);e=1===t.length&&"value"===t[0][0].toLowerCase()?String(t[0][1]):t.map(e=>{let[t,n]=e;return"string"===typeof n?t+":\n"+n:t+":\n"+JSON.stringify(n,null,2)}).join("\n\n")}else e=String(k);await navigator.clipboard.writeText(e),d(!0),setTimeout(()=>{d(!1)},2e3)}catch(e){d(!1)}},size:"small",sx:{color:c?"success.main":"text.secondary",transition:"all 0.2s","&:hover":{color:"primary.main",backgroundColor:"action.hover"}},children:c?(0,ue.jsx)(ye.A,{}):(0,ue.jsx)(q.A,{})})})]})]}),(0,ue.jsx)(M.A,{sx:{px:"html"===u&&Object.values(k||{}).some(e=>"string"===typeof e&&E(e))?1:3,py:"html"===u&&Object.values(k||{}).some(e=>"string"===typeof e&&E(e))?1:2,overflow:"auto",display:"flex",flexDirection:"column"},children:(0,ue.jsx)(i.A,{sx:{px:0,py:0,flexGrow:1,display:"flex",flexDirection:"column"},children:(e=>{if("object"===typeof e&&null!==e){const t=Object.entries(e);if(1===t.length&&"value"===t[0][0].toLowerCase()){const e=t[0][1];return R(e)}return t.map((t,n)=>{let[s,o]=t;return(0,ue.jsxs)(i.A,{sx:{mb:3},children:[(0,ue.jsx)(W.A,{variant:"subtitle1",sx:{color:"primary.main",fontWeight:700,mb:1,letterSpacing:"0.01em"},children:s}),(0,ue.jsx)(H.A,{elevation:0,sx:{bgcolor:"light"===l.palette.mode?"grey.50":"grey.900",p:2.5,borderRadius:1.5,border:"1px solid",borderColor:"light"===l.palette.mode?"grey.200":"grey.800",transition:"all 0.2s ease-in-out","&:hover":{bgcolor:"light"===l.palette.mode?"grey.100":"grey.800",borderColor:"light"===l.palette.mode?"grey.300":"grey.700"}},children:"string"===typeof o&&E(o)&&"html"===u?(0,ue.jsx)(T,{html:o,isFullscreen:h}):"string"===typeof o&&C(o)&&!E(o)?(0,ue.jsx)(i.A,{sx:{"& .markdown-body":{fontFamily:l.typography.fontFamily,fontSize:"0.9rem",lineHeight:1.6,color:"light"===l.palette.mode?"rgba(0, 0, 0, 0.87)":"rgba(255, 255, 255, 0.87)","& h1, & h2, & h3, & h4, & h5, & h6":{color:l.palette.primary.main,fontWeight:600,marginTop:l.spacing(2),marginBottom:l.spacing(1)},"& p":{marginBottom:l.spacing(1.5)},"& ul, & ol":{paddingLeft:l.spacing(2.5),marginBottom:l.spacing(1.5)},"& li":{marginBottom:l.spacing(.5)},"& code":{backgroundColor:"light"===l.palette.mode?"rgba(0, 0, 0, 0.04)":"rgba(255, 255, 255, 0.1)",padding:l.spacing(.25,.5),borderRadius:4,fontSize:"0.85em"},"& pre":{backgroundColor:"light"===l.palette.mode?"rgba(0, 0, 0, 0.04)":"rgba(255, 255, 255, 0.1)",padding:l.spacing(1.5),borderRadius:4,overflow:"auto","& code":{backgroundColor:"transparent",padding:0}},"& blockquote":{borderLeft:"4px solid "+l.palette.primary.main,margin:0,padding:l.spacing(.5,2),backgroundColor:"light"===l.palette.mode?"rgba(0, 0, 0, 0.04)":"rgba(255, 255, 255, 0.1)"},"& a":{color:l.palette.primary.main,textDecoration:"none","&:hover":{textDecoration:"underline"}},"& table":{borderCollapse:"collapse",width:"100%",marginBottom:l.spacing(2)},"& th, & td":{border:"1px solid "+l.palette.divider,padding:l.spacing(.75,1)},"& th":{backgroundColor:"light"===l.palette.mode?"rgba(0, 0, 0, 0.04)":"rgba(255, 255, 255, 0.1)",fontWeight:600}}},children:(0,ue.jsx)(ce.oz,{className:"markdown-body",remarkPlugins:[de.A],components:{a:e=>{let{children:t,href:n}=e,s=(0,r.A)(e,Oe);return(0,ue.jsxs)("a",Object.assign({href:n,target:"_blank",rel:"noopener noreferrer",style:{display:"inline-flex",alignItems:"center",gap:"4px",color:l.palette.primary.main,textDecoration:"none"},onMouseEnter:e=>{e.currentTarget.style.textDecoration="underline"},onMouseLeave:e=>{e.currentTarget.style.textDecoration="none"}},s,{children:[t,(0,ue.jsx)(fe.A,{sx:{fontSize:16}})]}))}},children:o})}):(0,ue.jsx)("pre",{style:{margin:0,whiteSpace:"pre-wrap",wordWrap:"break-word",fontFamily:'"Roboto Mono", monospace',fontSize:"0.9rem",lineHeight:1.6,color:"light"===l.palette.mode?"rgba(0, 0, 0, 0.87)":"rgba(255, 255, 255, 0.87)"},children:"string"===typeof o?_(o):S(o)})}),n<Object.entries(e).length-1&&(0,ue.jsx)(F.A,{sx:{my:3}})]},s)})}return(0,ue.jsx)(H.A,{elevation:0,sx:{bgcolor:"light"===l.palette.mode?"grey.50":"grey.900",p:2.5,borderRadius:1.5,border:"1px solid",borderColor:"light"===l.palette.mode?"grey.200":"grey.800",transition:"all 0.2s ease-in-out","&:hover":{bgcolor:"light"===l.palette.mode?"grey.100":"grey.800",borderColor:"light"===l.palette.mode?"grey.300":"grey.700"}},children:"string"===typeof e&&E(e)&&"html"===u?(0,ue.jsx)(T,{html:e,isFullscreen:h}):"string"===typeof e&&C(e)&&!E(e)?(0,ue.jsx)(ce.oz,{className:"markdown-body",remarkPlugins:[de.A],children:e}):(0,ue.jsx)("pre",{style:{margin:0,whiteSpace:"pre-wrap",wordWrap:"break-word",fontFamily:'"Roboto Mono", monospace',fontSize:"0.9rem",lineHeight:1.6,color:"light"===l.palette.mode?"rgba(0, 0, 0, 0.87)":"rgba(255, 255, 255, 0.87)"},children:"string"===typeof e?_(e):S(e)})})})(k)})}),(0,ue.jsxs)(U.A,{sx:{px:3,py:2,gap:1},children:[g&&(0,ue.jsx)(f.A,{title:"Open Databricks Volume Location",children:(0,ue.jsx)(N.A,{onClick:()=>{if(g.workspaceUrl){const e=g.path.replace("/Volumes/","").split("/");if(e.length>=3){const t=e[0],n=e[1],r=e[2],s=g.workspaceUrl.replace(/\/$/,"")+"/explore/data/volumes/"+t+"/"+n+"/"+r;window.open(s,"_blank")}else window.open(g.workspaceUrl,"_blank")}else alert("Unable to retrieve Databricks workspace URL. Please ensure Databricks is properly configured.")},variant:"outlined",startIcon:(0,ue.jsx)(Se.A,{}),sx:{borderRadius:"8px",textTransform:"none",fontWeight:500,borderColor:"#FF5722",color:"#FF5722","&:hover":{borderColor:"#F4511E",backgroundColor:"rgba(255, 87, 34, 0.04)"}},children:"Open in Databricks Volume"})}),a&&(0,ue.jsx)(f.A,{title:w?"Download as HTML":"Download as PDF",children:(0,ue.jsx)(N.A,{onClick:w?()=>{if(!a)return;let e="";if(o&&"object"===typeof o){const t=JSON.stringify(o);if(t.includes("<html")||t.includes("<!DOCTYPE"))for(const n of Object.values(o)){const t=String(n);if(t.includes("<html")||t.includes("<!DOCTYPE")){e=t;break}}}e||(e='\n<!DOCTYPE html>\n<html lang="en">\n<head>\n    <meta charset="UTF-8">\n    <meta name="viewport" content="width=device-width, initial-scale=1.0">\n    <title>Result</title>\n</head>\n<body>\n    <pre>'+JSON.stringify(o,null,2)+"</pre>\n</body>\n</html>\n      ");const t=new Blob([e],{type:"text/html"}),n=URL.createObjectURL(t),r=document.createElement("a");r.href=n;const s=null!=a&&a.run_name?a.run_name.replace(/[^a-z0-9]/gi,"_").toLowerCase():"result",i=(new Date).toISOString().split("T")[0],l=(null==a?void 0:a.job_id)||"unknown";r.download=s+"_"+i+"_"+l+".html",document.body.appendChild(r),r.click(),document.body.removeChild(r),URL.revokeObjectURL(n)}:()=>De(a),variant:"outlined",startIcon:w?(0,ue.jsx)(ke.A,{}):(0,ue.jsx)(we.A,{}),sx:{borderRadius:"8px",textTransform:"none",fontWeight:500},children:w?"Download HTML":"Download PDF"})}),(0,ue.jsx)(N.A,{onClick:n,variant:"contained",color:"primary",sx:{borderRadius:1.5,textTransform:"none",px:3,py:1,fontWeight:600},children:"Close"})]})]})},(e,t)=>e.open===t.open&&e.onClose===t.onClose&&JSON.stringify(e.result)===JSON.stringify(t.result));Fe.displayName="ShowResult";const Ne=Fe;var Me=n(45679),He=n(13115),Pe=n(36873),Ue=n(6493),Be=n(11679),Je=n(95699);const Ye=e=>{let{executionId:t,status:n,variant:r="button",size:o="medium",onStopComplete:l,onStatusChange:c}=e;const[d,u]=(0,s.useState)(!1),[p,h]=(0,s.useState)(!1),m=["RUNNING","PREPARING"].includes(null==n?void 0:n.toUpperCase()),g="STOPPING"===(null==n?void 0:n.toUpperCase())||d,b=()=>{h(!0)},j=async e=>{h(!1),u(!0);try{const n="force"===e?"/executions/"+t+"/force-stop":"/executions/"+t+"/stop",r="graceful"===e?{stop_type:"graceful",reason:"User requested stop",preserve_partial_results:!0}:{},s=await X.uE.post(n,r);s.data&&(Me.oR.success("Execution "+("force"===e?"forcefully":"gracefully")+" stopped"),c&&c(s.data.status),l&&l(s.data),"STOPPED"===s.data.status&&window.dispatchEvent(new CustomEvent("jobStopped",{detail:{jobId:t,status:s.data.status,partialResults:s.data.partial_results}})))}catch(r){var n;Me.oR.error((null==r||null==(n=r.response)||null==(n=n.data)?void 0:n.detail)||"Failed to stop execution")}finally{u(!1)}},v=()=>{h(!1)};return m||g?(0,ue.jsxs)(ue.Fragment,{children:["icon"===r?(0,ue.jsx)(f.A,{title:g?"Stopping execution...":"Stop execution",children:(0,ue.jsx)("span",{children:(0,ue.jsx)(y.A,{color:"error",size:o,onClick:b,disabled:g,children:g?(0,ue.jsx)(a.A,{size:20}):(0,ue.jsx)(Be.A,{})})})}):(0,ue.jsx)(N.A,{variant:"contained",color:"error",size:o,startIcon:g?(0,ue.jsx)(a.A,{size:16}):(0,ue.jsx)(Be.A,{}),onClick:b,disabled:g,children:g?"Stopping...":"Stop Execution"}),(0,ue.jsxs)(I.A,{open:p,onClose:v,maxWidth:"sm",fullWidth:!0,children:[(0,ue.jsx)(O.A,{children:(0,ue.jsxs)(i.A,{display:"flex",alignItems:"center",children:[(0,ue.jsx)(Je.A,{color:"warning",sx:{mr:1}}),"Stop Execution?"]})}),(0,ue.jsx)(M.A,{children:(0,ue.jsxs)(Ue.A,{component:"div",children:[(0,ue.jsx)(W.A,{variant:"body1",gutterBottom:!0,children:"Choose how you want to stop the execution:"}),(0,ue.jsxs)(i.A,{sx:{mt:2},children:[(0,ue.jsxs)(x.A,{severity:"info",sx:{mb:2},children:[(0,ue.jsx)(W.A,{variant:"subtitle2",fontWeight:"bold",children:"Graceful Stop"}),(0,ue.jsx)(W.A,{variant:"body2",children:"Completes the current task before stopping. Preserves all partial results."})]}),(0,ue.jsxs)(x.A,{severity:"warning",children:[(0,ue.jsx)(W.A,{variant:"subtitle2",fontWeight:"bold",children:"Force Stop"}),(0,ue.jsx)(W.A,{variant:"body2",children:"Immediately terminates the execution. May lose data from the current task."})]})]})]})}),(0,ue.jsxs)(U.A,{children:[(0,ue.jsx)(N.A,{onClick:v,color:"inherit",children:"Cancel"}),(0,ue.jsx)(N.A,{onClick:()=>j("graceful"),color:"warning",variant:"outlined",children:"Graceful Stop"}),(0,ue.jsx)(N.A,{onClick:()=>j("force"),color:"error",variant:"contained",children:"Force Stop"})]})]})]}):null},Ve=e=>{var t,n;let{run:r,onViewResult:s,onShowTrace:o,onShowLogs:a,onSchedule:l,onDelete:c,onStatusChange:d}=e;const{t:u}=(0,oe.Bd)(),{useNewExecutionUI:p}=se();return p?(0,ue.jsxs)(i.A,{sx:{display:"flex",gap:.5,alignItems:"center"},children:[(0,ue.jsx)(Ye,{executionId:r.job_id,status:r.status,variant:"icon",size:"small",onStatusChange:e=>{d&&d(r.id,e)}}),(0,ue.jsx)(f.A,{title:u("runHistory.actions.deleteRun"),children:(0,ue.jsx)(y.A,{size:"small",onClick:()=>c(r),color:"error",children:(0,ue.jsx)(w.A,{fontSize:"small"})})})]}):(0,ue.jsxs)(i.A,{sx:{display:"flex",gap:.5,alignItems:"center"},children:[(0,ue.jsx)(Ye,{executionId:r.job_id,status:r.status,variant:"icon",size:"small",onStatusChange:e=>{d&&d(r.id,e)}}),(0,ue.jsx)(f.A,{title:u("runHistory.actions.viewResult"),children:(0,ue.jsx)("span",{children:(0,ue.jsx)(y.A,{size:"small",onClick:()=>s(r),color:"primary",disabled:["running","pending","queued","in_progress"].includes((null==(t=r.status)?void 0:t.toLowerCase())||""),children:(0,ue.jsx)(E.A,{fontSize:"small"})})})}),(0,ue.jsx)(f.A,{title:u("runHistory.actions.downloadPdf"),children:(0,ue.jsx)(y.A,{size:"small",onClick:()=>De(r),color:"primary",children:(0,ue.jsx)(we.A,{fontSize:"small"})})}),(0,ue.jsx)(f.A,{title:u("runHistory.actions.viewTrace"),children:(0,ue.jsx)(y.A,{size:"small",onClick:()=>o(r.id),color:"primary","aria-label":"View execution trace",children:(0,ue.jsx)(T.A,{fontSize:"small"})})}),(0,ue.jsx)(f.A,{title:u("runHistory.actions.viewLogs"),children:(0,ue.jsx)("span",{children:(0,ue.jsx)(y.A,{size:"small",onClick:()=>a(r.job_id),color:"primary",disabled:["running","pending","queued","in_progress"].includes((null==(n=r.status)?void 0:n.toLowerCase())||""),children:(0,ue.jsx)($.A,{fontSize:"small"})})})}),(0,ue.jsx)(f.A,{title:u("runHistory.actions.schedule"),children:(0,ue.jsx)(y.A,{size:"small",onClick:()=>l(r),color:"primary",children:(0,ue.jsx)(R.A,{fontSize:"small"})})}),(0,ue.jsx)(f.A,{title:u("runHistory.actions.deleteRun"),children:(0,ue.jsx)(y.A,{size:"small",onClick:()=>c(r),color:"error",children:(0,ue.jsx)(w.A,{fontSize:"small"})})})]})};var Ke=n(25979),qe=n(19647),Ge=n(70006),$e=n(23266),Qe=n(60899),Ze=n(96557),Xe=n(16497),et=n(93038),tt=n(4862);const nt=e=>{let{open:t,onClose:n,scheduleName:r,cronExpression:o,scheduleNameInputRef:a,onScheduleNameChange:l,onCronExpressionChange:c,onScheduleJob:d}=e;const{t:u}=(0,oe.Bd)(),[p,h]=(0,s.useState)("visual"),[m,g]=(0,s.useState)("daily"),[f,b]=(0,s.useState)({hour:"0",minute:"0"}),[v,A]=(0,s.useState)([]),[w,k]=(0,s.useState)([]),[S,_]=(0,s.useState)([]),[C,E]=(0,s.useState)(null),[T,R]=(0,s.useState)(!1),z=(0,s.useCallback)(e=>{const t=e.split(" ");if(5!==t.length)return;const[n,r,s,o,a]=t;b({minute:"*"===n?"0":n,hour:"*"===r?"0":r}),"*"===r?g("hourly"):"*"===s&&"*"===o&&"*"===a?g("daily"):"*"===s&&"*"===o&&"*"!==a?(g("weekly"),A(a.split(","))):"*"!==s&&"*"===o?(g("monthly"),_(s.split(","))):"*"!==o&&(g("yearly"),k(o.split(",")))},[]),L=(0,s.useCallback)(()=>{const{hour:e,minute:t}=f;let n="";const r=v.length>0?v.join(","):"*",s=S.length>0?S.join(","):"*",o=w.length>0?w.join(","):"*";switch(m){case"hourly":n=t+" * * * *";break;case"daily":n=t+" "+e+" * * *";break;case"weekly":n=t+" "+e+" * * "+r;break;case"monthly":n=t+" "+e+" "+s+" * *";break;case"yearly":n=t+" "+e+" * "+o+" *";break;default:n="0 0 * * *"}c({target:{value:n}})},[m,f,v,w,S,c]),[D,F]=(0,s.useState)(!1);(0,s.useEffect)(()=>{t&&(F(!0),o&&"0 0 * * *"!==o?z(o):(g("daily"),b({hour:"0",minute:"0"}),A([]),k([]),_([])),E(null),setTimeout(()=>F(!1),100))},[t,o,z]),(0,s.useEffect)(()=>{"visual"===p&&t&&!D&&L()},[p,m,f,v,w,S,t,D,L]);const H=()=>{E(null)};return(0,ue.jsxs)(ue.Fragment,{children:[(0,ue.jsxs)(I.A,{open:t,onClose:n,maxWidth:"sm",fullWidth:!0,children:[(0,ue.jsxs)(O.A,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",pb:1.5,borderBottom:"1px solid",borderColor:"divider"},children:[(0,ue.jsx)(W.A,{variant:"h6",children:"Schedule Job"}),(0,ue.jsx)(y.A,{onClick:n,size:"small",sx:{color:"text.secondary","&:hover":{color:"text.primary"}},children:(0,ue.jsx)(B.A,{})})]}),(0,ue.jsxs)(M.A,{children:[(0,ue.jsx)(j.A,{fullWidth:!0,label:"Schedule Name",value:r,onChange:l,margin:"normal",inputRef:a}),(0,ue.jsxs)(i.A,{sx:{mb:2,mt:2},children:[(0,ue.jsxs)(ge.A,{value:p,exclusive:!0,onChange:(e,t)=>t&&h(t),sx:{mb:2},children:[(0,ue.jsx)(xe.A,{value:"visual",children:"Simple Schedule"}),(0,ue.jsx)(xe.A,{value:"manual",children:"Advanced (Cron)"})]}),"manual"===p?(0,ue.jsx)(j.A,{fullWidth:!0,label:"Cron Expression",value:o,onChange:c,helperText:"Example: '0 0 * * *' for daily at midnight"}):(()=>{const e=Array.from({length:24},(e,t)=>t.toString()),t=Array.from({length:60},(e,t)=>t.toString()),n=Array.from({length:31},(e,t)=>(t+1).toString());return(0,ue.jsxs)(i.A,{sx:{mt:2},children:[(0,ue.jsxs)(Ke.A,{fullWidth:!0,sx:{mb:2},children:[(0,ue.jsx)(qe.A,{children:"Frequency"}),(0,ue.jsxs)(Ge.A,{value:m,onChange:e=>g(e.target.value),label:"Frequency",children:[(0,ue.jsx)($e.A,{value:"hourly",children:"Hourly"}),(0,ue.jsx)($e.A,{value:"daily",children:"Daily"}),(0,ue.jsx)($e.A,{value:"weekly",children:"Weekly"}),(0,ue.jsx)($e.A,{value:"monthly",children:"Monthly"}),(0,ue.jsx)($e.A,{value:"yearly",children:"Yearly"})]})]}),(0,ue.jsxs)(Qe.Ay,{container:!0,spacing:2,sx:{mb:2},children:[(0,ue.jsx)(Qe.Ay,{item:!0,xs:6,children:(0,ue.jsxs)(Ke.A,{fullWidth:!0,children:[(0,ue.jsx)(qe.A,{children:"Hour"}),(0,ue.jsx)(Ge.A,{value:f.hour,onChange:e=>b(t=>Object.assign({},t,{hour:e.target.value})),label:"Hour",disabled:"hourly"===m,children:e.map(e=>(0,ue.jsx)($e.A,{value:e,children:e.padStart(2,"0")},e))})]})}),(0,ue.jsx)(Qe.Ay,{item:!0,xs:6,children:(0,ue.jsxs)(Ke.A,{fullWidth:!0,children:[(0,ue.jsx)(qe.A,{children:"Minute"}),(0,ue.jsx)(Ge.A,{value:f.minute,onChange:e=>b(t=>Object.assign({},t,{minute:e.target.value})),label:"Minute",children:t.map(e=>(0,ue.jsx)($e.A,{value:e,children:e.padStart(2,"0")},e))})]})})]}),"weekly"===m&&(0,ue.jsxs)(Ke.A,{component:"fieldset",fullWidth:!0,sx:{mb:2},children:[(0,ue.jsx)(W.A,{variant:"subtitle2",gutterBottom:!0,children:"Select Days"}),(0,ue.jsx)(Ze.A,{row:!0,children:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"].map((e,t)=>(0,ue.jsx)(Xe.A,{control:(0,ue.jsx)(et.A,{checked:v.includes(t.toString()),onChange:e=>{e.target.checked?A([...v,t.toString()]):A(v.filter(e=>e!==t.toString()))}}),label:e},e))})]}),"monthly"===m&&(0,ue.jsxs)(Ke.A,{component:"fieldset",fullWidth:!0,sx:{mb:2},children:[(0,ue.jsx)(W.A,{variant:"subtitle2",gutterBottom:!0,children:"Select Days of Month"}),(0,ue.jsx)(Ze.A,{row:!0,children:n.map(e=>(0,ue.jsx)(Xe.A,{control:(0,ue.jsx)(et.A,{checked:S.includes(e),onChange:t=>{t.target.checked?_([...S,e]):_(S.filter(t=>t!==e))}}),label:e,sx:{width:"70px"}},e))})]}),"yearly"===m&&(0,ue.jsxs)(Ke.A,{component:"fieldset",fullWidth:!0,sx:{mb:2},children:[(0,ue.jsx)(W.A,{variant:"subtitle2",gutterBottom:!0,children:"Select Months"}),(0,ue.jsx)(Ze.A,{row:!0,children:["January","February","March","April","May","June","July","August","September","October","November","December"].map((e,t)=>(0,ue.jsx)(Xe.A,{control:(0,ue.jsx)(et.A,{checked:w.includes((t+1).toString()),onChange:e=>{e.target.checked?k([...w,(t+1).toString()]):k(w.filter(e=>e!==(t+1).toString()))}}),label:e},e))})]})]})})()]}),"visual"===p&&(0,ue.jsx)(i.A,{sx:{mt:2,p:2,bgcolor:"grey.50",borderRadius:1},children:(0,ue.jsxs)(W.A,{variant:"body2",color:"text.secondary",children:[(0,ue.jsx)("strong",{children:"Generated Cron Expression:"})," ",o]})})]}),(0,ue.jsxs)(U.A,{children:[(0,ue.jsx)(N.A,{onClick:n,disabled:T,children:"Cancel"}),(0,ue.jsx)(N.A,{onClick:async()=>{if(r&&o)try{R(!0),E(null),await d()}catch(C){E("Failed to schedule job")}finally{R(!1)}else E("Please fill in all required fields")},variant:"contained",color:"primary",disabled:T||!r||!o,children:T?"Scheduling...":"Schedule Job"})]})]}),(0,ue.jsx)(tt.A,{open:!!C,autoHideDuration:6e3,onClose:H,anchorOrigin:{vertical:"top",horizontal:"center"},children:(0,ue.jsx)(x.A,{onClose:H,severity:"error",variant:"filled",sx:{width:"100%",whiteSpace:"pre-line"},children:C})})]})},rt=e=>{let{deleteDialogOpen:t,deleteLoading:n,scheduleDialogOpen:r,scheduleName:s,cronExpression:o,scheduleNameInputRef:a,deleteRunDialogOpen:i,onCloseDeleteDialog:l,onCloseScheduleDialog:c,onCloseDeleteRunDialog:d,onDeleteAllRuns:u,onDeleteRun:p,onScheduleJob:h,onScheduleNameChange:m,onCronExpressionChange:g}=e;const{t:x}=(0,oe.Bd)();return(0,ue.jsxs)(ue.Fragment,{children:[(0,ue.jsxs)(I.A,{open:t,onClose:l,children:[(0,ue.jsx)(O.A,{children:x("common.confirm")}),(0,ue.jsx)(M.A,{children:(0,ue.jsx)(Ue.A,{children:x("runHistory.deleteConfirm")})}),(0,ue.jsxs)(U.A,{children:[(0,ue.jsx)(N.A,{onClick:l,disabled:n,children:x("common.cancel")}),(0,ue.jsx)(N.A,{onClick:u,color:"error",disabled:n,children:x(n?"common.loading":"common.delete")})]})]}),(0,ue.jsx)(nt,{open:r,onClose:c,scheduleName:s,cronExpression:o,scheduleNameInputRef:a,onScheduleNameChange:m,onCronExpressionChange:g,onScheduleJob:h}),(0,ue.jsxs)(I.A,{open:i,onClose:d,children:[(0,ue.jsx)(O.A,{children:x("common.confirm")}),(0,ue.jsx)(M.A,{children:(0,ue.jsx)(Ue.A,{children:x("runHistory.deleteRunConfirm")})}),(0,ue.jsxs)(U.A,{children:[(0,ue.jsx)(N.A,{onClick:d,disabled:n,children:x("common.cancel")}),(0,ue.jsx)(N.A,{onClick:p,color:"error",disabled:n,children:x(n?"common.loading":"common.delete")})]})]})]})};var st=n(61031),ot=n(73499),at=n(73364),it=n(59943),lt=n(16724),ct=n(11227),dt=n(99905),ut=n(49885);const pt=e=>{let{status:t,size:n="small",showIcon:r=!0}=e;const s=(()=>{switch(null==t?void 0:t.toUpperCase()){case"PENDING":return{label:"Pending",color:"warning",icon:(0,ue.jsx)(at.A,{})};case"QUEUED":return{label:"Queued",color:"warning",icon:(0,ue.jsx)(at.A,{})};case"PREPARING":return{label:"Preparing",color:"info",icon:(0,ue.jsx)(it.A,{})};case"RUNNING":return{label:"Running",color:"primary",icon:(0,ue.jsx)(lt.A,{})};case"STOPPING":return{label:"Stopping",color:"warning",icon:(0,ue.jsx)(i.A,{display:"flex",alignItems:"center",children:(0,ue.jsx)(a.A,{size:16,color:"inherit"})})};case"STOPPED":return{label:"Stopped",color:"warning",icon:(0,ue.jsx)(Be.A,{})};case"COMPLETED":return{label:"Completed",color:"success",icon:(0,ue.jsx)(ct.A,{})};case"FAILED":return{label:"Failed",color:"error",icon:(0,ue.jsx)(dt.A,{})};case"CANCELLED":return{label:"Cancelled",color:"default",icon:(0,ue.jsx)(ut.A,{})};default:return{label:t?t.charAt(0).toUpperCase()+t.slice(1).toLowerCase():"Unknown",color:"default",icon:null}}})();return(0,ue.jsx)(o.A,{label:s.label,color:s.color,size:n,icon:r&&s.icon?s.icon:void 0,variant:"STOPPING"===(null==t?void 0:t.toUpperCase())?"filled":"outlined",sx:{animation:"STOPPING"===(null==t?void 0:t.toUpperCase())?"pulse 2s infinite":"none","@keyframes pulse":{"0%":{opacity:1},"50%":{opacity:.6},"100%":{opacity:1}}}})},ht=["job_id","execution_id"],mt=e=>{let{run:t}=e;const[n,r]=(0,s.useState)("-"),[l,c]=(0,s.useState)(!0);return(0,s.useEffect)(()=>{let e=!0;const n=(t.status||"").toUpperCase();return"COMPLETED"===n||"FAILED"===n||"CANCELLED"===n?(async()=>{try{const n=await(0,L.Jc)(t);e&&(r(n),c(!1))}catch(n){e&&(r("-"),c(!1))}})():(r("-"),c(!1)),()=>{e=!1}},[t]),l?(0,ue.jsx)(o.A,{label:(0,ue.jsx)(a.A,{size:10,thickness:4}),size:"small",variant:"outlined",sx:{height:"18px","& .MuiChip-label":{px:.75},borderColor:e=>e.palette.grey[400]}}):"-"===n?(0,ue.jsx)("span",{style:{color:"#999",fontSize:"0.75rem"},children:"-"}):(0,ue.jsx)(o.A,{label:(0,ue.jsxs)(i.A,{sx:{display:"flex",alignItems:"center",gap:.5},children:[(0,ue.jsx)(z.A,{sx:{fontSize:"0.75rem"}}),(0,ue.jsx)("span",{children:n})]}),size:"small",variant:"outlined",sx:{height:"20px","& .MuiChip-label":{px:.5,fontSize:"0.7rem",fontWeight:500},borderColor:e=>e.palette.grey[400]}})},gt=(0,s.forwardRef)((e,t)=>{let{executionHistoryHeight:n=200,onExecutionCountChange:a}=e;const{t:z}=(0,oe.Bd)(),{showRunResult:L,selectedRun:I,isOpen:O,closeRunResult:W}=(0,le.K)(),{userRole:F}=(0,ot.Sk)(),{runs:N,searchQuery:M,loading:H,showSkeleton:P,error:U,page:B,totalPages:J,totalRuns:Y,jobsPerPage:V,sortField:K,sortOrder:q,fetchRuns:G,handlePageChange:$,handleSearchChange:Q,handleDeleteAllRuns:Z,handleDeleteRun:X,getCurrentPageJobs:ee,handleSort:te}=(0,He.V)(),ne=(0,Pe.a)(e=>e.startPolling),re=(0,Pe.a)(e=>e.stopPolling),se=(0,Pe.a)(e=>e.setUserActive),ce=(0,Pe.a)(e=>e.cleanup),[de,he]=(0,s.useState)(null),[me,ge]=(0,s.useState)(null),[xe,fe]=(0,s.useState)(!1),[ye,be]=(0,s.useState)(!1),[je,ve]=(0,s.useState)(!1),[Ae,we]=(0,s.useState)(!1),[ke,Se]=(0,s.useState)([]),[_e,Ce]=(0,s.useState)(null),[Ee,Te]=(0,s.useState)(!1),[Re,ze]=(0,s.useState)(null),[Le,De]=(0,s.useState)(!1),[Ie,Oe]=(0,s.useState)(null),[We,Fe]=(0,s.useState)(""),[Ue,Be]=(0,s.useState)("0 0 * * *"),[Je,Ye]=(0,s.useState)(null),Ke=(0,s.useRef)(null),qe=(0,s.useRef)(null),[Ge,$e]=(0,s.useState)(!1),[Qe,Ze]=(0,s.useState)(null),[Xe,et]=(0,s.useState)(1),tt=(0,s.useRef)(!1),nt=(0,s.useRef)(!1),at=(0,s.useRef)(!1),it=(0,s.useRef)(null),lt=s.useMemo(()=>{const e=n-80;return Math.max(6,Math.floor(e/32))},[n]),ct=(Xe-1)*lt,dt=ct+lt,ut=N.slice(ct,dt),gt=Math.ceil(N.length/lt),xt=s.useMemo(()=>(null==I?void 0:I.result)||{},[null==I?void 0:I.result]);(0,s.useEffect)(()=>{nt.current=xe,at.current=Ae},[xe,Ae]),(0,s.useEffect)(()=>{et(1)},[N.length,M]),(0,s.useEffect)(()=>{a&&a(N.length)},[N.length,a]),(0,s.useEffect)(()=>{if(tt.current)return;tt.current=!0;const e=(async()=>{try{await G()}catch(t){}const e=()=>{se(!0),it.current&&clearTimeout(it.current),it.current=setTimeout(()=>{se(!1)},3e5)};return window.addEventListener("mousemove",e),window.addEventListener("keydown",e),window.addEventListener("click",e),e(),ne(),()=>{it.current&&clearTimeout(it.current),window.removeEventListener("mousemove",e),window.removeEventListener("keydown",e),window.removeEventListener("click",e),re(),ce()}})();return()=>{e.then(e=>e())}},[G,ne,re,se,ce]),(0,s.useEffect)(()=>{if(!tt.current)return;const e=nt.current&&!xe,t=at.current&&!Ae;(e||t)&&G().catch(e=>{})},[xe,Ae,G]),(0,s.useEffect)(()=>{const e=()=>{G().catch(e=>{})};return window.addEventListener("refreshRunHistory",e),()=>{window.removeEventListener("refreshRunHistory",e)}},[G]);const ft=e=>{he(e);const t=N.find(t=>t.id===e);ge(t||null),fe(!0)},yt=e=>{L(e)},bt=e=>{Ze(e),$e(!0)},jt=async e=>{try{window.dispatchEvent(new CustomEvent("jobViewed",{detail:{jobId:e}})),Te(!0),ze(null),Ce(e),we(!0);const t=await ie.m.getHistoricalLogs(e);Se(t.map(e=>{let t=(0,r.A)(e,ht);return Object.assign({},t,{output:t.output||t.content,id:t.id||Date.now()})})),ie.m.connectToJobLogs(e);const{loadTaskStates:n}=st.useTaskExecutionStore.getState();await n(e);const s=ie.m.onConnected(e,()=>{Te(!1)}),o=ie.m.onJobLogs(e,e=>{Se(t=>[...t,{id:e.id||Date.now(),output:e.output||e.content,timestamp:e.timestamp}])}),a=ie.m.onError(e,e=>{ze("Failed to connect to log stream"),Te(!1)}),i=ie.m.onClose(e,e=>{Te(!1)});return()=>{s(),o(),a(),i(),ie.m.disconnectFromJobLogs(e)}}catch(U){return ze("Failed to fetch logs"),Te(!1),()=>{}}};(0,s.useEffect)(()=>()=>{ie.m.cleanup()},[]);const vt=e=>{var t,n;Be("0 0 * * *"),Oe(e),Fe((null!=(t=e.run_name)&&t.startsWith('"')&&null!=(n=e.run_name)&&n.endsWith('"')?e.run_name.slice(1,-1):e.run_name)+" Schedule"),De(!0),setTimeout(()=>{qe.current&&qe.current.focus()},150)},At=()=>{Ye(null)},wt=Boolean(Je),kt=wt?"filter-popover":void 0,St=e=>K!==e?null:"asc"===q?(0,ue.jsx)(_.A,{fontSize:"small"}):(0,ue.jsx)(C.A,{fontSize:"small"});return s.useImperativeHandle(t,()=>({refreshRuns:async()=>{await G()}})),P?(0,ue.jsx)(l.A,{sx:{boxShadow:"none",height:"100%"},children:(0,ue.jsx)(c.A,{sx:{p:0,height:"100%","&:last-child":{pb:0},display:"flex",flexDirection:"column"},children:(0,ue.jsx)(d.A,{sx:{flex:"1 1 auto",overflow:"auto"},children:(0,ue.jsxs)(u.A,{size:"small",stickyHeader:!0,children:[(0,ue.jsx)(p.A,{children:(0,ue.jsxs)(h.A,{children:[(0,ue.jsx)(m.A,{sx:{py:.25,fontSize:"0.8125rem",backgroundColor:e=>e.palette.background.paper},children:(0,ue.jsx)(i.A,{sx:{display:"flex",alignItems:"center",gap:1},children:z("jobs.runName")})}),(0,ue.jsx)(m.A,{sx:{py:.25,fontSize:"0.8125rem",backgroundColor:e=>e.palette.background.paper},children:z("jobs.status")}),(0,ue.jsx)(m.A,{sx:{py:.25,fontSize:"0.8125rem",backgroundColor:e=>e.palette.background.paper},children:z("jobs.duration")}),(0,ue.jsx)(m.A,{sx:{py:.25,fontSize:"0.8125rem",backgroundColor:e=>e.palette.background.paper},children:z("jobs.date")}),(0,ue.jsx)(m.A,{sx:{py:.25,fontSize:"0.8125rem",backgroundColor:e=>e.palette.background.paper,textAlign:"center"},children:z("jobs.actions")})]})}),(0,ue.jsx)(g.A,{children:Array.from({length:3},(e,t)=>(0,ue.jsxs)(h.A,{children:[(0,ue.jsx)(m.A,{sx:{py:.25,fontSize:"0.75rem"},children:(0,ue.jsx)(i.A,{sx:{height:"1rem",backgroundColor:e=>e.palette.action.hover,borderRadius:"4px",animation:"pulse 1.5s ease-in-out infinite","@keyframes pulse":{"0%":{opacity:1},"50%":{opacity:.4},"100%":{opacity:1}}}})}),(0,ue.jsx)(m.A,{sx:{py:.25,fontSize:"0.75rem"},children:(0,ue.jsx)(i.A,{sx:{height:"1.5rem",width:"60px",backgroundColor:e=>e.palette.action.hover,borderRadius:"12px",animation:"pulse 1.5s ease-in-out infinite","@keyframes pulse":{"0%":{opacity:1},"50%":{opacity:.4},"100%":{opacity:1}}}})}),(0,ue.jsx)(m.A,{sx:{py:.25,fontSize:"0.75rem"},children:(0,ue.jsx)(i.A,{sx:{height:"1rem",width:"40px",backgroundColor:e=>e.palette.action.hover,borderRadius:"4px",animation:"pulse 1.5s ease-in-out infinite","@keyframes pulse":{"0%":{opacity:1},"50%":{opacity:.4},"100%":{opacity:1}}}})}),(0,ue.jsx)(m.A,{sx:{py:.25,fontSize:"0.75rem"},children:(0,ue.jsx)(i.A,{sx:{height:"1rem",width:"80px",backgroundColor:e=>e.palette.action.hover,borderRadius:"4px",animation:"pulse 1.5s ease-in-out infinite","@keyframes pulse":{"0%":{opacity:1},"50%":{opacity:.4},"100%":{opacity:1}}}})}),(0,ue.jsx)(m.A,{sx:{py:.25,fontSize:"0.75rem"},children:(0,ue.jsx)(i.A,{sx:{height:"1rem",width:"50px",backgroundColor:e=>e.palette.action.hover,borderRadius:"4px",animation:"pulse 1.5s ease-in-out infinite","@keyframes pulse":{"0%":{opacity:1},"50%":{opacity:.4},"100%":{opacity:1}}}})}),(0,ue.jsx)(m.A,{sx:{py:.25,fontSize:"0.75rem",textAlign:"center"},children:(0,ue.jsx)(i.A,{sx:{height:"1.5rem",width:"60px",backgroundColor:e=>e.palette.action.hover,borderRadius:"4px",animation:"pulse 1.5s ease-in-out infinite","@keyframes pulse":{"0%":{opacity:1},"50%":{opacity:.4},"100%":{opacity:1}},margin:"0 auto"}})})]},"skeleton-"+t))})]})})})}):U?(0,ue.jsx)(x.A,{severity:"error",sx:{mb:2},children:U}):(0,ue.jsx)(ue.Fragment,{children:(0,ue.jsx)(l.A,{sx:{boxShadow:"none",height:"100%"},children:(0,ue.jsxs)(c.A,{sx:{p:0,height:"100%","&:last-child":{pb:0},display:"flex",flexDirection:"column"},children:[(0,ue.jsx)(d.A,{sx:{flex:"1 1 auto",overflow:"auto"},children:(0,ue.jsxs)(u.A,{size:"small",stickyHeader:!0,children:[(0,ue.jsx)(p.A,{children:(0,ue.jsxs)(h.A,{children:[(0,ue.jsx)(m.A,{sx:{py:.25,fontSize:"0.8125rem",backgroundColor:e=>e.palette.background.paper},children:(0,ue.jsxs)(i.A,{sx:{display:"flex",alignItems:"center",gap:1},children:[z("runHistory.columns.jobId"),(0,ue.jsx)(f.A,{title:z("runHistory.filter"),children:(0,ue.jsx)(y.A,{size:"small",onClick:e=>{Ye(e.currentTarget),setTimeout(()=>{Ke.current&&Ke.current.focus()},150)},sx:{p:.25,color:M?e=>e.palette.primary.main:"inherit"},"aria-describedby":kt,children:(0,ue.jsx)(S.A,{sx:{fontSize:"1rem"}})})}),(0,ue.jsx)(b.Ay,{id:kt,open:wt,anchorEl:Je,onClose:At,anchorOrigin:{vertical:"bottom",horizontal:"left"},children:(0,ue.jsx)(i.A,{sx:{p:1.5},onKeyDown:e=>{e.stopPropagation()},children:(0,ue.jsx)(j.A,{inputRef:Ke,size:"small",placeholder:z("runHistory.search"),variant:"outlined",value:M,onChange:Q,onKeyDown:e=>{e.stopPropagation(),"Escape"===e.key&&At()},InputProps:{startAdornment:(0,ue.jsx)(v.A,{position:"start",children:(0,ue.jsx)(k.A,{fontSize:"small"})})},sx:{width:"200px"}})})})]})}),(0,ue.jsx)(m.A,{sx:{py:.25,fontSize:"0.8125rem",cursor:"pointer",backgroundColor:e=>e.palette.background.paper},onClick:()=>te("status"),children:(0,ue.jsxs)(i.A,{sx:{display:"flex",alignItems:"center",gap:.5},children:[z("runHistory.columns.status"),St("status")]})}),(0,ue.jsx)(m.A,{sx:{py:.25,fontSize:"0.8125rem",backgroundColor:e=>e.palette.background.paper,textAlign:"center"},children:"Agents/Tasks"}),(0,ue.jsx)(m.A,{sx:{py:.25,fontSize:"0.8125rem",backgroundColor:e=>e.palette.background.paper},children:"Submitter"}),(0,ue.jsx)(m.A,{sx:{py:.25,fontSize:"0.8125rem",cursor:"pointer",backgroundColor:e=>e.palette.background.paper},onClick:()=>te("created_at"),children:(0,ue.jsxs)(i.A,{sx:{display:"flex",alignItems:"center",gap:.5},children:[z("runHistory.columns.startTime"),St("created_at")]})}),(0,ue.jsx)(m.A,{sx:{py:.25,fontSize:"0.8125rem",backgroundColor:e=>e.palette.background.paper},children:"Duration"}),(0,ue.jsx)(m.A,{sx:{py:.25,fontSize:"0.8125rem",backgroundColor:e=>e.palette.background.paper,textAlign:"center"},children:"Result"}),(0,ue.jsx)(m.A,{sx:{py:.25,fontSize:"0.8125rem",backgroundColor:e=>e.palette.background.paper,textAlign:"center"},children:"Trace"}),(0,ue.jsx)(m.A,{sx:{py:.25,fontSize:"0.8125rem",backgroundColor:e=>e.palette.background.paper,textAlign:"center"},children:"Schedule Execution"}),(0,ue.jsx)(m.A,{sx:{py:.25,fontSize:"0.8125rem",width:"120px",backgroundColor:e=>e.palette.background.paper},children:(0,ue.jsxs)(i.A,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",position:"relative","&:hover .delete-all-button, &:hover .settings-button":{opacity:1,visibility:"visible"}},children:[(0,ue.jsx)(i.A,{children:z("runHistory.columns.actions")}),(0,ue.jsx)(i.A,{sx:{display:"flex",gap:.5},children:"operator"!==F&&(0,ue.jsx)(f.A,{title:z("runHistory.deleteAllRuns"),children:(0,ue.jsx)(y.A,{className:"delete-all-button",size:"small",color:"error",onClick:()=>be(!0),disabled:0===N.length,sx:{height:"20px",width:"20px",p:.25,opacity:0,visibility:"hidden",transition:"opacity 0.2s ease-in-out, visibility 0.2s ease-in-out","&.Mui-disabled":{opacity:0,visibility:"hidden"}},children:(0,ue.jsx)(w.A,{sx:{fontSize:"0.875rem"}})})})})]})})]})}),(0,ue.jsx)(g.A,{children:0===ut.length?(0,ue.jsx)(h.A,{children:(0,ue.jsx)(m.A,{colSpan:10,align:"center",sx:{py:1,fontSize:"0.8125rem"},children:z(M?"runHistory.noSearchResults":"runHistory.noRuns")})}):ut.map(e=>{var t,n,r;return(0,ue.jsxs)(h.A,{sx:{transition:"all 0.2s ease-in-out","&:hover":{backgroundColor:e=>e.palette.action.hover},"& td":{py:.25,fontSize:"0.8125rem"}},children:[(0,ue.jsx)(m.A,{children:null!=(t=e.run_name)&&t.startsWith('"')&&null!=(n=e.run_name)&&n.endsWith('"')?e.run_name.slice(1,-1):e.run_name}),(0,ue.jsx)(m.A,{children:(0,ue.jsx)(pt,{status:e.status,size:"small"})}),(0,ue.jsx)(m.A,{align:"center",children:(()=>{let t=0,n=0,r=!1;try{var s,a;if(null!=(s=e.inputs)&&s.agents_yaml&&"object"===typeof e.inputs.agents_yaml)t=Object.keys(e.inputs.agents_yaml).length,r=!0;else if(e.agents_yaml){const n="string"===typeof e.agents_yaml?JSON.parse(e.agents_yaml):e.agents_yaml;t=Object.keys(n).length,r=!0}if(null!=(a=e.inputs)&&a.tasks_yaml&&"object"===typeof e.inputs.tasks_yaml)n=Object.keys(e.inputs.tasks_yaml).length,r=!0;else if(e.tasks_yaml){const t="string"===typeof e.tasks_yaml?JSON.parse(e.tasks_yaml):e.tasks_yaml;n=Object.keys(t).length,r=!0}}catch(i){}return r&&(t>0||n>0)?(0,ue.jsx)(o.A,{label:t+"/"+n,size:"small",variant:"outlined",sx:{height:"20px",minWidth:"45px","& .MuiChip-label":{px:.75,fontSize:"0.75rem",fontWeight:600},borderColor:e=>e.palette.divider}}):(0,ue.jsx)("span",{style:{color:"#999",fontSize:"0.75rem"},children:"-"})})()}),(0,ue.jsx)(m.A,{children:e.group_email||"-"}),(0,ue.jsx)(m.A,{children:new Date(e.created_at).toLocaleString()}),(0,ue.jsx)(m.A,{children:(0,ue.jsx)(mt,{run:e})}),(0,ue.jsx)(m.A,{align:"center",children:(0,ue.jsx)(f.A,{title:z("runHistory.actions.viewResult"),children:(0,ue.jsx)("span",{children:(0,ue.jsx)(y.A,{size:"small",onClick:()=>yt(e),color:"primary",disabled:["running","pending","queued","in_progress"].includes((null==(r=e.status)?void 0:r.toLowerCase())||""),children:(0,ue.jsx)(E.A,{fontSize:"small"})})})})}),(0,ue.jsx)(m.A,{align:"center",children:(0,ue.jsx)(f.A,{title:z("runHistory.actions.viewTrace"),children:(0,ue.jsx)(y.A,{size:"small",onClick:()=>ft(e.id),color:"primary",children:(0,ue.jsx)(T.A,{fontSize:"small"})})})}),(0,ue.jsx)(m.A,{align:"center",children:(0,ue.jsx)(f.A,{title:z("runHistory.actions.schedule"),children:(0,ue.jsx)(y.A,{size:"small",onClick:()=>vt(e),color:"primary",children:(0,ue.jsx)(R.A,{fontSize:"small"})})})}),(0,ue.jsx)(m.A,{children:(0,ue.jsx)(Ve,{run:e,onViewResult:yt,onShowTrace:ft,onShowLogs:jt,onSchedule:vt,onDelete:bt,onStatusChange:(e,t)=>{G()}})})]},e.id+"-"+e.status)})})]})}),gt>1&&(0,ue.jsx)(i.A,{sx:{display:"flex",justifyContent:"center",py:.25,borderTop:1,borderColor:"divider",flex:"0 0 auto"},children:(0,ue.jsx)(A.A,{count:gt,page:Xe,onChange:(e,t)=>et(t),color:"primary",size:"small",sx:{"& .MuiPaginationItem-root":{minWidth:"20px",height:"20px",fontSize:"0.7rem"}}})}),de&&(0,ue.jsx)(pe,{open:xe,onClose:()=>{fe(!1),he(null),ge(null),G().catch(e=>{})},runId:de,run:me||void 0,onViewResult:yt,onShowLogs:jt}),Ae&&_e&&(0,ue.jsx)(ae.A,{open:Ae,onClose:()=>{_e&&(ie.m.disconnectFromJobLogs(_e),Ce(null));const{clearTaskStates:e}=st.useTaskExecutionStore.getState();e(),we(!1),Se([]),G().catch(e=>{})},logs:ke,jobId:_e,isConnecting:Ee,connectionError:Re}),(0,ue.jsx)(rt,{deleteDialogOpen:ye,deleteLoading:je,scheduleDialogOpen:Le,scheduleName:We,cronExpression:Ue,scheduleNameInputRef:qe,deleteRunDialogOpen:Ge,onCloseDeleteDialog:()=>be(!1),onCloseScheduleDialog:()=>{De(!1),Fe(""),Be("0 0 * * *"),Oe(null)},onCloseDeleteRunDialog:()=>$e(!1),onDeleteAllRuns:async()=>{try{ve(!0),await Z(),be(!1)}finally{ve(!1)}},onDeleteRun:async()=>{if(Qe)try{ve(!0),await X(Qe.id),$e(!1),Ze(null)}catch(e){Me.oR.error(z("runHistory.deleteRunError"))}finally{ve(!1)}},onScheduleJob:async()=>{var e,t;if(!Ie||!We||!Ue)return void Me.oR.error("Please fill in all required fields");let n=null,r=null;if(null!=(e=Ie.inputs)&&e.agents_yaml&&(n=Ie.inputs.agents_yaml),null!=(t=Ie.inputs)&&t.tasks_yaml&&(r=Ie.inputs.tasks_yaml),!n&&Ie.agents_yaml)try{n="string"===typeof Ie.agents_yaml?JSON.parse(Ie.agents_yaml):Ie.agents_yaml}catch(a){}if(!r&&Ie.tasks_yaml)try{r="string"===typeof Ie.tasks_yaml?JSON.parse(Ie.tasks_yaml):Ie.tasks_yaml}catch(a){}let s="",o="";if(n&&r&&Object.keys(n).length>0&&Object.keys(r).length>0){s=JSON.stringify(n),o=JSON.stringify(r);try{const e={name:We,cron_expression:Ue,agents_yaml:JSON.parse(s||"{}"),tasks_yaml:JSON.parse(o||"{}"),inputs:{},is_active:!0,planning:!1};await D.l.createSchedule(e),De(!1),Oe(null),Fe(""),Be("0 0 * * *")}catch(U){Me.oR.error("Failed to schedule job")}}else Me.oR.error("\u274c Cannot schedule: This execution is missing its agent and task configuration. Please create a new execution with proper configuration instead.",{duration:1e4})},onScheduleNameChange:e=>Fe(e.target.value),onCronExpressionChange:e=>Be(e.target.value)}),(0,ue.jsx)(Ne,{open:O&&!!I,onClose:W,result:xt,run:I||void 0})]})})})});gt.displayName="History";const xt=gt}}]);